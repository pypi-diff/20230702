# Comparing `tmp/poetry_plugin_package_info-0.2.2.tar.gz` & `tmp/poetry_plugin_package_info-0.2.3.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "tmp.tar", last modified: Fri Jun 23 01:39:02 2023, max compression
+gzip compressed data, was "tmp.tar", last modified: Sat Jul  1 23:09:10 2023, max compression
```

## Comparing `poetry_plugin_package_info-0.2.2.tar` & `poetry_plugin_package_info-0.2.3.tar`

### file list

```diff
@@ -1,13 +1,13 @@
--rw-r--r--   0        0        0     1066 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/LICENSE
--rw-r--r--   0        0        0     8017 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/README.md
--rw-r--r--   0        0        0     1131 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/__init__.py
--rw-r--r--   0        0        0    95091 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/_zipfile.py
--rw-r--r--   0        0        0     1170 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/formatters/__init__.py
--rw-r--r--   0        0        0      814 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/formatters/black.py
--rw-r--r--   0        0        0     1172 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/generators/__init__.py
--rw-r--r--   0        0        0     8024 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/generators/git.py
--rw-r--r--   0        0        0     3149 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/generators/project.py
--rw-r--r--   0        0        0    33934 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/plugin.py
--rw-r--r--   0        0        0     4285 2023-06-23 01:38:33.093179 poetry_plugin_package_info-0.2.2/pyproject.toml
--rw-r--r--   0        0        0     9669 1970-01-01 00:00:00.000000 poetry_plugin_package_info-0.2.2/PKG-INFO
+-rw-r--r--   0        0        0     1066 2023-07-01 23:08:48.627092 poetry_plugin_package_info-0.2.3/LICENSE
+-rw-r--r--   0        0        0     8017 2023-07-01 23:08:48.627092 poetry_plugin_package_info-0.2.3/README.md
+-rw-r--r--   0        0        0     1131 2023-07-01 23:08:48.627092 poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/__init__.py
+-rw-r--r--   0        0        0    95091 2023-07-01 23:08:48.631091 poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/_zipfile.py
+-rw-r--r--   0        0        0     1170 2023-07-01 23:08:48.631091 poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/formatters/__init__.py
+-rw-r--r--   0        0        0      814 2023-07-01 23:08:48.631091 poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/formatters/black.py
+-rw-r--r--   0        0        0     1172 2023-07-01 23:08:48.631091 poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/generators/__init__.py
+-rw-r--r--   0        0        0     8024 2023-07-01 23:08:48.631091 poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/generators/git.py
+-rw-r--r--   0        0        0     3149 2023-07-01 23:08:48.631091 poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/generators/project.py
+-rw-r--r--   0        0        0    35728 2023-07-01 23:08:48.631091 poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/plugin.py
+-rw-r--r--   0        0        0     4234 2023-07-01 23:08:48.631091 poetry_plugin_package_info-0.2.3/pyproject.toml
+-rw-r--r--   0        0        0     9669 1970-01-01 00:00:00.000000 poetry_plugin_package_info-0.2.3/PKG-INFO
 -rw-r--r--   0        0        0     2684 1970-01-01 00:00:00.000000 poetry_plugin_package_info/package_info.py
```

### poetry_plugin_package_info/package_info.py

```diff
@@ -1,15 +1,15 @@
-"""Auto-generated by poetry-plugin-package-info at 2023-06-23T01:39:02."""
+"""Auto-generated by poetry-plugin-package-info at 2023-07-01T23:09:09."""
 import datetime
 
 
 class PackageInfo:
     project_name: str | None = "poetry-plugin-package-info"
     project_description: str | None = "Plugin for poetry that creates/updates an package_info.py file with various details about the project/package."
-    project_version: str | None = "0.2.2"
+    project_version: str | None = "0.2.3"
     project_authors: list[str] | None = ["Ben Ellis <ben.ellis@softweyr.co.uk>"]
     project_license: str | None = "MIT"
     project_classifiers: list[str] | None = [
         "Intended Audience :: Developers",
         "Intended Audience :: Information Technology",
         "Intended Audience :: System Administrators",
         "Operating System :: OS Independent",
@@ -36,21 +36,21 @@
     )
     project_repository: str | None = None
     project_homepage: str | None = (
         "https://github.com/bellis/poetry-plugin-package-info"
     )
     project_maintainers: list[str] | None = None
     project_keywords: list[str] | None = None
-    git_commit_id: str | None = "46c7b01b4923ffcba5a0f4d25a371b1914498c4c"
+    git_commit_id: str | None = "d3362e4ffb3810f1cadbde635017655ac138cdab"
     git_commit_author_name: str | None = "Ben Ellis"
     git_commit_author_email: str | None = "ben.ellis@softweyr.co.uk"
     git_commit_timestamp: datetime.datetime | None = datetime.datetime.fromisoformat(
-        "2023-06-23T02:37:11+01:00"
+        "2023-07-02T00:06:41+01:00"
     )
     git_branch_name: str | None = None
     git_branch_path: str | None = None
-    git_tags: list[str] | None = ["v0.2.2"]
+    git_tags: list[str] | None = ["v0.2.3"]
     git_is_dirty: bool | None = False
     git_is_dirty_excluding_untracked: bool | None = False
     git_has_staged_changes: bool | None = False
     git_has_unstaged_changes: bool | None = False
     git_has_untracked_changes: bool | None = False
```

### Comparing `poetry_plugin_package_info-0.2.2/LICENSE` & `poetry_plugin_package_info-0.2.3/LICENSE`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/README.md` & `poetry_plugin_package_info-0.2.3/README.md`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/__init__.py` & `poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/__init__.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/_zipfile.py` & `poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/_zipfile.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/formatters/__init__.py` & `poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/formatters/__init__.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/formatters/black.py` & `poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/formatters/black.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/generators/__init__.py` & `poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/generators/__init__.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/generators/git.py` & `poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/generators/git.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/generators/project.py` & `poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/generators/project.py`

 * *Files identical despite different names*

### Comparing `poetry_plugin_package_info-0.2.2/poetry_plugin_package_info/plugin.py` & `poetry_plugin_package_info-0.2.3/poetry_plugin_package_info/plugin.py`

 * *Files 3% similar despite different names*

```diff
@@ -46,17 +46,19 @@
 from cleo.events.event_dispatcher import EventDispatcher
 from cleo.io.io import IO
 from colorama import Fore
 from jinja2 import Environment, Template
 from poetry.console.application import Application
 from poetry.console.commands.build import BuildCommand
 from poetry.core.masonry.builder import Builder
+from poetry.core.masonry.builders.builder import Builder as BaseBuilder
 from poetry.core.masonry.builders.sdist import SdistBuilder
 from poetry.core.masonry.builders.wheel import WheelBuilder
 from poetry.core.masonry.utils.helpers import distribution_name
+from poetry.core.masonry.utils.package_include import PackageInclude
 from poetry.plugins.application_plugin import ApplicationPlugin
 from tomlkit.container import Container, OutOfOrderTableProxy
 from tomlkit.items import AbstractTable, Array, InlineTable
 
 from poetry_plugin_package_info import _zipfile
 
 
@@ -248,18 +250,18 @@
         try:
             return self._plugin.generate_package_info(self.io)
         except Exception as e:
             self.io.write_error_line(
                 f"""\
 [{Fore.BLUE}poetry-plugin-package-info{Fore.RESET}]: \
 {Fore.RED}Error encountered while generating package_info file\
- - {e} \
-{Fore.RESET}\
-""",
+ """,
             )
+            traceback.print_exception(e, file=self.io)
+            self.io.write_error_line(f"{Fore.RESET}")
             raise
 
 
 class ContainerWrapper:
     """
     A wrapper for TOML Container.
 
@@ -491,24 +493,24 @@
         Generate a package_info.py file.
 
         Generate a package_info.py file based on the configuration provided.
         :param _: The IO channel to log console messages to.
         :return: A status code indicating success(0) or failure (non-zero)
         """
         self.initialise()
-        with Path(self.package_info_absolute_file_path).open(
+        with self.package_info_absolute_file_path.open(
             "w",
         ) as package_info_file_stream:
             self.write_package_info_py(package_info_file_stream)
 
         out.write_line(
             f"""\
 [{Fore.BLUE}poetry-plugin-package-info{Fore.RESET}]: \
 Generated file {Fore.GREEN}{
-        Path(self.package_info_absolute_file_path).relative_to(self.pyproject_file_dir)
+        self.package_info_absolute_file_path.relative_to(self.pyproject_file_dir)
         }{Fore.RESET}\
 """,
         )
 
         return 0
 
     def parse_include_property_configs(
@@ -621,23 +623,23 @@
         )
         if isinstance(self.patch_build_formats, str):
             if not self.patch_build_formats:
                 self.patch_build_formats = []
             else:
                 self.patch_build_formats = [self.patch_build_formats]
 
-        self.package_info_relative_file_path = (
+        self.package_info_relative_file_path = Path(
             self.plugin_config.get_or_default(
                 "package-info-file-path",
                 f"{self.default_src_directory}/package_info.py",
-            )
+            ),
         )
 
-        self.package_info_absolute_file_path = (
-            self.pyproject_file_dir / self.package_info_relative_file_path
+        self.package_info_absolute_file_path = Path(
+            self.pyproject_file_dir / self.package_info_relative_file_path,
         )
 
         # PEP-8 specifies 79 as recommended.
         self.formatter = self.load_formatter(
             self.plugin_config.get_or_default(
                 "formatter",
                 "poetry_plugin_package_info.formatters.black:BlackContentFormatter",
@@ -752,41 +754,74 @@
         if fmt in builder._formats:  # noqa: SLF001
             return [builder._formats[fmt]]  # noqa: SLF001
         if fmt == "all":
             return list(builder._formats.values())  # noqa: SLF001
 
         raise ValueError(f"Unsupported format: {fmt}")  # noqa: TRY003
 
+    def _determine_package_info_path(
+        self,
+        builder_instance: BaseBuilder,
+    ) -> Path:
+        for include in builder_instance._module.includes:  # noqa: SLF001
+            include.refresh()
+
+            if (
+                isinstance(include, PackageInclude)
+                and include.source
+                and builder_instance.format == "wheel"
+            ):
+                source_root = include.base
+            else:
+                source_root = builder_instance._path  # noqa: SLF001
+
+            if source_root in self.package_info_absolute_file_path.parents:
+                result = self.package_info_absolute_file_path.relative_to(
+                    source_root,
+                )
+                if not builder_instance.is_excluded(result):
+                    return result
+
+        return self.package_info_relative_file_path
+
     def handle_builder_type(
         self: "PackageInfoApplicationPlugin",
         builder_type: type[Builder],
         out: IO,
     ) -> None:
         """Handle and processing for the given builder type."""
         format_all = "all" in self.patch_build_formats
         if issubclass(builder_type, WheelBuilder) and (
             builder_type.format in self.patch_build_formats or format_all
         ):
             builder_instance = builder_type(self.application.poetry)
+            package_info_file_dist_path = self._determine_package_info_path(
+                builder_instance,
+            )
             self.update_wheel(
                 Path(builder_instance.default_target_dir)
                 / builder_instance.wheel_filename,
+                package_info_file_dist_path,
                 out,
             )
         elif issubclass(builder_type, SdistBuilder) and (
             builder_type.format in self.patch_build_formats or format_all
         ):
             builder_instance = builder_type(self.application.poetry)
             dist_name = distribution_name(
                 self.application.poetry.package.name,
             )
             version = builder_instance._meta.version  # noqa: SLF001
             tar_file_name = f"{dist_name!s}-{version}.tar.gz"
+            package_info_file_dist_path = self._determine_package_info_path(
+                builder_instance,
+            )
             self.update_sdist(
                 builder_instance.default_target_dir / tar_file_name,
+                package_info_file_dist_path,
                 out,
             )
         elif format_all:
             distro_format = builder_type.format  # type: ignore[attr-defined]
             out.write_line(
                 f"""\
 [{Fore.BLUE}poetry-plugin-package-info{Fore.RESET}]: \
@@ -856,50 +891,54 @@
             traceback.print_exception(e, file=out)
             out.write_error_line(f"{Fore.RESET}")
             raise
 
     def update_wheel(
         self: "PackageInfoApplicationPlugin",
         wheel_file: Path,
+        package_info_file_dist_path: Path,
         out: IO,
     ) -> None:
         """Update the wheel distribution with the package_info.py file."""
         with io.StringIO() as package_info_py_stream:
             self.write_package_info_py(package_info_py_stream)
             data = package_info_py_stream.getvalue()
 
         out.write_line(
             f"""\
 [{Fore.BLUE}poetry-plugin-package-info{Fore.RESET}]: Patching {Fore.GREEN}\
 {wheel_file.relative_to(self.pyproject_file_dir)!s}{Fore.RESET} with \
-{Fore.GREEN}{self.package_info_relative_file_path}{Fore.RESET}\
+{Fore.GREEN}{package_info_file_dist_path}{Fore.RESET}\
 """,
         )
 
         distribution = distribution_name(self.application.poetry.package.name)
         version = self.application.poetry.package.version
         dist_info_path = f"{distribution}-{version}.dist-info"
         record_file_path = f"{dist_info_path}/RECORD"
 
+        remove_existing_package_info = False
         with _zipfile.ZipFile(
             str(wheel_file),
             mode="r",
             compression=_zipfile.ZIP_DEFLATED,
         ) as zip_file:
             record_file_contents = zip_file.read(
                 record_file_path,
             ).decode("utf8")
+            if str(package_info_file_dist_path) in zip_file.filelist:
+                remove_existing_package_info = True
 
         digest = hashlib.sha256(data.encode("utf8")).digest()
         data_hash = (
             base64.urlsafe_b64encode(digest).rstrip(b"=").decode("utf8")
         )
         record_entry = ",".join(
             (
-                str(self.package_info_relative_file_path),
+                str(package_info_file_dist_path),
                 "sha256=" + data_hash,
                 str(len(data)),
             ),
         )
 
         record_entries = record_file_contents.splitlines()
         record_entries.append(record_entry)
@@ -921,39 +960,42 @@
 
         with _zipfile.ZipFile(
             str(wheel_file),
             mode="a",
             compression=_zipfile.ZIP_DEFLATED,
         ) as zip_file:
             zip_file.remove(record_file_path)
-            zip_file.writestr(str(self.package_info_relative_file_path), data)
+            if remove_existing_package_info:
+                zip_file.remove(str(package_info_file_dist_path))
+            zip_file.writestr(str(package_info_file_dist_path), data)
             zip_file.writestr(record_file_path, new_record_file_contents)
 
     def update_sdist(
         self: "PackageInfoApplicationPlugin",
         tar_gz_file: Path,
+        package_info_file_dist_path: Path,
         out: IO,
     ) -> None:
         """Update the wheel distribution with the package_info.py file."""
         with io.StringIO() as package_info_py_stream:
             self.write_package_info_py(package_info_py_stream)
             data = package_info_py_stream.getvalue()
 
         out.write_line(
             f"""\
 [{Fore.BLUE}poetry-plugin-package-info{Fore.RESET}]: Patching \
 {Fore.GREEN}{tar_gz_file.relative_to(self.pyproject_file_dir)!s}\
-{Fore.RESET} with {Fore.GREEN}{self.package_info_relative_file_path}\
+{Fore.RESET} with {Fore.GREEN}{package_info_file_dist_path}\
 {Fore.RESET}\
         """,
         )
 
         append_tar_file(
             data.encode("utf-8"),
-            str(self.package_info_relative_file_path),
+            str(package_info_file_dist_path),
             tar_gz_file,
         )
 
 
 def append_tar_file(
     data_bytes: bytes,
     file_name: str,
```

### Comparing `poetry_plugin_package_info-0.2.2/pyproject.toml` & `poetry_plugin_package_info-0.2.3/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 [tool.poetry]
 name = "poetry-plugin-package-info"
-version = "0.2.2"
+version = "0.2.3"
 description = "Plugin for poetry that creates/updates an package_info.py file with various details about the project/package."
 authors = ["Ben Ellis <ben.ellis@softweyr.co.uk>"]
 license = "MIT"
 readme = "README.md"
-packages = [{include = "poetry_plugin_package_info"}]
+packages = [{ include = "poetry_plugin_package_info" }]
 homepage = "https://github.com/bellis/poetry-plugin-package-info"
 documentation = "https://github.com/bellis/poetry-plugin-package-info"
 classifiers = [
     "Intended Audience :: Developers",
     "Intended Audience :: Information Technology",
     "Intended Audience :: System Administrators",
     "Operating System :: OS Independent",
@@ -28,17 +28,14 @@
     "Programming Language :: Python :: 3.7",
     "Programming Language :: Python :: 3.8",
     "Programming Language :: Python :: 3.9",
     "Programming Language :: Python :: 3.10",
     "License :: OSI Approved :: MIT License"
 ]
 
-[project]
-dependencies = [ 'poetry >= 1.2', 'mypy == 1.3.0' ]
-
 [tool.poetry.dependencies]
 python = "^3.7"
 poetry = "^1.2"
 gitpython = "^3.1.31"
 black = "^23.3.0"
 jinja2 = "^3.1.2"
 colorama = "^0.4.6"
@@ -102,15 +99,15 @@
 include_namespace_packages = "true"
 exclude_lines = [ 'pragma: no cover', 'raise NotImplementedError', 'if TYPE_CHECKING:', 'if typing.TYPE_CHECKING:', '@overload', '@typing.overload' ]
 
 [tool.ruff]
 line-length = 79
 extend-select = ['W', 'D', 'Q', 'A', 'S', 'B', 'ANN', 'RUF', 'C90', 'UP', 'I', 'N', 'SLF', 'RSE', 'RET', 'T20', 'ARG', 'C4', 'COM', 'DTZ', 'ISC', 'BLE', 'FBT', 'ICN', 'G', 'INP', 'PIE', 'PYI', 'PT', 'SIM', 'TID', 'TCH', 'INT', 'PTH', 'ERA', 'PD', 'PGH', 'PLC', 'PLE', 'PLR', 'PLW', 'TRY', 'NPY']
 pydocstyle.convention = "google"
-ignore = ['PYI014', 'PYI015', 'Q000', 'Q001', 'Q002', 'D211', 'D212', 'ANN401', 'S701']
+ignore = ['PYI014', 'PYI015', 'Q000', 'Q001', 'Q002', 'D211', 'D212', 'ANN401', 'S701', 'ANN101']
 flake8-quotes = {inline-quotes = 'single', multiline-quotes = 'double'}
 mccabe = { max-complexity = 10 }
 isort = { known-first-party = ['poetry_plugin_package_info', 'tests'] }
 target-version = "py310"
 exclude = [
     ".bzr",
     ".direnv",
```

### Comparing `poetry_plugin_package_info-0.2.2/PKG-INFO` & `poetry_plugin_package_info-0.2.3/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: poetry-plugin-package-info
-Version: 0.2.2
+Version: 0.2.3
 Summary: Plugin for poetry that creates/updates an package_info.py file with various details about the project/package.
 Home-page: https://github.com/bellis/poetry-plugin-package-info
 License: MIT
 Author: Ben Ellis
 Author-email: ben.ellis@softweyr.co.uk
 Requires-Python: >=3.7,<4.0
 Classifier: Development Status :: 3 - Alpha
```

