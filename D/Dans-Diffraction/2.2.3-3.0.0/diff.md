# Comparing `tmp/Dans_Diffraction-2.2.3.tar.gz` & `tmp/Dans_Diffraction-3.0.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist\Dans_Diffraction-2.2.3.tar", last modified: Sun Mar 12 13:42:36 2023, max compression
+gzip compressed data, was "dist\Dans_Diffraction-3.0.0.tar", last modified: Sun Jul  2 16:47:16 2023, max compression
```

## Comparing `Dans_Diffraction-2.2.3.tar` & `Dans_Diffraction-3.0.0.tar`

### file list

```diff
@@ -1,124 +1,130 @@
-drwxrwxrwx   0        0        0        0 2023-03-12 13:42:36.000000 Dans_Diffraction-2.2.3/
-drwxrwxrwx   0        0        0        0 2023-03-12 13:42:34.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/
-drwxrwxrwx   0        0        0        0 2023-03-12 13:42:34.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/
--rw-rw-rw-   0        0        0     4217 2016-08-03 08:31:31.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Aluminium.cif
--rw-rw-rw-   0        0        0     2503 2017-07-31 08:37:44.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/BCC.cif
--rw-rw-rw-   0        0        0     1188 2015-08-03 13:46:33.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Beryllium.cif
--rw-rw-rw-   0        0        0     2250 2018-03-01 19:54:35.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Ca2RuO4.cif
--rw-rw-rw-   0        0        0     3878 2016-11-10 08:23:42.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Ca3CoMnO6.mcif
--rw-rw-rw-   0        0        0     1226 2017-07-31 09:00:59.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Cobalt.cif
--rw-rw-rw-   0        0        0     4214 2015-08-03 13:23:49.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Copper.cif
--rw-rw-rw-   0        0        0     1671 2016-09-15 10:40:04.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Cubic.cif
--rw-rw-rw-   0        0        0     4714 2016-12-06 14:03:28.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Diamond.cif
--rw-rw-rw-   0        0        0     4214 2015-08-03 13:23:49.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/FCC.cif
--rw-rw-rw-   0        0        0     4212 2018-02-14 08:14:18.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Gold.cif
--rw-rw-rw-   0        0        0     2243 2017-04-12 13:11:25.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Graphite.cif
--rw-rw-rw-   0        0        0     1226 2017-07-31 09:00:59.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/HCP.cif
--rw-rw-rw-   0        0        0     2503 2017-07-31 08:37:44.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Iron.cif
--rw-rw-rw-   0        0        0     4325 2017-07-09 15:12:00.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/KCl.cif
--rw-rw-rw-   0        0        0     3082 2020-04-17 07:58:01.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/LaMnO3.mcif
--rw-rw-rw-   0        0        0     1987 2016-05-31 12:37:29.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/LiCoO2.cif
--rw-rw-rw-   0        0        0     2067 2015-05-15 09:42:35.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Na0.8CoO2_P63mmc.cif
--rw-rw-rw-   0        0        0     2507 2016-08-03 08:28:38.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Niobium.cif
--rw-rw-rw-   0        0        0     1901 2016-12-06 14:29:29.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Ruby.cif
--rw-rw-rw-   0        0        0     1191 2016-03-07 11:53:11.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Ruthenium.cif
--rw-rw-rw-   0        0        0     1927 2019-05-03 14:32:02.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Sapphire.cif
--rw-rw-rw-   0        0        0     4739 2015-08-04 14:43:40.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Silicon.cif
--rw-rw-rw-   0        0        0     4315 2017-09-05 12:52:37.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Silver.cif
--rw-rw-rw-   0        0        0    83448 2020-03-26 10:12:50.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Sr3LiRuO6.cif
--rw-rw-rw-   0        0        0     4568 2020-02-24 07:33:16.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Sr3LiRuO6_C2'c'.mcif
--rw-rw-rw-   0        0        0     2532 2019-04-03 13:35:10.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Vanadium.cif
--rw-rw-rw-   0        0        0     2468 2020-02-17 08:59:33.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/ZnO.cif
--rw-rw-rw-   0        0        0     6461 2023-01-14 17:01:26.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/__init__.py
--rw-rw-rw-   0        0        0      970 2020-05-12 14:22:52.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/__main__.py
--rw-rw-rw-   0        0        0    89473 2023-01-06 13:55:56.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_crystal.py
--rw-rw-rw-   0        0        0    52076 2021-12-15 15:33:14.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_fdmnes.py
--rw-rw-rw-   0        0        0     9899 2022-07-23 11:12:54.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_multicrystal.py
--rw-rw-rw-   0        0        0    17089 2020-10-19 07:41:46.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_orbitals.py
--rw-rw-rw-   0        0        0    10482 2023-01-06 13:55:56.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_orientation.py
--rw-rw-rw-   0        0        0    84147 2022-03-11 16:54:13.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_plotting.py
--rw-rw-rw-   0        0        0    26682 2022-01-13 13:51:21.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_properties.py
--rw-rw-rw-   0        0        0   114068 2023-01-14 17:01:26.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_scattering.py
--rw-rw-rw-   0        0        0     2203 2019-08-07 06:59:10.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/classes_structures.py
-drwxrwxrwx   0        0        0        0 2023-03-12 13:42:35.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/
--rw-rw-rw-   0        0        0    54010 2020-05-02 16:39:54.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/Dans Element Properties.txt
--rw-rw-rw-   0        0        0    43658 2019-12-13 07:38:09.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/Dans Element Properties_old.txt
--rw-rw-rw-   0        0        0     4719 2019-07-31 18:31:45.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/Element_OxidationStates.txt
--rw-rw-rw-   0        0        0    58645 2021-03-31 11:01:14.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/PointGroups.json
--rw-rw-rw-   0        0        0   997216 2020-04-22 21:04:44.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/SpaceGroups.json
--rw-rw-rw-   0        0        0  8319520 2020-05-26 14:42:44.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/SpaceGroupsMagnetic.json
--rw-rw-rw-   0        0        0    30113 2016-12-01 11:30:15.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/XRayEdges.dat
--rw-rw-rw-   0        0        0  2779670 2020-05-06 09:22:05.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/XRayMassAtten_muenp.dat
--rw-rw-rw-   0        0        0  2779670 2020-05-06 09:22:05.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/XRayMassAtten_mup.dat
--rw-rw-rw-   0        0        0  1317778 2021-01-21 09:28:34.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/atomic_scattering_factors.npy
--rw-rw-rw-   0        0        0    43385 2021-06-08 07:44:54.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/data/f0_WaasKirf.dat
--rw-rw-rw-   0        0        0   117867 2023-01-06 14:04:42.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/functions_crystallography.py
--rw-rw-rw-   0        0        0    41475 2023-01-06 13:55:56.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/functions_general.py
--rw-rw-rw-   0        0        0    32263 2023-01-06 13:55:56.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/functions_plotting.py
--rw-rw-rw-   0        0        0    44292 2023-01-06 14:04:42.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/functions_scattering.py
--rw-rw-rw-   0        0        0    27095 2020-10-15 13:27:33.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/multiple_scattering.py
--rw-rw-rw-   0        0        0   192479 2023-01-06 14:04:42.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tensor_scattering.py
-drwxrwxrwx   0        0        0        0 2023-03-12 13:42:35.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/
--rw-rw-rw-   0        0        0     1036 2021-01-26 09:40:09.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/__init__.py
--rw-rw-rw-   0        0        0     9274 2022-10-26 04:34:26.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/basic_widgets.py
--rw-rw-rw-   0        0        0    40925 2021-01-26 08:25:01.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/crystal.py
--rw-rw-rw-   0        0        0    22665 2020-04-16 11:07:47.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/fdmnes.py
--rw-rw-rw-   0        0        0    10161 2022-07-23 11:12:54.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/multi_crystal.py
--rw-rw-rw-   0        0        0     7170 2019-12-16 07:45:56.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/multiple_scattering.py
--rw-rw-rw-   0        0        0    21087 2021-01-26 12:09:22.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/properties.py
--rw-rw-rw-   0        0        0    25125 2021-01-21 10:44:02.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/scattering.py
--rw-rw-rw-   0        0        0    13686 2020-02-20 13:50:35.000000 Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/tensor_scattering.py
-drwxrwxrwx   0        0        0        0 2023-03-12 13:42:34.000000 Dans_Diffraction-2.2.3/Dans_Diffraction.egg-info/
--rw-rw-rw-   0        0        0    14012 2023-03-12 13:42:33.000000 Dans_Diffraction-2.2.3/Dans_Diffraction.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0     4070 2023-03-12 13:42:33.000000 Dans_Diffraction-2.2.3/Dans_Diffraction.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-03-12 13:42:33.000000 Dans_Diffraction-2.2.3/Dans_Diffraction.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       17 2023-03-12 13:42:33.000000 Dans_Diffraction-2.2.3/Dans_Diffraction.egg-info/requires.txt
--rw-rw-rw-   0        0        0       17 2023-03-12 13:42:33.000000 Dans_Diffraction-2.2.3/Dans_Diffraction.egg-info/top_level.txt
--rw-rw-rw-   0        0        0    14012 2023-03-12 13:42:36.000000 Dans_Diffraction-2.2.3/PKG-INFO
--rw-rw-rw-   0        0        0    11026 2022-03-14 11:50:38.000000 Dans_Diffraction-2.2.3/README.md
--rw-rw-rw-   0        0        0       42 2023-03-12 13:42:36.000000 Dans_Diffraction-2.2.3/setup.cfg
--rw-rw-rw-   0        0        0     1236 2023-03-01 20:47:52.000000 Dans_Diffraction-2.2.3/setup.py
-drwxrwxrwx   0        0        0        0 2023-03-12 13:42:36.000000 Dans_Diffraction-2.2.3/test/
--rw-rw-rw-   0        0        0     2282 2018-02-13 15:38:28.000000 Dans_Diffraction-2.2.3/test/test_LS_magnetic_components.py
--rw-rw-rw-   0        0        0     8939 2021-06-10 16:58:04.000000 Dans_Diffraction-2.2.3/test/test_WaasKirf_xray_factors.py
--rw-rw-rw-   0        0        0     2197 2020-04-30 13:31:49.000000 Dans_Diffraction-2.2.3/test/test_atom_properties.py
--rw-rw-rw-   0        0        0     1170 2020-05-06 08:27:47.000000 Dans_Diffraction-2.2.3/test/test_attenuation.py
--rw-rw-rw-   0        0        0     1910 2021-01-25 17:53:20.000000 Dans_Diffraction-2.2.3/test/test_attenuation_length.py
--rw-rw-rw-   0        0        0     2002 2020-11-12 13:20:39.000000 Dans_Diffraction-2.2.3/test/test_bmatrix.py
--rw-rw-rw-   0        0        0     1562 2020-10-19 07:41:46.000000 Dans_Diffraction-2.2.3/test/test_cif_files.py
--rw-rw-rw-   0        0        0     6312 2021-07-19 15:51:46.000000 Dans_Diffraction-2.2.3/test/test_coherent_diffraction.py
--rw-rw-rw-   0        0        0     3230 2021-07-17 05:26:09.000000 Dans_Diffraction-2.2.3/test/test_coherent_diffraction2.py
--rw-rw-rw-   0        0        0     1859 2019-12-12 20:20:59.000000 Dans_Diffraction-2.2.3/test/test_compare_intensity.py
--rw-rw-rw-   0        0        0     8480 2020-10-26 14:50:52.000000 Dans_Diffraction-2.2.3/test/test_compare_intensity_calculation.py
--rw-rw-rw-   0        0        0     4552 2020-05-12 07:18:31.000000 Dans_Diffraction-2.2.3/test/test_compound_name.py
--rw-rw-rw-   0        0        0     2740 2022-03-11 16:54:13.000000 Dans_Diffraction-2.2.3/test/test_convolve2d.py
--rw-rw-rw-   0        0        0      289 2020-10-20 19:46:18.000000 Dans_Diffraction-2.2.3/test/test_detector.py
--rw-rw-rw-   0        0        0     2902 2020-05-15 15:03:16.000000 Dans_Diffraction-2.2.3/test/test_electron_density.py
--rw-rw-rw-   0        0        0     5008 2020-10-19 07:41:46.000000 Dans_Diffraction-2.2.3/test/test_exchange_path.py
--rw-rw-rw-   0        0        0     4144 2020-10-19 07:41:46.000000 Dans_Diffraction-2.2.3/test/test_exchange_path2.py
--rw-rw-rw-   0        0        0      149 2018-06-08 14:18:49.000000 Dans_Diffraction-2.2.3/test/test_files.py
--rw-rw-rw-   0        0        0     5627 2021-07-15 05:41:12.000000 Dans_Diffraction-2.2.3/test/test_functions_scattering.py
--rw-rw-rw-   0        0        0     1152 2021-07-15 16:03:30.000000 Dans_Diffraction-2.2.3/test/test_functions_scattering_dispersion.py
--rw-rw-rw-   0        0        0     3320 2021-07-14 17:11:38.000000 Dans_Diffraction-2.2.3/test/test_functions_scattering_new.py
--rw-rw-rw-   0        0        0     4726 2021-07-13 13:13:30.000000 Dans_Diffraction-2.2.3/test/test_functions_scattering_pol.py
--rw-rw-rw-   0        0        0     3102 2021-07-13 14:17:38.000000 Dans_Diffraction-2.2.3/test/test_functions_scattering_xrm.py
--rw-rw-rw-   0        0        0     1691 2020-03-27 07:59:19.000000 Dans_Diffraction-2.2.3/test/test_gaussian.py
--rw-rw-rw-   0        0        0    17556 2020-06-09 08:44:11.000000 Dans_Diffraction-2.2.3/test/test_gen_sym_mat.py
--rw-rw-rw-   0        0        0      256 2020-03-31 13:19:32.000000 Dans_Diffraction-2.2.3/test/test_gui_multicrystal.py
--rw-rw-rw-   0        0        0     3193 2020-11-22 19:46:51.000000 Dans_Diffraction-2.2.3/test/test_i16_azimuth.py
--rw-rw-rw-   0        0        0      552 2020-03-27 16:10:17.000000 Dans_Diffraction-2.2.3/test/test_intensity_grid.py
--rw-rw-rw-   0        0        0     1196 2020-03-27 08:15:40.000000 Dans_Diffraction-2.2.3/test/test_isincell.py
--rw-rw-rw-   0        0        0     2536 2021-10-04 20:22:07.000000 Dans_Diffraction-2.2.3/test/test_laue_backscatter.py
--rw-rw-rw-   0        0        0     3864 2019-02-22 16:52:35.000000 Dans_Diffraction-2.2.3/test/test_nonresonant.py
--rw-rw-rw-   0        0        0     5702 2019-01-21 13:30:00.000000 Dans_Diffraction-2.2.3/test/test_nonresonant_plot.py
--rw-rw-rw-   0        0        0     3092 2019-01-21 13:25:46.000000 Dans_Diffraction-2.2.3/test/test_nonresonant_sergio.py
--rw-rw-rw-   0        0        0      453 2021-09-26 16:50:06.000000 Dans_Diffraction-2.2.3/test/test_orientation.py
--rw-rw-rw-   0        0        0     1044 2017-11-26 15:52:58.000000 Dans_Diffraction-2.2.3/test/test_parameter_plot.py
--rw-rw-rw-   0        0        0     4428 2020-11-22 20:40:03.000000 Dans_Diffraction-2.2.3/test/test_plot_orbitals.py
--rw-rw-rw-   0        0        0     1956 2017-08-22 12:09:50.000000 Dans_Diffraction-2.2.3/test/test_plotintensity.py
--rw-rw-rw-   0        0        0     2890 2017-08-22 15:29:48.000000 Dans_Diffraction-2.2.3/test/test_plotintensity2.py
--rw-rw-rw-   0        0        0     2593 2020-05-05 08:27:58.000000 Dans_Diffraction-2.2.3/test/test_readstfm.py
--rw-rw-rw-   0        0        0      988 2021-01-26 07:46:04.000000 Dans_Diffraction-2.2.3/test/test_refractive_index.py
--rw-rw-rw-   0        0        0     1843 2017-10-30 14:29:08.000000 Dans_Diffraction-2.2.3/test/test_scattering.py
--rw-rw-rw-   0        0        0     2649 2017-11-09 11:24:34.000000 Dans_Diffraction-2.2.3/test/test_supercell.py
--rw-rw-rw-   0        0        0     9400 2020-06-09 13:06:44.000000 Dans_Diffraction-2.2.3/test/test_symmetry_ops2magnetic.py
+drwxrwxrwx   0        0        0        0 2023-07-02 16:47:16.000000 Dans_Diffraction-3.0.0/
+drwxrwxrwx   0        0        0        0 2023-07-02 16:47:15.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/
+drwxrwxrwx   0        0        0        0 2023-07-02 16:47:15.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/
+-rw-rw-rw-   0        0        0     4217 2016-08-03 08:31:31.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Aluminium.cif
+-rw-rw-rw-   0        0        0     2503 2017-07-31 08:37:44.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/BCC.cif
+-rw-rw-rw-   0        0        0     1188 2015-08-03 13:46:33.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Beryllium.cif
+-rw-rw-rw-   0        0        0     2250 2018-03-01 19:54:35.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Ca2RuO4.cif
+-rw-rw-rw-   0        0        0     3878 2016-11-10 08:23:42.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Ca3CoMnO6.mcif
+-rw-rw-rw-   0        0        0     1226 2017-07-31 09:00:59.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Cobalt.cif
+-rw-rw-rw-   0        0        0     4214 2015-08-03 13:23:49.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Copper.cif
+-rw-rw-rw-   0        0        0     1671 2016-09-15 10:40:04.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Cubic.cif
+-rw-rw-rw-   0        0        0     4714 2016-12-06 14:03:28.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Diamond.cif
+-rw-rw-rw-   0        0        0     4214 2015-08-03 13:23:49.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/FCC.cif
+-rw-rw-rw-   0        0        0     4212 2018-02-14 08:14:18.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Gold.cif
+-rw-rw-rw-   0        0        0     2243 2017-04-12 13:11:25.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Graphite.cif
+-rw-rw-rw-   0        0        0     1226 2017-07-31 09:00:59.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/HCP.cif
+-rw-rw-rw-   0        0        0     2503 2017-07-31 08:37:44.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Iron.cif
+-rw-rw-rw-   0        0        0     4325 2017-07-09 15:12:00.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/KCl.cif
+-rw-rw-rw-   0        0        0     3082 2020-04-17 07:58:01.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/LaMnO3.mcif
+-rw-rw-rw-   0        0        0     1987 2016-05-31 12:37:29.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/LiCoO2.cif
+-rw-rw-rw-   0        0        0     2067 2015-05-15 09:42:35.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Na0.8CoO2_P63mmc.cif
+-rw-rw-rw-   0        0        0    17159 2023-05-08 11:29:37.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/NaCoO2_stripe_supercell.cif
+-rw-rw-rw-   0        0        0     2507 2016-08-03 08:28:38.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Niobium.cif
+-rw-rw-rw-   0        0        0     1901 2016-12-06 14:29:29.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Ruby.cif
+-rw-rw-rw-   0        0        0     1191 2016-03-07 11:53:11.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Ruthenium.cif
+-rw-rw-rw-   0        0        0     1927 2019-05-03 14:32:02.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Sapphire.cif
+-rw-rw-rw-   0        0        0     4739 2015-08-04 14:43:40.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Silicon.cif
+-rw-rw-rw-   0        0        0     4315 2017-09-05 12:52:37.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Silver.cif
+-rw-rw-rw-   0        0        0    83448 2020-03-26 10:12:50.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Sr3LiRuO6.cif
+-rw-rw-rw-   0        0        0     4568 2020-02-24 07:33:16.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Sr3LiRuO6_C2'c'.mcif
+-rw-rw-rw-   0        0        0     2532 2019-04-03 13:35:10.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Vanadium.cif
+-rw-rw-rw-   0        0        0     2468 2020-02-17 08:59:33.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/ZnO.cif
+-rw-rw-rw-   0        0        0     7917 2023-07-02 13:33:07.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/__init__.py
+-rw-rw-rw-   0        0        0     1101 2023-04-26 10:54:53.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/__main__.py
+-rw-rw-rw-   0        0        0    92544 2023-06-29 05:23:06.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_crystal.py
+-rw-rw-rw-   0        0        0    52076 2021-12-15 15:33:14.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_fdmnes.py
+-rw-rw-rw-   0        0        0     9899 2022-07-23 11:12:54.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_multicrystal.py
+-rw-rw-rw-   0        0        0    17089 2020-10-19 07:41:46.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_orbitals.py
+-rw-rw-rw-   0        0        0    10482 2023-01-06 13:55:56.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_orientation.py
+-rw-rw-rw-   0        0        0    84117 2023-07-02 14:53:03.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_plotting.py
+-rw-rw-rw-   0        0        0    26560 2023-05-18 07:40:06.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_properties.py
+-rw-rw-rw-   0        0        0   125734 2023-07-02 14:56:25.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_scattering.py
+-rw-rw-rw-   0        0        0     2203 2019-08-07 06:59:10.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/classes_structures.py
+drwxrwxrwx   0        0        0        0 2023-07-02 16:47:15.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/
+-rw-rw-rw-   0        0        0    54010 2020-05-02 16:39:54.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/Dans Element Properties.txt
+-rw-rw-rw-   0        0        0    43658 2019-12-13 07:38:09.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/Dans Element Properties_old.txt
+-rw-rw-rw-   0        0        0     4719 2019-07-31 18:31:45.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/Element_OxidationStates.txt
+-rw-rw-rw-   0        0        0    58645 2021-03-31 11:01:14.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/PointGroups.json
+-rw-rw-rw-   0        0        0   997216 2020-04-22 21:04:44.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/SpaceGroups.json
+-rw-rw-rw-   0        0        0  8319520 2020-05-26 14:42:44.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/SpaceGroupsMagnetic.json
+-rw-rw-rw-   0        0        0    30113 2016-12-01 11:30:15.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/XRayEdges.dat
+-rw-rw-rw-   0        0        0  2779670 2020-05-06 09:22:05.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/XRayMassAtten_muenp.dat
+-rw-rw-rw-   0        0        0  2779670 2020-05-06 09:22:05.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/XRayMassAtten_mup.dat
+-rw-rw-rw-   0        0        0  1317778 2021-01-21 09:28:34.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/atomic_scattering_factors.npy
+-rw-rw-rw-   0        0        0    43385 2021-06-08 07:44:54.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/f0_WaasKirf.dat
+-rw-rw-rw-   0        0        0    25892 2023-05-06 11:12:54.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/data/peng.dat
+-rw-rw-rw-   0        0        0   137036 2023-07-02 13:21:23.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/functions_crystallography.py
+-rw-rw-rw-   0        0        0    42603 2023-06-02 05:14:41.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/functions_general.py
+-rw-rw-rw-   0        0        0    33113 2023-05-16 17:25:23.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/functions_plotting.py
+-rw-rw-rw-   0        0        0    44417 2023-05-07 14:24:07.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/functions_scattering.py
+-rw-rw-rw-   0        0        0    27095 2020-10-15 13:27:33.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/multiple_scattering.py
+-rw-rw-rw-   0        0        0   192479 2023-01-06 14:04:42.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tensor_scattering.py
+drwxrwxrwx   0        0        0        0 2023-07-02 16:47:15.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/
+-rw-rw-rw-   0        0        0     1256 2023-06-28 07:12:14.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/__init__.py
+-rw-rw-rw-   0        0        0    12198 2023-05-24 05:32:43.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/basic_widgets.py
+-rw-rw-rw-   0        0        0    15559 2023-06-28 10:25:11.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/converter.py
+-rw-rw-rw-   0        0        0    49324 2023-06-28 07:31:38.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/crystal.py
+-rw-rw-rw-   0        0        0    64567 2023-06-29 05:23:06.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/diffractometer.py
+-rw-rw-rw-   0        0        0    22733 2023-05-16 05:57:15.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/fdmnes.py
+-rw-rw-rw-   0        0        0    10161 2022-07-23 11:12:54.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/multi_crystal.py
+-rw-rw-rw-   0        0        0     7170 2019-12-16 07:45:56.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/multiple_scattering.py
+-rw-rw-rw-   0        0        0    10826 2023-05-16 16:30:28.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/periodic_table.py
+-rw-rw-rw-   0        0        0    30256 2023-05-18 07:33:36.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/properties.py
+-rw-rw-rw-   0        0        0    69222 2023-06-25 15:23:07.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/scattering.py
+-rw-rw-rw-   0        0        0    14775 2023-05-22 06:11:38.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/spacegroups.py
+-rw-rw-rw-   0        0        0    13686 2020-02-20 13:50:35.000000 Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/tensor_scattering.py
+drwxrwxrwx   0        0        0        0 2023-07-02 16:47:15.000000 Dans_Diffraction-3.0.0/Dans_Diffraction.egg-info/
+-rw-rw-rw-   0        0        0    16912 2023-07-02 16:47:14.000000 Dans_Diffraction-3.0.0/Dans_Diffraction.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0     4313 2023-07-02 16:47:14.000000 Dans_Diffraction-3.0.0/Dans_Diffraction.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-07-02 16:47:14.000000 Dans_Diffraction-3.0.0/Dans_Diffraction.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       17 2023-07-02 16:47:14.000000 Dans_Diffraction-3.0.0/Dans_Diffraction.egg-info/requires.txt
+-rw-rw-rw-   0        0        0       17 2023-07-02 16:47:14.000000 Dans_Diffraction-3.0.0/Dans_Diffraction.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0    16912 2023-07-02 16:47:16.000000 Dans_Diffraction-3.0.0/PKG-INFO
+-rw-rw-rw-   0        0        0    13629 2023-07-02 13:42:25.000000 Dans_Diffraction-3.0.0/README.md
+-rw-rw-rw-   0        0        0       42 2023-07-02 16:47:16.000000 Dans_Diffraction-3.0.0/setup.cfg
+-rw-rw-rw-   0        0        0     1254 2023-06-25 15:48:08.000000 Dans_Diffraction-3.0.0/setup.py
+drwxrwxrwx   0        0        0        0 2023-07-02 16:47:16.000000 Dans_Diffraction-3.0.0/test/
+-rw-rw-rw-   0        0        0     2282 2018-02-13 15:38:28.000000 Dans_Diffraction-3.0.0/test/test_LS_magnetic_components.py
+-rw-rw-rw-   0        0        0     8939 2021-06-10 16:58:04.000000 Dans_Diffraction-3.0.0/test/test_WaasKirf_xray_factors.py
+-rw-rw-rw-   0        0        0     2197 2020-04-30 13:31:49.000000 Dans_Diffraction-3.0.0/test/test_atom_properties.py
+-rw-rw-rw-   0        0        0     1170 2020-05-06 08:27:47.000000 Dans_Diffraction-3.0.0/test/test_attenuation.py
+-rw-rw-rw-   0        0        0     1910 2021-01-25 17:53:20.000000 Dans_Diffraction-3.0.0/test/test_attenuation_length.py
+-rw-rw-rw-   0        0        0     2002 2020-11-12 13:20:39.000000 Dans_Diffraction-3.0.0/test/test_bmatrix.py
+-rw-rw-rw-   0        0        0     1562 2020-10-19 07:41:46.000000 Dans_Diffraction-3.0.0/test/test_cif_files.py
+-rw-rw-rw-   0        0        0     6312 2021-07-19 15:51:46.000000 Dans_Diffraction-3.0.0/test/test_coherent_diffraction.py
+-rw-rw-rw-   0        0        0     3230 2021-07-17 05:26:09.000000 Dans_Diffraction-3.0.0/test/test_coherent_diffraction2.py
+-rw-rw-rw-   0        0        0     1859 2019-12-12 20:20:59.000000 Dans_Diffraction-3.0.0/test/test_compare_intensity.py
+-rw-rw-rw-   0        0        0     8480 2020-10-26 14:50:52.000000 Dans_Diffraction-3.0.0/test/test_compare_intensity_calculation.py
+-rw-rw-rw-   0        0        0     4552 2020-05-12 07:18:31.000000 Dans_Diffraction-3.0.0/test/test_compound_name.py
+-rw-rw-rw-   0        0        0     2740 2022-03-11 16:54:13.000000 Dans_Diffraction-3.0.0/test/test_convolve2d.py
+-rw-rw-rw-   0        0        0      289 2020-10-20 19:46:18.000000 Dans_Diffraction-3.0.0/test/test_detector.py
+-rw-rw-rw-   0        0        0     2902 2020-05-15 15:03:16.000000 Dans_Diffraction-3.0.0/test/test_electron_density.py
+-rw-rw-rw-   0        0        0     5008 2020-10-19 07:41:46.000000 Dans_Diffraction-3.0.0/test/test_exchange_path.py
+-rw-rw-rw-   0        0        0     4144 2020-10-19 07:41:46.000000 Dans_Diffraction-3.0.0/test/test_exchange_path2.py
+-rw-rw-rw-   0        0        0      149 2018-06-08 14:18:49.000000 Dans_Diffraction-3.0.0/test/test_files.py
+-rw-rw-rw-   0        0        0     5627 2021-07-15 05:41:12.000000 Dans_Diffraction-3.0.0/test/test_functions_scattering.py
+-rw-rw-rw-   0        0        0     1152 2021-07-15 16:03:30.000000 Dans_Diffraction-3.0.0/test/test_functions_scattering_dispersion.py
+-rw-rw-rw-   0        0        0     3320 2021-07-14 17:11:38.000000 Dans_Diffraction-3.0.0/test/test_functions_scattering_new.py
+-rw-rw-rw-   0        0        0     4726 2021-07-13 13:13:30.000000 Dans_Diffraction-3.0.0/test/test_functions_scattering_pol.py
+-rw-rw-rw-   0        0        0     3102 2021-07-13 14:17:38.000000 Dans_Diffraction-3.0.0/test/test_functions_scattering_xrm.py
+-rw-rw-rw-   0        0        0     1691 2020-03-27 07:59:19.000000 Dans_Diffraction-3.0.0/test/test_gaussian.py
+-rw-rw-rw-   0        0        0    17556 2020-06-09 08:44:11.000000 Dans_Diffraction-3.0.0/test/test_gen_sym_mat.py
+-rw-rw-rw-   0        0        0      256 2020-03-31 13:19:32.000000 Dans_Diffraction-3.0.0/test/test_gui_multicrystal.py
+-rw-rw-rw-   0        0        0     3193 2020-11-22 19:46:51.000000 Dans_Diffraction-3.0.0/test/test_i16_azimuth.py
+-rw-rw-rw-   0        0        0      552 2020-03-27 16:10:17.000000 Dans_Diffraction-3.0.0/test/test_intensity_grid.py
+-rw-rw-rw-   0        0        0     1196 2020-03-27 08:15:40.000000 Dans_Diffraction-3.0.0/test/test_isincell.py
+-rw-rw-rw-   0        0        0     2536 2021-10-04 20:22:07.000000 Dans_Diffraction-3.0.0/test/test_laue_backscatter.py
+-rw-rw-rw-   0        0        0     3864 2019-02-22 16:52:35.000000 Dans_Diffraction-3.0.0/test/test_nonresonant.py
+-rw-rw-rw-   0        0        0     5702 2019-01-21 13:30:00.000000 Dans_Diffraction-3.0.0/test/test_nonresonant_plot.py
+-rw-rw-rw-   0        0        0     3092 2019-01-21 13:25:46.000000 Dans_Diffraction-3.0.0/test/test_nonresonant_sergio.py
+-rw-rw-rw-   0        0        0      453 2021-09-26 16:50:06.000000 Dans_Diffraction-3.0.0/test/test_orientation.py
+-rw-rw-rw-   0        0        0     1044 2017-11-26 15:52:58.000000 Dans_Diffraction-3.0.0/test/test_parameter_plot.py
+-rw-rw-rw-   0        0        0     4428 2020-11-22 20:40:03.000000 Dans_Diffraction-3.0.0/test/test_plot_orbitals.py
+-rw-rw-rw-   0        0        0     1956 2017-08-22 12:09:50.000000 Dans_Diffraction-3.0.0/test/test_plotintensity.py
+-rw-rw-rw-   0        0        0     2890 2017-08-22 15:29:48.000000 Dans_Diffraction-3.0.0/test/test_plotintensity2.py
+-rw-rw-rw-   0        0        0     2593 2020-05-05 08:27:58.000000 Dans_Diffraction-3.0.0/test/test_readstfm.py
+-rw-rw-rw-   0        0        0      988 2021-01-26 07:46:04.000000 Dans_Diffraction-3.0.0/test/test_refractive_index.py
+-rw-rw-rw-   0        0        0     1843 2017-10-30 14:29:08.000000 Dans_Diffraction-3.0.0/test/test_scattering.py
+-rw-rw-rw-   0        0        0     2649 2017-11-09 11:24:34.000000 Dans_Diffraction-3.0.0/test/test_supercell.py
+-rw-rw-rw-   0        0        0     9400 2020-06-09 13:06:44.000000 Dans_Diffraction-3.0.0/test/test_symmetry_ops2magnetic.py
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Aluminium.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Aluminium.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/BCC.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/BCC.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Beryllium.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Beryllium.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Ca2RuO4.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Ca2RuO4.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Ca3CoMnO6.mcif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Ca3CoMnO6.mcif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Cobalt.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Cobalt.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Copper.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Copper.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Cubic.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Cubic.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Diamond.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Diamond.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/FCC.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/FCC.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Gold.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Gold.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Graphite.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Graphite.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/HCP.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/HCP.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Iron.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Iron.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/KCl.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/KCl.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/LaMnO3.mcif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/LaMnO3.mcif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/LiCoO2.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/LiCoO2.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Na0.8CoO2_P63mmc.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Na0.8CoO2_P63mmc.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Niobium.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Niobium.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Ruby.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Ruby.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Ruthenium.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Ruthenium.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Sapphire.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Sapphire.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Silicon.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Silicon.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Silver.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Silver.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Sr3LiRuO6.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Sr3LiRuO6.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Sr3LiRuO6_C2'c'.mcif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Sr3LiRuO6_C2'c'.mcif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/Vanadium.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/Vanadium.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/Structures/ZnO.cif` & `Dans_Diffraction-3.0.0/Dans_Diffraction/Structures/ZnO.cif`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/__init__.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/__init__.py`

 * *Files 20% similar despite different names*

```diff
@@ -27,16 +27,16 @@
 GitHub Repo: https://github.com/DanPorter/Dans_Diffraction
 Citation DOI: https://doi.org/10.5281/zenodo.3859501
 
 By Dan Porter, PhD
 Diamond
 2017
 
-Version 2.2.3
-Last updated: 14/01/23
+Version 3.0.0
+Last updated: 02/07/23
 
 Version History:
 02/03/18 1.0    Version History started.
 30/05/18 1.1    Fdmnes added
 08/06/18 1.2    Python3 now fully supported
 23/02/19 1.3    Graphical user intrface and magnetic x-ray scattering now implemented
 13/07/19 1.4    FDMNES GUI functionality added
@@ -62,14 +62,31 @@
 27/09/21 2.1.0  Added classes_orientation and diffractometer orientation functions
 15/11/21 2.1.1  Updated Plot.plot_crystal, added additional orientation functions
 07/02/22 2.1.2  Corrected error in classes_scattering.powder() of wrong tth values. Thanks Mirko!
 14/03/22 2.2.0  Scatter.powder() updated for new inputs and outputs for pVoight and custom peak shapes. Thanks yevgenyr!
 23/07/22 2.2.1  Fixed error in MultiCrystal.Scatter
 06/01/23 2.2.2  Removed redundent references to np.float
 14/01/23 2.2.3  Corrected background error in xtl.Scatter.powder
+08/05/23 2.3.0  Merged pull request for non-integer hkl option on SF and electron form factors. Thanks Prestipino!
+25/06/23 3.0.0  Added new GUI elements including new Scattering UI and diffractomter simulator, plus other updates
+
+Acknoledgements:
+    2018        Thanks to Hepesu for help with Python3 support and ideas about breaking up calculations
+    Dec 2019    Thanks to Gareth Nisbet for allowing me to inlude his multiple scattering siumulation
+    April 2020  Thanks to ChunHai Wang for helpful suggestions in readcif!
+    May 2020    Thanks to AndreEbel for helpful suggestions on citations
+    Dec 2020    Thanks to Chris Drozdowski for suggestions about reflection families
+    Jan 2021    Thanks to aslarsen for suggestions about outputting the structure factor
+    April 2021  Thanks to Trygve Ræder for suggestions about x-ray scattering factors
+    Feb 2022    Thanks to Mirko for pointing out the error in two-theta values in Scatter.powder
+    March 2022  Thanks to yevgenyr for suggesting new peak profiles in Scatter.powder
+    Jan 2023    Thanks to Anuradha Vibhakar for pointing out the error in f0 + if'-if''
+    Jan 2023    Thanks to Andreas Rosnes for testing the installation in jupyterlab
+    May 2023    Thanks to Carmelo Prestipino for adding electron scattering factors
+    June 2023   Thanks to Sergio I. Rincon for pointing out the rounding error in Scatter.powder
 
 -----------------------------------------------------------------------------
    Copyright 2023 Diamond Light Source Ltd.
 
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
@@ -115,16 +132,16 @@
 
 # FDMNES
 from .classes_fdmnes import fdmnes_checker
 if fdmnes_checker():
     from .classes_fdmnes import Fdmnes, FdmnesAnalysis
 
 
-__version__ = '2.2.3'
-__date__ = '14/01/23'
+__version__ = '3.0.0'
+__date__ = '02/07/23'
 
 
 # Build
 structure_list = Structures()
 
 
 def version_info():
@@ -151,14 +168,18 @@
         import scipy
         out += '\n     scipy version: %s' % scipy.__version__
     except ImportError:
         out += '\n     scipy version: None'
     return out
 
 
+def doc_str():
+    return __doc__
+
+
 # tkGUI Activation
 def start_gui(xtl=None):
     """Start GUI window (requires tkinter)"""
     try:
         from .tkgui import CrystalGui
         CrystalGui(xtl)
     except ImportError:
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/__main__.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/__main__.py`

 * *Files 8% similar despite different names*

```diff
@@ -11,15 +11,15 @@
     ipython -m Dans_Diffraction gui
 
 To Parse a cif:
     ipython -m Dans_Diffraction 'somefile.cif'
 
 By Dan Porter, PhD
 Diamond
-2017
+2023
 """
 if __name__ == '__main__':
 
     import sys
     import numpy as np
     import matplotlib.pyplot as plt
     import Dans_Diffraction as dif
@@ -28,10 +28,13 @@
     print('See help(dif.Crystal) for info, or dif.start_gui() to get started!')
     xtl = dif.Crystal()
 
     for arg in sys.argv:
         if 'cif' in arg.lower():
             xtl = dif.Crystal(arg)
             print(xtl.info())
+        elif arg in dif.structure_list.list:
+            xtl = getattr(dif.structure_list, arg)()
+            print(xtl.info())
         elif 'gui' in arg.lower():
             xtl.start_gui()
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_crystal.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_crystal.py`

 * *Files 2% similar despite different names*

```diff
@@ -20,16 +20,16 @@
         xtl.Plot       >> Plot Crystal structures and simulate diffraction patterns
         xtl.Scatter    >> Simulate diffraction intensities of different types
 
 By Dan Porter, PhD
 Diamond
 2017
 
-Version 3.2.3
-Last updated: 12/01/21
+Version 3.2.4
+Last updated: 22/05/23
 
 Version History:
 27/07/17 1.0    Version History started.
 30/10/17 1.1    Many minor updates.
 06/01/18 2.0    Name change and other updates
 13/02/18 2.1    Move scattering commands to xtl.Scatter
 05/04/18 2.2    Magnetic symmetry automatically inverted for odd time
@@ -44,14 +44,15 @@
 27/05/20 3.0    Updated write_cif for magnetic moments - now writes simple mcif structures
 09/06/20 3.0.1  Updated code for changes to fc.gen_sym_mat
 10/06/20 3.1    Updated Symmetry to include time operators
 02/09/20 3.2.0  Added Cell.reflection_hkl and transmission_hkl, added __str__ methods
 22/10/20 3.2.1  Added Cell.moment, updated Cell.latt()
 15/11/21 3.2.2  Added Cell.orientation, updated Cell.UV()
 12/01/21 3.2.3  Added Symmetry.axial_vector
+22/05/23 3.2.4  Added Symmetry.wyckoff_label(), Symmetry.spacegroup_dict
 
 @author: DGPorter
 """
 
 import numpy as np
 from warnings import warn
 
@@ -61,15 +62,15 @@
 from .classes_orientation import Orientation
 from .classes_properties import Properties
 # from .classes_orbitals import CrystalOrbitals
 from .classes_scattering import Scattering
 from .classes_multicrystal import MultiCrystal
 from .classes_plotting import Plotting, PlottingSuperstructure
 
-__version__ = '3.2.3'
+__version__ = '3.2.4'
 
 
 class Crystal:
     """
     Reads the structure information from a cif file and generates the full structure.
     Allows the adjustment of the structure through the lattice parameters, symmetry 
     or atomic displacement.
@@ -610,23 +611,24 @@
         Returns the magnitude of wave-vector transfer of [h,k,l], in A-1
         :param HKL: list of hkl reflections
         :return: list of Q values
         """
         Q = self.calculateQ(HKL)
         return fg.mag(Q)
 
-    def tth(self, HKL, energy_kev=8.048):
+    def tth(self, HKL, energy_kev=8.048, wavelength_a=None):
         """
         Returns the two-theta angle, in deg, of [h,k,l] at specified energy in keV
         :param HKL: list of hkl reflections
-        :param energy_kev: energy in keV
+        :param energy_kev: photon energy in keV
+        :param wavelength_a: wavelength in Angstroms
         :return: two-theta angles
         """
         Qmag = self.Qmag(HKL)
-        return fc.cal2theta(Qmag, energy_kev)
+        return fc.cal2theta(Qmag, energy_kev, wavelength_a)
 
     def angle(self, hkl1, hkl2):
         """
         Return the angle between two reflections
         :param hkl1: [h,k,l] reflection 1
         :param hkl2: [h,k,l] reflection 2
         :return: angle in degrees
@@ -665,51 +667,54 @@
         Calculate the d-spacing in A
         :param hkl: array : list of reflections
         :return: d-spacing
         """
         Qmag = self.Qmag(hkl)
         return fc.q2dspace(Qmag)
 
-    def max_hkl(self, energy_kev=8.048, max_angle=180.0):
+    def max_hkl(self, energy_kev=8.048, max_angle=180.0, wavelength_a=None, maxq=None):
         """
         Returns the maximum index of h, k and l for a given energy
         :param energy_kev: energy in keV
         :param max_angle: maximum two-theta at this energy
+        :param wavelength_a: wavelength in A
+        :param maxq: maximum wavevetor transfere in A-1 (suplants all above)
         :return: maxh, maxk, maxl
         """
-
-        Qmax = fc.calqmag(max_angle, energy_kev)
-        Qpos = [[Qmax, Qmax, Qmax],
-                [-Qmax, Qmax, Qmax],
-                [Qmax, -Qmax, Qmax],
-                [-Qmax, -Qmax, Qmax],
-                [Qmax, Qmax, -Qmax],
-                [-Qmax, Qmax, -Qmax],
-                [Qmax, -Qmax, -Qmax],
-                [-Qmax, -Qmax, -Qmax]]
+        if maxq is None:
+            maxq = fc.calqmag(max_angle, energy_kev, wavelength_a)
+        Qpos = [[maxq, maxq, maxq],
+                [-maxq, maxq, maxq],
+                [maxq, -maxq, maxq],
+                [-maxq, -maxq, maxq],
+                [maxq, maxq, -maxq],
+                [-maxq, maxq, -maxq],
+                [maxq, -maxq, -maxq],
+                [-maxq, -maxq, -maxq]]
         hkl = self.indexQ(Qpos)
         return np.ceil(np.abs(hkl).max(axis=0)).astype(int)
 
-    def all_hkl(self, energy_kev=8.048, max_angle=180.0):
+    def all_hkl(self, energy_kev=8.048, max_angle=180.0, wavelength_a=None, maxq=None):
         """
         Returns an array of all (h,k,l) reflections at this energy
         :param energy_kev: energy in keV
         :param max_angle: max two-theta angle
+        :param wavelength_a: wavelength in A
+        :param maxq: maximum wavevetor transfere in A-1 (suplants all above)
         :return: array hkl[:,3]
         """
-
-        Qmax = fc.calqmag(max_angle, energy_kev)
-
         # Find the largest indices
-        hmax, kmax, lmax = self.max_hkl(energy_kev, max_angle)
+        hmax, kmax, lmax = self.max_hkl(energy_kev, max_angle, wavelength_a, maxq)
         # Generate the grid
         HKL = fc.genHKL([hmax, -hmax], [kmax, -kmax], [lmax, -lmax])
         # Some will be above the threshold
         Qm = self.Qmag(HKL)
-        return HKL[Qm <= Qmax, :]
+        if maxq is None:
+            maxq = fc.calqmag(max_angle, energy_kev, wavelength_a)
+        return HKL[Qm <= maxq, :]
 
     def reflection_hkl(self, energy_kev=8.048, max_angle=180.0,
                        specular=(0, 0, 1), theta_offset=0, min_theta=0, max_theta=180.):
         """
         Returns an array of all (h,k,l) reflections in reflection geometry
         :param energy_kev: energy in keV
         :param max_angle: max two-theta angle
@@ -941,14 +946,25 @@
 
         prop_names = self.properties.dtype.names
         out = ''
         for key in prop_names:
             out += '%20s : %s\n' % (key, self.properties[key][0])
         return out
 
+    def uvw(self):
+        """
+        Returns a [1x3] array of current positions
+        :return: np.array([1x3])
+        """
+        return np.asarray([self.u, self.v, self.w], dtype=float)
+
+    def total_moment(self):
+        """Return the total moment along a, b, c directions"""
+        return np.sum(self.mxmymz)
+
 
 class Atoms:
     """
     Contains properties of atoms within the crystal
     Each atom has properties:
         u,v,w >> atomic coordinates, in the basis of the unit cell
         type >> element species, given as element name, e.g. 'Fe'
@@ -1509,22 +1525,23 @@
 
     spacegroup = 'P1'
     spacegroup_number = 1
     symmetry_operations = ['x,y,z']
     symmetry_operations_magnetic = ['x,y,z']
     symmetry_operations_time = [1]
     symmetry_matrices = np.eye(4)
+    spacegroup_dict = fc.spacegroup(1)
 
     def __init__(self, symmetry_operations=None, symmetry_operations_magnetic=None):
         """Initialises the symmetry group"""
 
         if symmetry_operations is not None:
             self.addsym(symmetry_operations, symmetry_operations_magnetic)
-
-        self.generate_matrices()
+        else:
+            self.generate_matrices()
 
     def fromcif(self, cifvals):
         """
         Import symmetry information from a cif dictionary
         Required cif keys:
             None
         Optional cif keys:
@@ -1574,24 +1591,36 @@
             sgn = '1'
         else:
             sgn = '0'
         try:
             self.spacegroup_number = float(sgn)
         except ValueError:
             self.spacegroup_number = 0
+        try:
+            if '.' in sgn:
+                self.spacegroup_dict = fc.spacegroup_magnetic(sgn)
+            else:
+                self.spacegroup_dict = fc.spacegroup(sgn)
+        except KeyError:
+            # Find from spacegroup
+            check = fc.find_spacegroup(spacegroup)
+            if check:
+                self.spacegroup_dict = check
+                self.spacegroup_number = check['space group number']
+            else:
+                self.spacegroup_dict = fc.spacegroup(1)
 
         self.generate_matrices()
 
     def update_cif(self, cifvals):
         """
         Update cifvals dict with current symmetry operations
         :param cifvals: cif dict from functions_crystallography.readcif
         :return: cifvals
         """
-        keys = cifvals.keys()
 
         cifvals['_symmetry_equiv_pos_as_xyz'] = self.symmetry_operations
         cifvals['_space_group_symop_operation_xyz'] = self.symmetry_operations
 
         # newer versions of mcif don't use magn_operation.mxmymz but use symform in atom spec
         # . may be in the wrong place for some program
         # Add time to symmetry operations
@@ -1613,42 +1642,52 @@
         cifvals['_space_group_magn.name_BNS'] = self.spacegroup
 
         cifvals['_symmetry_Int_Tables_number'] = self.spacegroup_number
         cifvals['_space_group_IT_number'] = self.spacegroup_number
         cifvals['_space_group_magn.number_BNS'] = self.spacegroup_number
         return cifvals
 
-    def load_spacegroup(self, sg_number):
+    def load_spacegroup(self, sg_number=None, sg_dict=None):
         """
         Load symmetry operations from a spacegroup from the International Tables of Crystallogrphy
         See functions_crystallography.spacegroup for more details
         :param sg_number: space group number (1-230)
+        :param sg_dict: alternative input: spacegroup dict from fc.spacegroup
         :return: None
         """
-        spacegroup = fc.spacegroup(sg_number)
-        self.spacegroup_number = int(spacegroup['space group number'])
-        self.spacegroup = spacegroup['space group name']
+        if sg_dict is None:
+            sg_dict = fc.spacegroup(sg_number)
+        if 'positions magnetic' in sg_dict:
+            self.load_magnetic_spacegroup(sg_dict=sg_dict)
+            return
+        self.spacegroup_number = int(sg_dict['space group number'])
+        self.spacegroup = sg_dict['space group name']
+        self.spacegroup_dict = sg_dict
 
-        symops = spacegroup['general positions']
+        symops = sg_dict['general positions']
         self.symmetry_operations = symops
         self.symmetry_operations_magnetic = fc.symmetry_ops2magnetic(symops)
         self.symmetry_operations_time = [1] * len(symops)
 
-    def load_magnetic_spacegroup(self, msg_number):
+    def load_magnetic_spacegroup(self, msg_number=None, sg_dict=None):
         """
         Load symmetry operations from a magnetic spacegroup from Bilbao crystallographic server
         Replaces the current symmetry operators and the magnetic symmetry operators.
         See functions_crystallography.spacegroup_magnetic for more details
         :param msg_number: magnetic space group number e.g. 61.433
-        :return:
+        :param sg_dict: alternative inuput: spacegroup dict from fc.spacegroup_magnetic
+        :return: None
         """
-
-        maggroup = fc.spacegroup_magnetic(msg_number)
+        if sg_dict is None:
+            maggroup = fc.spacegroup_magnetic(msg_number)
+        else:
+            maggroup = sg_dict
         self.spacegroup_number = maggroup['space group number']
         self.spacegroup = maggroup['space group name']
+        self.spacegroup_dict = maggroup
         symops = maggroup['positions general']
         symmag = maggroup['positions magnetic']
         self.symmetry_operations = symops
         self.symmetry_operations_magnetic = symmag
         self.symmetry_operations_time = fc.sym_op_time(symops)
 
     def changesym(self, idx, operation):
@@ -1715,33 +1754,27 @@
     def generate_matrices(self):
         """
         Generates the symmetry matrices from string symmetry operations
         """
 
         self.symmetry_matrices = fc.gen_sym_mat(self.symmetry_operations)
 
-    def print_subgroups(self, sg_number=None):
+    def print_subgroups(self):
         """
         Return str of subgroups of this spacegroup
-        :param sg_number: spacegroup number, None to use current one
         :return: str
         """
-        if sg_number is None:
-            sg_number = self.spacegroup_number
-        return fc.spacegroup_subgroups_list(sg_number)
+        return fc.spacegroup_subgroups_list(sg_dict=self.spacegroup_dict)
 
-    def print_magnetic_spacegroups(self, sg_number=None):
+    def print_magnetic_spacegroups(self):
         """
         Return str of available magnetic spacegroups for this spacegroup
-        :param sg_number: spacegroup number, None to use current one
         :return: str
         """
-        if sg_number is None:
-            sg_number = self.spacegroup_number
-        return fc.spacegroup_magnetic_list(sg_number)
+        return fc.spacegroup_magnetic_list(sg_dict=self.spacegroup_dict)
 
     def symmetric_coordinates(self, UVW, MXMYMZ=None, remove_identical=True):
         """
         Returns array of symmetric coordinates
         Uses fc.gen_sym_pos
         Returns coordinates wrapped within the unit cell, with identical positions removed.
         All positions returned if remove_identical=False
@@ -1822,19 +1855,19 @@
             sym_uvw = fc.gen_sym_pos(self.symmetry_operations, u, v, w)
             sym_uvw = fc.fitincell(sym_uvw)
 
             # Remove identical positions
             unique_uvw, uniqueidx, matchidx = fg.unique_vector(sym_uvw, tol=0.01)
 
             out += ' (%1.3g, %1.3g, %1.3g)\n' % (u, v, w)
-            out += '  n       u       v       w             Symmetry    Magnetic Symmetry\n'
+            out += '  n       u       v       w   Symmetry                        Magnetic Symmetry\n'
             if remove_identical:
                 # Only display distict positions
                 for n in range(len(unique_uvw)):
-                    out += '%3d %7.4f %7.4f %7.4f %20s %20s\n' % (
+                    out += '%3d %7.4f %7.4f %7.4f %30s %20s\n' % (
                         uniqueidx[n], unique_uvw[n, 0], unique_uvw[n, 1], unique_uvw[n, 2],
                         self.symmetry_operations[uniqueidx[n]], self.symmetry_operations_magnetic[uniqueidx[n]])
             else:
                 for n in range(len(sym_uvw)):
                     out += '%3d %7.4f %7.4f %7.4f %20s %20s\n' % (
                         n, sym_uvw[n, 0], sym_uvw[n, 1], sym_uvw[n, 2], self.symmetry_operations[n],
                         self.symmetry_operations_magnetic[n])
@@ -2126,14 +2159,45 @@
             # Get parity
             p = np.linalg.det(m)
             # Generate string
             mag_str = fc.sym_mat2str(t * p * m)
             out += "%3d, %19s, %6s, %9s, %8s, %19s\n" % (n, operations[n], t, p, mag_str, magnetic_ops[n])
         return out
 
+    def wyckoff_labels(self, UVW):
+        """
+        Return Wyckoff site for position
+        :param UVW: (u,v,w) or None to use xtl.Atoms.uvw()
+        :return: list of Wyckoff site letters
+        """
+        return fc.wyckoff_labels(self.spacegroup_dict, UVW)
+
+    def print_wyckoff_sites(self):
+        """Return info str about Wycoff positions for this spacegroup"""
+
+        spg = self.spacegroup_dict
+        out = 'Spacegoup: %s (%s)\n' % (spg['space group name'], spg['space group number'])
+        if 'parent number' in spg:
+            spg = fc.spacegroup(self.spacegroup_dict['parent number'])
+            out += ' Parent: %s (%s)\n' % (spg['space group name'], spg['space group number'])
+        centring = spg['positions centring']
+        out += '\nCentring operations: %2d : \n     ' % len(centring)
+        out += '\n     '.join(centring)
+        out += '\n\n'
+        out += 'Wyckoff Sites\n'
+        coordinates = spg['positions coordinates']
+        multiplicity = spg['positions multiplicity']
+        symmetry = spg['positions symmetry']
+        wyckoff_letter = spg['positions wyckoff letter']
+        for n in range(len(coordinates)):
+            out += '%3s : %10s : %2s\n     ' % (wyckoff_letter[n], symmetry[n], multiplicity[n])
+            out += '\n     '.join(coordinates[n])
+            out += '\n\n'
+        return out
+
     def info(self):
         """
         Prints the symmetry information
         :return: str
         """
 
         out = 'Spacegoup: %s (%s)\n' % (self.spacegroup, self.spacegroup_number)
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_fdmnes.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_fdmnes.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_multicrystal.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_multicrystal.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_orbitals.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_orbitals.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_orientation.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_orientation.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_plotting.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_plotting.py`

 * *Files 1% similar despite different names*

```diff
@@ -564,15 +564,15 @@
             peak_width_pixels = peak_width/pixel_size
             gauss_x = np.arange(-2*peak_width_pixels,2*peak_width_pixels+1)
             G = fg.gauss(gauss_x, gauss_x, height=1, cen=0, fwhm=peak_width_pixels, bkg=0)
             mesh = convolve2d(mesh,G, mode='same') # this is the slowest part
         """
         # Add background (if not None or 0)
         if background:
-            bkg = np.random.normal(background,np.sqrt(background), [pixels, pixels])
+            bkg = np.random.normal(background, np.sqrt(background), [pixels, pixels])
             mesh = mesh+bkg
         
         return xx, yy, mesh
     
     def simulate_intensity_cut(self,x_axis=[1,0,0],y_axis=[0,1,0],centre=[0,0,0],
                                     q_max=4.0,cut_width=0.05,background=0.0, peak_width=0.05):
         """
@@ -609,15 +609,15 @@
         
         # Generate intensity cut
         X, Y, mesh = self.generate_intensity_cut(x_axis, y_axis, centre, q_max, cut_width, background, peak_width)
         
         # create figure
         plt.figure(figsize=self._figure_size, dpi=self._figure_dpi)
         cmap = plt.get_cmap('hot_r')
-        plt.pcolormesh(X, Y, mesh, cmap=cmap)
+        plt.pcolormesh(X, Y, mesh, cmap=cmap, shading='auto')
         plt.axis('image')
         plt.colorbar()
         plt.clim([background-(np.max(mesh)/200),background+(np.max(mesh)/50)])
 
         # Lattice points and vectors within the plot
         Q_vec_a = self.xtl.Cell.calculateQ(vec_a)
         Q_vec_b = self.xtl.Cell.calculateQ(vec_b)
@@ -636,18 +636,19 @@
         fp.plot_lattice_lines(lattQ, mesh_vec_a, mesh_vec_b)
         fp.plot_vector_arrows(mesh_vec_a, mesh_vec_b, vec_a_lab, vec_b_lab)
         #fp.plot_vector_lines(Q_vec_a, Q_vec_b)
         #fp.plot_vector_arrows(Q_vec_a, Q_vec_b, vec_a_lab, vec_b_lab)
         plt.text(0 - (0.2*q_max), 0 - (0.1*q_max), cen_lab, fontname=fp.DEFAULT_FONT, weight='bold', size=18)
         
         # Plot labels
-        xlab = u'Q || (%1.3g,%1.3g,%1.3g) [$\AA^{-1}$]' % (x_axis[0],x_axis[1],x_axis[2])
-        ylab = u'Q || (%1.3g,%1.3g,%1.3g) [$\AA^{-1}$]' % (y_axis[0],y_axis[1],y_axis[2])
-        ttl = '%s\n(%1.3g,%1.3g,%1.3g)' % (self.xtl.name,centre[0],centre[1],centre[2])
-        fp.labels(ttl,xlab,ylab)
+        scatter_type = self.xtl.Scatter._scattering_type.capitalize()
+        xlab = u'Q || (%1.3g,%1.3g,%1.3g) [$\AA^{-1}$]' % (x_axis[0], x_axis[1], x_axis[2])
+        ylab = u'Q || (%1.3g,%1.3g,%1.3g) [$\AA^{-1}$]' % (y_axis[0], y_axis[1], y_axis[2])
+        ttl = '%s %s\n(%1.3g,%1.3g,%1.3g)' % (self.xtl.name, scatter_type, centre[0], centre[1], centre[2])
+        fp.labels(ttl, xlab, ylab)
     
     def simulate_hk0(self, L=0, **kwargs):
         """
         Plots the hk(L) layer of reciprocal space
          for inputs, see help(xtl.simulate_intensity_cut)
         """
         self.simulate_intensity_cut([1,0,0], [0,1,0], [0,0,L],**kwargs)
@@ -768,14 +769,18 @@
         CELL = np.array([2*q_max*x_cart,-2*q_max*y_cart,cut_width*z_cart])
         
         # find reflections within this box
         inplot = fg.isincell(Q,c_cart,CELL)
         fp.newplot3(Q[:,0],Q[:,1],Q[:,2],'bo')
         fp.plot_cell(c_cart,CELL)
         plt.plot(Q[inplot,0],Q[inplot,1],Q[inplot,2],'ro')
+        ax = plt.gca()
+        ax.set_xlim3d(-q_max, q_max)
+        ax.set_ylim3d(-q_max, q_max)
+        ax.set_zlim3d(-q_max, q_max)
         
         fp.labels(self.xtl.name,'Qx','Qy','Qz')
     
     def quick_intensity_cut(self,x_axis=[1,0,0],y_axis=[0,1,0],centre=[0,0,0], q_max=4.0,cut_width=0.05):
         """
         Plot a cut through reciprocal space, visualising the intensity as different sized markers
           x_axis = direction along x, in units of the reciprocal lattice (hkl)
@@ -1488,98 +1493,92 @@
             see classes_scattering.generate_powder
         """
         
         plt.figure(figsize=[2*self._figure_size[0], self._figure_size[1]], dpi=self._figure_dpi)
         colours = iter(['b','g','r','c','m','y','k'])
         
         for xtl in self.crystal_list:
-            # Get reflections
-            angle_max = xtl.Scatter._scattering_max_twotheta
-            q_max = fc.calqmag(angle_max, energy_kev)
-            HKL = xtl.Cell.all_hkl(energy_kev, angle_max)
-            HKL = xtl.Cell.sort_hkl(HKL) # required for labels
+            # Units
+            units = xtl.Scatter._powder_units
+            min_overlap = xtl.Scatter._powder_min_overlap
+            min_twotheta = xtl.Scatter._scattering_min_twotheta
+            if min_twotheta <= 0: min_twotheta = 1.0
+            max_twotheta = xtl.Scatter._scattering_max_twotheta
+            q_min = fc.calqmag(min_twotheta, energy_kev)
+            q_max = fc.calqmag(max_twotheta, energy_kev)
+            q_range = q_max - q_min
+
+            HKL = xtl.Cell.all_hkl(maxq=q_max)
+            HKL = xtl.Cell.sort_hkl(HKL)  # required for labels
             Qmag = xtl.Cell.Qmag(HKL)
-            I = xtl.Scatter.intensity(HKL)
             col = next(colours)
 
+            pixels = 2000
+            tot_pixels = int(pixels * q_range)  # reduce this to make convolution faster
+            pixel_size = q_range / float(tot_pixels)
+            peak_width_pixels = peak_width / pixel_size
+            mesh = np.zeros([tot_pixels])
+            mesh_q = np.linspace(q_min, q_max, tot_pixels)
+            pixel_coord = np.round(tot_pixels * (Qmag - q_min) / q_range).astype(int)
+
+            select = (pixel_coord < tot_pixels) * (pixel_coord > 0)
+            HKL = HKL[select, :]
+            Qmag = Qmag[select]
+            pixel_coord = pixel_coord[select]
+
+            I = xtl.Scatter.intensity(HKL)
             if powder_average:
                 # Apply powder averging correction, I0/|Q|**2
-                I = I / Qmag ** 2
-            
-            # create plotting mesh
-            pixels = int(2000*q_max)  # reduce this to make convolution faster
-            pixel_size = q_max/pixels
-            peak_width_pixels = peak_width/(1.0*pixel_size)
-            mesh = np.zeros([int(pixels)])
-
-            if xtl.Scatter._powder_units.lower() in ['tth', 'angle', 'two-theta', 'twotheta', 'theta']:
-                xx = xtl.Cell.tth(HKL, energy_kev)
-                max_x = angle_max
-                xlab = u'Two-Theta [Deg]'
-            elif xtl.Scatter._powder_units.lower() in ['d', 'dspace', 'd-spacing', 'dspacing']:
-                xx = xtl.Cell.dspace(HKL)
-                max_x = 10.0
-                xlab = u'd-spacing [$\AA$]'
-            else:
-                xx = Qmag
-                max_x = q_max
-                xlab = u'Q [$\AA^{-1}]$'
-
-            # add reflections to background
-            # scipy.interpolate.griddata?
-            mesh_x = np.linspace(0, max_x, pixels)
-            pixel_coord = xx / max_x
-            pixel_coord = (pixel_coord * (pixels - 1)).astype(int)
-
-            ref_n = [0]
-            ref_txt = ['']
-            ext_n = []
-            ext_txt = []
-            for n in range(1, len(I) - 1):
-                if xx[n] > max_x:
-                    continue
-                mesh[pixel_coord[n]] = mesh[pixel_coord[n]] + I[n]
-
-                close_ref = np.abs(pixel_coord[n] - pixel_coord) < peak_width_pixels / 2
-                close_lab = np.all(np.abs(pixel_coord[n] - np.array(ref_n + ext_n)) > peak_width_pixels / 2)
+                I = I / (Qmag+0.001) ** 2
 
-                if np.all(I[n] >= I[close_ref]) and close_lab:
-                    # generate label if not too close to another reflection
-                    if I[n] > 0.1:
-                        ref_n += [pixel_coord[n]]
-                        ref_txt += ['(%1.0f,%1.0f,%1.0f)' % (HKL[n, 0], HKL[n, 1], HKL[n, 2])]
-                    else:
-                        ext_n += [pixel_coord[n]]
-                        ext_txt += ['(%1.0f,%1.0f,%1.0f)' % (HKL[n, 0], HKL[n, 1], HKL[n, 2])]
+            for n in range(len(I)):
+                mesh[pixel_coord[n]] = mesh[pixel_coord[n]] + I[n]
             
             # Convolve with a gaussian
             if peak_width:
                 gauss_x = np.arange(-3*peak_width_pixels,3*peak_width_pixels+1) # gaussian width = 2*FWHM
                 G = fg.gauss(gauss_x, None, height=1, centre=0, fwhm=peak_width_pixels, bkg=0)
                 mesh = np.convolve(mesh, G, mode='same')
             
             # Add background
             if background:
                 bkg = np.random.normal(background, np.sqrt(background), [int(pixels)])
                 mesh = mesh+bkg
-            
+
+            # Change output units
+            xval = fc.q2units(mesh_q, units, energy_kev)
+
+            # Determine non-overlapping hkl coordinates
+            xvalues = fc.q2units(Qmag, units, energy_kev)
+            ref_n = fc.group_intensities(xvalues, I, min_overlap)
+
+            grp_hkl = HKL[ref_n, :]
+            grp_xval = xvalues[ref_n]
+            grp_inten = mesh[pixel_coord[ref_n]]
+
             # create figure
-            plt.plot(mesh_x, mesh, '-', lw=2, label=xtl.name, c=col)
+            plt.plot(xval, mesh, '-', lw=2, label=xtl.name, c=col)
 
             # Reflection labels
-            for n in range(len(ref_n)):
-                plt.text(mesh_x[ref_n[n]], 1.01 * mesh[ref_n[n]], ref_txt[n],
-                         fontname=fp.DEFAULT_FONT, fontsize=12, color=col, fontweight='bold',
-                         rotation='vertical', ha='center', va='bottom')
-            # Extinction labels
-            ext_y = background + 0.01 * plt.ylim()[1]
-            for n in range(len(ext_n)):
-                plt.text(mesh_x[ext_n[n]], ext_y, ext_txt[n],
-                         fontname=fp.DEFAULT_FONT, fontsize=12, color=col,
-                         rotation='vertical', ha='center', va='bottom')
+            for n in range(len(grp_hkl)):
+                if grp_inten[n] > 1.01 * background:
+                    plt.text(grp_xval[n], 1.01 * grp_inten[n], fc.hkl2str(grp_hkl[n]),
+                             fontname=fp.DEFAULT_FONT, fontsize=12, color=col, fontweight='bold',
+                             rotation='vertical', ha='center', va='bottom')
+                else:  # Extinction labels
+                    plt.text(grp_xval[n], (1.01 * background) + 1, fc.hkl2str(grp_hkl[n]),
+                             fontname=fp.DEFAULT_FONT, fontsize=12, color=col, fontweight='bold',
+                             rotation='vertical', ha='center', va='bottom')
+
+        if xtl.Scatter._powder_units.lower() in ['tth', 'angle', 'two-theta', 'twotheta', 'theta']:
+            xlab = u'Two-Theta [Deg]'
+        elif xtl.Scatter._powder_units.lower() in ['d', 'dspace', 'd-spacing', 'dspacing']:
+            xlab = u'd-spacing [$\AA$]'
+        else:
+            xlab = u'Q [$\AA^{-1}]$'
 
         ylab = u'Intensity [a. u.]'
         ttl = 'E = %1.3f keV' % energy_kev
         plt.legend(loc=0, fontsize=18, frameon=False)
         fp.labels(ttl, xlab, ylab)
     
     def simulate_intensity_cut(self,x_axis_crystal=[[1,0,0]],y_axis_crystal=[[0,1,0]],centre=[0,0,0],
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_properties.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_properties.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,39 +3,40 @@
 Properties Class "classes_properties.py"
  functions for calculating various properties, working with the Crystal class.
 
 By Dan Porter, PhD
 Diamond
 2017
 
-Version 1.7
-Last updated: 26/01/21
+Version 1.8
+Last updated: 17/05/23
 
 Version History:
 10/11/17 0.1    Program created
 06/01/18 1.0    Program renamed
 11/03/18 1.1    Added properties.info(), element.info()
 23/02/19 1.2    Added xray_edges
 15/08/19 1.3    Added molcharge
 30/03/20 1.4    Added latex_table, info returns str, removed getattr from xray_edges, check if element exists
 12/05/20 1.5    Added orbitals function, exchange_paths
 15/10/20 1.6    Added scattering lengths + factors
 26/01/21 1.7    Added calculation of xray attenuation, transmission and refractive index
+16/05/23 1.8    Fixed reflectivity calculation
 
 
 @author: DGPorter
 """
 
 import numpy as np
 
 from . import functions_general as fg
 from . import functions_crystallography as fc
 from .classes_orbitals import CrystalOrbitals
 
-__version__ = '1.7'
+__version__ = '1.8'
 
 
 class Properties:
     """
     Properties functions for the Crystal Object
     Example Usage:
         xtl = Crystal('file.cif')
@@ -290,37 +291,29 @@
         atom_per_volume = natoms / vol  # atoms per A^3
         elements = ['%s%s' % (at, o) for at, o in zip(atom_type, occ)]
         return fc.xray_attenuation_length(elements, energy_kev, atom_per_volume, grazing_angle)
 
     def xray_reflectivity(self, energy_kev=None, grazing_angle=2):
         """
         Calculate the specular reflectivity of a material
-          NOT CURRENTLY WORKING
-        :param elements: str or list of str, if list - absorption will be summed over elements
+        From: https://xdb.lbl.gov/Section4/Sec_4-2.html
         :param energy_kev: float array
         :param grazing_angle: incidence angle relative to the surface, in degrees
         :return: float or array
         """
         if energy_kev is None:
             energy_kev = fc.getenergy()
-        raise Warning("Warning: this doesn\'t work yet")
 
         atom_type = self.xtl.Structure.type
         occ = self.xtl.Structure.occupancy
         natoms = np.sum(occ)
         vol = self.volume()
         atom_per_volume = natoms / vol  # atoms per A^3
         elements = ['%s%s' % (at, o) for at, o in zip(atom_type, occ)]
-
-        refindex = fc.xray_refractive_index(elements, energy_kev, atom_per_volume)
-        costh = np.cos(np.deg2rad(grazing_angle))
-        ki = costh
-        kt = np.sqrt(refindex * np.conj(refindex) - costh ** 2)
-        r = (ki - kt) / (ki + kt)
-        return np.real(r * np.conj(r))
+        return fc.xray_reflectivity(elements, energy_kev, atom_per_volume, grazing_angle)
 
     def diamagnetic_susceptibility(self, atom_type='volume'):
         """
         Calculate diamagnetic contribution to susceptibility
 
         type = 'volume' > returns volume susceptiblity in -dimensionless-
         type = 'cgs volume' > returns volume susceptiblity in emu/cm^3
@@ -359,15 +352,15 @@
         for at in atom_types:
             N = np.sum(self.xtl.Structure.occupancy[self.xtl.Structure.type == at])
             Zeff = fc.atom_properties(str(at), 'ValenceE')[0]
             r = fc.atom_properties(str(at), 'Radii')[0] * 1e-12
             X += -(N / D) * C * (Zeff * r * r)
         return X
 
-    def atomic_neighbours(self, structure_index=0, radius=2.5, disp=False):
+    def atomic_neighbours(self, structure_index=0, radius=2.5, disp=False, return_str=False):
         """
         Returns the relative positions of atoms within a radius of the selected atom
             vector, label = atomic_distances(idx, radius)
                 idx = index of central atom, choosen from xtl.Structrue.info()
                 radius = radius about the central atom to find other ions, in Angstroms
                 disp = False*/True display the output
                 vector = [nx3] array of atomic positions relative to central atom
@@ -383,20 +376,26 @@
         diff = R - Rindex
 
         mag = fg.mag(diff)
         jj = np.argsort(mag)
         diff = diff[jj,:]
         label = label[jj]
         mag = mag[jj]
-        ii = np.where(mag<radius)[0]
+        ii = np.where(mag < radius)[0]
 
-        if disp:
-            for i in ii:
-                print('{:3.0f} {:4s} {:6.3f} {:6.3f} {:6.3f} dist = {:6.3f}'.format(i, label[i], diff[i, 0], diff[i, 1],
-                                                                                    diff[i, 2], mag[i]))
+        if disp or return_str:
+            s = 'idx Label x      y      z     \n'
+            fmt = '{:3.0f} {:4s} {:6.3f} {:6.3f} {:6.3f} dist = {:6.3f} \u212B'
+            s += '\n'.join([
+                fmt.format(jj[i], label[i], diff[i, 0], diff[i, 1], diff[i, 2], mag[i]) for i in ii
+            ])
+            if disp:
+                print(s)
+            if return_str:
+                return s
         return diff[ii,:], label[ii]
 
     def exchange_paths(self, cen_idx=None, nearest_neighbor_distance=7.0, exchange_type='O', bond_angle=90.,
                        search_in_cell=True, group_neighbors=True, disp=False, return_str=False):
         """
         Calcualte likely exchange pathways between neighboring ions within a certain radius
         Ions in exchange path are selected by being close to the bond between neighboring atoms of the same type to the
@@ -571,15 +570,15 @@
         """Prints various properties useful for experiments"""
 
         out = '\n'
         out += '-----------%s-----------\n' % self.xtl.name
         out += ' Formula: {}\n'.format(self.molname())
         out += 'Magnetic: {}\n'.format(self.xtl.Structure.ismagnetic())
         out += '  Weight: %5.2f g/mol\n' % (self.weight())
-        out += ' Density: %5.2f g/cm\n' % (self.density())
+        out += ' Density: %5.2f g/cm^3\n' % (self.density())
         # Symmetry
         out += '\nSymmetry: %r\n' % self.xtl.Symmetry
         # Cell info
         out += self.xtl.Cell.info()
 
         if energy_kev is not None:
             out += '\n    Energy = %7.4f keV\n' % energy_kev
@@ -608,15 +607,15 @@
     def info(self):
         """Prints various properties of the crystal"""
 
         out = '\n'
         out += '-----------%s-----------\n'%self.xtl.name
         out += ' Weight: %5.2f g/mol\n' %(self.weight())
         out += ' Volume: %5.2f A^3\n' %(self.volume())
-        out += 'Density: %5.2f g/cm\n' %(self.density())
+        out += 'Density: %5.2f g/cm^3\n' %(self.density())
         out += '\nAtoms:\n'
         types = np.unique(self.xtl.Structure.type)
         props = fc.atom_properties(types) # returns a numpy structured array
         prop_names = props.dtype.names
         for key in prop_names:
             ele = '%20s :' % key
             ele += ''.join([' %10s :' %(item) for item in props[key]])
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_scattering.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_scattering.py`

 * *Files 3% similar despite different names*

```diff
@@ -3,16 +3,16 @@
 Scattering Class "classes_scattering.py"
     Scattering functions for Crystal class.
 
 By Dan Porter, PhD
 Diamond
 2017
 
-Version 2.1.1
-Last updated: 14/01/23
+Version 2.3.0
+Last updated: 02/07/23
 
 Version History:
 10/09/17 0.1    Program created
 30/10/17 1.0    Main functions finshed, some testing done
 06/01/18 1.1    Renamed classes_scattering.py
 31/10/18 1.2    Added print_symmetric_contributions
 21/01/19 1.3    Added non-resonant diffraction, corrected resonant diffraction
@@ -27,29 +27,31 @@
 10/06/21 1.9    Added x_ray calculation using Waasmaier and Kirfel scattering factors.
 09/07/21 1.9    Added new scattering factors as option on normal scattering functions
 20/08/21 2.0    Switched over to new scattering module, added self.powder()
 28/09/21 2.0.1  Added __repr__
 08/02/22 2.0.3  Corrected error in powder of wrong tth values. Thanks Mirko!
 14/03/22 2.1.0   powder() updated for new inputs and outputs for pVoight and custom peak shapes. Thanks yevgenyr!
 14/01/23 2.1.1  Corrected background error in xtl.Scatter.powder
+06/05/23 2.0.0  Merged pull request for non-integer hkl option on SF and electron form factors. Thanks Prestipino!
+02/07/23 2.3.0  Fixed rounding error in Scatter.powder, thanks Sergio I. Rincon!
 
 @author: DGPorter
 """
 
 import sys,os
 import numpy as np
 import datetime
 
 from . import functions_general as fg
 from . import functions_crystallography as fc
 from . import functions_scattering as fs
 from . import multiple_scattering as ms
 # from . import tensor_scattering as ts  # Removed V1.7
 
-__version__ = '2.1.1'
+__version__ = '2.3.0'
 __scattering_types__ = {'xray': ['xray', 'x', 'x-ray', 'thomson', 'charge'],
                         'neutron': ['neutron', 'n', 'nuclear'],
                         'xray magnetic': ['xray magnetic', 'magnetic xray', 'spin xray', 'xray spin'],
                         'neutron magnetic': ['neutron magnetic', 'magnetic neutron', 'magnetic'],
                         'xray resonant': ['xray resonant', 'resonant', 'resonant xray', 'rxs'],
                         'xray dispersion': ['dispersion', 'xray dispersion']}
 
@@ -338,39 +340,41 @@
             self._debug_mode = False
             fs.DEBUG_MODE = False
         else:
             print('Debug mode: on')
             self._debug_mode = True
             fs.DEBUG_MODE = True
 
-    def structure_factor(self, hkl=None, scattering_type=None, **kwargs):
+    def structure_factor(self, hkl=None, scattering_type=None, int_hkl=True, **kwargs):
         """
         Calculate the structure factor at reflection indexes (h,k,l)
-
         Notes:
         - Uses x-ray atomic form factors, calculated from approximated tables in the ITC
         - This may be a little slow for large numbers of reflections, as it is not currently
          possible to use accelerated calculation methods in Jython.
         - Debye-Waller factor (atomic displacement) is applied for isotropic ADPs
         - Crystal.scale is used to scale the complex structure factor, so the intensity is
          reduced by (Crystal.scale)^2
         - Testing against structure factors calculated by Vesta.exe is exactly the same when using Waasmaier structure factors.
 
         :param hkl: array[n,3] : reflection indexes (h, k, l)
         :param scattering_type: str : one of ['xray','neutron','xray magnetic','neutron magnetic','xray resonant']
+        :param int_hkl: Bool : when True, hkl values are converted to integer.
         :param kwargs: additional options to pass to scattering function
         :return: complex array[n] : structure factors
         """
 
         if hkl is None:
             hkl = self.get_hkl()
         if scattering_type is None:
             scattering_type = self._scattering_type
-
-        hkl = np.asarray(np.rint(hkl), dtype=float).reshape([-1, 3])
+        if int_hkl:
+            hkl = np.asarray(np.rint(hkl), dtype=float).reshape([-1, 3])
+        else:
+            hkl = np.asarray(hkl, dtype=float).reshape([-1, 3])
         uvw, atom_type, label, occ, uiso, mxmymz = self.xtl.Structure.get()
 
         q = self.xtl.Cell.calculateQ(hkl)
         r = self.xtl.Cell.calculateR(uvw)
 
         moment = fc.euler_moment(mxmymz, self.xtl.Cell.UV())
         azi_ref_q = self.xtl.Cell.calculateQ(self._azimuthal_reference)
@@ -409,24 +413,26 @@
         nref, natom = len(q), len(r)
         n_arrays = np.ceil(nref * natom / fs.MAX_QR_ARRAY)
         if n_arrays > 1:
             print('Splitting %d reflections (%d atoms) into %1.0f parts' % (nref, natom, n_arrays))
         q_array = np.array_split(q, n_arrays)
         sf = np.zeros([nref, nenergy, npsi], dtype=complex)
         start_time = datetime.datetime.now()
-        for e, enval in enumerate(energy_kev):
-            for p, psival in enumerate(psi):
+        for e, enval in enumerate(energy_kev): # for all the energy values
+            for p, psival in enumerate(psi):   # for all azimutal angle
                 ls = 0
-                for n, _q in enumerate(q_array):
+                for n, _q in enumerate(q_array): # for all the reflections parts
                     if n_arrays > 1:
                         print(' Starting %2.0f/%2.0f: %d:%d' % (n + 1, n_arrays, ls, ls + len(_q)))
-                    qmag = fg.mag(_q)
+                    qmag = fg.mag(_q)      # q magnitude
                     # Scattering factors
                     if scattering_type in fs.SCATTERING_TYPES['neutron']:
                         ff = fc.atom_properties(atom_type, 'Coh_b')
+                    elif scattering_type in fs.SCATTERING_TYPES['electron']:
+                        ff = fc.electron_scattering_factor(atom_type, qmag)
                     elif scattering_type in fs.SCATTERING_TYPES['xray fast']:
                         ff = fc.atom_properties(atom_type, 'Z')
                     elif scattering_type in fs.SCATTERING_TYPES['xray dispersion']:
                         ff = fc.xray_scattering_factor_resonant(atom_type, qmag, enval)
                     elif self._use_waaskirf_scattering_factor:
                         ff = fc.xray_scattering_factor_WaasKirf(atom_type, qmag)
                     else:
@@ -465,22 +471,24 @@
         if nenergy == 1:
             return sf[:, 0, :]  # shape(nref, nenergy)
         if npsi == 1:
             return sf[:, :, 0]  # shape(nref, nspi)
         return sf
     new_structure_factor = structure_factor
 
-    def intensity(self, hkl=None, scattering_type=None, **options):
+    def intensity(self, hkl=None, scattering_type=None, int_hkl=True, **options):
         """
-
-        :param hkl:
-        :param scattering_type: str : one of ['xray','neutron','xray magnetic','neutron magnetic','xray resonant']
-        :return:
+        Return the structure factor squared
+        :param hkl: array[n,3] : reflection indexes (h, k, l)
+        :param scattering_type: str : one of ['xray','neutron', 'electron', 'xray magnetic','neutron magnetic','xray resonant']
+        :param int_hkl: Bool : when True, hkl values are converted to integer.
+        :param kwargs: additional options to pass to scattering function
+        :return: float array[n] : array of |SF|^2
         """
-        return fs.intensity(self.new_structure_factor(hkl, scattering_type, **options))
+        return fs.intensity(self.new_structure_factor(hkl, scattering_type, int_hkl, **options))
     new_intensity = intensity
 
     def powder(self, scattering_type=None, units=None, peak_width=None, background=None, pixels=None,
                powder_average=None, lorentz_fraction=None, custom_peak=None, min_overlap=None, **options):
         """
         Generates array of intensities along a spaced grid, equivalent to a powder pattern.
           tth, inten, reflections = Scatter.powder('xray', units='tth', energy_kev=8)
@@ -525,40 +533,38 @@
         if min_twotheta <= 0: min_twotheta = 1.0
         max_twotheta = self._scattering_max_twotheta
         q_min = fc.calqmag(min_twotheta, energy_kev)
         q_max = fc.calqmag(max_twotheta, energy_kev)
         q_range = q_max - q_min
 
         # Get reflections
-        hmax, kmax, lmax = fc.maxHKL(q_max, self.xtl.Cell.UVstar())
-        HKL = fc.genHKL([hmax, -hmax], [kmax, -kmax], [lmax, -lmax])
+        HKL = self.xtl.Cell.all_hkl(maxq=q_max)
         HKL = self.xtl.Cell.sort_hkl(HKL)  # required for labels
         Qmag = self.xtl.Cell.Qmag(HKL)
-        select = (Qmag < q_max) * (Qmag > q_min)
+
+        # create plotting mesh
+        tot_pixels = int(pixels * q_range)  # reduce this to make convolution faster
+        pixel_size = q_range / float(tot_pixels)
+        peak_width_pixels = peak_width / pixel_size
+        mesh = np.zeros([tot_pixels])
+        mesh_q = np.linspace(q_min, q_max, tot_pixels)
+        pixel_coord = np.round(tot_pixels * (Qmag - q_min) / q_range).astype(int)
+
+        select = (pixel_coord < tot_pixels) * (pixel_coord > 0)
         HKL = HKL[select, :]
         Qmag = Qmag[select]
+        pixel_coord = pixel_coord[select]
 
         # Calculate intensities
         I = self.intensity(HKL, scattering_type, **options)
 
         if powder_average:
             # Apply powder averging correction, I0/|Q|**2
             I = I/(Qmag+0.001)**2
 
-        # create plotting mesh
-        tot_pixels = int(pixels * q_range)  # reduce this to make convolution faster
-        pixel_size = q_range / float(tot_pixels)
-        peak_width_pixels = peak_width / pixel_size
-        mesh = np.zeros([tot_pixels])
-        mesh_q = np.linspace(q_min, q_max, tot_pixels)
-
-        # add reflections to background
-        pixel_coord = (Qmag - q_min) / q_range
-        pixel_coord = (pixel_coord * tot_pixels).round().astype(int)
-
         for n in range(len(I)):
             mesh[pixel_coord[n]] = mesh[pixel_coord[n]] + I[n]
 
         # Convolve with a function (if > 0)
         if custom_peak is not None:
             mesh = np.convolve(mesh, custom_peak, mode='same')
         elif peak_width > 0:
@@ -616,15 +622,15 @@
             dw = 1
         
         # Calculate dot product
         dot_KR = np.dot(HKL, uvw.T)
         
         # Calculate structure factor
         # Broadcasting used on 2D ff
-        SF =  np.sum(ff*dw*occ*np.exp(1j*2*np.pi*dot_KR),axis=1)
+        SF =  np.sum(ff*dw*occ*np.exp(1j*2*np.pi*dot_KR), axis=1)
         #SF = np.zeros(Nref,dtype=complex)
         #for ref in range(Nref):
         #    for at in range(Nat): 
         #        SF[ref] += ff[ref,at]*dw[ref,at]*occ[at]*np.exp(1j*2*np.pi*dot_KR[ref,at])
         
         SF = SF/self.xtl.scale
         
@@ -716,15 +722,24 @@
         sf = sf / self.xtl.scale
 
         if self._return_structure_factor: return sf
 
         # Calculate intensity
         I = sf * np.conj(sf)
         return np.real(I)
-    
+
+    def electron(self, HKL):
+        """
+        Calculate the squared structure factor for the given HKL, using electron form factors
+          Scattering.electron([1,0,0])
+          Scattering.electron([[1,0,0],[2,0,0],[3,0,0])
+        Returns an array with the same length as HKL, giving the real intensity at each reflection.
+        """
+        return self.intensity(HKL, scattering_type='electron')
+
     def neutron(self, HKL):
         """
         Calculate the squared structure factor for the given HKL, using neutron scattering length
           Scattering.neutron([1,0,0])
           Scattering.neutron([[1,0,0],[2,0,0],[3,0,0])
         Returns an array with the same length as HKL, giving the real intensity at each reflection.
         """
@@ -1106,15 +1121,15 @@
 
         # Calculate intensity
         I = SF * np.conj(SF)
         return np.real(I)
 
     def xray_resonant_magnetic(self, HKL, energy_kev=None, azim_zero=[1, 0, 0], psi=0, polarisation='s-p', F0=0, F1=1, F2=0, disp=True):
         """
-        Calculate the non-resonant magnetic component of the structure factor
+        Calculate the resonant magnetic component of the structure factor
         for the given HKL, using x-ray rules and form factor
           Scattering.xray_magnetic([1,0,0])
           Scattering.xray_magnetic([[1,0,0],[2,0,0],[3,0,0])
         Returns an array with the same length as HKL, giving the real intensity at each reflection.
 
         From Hill+McMorrow Acta Cryst. 1996 A52, 236-244 Equ. (2)
         Book: "X-ray Scattering and Absorption by Magnetic Materials" by Loevesy and Collins. Ch 2. Eqn.2.21+1
@@ -1347,19 +1362,20 @@
         INM=self.magnetic_neutron(HKL)*1e4
         IXM=self.xray_magnetic(HKL)*1e4
         IXRss=self.xray_resonant(HKL, None, 'ss')
         IXRsp=self.xray_resonant(HKL, None, 'sp')
         IXRps=self.xray_resonant(HKL, None, 'ps')
         IXRpp=self.xray_resonant(HKL, None, 'pp')
         
-        fmt = '(%2.0f,%2.0f,%2.0f)  %8.1f  %8.1f  %8.2f  %8.2f  ss=%8.2f  sp=%8.2f  ps=%8.2f  pp=%8.2f'
-        print('( h, k, l)   Neutron      xray   Magn. N  Magn. XR   sig-sig    sig-pi    pi-sig     pi-pi')
+        fmt = '(%2.0f,%2.0f,%2.0f)  %8.1f  %8.1f  %8.2f  %8.2f  ss=%8.2f  sp=%8.2f  ps=%8.2f  pp=%8.2f\n'
+        outstr = '( h, k, l)   Neutron      xray   Magn. N  Magn. XR   sig-sig    sig-pi    pi-sig     pi-pi\n'
         for n in range(len(HKL)):
             vals=(HKL[n][0],HKL[n][1],HKL[n][2],IN[n],IX[n],INM[n],IXM[n],IXRss[n],IXRsp[n],IXRps[n],IXRpp[n])
-            print(fmt%vals)
+            outstr += fmt % vals
+        return outstr
     
     def old_intensity(self, HKL, scattering_type=None):
         """
         Calculate the squared structure factor for the given HKL
           Crystal.intensity([1,0,0])
           Crystal.intensity([[1,0,0],[2,0,0],[3,0,0])
         Returns an array with the same length as HKL, giving the real intensity at each reflection.
@@ -1581,14 +1597,142 @@
 
         if powder_average:
             q = self.xtl.Cell.Qmag(rhkl)
             rinten = rinten/(q+0.001)**2
 
         return rhkl, rinten
 
+    def detector_image(self, detector_distance_mm=100., delta=0, gamma=0, height_mm=100., width_mm=100.,
+                       pixel_size_mm=0.1, energy_range_ev=1000., peak_width_deg=0.5, wavelength_a=None,
+                       background=0, min_intensity=0.01):
+        """
+        Calcualte detector image
+          Creates a detector rotated about the sample and generates incident reflections on the detector.
+          Reflections incident on the detector are scaled by the distance of the scattered wavevector from the Ewald
+          sphere and also scaled by all reflections incident on the Ewald sphere.
+        Example
+          tth = xtl.Cell.tth([0, 0, 2], wavelength_a=1)[0]
+          xtl.Cell.orientation.rotate_6circle(mu=tth/2)  # Orient crystal to scattering position
+          xx, yy, mesh, reflist = xtl.Scatter.detector_image(detector_distance_mm=100, gamma=tth, wavelength_a=1)
+          # Plot detector image
+          plt.figure()
+          plt.pcolormesh(xx, yy, mesh, vmin=0, vmax=1, shading='auto')
+          # reflection labels
+          for n in range(len(reflist['hkl'])):
+              plt.text(reflist['detx'][n], reflist['dety'][n], reflist['hkl_str'][n], c='w')
+        :param detector_distance_mm: float, Detector distance in mm (along (0,1,0))
+        :param delta: flaot, angle to rotate detector about (0,0,1) in Deg
+        :param gamma: float, angle to rotate detector about (1,0,0) in Deg
+        :param height_mm: float, detector size vertically (along (0,0,1))
+        :param width_mm: float, detector size horizontally (along (1,0,0))
+        :param pixel_size_mm: float, size of pixels, determines grid size
+        :param energy_range_ev: float, determines width of energies in incident intensity in eV
+        :param peak_width_deg: float, determines peak width on detector
+        :param wavelength_a: float, wavelength in A
+        :param background: float, detector background
+        :param min_intensity: float, min intenisty to include
+        :return xx: [height//pixelsize x width//pixelsize] array of x-coordinates
+        :return yy: [height//pixelsize x width//pixelsize] array of y-coordinates
+        :return mesh: [height//pixelsize x width//pixelsize] array of intensities
+        :return reflist: dict with info about each reflection on detector
+        """
+        domain_size = fc.scherrer_size(peak_width_deg, 45, wavelength_a=wavelength_a)  # A
+        peak_width = fc.dspace2q(domain_size)  # inverse Angstrom
+        resolution = fc.wavevector(energy_kev=energy_range_ev / 1000.)  # inverse Angstrom
+
+        # Define Detector
+        D = fc.rotmatrixz(-delta)  # left handed
+        G = fc.rotmatrixx(gamma)
+        R = np.dot(G, D)
+        lab = self.xtl.Cell.orientation.labframe
+        initial_position = detector_distance_mm * np.array([0, 1., 0])
+        position_mm = fc.labvector(initial_position, R=R, LAB=lab)
+        normal_dir = fc.labvector([0, -1, 0], R=R, LAB=lab)
+        x_axis = width_mm * fg.norm(np.cross(normal_dir, (0, 0, 1.)))
+        z_axis = height_mm * fg.norm(np.cross(x_axis, normal_dir))
+        pixels_width = int(width_mm / pixel_size_mm) + 1  # n pixels
+        distance_mm = fg.mag(position_mm)
+        fwhm_mm = distance_mm * np.tan(np.deg2rad(peak_width_deg))
+        corners = np.array([
+            position_mm + x_axis / 2 + z_axis / 2,
+            position_mm + x_axis / 2 - z_axis / 2,
+            position_mm - x_axis / 2 - z_axis / 2,
+            position_mm - x_axis / 2 + z_axis / 2,
+        ])
+
+        # Define lattice
+        if wavelength_a is None:
+            wavelength_a = fc.energy2wave(self.get_energy())
+        hkl = self.xtl.Cell.all_hkl(max_angle=180, wavelength_a=wavelength_a)
+        qxqyqz = self.xtl.Cell.calculateQ(hkl)
+
+        # Find lattice points incident on detector
+        lab = self.xtl.Cell.orientation.labframe
+        ki = fc.wavevector(wavelength=wavelength_a) * fc.labvector([0, 1, 0], LAB=lab)
+        kf = qxqyqz + ki
+        directions = fg.norm(kf)
+        diff = fc.wavevector_difference(qxqyqz, ki)  # difference in A-1
+
+        corner_angle = max(abs(fg.vectors_angle_degrees(position_mm, corners)))
+        vec_angles = abs(fg.vectors_angle_degrees(position_mm, directions))
+        check = vec_angles < corner_angle  # reflections in the right quadrant
+        ixyz = np.nan * np.zeros([len(directions), 3])
+        for n in np.flatnonzero(check):
+            ixyz[n] = fg.plane_intersection((0, 0, 0), directions[n], position_mm, normal_dir)
+        # incident positions on detector
+        iuvw = fg.index_coordinates(np.subtract(ixyz, position_mm), [x_axis, z_axis, normal_dir])
+        iuvw[np.any(abs(iuvw) > 0.5, axis=1)] = [np.nan, np.nan, np.nan]
+
+        # Remove non-incident reflections
+        idx = ~np.isnan(iuvw[:, 0])
+        hkl = hkl[idx, :]
+        qxqyqz = qxqyqz[idx, :]
+        iuvw = iuvw[idx, :]
+
+        # Calculate intensities
+        intensity = self.xtl.Scatter.intensity(hkl)
+        res = np.sqrt(resolution ** 2 + peak_width ** 2)  # combine resolutions in A-1
+        scaled_inten = fc.scale_intensity(intensity, diff[idx], res)
+        scale = sum(fc.scale_intensity(1, diff, res))
+        scaled_inten = scaled_inten / scale  # reduce intensity by total reflected intensity
+        good = scaled_inten > min_intensity  # minimise the number of gaussians to generate
+
+        # Calculate peak widths etc.
+        qmag = fg.mag(qxqyqz[good])
+        tth = fc.cal2theta(qmag, wavelength_a=wavelength_a)
+        tth = 1.0 * tth
+        tth[tth > 175] = 175.  # stop peaks becoming too broad at high angle
+        fwhm = fc.scherrer_fwhm(domain_size, tth, wavelength_a=wavelength_a)
+        hkl_str = np.array(fc.hkl2str(hkl[good]).split('\n'))
+        peak_x = width_mm * iuvw[good, 0]
+        peak_z = height_mm * iuvw[good, 1]
+
+        # Generate the detector plane using gaussians on a plane
+        xx, yy, mesh = fc.peaks_on_plane(
+            peak_x=peak_x,
+            peak_y=peak_z,
+            peak_height=scaled_inten[good],
+            peak_width=fwhm_mm,
+            max_x=width_mm / 2,
+            max_y=height_mm / 2,
+            pixels_width=pixels_width,
+            background=background
+        )
+        reflist = {
+            'hkl': hkl[good, :],
+            'hkl_str': hkl_str,
+            'qxqyqz': qxqyqz[good, :],
+            'fwhm': fwhm,
+            'intensity': intensity[good],
+            'scaled': scaled_inten[good],
+            'detx': peak_x,
+            'dety': peak_z,
+        }
+        return xx, yy, mesh, reflist
+
     def print_all_reflections(self, energy_kev=None, print_symmetric=False,
                               min_intensity=0.01, max_intensity=None, units=None):
         """
         Prints a list of all allowed reflections at this energy
             energy_kev = energy in keV
             print_symmetric = False*/True : omits reflections with the same intensity at the same angle
             min_intensity = None/ 0.01 : omits reflections less than this (remove extinctions)
@@ -1764,19 +1908,91 @@
             if inten[n] > max_intensity: continue
             if not pos_theta[n]: continue
             # if not print_symmetric and np.abs(tth[n]-tth[n-1]) < 0.01: continue # only works if sorted
             count += 1
             outstr += fmt % (HKL[n, 0], HKL[n, 1], HKL[n, 2], tth[n], theta[n], inten[n])
         outstr += ('Reflections: %1.0f\n' % count)
         return outstr
-    
-    def print_symmetric_reflections(self,HKL):
-        "Prints equivalent reflections"
+
+    def print_xray_resonant(self, HKL, energy_kev=None, azim_zero=(1, 0, 0), psi=0, F0=0, F1=1, F2=0):
+        """
+        Return string with resonant magnetic contriubtions to the x-ray scattering
+        :param HKL: array(nx3) of (h,k,l) reflections
+        :param energy_kev: incident photon energy in keV
+        :param azim_zero: (h,k,l) reference vector defining azimuthal zero angle
+        :param psi: float, azimuthal angle
+        :param F0, F1, F2: Resonance factor Flm
+        :return: str
+        """
+        HKL = np.asarray(HKL, dtype=float).reshape([-1, 3])
+        inp = {
+            'HKL': HKL,
+            'energy_kev': energy_kev,
+            'azim_zero': azim_zero,
+            'psi': psi,
+            'F0': F0, 'F1': F1, 'F2': F2,
+            'disp': False
+        }
+        xr = self.x_ray(HKL)
+        ss = self.xray_resonant_magnetic(polarisation='ss', **inp)
+        sp = self.xray_resonant_magnetic(polarisation='sp', **inp)
+        ps = self.xray_resonant_magnetic(polarisation='ps', **inp)
+        pp = self.xray_resonant_magnetic(polarisation='pp', **inp)
+
+        tth = self.xtl.Cell.tth(HKL, energy_kev)
+        hkl_str = ['({:3.0f},{:3.0f},{:3.0f})'.format(*h) for h in HKL]
+
+        outstr = 'Resonant Magnetic X-Ray scattering: %s\n' % self.xtl.name
+        outstr += u'Energy = %6.3f keV (%.3f \u212B)\n' % (energy_kev, fc.energy2wave(energy_kev))
+        outstr += u'azimuth = %.2f Deg, azim_zero = %s || incident beam\n' % (psi, fc.hkl2str(azim_zero))
+        outstr += '(  h,  k,  l)  Two-Theta      Charge      '\
+                  '\u03c3-\u03c3       \u03c3-\u03c0       \u03c0-\u03c3       \u03c0-\u03c0\n'
+        fmt = '%s %10.2f  %9.2f  %8.4f  %8.4f  %8.4f  %8.4f'
+        outstr += '\n'.join([fmt % (hkl_str[n], tth[n], xr[n], ss[n], sp[n], ps[n], pp[n]) for n in range(len(HKL))])
+        return outstr
+
+    def print_xray_nonresonant(self, HKL, energy_kev=None, azim_zero=(1, 0, 0), psi=0):
+        """
+        Return string with non-resonant magnetic contriubtions to the x-ray scattering
+        :param HKL: array(nx3) of (h,k,l) reflections
+        :param energy_kev: incident photon energy in keV
+        :param azim_zero: (h,k,l) reference vector defining azimuthal zero angle
+        :param psi: float, azimuthal angle
+        :return: str
+        """
+        HKL = np.asarray(HKL, dtype=float).reshape([-1, 3])
+        inp = {
+            'HKL': HKL,
+            'energy_kev': energy_kev,
+            'azim_zero': azim_zero,
+            'psi': psi,
+            'disp': False
+        }
+        xr = self.x_ray(HKL)
+        ss = self.xray_nonresonant_magnetic(polarisation='ss', **inp)
+        sp = self.xray_nonresonant_magnetic(polarisation='sp', **inp)
+        ps = self.xray_nonresonant_magnetic(polarisation='ps', **inp)
+        pp = self.xray_nonresonant_magnetic(polarisation='pp', **inp)
+
+        tth = self.xtl.Cell.tth(HKL, energy_kev)
+        hkl_str = ['({:3.0f},{:3.0f},{:3.0f})'.format(*h) for h in HKL]
+
+        outstr = 'NonResonant Magnetic X-Ray scattering: %s\n' % self.xtl.name
+        outstr += u'Energy = %6.3f keV (%.3f \u212B)\n' % (energy_kev, fc.energy2wave(energy_kev))
+        outstr += u'azimuth = %.2f Deg, azim_zero = %s || incident beam\n' % (psi, fc.hkl2str(azim_zero))
+        outstr += '(  h,  k,  l)  Two-Theta      Charge      '\
+                  '\u03c3-\u03c3       \u03c3-\u03c0       \u03c0-\u03c3       \u03c0-\u03c0\n'
+        fmt = '%s %10.2f  %9.2f  %8.4f  %8.4f  %8.4f  %8.4f'
+        outstr += '\n'.join([fmt % (hkl_str[n], tth[n], xr[n], ss[n], sp[n], ps[n], pp[n]) for n in range(len(HKL))])
+        return outstr
+
+    def print_symmetric_reflections(self, HKL):
+        """Prints equivalent reflections"""
         
-        symHKL = self.xtl.Symmetry.symmetric_reflections(HKL)
+        symHKL = self.xtl.Symmetry.symmetric_reflections_unique(HKL)
         Nsyms = len(symHKL)
         outstr = ''
         outstr+= 'Equivalent reflections: %d\n' % Nsyms
         for n in range(Nsyms):
             outstr+= '(%5.3g,%5.3g,%5.3g)\n' % (symHKL[n,0],symHKL[n,1],symHKL[n,2])
         return outstr
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/classes_structures.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/classes_structures.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/Dans Element Properties.txt` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/Dans Element Properties.txt`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/Dans Element Properties_old.txt` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/Dans Element Properties_old.txt`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/Element_OxidationStates.txt` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/Element_OxidationStates.txt`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/PointGroups.json` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/PointGroups.json`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/SpaceGroups.json` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/SpaceGroups.json`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/SpaceGroupsMagnetic.json` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/SpaceGroupsMagnetic.json`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/XRayEdges.dat` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/XRayEdges.dat`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/XRayMassAtten_muenp.dat` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/XRayMassAtten_muenp.dat`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/XRayMassAtten_mup.dat` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/XRayMassAtten_mup.dat`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/atomic_scattering_factors.npy` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/atomic_scattering_factors.npy`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/data/f0_WaasKirf.dat` & `Dans_Diffraction-3.0.0/Dans_Diffraction/data/f0_WaasKirf.dat`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/functions_crystallography.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/functions_crystallography.py`

 * *Files 8% similar despite different names*

```diff
@@ -9,17 +9,17 @@
 00000080: 6973 2066 696c 6520 696e 2061 6e20 696e  is file in an in
 00000090: 7465 7261 6374 6976 6520 636f 6e73 6f6c  teractive consol
 000000a0: 650d 0a20 2020 204f 520d 0a20 2020 202d  e..    OR..    -
 000000b0: 2066 726f 6d20 4461 6e73 5f44 6966 6672   from Dans_Diffr
 000000c0: 6163 7469 6f6e 2069 6d70 6f72 7420 6675  action import fu
 000000d0: 6e63 7469 6f6e 735f 6372 7973 7461 6c6c  nctions_crystall
 000000e0: 6f67 7261 7068 7920 6173 2066 630d 0a0d  ography as fc...
-000000f0: 0a56 6572 7369 6f6e 2033 2e37 2e32 0d0a  .Version 3.7.2..
-00000100: 4c61 7374 2075 7064 6174 6564 3a20 3233  Last updated: 23
-00000110: 2f30 342f 3232 0d0a 0d0a 5665 7273 696f  /04/22....Versio
+000000f0: 0a56 6572 7369 6f6e 2033 2e38 2e31 0d0a  .Version 3.8.1..
+00000100: 4c61 7374 2075 7064 6174 6564 3a20 3232  Last updated: 22
+00000110: 2f30 352f 3233 0d0a 0d0a 5665 7273 696f  /05/23....Versio
 00000120: 6e20 4869 7374 6f72 793a 0d0a 3039 2f30  n History:..09/0
 00000130: 372f 3135 2030 2e31 2020 2020 5665 7273  7/15 0.1    Vers
 00000140: 696f 6e20 4869 7374 6f72 7920 7374 6172  ion History star
 00000150: 7465 642e 0d0a 3330 2f31 302f 3137 2031  ted...30/10/17 1
 00000160: 2e30 2020 2020 4d61 6e79 2075 7064 6174  .0    Many updat
 00000170: 6573 0d0a 3036 2f30 312f 3138 2032 2e30  es..06/01/18 2.0
 00000180: 2020 2020 5265 6e61 6d65 6420 6675 6e63      Renamed func
@@ -132,7236 +132,8434 @@
 00000830: 322f 3031 2f32 3220 332e 372e 3120 2041  2/01/22 3.7.1  A
 00000840: 6464 6564 2067 656e 5f73 796d 5f61 7869  dded gen_sym_axi
 00000850: 616c 5f76 6563 746f 720d 0a32 332f 3034  al_vector..23/04
 00000860: 2f32 3220 332e 372e 3220 2043 6f72 7265  /22 3.7.2  Corre
 00000870: 6374 6564 206d 6167 6e69 7475 6465 206f  cted magnitude o
 00000880: 6620 5120 696e 206d 6167 6e65 7469 635f  f Q in magnetic_
 00000890: 7374 7275 6374 7572 655f 6661 6374 6f72  structure_factor
-000008a0: 730d 0a0d 0a41 636b 6e6f 6c65 6467 656d  s....Acknoledgem
-000008b0: 656e 7473 3a0d 0a20 2020 2041 7072 696c  ents:..    April
-000008c0: 2032 3032 3020 2054 6861 6e6b 7320 746f   2020  Thanks to
-000008d0: 2043 6875 6e48 6169 2057 616e 6720 666f   ChunHai Wang fo
-000008e0: 7220 6865 6c70 6675 6c20 7375 6767 6573  r helpful sugges
-000008f0: 7469 6f6e 7320 696e 2072 6561 6463 6966  tions in readcif
-00000900: 210d 0a0d 0a40 6175 7468 6f72 3a20 4447  !....@author: DG
-00000910: 506f 7274 6572 0d0a 2222 220d 0a0d 0a69  Porter.."""....i
-00000920: 6d70 6f72 7420 7379 732c 206f 732c 2072  mport sys, os, r
-00000930: 650d 0a69 6d70 6f72 7420 6a73 6f6e 0d0a  e..import json..
-00000940: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-00000950: 6e70 0d0a 6672 6f6d 2077 6172 6e69 6e67  np..from warning
-00000960: 7320 696d 706f 7274 2077 6172 6e0d 0a0d  s import warn...
-00000970: 0a66 726f 6d20 2e20 696d 706f 7274 2066  .from . import f
-00000980: 756e 6374 696f 6e73 5f67 656e 6572 616c  unctions_general
-00000990: 2061 7320 6667 0d0a 0d0a 5f5f 7665 7273   as fg....__vers
-000009a0: 696f 6e5f 5f20 3d20 2733 2e37 2e32 270d  ion__ = '3.7.2'.
-000009b0: 0a0d 0a23 2046 696c 6520 6469 7265 6374  ...# File direct
-000009c0: 6f72 7920 2d20 6c6f 6361 7469 6f6e 206f  ory - location o
-000009d0: 6620 2244 616e 7320 456c 656d 656e 7420  f "Dans Element 
-000009e0: 5072 6f70 6572 7469 6573 2e74 7874 220d  Properties.txt".
-000009f0: 0a64 6174 6164 6972 203d 206f 732e 7061  .datadir = os.pa
-00000a00: 7468 2e61 6273 7061 7468 286f 732e 7061  th.abspath(os.pa
-00000a10: 7468 2e64 6972 6e61 6d65 285f 5f66 696c  th.dirname(__fil
-00000a20: 655f 5f29 2920 2023 2073 616d 6520 6469  e__))  # same di
-00000a30: 7265 6374 6f72 7920 6173 2074 6869 7320  rectory as this 
-00000a40: 6669 6c65 0d0a 6461 7461 6469 7220 3d20  file..datadir = 
-00000a50: 6f73 2e70 6174 682e 6a6f 696e 2864 6174  os.path.join(dat
-00000a60: 6164 6972 2c20 2764 6174 6127 290d 0a41  adir, 'data')..A
-00000a70: 544f 4d46 494c 4520 3d20 6f73 2e70 6174  TOMFILE = os.pat
-00000a80: 682e 6a6f 696e 2864 6174 6164 6972 2c20  h.join(datadir, 
-00000a90: 2744 616e 7320 456c 656d 656e 7420 5072  'Dans Element Pr
-00000aa0: 6f70 6572 7469 6573 2e74 7874 2729 0d0a  operties.txt')..
-00000ab0: 0d0a 2320 4c69 7374 206f 6620 456c 656d  ..# List of Elem
-00000ac0: 656e 7473 2069 6e20 6f72 6465 7220 736f  ents in order so
-00000ad0: 7274 6564 2062 7920 6c65 6e67 7468 206f  rted by length o
-00000ae0: 6620 6e61 6d65 0d0a 454c 454d 454e 545f  f name..ELEMENT_
-00000af0: 4c49 5354 203d 205b 0d0a 2020 2020 275a  LIST = [..    'Z
-00000b00: 7227 2c20 274d 6f27 2c20 2745 7327 2c20  r', 'Mo', 'Es', 
-00000b10: 2745 7527 2c20 2746 6527 2c20 2746 6c27  'Eu', 'Fe', 'Fl'
-00000b20: 2c20 2746 6d27 2c20 2746 7227 2c20 2747  , 'Fm', 'Fr', 'G
-00000b30: 6127 2c20 2747 6427 2c20 2747 6527 2c0d  a', 'Gd', 'Ge',.
-00000b40: 0a20 2020 2027 4865 272c 2027 4866 272c  .    'He', 'Hf',
-00000b50: 2027 4867 272c 2027 486f 272c 2027 4873   'Hg', 'Ho', 'Hs
-00000b60: 272c 2027 496e 272c 2027 4972 272c 2027  ', 'In', 'Ir', '
-00000b70: 4b72 272c 2027 4c61 272c 2027 4c69 272c  Kr', 'La', 'Li',
-00000b80: 2027 4c72 272c 0d0a 2020 2020 274c 7527   'Lr',..    'Lu'
-00000b90: 2c20 274c 7627 2c20 274d 6327 2c20 275a  , 'Lv', 'Mc', 'Z
-00000ba0: 6e27 2c20 274d 6727 2c20 2745 7227 2c20  n', 'Mg', 'Er', 
-00000bb0: 2744 7927 2c20 2744 7327 2c20 2742 6b27  'Dy', 'Ds', 'Bk'
-00000bc0: 2c20 2741 6727 2c20 2741 6c27 2c0d 0a20  , 'Ag', 'Al',.. 
-00000bd0: 2020 2027 416d 272c 2027 4172 272c 2027     'Am', 'Ar', '
-00000be0: 4173 272c 2027 4174 272c 2027 4175 272c  As', 'At', 'Au',
-00000bf0: 2027 4261 272c 2027 4265 272c 2027 4268   'Ba', 'Be', 'Bh
-00000c00: 272c 2027 4269 272c 2027 4272 272c 2027  ', 'Bi', 'Br', '
-00000c10: 4462 272c 0d0a 2020 2020 2743 6127 2c20  Db',..    'Ca', 
-00000c20: 2743 6427 2c20 2743 6527 2c20 2743 6627  'Cd', 'Ce', 'Cf'
-00000c30: 2c20 2743 6c27 2c20 2743 6d27 2c20 2743  , 'Cl', 'Cm', 'C
-00000c40: 6e27 2c20 2743 6f27 2c20 2743 7227 2c20  n', 'Co', 'Cr', 
-00000c50: 2743 7327 2c20 2743 7527 2c0d 0a20 2020  'Cs', 'Cu',..   
-00000c60: 2027 4d6e 272c 2027 4d64 272c 2027 4d74   'Mn', 'Md', 'Mt
-00000c70: 272c 2027 5262 272c 2027 5266 272c 2027  ', 'Rb', 'Rf', '
-00000c80: 5268 272c 2027 526e 272c 2027 5275 272c  Rh', 'Rn', 'Ru',
-00000c90: 2027 5362 272c 2027 5363 272c 2027 5365   'Sb', 'Sc', 'Se
-00000ca0: 272c 0d0a 2020 2020 2753 6727 2c20 2753  ',..    'Sg', 'S
-00000cb0: 6927 2c20 2753 6d27 2c20 2753 6e27 2c20  i', 'Sm', 'Sn', 
-00000cc0: 2753 7227 2c20 2754 6127 2c20 2754 6227  'Sr', 'Ta', 'Tb'
-00000cd0: 2c20 2754 6327 2c20 2754 6527 2c20 2754  , 'Tc', 'Te', 'T
-00000ce0: 6827 2c20 2754 6927 2c0d 0a20 2020 2027  h', 'Ti',..    '
-00000cf0: 546c 272c 2027 546d 272c 2027 5473 272c  Tl', 'Tm', 'Ts',
-00000d00: 2027 5865 272c 2027 5962 272c 2027 5265   'Xe', 'Yb', 'Re
-00000d10: 272c 2027 5267 272c 2027 4163 272c 2027  ', 'Rg', 'Ac', '
-00000d20: 5062 272c 2027 4e68 272c 2027 4e69 272c  Pb', 'Nh', 'Ni',
-00000d30: 0d0a 2020 2020 274e 6f27 2c20 274e 7027  ..    'No', 'Np'
-00000d40: 2c20 274e 6427 2c20 2752 6127 2c20 274f  , 'Nd', 'Ra', 'O
-00000d50: 6727 2c20 274f 7327 2c20 2750 6127 2c20  g', 'Os', 'Pa', 
-00000d60: 2750 6427 2c20 274e 6227 2c20 2750 6d27  'Pd', 'Nb', 'Pm'
-00000d70: 2c20 2750 6f27 2c0d 0a20 2020 2027 5072  , 'Po',..    'Pr
-00000d80: 272c 2027 5074 272c 2027 4e61 272c 2027  ', 'Pt', 'Na', '
-00000d90: 5075 272c 2027 4e65 272c 2027 4227 2c20  Pu', 'Ne', 'B', 
-00000da0: 2757 272c 2027 5627 2c20 2759 272c 2027  'W', 'V', 'Y', '
-00000db0: 5527 2c20 2746 272c 2027 4b27 2c0d 0a20  U', 'F', 'K',.. 
-00000dc0: 2020 2027 4327 2c20 2749 272c 2027 5027     'C', 'I', 'P'
-00000dd0: 2c20 2748 272c 2027 5327 2c20 274e 272c  , 'H', 'S', 'N',
-00000de0: 2027 4f27 2c0d 0a20 2020 2027 7a72 272c   'O',..    'zr',
-00000df0: 2027 6d6f 272c 2027 6573 272c 2027 6575   'mo', 'es', 'eu
-00000e00: 272c 2027 6665 272c 2027 666c 272c 2027  ', 'fe', 'fl', '
-00000e10: 666d 272c 2027 6672 272c 2027 6761 272c  fm', 'fr', 'ga',
-00000e20: 2027 6764 272c 2027 6765 272c 0d0a 2020   'gd', 'ge',..  
-00000e30: 2020 2768 6527 2c20 2768 6627 2c20 2768    'he', 'hf', 'h
-00000e40: 6727 2c20 2768 6f27 2c20 2768 7327 2c20  g', 'ho', 'hs', 
-00000e50: 2769 6e27 2c20 2769 7227 2c20 276b 7227  'in', 'ir', 'kr'
-00000e60: 2c20 276c 6127 2c20 276c 6927 2c20 276c  , 'la', 'li', 'l
-00000e70: 7227 2c0d 0a20 2020 2027 6c75 272c 2027  r',..    'lu', '
-00000e80: 6c76 272c 2027 6d63 272c 2027 7a6e 272c  lv', 'mc', 'zn',
-00000e90: 2027 6d67 272c 2027 6572 272c 2027 6479   'mg', 'er', 'dy
-00000ea0: 272c 2027 6473 272c 2027 626b 272c 2027  ', 'ds', 'bk', '
-00000eb0: 6167 272c 2027 616c 272c 0d0a 2020 2020  ag', 'al',..    
-00000ec0: 2761 6d27 2c20 2761 7227 2c20 2761 7327  'am', 'ar', 'as'
-00000ed0: 2c20 2761 7427 2c20 2761 7527 2c20 2762  , 'at', 'au', 'b
-00000ee0: 6127 2c20 2762 6527 2c20 2762 6827 2c20  a', 'be', 'bh', 
-00000ef0: 2762 6927 2c20 2762 7227 2c20 2764 6227  'bi', 'br', 'db'
-00000f00: 2c0d 0a20 2020 2027 6361 272c 2027 6364  ,..    'ca', 'cd
-00000f10: 272c 2027 6365 272c 2027 6366 272c 2027  ', 'ce', 'cf', '
-00000f20: 636c 272c 2027 636d 272c 2027 636e 272c  cl', 'cm', 'cn',
-00000f30: 2027 636f 272c 2027 6372 272c 2027 6373   'co', 'cr', 'cs
-00000f40: 272c 2027 6375 272c 0d0a 2020 2020 276d  ', 'cu',..    'm
-00000f50: 6e27 2c20 276d 6427 2c20 276d 7427 2c20  n', 'md', 'mt', 
-00000f60: 2772 6227 2c20 2772 6627 2c20 2772 6827  'rb', 'rf', 'rh'
-00000f70: 2c20 2772 6e27 2c20 2772 7527 2c20 2773  , 'rn', 'ru', 's
-00000f80: 6227 2c20 2773 6327 2c20 2773 6527 2c0d  b', 'sc', 'se',.
-00000f90: 0a20 2020 2027 7367 272c 2027 7369 272c  .    'sg', 'si',
-00000fa0: 2027 736d 272c 2027 736e 272c 2027 7372   'sm', 'sn', 'sr
-00000fb0: 272c 2027 7461 272c 2027 7462 272c 2027  ', 'ta', 'tb', '
-00000fc0: 7463 272c 2027 7465 272c 2027 7468 272c  tc', 'te', 'th',
-00000fd0: 2027 7469 272c 0d0a 2020 2020 2774 6c27   'ti',..    'tl'
-00000fe0: 2c20 2774 6d27 2c20 2774 7327 2c20 2778  , 'tm', 'ts', 'x
-00000ff0: 6527 2c20 2779 6227 2c20 2772 6527 2c20  e', 'yb', 're', 
-00001000: 2772 6727 2c20 2761 6327 2c20 2770 6227  'rg', 'ac', 'pb'
-00001010: 2c20 276e 6827 2c20 276e 6927 2c0d 0a20  , 'nh', 'ni',.. 
-00001020: 2020 2027 6e6f 272c 2027 6e70 272c 2027     'no', 'np', '
-00001030: 6e64 272c 2027 7261 272c 2027 6f67 272c  nd', 'ra', 'og',
-00001040: 2027 6f73 272c 2027 7061 272c 2027 7064   'os', 'pa', 'pd
-00001050: 272c 2027 6e62 272c 2027 706d 272c 2027  ', 'nb', 'pm', '
-00001060: 706f 272c 0d0a 2020 2020 2770 7227 2c20  po',..    'pr', 
-00001070: 2770 7427 2c20 276e 6127 2c20 2770 7527  'pt', 'na', 'pu'
-00001080: 2c20 276e 6527 2c20 2762 272c 2027 7727  , 'ne', 'b', 'w'
-00001090: 2c20 2776 272c 2027 7927 2c20 2775 272c  , 'v', 'y', 'u',
-000010a0: 2027 6627 2c20 276b 272c 0d0a 2020 2020   'f', 'k',..    
-000010b0: 2763 272c 2027 6927 2c20 2770 272c 2027  'c', 'i', 'p', '
-000010c0: 6827 2c20 2773 272c 2027 6e27 2c20 276f  h', 's', 'n', 'o
-000010d0: 272c 0d0a 2020 2020 2744 272c 2027 6427  ',..    'D', 'd'
-000010e0: 2c20 2023 2061 6464 2044 6575 7465 7269  ,  # add Deuteri
-000010f0: 756d 0d0a 5d0d 0a65 6c65 6d65 6e74 5f72  um..]..element_r
-00001100: 6567 6578 203d 2072 652e 636f 6d70 696c  egex = re.compil
-00001110: 6528 277c 272e 6a6f 696e 2845 4c45 4d45  e('|'.join(ELEME
-00001120: 4e54 5f4c 4953 5429 290d 0a0d 0a23 2053  NT_LIST))....# S
-00001130: 796d 6d65 7472 7920 7472 616e 736c 6174  ymmetry translat
-00001140: 696f 6e73 2028 7265 6d6f 7665 2074 6865  ions (remove the
-00001150: 7365 2074 6f20 7475 726e 2073 796d 6d65  se to turn symme
-00001160: 7472 7920 6f70 6572 6174 696f 6e73 2069  try operations i
-00001170: 6e74 6f20 6d61 676e 6574 6963 206f 6e65  nto magnetic one
-00001180: 290d 0a54 5241 4e53 4c41 5449 4f4e 5320  )..TRANSLATIONS 
-00001190: 3d20 5b0d 0a20 2020 2027 2b31 2f32 272c  = [..    '+1/2',
-000011a0: 2027 2b31 2f33 272c 2027 2b32 2f33 272c   '+1/3', '+2/3',
-000011b0: 2027 2b31 2f34 272c 2027 2b33 2f34 272c   '+1/4', '+3/4',
-000011c0: 2027 2b31 2f36 272c 2027 2b35 2f36 272c   '+1/6', '+5/6',
-000011d0: 2027 2b35 2f34 272c 0d0a 2020 2020 2731   '+5/4',..    '1
-000011e0: 2f32 2b27 2c20 2731 2f33 2b27 2c20 2732  /2+', '1/3+', '2
-000011f0: 2f33 2b27 2c20 2731 2f34 2b27 2c20 2733  /3+', '1/4+', '3
-00001200: 2f34 2b27 2c20 2731 2f36 2b27 2c20 2735  /4+', '1/6+', '5
-00001210: 2f36 2b27 2c20 2735 2f34 2b27 2c0d 0a20  /6+', '5/4+',.. 
-00001220: 2020 2027 2d31 2f32 272c 2027 2d31 2f33     '-1/2', '-1/3
-00001230: 272c 2027 2d32 2f33 272c 2027 2d31 2f34  ', '-2/3', '-1/4
-00001240: 272c 2027 2d33 2f34 272c 2027 2d31 2f36  ', '-3/4', '-1/6
-00001250: 272c 2027 2d35 2f36 272c 2027 2d35 2f34  ', '-5/6', '-5/4
-00001260: 272c 0d0a 2020 2020 2731 2f32 2d27 2c20  ',..    '1/2-', 
-00001270: 2731 2f33 2d27 2c20 2732 2f33 2d27 2c20  '1/3-', '2/3-', 
-00001280: 2731 2f34 2d27 2c20 2733 2f34 2d27 2c20  '1/4-', '3/4-', 
-00001290: 2731 2f36 2d27 2c20 2735 2f36 2d27 2c20  '1/6-', '5/6-', 
-000012a0: 2735 2f34 2d27 2c0d 0a5d 0d0a 0d0a 2320  '5/4-',..]....# 
-000012b0: 5265 7175 6972 6564 2043 4946 206b 6579  Required CIF key
-000012c0: 732c 206d 7573 7420 6265 2061 7661 696c  s, must be avail
-000012d0: 6162 6c65 2061 6e64 206e 6f74 2027 3f27  able and not '?'
-000012e0: 0d0a 4349 465f 5245 5155 4952 4553 203d  ..CIF_REQUIRES =
-000012f0: 205b 0d0a 2020 2020 225f 6365 6c6c 5f6c   [..    "_cell_l
-00001300: 656e 6774 685f 6122 2c0d 0a20 2020 2022  ength_a",..    "
-00001310: 5f63 656c 6c5f 6c65 6e67 7468 5f62 222c  _cell_length_b",
-00001320: 0d0a 2020 2020 225f 6365 6c6c 5f6c 656e  ..    "_cell_len
-00001330: 6774 685f 6322 2c0d 0a20 2020 2022 5f63  gth_c",..    "_c
-00001340: 656c 6c5f 616e 676c 655f 616c 7068 6122  ell_angle_alpha"
-00001350: 2c0d 0a20 2020 2022 5f63 656c 6c5f 616e  ,..    "_cell_an
-00001360: 676c 655f 6265 7461 222c 0d0a 2020 2020  gle_beta",..    
-00001370: 225f 6365 6c6c 5f61 6e67 6c65 5f67 616d  "_cell_angle_gam
-00001380: 6d61 222c 0d0a 2020 2020 225f 6174 6f6d  ma",..    "_atom
-00001390: 5f73 6974 655f 6c61 6265 6c22 2c0d 0a20  _site_label",.. 
-000013a0: 2020 2022 5f61 746f 6d5f 7369 7465 5f66     "_atom_site_f
-000013b0: 7261 6374 5f78 222c 0d0a 2020 2020 225f  ract_x",..    "_
-000013c0: 6174 6f6d 5f73 6974 655f 6672 6163 745f  atom_site_fract_
-000013d0: 7922 2c0d 0a20 2020 2022 5f61 746f 6d5f  y",..    "_atom_
-000013e0: 7369 7465 5f66 7261 6374 5f7a 222c 0d0a  site_fract_z",..
-000013f0: 5d0d 0a0d 0a0d 0a64 6566 2067 6574 656e  ]......def geten
-00001400: 6572 6779 2829 3a0d 0a20 2020 2072 6574  ergy():..    ret
-00001410: 7572 6e20 382e 3034 3820 2023 2043 7520  urn 8.048  # Cu 
-00001420: 4b61 6c70 6861 2065 6e65 7267 792c 206b  Kalpha energy, k
-00001430: 6556 0d0a 0d0a 0d0a 272d 2d2d 2d2d 2d2d  eV......'-------
-00001440: 2d2d 2d2d 2d2d 2d46 756e 6374 696f 6e73  -------Functions
-00001450: 2074 6f20 5265 6164 2026 2057 7269 7465   to Read & Write
-00001460: 2043 4946 2066 696c 6573 2d2d 2d2d 2d2d   CIF files------
-00001470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00001480: 270d 0a0d 0a0d 0a64 6566 2072 6561 6463  '......def readc
-00001490: 6966 2866 696c 656e 616d 653d 4e6f 6e65  if(filename=None
-000014a0: 2c20 6465 6275 673d 4661 6c73 6529 3a0d  , debug=False):.
-000014b0: 0a20 2020 2022 2222 0d0a 2020 2020 4f70  .    """..    Op
-000014c0: 656e 2061 2043 7279 7374 616c 6c6f 6772  en a Crystallogr
-000014d0: 6170 6869 6320 496e 666f 726d 6174 696f  aphic Informatio
-000014e0: 6e20 4669 6c65 2028 2a2e 6369 6629 2066  n File (*.cif) f
-000014f0: 696c 6520 616e 6420 7374 6f72 6520 616c  ile and store al
-00001500: 6c20 656e 7472 6965 7320 696e 2061 206b  l entries in a k
-00001510: 6579 3a76 616c 7565 2064 6963 7469 6f6e  ey:value diction
-00001520: 6172 790d 0a20 2020 2020 4c6f 6f70 6564  ary..     Looped
-00001530: 2076 616c 7565 7320 6172 6520 7374 6f72   values are stor
-00001540: 6564 2061 7320 6c69 7374 7320 756e 6465  ed as lists unde
-00001550: 7220 6120 7369 6e67 6c65 206b 6579 2065  r a single key e
-00001560: 6e74 7279 0d0a 2020 2020 2041 6c6c 2076  ntry..     All v
-00001570: 616c 7565 7320 6172 6520 7374 6f72 6564  alues are stored
-00001580: 2061 7320 7374 7269 6e67 730d 0a20 2020   as strings..   
-00001590: 2045 2e47 2e0d 0a20 2020 2020 2063 7279   E.G...      cry
-000015a0: 733d 7265 6164 6369 6628 2773 6f6d 6566  s=readcif('somef
-000015b0: 696c 652e 6369 6627 290d 0a20 2020 2020  ile.cif')..     
-000015c0: 2063 7279 735b 275f 6365 6c6c 5f6c 656e   crys['_cell_len
-000015d0: 6774 685f 6127 5d20 3d20 2732 2e38 3335  gth_a'] = '2.835
-000015e0: 2832 2927 0d0a 0d0a 2020 2020 6372 7973  (2)'....    crys
-000015f0: 5b6b 6579 5d20 3d20 7661 6c75 650d 0a20  [key] = value.. 
-00001600: 2020 2061 7661 696c 6162 6c65 206b 6579     available key
-00001610: 7320 6172 6520 6769 7665 2062 7920 6372  s are give by cr
-00001620: 7973 2e6b 6579 7328 290d 0a0d 0a20 2020  ys.keys()....   
-00001630: 2054 6f20 6465 6275 6720 7468 6520 6669   To debug the fi
-00001640: 6c65 2077 6974 6820 6f75 7470 7574 7465  le with outputte
-00001650: 6420 6d65 7373 6167 6573 2c20 7573 653a  d messages, use:
-00001660: 0d0a 2020 2020 2020 6369 6620 3d20 7265  ..      cif = re
-00001670: 6164 6369 6628 6669 6c65 2c20 6465 6275  adcif(file, debu
-00001680: 673d 5472 7565 290d 0a0d 0a20 2020 2053  g=True)....    S
-00001690: 6f6d 6520 7573 6566 756c 2073 7461 6e64  ome useful stand
-000016a0: 6172 6420 4349 4620 6b65 7977 6f72 6473  ard CIF keywords
-000016b0: 3a0d 0a20 2020 2020 2020 205f 6365 6c6c  :..        _cell
-000016c0: 5f6c 656e 6774 685f 610d 0a20 2020 2020  _length_a..     
-000016d0: 2020 205f 6365 6c6c 5f6c 656e 6774 685f     _cell_length_
-000016e0: 620d 0a20 2020 2020 2020 205f 6365 6c6c  b..        _cell
-000016f0: 5f6c 656e 6774 685f 630d 0a20 2020 2020  _length_c..     
-00001700: 2020 205f 6365 6c6c 5f61 6e67 6c65 5f61     _cell_angle_a
-00001710: 6c70 6861 0d0a 2020 2020 2020 2020 5f63  lpha..        _c
-00001720: 656c 6c5f 616e 676c 655f 6265 7461 0d0a  ell_angle_beta..
-00001730: 2020 2020 2020 2020 5f63 656c 6c5f 616e          _cell_an
-00001740: 676c 655f 6761 6d6d 610d 0a20 2020 2020  gle_gamma..     
-00001750: 2020 205f 7370 6163 655f 6772 6f75 705f     _space_group_
-00001760: 7379 6d6f 705f 6f70 6572 6174 696f 6e5f  symop_operation_
-00001770: 7879 7a0d 0a20 2020 2020 2020 205f 6174  xyz..        _at
-00001780: 6f6d 5f73 6974 655f 6c61 6265 6c0d 0a20  om_site_label.. 
-00001790: 2020 2020 2020 205f 6174 6f6d 5f73 6974         _atom_sit
-000017a0: 655f 7479 7065 5f73 796d 626f 6c0d 0a20  e_type_symbol.. 
-000017b0: 2020 2020 2020 205f 6174 6f6d 5f73 6974         _atom_sit
-000017c0: 655f 6f63 6375 7061 6e63 790d 0a20 2020  e_occupancy..   
-000017d0: 2020 2020 205f 6174 6f6d 5f73 6974 655f       _atom_site_
-000017e0: 555f 6973 6f5f 6f72 5f65 7175 6976 0d0a  U_iso_or_equiv..
-000017f0: 2020 2020 2020 2020 5f61 746f 6d5f 7369          _atom_si
-00001800: 7465 5f66 7261 6374 5f78 0d0a 2020 2020  te_fract_x..    
-00001810: 2020 2020 5f61 746f 6d5f 7369 7465 5f66      _atom_site_f
-00001820: 7261 6374 5f79 0d0a 2020 2020 2020 2020  ract_y..        
-00001830: 5f61 746f 6d5f 7369 7465 5f66 7261 6374  _atom_site_fract
-00001840: 5f7a 0d0a 2020 2020 2222 220d 0a0d 0a20  _z..    """.... 
-00001850: 2020 2023 2047 6574 2066 696c 6520 6e61     # Get file na
-00001860: 6d65 0d0a 2020 2020 6669 6c65 6e61 6d65  me..    filename
-00001870: 203d 206f 732e 7061 7468 2e61 6273 7061   = os.path.abspa
-00001880: 7468 286f 732e 7061 7468 2e65 7870 616e  th(os.path.expan
-00001890: 6475 7365 7228 6669 6c65 6e61 6d65 2929  duser(filename))
-000018a0: 0d0a 2020 2020 2864 6972 4e61 6d65 2c20  ..    (dirName, 
-000018b0: 6669 6c65 7469 746c 6529 203d 206f 732e  filetitle) = os.
-000018c0: 7061 7468 2e73 706c 6974 2866 696c 656e  path.split(filen
-000018d0: 616d 6529 0d0a 2020 2020 2866 6e61 6d65  ame)..    (fname
-000018e0: 2c20 4578 7429 203d 206f 732e 7061 7468  , Ext) = os.path
-000018f0: 2e73 706c 6974 6578 7428 6669 6c65 7469  .splitext(fileti
-00001900: 746c 6529 0d0a 0d0a 2020 2020 2320 4f70  tle)....    # Op
-00001910: 656e 2066 696c 650d 0a20 2020 2066 696c  en file..    fil
-00001920: 6520 3d20 6f70 656e 2866 696c 656e 616d  e = open(filenam
-00001930: 6529 0d0a 2020 2020 7465 7874 203d 2066  e)..    text = f
-00001940: 696c 652e 7265 6164 2829 0d0a 2020 2020  ile.read()..    
-00001950: 6669 6c65 2e63 6c6f 7365 2829 0d0a 0d0a  file.close()....
-00001960: 2020 2020 2320 5265 6d6f 7665 2062 6c61      # Remove bla
-00001970: 6e6b 206c 696e 6573 0d0a 2020 2020 7768  nk lines..    wh
-00001980: 696c 6520 225c 6e5c 6e22 2069 6e20 7465  ile "\n\n" in te
-00001990: 7874 3a0d 0a20 2020 2020 2020 2074 6578  xt:..        tex
-000019a0: 7420 3d20 7465 7874 2e72 6570 6c61 6365  t = text.replace
-000019b0: 2822 5c6e 5c6e 222c 2022 5c6e 2229 0d0a  ("\n\n", "\n")..
-000019c0: 2020 2020 6c69 6e65 7320 3d20 7465 7874      lines = text
-000019d0: 2e73 706c 6974 6c69 6e65 7328 290d 0a0d  .splitlines()...
-000019e0: 0a20 2020 2063 6966 7661 6c73 203d 207b  .    cifvals = {
-000019f0: 2746 696c 656e 616d 6527 3a20 6669 6c65  'Filename': file
-00001a00: 6e61 6d65 2c20 2744 6972 6563 746f 7279  name, 'Directory
-00001a10: 273a 2064 6972 4e61 6d65 2c20 2746 696c  ': dirName, 'Fil
-00001a20: 6554 6974 6c65 273a 2066 6e61 6d65 7d0d  eTitle': fname}.
-00001a30: 0a0d 0a20 2020 2023 2052 6561 6420 6669  ...    # Read fi
-00001a40: 6c65 206c 696e 6520 6279 206c 696e 652c  le line by line,
-00001a50: 2063 6f6e 7665 7274 696e 6720 7468 6520   converting the 
-00001a60: 6369 6620 6669 6c65 2076 616c 7565 7320  cif file values 
-00001a70: 746f 2061 2070 7974 686f 6e20 6469 6374  to a python dict
-00001a80: 0d0a 2020 2020 6e20 3d20 300d 0a20 2020  ..    n = 0..   
-00001a90: 2077 6869 6c65 206e 203c 206c 656e 286c   while n < len(l
-00001aa0: 696e 6573 293a 0d0a 2020 2020 2020 2020  ines):..        
-00001ab0: 2320 436f 6e76 6572 7420 6c69 6e65 2074  # Convert line t
-00001ac0: 6f20 636f 6c75 6d6e 730d 0a20 2020 2020  o columns..     
-00001ad0: 2020 2076 616c 7320 3d20 6c69 6e65 735b     vals = lines[
-00001ae0: 6e5d 2e73 7472 6970 2829 2e73 706c 6974  n].strip().split
-00001af0: 2829 0d0a 0d0a 2020 2020 2020 2020 2320  ()....        # 
-00001b00: 736b 6970 2065 6d70 7479 206c 696e 6573  skip empty lines
-00001b10: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00001b20: 2876 616c 7329 203d 3d20 303a 0d0a 2020  (vals) == 0:..  
-00001b30: 2020 2020 2020 2020 2020 6e20 2b3d 2031            n += 1
-00001b40: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00001b50: 6e74 696e 7565 0d0a 0d0a 2020 2020 2020  ntinue....      
-00001b60: 2020 2320 5365 6172 6368 2066 6f72 2073    # Search for s
-00001b70: 746f 7265 6420 7661 6c75 6520 6c69 6e65  tored value line
-00001b80: 730d 0a20 2020 2020 2020 2069 6620 7661  s..        if va
-00001b90: 6c73 5b30 5d5b 305d 203d 3d20 275f 273a  ls[0][0] == '_':
-00001ba0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00001bb0: 206c 656e 2876 616c 7329 203d 3d20 313a   len(vals) == 1:
-00001bc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001bd0: 2020 2320 5265 636f 7264 206e 6578 7420    # Record next 
-00001be0: 6c69 6e65 7320 7468 6174 2061 7265 206e  lines that are n
-00001bf0: 6f74 206b 6579 7320 6173 2073 7472 696e  ot keys as strin
-00001c00: 670d 0a20 2020 2020 2020 2020 2020 2020  g..             
-00001c10: 2020 2069 6620 6c69 6e65 735b 6e20 2b20     if lines[n + 
-00001c20: 315d 5b30 5d20 3d3d 2027 3b27 3a20 6e20  1][0] == ';': n 
-00001c30: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-00001c40: 2020 2020 2020 7374 7261 7267 203d 205b        strarg = [
-00001c50: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00001c60: 2020 2077 6869 6c65 206e 202b 2031 203c     while n + 1 <
-00001c70: 206c 656e 286c 696e 6573 2920 616e 6420   len(lines) and 
-00001c80: 286c 656e 286c 696e 6573 5b6e 202b 2031  (len(lines[n + 1
-00001c90: 5d29 203d 3d20 3020 6f72 206c 696e 6573  ]) == 0 or lines
-00001ca0: 5b6e 202b 2031 5d5b 305d 2e73 7472 6970  [n + 1][0].strip
-00001cb0: 2829 206e 6f74 2069 6e20 5b27 5f27 2c20  () not in ['_', 
-00001cc0: 273b 275d 293a 0d0a 2020 2020 2020 2020  ';']):..        
-00001cd0: 2020 2020 2020 2020 2020 2020 7374 7261              stra
-00001ce0: 7267 202b 3d20 5b6c 696e 6573 5b6e 202b  rg += [lines[n +
-00001cf0: 2031 5d2e 7374 7269 7028 275c 2722 2729   1].strip('\'"')
-00001d00: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00001d10: 2020 2020 2020 206e 202b 3d20 310d 0a20         n += 1.. 
-00001d20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00001d30: 6966 7661 6c73 5b76 616c 735b 305d 5d20  ifvals[vals[0]] 
-00001d40: 3d20 275c 6e27 2e6a 6f69 6e28 7374 7261  = '\n'.join(stra
-00001d50: 7267 290d 0a20 2020 2020 2020 2020 2020  rg)..           
-00001d60: 2020 2020 2063 686b 203d 2027 6127 0d0a       chk = 'a'..
-00001d70: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00001d80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00001d90: 2020 2063 6966 7661 6c73 5b76 616c 735b     cifvals[vals[
-00001da0: 305d 5d20 3d20 2720 272e 6a6f 696e 2876  0]] = ' '.join(v
-00001db0: 616c 735b 313a 5d29 2e73 7472 6970 2827  als[1:]).strip('
-00001dc0: 205c 2722 5c6e 2729 0d0a 2020 2020 2020   \'"\n')..      
-00001dd0: 2020 2020 2020 2020 2020 6368 6b20 3d20            chk = 
-00001de0: 2762 270d 0a20 2020 2020 2020 2020 2020  'b'..           
-00001df0: 206e 202b 3d20 310d 0a20 2020 2020 2020   n += 1..       
-00001e00: 2020 2020 2069 6620 6465 6275 673a 0d0a       if debug:..
-00001e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001e20: 7072 696e 7428 2725 3564 2025 7320 2573  print('%5d %s %s
-00001e30: 203d 2025 7327 2025 2028 6e2c 2063 686b   = %s' % (n, chk
-00001e40: 2c20 7661 6c73 5b30 5d2c 2063 6966 7661  , vals[0], cifva
-00001e50: 6c73 5b76 616c 735b 305d 5d29 290d 0a20  ls[vals[0]])).. 
-00001e60: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00001e70: 6e75 650d 0a0d 0a20 2020 2020 2020 2023  nue....        #
-00001e80: 2053 6561 7263 6820 666f 7220 6c6f 6f70   Search for loop
-00001e90: 730d 0a20 2020 2020 2020 2065 6c69 6620  s..        elif 
-00001ea0: 7661 6c73 5b30 5d20 3d3d 2027 6c6f 6f70  vals[0] == 'loop
-00001eb0: 5f27 3a0d 0a20 2020 2020 2020 2020 2020  _':..           
-00001ec0: 206e 202b 3d20 310d 0a20 2020 2020 2020   n += 1..       
-00001ed0: 2020 2020 206c 6f6f 7076 616c 7320 3d20       loopvals = 
-00001ee0: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
-00001ef0: 2320 5374 6570 2031 3a20 4173 7369 676e  # Step 1: Assign
-00001f00: 206c 6f6f 7020 636f 6c75 6d6e 730d 0a20   loop columns.. 
-00001f10: 2020 2020 2020 2020 2020 2023 206c 6f6f             # loo
-00001f20: 7065 6420 636f 6c75 6d6e 7320 6172 6520  ped columns are 
-00001f30: 6769 7665 6e20 6279 2022 5f63 6f6c 756d  given by "_colum
-00001f40: 6e5f 6e61 6d65 220d 0a20 2020 2020 2020  n_name"..       
-00001f50: 2020 2020 2077 6869 6c65 206e 203c 206c       while n < l
-00001f60: 656e 286c 696e 6573 2920 616e 6420 6c65  en(lines) and le
-00001f70: 6e28 6c69 6e65 735b 6e5d 2e73 7472 6970  n(lines[n].strip
-00001f80: 2829 2920 3e20 3020 616e 6420 6c69 6e65  ()) > 0 and line
-00001f90: 735b 6e5d 2e73 7472 6970 2829 5b30 5d20  s[n].strip()[0] 
-00001fa0: 3d3d 2027 5f27 3a0d 0a20 2020 2020 2020  == '_':..       
-00001fb0: 2020 2020 2020 2020 206c 6f6f 7076 616c           loopval
-00001fc0: 7320 2b3d 205b 6c69 6e65 735b 6e5d 2e73  s += [lines[n].s
-00001fd0: 706c 6974 2829 5b30 5d5d 0d0a 2020 2020  plit()[0]]..    
-00001fe0: 2020 2020 2020 2020 2020 2020 6369 6676              cifv
-00001ff0: 616c 735b 6c6f 6f70 7661 6c73 5b2d 315d  als[loopvals[-1]
-00002000: 5d20 3d20 5b5d 0d0a 2020 2020 2020 2020  ] = []..        
-00002010: 2020 2020 2020 2020 6e20 2b3d 2031 0d0a          n += 1..
-00002020: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00002030: 5374 6570 2032 3a20 4173 7369 676e 2064  Step 2: Assign d
-00002040: 6174 6120 746f 2063 6f6c 756d 6e73 0d0a  ata to columns..
-00002050: 2020 2020 2020 2020 2020 2020 2320 6c6f              # lo
-00002060: 6f70 7320 756e 7469 6c20 6c69 6e65 2068  ops until line h
-00002070: 6173 206c 6573 7320 7365 676d 656e 7473  as less segments
-00002080: 2074 6861 6e20 636f 6c75 6d6e 730d 0a20   than columns.. 
-00002090: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-000020a0: 206e 203c 206c 656e 286c 696e 6573 293a   n < len(lines):
-000020b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000020c0: 2020 2320 636f 6c73 203d 206c 696e 6573    # cols = lines
-000020d0: 5b6e 5d2e 7370 6c69 7428 290d 0a20 2020  [n].split()..   
-000020e0: 2020 2020 2020 2020 2020 2020 2023 2074               # t
-000020f0: 6869 7320 6669 7865 7320 6572 726f 7220  his fixes error 
-00002100: 6f6e 2073 796d 6d65 7472 7920 6172 6775  on symmetry argu
-00002110: 6d65 6e74 7320 6861 7669 6e67 2073 7061  ments having spa
-00002120: 6365 730d 0a20 2020 2020 2020 2020 2020  ces..           
-00002130: 2020 2020 2023 2074 6869 7320 7769 6c6c       # this will
-00002140: 206f 6e6c 7920 776f 726b 2069 6620 7468   only work if th
-00002150: 6520 6c61 7374 2061 7267 756d 656e 7420  e last argument 
-00002160: 696e 2074 6865 206c 6f6f 7020 6973 2073  in the loop is s
-00002170: 706c 6974 2062 7920 7370 6163 6573 2028  plit by spaces (
-00002180: 696e 2071 756f 7465 7329 0d0a 2020 2020  in quotes)..    
-00002190: 2020 2020 2020 2020 2020 2020 2320 636f              # co
-000021a0: 6c73 203d 2063 6f6c 735b 3a6c 656e 286c  ls = cols[:len(l
-000021b0: 6f6f 7076 616c 7329 202d 2031 5d20 2b20  oopvals) - 1] + 
-000021c0: 5b27 272e 6a6f 696e 2863 6f6c 735b 6c65  [''.join(cols[le
-000021d0: 6e28 6c6f 6f70 7661 6c73 2920 2d20 313a  n(loopvals) - 1:
-000021e0: 5d29 5d0d 0a20 2020 2020 2020 2020 2020  ])]..           
-000021f0: 2020 2020 2063 6f6c 7320 3d20 5b63 6f6c       cols = [col
-00002200: 2066 6f72 2063 6f6c 2069 6e20 7265 2e73   for col in re.s
-00002210: 706c 6974 2822 2820 7c5c 5c5c 222e 2a3f  plit("( |\\\".*?
-00002220: 5c5c 5c22 7c27 2e2a 3f27 2922 2c20 6c69  \\\"|'.*?')", li
-00002230: 6e65 735b 6e5d 2920 6966 2063 6f6c 2e73  nes[n]) if col.s
-00002240: 7472 6970 2829 5d0d 0a20 2020 2020 2020  trip()]..       
-00002250: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00002260: 636f 6c73 2920 213d 206c 656e 286c 6f6f  cols) != len(loo
-00002270: 7076 616c 7329 3a20 6272 6561 6b0d 0a20  pvals): break.. 
-00002280: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002290: 6620 636f 6c73 5b30 5d5b 305d 203d 3d20  f cols[0][0] == 
-000022a0: 275f 2720 6f72 2063 6f6c 735b 305d 203d  '_' or cols[0] =
-000022b0: 3d20 276c 6f6f 705f 273a 2062 7265 616b  = 'loop_': break
-000022c0: 2020 2320 6361 7463 6865 7320 6572 726f    # catches erro
-000022d0: 7220 6966 206c 6f6f 7020 6973 206f 6e6c  r if loop is onl
-000022e0: 7920 3120 6974 6572 6174 696f 6e0d 0a20  y 1 iteration.. 
-000022f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002300: 6620 636f 6c73 5b30 5d5b 305d 203d 3d20  f cols[0][0] == 
-00002310: 2723 273a 206e 202b 3d20 313b 2063 6f6e  '#': n += 1; con
-00002320: 7469 6e75 6520 2023 2063 6174 6368 6573  tinue  # catches
-00002330: 2063 6f6d 656e 7465 6420 6f75 7420 6c69   comented out li
-00002340: 6e65 730d 0a20 2020 2020 2020 2020 2020  nes..           
-00002350: 2020 2020 2069 6620 6c65 6e28 6c6f 6f70       if len(loop
-00002360: 7661 6c73 2920 3d3d 2031 3a0d 0a20 2020  vals) == 1:..   
-00002370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002380: 2063 6966 7661 6c73 5b6c 6f6f 7076 616c   cifvals[loopval
-00002390: 735b 305d 5d20 2b3d 205b 6c69 6e65 735b  s[0]] += [lines[
-000023a0: 6e5d 2e73 7472 6970 2827 205c 225c 275c  n].strip(' \"\'\
-000023b0: 6e27 295d 0d0a 2020 2020 2020 2020 2020  n')]..          
-000023c0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000023d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000023e0: 2066 6f72 2063 2c20 6c6c 2069 6e20 656e   for c, ll in en
-000023f0: 756d 6572 6174 6528 6c6f 6f70 7661 6c73  umerate(loopvals
-00002400: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00002410: 2020 2020 2020 2020 2020 2020 6369 6676              cifv
-00002420: 616c 735b 6c6c 5d20 2b3d 205b 636f 6c73  als[ll] += [cols
-00002430: 5b63 5d5d 0d0a 2020 2020 2020 2020 2020  [c]]..          
-00002440: 2020 2020 2020 6e20 2b3d 2031 0d0a 0d0a        n += 1....
-00002450: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00002460: 6562 7567 3a0d 0a20 2020 2020 2020 2020  ebug:..         
-00002470: 2020 2020 2020 2066 6f72 206c 6c20 696e         for ll in
-00002480: 206c 6f6f 7076 616c 733a 0d0a 2020 2020   loopvals:..    
-00002490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024a0: 7072 696e 7428 2725 3564 204c 2025 7320  print('%5d L %s 
-000024b0: 3d20 2573 2720 2520 286e 2c20 6c6c 2c20  = %s' % (n, ll, 
-000024c0: 7374 7228 6369 6676 616c 735b 6c6c 5d29  str(cifvals[ll])
-000024d0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-000024e0: 636f 6e74 696e 7565 0d0a 0d0a 2020 2020  continue....    
-000024f0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00002500: 2020 2020 2020 2023 2053 6b69 7020 616e         # Skip an
-00002510: 7974 6869 6e67 2065 6c73 650d 0a20 2020  ything else..   
-00002520: 2020 2020 2020 2020 2069 6620 6465 6275           if debu
-00002530: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
-00002540: 2020 2020 7072 696e 7428 2725 3564 2053      print('%5d S
-00002550: 4b49 5050 4544 3a20 2573 2720 2520 286e  KIPPED: %s' % (n
-00002560: 2c20 6c69 6e65 735b 6e5d 2929 0d0a 2020  , lines[n]))..  
-00002570: 2020 2020 2020 2020 2020 6e20 2b3d 2031            n += 1
-00002580: 0d0a 0d0a 2020 2020 2320 5265 706c 6163  ....    # Replac
-00002590: 6520 272e 2720 696e 206b 6579 7320 2d20  e '.' in keys - 
-000025a0: 6669 7820 6275 6720 6672 6f6d 2069 736f  fix bug from iso
-000025b0: 6469 7374 6f72 7420 6369 6620 6669 6c65  distort cif file
-000025c0: 730d 0a20 2020 2023 2065 2e67 2e20 275f  s..    # e.g. '_
-000025d0: 7370 6163 655f 6772 6f75 705f 7379 6d6f  space_group_symo
-000025e0: 705f 6d61 676e 5f6f 7065 7261 7469 6f6e  p_magn_operation
-000025f0: 2e78 797a 270d 0a20 2020 2063 7572 7265  .xyz'..    curre
-00002600: 6e74 5f6b 6579 7320 3d20 6c69 7374 2863  nt_keys = list(c
-00002610: 6966 7661 6c73 2e6b 6579 7328 2929 0d0a  ifvals.keys())..
-00002620: 2020 2020 666f 7220 6b65 7920 696e 2063      for key in c
-00002630: 7572 7265 6e74 5f6b 6579 733a 0d0a 2020  urrent_keys:..  
-00002640: 2020 2020 2020 6966 2027 2e27 2069 6e20        if '.' in 
-00002650: 6b65 793a 0d0a 2020 2020 2020 2020 2020  key:..          
-00002660: 2020 6e65 776b 6579 203d 206b 6579 2e72    newkey = key.r
-00002670: 6570 6c61 6365 2827 2e27 2c20 275f 2729  eplace('.', '_')
-00002680: 0d0a 2020 2020 2020 2020 2020 2020 6369  ..            ci
-00002690: 6676 616c 735b 6e65 776b 6579 5d20 3d20  fvals[newkey] = 
-000026a0: 6369 6676 616c 735b 6b65 795d 0d0a 2020  cifvals[key]..  
-000026b0: 2020 7265 7475 726e 2063 6966 7661 6c73    return cifvals
-000026c0: 0d0a 0d0a 0d0a 6465 6620 6369 665f 6368  ......def cif_ch
-000026d0: 6563 6b28 6369 6676 616c 732c 2072 6571  eck(cifvals, req
-000026e0: 7569 7265 645f 6b65 7973 3d4e 6f6e 652c  uired_keys=None,
-000026f0: 2062 6164 5f76 616c 7565 3d27 3f27 293a   bad_value='?'):
-00002700: 0d0a 2020 2020 2222 220d 0a20 2020 2052  ..    """..    R
-00002710: 6574 7572 6e73 2054 7275 6520 6966 2061  eturns True if a
-00002720: 6c6c 2062 6173 6963 2072 6571 7569 7265  ll basic require
-00002730: 6420 6369 6620 7061 7261 6d65 7465 7220  d cif parameter 
-00002740: 6172 6520 6176 6169 6c61 626c 6520 616e  are available an
-00002750: 6420 7265 616c 2e0d 0a20 2020 2045 2e47  d real...    E.G
-00002760: 2e3a 0d0a 2020 2020 2020 2020 6369 6676  .:..        cifv
-00002770: 616c 7320 3d20 7265 6164 6369 6628 6669  als = readcif(fi
-00002780: 6c65 2e63 6966 290d 0a20 2020 2020 2020  le.cif)..       
-00002790: 2069 6620 6369 665f 6368 6563 6b28 6369   if cif_check(ci
-000027a0: 6676 616c 7329 3a0d 0a20 2020 2020 2020  fvals):..       
-000027b0: 2020 2020 2070 7269 6e74 2827 4669 6c65       print('File
-000027c0: 204f 4b27 290d 0a20 2020 203a 7061 7261   OK')..    :para
-000027d0: 6d20 6369 6676 616c 733a 2064 6963 7420  m cifvals: dict 
-000027e0: 6f66 2063 6966 206b 6579 7320 666f 726d  of cif keys form
-000027f0: 2072 6561 6463 6966 0d0a 2020 2020 3a70   readcif..    :p
-00002800: 6172 616d 2072 6571 7569 7265 645f 6b65  aram required_ke
-00002810: 7973 3a20 6c69 7374 206f 6620 6b65 7920  ys: list of key 
-00002820: 7374 7269 6e67 732c 206f 7220 4e6f 6e65  strings, or None
-00002830: 2066 6f72 2064 6566 6175 6c74 0d0a 2020   for default..  
-00002840: 2020 3a70 6172 616d 2062 6164 5f76 616c    :param bad_val
-00002850: 7565 3a20 6966 2074 6869 7320 7661 6c75  ue: if this valu
-00002860: 6520 6973 2069 6e20 7468 6520 6369 6620  e is in the cif 
-00002870: 6b65 7920 6974 656d 2c20 7265 7475 726e  key item, return
-00002880: 2046 616c 7365 0d0a 2020 2020 3a72 6574   False..    :ret
-00002890: 7572 6e3a 2062 6f6f 6c0d 0a20 2020 2022  urn: bool..    "
-000028a0: 2222 0d0a 2020 2020 6966 2072 6571 7569  ""..    if requi
-000028b0: 7265 645f 6b65 7973 2069 7320 4e6f 6e65  red_keys is None
-000028c0: 3a0d 0a20 2020 2020 2020 2072 6571 7569  :..        requi
-000028d0: 7265 645f 6b65 7973 203d 2043 4946 5f52  red_keys = CIF_R
-000028e0: 4551 5549 5245 530d 0a20 2020 206b 6579  EQUIRES..    key
-000028f0: 7320 3d20 6369 6676 616c 732e 6b65 7973  s = cifvals.keys
-00002900: 2829 0d0a 2020 2020 666f 7220 6b65 7920  ()..    for key 
-00002910: 696e 2072 6571 7569 7265 645f 6b65 7973  in required_keys
-00002920: 3a0d 0a20 2020 2020 2020 2069 6620 6b65  :..        if ke
-00002930: 7920 6e6f 7420 696e 206b 6579 733a 0d0a  y not in keys:..
-00002940: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00002950: 726e 2046 616c 7365 0d0a 2020 2020 2020  rn False..      
-00002960: 2020 6966 2062 6164 5f76 616c 7565 2069    if bad_value i
-00002970: 6e20 6369 6676 616c 735b 6b65 795d 3a0d  n cifvals[key]:.
-00002980: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00002990: 7572 6e20 4661 6c73 650d 0a20 2020 2072  urn False..    r
-000029a0: 6574 7572 6e20 5472 7565 0d0a 0d0a 0d0a  eturn True......
-000029b0: 6465 6620 6369 665f 7379 6d6d 6574 7279  def cif_symmetry
-000029c0: 2863 6966 7661 6c73 293a 0d0a 2020 2020  (cifvals):..    
-000029d0: 2222 220d 0a20 2020 2052 6561 6420 7379  """..    Read sy
-000029e0: 6d6d 6574 7269 6573 2066 726f 6d20 6120  mmetries from a 
-000029f0: 6369 6620 6469 6374 0d0a 2020 2020 3a70  cif dict..    :p
-00002a00: 6172 616d 2063 6966 7661 6c73 3a0d 0a20  aram cifvals:.. 
-00002a10: 2020 203a 7265 7475 726e 3a20 6c69 7374     :return: list
-00002a20: 2873 796d 6d65 7472 795f 6f70 6572 6174  (symmetry_operat
-00002a30: 696f 6e73 292c 206c 6973 7428 6d61 676e  ions), list(magn
-00002a40: 6574 6963 5f6f 7065 7261 7469 6f6e 7329  etic_operations)
-00002a50: 2c20 6c69 7374 2874 696d 6520 6f70 6572  , list(time oper
-00002a60: 6174 696f 6e73 290d 0a20 2020 2022 2222  ations)..    """
-00002a70: 0d0a 2020 2020 6b65 7973 203d 2063 6966  ..    keys = cif
-00002a80: 7661 6c73 2e6b 6579 7328 290d 0a0d 0a20  vals.keys().... 
-00002a90: 2020 2069 6620 275f 7379 6d6d 6574 7279     if '_symmetry
-00002aa0: 5f65 7175 6976 5f70 6f73 5f61 735f 7879  _equiv_pos_as_xy
-00002ab0: 7a27 2069 6e20 6b65 7973 3a0d 0a20 2020  z' in keys:..   
-00002ac0: 2020 2020 2073 796d 6f70 7320 3d20 6369       symops = ci
-00002ad0: 6676 616c 735b 275f 7379 6d6d 6574 7279  fvals['_symmetry
-00002ae0: 5f65 7175 6976 5f70 6f73 5f61 735f 7879  _equiv_pos_as_xy
-00002af0: 7a27 5d0d 0a20 2020 2020 2020 2073 796d  z']..        sym
-00002b00: 6d65 7472 795f 6f70 6572 6174 696f 6e73  metry_operations
-00002b10: 203d 2067 656e 5f73 796d 6365 6e5f 6f70   = gen_symcen_op
-00002b20: 7328 7379 6d6f 7073 2c20 5b27 782c 792c  s(symops, ['x,y,
-00002b30: 7a27 5d29 0d0a 2020 2020 2020 2020 7379  z'])..        sy
-00002b40: 6d6d 6574 7279 5f6f 7065 7261 7469 6f6e  mmetry_operation
-00002b50: 735f 6d61 676e 6574 6963 203d 2073 796d  s_magnetic = sym
-00002b60: 6d65 7472 795f 6f70 7332 6d61 676e 6574  metry_ops2magnet
-00002b70: 6963 2873 796d 6f70 7329 0d0a 2020 2020  ic(symops)..    
-00002b80: 2020 2020 7379 6d6d 6574 7279 5f6f 7065      symmetry_ope
-00002b90: 7261 7469 6f6e 735f 7469 6d65 203d 2073  rations_time = s
-00002ba0: 796d 5f6f 705f 7469 6d65 2873 796d 6f70  ym_op_time(symop
-00002bb0: 7329 0d0a 2020 2020 656c 6966 2027 5f73  s)..    elif '_s
-00002bc0: 7061 6365 5f67 726f 7570 5f73 796d 6f70  pace_group_symop
-00002bd0: 5f6f 7065 7261 7469 6f6e 5f78 797a 2720  _operation_xyz' 
-00002be0: 696e 206b 6579 733a 0d0a 2020 2020 2020  in keys:..      
-00002bf0: 2020 7379 6d6f 7073 203d 2063 6966 7661    symops = cifva
-00002c00: 6c73 5b27 5f73 7061 6365 5f67 726f 7570  ls['_space_group
-00002c10: 5f73 796d 6f70 5f6f 7065 7261 7469 6f6e  _symop_operation
-00002c20: 5f78 797a 275d 0d0a 2020 2020 2020 2020  _xyz']..        
-00002c30: 7379 6d6d 6574 7279 5f6f 7065 7261 7469  symmetry_operati
-00002c40: 6f6e 7320 3d20 6765 6e5f 7379 6d63 656e  ons = gen_symcen
-00002c50: 5f6f 7073 2873 796d 6f70 732c 205b 2778  _ops(symops, ['x
-00002c60: 2c79 2c7a 275d 290d 0a20 2020 2020 2020  ,y,z'])..       
-00002c70: 2073 796d 6d65 7472 795f 6f70 6572 6174   symmetry_operat
-00002c80: 696f 6e73 5f6d 6167 6e65 7469 6320 3d20  ions_magnetic = 
-00002c90: 7379 6d6d 6574 7279 5f6f 7073 326d 6167  symmetry_ops2mag
-00002ca0: 6e65 7469 6328 7379 6d6f 7073 290d 0a20  netic(symops).. 
-00002cb0: 2020 2020 2020 2073 796d 6d65 7472 795f         symmetry_
-00002cc0: 6f70 6572 6174 696f 6e73 5f74 696d 6520  operations_time 
-00002cd0: 3d20 7379 6d5f 6f70 5f74 696d 6528 7379  = sym_op_time(sy
-00002ce0: 6d6f 7073 290d 0a20 2020 2065 6c69 6620  mops)..    elif 
-00002cf0: 275f 7370 6163 655f 6772 6f75 705f 7379  '_space_group_sy
-00002d00: 6d6f 705f 6d61 676e 5f6f 7065 7261 7469  mop_magn_operati
-00002d10: 6f6e 5f78 797a 2720 696e 206b 6579 733a  on_xyz' in keys:
-00002d20: 0d0a 2020 2020 2020 2020 7379 6d6f 7073  ..        symops
-00002d30: 203d 2063 6966 7661 6c73 5b27 5f73 7061   = cifvals['_spa
-00002d40: 6365 5f67 726f 7570 5f73 796d 6f70 5f6d  ce_group_symop_m
-00002d50: 6167 6e5f 6f70 6572 6174 696f 6e5f 7879  agn_operation_xy
-00002d60: 7a27 5d0d 0a20 2020 2020 2020 2069 6620  z']..        if 
-00002d70: 275f 7370 6163 655f 6772 6f75 705f 7379  '_space_group_sy
-00002d80: 6d6f 705f 6d61 676e 5f63 656e 7465 7269  mop_magn_centeri
-00002d90: 6e67 5f78 797a 2720 696e 206b 6579 733a  ng_xyz' in keys:
-00002da0: 0d0a 2020 2020 2020 2020 2020 2020 7379  ..            sy
-00002db0: 6d63 656e 203d 2063 6966 7661 6c73 5b27  mcen = cifvals['
-00002dc0: 5f73 7061 6365 5f67 726f 7570 5f73 796d  _space_group_sym
-00002dd0: 6f70 5f6d 6167 6e5f 6365 6e74 6572 696e  op_magn_centerin
-00002de0: 675f 7879 7a27 5d0d 0a20 2020 2020 2020  g_xyz']..       
-00002df0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00002e00: 2020 2020 7379 6d63 656e 203d 205b 2778      symcen = ['x
-00002e10: 2c79 2c7a 275d 0d0a 2020 2020 2020 2020  ,y,z']..        
-00002e20: 7379 6d6d 6574 7279 5f6f 7065 7261 7469  symmetry_operati
-00002e30: 6f6e 7320 3d20 6765 6e5f 7379 6d63 656e  ons = gen_symcen
-00002e40: 5f6f 7073 2873 796d 6f70 732c 2073 796d  _ops(symops, sym
-00002e50: 6365 6e29 0d0a 2020 2020 2020 2020 7379  cen)..        sy
-00002e60: 6d6d 6574 7279 5f6f 7065 7261 7469 6f6e  mmetry_operation
-00002e70: 735f 7469 6d65 203d 2073 796d 5f6f 705f  s_time = sym_op_
-00002e80: 7469 6d65 2873 796d 6d65 7472 795f 6f70  time(symmetry_op
-00002e90: 6572 6174 696f 6e73 290d 0a0d 0a20 2020  erations)....   
-00002ea0: 2020 2020 2069 6620 275f 7370 6163 655f       if '_space_
-00002eb0: 6772 6f75 705f 7379 6d6f 705f 6d61 676e  group_symop_magn
-00002ec0: 5f6f 7065 7261 7469 6f6e 5f6d 786d 796d  _operation_mxmym
-00002ed0: 7a27 2069 6e20 6b65 7973 3a0d 0a20 2020  z' in keys:..   
-00002ee0: 2020 2020 2020 2020 206d 6167 6f70 7320           magops 
-00002ef0: 3d20 6369 6676 616c 735b 275f 7370 6163  = cifvals['_spac
-00002f00: 655f 6772 6f75 705f 7379 6d6f 705f 6d61  e_group_symop_ma
-00002f10: 676e 5f6f 7065 7261 7469 6f6e 5f6d 786d  gn_operation_mxm
-00002f20: 796d 7a27 5d20 2023 206d 782c 6d79 2c6d  ymz']  # mx,my,m
-00002f30: 7a0d 0a20 2020 2020 2020 2020 2020 206d  z..            m
-00002f40: 6167 6365 6e20 3d20 6369 6676 616c 735b  agcen = cifvals[
-00002f50: 275f 7370 6163 655f 6772 6f75 705f 7379  '_space_group_sy
-00002f60: 6d6f 705f 6d61 676e 5f63 656e 7465 7269  mop_magn_centeri
-00002f70: 6e67 5f6d 786d 796d 7a27 5d0d 0a20 2020  ng_mxmymz']..   
-00002f80: 2020 2020 2020 2020 206d 6167 6f70 7320           magops 
-00002f90: 3d20 5b6f 702e 7265 706c 6163 6528 276d  = [op.replace('m
-00002fa0: 272c 2027 2729 2066 6f72 206f 7020 696e  ', '') for op in
-00002fb0: 206d 6167 6f70 735d 0d0a 2020 2020 2020   magops]..      
-00002fc0: 2020 2020 2020 6d61 6763 656e 203d 205b        magcen = [
-00002fd0: 6f70 2e72 6570 6c61 6365 2827 6d27 2c20  op.replace('m', 
-00002fe0: 2727 2920 666f 7220 6f70 2069 6e20 6d61  '') for op in ma
-00002ff0: 6763 656e 5d0d 0a20 2020 2020 2020 2020  gcen]..         
-00003000: 2020 2073 796d 6d65 7472 795f 6f70 6572     symmetry_oper
-00003010: 6174 696f 6e73 5f6d 6167 6e65 7469 6320  ations_magnetic 
-00003020: 3d20 6765 6e5f 7379 6d63 656e 5f6f 7073  = gen_symcen_ops
-00003030: 286d 6167 6f70 732c 206d 6167 6365 6e29  (magops, magcen)
-00003040: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00003050: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
-00003060: 6d65 7472 795f 6f70 6572 6174 696f 6e73  metry_operations
-00003070: 5f6d 6167 6e65 7469 6320 3d20 7379 6d6d  _magnetic = symm
-00003080: 6574 7279 5f6f 7073 326d 6167 6e65 7469  etry_ops2magneti
-00003090: 6328 7379 6d6d 6574 7279 5f6f 7065 7261  c(symmetry_opera
-000030a0: 7469 6f6e 7329 0d0a 2020 2020 656c 7365  tions)..    else
-000030b0: 3a0d 0a20 2020 2020 2020 2073 796d 6d65  :..        symme
-000030c0: 7472 795f 6f70 6572 6174 696f 6e73 203d  try_operations =
-000030d0: 205b 2778 2c79 2c7a 275d 0d0a 2020 2020   ['x,y,z']..    
-000030e0: 2020 2020 7379 6d6d 6574 7279 5f6f 7065      symmetry_ope
-000030f0: 7261 7469 6f6e 735f 6d61 676e 6574 6963  rations_magnetic
-00003100: 203d 205b 2778 2c79 2c7a 275d 0d0a 2020   = ['x,y,z']..  
-00003110: 2020 2020 2020 7379 6d6d 6574 7279 5f6f        symmetry_o
-00003120: 7065 7261 7469 6f6e 735f 7469 6d65 203d  perations_time =
-00003130: 205b 315d 0d0a 0d0a 2020 2020 7379 6d6d   [1]....    symm
-00003140: 6574 7279 5f6f 7065 7261 7469 6f6e 735f  etry_operations_
-00003150: 6d61 676e 6574 6963 203d 2073 796d 5f6f  magnetic = sym_o
-00003160: 705f 6d78 2873 796d 6d65 7472 795f 6f70  p_mx(symmetry_op
-00003170: 6572 6174 696f 6e73 5f6d 6167 6e65 7469  erations_magneti
-00003180: 6329 0d0a 2020 2020 7265 7475 726e 2073  c)..    return s
-00003190: 796d 6d65 7472 795f 6f70 6572 6174 696f  ymmetry_operatio
-000031a0: 6e73 2c20 7379 6d6d 6574 7279 5f6f 7065  ns, symmetry_ope
-000031b0: 7261 7469 6f6e 735f 6d61 676e 6574 6963  rations_magnetic
-000031c0: 2c20 7379 6d6d 6574 7279 5f6f 7065 7261  , symmetry_opera
-000031d0: 7469 6f6e 735f 7469 6d65 0d0a 0d0a 0d0a  tions_time......
-000031e0: 6465 6620 6369 6632 6469 6374 2863 6966  def cif2dict(cif
-000031f0: 7661 6c73 293a 0d0a 2020 2020 2222 220d  vals):..    """.
-00003200: 0a20 2020 2046 726f 6d20 6120 6469 6374  .    From a dict
-00003210: 206f 6620 6b65 793a 7661 6c75 6520 7061   of key:value pa
-00003220: 6972 7320 6765 6e65 7261 7465 6420 6672  irs generated fr
-00003230: 6f6d 2061 202a 2e63 6966 2066 696c 6520  om a *.cif file 
-00003240: 2875 7369 6e67 2072 6561 6463 6966 292c  (using readcif),
-00003250: 0d0a 2020 2020 7265 6164 2073 7461 6e64  ..    read stand
-00003260: 6172 6420 6372 7973 7461 6c6c 6f67 7261  ard crystallogra
-00003270: 7068 6963 2069 6e66 726f 6d61 7469 6f6e  phic infromation
-00003280: 2069 6e74 6f20 6120 6372 7973 7461 6c20   into a crystal 
-00003290: 6469 6374 696f 6e61 7279 2c20 7769 7468  dictionary, with
-000032a0: 206b 6579 733a 0d0a 2020 2020 2020 2020   keys:..        
-000032b0: 2766 696c 656e 616d 6527 202d 2063 6966  'filename' - cif
-000032c0: 2066 696c 656e 616d 650d 0a20 2020 2020   filename..     
-000032d0: 2020 2027 6e61 6d65 2720 2d20 6e61 6d65     'name' - name
-000032e0: 206f 6620 7374 7275 6374 7572 650d 0a20   of structure.. 
-000032f0: 2020 2020 2020 2027 756e 6974 2076 6563         'unit vec
-00003300: 746f 7227 2020 202d 205b 3378 335d 2061  tor'   - [3x3] a
-00003310: 7272 6179 206f 6620 6261 7369 7320 7665  rray of basis ve
-00003320: 6374 6f72 7320 5b61 2c62 2c63 5d0d 0a20  ctors [a,b,c].. 
-00003330: 2020 2020 2020 2027 7061 7265 6e74 2063         'parent c
-00003340: 656c 6c27 2020 202d 205b 3378 335d 2061  ell'   - [3x3] a
-00003350: 7272 6179 206f 6620 7061 7265 6e74 2062  rray of parent b
-00003360: 6173 6973 2076 6563 746f 7273 205b 612c  asis vectors [a,
-00003370: 622c 635d 0d0a 2020 2020 2020 2020 2773  b,c]..        's
-00003380: 796d 6d65 7472 7927 2020 2020 2020 2d20  ymmetry'      - 
-00003390: 6c69 7374 206f 6620 7374 7269 6e67 2073  list of string s
-000033a0: 796d 6d65 7472 7920 6f70 6572 6174 696f  ymmetry operatio
-000033b0: 6e73 0d0a 2020 2020 2020 2020 2773 7061  ns..        'spa
-000033c0: 6365 2067 726f 7570 2720 2020 2d20 5370  ce group'   - Sp
-000033d0: 6163 6520 4772 6f75 7020 7374 7269 6e67  ace Group string
-000033e0: 0d0a 2020 2020 2020 2020 2773 7061 6365  ..        'space
-000033f0: 2067 726f 7570 206e 756d 6265 7227 202d   group number' -
-00003400: 2053 7061 6365 2067 726f 7570 206e 756d   Space group num
-00003410: 6265 720d 0a20 2020 2020 2020 2027 6369  ber..        'ci
-00003420: 6627 2020 2020 2020 2020 2020 202d 2063  f'           - c
-00003430: 6966 2064 6963 740d 0a20 2020 2020 2020  if dict..       
-00003440: 2054 6865 2066 6f6c 6c6f 7769 6e67 2061   The following a
-00003450: 7265 2073 7065 6369 6669 6320 746f 2061  re specific to a
-00003460: 746f 6d69 7320 7769 7468 696e 2074 6865  tomis within the
-00003470: 2075 6e69 7420 6365 6c6c 3a0d 0a20 2020   unit cell:..   
-00003480: 2020 2020 2027 6174 6f6d 2074 7970 6527       'atom type'
-00003490: 2020 2020 202d 206c 6973 7420 6f66 2065       - list of e
-000034a0: 6c65 6d65 6e74 7320 652e 672e 205b 2743  lements e.g. ['C
-000034b0: 6f27 2c27 4f27 2c20 274f 275d 0d0a 2020  o','O', 'O']..  
-000034c0: 2020 2020 2020 2761 746f 6d20 6c61 6265        'atom labe
-000034d0: 6c27 2020 2020 2d20 6c69 7374 206f 6620  l'    - list of 
-000034e0: 6174 6f6d 2073 6974 6520 6e61 6d65 7320  atom site names 
-000034f0: 652e 672e 205b 2743 6f31 2c20 274f 3127  e.g. ['Co1, 'O1'
-00003500: 2c20 274f 3227 5d0d 0a20 2020 2020 2020  , 'O2']..       
-00003510: 2027 6174 6f6d 2070 6f73 6974 696f 6e27   'atom position'
-00003520: 202d 205b 6e78 335d 2061 7272 6179 206f   - [nx3] array o
-00003530: 6620 6174 6f6d 6963 2070 6f73 6974 696f  f atomic positio
-00003540: 6e73 0d0a 2020 2020 2020 2020 2761 746f  ns..        'ato
-00003550: 6d20 6f63 6375 7061 6e63 7927 2d20 5b6e  m occupancy'- [n
-00003560: 7831 5d20 6172 7261 7920 6f66 2061 746f  x1] array of ato
-00003570: 6d20 7369 7465 206f 6363 7570 616e 6369  m site occupanci
-00003580: 6573 0d0a 2020 2020 2020 2020 2761 746f  es..        'ato
-00003590: 6d20 7569 736f 2720 2020 2020 2d20 5b6e  m uiso'     - [n
-000035a0: 7831 5d20 6172 7261 7920 6f66 2061 746f  x1] array of ato
-000035b0: 6d20 7369 7465 2069 736f 7472 6f70 6963  m site isotropic
-000035c0: 2074 6865 726d 616c 2070 6172 616d 6574   thermal paramet
-000035d0: 6572 730d 0a20 2020 2020 2020 2027 6174  ers..        'at
-000035e0: 6f6d 2075 616e 6973 6f27 2020 202d 205b  om uaniso'   - [
-000035f0: 6e78 365d 2061 7272 6179 206f 6620 6174  nx6] array of at
-00003600: 6f6d 2073 6974 6520 616e 6973 6f74 726f  om site anisotro
-00003610: 7069 6320 7468 6572 6d61 6c20 7061 7261  pic thermal para
-00003620: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
-00003630: 276d 6167 206d 6f6d 656e 7427 2020 2020  'mag moment'    
-00003640: 2d20 5b6e 7833 5d20 6172 7261 7920 6f66  - [nx3] array of
-00003650: 2061 746f 6d20 7369 7465 206d 6167 6e65   atom site magne
-00003660: 7469 6320 6d6f 6d65 6e74 2076 6563 746f  tic moment vecto
-00003670: 7273 0d0a 2020 2020 2020 2020 276d 6167  rs..        'mag
-00003680: 2074 696d 6527 2020 2020 2020 2d20 5b6e   time'      - [n
-00003690: 7833 5d20 6172 7261 7920 6f66 2061 746f  x3] array of ato
-000036a0: 6d20 7369 7465 206d 6167 6e65 7469 6320  m site magnetic 
-000036b0: 7469 6d65 2073 796d 6d65 7472 790d 0a20  time symmetry.. 
-000036c0: 2020 2020 2020 2027 6d69 7363 275d 203d         'misc'] =
-000036d0: 205b 656c 656d 656e 742c 206c 6162 656c   [element, label
-000036e0: 2c20 6369 665f 706f 732c 206f 6363 2c20  , cif_pos, occ, 
-000036f0: 5569 736f 5d0d 0a20 2020 203a 7061 7261  Uiso]..    :para
-00003700: 6d20 6369 6676 616c 733a 2064 6963 7420  m cifvals: dict 
-00003710: 6672 6f6d 2072 6561 6463 6966 0d0a 2020  from readcif..  
-00003720: 2020 3a72 6574 7572 6e3a 2064 6963 740d    :return: dict.
-00003730: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
-00003740: 6b65 7973 203d 2063 6966 7661 6c73 2e6b  keys = cifvals.k
-00003750: 6579 7328 290d 0a0d 0a20 2020 2023 2047  eys()....    # G
-00003760: 656e 6572 6174 6520 756e 6974 2076 6563  enerate unit vec
-00003770: 746f 7273 0d0a 2020 2020 612c 2064 6120  tors..    a, da 
-00003780: 3d20 6667 2e72 6561 6473 7466 6d28 6369  = fg.readstfm(ci
-00003790: 6676 616c 735b 275f 6365 6c6c 5f6c 656e  fvals['_cell_len
-000037a0: 6774 685f 6127 5d29 0d0a 2020 2020 622c  gth_a'])..    b,
-000037b0: 2064 6220 3d20 6667 2e72 6561 6473 7466   db = fg.readstf
-000037c0: 6d28 6369 6676 616c 735b 275f 6365 6c6c  m(cifvals['_cell
-000037d0: 5f6c 656e 6774 685f 6227 5d29 0d0a 2020  _length_b'])..  
-000037e0: 2020 632c 2064 6320 3d20 6667 2e72 6561    c, dc = fg.rea
-000037f0: 6473 7466 6d28 6369 6676 616c 735b 275f  dstfm(cifvals['_
-00003800: 6365 6c6c 5f6c 656e 6774 685f 6327 5d29  cell_length_c'])
-00003810: 0d0a 2020 2020 616c 7068 612c 2064 616c  ..    alpha, dal
-00003820: 7068 6120 3d20 6667 2e72 6561 6473 7466  pha = fg.readstf
-00003830: 6d28 6369 6676 616c 735b 275f 6365 6c6c  m(cifvals['_cell
-00003840: 5f61 6e67 6c65 5f61 6c70 6861 275d 290d  _angle_alpha']).
-00003850: 0a20 2020 2062 6574 612c 2064 6265 7461  .    beta, dbeta
-00003860: 203d 2066 672e 7265 6164 7374 666d 2863   = fg.readstfm(c
-00003870: 6966 7661 6c73 5b27 5f63 656c 6c5f 616e  ifvals['_cell_an
-00003880: 676c 655f 6265 7461 275d 290d 0a20 2020  gle_beta'])..   
-00003890: 2067 616d 6d61 2c20 6467 616d 6d61 203d   gamma, dgamma =
-000038a0: 2066 672e 7265 6164 7374 666d 2863 6966   fg.readstfm(cif
-000038b0: 7661 6c73 5b27 5f63 656c 6c5f 616e 676c  vals['_cell_angl
-000038c0: 655f 6761 6d6d 6127 5d29 0d0a 2020 2020  e_gamma'])..    
-000038d0: 5556 203d 206c 6174 7061 7232 7576 2861  UV = latpar2uv(a
-000038e0: 2c20 622c 2063 2c20 616c 7068 612c 2062  , b, c, alpha, b
-000038f0: 6574 612c 2067 616d 6d61 290d 0a0d 0a20  eta, gamma).... 
-00003900: 2020 2023 2047 6574 2061 746f 6d20 6e61     # Get atom na
-00003910: 6d65 7320 2620 6c61 6265 6c73 0d0a 2020  mes & labels..  
-00003920: 2020 6c61 6265 6c20 3d20 6369 6676 616c    label = cifval
-00003930: 735b 275f 6174 6f6d 5f73 6974 655f 6c61  s['_atom_site_la
-00003940: 6265 6c27 5d0d 0a0d 0a20 2020 2069 6620  bel']....    if 
-00003950: 275f 6174 6f6d 5f73 6974 655f 7479 7065  '_atom_site_type
-00003960: 5f73 796d 626f 6c27 2069 6e20 6b65 7973  _symbol' in keys
-00003970: 3a0d 0a20 2020 2020 2020 2065 6c65 6d65  :..        eleme
-00003980: 6e74 203d 205b 782e 7374 7269 7028 272b  nt = [x.strip('+
-00003990: 2d30 3132 3334 3536 3738 3927 2920 666f  -0123456789') fo
-000039a0: 7220 7820 696e 2063 6966 7661 6c73 5b27  r x in cifvals['
-000039b0: 5f61 746f 6d5f 7369 7465 5f74 7970 655f  _atom_site_type_
-000039c0: 7379 6d62 6f6c 275d 5d0d 0a20 2020 2065  symbol']]..    e
-000039d0: 6c73 653a 0d0a 2020 2020 2020 2020 656c  lse:..        el
-000039e0: 656d 656e 7420 3d20 5b78 2e73 7472 6970  ement = [x.strip
-000039f0: 2827 2b2d 3031 3233 3435 3637 3839 2729  ('+-0123456789')
-00003a00: 2066 6f72 2078 2069 6e20 6369 6676 616c   for x in cifval
-00003a10: 735b 275f 6174 6f6d 5f73 6974 655f 6c61  s['_atom_site_la
-00003a20: 6265 6c27 5d5d 0d0a 0d0a 2020 2020 2320  bel']]....    # 
-00003a30: 4765 7420 6f74 6865 7220 7072 6f70 6572  Get other proper
-00003a40: 7469 6573 0d0a 2020 2020 6966 2027 5f61  ties..    if '_a
-00003a50: 746f 6d5f 7369 7465 5f55 5f69 736f 5f6f  tom_site_U_iso_o
-00003a60: 725f 6571 7569 7627 2069 6e20 6b65 7973  r_equiv' in keys
-00003a70: 3a0d 0a20 2020 2020 2020 2055 6973 6f20  :..        Uiso 
-00003a80: 3d20 6e70 2e61 7272 6179 285b 6667 2e72  = np.array([fg.r
-00003a90: 6561 6473 7466 6d28 7829 5b30 5d20 666f  eadstfm(x)[0] fo
-00003aa0: 7220 7820 696e 2063 6966 7661 6c73 5b27  r x in cifvals['
-00003ab0: 5f61 746f 6d5f 7369 7465 5f55 5f69 736f  _atom_site_U_iso
-00003ac0: 5f6f 725f 6571 7569 7627 5d5d 290d 0a20  _or_equiv']]).. 
-00003ad0: 2020 2065 6c69 6620 275f 6174 6f6d 5f73     elif '_atom_s
-00003ae0: 6974 655f 425f 6973 6f5f 6f72 5f65 7175  ite_B_iso_or_equ
-00003af0: 6976 2720 696e 206b 6579 733a 0d0a 2020  iv' in keys:..  
-00003b00: 2020 2020 2020 6269 736f 203d 206e 702e        biso = np.
-00003b10: 6172 7261 7928 5b66 672e 7265 6164 7374  array([fg.readst
-00003b20: 666d 2878 295b 305d 2066 6f72 2078 2069  fm(x)[0] for x i
-00003b30: 6e20 6369 6676 616c 735b 275f 6174 6f6d  n cifvals['_atom
-00003b40: 5f73 6974 655f 425f 6973 6f5f 6f72 5f65  _site_B_iso_or_e
-00003b50: 7175 6976 275d 5d29 0d0a 2020 2020 2020  quiv']])..      
-00003b60: 2020 5569 736f 203d 2062 6973 6f32 7569    Uiso = biso2ui
-00003b70: 736f 2862 6973 6f29 0d0a 2020 2020 656c  so(biso)..    el
-00003b80: 7365 3a0d 0a20 2020 2020 2020 2055 6973  se:..        Uis
-00003b90: 6f20 3d20 6e70 2e7a 6572 6f73 286c 656e  o = np.zeros(len
-00003ba0: 2865 6c65 6d65 6e74 2929 0d0a 2020 2020  (element))..    
-00003bb0: 6966 2027 5f61 746f 6d5f 7369 7465 5f6f  if '_atom_site_o
-00003bc0: 6363 7570 616e 6379 2720 696e 206b 6579  ccupancy' in key
-00003bd0: 733a 0d0a 2020 2020 2020 2020 6f63 6320  s:..        occ 
-00003be0: 3d20 6e70 2e61 7272 6179 285b 6667 2e72  = np.array([fg.r
-00003bf0: 6561 6473 7466 6d28 7829 5b30 5d20 666f  eadstfm(x)[0] fo
-00003c00: 7220 7820 696e 2063 6966 7661 6c73 5b27  r x in cifvals['
-00003c10: 5f61 746f 6d5f 7369 7465 5f6f 6363 7570  _atom_site_occup
-00003c20: 616e 6379 275d 5d29 0d0a 2020 2020 656c  ancy']])..    el
-00003c30: 7365 3a0d 0a20 2020 2020 2020 206f 6363  se:..        occ
-00003c40: 203d 206e 702e 6f6e 6573 286c 656e 2865   = np.ones(len(e
-00003c50: 6c65 6d65 6e74 2929 0d0a 0d0a 2020 2020  lement))....    
-00003c60: 2320 4765 7420 636f 6f72 6469 6e61 7465  # Get coordinate
-00003c70: 730d 0a20 2020 2075 203d 206e 702e 6172  s..    u = np.ar
-00003c80: 7261 7928 5b66 672e 7265 6164 7374 666d  ray([fg.readstfm
-00003c90: 2878 295b 305d 2066 6f72 2078 2069 6e20  (x)[0] for x in 
-00003ca0: 6369 6676 616c 735b 275f 6174 6f6d 5f73  cifvals['_atom_s
-00003cb0: 6974 655f 6672 6163 745f 7827 5d5d 290d  ite_fract_x']]).
-00003cc0: 0a20 2020 2076 203d 206e 702e 6172 7261  .    v = np.arra
-00003cd0: 7928 5b66 672e 7265 6164 7374 666d 2878  y([fg.readstfm(x
-00003ce0: 295b 305d 2066 6f72 2078 2069 6e20 6369  )[0] for x in ci
-00003cf0: 6676 616c 735b 275f 6174 6f6d 5f73 6974  fvals['_atom_sit
-00003d00: 655f 6672 6163 745f 7927 5d5d 290d 0a20  e_fract_y']]).. 
-00003d10: 2020 2077 203d 206e 702e 6172 7261 7928     w = np.array(
-00003d20: 5b66 672e 7265 6164 7374 666d 2878 295b  [fg.readstfm(x)[
-00003d30: 305d 2066 6f72 2078 2069 6e20 6369 6676  0] for x in cifv
-00003d40: 616c 735b 275f 6174 6f6d 5f73 6974 655f  als['_atom_site_
-00003d50: 6672 6163 745f 7a27 5d5d 290d 0a20 2020  fract_z']])..   
-00003d60: 2063 6966 5f70 6f73 203d 206e 702e 6172   cif_pos = np.ar
-00003d70: 7261 7928 5b75 2c20 762c 2077 5d29 2e54  ray([u, v, w]).T
-00003d80: 0d0a 0d0a 2020 2020 2320 4765 7420 6d61  ....    # Get ma
-00003d90: 676e 6574 6963 2076 6563 746f 7273 0d0a  gnetic vectors..
-00003da0: 2020 2020 6369 665f 7665 6320 3d20 6e70      cif_vec = np
-00003db0: 2e7a 6572 6f73 2863 6966 5f70 6f73 2e73  .zeros(cif_pos.s
-00003dc0: 6861 7065 290d 0a20 2020 2063 6966 5f6d  hape)..    cif_m
-00003dd0: 6167 203d 206e 702e 7a65 726f 7328 6c65  ag = np.zeros(le
-00003de0: 6e28 7529 290d 0a20 2020 2069 6620 275f  n(u))..    if '_
-00003df0: 6174 6f6d 5f73 6974 655f 6d6f 6d65 6e74  atom_site_moment
-00003e00: 5f6c 6162 656c 2720 696e 206b 6579 733a  _label' in keys:
-00003e10: 0d0a 2020 2020 2020 2020 6d61 675f 6174  ..        mag_at
-00003e20: 6f6d 7320 3d20 6369 6676 616c 735b 275f  oms = cifvals['_
-00003e30: 6174 6f6d 5f73 6974 655f 6d6f 6d65 6e74  atom_site_moment
-00003e40: 5f6c 6162 656c 275d 0d0a 2020 2020 2020  _label']..      
-00003e50: 2020 6d78 203d 206e 702e 6172 7261 7928    mx = np.array(
-00003e60: 5b66 672e 7265 6164 7374 666d 2878 295b  [fg.readstfm(x)[
-00003e70: 305d 2066 6f72 2078 2069 6e20 6369 6676  0] for x in cifv
-00003e80: 616c 735b 275f 6174 6f6d 5f73 6974 655f  als['_atom_site_
-00003e90: 6d6f 6d65 6e74 5f63 7279 7374 616c 6178  moment_crystalax
-00003ea0: 6973 5f78 275d 5d29 0d0a 2020 2020 2020  is_x']])..      
-00003eb0: 2020 6d79 203d 206e 702e 6172 7261 7928    my = np.array(
-00003ec0: 5b66 672e 7265 6164 7374 666d 2878 295b  [fg.readstfm(x)[
-00003ed0: 305d 2066 6f72 2078 2069 6e20 6369 6676  0] for x in cifv
-00003ee0: 616c 735b 275f 6174 6f6d 5f73 6974 655f  als['_atom_site_
-00003ef0: 6d6f 6d65 6e74 5f63 7279 7374 616c 6178  moment_crystalax
-00003f00: 6973 5f79 275d 5d29 0d0a 2020 2020 2020  is_y']])..      
-00003f10: 2020 6d7a 203d 206e 702e 6172 7261 7928    mz = np.array(
-00003f20: 5b66 672e 7265 6164 7374 666d 2878 295b  [fg.readstfm(x)[
-00003f30: 305d 2066 6f72 2078 2069 6e20 6369 6676  0] for x in cifv
-00003f40: 616c 735b 275f 6174 6f6d 5f73 6974 655f  als['_atom_site_
-00003f50: 6d6f 6d65 6e74 5f63 7279 7374 616c 6178  moment_crystalax
-00003f60: 6973 5f7a 275d 5d29 0d0a 2020 2020 2020  is_z']])..      
-00003f70: 2020 6d61 675f 706f 7320 3d20 6e70 2e61    mag_pos = np.a
-00003f80: 7272 6179 285b 6d78 2c20 6d79 2c20 6d7a  rray([mx, my, mz
-00003f90: 5d29 2e54 0d0a 2020 2020 2020 2020 666f  ]).T..        fo
-00003fa0: 7220 6e2c 206d 6120 696e 2065 6e75 6d65  r n, ma in enume
-00003fb0: 7261 7465 286d 6167 5f61 746f 6d73 293a  rate(mag_atoms):
-00003fc0: 0d0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
-00003fd0: 675f 6964 7820 3d20 6c61 6265 6c2e 696e  g_idx = label.in
-00003fe0: 6465 7828 6d61 290d 0a20 2020 2020 2020  dex(ma)..       
-00003ff0: 2020 2020 2063 6966 5f76 6563 5b6d 6167       cif_vec[mag
-00004000: 5f69 6478 2c20 3a5d 203d 206d 6167 5f70  _idx, :] = mag_p
-00004010: 6f73 5b6e 2c20 3a5d 0d0a 2020 2020 2020  os[n, :]..      
-00004020: 2020 2020 2020 6369 665f 6d61 675b 6d61        cif_mag[ma
-00004030: 675f 6964 785d 203d 2066 672e 6d61 6728  g_idx] = fg.mag(
-00004040: 6d61 675f 706f 735b 6e2c 203a 5d29 0d0a  mag_pos[n, :])..
-00004050: 0d0a 2020 2020 2320 4765 7420 7379 6d6d  ..    # Get symm
-00004060: 6574 7279 206f 7065 7261 7469 6f6e 730d  etry operations.
-00004070: 0a20 2020 2069 6620 275f 7379 6d6d 6574  .    if '_symmet
-00004080: 7279 5f65 7175 6976 5f70 6f73 5f61 735f  ry_equiv_pos_as_
-00004090: 7879 7a27 2069 6e20 6b65 7973 3a0d 0a20  xyz' in keys:.. 
-000040a0: 2020 2020 2020 2073 796d 6f70 7320 3d20         symops = 
-000040b0: 6369 6676 616c 735b 275f 7379 6d6d 6574  cifvals['_symmet
-000040c0: 7279 5f65 7175 6976 5f70 6f73 5f61 735f  ry_equiv_pos_as_
-000040d0: 7879 7a27 5d0d 0a20 2020 2020 2020 2073  xyz']..        s
-000040e0: 796d 7469 6d20 3d20 5b31 5d20 2a20 6c65  ymtim = [1] * le
-000040f0: 6e28 7379 6d6f 7073 290d 0a20 2020 2020  n(symops)..     
-00004100: 2020 2073 796d 6d61 6720 3d20 5b27 6d78     symmag = ['mx
-00004110: 2c6d 792c 6d7a 275d 202a 206c 656e 2873  ,my,mz'] * len(s
-00004120: 796d 6f70 7329 0d0a 2020 2020 2020 2020  ymops)..        
-00004130: 7379 6d63 656e 203d 205b 2778 2c79 2c7a  symcen = ['x,y,z
-00004140: 275d 0d0a 2020 2020 2020 2020 7379 6d63  ']..        symc
-00004150: 656e 7469 6d20 3d20 5b31 5d0d 0a20 2020  entim = [1]..   
-00004160: 2020 2020 2073 796d 6365 6e6d 6167 203d       symcenmag =
-00004170: 205b 276d 782c 6d79 2c6d 7a27 5d0d 0a20   ['mx,my,mz'].. 
-00004180: 2020 2065 6c69 6620 275f 7370 6163 655f     elif '_space_
-00004190: 6772 6f75 705f 7379 6d6f 705f 6f70 6572  group_symop_oper
-000041a0: 6174 696f 6e5f 7879 7a27 2069 6e20 6b65  ation_xyz' in ke
-000041b0: 7973 3a0d 0a20 2020 2020 2020 2073 796d  ys:..        sym
-000041c0: 6f70 7320 3d20 6369 6676 616c 735b 275f  ops = cifvals['_
-000041d0: 7370 6163 655f 6772 6f75 705f 7379 6d6f  space_group_symo
-000041e0: 705f 6f70 6572 6174 696f 6e5f 7879 7a27  p_operation_xyz'
-000041f0: 5d0d 0a20 2020 2020 2020 2073 796d 7469  ]..        symti
-00004200: 6d20 3d20 5b31 5d20 2a20 6c65 6e28 7379  m = [1] * len(sy
-00004210: 6d6f 7073 290d 0a20 2020 2020 2020 2073  mops)..        s
-00004220: 796d 6d61 6720 3d20 5b27 6d78 2c6d 792c  ymmag = ['mx,my,
-00004230: 6d7a 275d 202a 206c 656e 2873 796d 6f70  mz'] * len(symop
-00004240: 7329 0d0a 2020 2020 2020 2020 7379 6d63  s)..        symc
-00004250: 656e 203d 205b 2778 2c79 2c7a 275d 0d0a  en = ['x,y,z']..
-00004260: 2020 2020 2020 2020 7379 6d63 656e 7469          symcenti
-00004270: 6d20 3d20 5b31 5d0d 0a20 2020 2020 2020  m = [1]..       
-00004280: 2073 796d 6365 6e6d 6167 203d 205b 276d   symcenmag = ['m
-00004290: 782c 6d79 2c6d 7a27 5d0d 0a20 2020 2065  x,my,mz']..    e
-000042a0: 6c69 6620 275f 7370 6163 655f 6772 6f75  lif '_space_grou
-000042b0: 705f 7379 6d6f 702e 6d61 676e 5f6f 7065  p_symop.magn_ope
-000042c0: 7261 7469 6f6e 5f78 797a 2720 696e 206b  ration_xyz' in k
-000042d0: 6579 733a 0d0a 2020 2020 2020 2020 7379  eys:..        sy
-000042e0: 6d6f 7073 5f74 696d 203d 2063 6966 7661  mops_tim = cifva
-000042f0: 6c73 5b27 5f73 7061 6365 5f67 726f 7570  ls['_space_group
-00004300: 5f73 796d 6f70 2e6d 6167 6e5f 6f70 6572  _symop.magn_oper
-00004310: 6174 696f 6e5f 7879 7a27 5d0d 0a20 2020  ation_xyz']..   
-00004320: 2020 2020 2023 2045 6163 6820 7379 6d6f       # Each symo
-00004330: 7020 6769 7665 6e20 7769 7468 2074 696d  p given with tim
-00004340: 6520 7661 6c75 653a 2078 2c79 2c7a 2c2b  e value: x,y,z,+
-00004350: 312c 2073 6570 6172 6174 6520 7468 656d  1, separate them
-00004360: 3a0d 0a20 2020 2020 2020 2073 796d 6f70  :..        symop
-00004370: 7320 3d20 5b27 2c27 2e6a 6f69 6e28 732e  s = [','.join(s.
-00004380: 7370 6c69 7428 272c 2729 5b3a 335d 2920  split(',')[:3]) 
-00004390: 666f 7220 7320 696e 2073 796d 6f70 735f  for s in symops_
-000043a0: 7469 6d5d 2020 2320 782c 792c 7a0d 0a20  tim]  # x,y,z.. 
-000043b0: 2020 2020 2020 2073 796d 7469 6d20 3d20         symtim = 
-000043c0: 5b6e 702e 696e 7428 732e 7370 6c69 7428  [np.int(s.split(
-000043d0: 272c 2729 5b2d 315d 2920 666f 7220 7320  ',')[-1]) for s 
-000043e0: 696e 2073 796d 6f70 735f 7469 6d5d 2020  in symops_tim]  
-000043f0: 2320 2b31 0d0a 2020 2020 2020 2020 7379  # +1..        sy
-00004400: 6d6d 6167 203d 2063 6966 7661 6c73 5b27  mmag = cifvals['
-00004410: 5f73 7061 6365 5f67 726f 7570 5f73 796d  _space_group_sym
-00004420: 6f70 2e6d 6167 6e5f 6f70 6572 6174 696f  op.magn_operatio
-00004430: 6e5f 6d78 6d79 6d7a 275d 0d0a 0d0a 2020  n_mxmymz']....  
-00004440: 2020 2020 2020 2320 4365 6e74 7269 6e67        # Centring
-00004450: 2076 6563 746f 7273 2061 6c73 6f20 6769   vectors also gi
-00004460: 7665 6e20 696e 2074 6869 7320 6361 7365  ven in this case
-00004470: 0d0a 2020 2020 2020 2020 7379 6d63 656e  ..        symcen
-00004480: 5f74 696d 203d 2063 6966 7661 6c73 5b27  _tim = cifvals['
-00004490: 5f73 7061 6365 5f67 726f 7570 5f73 796d  _space_group_sym
-000044a0: 6f70 2e6d 6167 6e5f 6365 6e74 6572 696e  op.magn_centerin
-000044b0: 675f 7879 7a27 5d0d 0a20 2020 2020 2020  g_xyz']..       
-000044c0: 2073 796d 6365 6e20 3d20 5b27 2c27 2e6a   symcen = [','.j
-000044d0: 6f69 6e28 732e 7370 6c69 7428 272c 2729  oin(s.split(',')
-000044e0: 5b3a 335d 2920 666f 7220 7320 696e 2073  [:3]) for s in s
-000044f0: 796d 6365 6e5f 7469 6d5d 2020 2320 782c  ymcen_tim]  # x,
-00004500: 792c 7a0d 0a20 2020 2020 2020 2073 796d  y,z..        sym
-00004510: 6365 6e74 696d 203d 205b 6e70 2e69 6e74  centim = [np.int
-00004520: 2873 2e73 706c 6974 2827 2c27 295b 2d31  (s.split(',')[-1
-00004530: 5d29 2066 6f72 2073 2069 6e20 7379 6d63  ]) for s in symc
-00004540: 656e 5f74 696d 5d20 2023 202b 310d 0a20  en_tim]  # +1.. 
-00004550: 2020 2020 2020 2073 796d 6365 6e6d 6167         symcenmag
-00004560: 203d 2063 6966 7661 6c73 5b27 5f73 7061   = cifvals['_spa
-00004570: 6365 5f67 726f 7570 5f73 796d 6f70 2e6d  ce_group_symop.m
-00004580: 6167 6e5f 6365 6e74 6572 696e 675f 6d78  agn_centering_mx
-00004590: 6d79 6d7a 275d 0d0a 2020 2020 656c 7365  mymz']..    else
-000045a0: 3a0d 0a20 2020 2020 2020 2073 796d 6f70  :..        symop
-000045b0: 7320 3d20 5b27 782c 792c 7a27 5d0d 0a20  s = ['x,y,z'].. 
-000045c0: 2020 2020 2020 2073 796d 7469 6d20 3d20         symtim = 
-000045d0: 5b31 5d0d 0a20 2020 2020 2020 2073 796d  [1]..        sym
-000045e0: 6d61 6720 3d20 5b27 6d78 2c6d 792c 6d7a  mag = ['mx,my,mz
-000045f0: 275d 0d0a 2020 2020 2020 2020 7379 6d63  ']..        symc
-00004600: 656e 203d 205b 2778 2c79 2c7a 275d 0d0a  en = ['x,y,z']..
-00004610: 2020 2020 2020 2020 7379 6d63 656e 7469          symcenti
-00004620: 6d20 3d20 5b31 5d0d 0a20 2020 2020 2020  m = [1]..       
-00004630: 2073 796d 6365 6e6d 6167 203d 205b 276d   symcenmag = ['m
-00004640: 782c 6d79 2c6d 7a27 5d0d 0a20 2020 2073  x,my,mz']..    s
-00004650: 796d 6f70 7320 3d20 5b72 652e 7375 6228  ymops = [re.sub(
-00004660: 275c 2727 2c20 2727 2c20 7829 2066 6f72  '\'', '', x) for
-00004670: 2078 2069 6e20 7379 6d6f 7073 5d0d 0a20   x in symops].. 
-00004680: 2020 2073 796d 6d61 6720 3d20 5b73 6d2e     symmag = [sm.
-00004690: 7265 706c 6163 6528 276d 272c 2027 2729  replace('m', '')
-000046a0: 2066 6f72 2073 6d20 696e 2073 796d 6d61   for sm in symma
-000046b0: 675d 2020 2320 7265 6d6f 7665 206d 0d0a  g]  # remove m..
-000046c0: 2020 2020 7379 6d63 656e 6d61 6720 3d20      symcenmag = 
-000046d0: 5b73 6d2e 7265 706c 6163 6528 276d 272c  [sm.replace('m',
-000046e0: 2027 2729 2066 6f72 2073 6d20 696e 2073   '') for sm in s
-000046f0: 796d 6365 6e6d 6167 5d20 2023 2072 656d  ymcenmag]  # rem
-00004700: 6f76 6520 6d0d 0a0d 0a20 2020 2023 2047  ove m....    # G
-00004710: 6574 206d 6167 6e65 7469 6320 7379 6d6d  et magnetic symm
-00004720: 6574 7279 2063 6f6e 7374 7261 696e 7473  etry constraints
-00004730: 0d0a 2020 2020 6966 2027 5f6d 6167 6e65  ..    if '_magne
-00004740: 7469 635f 6174 6f6d 5f73 6974 655f 6d6f  tic_atom_site_mo
-00004750: 6d65 6e74 5f73 796d 6d65 7472 795f 636f  ment_symmetry_co
-00004760: 6e73 7472 6169 6e74 735f 6c61 6265 6c27  nstraints_label'
-00004770: 2069 6e20 6b65 7973 3a0d 0a20 2020 2020   in keys:..     
-00004780: 2020 2063 6f6e 7374 5f6c 6162 656c 7320     const_labels 
-00004790: 3d20 6369 6676 616c 735b 275f 6d61 676e  = cifvals['_magn
-000047a0: 6574 6963 5f61 746f 6d5f 7369 7465 5f6d  etic_atom_site_m
-000047b0: 6f6d 656e 745f 7379 6d6d 6574 7279 5f63  oment_symmetry_c
-000047c0: 6f6e 7374 7261 696e 7473 5f6c 6162 656c  onstraints_label
-000047d0: 275d 0d0a 2020 2020 2020 2020 636f 6e73  ']..        cons
-000047e0: 7472 6169 6e74 7320 3d20 6369 6676 616c  traints = cifval
-000047f0: 735b 275f 6174 6f6d 5f73 6974 655f 6d61  s['_atom_site_ma
-00004800: 676e 6574 6963 5f6d 6f6d 656e 745f 7379  gnetic_moment_sy
-00004810: 6d6d 6574 7279 5f63 6f6e 7374 7261 696e  mmetry_constrain
-00004820: 7473 5f6d 786d 796d 7a27 5d0d 0a20 2020  ts_mxmymz']..   
-00004830: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00004840: 636f 6e73 745f 6c61 6265 6c73 203d 205b  const_labels = [
-00004850: 5d0d 0a20 2020 2020 2020 2063 6f6e 7374  ]..        const
-00004860: 7261 696e 7473 203d 205b 5d0d 0a0d 0a20  raints = [].... 
-00004870: 2020 2023 2061 7070 6c79 2073 796d 6d65     # apply symme
-00004880: 7472 7920 6f70 6572 6174 696f 6e73 2074  try operations t
-00004890: 6f20 6561 6368 2070 6f73 6974 696f 6e2c  o each position,
-000048a0: 2067 656e 6572 6174 696e 6720 5031 2073   generating P1 s
-000048b0: 7472 7563 7475 7265 0d0a 2020 2020 2320  tructure..    # 
-000048c0: 416c 736f 2072 6570 6561 7420 6561 6368  Also repeat each
-000048d0: 2065 6c65 6d65 6e74 2070 726f 7065 7274   element propert
-000048e0: 790d 0a20 2020 204e 7379 6d4f 7073 203d  y..    NsymOps =
-000048f0: 206c 656e 2873 796d 6f70 7329 0d0a 2020   len(symops)..  
-00004900: 2020 4e63 656e 4f70 7320 3d20 6c65 6e28    NcenOps = len(
-00004910: 7379 6d63 656e 290d 0a20 2020 204e 6f70  symcen)..    Nop
-00004920: 7320 3d20 4e73 796d 4f70 7320 2a20 4e63  s = NsymOps * Nc
-00004930: 656e 4f70 730d 0a20 2020 2070 3170 6f73  enOps..    p1pos
-00004940: 203d 206e 702e 656d 7074 7928 5b30 2c20   = np.empty([0, 
-00004950: 335d 290d 0a20 2020 2070 3176 6563 203d  3])..    p1vec =
-00004960: 206e 702e 656d 7074 7928 5b30 2c20 335d   np.empty([0, 3]
-00004970: 290d 0a20 2020 2070 316d 6167 203d 205b  )..    p1mag = [
-00004980: 5d0d 0a20 2020 2070 3174 7970 203d 205b  ]..    p1typ = [
-00004990: 5d0d 0a20 2020 2070 316c 626c 203d 205b  ]..    p1lbl = [
-000049a0: 5d0d 0a20 2020 2070 316f 6363 203d 205b  ]..    p1occ = [
-000049b0: 5d0d 0a20 2020 2070 3155 6973 6f20 3d20  ]..    p1Uiso = 
-000049c0: 5b5d 0d0a 2020 2020 7031 7469 6d20 3d20  []..    p1tim = 
-000049d0: 5b5d 0d0a 2020 2020 666f 7220 6e2c 2028  []..    for n, (
-000049e0: 782c 2079 2c20 7a29 2069 6e20 656e 756d  x, y, z) in enum
-000049f0: 6572 6174 6528 6369 665f 706f 7329 3a0d  erate(cif_pos):.
-00004a00: 0a20 2020 2020 2020 2075 7677 203d 2067  .        uvw = g
-00004a10: 656e 5f73 796d 5f70 6f73 2873 796d 6f70  en_sym_pos(symop
-00004a20: 732c 2078 2c20 792c 207a 290d 0a20 2020  s, x, y, z)..   
-00004a30: 2020 2020 2075 7677 203d 2066 6974 696e       uvw = fitin
-00004a40: 6365 6c6c 2875 7677 290d 0a0d 0a20 2020  cell(uvw)....   
-00004a50: 2020 2020 2023 2041 7070 6c79 2073 796d       # Apply sym
-00004a60: 6d65 7472 7920 636f 6e73 7472 6169 6e74  metry constraint
-00004a70: 730d 0a20 2020 2020 2020 2069 6620 6c61  s..        if la
-00004a80: 6265 6c5b 6e5d 2069 6e20 636f 6e73 745f  bel[n] in const_
-00004a90: 6c61 6265 6c73 3a0d 0a20 2020 2020 2020  labels:..       
-00004aa0: 2020 2020 2023 2041 7373 756d 6573 2073       # Assumes s
-00004ab0: 696e 676c 6520 636f 6e73 7472 6169 6e74  ingle constraint
-00004ac0: 2070 6572 2061 746f 6d0d 0a20 2020 2020   per atom..     
-00004ad0: 2020 2020 2020 2069 6478 203d 2063 6f6e         idx = con
-00004ae0: 7374 5f6c 6162 656c 732e 696e 6465 7828  st_labels.index(
-00004af0: 6c61 6265 6c5b 6e5d 290d 0a20 2020 2020  label[n])..     
-00004b00: 2020 2020 2020 2043 203d 2063 6f6e 7374         C = const
-00004b10: 7261 696e 7473 5b69 6478 5d0d 0a20 2020  raints[idx]..   
-00004b20: 2020 2020 2020 2020 2043 203d 2043 2e72           C = C.r
-00004b30: 6570 6c61 6365 2827 6d27 2c20 2727 290d  eplace('m', '').
-00004b40: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-00004b50: 7269 6e74 2827 436f 6e73 7472 6169 6e74  rint('Constraint
-00004b60: 3a20 7b3a 3373 7d20 7b3a 737d 272e 666f  : {:3s} {:s}'.fo
-00004b70: 726d 6174 286c 6162 656c 5b6e 5d2c 4329  rmat(label[n],C)
-00004b80: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00004b90: 2063 6f6e 7665 7274 2027 3278 2720 746f   convert '2x' to
-00004ba0: 2027 7827 0d0a 2020 2020 2020 2020 2020   'x'..          
-00004bb0: 2020 6f6c 6420 3d20 7265 2e66 696e 6461    old = re.finda
-00004bc0: 6c6c 2827 5c64 5b78 797a 5d27 2c20 4329  ll('\d[xyz]', C)
-00004bd0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-00004be0: 7720 3d20 5b73 2e72 6570 6c61 6365 2827  w = [s.replace('
-00004bf0: 7827 2c20 272a 7827 292e 7265 706c 6163  x', '*x').replac
-00004c00: 6528 2779 272c 2027 2a79 2729 2e72 6570  e('y', '*y').rep
-00004c10: 6c61 6365 2827 7a27 2c20 272a 7a27 2920  lace('z', '*z') 
-00004c20: 666f 7220 7320 696e 206f 6c64 5d0d 0a20  for s in old].. 
-00004c30: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-00004c40: 2069 6e20 7261 6e67 6528 6c65 6e28 6f6c   in range(len(ol
-00004c50: 6429 293a 0d0a 2020 2020 2020 2020 2020  d)):..          
-00004c60: 2020 2020 2020 4320 3d20 432e 7265 706c        C = C.repl
-00004c70: 6163 6528 6f6c 645b 735d 2c20 6e65 775b  ace(old[s], new[
-00004c80: 735d 290d 0a20 2020 2020 2020 2020 2020  s])..           
-00004c90: 2043 203d 2043 2e73 706c 6974 2827 2c27   C = C.split(','
-00004ca0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00004cb0: 2041 7070 6c79 2063 6f6e 7374 7261 696e   Apply constrain
-00004cc0: 7420 746f 2073 796d 6d65 7472 7920 6172  t to symmetry ar
-00004cd0: 6775 6d65 6e74 730d 0a20 2020 2020 2020  guments..       
-00004ce0: 2020 2020 2053 203d 205b 732e 7265 706c       S = [s.repl
-00004cf0: 6163 6528 2778 272c 2027 6127 292e 7265  ace('x', 'a').re
-00004d00: 706c 6163 6528 2779 272c 2027 6227 292e  place('y', 'b').
-00004d10: 7265 706c 6163 6528 277a 272c 2027 6327  replace('z', 'c'
-00004d20: 2920 666f 7220 7320 696e 2073 796d 6d61  ) for s in symma
-00004d30: 675d 0d0a 2020 2020 2020 2020 2020 2020  g]..            
-00004d40: 5320 3d20 5b73 2e72 6570 6c61 6365 2827  S = [s.replace('
-00004d50: 6127 2c20 435b 305d 292e 7265 706c 6163  a', C[0]).replac
-00004d60: 6528 2762 272c 2043 5b31 5d29 2e72 6570  e('b', C[1]).rep
-00004d70: 6c61 6365 2827 6327 2c20 435b 325d 2920  lace('c', C[2]) 
-00004d80: 666f 7220 7320 696e 2053 5d0d 0a20 2020  for s in S]..   
-00004d90: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00004da0: 2020 2020 2020 2020 5320 3d20 7379 6d6d          S = symm
-00004db0: 6167 0d0a 0d0a 2020 2020 2020 2020 6d78  ag....        mx
-00004dc0: 2c20 6d79 2c20 6d7a 203d 2063 6966 5f76  , my, mz = cif_v
-00004dd0: 6563 5b6e 5d0d 0a20 2020 2020 2020 206d  ec[n]..        m
-00004de0: 6167 5f75 7677 203d 2067 656e 5f73 796d  ag_uvw = gen_sym
-00004df0: 5f70 6f73 2853 2c20 6d78 2c20 6d79 2c20  _pos(S, mx, my, 
-00004e00: 6d7a 290d 0a20 2020 2020 2020 2023 2070  mz)..        # p
-00004e10: 7269 6e74 2827 2d2d 2d7b 3a33 2e30 667d  rint('---{:3.0f}
-00004e20: 2e20 7b3a 3273 7d20 287b 3a35 2e32 667d  . {:2s} ({:5.2f}
-00004e30: 2c7b 3a35 2e32 667d 2c7b 3a35 2e32 667d  ,{:5.2f},{:5.2f}
-00004e40: 292d 2d2d 272e 666f 726d 6174 286e 2c6c  )---'.format(n,l
-00004e50: 6162 656c 5b6e 5d2c 6d78 2c6d 792c 6d7a  abel[n],mx,my,mz
-00004e60: 2929 0d0a 0d0a 2020 2020 2020 2020 2320  ))....        # 
-00004e70: 4c6f 6f70 206f 7665 7220 6365 6e74 7269  Loop over centri
-00004e80: 6e67 206f 7065 7261 7469 6f6e 730d 0a20  ng operations.. 
-00004e90: 2020 2020 2020 2073 796d 706f 7320 3d20         sympos = 
-00004ea0: 6e70 2e7a 6572 6f73 285b 4e6f 7073 2c20  np.zeros([Nops, 
-00004eb0: 335d 290d 0a20 2020 2020 2020 2073 796d  3])..        sym
-00004ec0: 6d61 6770 6f73 203d 206e 702e 7a65 726f  magpos = np.zero
-00004ed0: 7328 5b4e 6f70 732c 2033 5d29 0d0a 2020  s([Nops, 3])..  
-00004ee0: 2020 2020 2020 7379 6d74 696d 706f 7320        symtimpos 
-00004ef0: 3d20 6e70 2e7a 6572 6f73 284e 6f70 7329  = np.zeros(Nops)
-00004f00: 0d0a 2020 2020 2020 2020 666f 7220 6d2c  ..        for m,
-00004f10: 2028 6378 2c20 6379 2c20 637a 2920 696e   (cx, cy, cz) in
-00004f20: 2065 6e75 6d65 7261 7465 2875 7677 293a   enumerate(uvw):
-00004f30: 0d0a 2020 2020 2020 2020 2020 2020 4e69  ..            Ni
-00004f40: 2c20 4e6a 203d 206d 202a 204e 6365 6e4f  , Nj = m * NcenO
-00004f50: 7073 2c20 286d 202b 2031 2920 2a20 4e63  ps, (m + 1) * Nc
-00004f60: 656e 4f70 730d 0a20 2020 2020 2020 2020  enOps..         
-00004f70: 2020 2063 656e 5f75 7677 203d 2067 656e     cen_uvw = gen
-00004f80: 5f73 796d 5f70 6f73 2873 796d 6365 6e2c  _sym_pos(symcen,
-00004f90: 2063 782c 2063 792c 2063 7a29 0d0a 2020   cx, cy, cz)..  
-00004fa0: 2020 2020 2020 2020 2020 6365 6e5f 7576            cen_uv
-00004fb0: 7720 3d20 6669 7469 6e63 656c 6c28 6365  w = fitincell(ce
-00004fc0: 6e5f 7576 7729 0d0a 2020 2020 2020 2020  n_uvw)..        
-00004fd0: 2020 2020 7379 6d70 6f73 5b4e 693a 4e6a      sympos[Ni:Nj
-00004fe0: 2c20 3a5d 203d 2063 656e 5f75 7677 0d0a  , :] = cen_uvw..
-00004ff0: 0d0a 2020 2020 2020 2020 2020 2020 636d  ..            cm
-00005000: 782c 2063 6d79 2c20 636d 7a20 3d20 6d61  x, cmy, cmz = ma
-00005010: 675f 7576 775b 6d5d 0d0a 2020 2020 2020  g_uvw[m]..      
-00005020: 2020 2020 2020 6d61 675f 6365 6e20 3d20        mag_cen = 
-00005030: 6765 6e5f 7379 6d5f 706f 7328 7379 6d63  gen_sym_pos(symc
-00005040: 656e 6d61 672c 2063 6d78 2c20 636d 792c  enmag, cmx, cmy,
-00005050: 2063 6d7a 290d 0a20 2020 2020 2020 2020   cmz)..         
-00005060: 2020 2023 2070 7269 6e74 2827 2020 5379     # print('  Sy
-00005070: 6d7b 3a32 2e30 667d 3a20 7b3a 3130 737d  m{:2.0f}: {:10s}
-00005080: 2028 7b3a 352e 3266 7d2c 7b3a 352e 3266   ({:5.2f},{:5.2f
-00005090: 7d2c 7b3a 352e 3266 7d29 272e 666f 726d  },{:5.2f})'.form
-000050a0: 6174 286d 2c53 5b6d 5d2c 636d 782c 636d  at(m,S[m],cmx,cm
-000050b0: 792c 636d 7a29 290d 0a20 2020 2020 2020  y,cmz))..       
-000050c0: 2020 2020 2023 2066 6f72 206f 2069 6e20       # for o in 
-000050d0: 7261 6e67 6528 6c65 6e28 6d61 675f 6365  range(len(mag_ce
-000050e0: 6e29 293a 0d0a 2020 2020 2020 2020 2020  n)):..          
-000050f0: 2020 2320 7072 696e 7428 2720 2020 2043    # print('    C
-00005100: 656e 7b3a 312e 3066 7d3a 207b 3a31 3073  en{:1.0f}: {:10s
-00005110: 7d20 287b 3a35 2e32 667d 2c7b 3a35 2e32  } ({:5.2f},{:5.2
-00005120: 667d 2c7b 3a35 2e32 667d 2927 2e66 6f72  f},{:5.2f})'.for
-00005130: 6d61 7428 6f2c 7379 6d63 656e 6d61 675b  mat(o,symcenmag[
-00005140: 6f5d 2c2a 6d61 675f 6365 6e5b 6f5d 2929  o],*mag_cen[o]))
-00005150: 0d0a 2020 2020 2020 2020 2020 2020 7379  ..            sy
-00005160: 6d6d 6167 706f 735b 4e69 3a4e 6a2c 203a  mmagpos[Ni:Nj, :
-00005170: 5d20 3d20 6d61 675f 6365 6e0d 0a20 2020  ] = mag_cen..   
-00005180: 2020 2020 2020 2020 2073 796d 7469 6d70           symtimp
-00005190: 6f73 5b4e 693a 4e6a 5d20 3d20 7379 6d74  os[Ni:Nj] = symt
-000051a0: 696d 5b6d 5d20 2a20 6e70 2e61 7272 6179  im[m] * np.array
-000051b0: 2873 796d 6365 6e74 696d 290d 0a0d 0a20  (symcentim).... 
-000051c0: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
-000051d0: 6475 706c 6963 6174 6573 0d0a 2020 2020  duplicates..    
-000051e0: 2020 2020 6e65 7761 7272 6179 2c20 756e      newarray, un
-000051f0: 6971 7565 6964 782c 206d 6174 6368 6964  iqueidx, matchid
-00005200: 7820 3d20 6667 2e75 6e69 7175 655f 7665  x = fg.unique_ve
-00005210: 6374 6f72 2873 796d 706f 732c 2030 2e30  ctor(sympos, 0.0
-00005220: 3129 0d0a 2020 2020 2020 2020 6365 6e5f  1)..        cen_
-00005230: 7576 7720 3d20 7379 6d70 6f73 5b75 6e69  uvw = sympos[uni
-00005240: 7175 6569 6478 2c20 3a5d 0d0a 2020 2020  queidx, :]..    
-00005250: 2020 2020 6d61 675f 6365 6e20 3d20 7379      mag_cen = sy
-00005260: 6d6d 6167 706f 735b 756e 6971 7565 6964  mmagpos[uniqueid
-00005270: 782c 203a 5d0d 0a20 2020 2020 2020 2073  x, :]..        s
-00005280: 796d 7469 6d70 6f73 203d 2073 796d 7469  ymtimpos = symti
-00005290: 6d70 6f73 5b75 6e69 7175 6569 6478 5d0d  mpos[uniqueidx].
-000052a0: 0a0d 0a20 2020 2020 2020 2023 2041 7070  ...        # App
-000052b0: 656e 6420 746f 2050 3120 6174 6f6d 7320  end to P1 atoms 
-000052c0: 6172 7261 7973 0d0a 2020 2020 2020 2020  arrays..        
-000052d0: 7031 706f 7320 3d20 6e70 2e61 7070 656e  p1pos = np.appen
-000052e0: 6428 7031 706f 732c 2063 656e 5f75 7677  d(p1pos, cen_uvw
-000052f0: 2c20 6178 6973 3d30 290d 0a20 2020 2020  , axis=0)..     
-00005300: 2020 2070 3176 6563 203d 206e 702e 6170     p1vec = np.ap
-00005310: 7065 6e64 2870 3176 6563 2c20 6d61 675f  pend(p1vec, mag_
-00005320: 6365 6e2c 2061 7869 733d 3029 0d0a 2020  cen, axis=0)..  
-00005330: 2020 2020 2020 7031 6d61 6720 3d20 6e70        p1mag = np
-00005340: 2e61 7070 656e 6428 7031 6d61 672c 206e  .append(p1mag, n
-00005350: 702e 7265 7065 6174 2863 6966 5f6d 6167  p.repeat(cif_mag
-00005360: 5b6e 5d2c 206c 656e 2863 656e 5f75 7677  [n], len(cen_uvw
-00005370: 2929 290d 0a20 2020 2020 2020 2070 3174  )))..        p1t
-00005380: 696d 203d 206e 702e 6170 7065 6e64 2870  im = np.append(p
-00005390: 3174 696d 2c20 7379 6d74 696d 706f 7329  1tim, symtimpos)
-000053a0: 0d0a 2020 2020 2020 2020 7031 7479 7020  ..        p1typ 
-000053b0: 3d20 6e70 2e61 7070 656e 6428 7031 7479  = np.append(p1ty
-000053c0: 702c 206e 702e 7265 7065 6174 2865 6c65  p, np.repeat(ele
-000053d0: 6d65 6e74 5b6e 5d2c 206c 656e 2863 656e  ment[n], len(cen
-000053e0: 5f75 7677 2929 290d 0a20 2020 2020 2020  _uvw)))..       
-000053f0: 2070 316c 626c 203d 206e 702e 6170 7065   p1lbl = np.appe
-00005400: 6e64 2870 316c 626c 2c20 6e70 2e72 6570  nd(p1lbl, np.rep
-00005410: 6561 7428 6c61 6265 6c5b 6e5d 2c20 6c65  eat(label[n], le
-00005420: 6e28 6365 6e5f 7576 7729 2929 0d0a 2020  n(cen_uvw)))..  
-00005430: 2020 2020 2020 7031 6f63 6320 3d20 6e70        p1occ = np
-00005440: 2e61 7070 656e 6428 7031 6f63 632c 206e  .append(p1occ, n
-00005450: 702e 7265 7065 6174 286f 6363 5b6e 5d2c  p.repeat(occ[n],
-00005460: 206c 656e 2863 656e 5f75 7677 2929 290d   len(cen_uvw))).
-00005470: 0a20 2020 2020 2020 2070 3155 6973 6f20  .        p1Uiso 
-00005480: 3d20 6e70 2e61 7070 656e 6428 7031 5569  = np.append(p1Ui
-00005490: 736f 2c20 6e70 2e72 6570 6561 7428 5569  so, np.repeat(Ui
-000054a0: 736f 5b6e 5d2c 206c 656e 2863 656e 5f75  so[n], len(cen_u
-000054b0: 7677 2929 290d 0a0d 0a20 2020 2023 2047  vw)))....    # G
-000054c0: 6574 2073 7061 6365 2067 726f 7570 0d0a  et space group..
-000054d0: 2020 2020 6966 2027 5f73 796d 6d65 7472      if '_symmetr
-000054e0: 795f 7370 6163 655f 6772 6f75 705f 6e61  y_space_group_na
-000054f0: 6d65 5f48 2d4d 2720 696e 206b 6579 733a  me_H-M' in keys:
-00005500: 0d0a 2020 2020 2020 2020 7370 6163 6567  ..        spaceg
-00005510: 726f 7570 203d 2063 6966 7661 6c73 5b27  roup = cifvals['
-00005520: 5f73 796d 6d65 7472 795f 7370 6163 655f  _symmetry_space_
-00005530: 6772 6f75 705f 6e61 6d65 5f48 2d4d 275d  group_name_H-M']
-00005540: 0d0a 2020 2020 656c 6966 2027 5f73 7061  ..    elif '_spa
-00005550: 6365 5f67 726f 7570 5f6e 616d 655f 482d  ce_group_name_H-
-00005560: 4d5f 616c 7427 2069 6e20 6b65 7973 3a0d  M_alt' in keys:.
-00005570: 0a20 2020 2020 2020 2073 7061 6365 6772  .        spacegr
-00005580: 6f75 7020 3d20 6369 6676 616c 735b 275f  oup = cifvals['_
-00005590: 7370 6163 655f 6772 6f75 705f 6e61 6d65  space_group_name
-000055a0: 5f48 2d4d 5f61 6c74 275d 0d0a 2020 2020  _H-M_alt']..    
-000055b0: 656c 6966 206c 656e 2873 796d 6f70 7329  elif len(symops)
-000055c0: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
-000055d0: 7370 6163 6567 726f 7570 203d 2027 5031  spacegroup = 'P1
-000055e0: 270d 0a20 2020 2065 6c73 653a 0d0a 2020  '..    else:..  
-000055f0: 2020 2020 2020 7370 6163 6567 726f 7570        spacegroup
-00005600: 203d 2027 270d 0a20 2020 2069 6620 275f   = ''..    if '_
-00005610: 7379 6d6d 6574 7279 5f49 6e74 5f54 6162  symmetry_Int_Tab
-00005620: 6c65 735f 6e75 6d62 6572 2720 696e 206b  les_number' in k
-00005630: 6579 733a 0d0a 2020 2020 2020 2020 7367  eys:..        sg
-00005640: 6e20 3d20 666c 6f61 7428 6369 6676 616c  n = float(cifval
-00005650: 735b 275f 7379 6d6d 6574 7279 5f49 6e74  s['_symmetry_Int
-00005660: 5f54 6162 6c65 735f 6e75 6d62 6572 275d  _Tables_number']
-00005670: 290d 0a20 2020 2065 6c69 6620 275f 7370  )..    elif '_sp
-00005680: 6163 655f 6772 6f75 705f 4954 5f6e 756d  ace_group_IT_num
-00005690: 6265 7227 2069 6e20 6b65 7973 3a0d 0a20  ber' in keys:.. 
-000056a0: 2020 2020 2020 2073 676e 203d 2066 6c6f         sgn = flo
-000056b0: 6174 2863 6966 7661 6c73 5b27 5f73 7061  at(cifvals['_spa
-000056c0: 6365 5f67 726f 7570 5f49 545f 6e75 6d62  ce_group_IT_numb
-000056d0: 6572 275d 290d 0a20 2020 2065 6c69 6620  er'])..    elif 
-000056e0: 7370 6163 6567 726f 7570 203d 3d20 2750  spacegroup == 'P
-000056f0: 3127 3a0d 0a20 2020 2020 2020 2073 676e  1':..        sgn
-00005700: 203d 2031 0d0a 2020 2020 656c 7365 3a0d   = 1..    else:.
-00005710: 0a20 2020 2020 2020 2073 676e 203d 2030  .        sgn = 0
-00005720: 0d0a 0d0a 2020 2020 2320 7072 696e 7420  ....    # print 
-00005730: 6d61 675f 706f 730d 0a20 2020 2023 2070  mag_pos..    # p
-00005740: 7269 6e74 2070 316d 6167 0d0a 2020 2020  rint p1mag..    
-00005750: 2320 7072 696e 7420 7031 7665 630d 0a20  # print p1vec.. 
-00005760: 2020 2023 2070 7269 6e74 2066 672e 6d61     # print fg.ma
-00005770: 6728 7031 7665 6329 0d0a 2020 2020 2320  g(p1vec)..    # 
-00005780: 4164 6420 7661 6c75 6573 2074 6f20 7468  Add values to th
-00005790: 6520 6469 6374 0d0a 2020 2020 6372 7973  e dict..    crys
-000057a0: 203d 207b 7d0d 0a20 2020 2063 7279 735b   = {}..    crys[
-000057b0: 2766 696c 656e 616d 6527 5d20 3d20 6369  'filename'] = ci
-000057c0: 6676 616c 735b 2746 696c 656e 616d 6527  fvals['Filename'
-000057d0: 5d0d 0a20 2020 2063 7279 735b 276e 616d  ]..    crys['nam
-000057e0: 6527 5d20 3d20 6369 6676 616c 735b 2746  e'] = cifvals['F
-000057f0: 696c 6554 6974 6c65 275d 0d0a 2020 2020  ileTitle']..    
-00005800: 6372 7973 5b27 756e 6974 2076 6563 746f  crys['unit vecto
-00005810: 7227 5d20 3d20 5556 0d0a 2020 2020 6372  r'] = UV..    cr
-00005820: 7973 5b27 7061 7265 6e74 2063 656c 6c27  ys['parent cell'
-00005830: 5d20 3d20 5556 0d0a 2020 2020 6372 7973  ] = UV..    crys
-00005840: 5b27 6f72 6967 696e 275d 203d 206e 702e  ['origin'] = np.
-00005850: 6172 7261 7928 5b5b 302e 2c20 302e 2c20  array([[0., 0., 
-00005860: 302e 5d5d 290d 0a20 2020 2063 7279 735b  0.]])..    crys[
-00005870: 2773 796d 6d65 7472 7927 5d20 3d20 7379  'symmetry'] = sy
-00005880: 6d6f 7073 0d0a 2020 2020 6372 7973 5b27  mops..    crys['
-00005890: 6174 6f6d 2074 7970 6527 5d20 3d20 7031  atom type'] = p1
-000058a0: 7479 700d 0a20 2020 2063 7279 735b 2761  typ..    crys['a
-000058b0: 746f 6d20 6c61 6265 6c27 5d20 3d20 7031  tom label'] = p1
-000058c0: 6c62 6c0d 0a20 2020 2063 7279 735b 2761  lbl..    crys['a
-000058d0: 746f 6d20 706f 7369 7469 6f6e 275d 203d  tom position'] =
-000058e0: 2070 3170 6f73 0d0a 2020 2020 6372 7973   p1pos..    crys
-000058f0: 5b27 6174 6f6d 206f 6363 7570 616e 6379  ['atom occupancy
-00005900: 275d 203d 2070 316f 6363 0d0a 2020 2020  '] = p1occ..    
-00005910: 6372 7973 5b27 6174 6f6d 2075 6973 6f27  crys['atom uiso'
-00005920: 5d20 3d20 7031 5569 736f 0d0a 2020 2020  ] = p1Uiso..    
-00005930: 6372 7973 5b27 6174 6f6d 2075 616e 6973  crys['atom uanis
-00005940: 6f27 5d20 3d20 6e70 2e7a 6572 6f73 285b  o'] = np.zeros([
-00005950: 6c65 6e28 7031 706f 7329 2c20 365d 290d  len(p1pos), 6]).
-00005960: 0a20 2020 2063 7279 735b 276d 6167 206d  .    crys['mag m
-00005970: 6f6d 656e 7427 5d20 3d20 7031 7665 630d  oment'] = p1vec.
-00005980: 0a20 2020 2063 7279 735b 276d 6167 2074  .    crys['mag t
-00005990: 696d 6527 5d20 3d20 7031 7469 6d0d 0a20  ime'] = p1tim.. 
-000059a0: 2020 2063 7279 735b 276e 6f72 6d61 6c69     crys['normali
-000059b0: 7365 275d 203d 2031 2e0d 0a20 2020 2063  se'] = 1...    c
-000059c0: 7279 735b 276d 6973 6327 5d20 3d20 5b65  rys['misc'] = [e
-000059d0: 6c65 6d65 6e74 2c20 6c61 6265 6c2c 2063  lement, label, c
-000059e0: 6966 5f70 6f73 2c20 6f63 632c 2055 6973  if_pos, occ, Uis
-000059f0: 6f5d 0d0a 2020 2020 6372 7973 5b27 7370  o]..    crys['sp
-00005a00: 6163 6520 6772 6f75 7027 5d20 3d20 7370  ace group'] = sp
-00005a10: 6163 6567 726f 7570 0d0a 2020 2020 6372  acegroup..    cr
-00005a20: 7973 5b27 7370 6163 6520 6772 6f75 7020  ys['space group 
-00005a30: 6e75 6d62 6572 275d 203d 2073 676e 0d0a  number'] = sgn..
-00005a40: 2020 2020 6372 7973 5b27 6369 6627 5d20      crys['cif'] 
-00005a50: 3d20 6369 6676 616c 730d 0a20 2020 2072  = cifvals..    r
-00005a60: 6574 7572 6e20 6372 7973 0d0a 0d0a 0d0a  eturn crys......
-00005a70: 6465 6620 7772 6974 655f 6369 6628 6369  def write_cif(ci
-00005a80: 6676 616c 732c 2066 696c 656e 616d 653d  fvals, filename=
-00005a90: 4e6f 6e65 2c20 636f 6d6d 656e 7473 3d4e  None, comments=N
-00005aa0: 6f6e 6529 3a0d 0a20 2020 2022 2222 0d0a  one):..    """..
-00005ab0: 2020 2020 5772 6974 6520 2e63 6966 2066      Write .cif f
-00005ac0: 696c 6520 7769 7468 2076 616c 7565 7320  ile with values 
-00005ad0: 6672 6f6d 2061 2063 6966 2064 6963 742c  from a cif dict,
-00005ae0: 0d0a 2020 2020 4f6e 6c79 2062 6173 6963  ..    Only basic
-00005af0: 2069 7465 6d73 2061 7265 2073 6176 6564   items are saved
-00005b00: 2c20 7261 7468 6572 2074 6861 6e20 7265  , rather than re
-00005b10: 7475 726e 696e 6720 7468 6520 6f72 6769  turning the orgi
-00005b20: 6e61 6c20 6669 6c65 0d0a 2020 2020 3a70  nal file..    :p
-00005b30: 6172 616d 2063 6966 7661 6c73 3a20 6469  aram cifvals: di
-00005b40: 6374 2066 726f 6d20 7265 6164 6369 660d  ct from readcif.
-00005b50: 0a20 2020 203a 7061 7261 6d20 6669 6c65  .    :param file
-00005b60: 6e61 6d65 3a20 6669 6c65 6e61 6d65 2074  name: filename t
-00005b70: 6f20 7772 6974 6520 2875 7365 204e 6f6e  o write (use Non
-00005b80: 6520 746f 2072 6574 7572 6e20 7374 7269  e to return stri
-00005b90: 6e67 290d 0a20 2020 203a 7061 7261 6d20  ng)..    :param 
-00005ba0: 636f 6d6d 656e 7473 3a20 7374 7220 636f  comments: str co
-00005bb0: 6d6d 656e 7473 2074 6f20 7772 6974 6520  mments to write 
-00005bc0: 746f 2074 6865 2066 696c 6520 746f 7020  to the file top 
-00005bd0: 6d61 7474 6572 0d0a 2020 2020 3a72 6574  matter..    :ret
-00005be0: 7572 6e3a 204e 6f6e 650d 0a20 2020 2022  urn: None..    "
-00005bf0: 2222 0d0a 0d0a 2020 2020 6b65 7973 203d  ""....    keys =
-00005c00: 2063 6966 7661 6c73 2e6b 6579 7328 290d   cifvals.keys().
-00005c10: 0a0d 0a20 2020 2064 6566 2063 6966 5f76  ...    def cif_v
-00005c20: 616c 7565 286e 616d 6529 3a0d 0a20 2020  alue(name):..   
-00005c30: 2020 2020 2069 6620 6e61 6d65 2069 6e20       if name in 
-00005c40: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
-00005c50: 2020 2072 6574 7572 6e20 2725 2d34 3073     return '%-40s
-00005c60: 2025 2d31 3273 5c6e 2720 2520 286e 616d   %-12s\n' % (nam
-00005c70: 652c 2063 6966 7661 6c73 5b6e 616d 655d  e, cifvals[name]
-00005c80: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-00005c90: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00005ca0: 696e 7428 2725 7320 6e6f 7420 696e 2063  int('%s not in c
-00005cb0: 6966 2064 6963 7427 2025 206e 616d 6529  if dict' % name)
-00005cc0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00005cd0: 7475 726e 2027 252d 3430 7320 252d 3132  turn '%-40s %-12
-00005ce0: 735c 6e27 2025 2028 6e61 6d65 2c20 273f  s\n' % (name, '?
-00005cf0: 2729 0d0a 0d0a 2020 2020 6465 6620 6369  ')....    def ci
-00005d00: 665f 6c6f 6f70 286e 616d 6573 293a 0d0a  f_loop(names):..
-00005d10: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
-00005d20: 5b6e 616d 6520 666f 7220 6e61 6d65 2069  [name for name i
-00005d30: 6e20 6e61 6d65 7320 6966 206e 616d 6520  n names if name 
-00005d40: 696e 206b 6579 735d 0d0a 2020 2020 2020  in keys]..      
-00005d50: 2020 6966 206c 656e 286e 616d 6573 2920    if len(names) 
-00005d60: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-00005d70: 2020 2070 7269 6e74 2827 4c6f 6f70 2049     print('Loop I
-00005d80: 7465 6d73 206e 6f74 2069 6e20 6369 6620  tems not in cif 
-00005d90: 6469 6374 2729 0d0a 2020 2020 2020 2020  dict')..        
-00005da0: 2020 2020 7265 7475 726e 2027 270d 0a20      return ''.. 
-00005db0: 2020 2020 2020 206f 7574 203d 2027 6c6f         out = 'lo
-00005dc0: 6f70 5f5c 6e27 0d0a 2020 2020 2020 2020  op_\n'..        
-00005dd0: 6f75 7420 2b3d 2027 272e 6a6f 696e 285b  out += ''.join([
-00005de0: 2725 735c 6e27 2025 206e 616d 6520 666f  '%s\n' % name fo
-00005df0: 7220 6e61 6d65 2069 6e20 6e61 6d65 735d  r name in names]
-00005e00: 290d 0a20 2020 2020 2020 2076 616c 7320  )..        vals 
-00005e10: 3d20 5b63 6966 7661 6c73 5b6e 616d 655d  = [cifvals[name]
-00005e20: 2066 6f72 206e 616d 6520 696e 206e 616d   for name in nam
-00005e30: 6573 5d0d 0a20 2020 2020 2020 2066 6f72  es]..        for
-00005e40: 2076 616c 5f6c 696e 6520 696e 207a 6970   val_line in zip
-00005e50: 282a 7661 6c73 293a 0d0a 2020 2020 2020  (*vals):..      
-00005e60: 2020 2020 2020 6f75 7420 2b3d 2027 2027        out += ' '
-00005e70: 2e6a 6f69 6e28 5b27 252d 3132 7327 2025  .join(['%-12s' %
-00005e80: 2076 616c 2066 6f72 2076 616c 2069 6e20   val for val in 
-00005e90: 7661 6c5f 6c69 6e65 5d29 0d0a 2020 2020  val_line])..    
-00005ea0: 2020 2020 2020 2020 6f75 7420 2b3d 2027          out += '
-00005eb0: 5c6e 270d 0a20 2020 2020 2020 2072 6574  \n'..        ret
-00005ec0: 7572 6e20 6f75 740d 0a0d 0a20 2020 2023  urn out....    #
-00005ed0: 2054 6f70 204d 6174 7465 720d 0a20 2020   Top Matter..   
-00005ee0: 2063 203d 2027 232d 2d2d 2d2d 2d2d 2d2d   c = '#---------
+000008a0: 730d 0a30 372f 3035 2f32 3320 332e 382e  s..07/05/23 3.8.
+000008b0: 3020 2041 6464 6564 2065 6c65 6374 726f  0  Added electro
+000008c0: 6e5f 7363 6174 7465 7269 6e67 5f66 6163  n_scattering_fac
+000008d0: 746f 7273 2061 6e64 2065 6c65 6374 726f  tors and electro
+000008e0: 6e20 7761 7665 6c65 6e67 7468 2066 6f72  n wavelength for
+000008f0: 6d75 6c61 0d0a 3232 2f30 352f 3233 2033  mula..22/05/23 3
+00000900: 2e38 2e31 2020 4164 6465 6420 7779 636b  .8.1  Added wyck
+00000910: 6f66 665f 6c61 6265 6c2c 2066 696e 645f  off_label, find_
+00000920: 7370 6163 6567 726f 7570 0d0a 3032 2f30  spacegroup..02/0
+00000930: 372f 3233 2033 2e38 2e32 2020 4164 6465  7/23 3.8.2  Adde
+00000940: 6420 7761 7665 6c65 6e67 7468 206f 7074  d wavelength opt
+00000950: 696f 6e73 2074 6f20 7365 7665 7261 6c20  ions to several 
+00000960: 6675 6e63 7469 6f6e 732c 2070 6c75 7420  functions, plut 
+00000970: 4465 4272 6f67 6c69 6520 7761 7665 6c65  DeBroglie wavele
+00000980: 6e67 7468 2066 756e 6374 696f 6e0d 0a0d  ngth function...
+00000990: 0a41 636b 6e6f 6c65 6467 656d 656e 7473  .Acknoledgements
+000009a0: 3a0d 0a20 2020 2041 7072 696c 2032 3032  :..    April 202
+000009b0: 3020 2054 6861 6e6b 7320 746f 2043 6875  0  Thanks to Chu
+000009c0: 6e48 6169 2057 616e 6720 666f 7220 6865  nHai Wang for he
+000009d0: 6c70 6675 6c20 7375 6767 6573 7469 6f6e  lpful suggestion
+000009e0: 7320 696e 2072 6561 6463 6966 210d 0a20  s in readcif!.. 
+000009f0: 2020 204d 6179 2032 3032 3320 2020 2054     May 2023    T
+00000a00: 6861 6e6b 7320 746f 2043 6172 6d65 6c6f  hanks to Carmelo
+00000a10: 2050 7265 7374 6970 696e 6f20 666f 7220   Prestipino for 
+00000a20: 6164 6469 6e67 2065 6c65 6374 726f 6e20  adding electron 
+00000a30: 7363 6174 7465 7269 6e67 2066 6163 746f  scattering facto
+00000a40: 7273 0d0a 0d0a 4061 7574 686f 723a 2044  rs....@author: D
+00000a50: 4750 6f72 7465 720d 0a22 2222 0d0a 0d0a  GPorter.."""....
+00000a60: 696d 706f 7274 2073 7973 2c20 6f73 2c20  import sys, os, 
+00000a70: 7265 0d0a 696d 706f 7274 206a 736f 6e0d  re..import json.
+00000a80: 0a69 6d70 6f72 7420 6e75 6d70 7920 6173  .import numpy as
+00000a90: 206e 700d 0a66 726f 6d20 7761 726e 696e   np..from warnin
+00000aa0: 6773 2069 6d70 6f72 7420 7761 726e 0d0a  gs import warn..
+00000ab0: 0d0a 6672 6f6d 202e 2069 6d70 6f72 7420  ..from . import 
+00000ac0: 6675 6e63 7469 6f6e 735f 6765 6e65 7261  functions_genera
+00000ad0: 6c20 6173 2066 670d 0a0d 0a5f 5f76 6572  l as fg....__ver
+00000ae0: 7369 6f6e 5f5f 203d 2027 332e 382e 3127  sion__ = '3.8.1'
+00000af0: 0d0a 0d0a 2320 4669 6c65 2064 6972 6563  ....# File direc
+00000b00: 746f 7279 202d 206c 6f63 6174 696f 6e20  tory - location 
+00000b10: 6f66 2022 4461 6e73 2045 6c65 6d65 6e74  of "Dans Element
+00000b20: 2050 726f 7065 7274 6965 732e 7478 7422   Properties.txt"
+00000b30: 0d0a 6461 7461 6469 7220 3d20 6f73 2e70  ..datadir = os.p
+00000b40: 6174 682e 6162 7370 6174 6828 6f73 2e70  ath.abspath(os.p
+00000b50: 6174 682e 6469 726e 616d 6528 5f5f 6669  ath.dirname(__fi
+00000b60: 6c65 5f5f 2929 2020 2320 7361 6d65 2064  le__))  # same d
+00000b70: 6972 6563 746f 7279 2061 7320 7468 6973  irectory as this
+00000b80: 2066 696c 650d 0a64 6174 6164 6972 203d   file..datadir =
+00000b90: 206f 732e 7061 7468 2e6a 6f69 6e28 6461   os.path.join(da
+00000ba0: 7461 6469 722c 2027 6461 7461 2729 0d0a  tadir, 'data')..
+00000bb0: 4154 4f4d 4649 4c45 203d 206f 732e 7061  ATOMFILE = os.pa
+00000bc0: 7468 2e6a 6f69 6e28 6461 7461 6469 722c  th.join(datadir,
+00000bd0: 2027 4461 6e73 2045 6c65 6d65 6e74 2050   'Dans Element P
+00000be0: 726f 7065 7274 6965 732e 7478 7427 290d  roperties.txt').
+00000bf0: 0a50 454e 4746 494c 4520 3d20 6f73 2e70  .PENGFILE = os.p
+00000c00: 6174 682e 6a6f 696e 2864 6174 6164 6972  ath.join(datadir
+00000c10: 2c20 2770 656e 672e 6461 7427 290d 0a0d  , 'peng.dat')...
+00000c20: 0a0d 0a23 204c 6973 7420 6f66 2045 6c65  ...# List of Ele
+00000c30: 6d65 6e74 7320 696e 206f 7264 6572 2073  ments in order s
+00000c40: 6f72 7465 6420 6279 206c 656e 6774 6820  orted by length 
+00000c50: 6f66 206e 616d 650d 0a45 4c45 4d45 4e54  of name..ELEMENT
+00000c60: 5f4c 4953 5420 3d20 5b0d 0a20 2020 2027  _LIST = [..    '
+00000c70: 5a72 272c 2027 4d6f 272c 2027 4573 272c  Zr', 'Mo', 'Es',
+00000c80: 2027 4575 272c 2027 4665 272c 2027 466c   'Eu', 'Fe', 'Fl
+00000c90: 272c 2027 466d 272c 2027 4672 272c 2027  ', 'Fm', 'Fr', '
+00000ca0: 4761 272c 2027 4764 272c 2027 4765 272c  Ga', 'Gd', 'Ge',
+00000cb0: 0d0a 2020 2020 2748 6527 2c20 2748 6627  ..    'He', 'Hf'
+00000cc0: 2c20 2748 6727 2c20 2748 6f27 2c20 2748  , 'Hg', 'Ho', 'H
+00000cd0: 7327 2c20 2749 6e27 2c20 2749 7227 2c20  s', 'In', 'Ir', 
+00000ce0: 274b 7227 2c20 274c 6127 2c20 274c 6927  'Kr', 'La', 'Li'
+00000cf0: 2c20 274c 7227 2c0d 0a20 2020 2027 4c75  , 'Lr',..    'Lu
+00000d00: 272c 2027 4c76 272c 2027 4d63 272c 2027  ', 'Lv', 'Mc', '
+00000d10: 5a6e 272c 2027 4d67 272c 2027 4572 272c  Zn', 'Mg', 'Er',
+00000d20: 2027 4479 272c 2027 4473 272c 2027 426b   'Dy', 'Ds', 'Bk
+00000d30: 272c 2027 4167 272c 2027 416c 272c 0d0a  ', 'Ag', 'Al',..
+00000d40: 2020 2020 2741 6d27 2c20 2741 7227 2c20      'Am', 'Ar', 
+00000d50: 2741 7327 2c20 2741 7427 2c20 2741 7527  'As', 'At', 'Au'
+00000d60: 2c20 2742 6127 2c20 2742 6527 2c20 2742  , 'Ba', 'Be', 'B
+00000d70: 6827 2c20 2742 6927 2c20 2742 7227 2c20  h', 'Bi', 'Br', 
+00000d80: 2744 6227 2c0d 0a20 2020 2027 4361 272c  'Db',..    'Ca',
+00000d90: 2027 4364 272c 2027 4365 272c 2027 4366   'Cd', 'Ce', 'Cf
+00000da0: 272c 2027 436c 272c 2027 436d 272c 2027  ', 'Cl', 'Cm', '
+00000db0: 436e 272c 2027 436f 272c 2027 4372 272c  Cn', 'Co', 'Cr',
+00000dc0: 2027 4373 272c 2027 4375 272c 0d0a 2020   'Cs', 'Cu',..  
+00000dd0: 2020 274d 6e27 2c20 274d 6427 2c20 274d    'Mn', 'Md', 'M
+00000de0: 7427 2c20 2752 6227 2c20 2752 6627 2c20  t', 'Rb', 'Rf', 
+00000df0: 2752 6827 2c20 2752 6e27 2c20 2752 7527  'Rh', 'Rn', 'Ru'
+00000e00: 2c20 2753 6227 2c20 2753 6327 2c20 2753  , 'Sb', 'Sc', 'S
+00000e10: 6527 2c0d 0a20 2020 2027 5367 272c 2027  e',..    'Sg', '
+00000e20: 5369 272c 2027 536d 272c 2027 536e 272c  Si', 'Sm', 'Sn',
+00000e30: 2027 5372 272c 2027 5461 272c 2027 5462   'Sr', 'Ta', 'Tb
+00000e40: 272c 2027 5463 272c 2027 5465 272c 2027  ', 'Tc', 'Te', '
+00000e50: 5468 272c 2027 5469 272c 0d0a 2020 2020  Th', 'Ti',..    
+00000e60: 2754 6c27 2c20 2754 6d27 2c20 2754 7327  'Tl', 'Tm', 'Ts'
+00000e70: 2c20 2758 6527 2c20 2759 6227 2c20 2752  , 'Xe', 'Yb', 'R
+00000e80: 6527 2c20 2752 6727 2c20 2741 6327 2c20  e', 'Rg', 'Ac', 
+00000e90: 2750 6227 2c20 274e 6827 2c20 274e 6927  'Pb', 'Nh', 'Ni'
+00000ea0: 2c0d 0a20 2020 2027 4e6f 272c 2027 4e70  ,..    'No', 'Np
+00000eb0: 272c 2027 4e64 272c 2027 5261 272c 2027  ', 'Nd', 'Ra', '
+00000ec0: 4f67 272c 2027 4f73 272c 2027 5061 272c  Og', 'Os', 'Pa',
+00000ed0: 2027 5064 272c 2027 4e62 272c 2027 506d   'Pd', 'Nb', 'Pm
+00000ee0: 272c 2027 506f 272c 0d0a 2020 2020 2750  ', 'Po',..    'P
+00000ef0: 7227 2c20 2750 7427 2c20 274e 6127 2c20  r', 'Pt', 'Na', 
+00000f00: 2750 7527 2c20 274e 6527 2c20 2742 272c  'Pu', 'Ne', 'B',
+00000f10: 2027 5727 2c20 2756 272c 2027 5927 2c20   'W', 'V', 'Y', 
+00000f20: 2755 272c 2027 4627 2c20 274b 272c 0d0a  'U', 'F', 'K',..
+00000f30: 2020 2020 2743 272c 2027 4927 2c20 2750      'C', 'I', 'P
+00000f40: 272c 2027 4827 2c20 2753 272c 2027 4e27  ', 'H', 'S', 'N'
+00000f50: 2c20 274f 272c 0d0a 2020 2020 277a 7227  , 'O',..    'zr'
+00000f60: 2c20 276d 6f27 2c20 2765 7327 2c20 2765  , 'mo', 'es', 'e
+00000f70: 7527 2c20 2766 6527 2c20 2766 6c27 2c20  u', 'fe', 'fl', 
+00000f80: 2766 6d27 2c20 2766 7227 2c20 2767 6127  'fm', 'fr', 'ga'
+00000f90: 2c20 2767 6427 2c20 2767 6527 2c0d 0a20  , 'gd', 'ge',.. 
+00000fa0: 2020 2027 6865 272c 2027 6866 272c 2027     'he', 'hf', '
+00000fb0: 6867 272c 2027 686f 272c 2027 6873 272c  hg', 'ho', 'hs',
+00000fc0: 2027 696e 272c 2027 6972 272c 2027 6b72   'in', 'ir', 'kr
+00000fd0: 272c 2027 6c61 272c 2027 6c69 272c 2027  ', 'la', 'li', '
+00000fe0: 6c72 272c 0d0a 2020 2020 276c 7527 2c20  lr',..    'lu', 
+00000ff0: 276c 7627 2c20 276d 6327 2c20 277a 6e27  'lv', 'mc', 'zn'
+00001000: 2c20 276d 6727 2c20 2765 7227 2c20 2764  , 'mg', 'er', 'd
+00001010: 7927 2c20 2764 7327 2c20 2762 6b27 2c20  y', 'ds', 'bk', 
+00001020: 2761 6727 2c20 2761 6c27 2c0d 0a20 2020  'ag', 'al',..   
+00001030: 2027 616d 272c 2027 6172 272c 2027 6173   'am', 'ar', 'as
+00001040: 272c 2027 6174 272c 2027 6175 272c 2027  ', 'at', 'au', '
+00001050: 6261 272c 2027 6265 272c 2027 6268 272c  ba', 'be', 'bh',
+00001060: 2027 6269 272c 2027 6272 272c 2027 6462   'bi', 'br', 'db
+00001070: 272c 0d0a 2020 2020 2763 6127 2c20 2763  ',..    'ca', 'c
+00001080: 6427 2c20 2763 6527 2c20 2763 6627 2c20  d', 'ce', 'cf', 
+00001090: 2763 6c27 2c20 2763 6d27 2c20 2763 6e27  'cl', 'cm', 'cn'
+000010a0: 2c20 2763 6f27 2c20 2763 7227 2c20 2763  , 'co', 'cr', 'c
+000010b0: 7327 2c20 2763 7527 2c0d 0a20 2020 2027  s', 'cu',..    '
+000010c0: 6d6e 272c 2027 6d64 272c 2027 6d74 272c  mn', 'md', 'mt',
+000010d0: 2027 7262 272c 2027 7266 272c 2027 7268   'rb', 'rf', 'rh
+000010e0: 272c 2027 726e 272c 2027 7275 272c 2027  ', 'rn', 'ru', '
+000010f0: 7362 272c 2027 7363 272c 2027 7365 272c  sb', 'sc', 'se',
+00001100: 0d0a 2020 2020 2773 6727 2c20 2773 6927  ..    'sg', 'si'
+00001110: 2c20 2773 6d27 2c20 2773 6e27 2c20 2773  , 'sm', 'sn', 's
+00001120: 7227 2c20 2774 6127 2c20 2774 6227 2c20  r', 'ta', 'tb', 
+00001130: 2774 6327 2c20 2774 6527 2c20 2774 6827  'tc', 'te', 'th'
+00001140: 2c20 2774 6927 2c0d 0a20 2020 2027 746c  , 'ti',..    'tl
+00001150: 272c 2027 746d 272c 2027 7473 272c 2027  ', 'tm', 'ts', '
+00001160: 7865 272c 2027 7962 272c 2027 7265 272c  xe', 'yb', 're',
+00001170: 2027 7267 272c 2027 6163 272c 2027 7062   'rg', 'ac', 'pb
+00001180: 272c 2027 6e68 272c 2027 6e69 272c 0d0a  ', 'nh', 'ni',..
+00001190: 2020 2020 276e 6f27 2c20 276e 7027 2c20      'no', 'np', 
+000011a0: 276e 6427 2c20 2772 6127 2c20 276f 6727  'nd', 'ra', 'og'
+000011b0: 2c20 276f 7327 2c20 2770 6127 2c20 2770  , 'os', 'pa', 'p
+000011c0: 6427 2c20 276e 6227 2c20 2770 6d27 2c20  d', 'nb', 'pm', 
+000011d0: 2770 6f27 2c0d 0a20 2020 2027 7072 272c  'po',..    'pr',
+000011e0: 2027 7074 272c 2027 6e61 272c 2027 7075   'pt', 'na', 'pu
+000011f0: 272c 2027 6e65 272c 2027 6227 2c20 2777  ', 'ne', 'b', 'w
+00001200: 272c 2027 7627 2c20 2779 272c 2027 7527  ', 'v', 'y', 'u'
+00001210: 2c20 2766 272c 2027 6b27 2c0d 0a20 2020  , 'f', 'k',..   
+00001220: 2027 6327 2c20 2769 272c 2027 7027 2c20   'c', 'i', 'p', 
+00001230: 2768 272c 2027 7327 2c20 276e 272c 2027  'h', 's', 'n', '
+00001240: 6f27 2c0d 0a20 2020 2027 4427 2c20 2764  o',..    'D', 'd
+00001250: 272c 2020 2320 6164 6420 4465 7574 6572  ',  # add Deuter
+00001260: 6975 6d0d 0a5d 0d0a 656c 656d 656e 745f  ium..]..element_
+00001270: 7265 6765 7820 3d20 7265 2e63 6f6d 7069  regex = re.compi
+00001280: 6c65 2827 7c27 2e6a 6f69 6e28 454c 454d  le('|'.join(ELEM
+00001290: 454e 545f 4c49 5354 2929 0d0a 0d0a 0d0a  ENT_LIST))......
+000012a0: 2320 5265 7175 6972 6564 2043 4946 206b  # Required CIF k
+000012b0: 6579 732c 206d 7573 7420 6265 2061 7661  eys, must be ava
+000012c0: 696c 6162 6c65 2061 6e64 206e 6f74 2027  ilable and not '
+000012d0: 3f27 0d0a 4349 465f 5245 5155 4952 4553  ?'..CIF_REQUIRES
+000012e0: 203d 205b 0d0a 2020 2020 225f 6365 6c6c   = [..    "_cell
+000012f0: 5f6c 656e 6774 685f 6122 2c0d 0a20 2020  _length_a",..   
+00001300: 2022 5f63 656c 6c5f 6c65 6e67 7468 5f62   "_cell_length_b
+00001310: 222c 0d0a 2020 2020 225f 6365 6c6c 5f6c  ",..    "_cell_l
+00001320: 656e 6774 685f 6322 2c0d 0a20 2020 2022  ength_c",..    "
+00001330: 5f63 656c 6c5f 616e 676c 655f 616c 7068  _cell_angle_alph
+00001340: 6122 2c0d 0a20 2020 2022 5f63 656c 6c5f  a",..    "_cell_
+00001350: 616e 676c 655f 6265 7461 222c 0d0a 2020  angle_beta",..  
+00001360: 2020 225f 6365 6c6c 5f61 6e67 6c65 5f67    "_cell_angle_g
+00001370: 616d 6d61 222c 0d0a 2020 2020 225f 6174  amma",..    "_at
+00001380: 6f6d 5f73 6974 655f 6c61 6265 6c22 2c0d  om_site_label",.
+00001390: 0a20 2020 2022 5f61 746f 6d5f 7369 7465  .    "_atom_site
+000013a0: 5f66 7261 6374 5f78 222c 0d0a 2020 2020  _fract_x",..    
+000013b0: 225f 6174 6f6d 5f73 6974 655f 6672 6163  "_atom_site_frac
+000013c0: 745f 7922 2c0d 0a20 2020 2022 5f61 746f  t_y",..    "_ato
+000013d0: 6d5f 7369 7465 5f66 7261 6374 5f7a 222c  m_site_fract_z",
+000013e0: 0d0a 5d0d 0a0d 0a0d 0a64 6566 2067 6574  ..]......def get
+000013f0: 656e 6572 6779 2829 3a0d 0a20 2020 2072  energy():..    r
+00001400: 6574 7572 6e20 382e 3034 3820 2023 2043  eturn 8.048  # C
+00001410: 7520 4b61 6c70 6861 2065 6e65 7267 792c  u Kalpha energy,
+00001420: 206b 6556 0d0a 0d0a 0d0a 272d 2d2d 2d2d   keV......'-----
+00001430: 2d2d 2d2d 2d2d 2d2d 2d46 756e 6374 696f  ---------Functio
+00001440: 6e73 2074 6f20 5265 6164 2026 2057 7269  ns to Read & Wri
+00001450: 7465 2043 4946 2066 696c 6573 2d2d 2d2d  te CIF files----
+00001460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00001470: 2d2d 270d 0a0d 0a0d 0a64 6566 2072 6561  --'......def rea
+00001480: 6463 6966 2866 696c 656e 616d 653d 4e6f  dcif(filename=No
+00001490: 6e65 2c20 6465 6275 673d 4661 6c73 6529  ne, debug=False)
+000014a0: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+000014b0: 4f70 656e 2061 2043 7279 7374 616c 6c6f  Open a Crystallo
+000014c0: 6772 6170 6869 6320 496e 666f 726d 6174  graphic Informat
+000014d0: 696f 6e20 4669 6c65 2028 2a2e 6369 6629  ion File (*.cif)
+000014e0: 2066 696c 6520 616e 6420 7374 6f72 6520   file and store 
+000014f0: 616c 6c20 656e 7472 6965 7320 696e 2061  all entries in a
+00001500: 206b 6579 3a76 616c 7565 2064 6963 7469   key:value dicti
+00001510: 6f6e 6172 790d 0a20 2020 2020 4c6f 6f70  onary..     Loop
+00001520: 6564 2076 616c 7565 7320 6172 6520 7374  ed values are st
+00001530: 6f72 6564 2061 7320 6c69 7374 7320 756e  ored as lists un
+00001540: 6465 7220 6120 7369 6e67 6c65 206b 6579  der a single key
+00001550: 2065 6e74 7279 0d0a 2020 2020 2041 6c6c   entry..     All
+00001560: 2076 616c 7565 7320 6172 6520 7374 6f72   values are stor
+00001570: 6564 2061 7320 7374 7269 6e67 730d 0a20  ed as strings.. 
+00001580: 2020 2045 2e47 2e0d 0a20 2020 2020 2063     E.G...      c
+00001590: 7279 733d 7265 6164 6369 6628 2773 6f6d  rys=readcif('som
+000015a0: 6566 696c 652e 6369 6627 290d 0a20 2020  efile.cif')..   
+000015b0: 2020 2063 7279 735b 275f 6365 6c6c 5f6c     crys['_cell_l
+000015c0: 656e 6774 685f 6127 5d20 3d20 2732 2e38  ength_a'] = '2.8
+000015d0: 3335 2832 2927 0d0a 0d0a 2020 2020 6372  35(2)'....    cr
+000015e0: 7973 5b6b 6579 5d20 3d20 7661 6c75 650d  ys[key] = value.
+000015f0: 0a20 2020 2061 7661 696c 6162 6c65 206b  .    available k
+00001600: 6579 7320 6172 6520 6769 7665 2062 7920  eys are give by 
+00001610: 6372 7973 2e6b 6579 7328 290d 0a0d 0a20  crys.keys().... 
+00001620: 2020 2054 6f20 6465 6275 6720 7468 6520     To debug the 
+00001630: 6669 6c65 2077 6974 6820 6f75 7470 7574  file with output
+00001640: 7465 6420 6d65 7373 6167 6573 2c20 7573  ted messages, us
+00001650: 653a 0d0a 2020 2020 2020 6369 6620 3d20  e:..      cif = 
+00001660: 7265 6164 6369 6628 6669 6c65 2c20 6465  readcif(file, de
+00001670: 6275 673d 5472 7565 290d 0a0d 0a20 2020  bug=True)....   
+00001680: 2053 6f6d 6520 7573 6566 756c 2073 7461   Some useful sta
+00001690: 6e64 6172 6420 4349 4620 6b65 7977 6f72  ndard CIF keywor
+000016a0: 6473 3a0d 0a20 2020 2020 2020 205f 6365  ds:..        _ce
+000016b0: 6c6c 5f6c 656e 6774 685f 610d 0a20 2020  ll_length_a..   
+000016c0: 2020 2020 205f 6365 6c6c 5f6c 656e 6774       _cell_lengt
+000016d0: 685f 620d 0a20 2020 2020 2020 205f 6365  h_b..        _ce
+000016e0: 6c6c 5f6c 656e 6774 685f 630d 0a20 2020  ll_length_c..   
+000016f0: 2020 2020 205f 6365 6c6c 5f61 6e67 6c65       _cell_angle
+00001700: 5f61 6c70 6861 0d0a 2020 2020 2020 2020  _alpha..        
+00001710: 5f63 656c 6c5f 616e 676c 655f 6265 7461  _cell_angle_beta
+00001720: 0d0a 2020 2020 2020 2020 5f63 656c 6c5f  ..        _cell_
+00001730: 616e 676c 655f 6761 6d6d 610d 0a20 2020  angle_gamma..   
+00001740: 2020 2020 205f 7370 6163 655f 6772 6f75       _space_grou
+00001750: 705f 7379 6d6f 705f 6f70 6572 6174 696f  p_symop_operatio
+00001760: 6e5f 7879 7a0d 0a20 2020 2020 2020 205f  n_xyz..        _
+00001770: 6174 6f6d 5f73 6974 655f 6c61 6265 6c0d  atom_site_label.
+00001780: 0a20 2020 2020 2020 205f 6174 6f6d 5f73  .        _atom_s
+00001790: 6974 655f 7479 7065 5f73 796d 626f 6c0d  ite_type_symbol.
+000017a0: 0a20 2020 2020 2020 205f 6174 6f6d 5f73  .        _atom_s
+000017b0: 6974 655f 6f63 6375 7061 6e63 790d 0a20  ite_occupancy.. 
+000017c0: 2020 2020 2020 205f 6174 6f6d 5f73 6974         _atom_sit
+000017d0: 655f 555f 6973 6f5f 6f72 5f65 7175 6976  e_U_iso_or_equiv
+000017e0: 0d0a 2020 2020 2020 2020 5f61 746f 6d5f  ..        _atom_
+000017f0: 7369 7465 5f66 7261 6374 5f78 0d0a 2020  site_fract_x..  
+00001800: 2020 2020 2020 5f61 746f 6d5f 7369 7465        _atom_site
+00001810: 5f66 7261 6374 5f79 0d0a 2020 2020 2020  _fract_y..      
+00001820: 2020 5f61 746f 6d5f 7369 7465 5f66 7261    _atom_site_fra
+00001830: 6374 5f7a 0d0a 2020 2020 2222 220d 0a0d  ct_z..    """...
+00001840: 0a20 2020 2023 2047 6574 2066 696c 6520  .    # Get file 
+00001850: 6e61 6d65 0d0a 2020 2020 6669 6c65 6e61  name..    filena
+00001860: 6d65 203d 206f 732e 7061 7468 2e61 6273  me = os.path.abs
+00001870: 7061 7468 286f 732e 7061 7468 2e65 7870  path(os.path.exp
+00001880: 616e 6475 7365 7228 6669 6c65 6e61 6d65  anduser(filename
+00001890: 2929 0d0a 2020 2020 2864 6972 4e61 6d65  ))..    (dirName
+000018a0: 2c20 6669 6c65 7469 746c 6529 203d 206f  , filetitle) = o
+000018b0: 732e 7061 7468 2e73 706c 6974 2866 696c  s.path.split(fil
+000018c0: 656e 616d 6529 0d0a 2020 2020 2866 6e61  ename)..    (fna
+000018d0: 6d65 2c20 4578 7429 203d 206f 732e 7061  me, Ext) = os.pa
+000018e0: 7468 2e73 706c 6974 6578 7428 6669 6c65  th.splitext(file
+000018f0: 7469 746c 6529 0d0a 0d0a 2020 2020 2320  title)....    # 
+00001900: 4f70 656e 2066 696c 650d 0a20 2020 2066  Open file..    f
+00001910: 696c 6520 3d20 6f70 656e 2866 696c 656e  ile = open(filen
+00001920: 616d 6529 0d0a 2020 2020 7465 7874 203d  ame)..    text =
+00001930: 2066 696c 652e 7265 6164 2829 0d0a 2020   file.read()..  
+00001940: 2020 6669 6c65 2e63 6c6f 7365 2829 0d0a    file.close()..
+00001950: 0d0a 2020 2020 2320 5265 6d6f 7665 2062  ..    # Remove b
+00001960: 6c61 6e6b 206c 696e 6573 0d0a 2020 2020  lank lines..    
+00001970: 7768 696c 6520 225c 6e5c 6e22 2069 6e20  while "\n\n" in 
+00001980: 7465 7874 3a0d 0a20 2020 2020 2020 2074  text:..        t
+00001990: 6578 7420 3d20 7465 7874 2e72 6570 6c61  ext = text.repla
+000019a0: 6365 2822 5c6e 5c6e 222c 2022 5c6e 2229  ce("\n\n", "\n")
+000019b0: 0d0a 2020 2020 6c69 6e65 7320 3d20 7465  ..    lines = te
+000019c0: 7874 2e73 706c 6974 6c69 6e65 7328 290d  xt.splitlines().
+000019d0: 0a0d 0a20 2020 2063 6966 7661 6c73 203d  ...    cifvals =
+000019e0: 207b 2746 696c 656e 616d 6527 3a20 6669   {'Filename': fi
+000019f0: 6c65 6e61 6d65 2c20 2744 6972 6563 746f  lename, 'Directo
+00001a00: 7279 273a 2064 6972 4e61 6d65 2c20 2746  ry': dirName, 'F
+00001a10: 696c 6554 6974 6c65 273a 2066 6e61 6d65  ileTitle': fname
+00001a20: 7d0d 0a0d 0a20 2020 2023 2052 6561 6420  }....    # Read 
+00001a30: 6669 6c65 206c 696e 6520 6279 206c 696e  file line by lin
+00001a40: 652c 2063 6f6e 7665 7274 696e 6720 7468  e, converting th
+00001a50: 6520 6369 6620 6669 6c65 2076 616c 7565  e cif file value
+00001a60: 7320 746f 2061 2070 7974 686f 6e20 6469  s to a python di
+00001a70: 6374 0d0a 2020 2020 6e20 3d20 300d 0a20  ct..    n = 0.. 
+00001a80: 2020 2077 6869 6c65 206e 203c 206c 656e     while n < len
+00001a90: 286c 696e 6573 293a 0d0a 2020 2020 2020  (lines):..      
+00001aa0: 2020 2320 436f 6e76 6572 7420 6c69 6e65    # Convert line
+00001ab0: 2074 6f20 636f 6c75 6d6e 730d 0a20 2020   to columns..   
+00001ac0: 2020 2020 2076 616c 7320 3d20 6c69 6e65       vals = line
+00001ad0: 735b 6e5d 2e73 7472 6970 2829 2e73 706c  s[n].strip().spl
+00001ae0: 6974 2829 0d0a 0d0a 2020 2020 2020 2020  it()....        
+00001af0: 2320 736b 6970 2065 6d70 7479 206c 696e  # skip empty lin
+00001b00: 6573 0d0a 2020 2020 2020 2020 6966 206c  es..        if l
+00001b10: 656e 2876 616c 7329 203d 3d20 303a 0d0a  en(vals) == 0:..
+00001b20: 2020 2020 2020 2020 2020 2020 6e20 2b3d              n +=
+00001b30: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00001b40: 636f 6e74 696e 7565 0d0a 0d0a 2020 2020  continue....    
+00001b50: 2020 2020 2320 5365 6172 6368 2066 6f72      # Search for
+00001b60: 2073 746f 7265 6420 7661 6c75 6520 6c69   stored value li
+00001b70: 6e65 730d 0a20 2020 2020 2020 2069 6620  nes..        if 
+00001b80: 7661 6c73 5b30 5d5b 305d 203d 3d20 275f  vals[0][0] == '_
+00001b90: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00001ba0: 6966 206c 656e 2876 616c 7329 203d 3d20  if len(vals) == 
+00001bb0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00001bc0: 2020 2020 2320 5265 636f 7264 206e 6578      # Record nex
+00001bd0: 7420 6c69 6e65 7320 7468 6174 2061 7265  t lines that are
+00001be0: 206e 6f74 206b 6579 7320 6173 2073 7472   not keys as str
+00001bf0: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
+00001c00: 2020 2020 2069 6620 6c69 6e65 735b 6e20       if lines[n 
+00001c10: 2b20 315d 5b30 5d20 3d3d 2027 3b27 3a20  + 1][0] == ';': 
+00001c20: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+00001c30: 2020 2020 2020 2020 7374 7261 7267 203d          strarg =
+00001c40: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
+00001c50: 2020 2020 2077 6869 6c65 206e 202b 2031       while n + 1
+00001c60: 203c 206c 656e 286c 696e 6573 2920 616e   < len(lines) an
+00001c70: 6420 286c 656e 286c 696e 6573 5b6e 202b  d (len(lines[n +
+00001c80: 2031 5d29 203d 3d20 3020 6f72 206c 696e   1]) == 0 or lin
+00001c90: 6573 5b6e 202b 2031 5d5b 305d 2e73 7472  es[n + 1][0].str
+00001ca0: 6970 2829 206e 6f74 2069 6e20 5b27 5f27  ip() not in ['_'
+00001cb0: 2c20 273b 275d 293a 0d0a 2020 2020 2020  , ';']):..      
+00001cc0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00001cd0: 7261 7267 202b 3d20 5b6c 696e 6573 5b6e  rarg += [lines[n
+00001ce0: 202b 2031 5d2e 7374 7269 7028 275c 2722   + 1].strip('\'"
+00001cf0: 2729 5d0d 0a20 2020 2020 2020 2020 2020  ')]..           
+00001d00: 2020 2020 2020 2020 206e 202b 3d20 310d           n += 1.
+00001d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001d20: 2063 6966 7661 6c73 5b76 616c 735b 305d   cifvals[vals[0]
+00001d30: 5d20 3d20 275c 6e27 2e6a 6f69 6e28 7374  ] = '\n'.join(st
+00001d40: 7261 7267 290d 0a20 2020 2020 2020 2020  rarg)..         
+00001d50: 2020 2020 2020 2063 686b 203d 2027 6127         chk = 'a'
+00001d60: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00001d70: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00001d80: 2020 2020 2063 6966 7661 6c73 5b76 616c       cifvals[val
+00001d90: 735b 305d 5d20 3d20 2720 272e 6a6f 696e  s[0]] = ' '.join
+00001da0: 2876 616c 735b 313a 5d29 2e73 7472 6970  (vals[1:]).strip
+00001db0: 2827 205c 2722 5c6e 2729 0d0a 2020 2020  (' \'"\n')..    
+00001dc0: 2020 2020 2020 2020 2020 2020 6368 6b20              chk 
+00001dd0: 3d20 2762 270d 0a20 2020 2020 2020 2020  = 'b'..         
+00001de0: 2020 206e 202b 3d20 310d 0a20 2020 2020     n += 1..     
+00001df0: 2020 2020 2020 2069 6620 6465 6275 673a         if debug:
+00001e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001e10: 2020 7072 696e 7428 2725 3564 2025 7320    print('%5d %s 
+00001e20: 2573 203d 2025 7327 2025 2028 6e2c 2063  %s = %s' % (n, c
+00001e30: 686b 2c20 7661 6c73 5b30 5d2c 2063 6966  hk, vals[0], cif
+00001e40: 7661 6c73 5b76 616c 735b 305d 5d29 290d  vals[vals[0]])).
+00001e50: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00001e60: 7469 6e75 650d 0a0d 0a20 2020 2020 2020  tinue....       
+00001e70: 2023 2053 6561 7263 6820 666f 7220 6c6f   # Search for lo
+00001e80: 6f70 730d 0a20 2020 2020 2020 2065 6c69  ops..        eli
+00001e90: 6620 7661 6c73 5b30 5d20 3d3d 2027 6c6f  f vals[0] == 'lo
+00001ea0: 6f70 5f27 3a0d 0a20 2020 2020 2020 2020  op_':..         
+00001eb0: 2020 206e 202b 3d20 310d 0a20 2020 2020     n += 1..     
+00001ec0: 2020 2020 2020 206c 6f6f 7076 616c 7320         loopvals 
+00001ed0: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
+00001ee0: 2020 2320 5374 6570 2031 3a20 4173 7369    # Step 1: Assi
+00001ef0: 676e 206c 6f6f 7020 636f 6c75 6d6e 730d  gn loop columns.
+00001f00: 0a20 2020 2020 2020 2020 2020 2023 206c  .            # l
+00001f10: 6f6f 7065 6420 636f 6c75 6d6e 7320 6172  ooped columns ar
+00001f20: 6520 6769 7665 6e20 6279 2022 5f63 6f6c  e given by "_col
+00001f30: 756d 6e5f 6e61 6d65 220d 0a20 2020 2020  umn_name"..     
+00001f40: 2020 2020 2020 2077 6869 6c65 206e 203c         while n <
+00001f50: 206c 656e 286c 696e 6573 2920 616e 6420   len(lines) and 
+00001f60: 6c65 6e28 6c69 6e65 735b 6e5d 2e73 7472  len(lines[n].str
+00001f70: 6970 2829 2920 3e20 3020 616e 6420 6c69  ip()) > 0 and li
+00001f80: 6e65 735b 6e5d 2e73 7472 6970 2829 5b30  nes[n].strip()[0
+00001f90: 5d20 3d3d 2027 5f27 3a0d 0a20 2020 2020  ] == '_':..     
+00001fa0: 2020 2020 2020 2020 2020 206c 6f6f 7076             loopv
+00001fb0: 616c 7320 2b3d 205b 6c69 6e65 735b 6e5d  als += [lines[n]
+00001fc0: 2e73 706c 6974 2829 5b30 5d5d 0d0a 2020  .split()[0]]..  
+00001fd0: 2020 2020 2020 2020 2020 2020 2020 6369                ci
+00001fe0: 6676 616c 735b 6c6f 6f70 7661 6c73 5b2d  fvals[loopvals[-
+00001ff0: 315d 5d20 3d20 5b5d 0d0a 2020 2020 2020  1]] = []..      
+00002000: 2020 2020 2020 2020 2020 6e20 2b3d 2031            n += 1
+00002010: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00002020: 2320 5374 6570 2032 3a20 4173 7369 676e  # Step 2: Assign
+00002030: 2064 6174 6120 746f 2063 6f6c 756d 6e73   data to columns
+00002040: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00002050: 6c6f 6f70 7320 756e 7469 6c20 6c69 6e65  loops until line
+00002060: 2068 6173 206c 6573 7320 7365 676d 656e   has less segmen
+00002070: 7473 2074 6861 6e20 636f 6c75 6d6e 730d  ts than columns.
+00002080: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
+00002090: 6c65 206e 203c 206c 656e 286c 696e 6573  le n < len(lines
+000020a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000020b0: 2020 2020 2320 636f 6c73 203d 206c 696e      # cols = lin
+000020c0: 6573 5b6e 5d2e 7370 6c69 7428 290d 0a20  es[n].split().. 
+000020d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000020e0: 2074 6869 7320 6669 7865 7320 6572 726f   this fixes erro
+000020f0: 7220 6f6e 2073 796d 6d65 7472 7920 6172  r on symmetry ar
+00002100: 6775 6d65 6e74 7320 6861 7669 6e67 2073  guments having s
+00002110: 7061 6365 730d 0a20 2020 2020 2020 2020  paces..         
+00002120: 2020 2020 2020 2023 2074 6869 7320 7769         # this wi
+00002130: 6c6c 206f 6e6c 7920 776f 726b 2069 6620  ll only work if 
+00002140: 7468 6520 6c61 7374 2061 7267 756d 656e  the last argumen
+00002150: 7420 696e 2074 6865 206c 6f6f 7020 6973  t in the loop is
+00002160: 2073 706c 6974 2062 7920 7370 6163 6573   split by spaces
+00002170: 2028 696e 2071 756f 7465 7329 0d0a 2020   (in quotes)..  
+00002180: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00002190: 636f 6c73 203d 2063 6f6c 735b 3a6c 656e  cols = cols[:len
+000021a0: 286c 6f6f 7076 616c 7329 202d 2031 5d20  (loopvals) - 1] 
+000021b0: 2b20 5b27 272e 6a6f 696e 2863 6f6c 735b  + [''.join(cols[
+000021c0: 6c65 6e28 6c6f 6f70 7661 6c73 2920 2d20  len(loopvals) - 
+000021d0: 313a 5d29 5d0d 0a20 2020 2020 2020 2020  1:])]..         
+000021e0: 2020 2020 2020 2063 6f6c 7320 3d20 5b63         cols = [c
+000021f0: 6f6c 2066 6f72 2063 6f6c 2069 6e20 7265  ol for col in re
+00002200: 2e73 706c 6974 2822 2820 7c5c 5c5c 222e  .split("( |\\\".
+00002210: 2a3f 5c5c 5c22 7c27 2e2a 3f27 2922 2c20  *?\\\"|'.*?')", 
+00002220: 6c69 6e65 735b 6e5d 2920 6966 2063 6f6c  lines[n]) if col
+00002230: 2e73 7472 6970 2829 5d0d 0a20 2020 2020  .strip()]..     
+00002240: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00002250: 6e28 636f 6c73 2920 213d 206c 656e 286c  n(cols) != len(l
+00002260: 6f6f 7076 616c 7329 3a20 6272 6561 6b0d  oopvals): break.
+00002270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002280: 2069 6620 636f 6c73 5b30 5d5b 305d 203d   if cols[0][0] =
+00002290: 3d20 275f 2720 6f72 2063 6f6c 735b 305d  = '_' or cols[0]
+000022a0: 203d 3d20 276c 6f6f 705f 273a 2062 7265   == 'loop_': bre
+000022b0: 616b 2020 2320 6361 7463 6865 7320 6572  ak  # catches er
+000022c0: 726f 7220 6966 206c 6f6f 7020 6973 206f  ror if loop is o
+000022d0: 6e6c 7920 3120 6974 6572 6174 696f 6e0d  nly 1 iteration.
+000022e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000022f0: 2069 6620 636f 6c73 5b30 5d5b 305d 203d   if cols[0][0] =
+00002300: 3d20 2723 273a 206e 202b 3d20 313b 2063  = '#': n += 1; c
+00002310: 6f6e 7469 6e75 6520 2023 2063 6174 6368  ontinue  # catch
+00002320: 6573 2063 6f6d 656e 7465 6420 6f75 7420  es comented out 
+00002330: 6c69 6e65 730d 0a20 2020 2020 2020 2020  lines..         
+00002340: 2020 2020 2020 2069 6620 6c65 6e28 6c6f         if len(lo
+00002350: 6f70 7661 6c73 2920 3d3d 2031 3a0d 0a20  opvals) == 1:.. 
+00002360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002370: 2020 2063 6966 7661 6c73 5b6c 6f6f 7076     cifvals[loopv
+00002380: 616c 735b 305d 5d20 2b3d 205b 6c69 6e65  als[0]] += [line
+00002390: 735b 6e5d 2e73 7472 6970 2827 205c 225c  s[n].strip(' \"\
+000023a0: 275c 6e27 295d 0d0a 2020 2020 2020 2020  '\n')]..        
+000023b0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000023c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000023d0: 2020 2066 6f72 2063 2c20 6c6c 2069 6e20     for c, ll in 
+000023e0: 656e 756d 6572 6174 6528 6c6f 6f70 7661  enumerate(loopva
+000023f0: 6c73 293a 0d0a 2020 2020 2020 2020 2020  ls):..          
+00002400: 2020 2020 2020 2020 2020 2020 2020 6369                ci
+00002410: 6676 616c 735b 6c6c 5d20 2b3d 205b 636f  fvals[ll] += [co
+00002420: 6c73 5b63 5d5d 0d0a 2020 2020 2020 2020  ls[c]]..        
+00002430: 2020 2020 2020 2020 6e20 2b3d 2031 0d0a          n += 1..
+00002440: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00002450: 2064 6562 7567 3a0d 0a20 2020 2020 2020   debug:..       
+00002460: 2020 2020 2020 2020 2066 6f72 206c 6c20           for ll 
+00002470: 696e 206c 6f6f 7076 616c 733a 0d0a 2020  in loopvals:..  
+00002480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002490: 2020 7072 696e 7428 2725 3564 204c 2025    print('%5d L %
+000024a0: 7320 3d20 2573 2720 2520 286e 2c20 6c6c  s = %s' % (n, ll
+000024b0: 2c20 7374 7228 6369 6676 616c 735b 6c6c  , str(cifvals[ll
+000024c0: 5d29 2929 0d0a 2020 2020 2020 2020 2020  ])))..          
+000024d0: 2020 636f 6e74 696e 7565 0d0a 0d0a 2020    continue....  
+000024e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000024f0: 2020 2020 2020 2020 2023 2053 6b69 7020           # Skip 
+00002500: 616e 7974 6869 6e67 2065 6c73 650d 0a20  anything else.. 
+00002510: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+00002520: 6275 673a 0d0a 2020 2020 2020 2020 2020  bug:..          
+00002530: 2020 2020 2020 7072 696e 7428 2725 3564        print('%5d
+00002540: 2053 4b49 5050 4544 3a20 2573 2720 2520   SKIPPED: %s' % 
+00002550: 286e 2c20 6c69 6e65 735b 6e5d 2929 0d0a  (n, lines[n]))..
+00002560: 2020 2020 2020 2020 2020 2020 6e20 2b3d              n +=
+00002570: 2031 0d0a 0d0a 2020 2020 2320 5265 706c   1....    # Repl
+00002580: 6163 6520 272e 2720 696e 206b 6579 7320  ace '.' in keys 
+00002590: 2d20 6669 7820 6275 6720 6672 6f6d 2069  - fix bug from i
+000025a0: 736f 6469 7374 6f72 7420 6369 6620 6669  sodistort cif fi
+000025b0: 6c65 730d 0a20 2020 2023 2065 2e67 2e20  les..    # e.g. 
+000025c0: 275f 7370 6163 655f 6772 6f75 705f 7379  '_space_group_sy
+000025d0: 6d6f 705f 6d61 676e 5f6f 7065 7261 7469  mop_magn_operati
+000025e0: 6f6e 2e78 797a 270d 0a20 2020 2063 7572  on.xyz'..    cur
+000025f0: 7265 6e74 5f6b 6579 7320 3d20 6c69 7374  rent_keys = list
+00002600: 2863 6966 7661 6c73 2e6b 6579 7328 2929  (cifvals.keys())
+00002610: 0d0a 2020 2020 666f 7220 6b65 7920 696e  ..    for key in
+00002620: 2063 7572 7265 6e74 5f6b 6579 733a 0d0a   current_keys:..
+00002630: 2020 2020 2020 2020 6966 2027 2e27 2069          if '.' i
+00002640: 6e20 6b65 793a 0d0a 2020 2020 2020 2020  n key:..        
+00002650: 2020 2020 6e65 776b 6579 203d 206b 6579      newkey = key
+00002660: 2e72 6570 6c61 6365 2827 2e27 2c20 275f  .replace('.', '_
+00002670: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00002680: 6369 6676 616c 735b 6e65 776b 6579 5d20  cifvals[newkey] 
+00002690: 3d20 6369 6676 616c 735b 6b65 795d 0d0a  = cifvals[key]..
+000026a0: 2020 2020 7265 7475 726e 2063 6966 7661      return cifva
+000026b0: 6c73 0d0a 0d0a 0d0a 6465 6620 6369 665f  ls......def cif_
+000026c0: 6368 6563 6b28 6369 6676 616c 732c 2072  check(cifvals, r
+000026d0: 6571 7569 7265 645f 6b65 7973 3d4e 6f6e  equired_keys=Non
+000026e0: 652c 2062 6164 5f76 616c 7565 3d27 3f27  e, bad_value='?'
+000026f0: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+00002700: 2052 6574 7572 6e73 2054 7275 6520 6966   Returns True if
+00002710: 2061 6c6c 2062 6173 6963 2072 6571 7569   all basic requi
+00002720: 7265 6420 6369 6620 7061 7261 6d65 7465  red cif paramete
+00002730: 7220 6172 6520 6176 6169 6c61 626c 6520  r are available 
+00002740: 616e 6420 7265 616c 2e0d 0a20 2020 2045  and real...    E
+00002750: 2e47 2e3a 0d0a 2020 2020 2020 2020 6369  .G.:..        ci
+00002760: 6676 616c 7320 3d20 7265 6164 6369 6628  fvals = readcif(
+00002770: 6669 6c65 2e63 6966 290d 0a20 2020 2020  file.cif)..     
+00002780: 2020 2069 6620 6369 665f 6368 6563 6b28     if cif_check(
+00002790: 6369 6676 616c 7329 3a0d 0a20 2020 2020  cifvals):..     
+000027a0: 2020 2020 2020 2070 7269 6e74 2827 4669         print('Fi
+000027b0: 6c65 204f 4b27 290d 0a20 2020 203a 7061  le OK')..    :pa
+000027c0: 7261 6d20 6369 6676 616c 733a 2064 6963  ram cifvals: dic
+000027d0: 7420 6f66 2063 6966 206b 6579 7320 666f  t of cif keys fo
+000027e0: 726d 2072 6561 6463 6966 0d0a 2020 2020  rm readcif..    
+000027f0: 3a70 6172 616d 2072 6571 7569 7265 645f  :param required_
+00002800: 6b65 7973 3a20 6c69 7374 206f 6620 6b65  keys: list of ke
+00002810: 7920 7374 7269 6e67 732c 206f 7220 4e6f  y strings, or No
+00002820: 6e65 2066 6f72 2064 6566 6175 6c74 0d0a  ne for default..
+00002830: 2020 2020 3a70 6172 616d 2062 6164 5f76      :param bad_v
+00002840: 616c 7565 3a20 6966 2074 6869 7320 7661  alue: if this va
+00002850: 6c75 6520 6973 2069 6e20 7468 6520 6369  lue is in the ci
+00002860: 6620 6b65 7920 6974 656d 2c20 7265 7475  f key item, retu
+00002870: 726e 2046 616c 7365 0d0a 2020 2020 3a72  rn False..    :r
+00002880: 6574 7572 6e3a 2062 6f6f 6c0d 0a20 2020  eturn: bool..   
+00002890: 2022 2222 0d0a 2020 2020 6966 2072 6571   """..    if req
+000028a0: 7569 7265 645f 6b65 7973 2069 7320 4e6f  uired_keys is No
+000028b0: 6e65 3a0d 0a20 2020 2020 2020 2072 6571  ne:..        req
+000028c0: 7569 7265 645f 6b65 7973 203d 2043 4946  uired_keys = CIF
+000028d0: 5f52 4551 5549 5245 530d 0a20 2020 206b  _REQUIRES..    k
+000028e0: 6579 7320 3d20 6369 6676 616c 732e 6b65  eys = cifvals.ke
+000028f0: 7973 2829 0d0a 2020 2020 666f 7220 6b65  ys()..    for ke
+00002900: 7920 696e 2072 6571 7569 7265 645f 6b65  y in required_ke
+00002910: 7973 3a0d 0a20 2020 2020 2020 2069 6620  ys:..        if 
+00002920: 6b65 7920 6e6f 7420 696e 206b 6579 733a  key not in keys:
+00002930: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00002940: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
+00002950: 2020 2020 6966 2062 6164 5f76 616c 7565      if bad_value
+00002960: 2069 6e20 6369 6676 616c 735b 6b65 795d   in cifvals[key]
+00002970: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00002980: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+00002990: 2072 6574 7572 6e20 5472 7565 0d0a 0d0a   return True....
+000029a0: 0d0a 6465 6620 6369 665f 7379 6d6d 6574  ..def cif_symmet
+000029b0: 7279 2863 6966 7661 6c73 293a 0d0a 2020  ry(cifvals):..  
+000029c0: 2020 2222 220d 0a20 2020 2052 6561 6420    """..    Read 
+000029d0: 7379 6d6d 6574 7269 6573 2066 726f 6d20  symmetries from 
+000029e0: 6120 6369 6620 6469 6374 0d0a 2020 2020  a cif dict..    
+000029f0: 3a70 6172 616d 2063 6966 7661 6c73 3a0d  :param cifvals:.
+00002a00: 0a20 2020 203a 7265 7475 726e 3a20 6c69  .    :return: li
+00002a10: 7374 2873 796d 6d65 7472 795f 6f70 6572  st(symmetry_oper
+00002a20: 6174 696f 6e73 292c 206c 6973 7428 6d61  ations), list(ma
+00002a30: 676e 6574 6963 5f6f 7065 7261 7469 6f6e  gnetic_operation
+00002a40: 7329 2c20 6c69 7374 2874 696d 6520 6f70  s), list(time op
+00002a50: 6572 6174 696f 6e73 290d 0a20 2020 2022  erations)..    "
+00002a60: 2222 0d0a 2020 2020 6b65 7973 203d 2063  ""..    keys = c
+00002a70: 6966 7661 6c73 2e6b 6579 7328 290d 0a0d  ifvals.keys()...
+00002a80: 0a20 2020 2069 6620 275f 7379 6d6d 6574  .    if '_symmet
+00002a90: 7279 5f65 7175 6976 5f70 6f73 5f61 735f  ry_equiv_pos_as_
+00002aa0: 7879 7a27 2069 6e20 6b65 7973 3a0d 0a20  xyz' in keys:.. 
+00002ab0: 2020 2020 2020 2073 796d 6f70 7320 3d20         symops = 
+00002ac0: 6369 6676 616c 735b 275f 7379 6d6d 6574  cifvals['_symmet
+00002ad0: 7279 5f65 7175 6976 5f70 6f73 5f61 735f  ry_equiv_pos_as_
+00002ae0: 7879 7a27 5d0d 0a20 2020 2020 2020 2073  xyz']..        s
+00002af0: 796d 6d65 7472 795f 6f70 6572 6174 696f  ymmetry_operatio
+00002b00: 6e73 203d 2067 656e 5f73 796d 6365 6e5f  ns = gen_symcen_
+00002b10: 6f70 7328 7379 6d6f 7073 2c20 5b27 782c  ops(symops, ['x,
+00002b20: 792c 7a27 5d29 0d0a 2020 2020 2020 2020  y,z'])..        
+00002b30: 7379 6d6d 6574 7279 5f6f 7065 7261 7469  symmetry_operati
+00002b40: 6f6e 735f 6d61 676e 6574 6963 203d 2073  ons_magnetic = s
+00002b50: 796d 6d65 7472 795f 6f70 7332 6d61 676e  ymmetry_ops2magn
+00002b60: 6574 6963 2873 796d 6f70 7329 0d0a 2020  etic(symops)..  
+00002b70: 2020 2020 2020 7379 6d6d 6574 7279 5f6f        symmetry_o
+00002b80: 7065 7261 7469 6f6e 735f 7469 6d65 203d  perations_time =
+00002b90: 2073 796d 5f6f 705f 7469 6d65 2873 796d   sym_op_time(sym
+00002ba0: 6f70 7329 0d0a 2020 2020 656c 6966 2027  ops)..    elif '
+00002bb0: 5f73 7061 6365 5f67 726f 7570 5f73 796d  _space_group_sym
+00002bc0: 6f70 5f6f 7065 7261 7469 6f6e 5f78 797a  op_operation_xyz
+00002bd0: 2720 696e 206b 6579 733a 0d0a 2020 2020  ' in keys:..    
+00002be0: 2020 2020 7379 6d6f 7073 203d 2063 6966      symops = cif
+00002bf0: 7661 6c73 5b27 5f73 7061 6365 5f67 726f  vals['_space_gro
+00002c00: 7570 5f73 796d 6f70 5f6f 7065 7261 7469  up_symop_operati
+00002c10: 6f6e 5f78 797a 275d 0d0a 2020 2020 2020  on_xyz']..      
+00002c20: 2020 7379 6d6d 6574 7279 5f6f 7065 7261    symmetry_opera
+00002c30: 7469 6f6e 7320 3d20 6765 6e5f 7379 6d63  tions = gen_symc
+00002c40: 656e 5f6f 7073 2873 796d 6f70 732c 205b  en_ops(symops, [
+00002c50: 2778 2c79 2c7a 275d 290d 0a20 2020 2020  'x,y,z'])..     
+00002c60: 2020 2073 796d 6d65 7472 795f 6f70 6572     symmetry_oper
+00002c70: 6174 696f 6e73 5f6d 6167 6e65 7469 6320  ations_magnetic 
+00002c80: 3d20 7379 6d6d 6574 7279 5f6f 7073 326d  = symmetry_ops2m
+00002c90: 6167 6e65 7469 6328 7379 6d6f 7073 290d  agnetic(symops).
+00002ca0: 0a20 2020 2020 2020 2073 796d 6d65 7472  .        symmetr
+00002cb0: 795f 6f70 6572 6174 696f 6e73 5f74 696d  y_operations_tim
+00002cc0: 6520 3d20 7379 6d5f 6f70 5f74 696d 6528  e = sym_op_time(
+00002cd0: 7379 6d6f 7073 290d 0a20 2020 2065 6c69  symops)..    eli
+00002ce0: 6620 275f 7370 6163 655f 6772 6f75 705f  f '_space_group_
+00002cf0: 7379 6d6f 705f 6d61 676e 5f6f 7065 7261  symop_magn_opera
+00002d00: 7469 6f6e 5f78 797a 2720 696e 206b 6579  tion_xyz' in key
+00002d10: 733a 0d0a 2020 2020 2020 2020 7379 6d6f  s:..        symo
+00002d20: 7073 203d 2063 6966 7661 6c73 5b27 5f73  ps = cifvals['_s
+00002d30: 7061 6365 5f67 726f 7570 5f73 796d 6f70  pace_group_symop
+00002d40: 5f6d 6167 6e5f 6f70 6572 6174 696f 6e5f  _magn_operation_
+00002d50: 7879 7a27 5d0d 0a20 2020 2020 2020 2069  xyz']..        i
+00002d60: 6620 275f 7370 6163 655f 6772 6f75 705f  f '_space_group_
+00002d70: 7379 6d6f 705f 6d61 676e 5f63 656e 7465  symop_magn_cente
+00002d80: 7269 6e67 5f78 797a 2720 696e 206b 6579  ring_xyz' in key
+00002d90: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00002da0: 7379 6d63 656e 203d 2063 6966 7661 6c73  symcen = cifvals
+00002db0: 5b27 5f73 7061 6365 5f67 726f 7570 5f73  ['_space_group_s
+00002dc0: 796d 6f70 5f6d 6167 6e5f 6365 6e74 6572  ymop_magn_center
+00002dd0: 696e 675f 7879 7a27 5d0d 0a20 2020 2020  ing_xyz']..     
+00002de0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00002df0: 2020 2020 2020 7379 6d63 656e 203d 205b        symcen = [
+00002e00: 2778 2c79 2c7a 275d 0d0a 2020 2020 2020  'x,y,z']..      
+00002e10: 2020 7379 6d6d 6574 7279 5f6f 7065 7261    symmetry_opera
+00002e20: 7469 6f6e 7320 3d20 6765 6e5f 7379 6d63  tions = gen_symc
+00002e30: 656e 5f6f 7073 2873 796d 6f70 732c 2073  en_ops(symops, s
+00002e40: 796d 6365 6e29 0d0a 2020 2020 2020 2020  ymcen)..        
+00002e50: 7379 6d6d 6574 7279 5f6f 7065 7261 7469  symmetry_operati
+00002e60: 6f6e 735f 7469 6d65 203d 2073 796d 5f6f  ons_time = sym_o
+00002e70: 705f 7469 6d65 2873 796d 6d65 7472 795f  p_time(symmetry_
+00002e80: 6f70 6572 6174 696f 6e73 290d 0a0d 0a20  operations).... 
+00002e90: 2020 2020 2020 2069 6620 275f 7370 6163         if '_spac
+00002ea0: 655f 6772 6f75 705f 7379 6d6f 705f 6d61  e_group_symop_ma
+00002eb0: 676e 5f6f 7065 7261 7469 6f6e 5f6d 786d  gn_operation_mxm
+00002ec0: 796d 7a27 2069 6e20 6b65 7973 3a0d 0a20  ymz' in keys:.. 
+00002ed0: 2020 2020 2020 2020 2020 206d 6167 6f70             magop
+00002ee0: 7320 3d20 6369 6676 616c 735b 275f 7370  s = cifvals['_sp
+00002ef0: 6163 655f 6772 6f75 705f 7379 6d6f 705f  ace_group_symop_
+00002f00: 6d61 676e 5f6f 7065 7261 7469 6f6e 5f6d  magn_operation_m
+00002f10: 786d 796d 7a27 5d20 2023 206d 782c 6d79  xmymz']  # mx,my
+00002f20: 2c6d 7a0d 0a20 2020 2020 2020 2020 2020  ,mz..           
+00002f30: 206d 6167 6365 6e20 3d20 6369 6676 616c   magcen = cifval
+00002f40: 735b 275f 7370 6163 655f 6772 6f75 705f  s['_space_group_
+00002f50: 7379 6d6f 705f 6d61 676e 5f63 656e 7465  symop_magn_cente
+00002f60: 7269 6e67 5f6d 786d 796d 7a27 5d0d 0a20  ring_mxmymz'].. 
+00002f70: 2020 2020 2020 2020 2020 206d 6167 6f70             magop
+00002f80: 7320 3d20 5b6f 702e 7265 706c 6163 6528  s = [op.replace(
+00002f90: 276d 272c 2027 2729 2066 6f72 206f 7020  'm', '') for op 
+00002fa0: 696e 206d 6167 6f70 735d 0d0a 2020 2020  in magops]..    
+00002fb0: 2020 2020 2020 2020 6d61 6763 656e 203d          magcen =
+00002fc0: 205b 6f70 2e72 6570 6c61 6365 2827 6d27   [op.replace('m'
+00002fd0: 2c20 2727 2920 666f 7220 6f70 2069 6e20  , '') for op in 
+00002fe0: 6d61 6763 656e 5d0d 0a20 2020 2020 2020  magcen]..       
+00002ff0: 2020 2020 2073 796d 6d65 7472 795f 6f70       symmetry_op
+00003000: 6572 6174 696f 6e73 5f6d 6167 6e65 7469  erations_magneti
+00003010: 6320 3d20 6765 6e5f 7379 6d63 656e 5f6f  c = gen_symcen_o
+00003020: 7073 286d 6167 6f70 732c 206d 6167 6365  ps(magops, magce
+00003030: 6e29 0d0a 2020 2020 2020 2020 656c 7365  n)..        else
+00003040: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00003050: 796d 6d65 7472 795f 6f70 6572 6174 696f  ymmetry_operatio
+00003060: 6e73 5f6d 6167 6e65 7469 6320 3d20 7379  ns_magnetic = sy
+00003070: 6d6d 6574 7279 5f6f 7073 326d 6167 6e65  mmetry_ops2magne
+00003080: 7469 6328 7379 6d6d 6574 7279 5f6f 7065  tic(symmetry_ope
+00003090: 7261 7469 6f6e 7329 0d0a 2020 2020 656c  rations)..    el
+000030a0: 7365 3a0d 0a20 2020 2020 2020 2073 796d  se:..        sym
+000030b0: 6d65 7472 795f 6f70 6572 6174 696f 6e73  metry_operations
+000030c0: 203d 205b 2778 2c79 2c7a 275d 0d0a 2020   = ['x,y,z']..  
+000030d0: 2020 2020 2020 7379 6d6d 6574 7279 5f6f        symmetry_o
+000030e0: 7065 7261 7469 6f6e 735f 6d61 676e 6574  perations_magnet
+000030f0: 6963 203d 205b 2778 2c79 2c7a 275d 0d0a  ic = ['x,y,z']..
+00003100: 2020 2020 2020 2020 7379 6d6d 6574 7279          symmetry
+00003110: 5f6f 7065 7261 7469 6f6e 735f 7469 6d65  _operations_time
+00003120: 203d 205b 315d 0d0a 0d0a 2020 2020 7379   = [1]....    sy
+00003130: 6d6d 6574 7279 5f6f 7065 7261 7469 6f6e  mmetry_operation
+00003140: 735f 6d61 676e 6574 6963 203d 2073 796d  s_magnetic = sym
+00003150: 5f6f 705f 6d78 2873 796d 6d65 7472 795f  _op_mx(symmetry_
+00003160: 6f70 6572 6174 696f 6e73 5f6d 6167 6e65  operations_magne
+00003170: 7469 6329 0d0a 2020 2020 7265 7475 726e  tic)..    return
+00003180: 2073 796d 6d65 7472 795f 6f70 6572 6174   symmetry_operat
+00003190: 696f 6e73 2c20 7379 6d6d 6574 7279 5f6f  ions, symmetry_o
+000031a0: 7065 7261 7469 6f6e 735f 6d61 676e 6574  perations_magnet
+000031b0: 6963 2c20 7379 6d6d 6574 7279 5f6f 7065  ic, symmetry_ope
+000031c0: 7261 7469 6f6e 735f 7469 6d65 0d0a 0d0a  rations_time....
+000031d0: 0d0a 6465 6620 6369 6632 6469 6374 2863  ..def cif2dict(c
+000031e0: 6966 7661 6c73 293a 0d0a 2020 2020 2222  ifvals):..    ""
+000031f0: 220d 0a20 2020 2046 726f 6d20 6120 6469  "..    From a di
+00003200: 6374 206f 6620 6b65 793a 7661 6c75 6520  ct of key:value 
+00003210: 7061 6972 7320 6765 6e65 7261 7465 6420  pairs generated 
+00003220: 6672 6f6d 2061 202a 2e63 6966 2066 696c  from a *.cif fil
+00003230: 6520 2875 7369 6e67 2072 6561 6463 6966  e (using readcif
+00003240: 292c 0d0a 2020 2020 7265 6164 2073 7461  ),..    read sta
+00003250: 6e64 6172 6420 6372 7973 7461 6c6c 6f67  ndard crystallog
+00003260: 7261 7068 6963 2069 6e66 726f 6d61 7469  raphic infromati
+00003270: 6f6e 2069 6e74 6f20 6120 6372 7973 7461  on into a crysta
+00003280: 6c20 6469 6374 696f 6e61 7279 2c20 7769  l dictionary, wi
+00003290: 7468 206b 6579 733a 0d0a 2020 2020 2020  th keys:..      
+000032a0: 2020 2766 696c 656e 616d 6527 202d 2063    'filename' - c
+000032b0: 6966 2066 696c 656e 616d 650d 0a20 2020  if filename..   
+000032c0: 2020 2020 2027 6e61 6d65 2720 2d20 6e61       'name' - na
+000032d0: 6d65 206f 6620 7374 7275 6374 7572 650d  me of structure.
+000032e0: 0a20 2020 2020 2020 2027 756e 6974 2076  .        'unit v
+000032f0: 6563 746f 7227 2020 202d 205b 3378 335d  ector'   - [3x3]
+00003300: 2061 7272 6179 206f 6620 6261 7369 7320   array of basis 
+00003310: 7665 6374 6f72 7320 5b61 2c62 2c63 5d0d  vectors [a,b,c].
+00003320: 0a20 2020 2020 2020 2027 7061 7265 6e74  .        'parent
+00003330: 2063 656c 6c27 2020 202d 205b 3378 335d   cell'   - [3x3]
+00003340: 2061 7272 6179 206f 6620 7061 7265 6e74   array of parent
+00003350: 2062 6173 6973 2076 6563 746f 7273 205b   basis vectors [
+00003360: 612c 622c 635d 0d0a 2020 2020 2020 2020  a,b,c]..        
+00003370: 2773 796d 6d65 7472 7927 2020 2020 2020  'symmetry'      
+00003380: 2d20 6c69 7374 206f 6620 7374 7269 6e67  - list of string
+00003390: 2073 796d 6d65 7472 7920 6f70 6572 6174   symmetry operat
+000033a0: 696f 6e73 0d0a 2020 2020 2020 2020 2773  ions..        's
+000033b0: 7061 6365 2067 726f 7570 2720 2020 2d20  pace group'   - 
+000033c0: 5370 6163 6520 4772 6f75 7020 7374 7269  Space Group stri
+000033d0: 6e67 0d0a 2020 2020 2020 2020 2773 7061  ng..        'spa
+000033e0: 6365 2067 726f 7570 206e 756d 6265 7227  ce group number'
+000033f0: 202d 2053 7061 6365 2067 726f 7570 206e   - Space group n
+00003400: 756d 6265 720d 0a20 2020 2020 2020 2027  umber..        '
+00003410: 6369 6627 2020 2020 2020 2020 2020 202d  cif'           -
+00003420: 2063 6966 2064 6963 740d 0a20 2020 2020   cif dict..     
+00003430: 2020 2054 6865 2066 6f6c 6c6f 7769 6e67     The following
+00003440: 2061 7265 2073 7065 6369 6669 6320 746f   are specific to
+00003450: 2061 746f 6d69 7320 7769 7468 696e 2074   atomis within t
+00003460: 6865 2075 6e69 7420 6365 6c6c 3a0d 0a20  he unit cell:.. 
+00003470: 2020 2020 2020 2027 6174 6f6d 2074 7970         'atom typ
+00003480: 6527 2020 2020 202d 206c 6973 7420 6f66  e'     - list of
+00003490: 2065 6c65 6d65 6e74 7320 652e 672e 205b   elements e.g. [
+000034a0: 2743 6f27 2c27 4f27 2c20 274f 275d 0d0a  'Co','O', 'O']..
+000034b0: 2020 2020 2020 2020 2761 746f 6d20 6c61          'atom la
+000034c0: 6265 6c27 2020 2020 2d20 6c69 7374 206f  bel'    - list o
+000034d0: 6620 6174 6f6d 2073 6974 6520 6e61 6d65  f atom site name
+000034e0: 7320 652e 672e 205b 2743 6f31 2c20 274f  s e.g. ['Co1, 'O
+000034f0: 3127 2c20 274f 3227 5d0d 0a20 2020 2020  1', 'O2']..     
+00003500: 2020 2027 6174 6f6d 2070 6f73 6974 696f     'atom positio
+00003510: 6e27 202d 205b 6e78 335d 2061 7272 6179  n' - [nx3] array
+00003520: 206f 6620 6174 6f6d 6963 2070 6f73 6974   of atomic posit
+00003530: 696f 6e73 0d0a 2020 2020 2020 2020 2761  ions..        'a
+00003540: 746f 6d20 6f63 6375 7061 6e63 7927 2d20  tom occupancy'- 
+00003550: 5b6e 7831 5d20 6172 7261 7920 6f66 2061  [nx1] array of a
+00003560: 746f 6d20 7369 7465 206f 6363 7570 616e  tom site occupan
+00003570: 6369 6573 0d0a 2020 2020 2020 2020 2761  cies..        'a
+00003580: 746f 6d20 7569 736f 2720 2020 2020 2d20  tom uiso'     - 
+00003590: 5b6e 7831 5d20 6172 7261 7920 6f66 2061  [nx1] array of a
+000035a0: 746f 6d20 7369 7465 2069 736f 7472 6f70  tom site isotrop
+000035b0: 6963 2074 6865 726d 616c 2070 6172 616d  ic thermal param
+000035c0: 6574 6572 730d 0a20 2020 2020 2020 2027  eters..        '
+000035d0: 6174 6f6d 2075 616e 6973 6f27 2020 202d  atom uaniso'   -
+000035e0: 205b 6e78 365d 2061 7272 6179 206f 6620   [nx6] array of 
+000035f0: 6174 6f6d 2073 6974 6520 616e 6973 6f74  atom site anisot
+00003600: 726f 7069 6320 7468 6572 6d61 6c20 7061  ropic thermal pa
+00003610: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+00003620: 2020 276d 6167 206d 6f6d 656e 7427 2020    'mag moment'  
+00003630: 2020 2d20 5b6e 7833 5d20 6172 7261 7920    - [nx3] array 
+00003640: 6f66 2061 746f 6d20 7369 7465 206d 6167  of atom site mag
+00003650: 6e65 7469 6320 6d6f 6d65 6e74 2076 6563  netic moment vec
+00003660: 746f 7273 0d0a 2020 2020 2020 2020 276d  tors..        'm
+00003670: 6167 2074 696d 6527 2020 2020 2020 2d20  ag time'      - 
+00003680: 5b6e 7833 5d20 6172 7261 7920 6f66 2061  [nx3] array of a
+00003690: 746f 6d20 7369 7465 206d 6167 6e65 7469  tom site magneti
+000036a0: 6320 7469 6d65 2073 796d 6d65 7472 790d  c time symmetry.
+000036b0: 0a20 2020 2020 2020 2027 6d69 7363 275d  .        'misc']
+000036c0: 203d 205b 656c 656d 656e 742c 206c 6162   = [element, lab
+000036d0: 656c 2c20 6369 665f 706f 732c 206f 6363  el, cif_pos, occ
+000036e0: 2c20 5569 736f 5d0d 0a20 2020 203a 7061  , Uiso]..    :pa
+000036f0: 7261 6d20 6369 6676 616c 733a 2064 6963  ram cifvals: dic
+00003700: 7420 6672 6f6d 2072 6561 6463 6966 0d0a  t from readcif..
+00003710: 2020 2020 3a72 6574 7572 6e3a 2064 6963      :return: dic
+00003720: 740d 0a20 2020 2022 2222 0d0a 0d0a 2020  t..    """....  
+00003730: 2020 6b65 7973 203d 2063 6966 7661 6c73    keys = cifvals
+00003740: 2e6b 6579 7328 290d 0a0d 0a20 2020 2023  .keys()....    #
+00003750: 2047 656e 6572 6174 6520 756e 6974 2076   Generate unit v
+00003760: 6563 746f 7273 0d0a 2020 2020 612c 2064  ectors..    a, d
+00003770: 6120 3d20 6667 2e72 6561 6473 7466 6d28  a = fg.readstfm(
+00003780: 6369 6676 616c 735b 275f 6365 6c6c 5f6c  cifvals['_cell_l
+00003790: 656e 6774 685f 6127 5d29 0d0a 2020 2020  ength_a'])..    
+000037a0: 622c 2064 6220 3d20 6667 2e72 6561 6473  b, db = fg.reads
+000037b0: 7466 6d28 6369 6676 616c 735b 275f 6365  tfm(cifvals['_ce
+000037c0: 6c6c 5f6c 656e 6774 685f 6227 5d29 0d0a  ll_length_b'])..
+000037d0: 2020 2020 632c 2064 6320 3d20 6667 2e72      c, dc = fg.r
+000037e0: 6561 6473 7466 6d28 6369 6676 616c 735b  eadstfm(cifvals[
+000037f0: 275f 6365 6c6c 5f6c 656e 6774 685f 6327  '_cell_length_c'
+00003800: 5d29 0d0a 2020 2020 616c 7068 612c 2064  ])..    alpha, d
+00003810: 616c 7068 6120 3d20 6667 2e72 6561 6473  alpha = fg.reads
+00003820: 7466 6d28 6369 6676 616c 735b 275f 6365  tfm(cifvals['_ce
+00003830: 6c6c 5f61 6e67 6c65 5f61 6c70 6861 275d  ll_angle_alpha']
+00003840: 290d 0a20 2020 2062 6574 612c 2064 6265  )..    beta, dbe
+00003850: 7461 203d 2066 672e 7265 6164 7374 666d  ta = fg.readstfm
+00003860: 2863 6966 7661 6c73 5b27 5f63 656c 6c5f  (cifvals['_cell_
+00003870: 616e 676c 655f 6265 7461 275d 290d 0a20  angle_beta']).. 
+00003880: 2020 2067 616d 6d61 2c20 6467 616d 6d61     gamma, dgamma
+00003890: 203d 2066 672e 7265 6164 7374 666d 2863   = fg.readstfm(c
+000038a0: 6966 7661 6c73 5b27 5f63 656c 6c5f 616e  ifvals['_cell_an
+000038b0: 676c 655f 6761 6d6d 6127 5d29 0d0a 2020  gle_gamma'])..  
+000038c0: 2020 5556 203d 206c 6174 7061 7232 7576    UV = latpar2uv
+000038d0: 2861 2c20 622c 2063 2c20 616c 7068 612c  (a, b, c, alpha,
+000038e0: 2062 6574 612c 2067 616d 6d61 290d 0a0d   beta, gamma)...
+000038f0: 0a20 2020 2023 2047 6574 2061 746f 6d20  .    # Get atom 
+00003900: 6e61 6d65 7320 2620 6c61 6265 6c73 0d0a  names & labels..
+00003910: 2020 2020 6c61 6265 6c20 3d20 6369 6676      label = cifv
+00003920: 616c 735b 275f 6174 6f6d 5f73 6974 655f  als['_atom_site_
+00003930: 6c61 6265 6c27 5d0d 0a0d 0a20 2020 2069  label']....    i
+00003940: 6620 275f 6174 6f6d 5f73 6974 655f 7479  f '_atom_site_ty
+00003950: 7065 5f73 796d 626f 6c27 2069 6e20 6b65  pe_symbol' in ke
+00003960: 7973 3a0d 0a20 2020 2020 2020 2065 6c65  ys:..        ele
+00003970: 6d65 6e74 203d 205b 782e 7374 7269 7028  ment = [x.strip(
+00003980: 272b 2d30 3132 3334 3536 3738 3927 2920  '+-0123456789') 
+00003990: 666f 7220 7820 696e 2063 6966 7661 6c73  for x in cifvals
+000039a0: 5b27 5f61 746f 6d5f 7369 7465 5f74 7970  ['_atom_site_typ
+000039b0: 655f 7379 6d62 6f6c 275d 5d0d 0a20 2020  e_symbol']]..   
+000039c0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000039d0: 656c 656d 656e 7420 3d20 5b78 2e73 7472  element = [x.str
+000039e0: 6970 2827 2b2d 3031 3233 3435 3637 3839  ip('+-0123456789
+000039f0: 2729 2066 6f72 2078 2069 6e20 6369 6676  ') for x in cifv
+00003a00: 616c 735b 275f 6174 6f6d 5f73 6974 655f  als['_atom_site_
+00003a10: 6c61 6265 6c27 5d5d 0d0a 0d0a 2020 2020  label']]....    
+00003a20: 2320 4765 7420 6f74 6865 7220 7072 6f70  # Get other prop
+00003a30: 6572 7469 6573 0d0a 2020 2020 6966 2027  erties..    if '
+00003a40: 5f61 746f 6d5f 7369 7465 5f55 5f69 736f  _atom_site_U_iso
+00003a50: 5f6f 725f 6571 7569 7627 2069 6e20 6b65  _or_equiv' in ke
+00003a60: 7973 3a0d 0a20 2020 2020 2020 2055 6973  ys:..        Uis
+00003a70: 6f20 3d20 6e70 2e61 7272 6179 285b 6667  o = np.array([fg
+00003a80: 2e72 6561 6473 7466 6d28 7829 5b30 5d20  .readstfm(x)[0] 
+00003a90: 666f 7220 7820 696e 2063 6966 7661 6c73  for x in cifvals
+00003aa0: 5b27 5f61 746f 6d5f 7369 7465 5f55 5f69  ['_atom_site_U_i
+00003ab0: 736f 5f6f 725f 6571 7569 7627 5d5d 290d  so_or_equiv']]).
+00003ac0: 0a20 2020 2065 6c69 6620 275f 6174 6f6d  .    elif '_atom
+00003ad0: 5f73 6974 655f 425f 6973 6f5f 6f72 5f65  _site_B_iso_or_e
+00003ae0: 7175 6976 2720 696e 206b 6579 733a 0d0a  quiv' in keys:..
+00003af0: 2020 2020 2020 2020 6269 736f 203d 206e          biso = n
+00003b00: 702e 6172 7261 7928 5b66 672e 7265 6164  p.array([fg.read
+00003b10: 7374 666d 2878 295b 305d 2066 6f72 2078  stfm(x)[0] for x
+00003b20: 2069 6e20 6369 6676 616c 735b 275f 6174   in cifvals['_at
+00003b30: 6f6d 5f73 6974 655f 425f 6973 6f5f 6f72  om_site_B_iso_or
+00003b40: 5f65 7175 6976 275d 5d29 0d0a 2020 2020  _equiv']])..    
+00003b50: 2020 2020 5569 736f 203d 2062 6973 6f32      Uiso = biso2
+00003b60: 7569 736f 2862 6973 6f29 0d0a 2020 2020  uiso(biso)..    
+00003b70: 656c 7365 3a0d 0a20 2020 2020 2020 2055  else:..        U
+00003b80: 6973 6f20 3d20 6e70 2e7a 6572 6f73 286c  iso = np.zeros(l
+00003b90: 656e 2865 6c65 6d65 6e74 2929 0d0a 2020  en(element))..  
+00003ba0: 2020 6966 2027 5f61 746f 6d5f 7369 7465    if '_atom_site
+00003bb0: 5f6f 6363 7570 616e 6379 2720 696e 206b  _occupancy' in k
+00003bc0: 6579 733a 0d0a 2020 2020 2020 2020 6f63  eys:..        oc
+00003bd0: 6320 3d20 6e70 2e61 7272 6179 285b 6667  c = np.array([fg
+00003be0: 2e72 6561 6473 7466 6d28 7829 5b30 5d20  .readstfm(x)[0] 
+00003bf0: 666f 7220 7820 696e 2063 6966 7661 6c73  for x in cifvals
+00003c00: 5b27 5f61 746f 6d5f 7369 7465 5f6f 6363  ['_atom_site_occ
+00003c10: 7570 616e 6379 275d 5d29 0d0a 2020 2020  upancy']])..    
+00003c20: 656c 7365 3a0d 0a20 2020 2020 2020 206f  else:..        o
+00003c30: 6363 203d 206e 702e 6f6e 6573 286c 656e  cc = np.ones(len
+00003c40: 2865 6c65 6d65 6e74 2929 0d0a 0d0a 2020  (element))....  
+00003c50: 2020 2320 4765 7420 636f 6f72 6469 6e61    # Get coordina
+00003c60: 7465 730d 0a20 2020 2075 203d 206e 702e  tes..    u = np.
+00003c70: 6172 7261 7928 5b66 672e 7265 6164 7374  array([fg.readst
+00003c80: 666d 2878 295b 305d 2066 6f72 2078 2069  fm(x)[0] for x i
+00003c90: 6e20 6369 6676 616c 735b 275f 6174 6f6d  n cifvals['_atom
+00003ca0: 5f73 6974 655f 6672 6163 745f 7827 5d5d  _site_fract_x']]
+00003cb0: 290d 0a20 2020 2076 203d 206e 702e 6172  )..    v = np.ar
+00003cc0: 7261 7928 5b66 672e 7265 6164 7374 666d  ray([fg.readstfm
+00003cd0: 2878 295b 305d 2066 6f72 2078 2069 6e20  (x)[0] for x in 
+00003ce0: 6369 6676 616c 735b 275f 6174 6f6d 5f73  cifvals['_atom_s
+00003cf0: 6974 655f 6672 6163 745f 7927 5d5d 290d  ite_fract_y']]).
+00003d00: 0a20 2020 2077 203d 206e 702e 6172 7261  .    w = np.arra
+00003d10: 7928 5b66 672e 7265 6164 7374 666d 2878  y([fg.readstfm(x
+00003d20: 295b 305d 2066 6f72 2078 2069 6e20 6369  )[0] for x in ci
+00003d30: 6676 616c 735b 275f 6174 6f6d 5f73 6974  fvals['_atom_sit
+00003d40: 655f 6672 6163 745f 7a27 5d5d 290d 0a20  e_fract_z']]).. 
+00003d50: 2020 2063 6966 5f70 6f73 203d 206e 702e     cif_pos = np.
+00003d60: 6172 7261 7928 5b75 2c20 762c 2077 5d29  array([u, v, w])
+00003d70: 2e54 0d0a 0d0a 2020 2020 2320 4765 7420  .T....    # Get 
+00003d80: 6d61 676e 6574 6963 2076 6563 746f 7273  magnetic vectors
+00003d90: 0d0a 2020 2020 6369 665f 7665 6320 3d20  ..    cif_vec = 
+00003da0: 6e70 2e7a 6572 6f73 2863 6966 5f70 6f73  np.zeros(cif_pos
+00003db0: 2e73 6861 7065 290d 0a20 2020 2063 6966  .shape)..    cif
+00003dc0: 5f6d 6167 203d 206e 702e 7a65 726f 7328  _mag = np.zeros(
+00003dd0: 6c65 6e28 7529 290d 0a20 2020 2069 6620  len(u))..    if 
+00003de0: 275f 6174 6f6d 5f73 6974 655f 6d6f 6d65  '_atom_site_mome
+00003df0: 6e74 5f6c 6162 656c 2720 696e 206b 6579  nt_label' in key
+00003e00: 733a 0d0a 2020 2020 2020 2020 6d61 675f  s:..        mag_
+00003e10: 6174 6f6d 7320 3d20 6369 6676 616c 735b  atoms = cifvals[
+00003e20: 275f 6174 6f6d 5f73 6974 655f 6d6f 6d65  '_atom_site_mome
+00003e30: 6e74 5f6c 6162 656c 275d 0d0a 2020 2020  nt_label']..    
+00003e40: 2020 2020 6d78 203d 206e 702e 6172 7261      mx = np.arra
+00003e50: 7928 5b66 672e 7265 6164 7374 666d 2878  y([fg.readstfm(x
+00003e60: 295b 305d 2066 6f72 2078 2069 6e20 6369  )[0] for x in ci
+00003e70: 6676 616c 735b 275f 6174 6f6d 5f73 6974  fvals['_atom_sit
+00003e80: 655f 6d6f 6d65 6e74 5f63 7279 7374 616c  e_moment_crystal
+00003e90: 6178 6973 5f78 275d 5d29 0d0a 2020 2020  axis_x']])..    
+00003ea0: 2020 2020 6d79 203d 206e 702e 6172 7261      my = np.arra
+00003eb0: 7928 5b66 672e 7265 6164 7374 666d 2878  y([fg.readstfm(x
+00003ec0: 295b 305d 2066 6f72 2078 2069 6e20 6369  )[0] for x in ci
+00003ed0: 6676 616c 735b 275f 6174 6f6d 5f73 6974  fvals['_atom_sit
+00003ee0: 655f 6d6f 6d65 6e74 5f63 7279 7374 616c  e_moment_crystal
+00003ef0: 6178 6973 5f79 275d 5d29 0d0a 2020 2020  axis_y']])..    
+00003f00: 2020 2020 6d7a 203d 206e 702e 6172 7261      mz = np.arra
+00003f10: 7928 5b66 672e 7265 6164 7374 666d 2878  y([fg.readstfm(x
+00003f20: 295b 305d 2066 6f72 2078 2069 6e20 6369  )[0] for x in ci
+00003f30: 6676 616c 735b 275f 6174 6f6d 5f73 6974  fvals['_atom_sit
+00003f40: 655f 6d6f 6d65 6e74 5f63 7279 7374 616c  e_moment_crystal
+00003f50: 6178 6973 5f7a 275d 5d29 0d0a 2020 2020  axis_z']])..    
+00003f60: 2020 2020 6d61 675f 706f 7320 3d20 6e70      mag_pos = np
+00003f70: 2e61 7272 6179 285b 6d78 2c20 6d79 2c20  .array([mx, my, 
+00003f80: 6d7a 5d29 2e54 0d0a 2020 2020 2020 2020  mz]).T..        
+00003f90: 666f 7220 6e2c 206d 6120 696e 2065 6e75  for n, ma in enu
+00003fa0: 6d65 7261 7465 286d 6167 5f61 746f 6d73  merate(mag_atoms
+00003fb0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00003fc0: 6d61 675f 6964 7820 3d20 6c61 6265 6c2e  mag_idx = label.
+00003fd0: 696e 6465 7828 6d61 290d 0a20 2020 2020  index(ma)..     
+00003fe0: 2020 2020 2020 2063 6966 5f76 6563 5b6d         cif_vec[m
+00003ff0: 6167 5f69 6478 2c20 3a5d 203d 206d 6167  ag_idx, :] = mag
+00004000: 5f70 6f73 5b6e 2c20 3a5d 0d0a 2020 2020  _pos[n, :]..    
+00004010: 2020 2020 2020 2020 6369 665f 6d61 675b          cif_mag[
+00004020: 6d61 675f 6964 785d 203d 2066 672e 6d61  mag_idx] = fg.ma
+00004030: 6728 6d61 675f 706f 735b 6e2c 203a 5d29  g(mag_pos[n, :])
+00004040: 0d0a 0d0a 2020 2020 2320 4765 7420 7379  ....    # Get sy
+00004050: 6d6d 6574 7279 206f 7065 7261 7469 6f6e  mmetry operation
+00004060: 730d 0a20 2020 2069 6620 275f 7379 6d6d  s..    if '_symm
+00004070: 6574 7279 5f65 7175 6976 5f70 6f73 5f61  etry_equiv_pos_a
+00004080: 735f 7879 7a27 2069 6e20 6b65 7973 3a0d  s_xyz' in keys:.
+00004090: 0a20 2020 2020 2020 2073 796d 6f70 7320  .        symops 
+000040a0: 3d20 6369 6676 616c 735b 275f 7379 6d6d  = cifvals['_symm
+000040b0: 6574 7279 5f65 7175 6976 5f70 6f73 5f61  etry_equiv_pos_a
+000040c0: 735f 7879 7a27 5d0d 0a20 2020 2020 2020  s_xyz']..       
+000040d0: 2073 796d 7469 6d20 3d20 5b31 5d20 2a20   symtim = [1] * 
+000040e0: 6c65 6e28 7379 6d6f 7073 290d 0a20 2020  len(symops)..   
+000040f0: 2020 2020 2073 796d 6d61 6720 3d20 5b27       symmag = ['
+00004100: 6d78 2c6d 792c 6d7a 275d 202a 206c 656e  mx,my,mz'] * len
+00004110: 2873 796d 6f70 7329 0d0a 2020 2020 2020  (symops)..      
+00004120: 2020 7379 6d63 656e 203d 205b 2778 2c79    symcen = ['x,y
+00004130: 2c7a 275d 0d0a 2020 2020 2020 2020 7379  ,z']..        sy
+00004140: 6d63 656e 7469 6d20 3d20 5b31 5d0d 0a20  mcentim = [1].. 
+00004150: 2020 2020 2020 2073 796d 6365 6e6d 6167         symcenmag
+00004160: 203d 205b 276d 782c 6d79 2c6d 7a27 5d0d   = ['mx,my,mz'].
+00004170: 0a20 2020 2065 6c69 6620 275f 7370 6163  .    elif '_spac
+00004180: 655f 6772 6f75 705f 7379 6d6f 705f 6f70  e_group_symop_op
+00004190: 6572 6174 696f 6e5f 7879 7a27 2069 6e20  eration_xyz' in 
+000041a0: 6b65 7973 3a0d 0a20 2020 2020 2020 2073  keys:..        s
+000041b0: 796d 6f70 7320 3d20 6369 6676 616c 735b  ymops = cifvals[
+000041c0: 275f 7370 6163 655f 6772 6f75 705f 7379  '_space_group_sy
+000041d0: 6d6f 705f 6f70 6572 6174 696f 6e5f 7879  mop_operation_xy
+000041e0: 7a27 5d0d 0a20 2020 2020 2020 2073 796d  z']..        sym
+000041f0: 7469 6d20 3d20 5b31 5d20 2a20 6c65 6e28  tim = [1] * len(
+00004200: 7379 6d6f 7073 290d 0a20 2020 2020 2020  symops)..       
+00004210: 2073 796d 6d61 6720 3d20 5b27 6d78 2c6d   symmag = ['mx,m
+00004220: 792c 6d7a 275d 202a 206c 656e 2873 796d  y,mz'] * len(sym
+00004230: 6f70 7329 0d0a 2020 2020 2020 2020 7379  ops)..        sy
+00004240: 6d63 656e 203d 205b 2778 2c79 2c7a 275d  mcen = ['x,y,z']
+00004250: 0d0a 2020 2020 2020 2020 7379 6d63 656e  ..        symcen
+00004260: 7469 6d20 3d20 5b31 5d0d 0a20 2020 2020  tim = [1]..     
+00004270: 2020 2073 796d 6365 6e6d 6167 203d 205b     symcenmag = [
+00004280: 276d 782c 6d79 2c6d 7a27 5d0d 0a20 2020  'mx,my,mz']..   
+00004290: 2065 6c69 6620 275f 7370 6163 655f 6772   elif '_space_gr
+000042a0: 6f75 705f 7379 6d6f 702e 6d61 676e 5f6f  oup_symop.magn_o
+000042b0: 7065 7261 7469 6f6e 5f78 797a 2720 696e  peration_xyz' in
+000042c0: 206b 6579 733a 0d0a 2020 2020 2020 2020   keys:..        
+000042d0: 7379 6d6f 7073 5f74 696d 203d 2063 6966  symops_tim = cif
+000042e0: 7661 6c73 5b27 5f73 7061 6365 5f67 726f  vals['_space_gro
+000042f0: 7570 5f73 796d 6f70 2e6d 6167 6e5f 6f70  up_symop.magn_op
+00004300: 6572 6174 696f 6e5f 7879 7a27 5d0d 0a20  eration_xyz'].. 
+00004310: 2020 2020 2020 2023 2045 6163 6820 7379         # Each sy
+00004320: 6d6f 7020 6769 7665 6e20 7769 7468 2074  mop given with t
+00004330: 696d 6520 7661 6c75 653a 2078 2c79 2c7a  ime value: x,y,z
+00004340: 2c2b 312c 2073 6570 6172 6174 6520 7468  ,+1, separate th
+00004350: 656d 3a0d 0a20 2020 2020 2020 2073 796d  em:..        sym
+00004360: 6f70 7320 3d20 5b27 2c27 2e6a 6f69 6e28  ops = [','.join(
+00004370: 732e 7370 6c69 7428 272c 2729 5b3a 335d  s.split(',')[:3]
+00004380: 2920 666f 7220 7320 696e 2073 796d 6f70  ) for s in symop
+00004390: 735f 7469 6d5d 2020 2320 782c 792c 7a0d  s_tim]  # x,y,z.
+000043a0: 0a20 2020 2020 2020 2073 796d 7469 6d20  .        symtim 
+000043b0: 3d20 5b6e 702e 696e 7428 732e 7370 6c69  = [np.int(s.spli
+000043c0: 7428 272c 2729 5b2d 315d 2920 666f 7220  t(',')[-1]) for 
+000043d0: 7320 696e 2073 796d 6f70 735f 7469 6d5d  s in symops_tim]
+000043e0: 2020 2320 2b31 0d0a 2020 2020 2020 2020    # +1..        
+000043f0: 7379 6d6d 6167 203d 2063 6966 7661 6c73  symmag = cifvals
+00004400: 5b27 5f73 7061 6365 5f67 726f 7570 5f73  ['_space_group_s
+00004410: 796d 6f70 2e6d 6167 6e5f 6f70 6572 6174  ymop.magn_operat
+00004420: 696f 6e5f 6d78 6d79 6d7a 275d 0d0a 0d0a  ion_mxmymz']....
+00004430: 2020 2020 2020 2020 2320 4365 6e74 7269          # Centri
+00004440: 6e67 2076 6563 746f 7273 2061 6c73 6f20  ng vectors also 
+00004450: 6769 7665 6e20 696e 2074 6869 7320 6361  given in this ca
+00004460: 7365 0d0a 2020 2020 2020 2020 7379 6d63  se..        symc
+00004470: 656e 5f74 696d 203d 2063 6966 7661 6c73  en_tim = cifvals
+00004480: 5b27 5f73 7061 6365 5f67 726f 7570 5f73  ['_space_group_s
+00004490: 796d 6f70 2e6d 6167 6e5f 6365 6e74 6572  ymop.magn_center
+000044a0: 696e 675f 7879 7a27 5d0d 0a20 2020 2020  ing_xyz']..     
+000044b0: 2020 2073 796d 6365 6e20 3d20 5b27 2c27     symcen = [','
+000044c0: 2e6a 6f69 6e28 732e 7370 6c69 7428 272c  .join(s.split(',
+000044d0: 2729 5b3a 335d 2920 666f 7220 7320 696e  ')[:3]) for s in
+000044e0: 2073 796d 6365 6e5f 7469 6d5d 2020 2320   symcen_tim]  # 
+000044f0: 782c 792c 7a0d 0a20 2020 2020 2020 2073  x,y,z..        s
+00004500: 796d 6365 6e74 696d 203d 205b 6e70 2e69  ymcentim = [np.i
+00004510: 6e74 2873 2e73 706c 6974 2827 2c27 295b  nt(s.split(',')[
+00004520: 2d31 5d29 2066 6f72 2073 2069 6e20 7379  -1]) for s in sy
+00004530: 6d63 656e 5f74 696d 5d20 2023 202b 310d  mcen_tim]  # +1.
+00004540: 0a20 2020 2020 2020 2073 796d 6365 6e6d  .        symcenm
+00004550: 6167 203d 2063 6966 7661 6c73 5b27 5f73  ag = cifvals['_s
+00004560: 7061 6365 5f67 726f 7570 5f73 796d 6f70  pace_group_symop
+00004570: 2e6d 6167 6e5f 6365 6e74 6572 696e 675f  .magn_centering_
+00004580: 6d78 6d79 6d7a 275d 0d0a 2020 2020 656c  mxmymz']..    el
+00004590: 7365 3a0d 0a20 2020 2020 2020 2073 796d  se:..        sym
+000045a0: 6f70 7320 3d20 5b27 782c 792c 7a27 5d0d  ops = ['x,y,z'].
+000045b0: 0a20 2020 2020 2020 2073 796d 7469 6d20  .        symtim 
+000045c0: 3d20 5b31 5d0d 0a20 2020 2020 2020 2073  = [1]..        s
+000045d0: 796d 6d61 6720 3d20 5b27 6d78 2c6d 792c  ymmag = ['mx,my,
+000045e0: 6d7a 275d 0d0a 2020 2020 2020 2020 7379  mz']..        sy
+000045f0: 6d63 656e 203d 205b 2778 2c79 2c7a 275d  mcen = ['x,y,z']
+00004600: 0d0a 2020 2020 2020 2020 7379 6d63 656e  ..        symcen
+00004610: 7469 6d20 3d20 5b31 5d0d 0a20 2020 2020  tim = [1]..     
+00004620: 2020 2073 796d 6365 6e6d 6167 203d 205b     symcenmag = [
+00004630: 276d 782c 6d79 2c6d 7a27 5d0d 0a20 2020  'mx,my,mz']..   
+00004640: 2073 796d 6f70 7320 3d20 5b72 652e 7375   symops = [re.su
+00004650: 6228 275c 2727 2c20 2727 2c20 7829 2066  b('\'', '', x) f
+00004660: 6f72 2078 2069 6e20 7379 6d6f 7073 5d0d  or x in symops].
+00004670: 0a20 2020 2073 796d 6d61 6720 3d20 5b73  .    symmag = [s
+00004680: 6d2e 7265 706c 6163 6528 276d 272c 2027  m.replace('m', '
+00004690: 2729 2066 6f72 2073 6d20 696e 2073 796d  ') for sm in sym
+000046a0: 6d61 675d 2020 2320 7265 6d6f 7665 206d  mag]  # remove m
+000046b0: 0d0a 2020 2020 7379 6d63 656e 6d61 6720  ..    symcenmag 
+000046c0: 3d20 5b73 6d2e 7265 706c 6163 6528 276d  = [sm.replace('m
+000046d0: 272c 2027 2729 2066 6f72 2073 6d20 696e  ', '') for sm in
+000046e0: 2073 796d 6365 6e6d 6167 5d20 2023 2072   symcenmag]  # r
+000046f0: 656d 6f76 6520 6d0d 0a0d 0a20 2020 2023  emove m....    #
+00004700: 2047 6574 206d 6167 6e65 7469 6320 7379   Get magnetic sy
+00004710: 6d6d 6574 7279 2063 6f6e 7374 7261 696e  mmetry constrain
+00004720: 7473 0d0a 2020 2020 6966 2027 5f6d 6167  ts..    if '_mag
+00004730: 6e65 7469 635f 6174 6f6d 5f73 6974 655f  netic_atom_site_
+00004740: 6d6f 6d65 6e74 5f73 796d 6d65 7472 795f  moment_symmetry_
+00004750: 636f 6e73 7472 6169 6e74 735f 6c61 6265  constraints_labe
+00004760: 6c27 2069 6e20 6b65 7973 3a0d 0a20 2020  l' in keys:..   
+00004770: 2020 2020 2063 6f6e 7374 5f6c 6162 656c       const_label
+00004780: 7320 3d20 6369 6676 616c 735b 275f 6d61  s = cifvals['_ma
+00004790: 676e 6574 6963 5f61 746f 6d5f 7369 7465  gnetic_atom_site
+000047a0: 5f6d 6f6d 656e 745f 7379 6d6d 6574 7279  _moment_symmetry
+000047b0: 5f63 6f6e 7374 7261 696e 7473 5f6c 6162  _constraints_lab
+000047c0: 656c 275d 0d0a 2020 2020 2020 2020 636f  el']..        co
+000047d0: 6e73 7472 6169 6e74 7320 3d20 6369 6676  nstraints = cifv
+000047e0: 616c 735b 275f 6174 6f6d 5f73 6974 655f  als['_atom_site_
+000047f0: 6d61 676e 6574 6963 5f6d 6f6d 656e 745f  magnetic_moment_
+00004800: 7379 6d6d 6574 7279 5f63 6f6e 7374 7261  symmetry_constra
+00004810: 696e 7473 5f6d 786d 796d 7a27 5d0d 0a20  ints_mxmymz'].. 
+00004820: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00004830: 2020 636f 6e73 745f 6c61 6265 6c73 203d    const_labels =
+00004840: 205b 5d0d 0a20 2020 2020 2020 2063 6f6e   []..        con
+00004850: 7374 7261 696e 7473 203d 205b 5d0d 0a0d  straints = []...
+00004860: 0a20 2020 2023 2061 7070 6c79 2073 796d  .    # apply sym
+00004870: 6d65 7472 7920 6f70 6572 6174 696f 6e73  metry operations
+00004880: 2074 6f20 6561 6368 2070 6f73 6974 696f   to each positio
+00004890: 6e2c 2067 656e 6572 6174 696e 6720 5031  n, generating P1
+000048a0: 2073 7472 7563 7475 7265 0d0a 2020 2020   structure..    
+000048b0: 2320 416c 736f 2072 6570 6561 7420 6561  # Also repeat ea
+000048c0: 6368 2065 6c65 6d65 6e74 2070 726f 7065  ch element prope
+000048d0: 7274 790d 0a20 2020 204e 7379 6d4f 7073  rty..    NsymOps
+000048e0: 203d 206c 656e 2873 796d 6f70 7329 0d0a   = len(symops)..
+000048f0: 2020 2020 4e63 656e 4f70 7320 3d20 6c65      NcenOps = le
+00004900: 6e28 7379 6d63 656e 290d 0a20 2020 204e  n(symcen)..    N
+00004910: 6f70 7320 3d20 4e73 796d 4f70 7320 2a20  ops = NsymOps * 
+00004920: 4e63 656e 4f70 730d 0a20 2020 2070 3170  NcenOps..    p1p
+00004930: 6f73 203d 206e 702e 656d 7074 7928 5b30  os = np.empty([0
+00004940: 2c20 335d 290d 0a20 2020 2070 3176 6563  , 3])..    p1vec
+00004950: 203d 206e 702e 656d 7074 7928 5b30 2c20   = np.empty([0, 
+00004960: 335d 290d 0a20 2020 2070 316d 6167 203d  3])..    p1mag =
+00004970: 205b 5d0d 0a20 2020 2070 3174 7970 203d   []..    p1typ =
+00004980: 205b 5d0d 0a20 2020 2070 316c 626c 203d   []..    p1lbl =
+00004990: 205b 5d0d 0a20 2020 2070 316f 6363 203d   []..    p1occ =
+000049a0: 205b 5d0d 0a20 2020 2070 3155 6973 6f20   []..    p1Uiso 
+000049b0: 3d20 5b5d 0d0a 2020 2020 7031 7469 6d20  = []..    p1tim 
+000049c0: 3d20 5b5d 0d0a 2020 2020 666f 7220 6e2c  = []..    for n,
+000049d0: 2028 782c 2079 2c20 7a29 2069 6e20 656e   (x, y, z) in en
+000049e0: 756d 6572 6174 6528 6369 665f 706f 7329  umerate(cif_pos)
+000049f0: 3a0d 0a20 2020 2020 2020 2075 7677 203d  :..        uvw =
+00004a00: 2067 656e 5f73 796d 5f70 6f73 2873 796d   gen_sym_pos(sym
+00004a10: 6f70 732c 2078 2c20 792c 207a 290d 0a20  ops, x, y, z).. 
+00004a20: 2020 2020 2020 2075 7677 203d 2066 6974         uvw = fit
+00004a30: 696e 6365 6c6c 2875 7677 290d 0a0d 0a20  incell(uvw).... 
+00004a40: 2020 2020 2020 2023 2041 7070 6c79 2073         # Apply s
+00004a50: 796d 6d65 7472 7920 636f 6e73 7472 6169  ymmetry constrai
+00004a60: 6e74 730d 0a20 2020 2020 2020 2069 6620  nts..        if 
+00004a70: 6c61 6265 6c5b 6e5d 2069 6e20 636f 6e73  label[n] in cons
+00004a80: 745f 6c61 6265 6c73 3a0d 0a20 2020 2020  t_labels:..     
+00004a90: 2020 2020 2020 2023 2041 7373 756d 6573         # Assumes
+00004aa0: 2073 696e 676c 6520 636f 6e73 7472 6169   single constrai
+00004ab0: 6e74 2070 6572 2061 746f 6d0d 0a20 2020  nt per atom..   
+00004ac0: 2020 2020 2020 2020 2069 6478 203d 2063           idx = c
+00004ad0: 6f6e 7374 5f6c 6162 656c 732e 696e 6465  onst_labels.inde
+00004ae0: 7828 6c61 6265 6c5b 6e5d 290d 0a20 2020  x(label[n])..   
+00004af0: 2020 2020 2020 2020 2043 203d 2063 6f6e           C = con
+00004b00: 7374 7261 696e 7473 5b69 6478 5d0d 0a20  straints[idx].. 
+00004b10: 2020 2020 2020 2020 2020 2043 203d 2043             C = C
+00004b20: 2e72 6570 6c61 6365 2827 6d27 2c20 2727  .replace('m', ''
+00004b30: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00004b40: 2070 7269 6e74 2827 436f 6e73 7472 6169   print('Constrai
+00004b50: 6e74 3a20 7b3a 3373 7d20 7b3a 737d 272e  nt: {:3s} {:s}'.
+00004b60: 666f 726d 6174 286c 6162 656c 5b6e 5d2c  format(label[n],
+00004b70: 4329 290d 0a20 2020 2020 2020 2020 2020  C))..           
+00004b80: 2023 2063 6f6e 7665 7274 2027 3278 2720   # convert '2x' 
+00004b90: 746f 2027 7827 0d0a 2020 2020 2020 2020  to 'x'..        
+00004ba0: 2020 2020 6f6c 6420 3d20 7265 2e66 696e      old = re.fin
+00004bb0: 6461 6c6c 2827 5c64 5b78 797a 5d27 2c20  dall('\d[xyz]', 
+00004bc0: 4329 0d0a 2020 2020 2020 2020 2020 2020  C)..            
+00004bd0: 6e65 7720 3d20 5b73 2e72 6570 6c61 6365  new = [s.replace
+00004be0: 2827 7827 2c20 272a 7827 292e 7265 706c  ('x', '*x').repl
+00004bf0: 6163 6528 2779 272c 2027 2a79 2729 2e72  ace('y', '*y').r
+00004c00: 6570 6c61 6365 2827 7a27 2c20 272a 7a27  eplace('z', '*z'
+00004c10: 2920 666f 7220 7320 696e 206f 6c64 5d0d  ) for s in old].
+00004c20: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00004c30: 2073 2069 6e20 7261 6e67 6528 6c65 6e28   s in range(len(
+00004c40: 6f6c 6429 293a 0d0a 2020 2020 2020 2020  old)):..        
+00004c50: 2020 2020 2020 2020 4320 3d20 432e 7265          C = C.re
+00004c60: 706c 6163 6528 6f6c 645b 735d 2c20 6e65  place(old[s], ne
+00004c70: 775b 735d 290d 0a20 2020 2020 2020 2020  w[s])..         
+00004c80: 2020 2043 203d 2043 2e73 706c 6974 2827     C = C.split('
+00004c90: 2c27 290d 0a20 2020 2020 2020 2020 2020  ,')..           
+00004ca0: 2023 2041 7070 6c79 2063 6f6e 7374 7261   # Apply constra
+00004cb0: 696e 7420 746f 2073 796d 6d65 7472 7920  int to symmetry 
+00004cc0: 6172 6775 6d65 6e74 730d 0a20 2020 2020  arguments..     
+00004cd0: 2020 2020 2020 2053 203d 205b 732e 7265         S = [s.re
+00004ce0: 706c 6163 6528 2778 272c 2027 6127 292e  place('x', 'a').
+00004cf0: 7265 706c 6163 6528 2779 272c 2027 6227  replace('y', 'b'
+00004d00: 292e 7265 706c 6163 6528 277a 272c 2027  ).replace('z', '
+00004d10: 6327 2920 666f 7220 7320 696e 2073 796d  c') for s in sym
+00004d20: 6d61 675d 0d0a 2020 2020 2020 2020 2020  mag]..          
+00004d30: 2020 5320 3d20 5b73 2e72 6570 6c61 6365    S = [s.replace
+00004d40: 2827 6127 2c20 435b 305d 292e 7265 706c  ('a', C[0]).repl
+00004d50: 6163 6528 2762 272c 2043 5b31 5d29 2e72  ace('b', C[1]).r
+00004d60: 6570 6c61 6365 2827 6327 2c20 435b 325d  eplace('c', C[2]
+00004d70: 2920 666f 7220 7320 696e 2053 5d0d 0a20  ) for s in S].. 
+00004d80: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00004d90: 2020 2020 2020 2020 2020 5320 3d20 7379            S = sy
+00004da0: 6d6d 6167 0d0a 0d0a 2020 2020 2020 2020  mmag....        
+00004db0: 6d78 2c20 6d79 2c20 6d7a 203d 2063 6966  mx, my, mz = cif
+00004dc0: 5f76 6563 5b6e 5d0d 0a20 2020 2020 2020  _vec[n]..       
+00004dd0: 206d 6167 5f75 7677 203d 2067 656e 5f73   mag_uvw = gen_s
+00004de0: 796d 5f70 6f73 2853 2c20 6d78 2c20 6d79  ym_pos(S, mx, my
+00004df0: 2c20 6d7a 290d 0a20 2020 2020 2020 2023  , mz)..        #
+00004e00: 2070 7269 6e74 2827 2d2d 2d7b 3a33 2e30   print('---{:3.0
+00004e10: 667d 2e20 7b3a 3273 7d20 287b 3a35 2e32  f}. {:2s} ({:5.2
+00004e20: 667d 2c7b 3a35 2e32 667d 2c7b 3a35 2e32  f},{:5.2f},{:5.2
+00004e30: 667d 292d 2d2d 272e 666f 726d 6174 286e  f})---'.format(n
+00004e40: 2c6c 6162 656c 5b6e 5d2c 6d78 2c6d 792c  ,label[n],mx,my,
+00004e50: 6d7a 2929 0d0a 0d0a 2020 2020 2020 2020  mz))....        
+00004e60: 2320 4c6f 6f70 206f 7665 7220 6365 6e74  # Loop over cent
+00004e70: 7269 6e67 206f 7065 7261 7469 6f6e 730d  ring operations.
+00004e80: 0a20 2020 2020 2020 2073 796d 706f 7320  .        sympos 
+00004e90: 3d20 6e70 2e7a 6572 6f73 285b 4e6f 7073  = np.zeros([Nops
+00004ea0: 2c20 335d 290d 0a20 2020 2020 2020 2073  , 3])..        s
+00004eb0: 796d 6d61 6770 6f73 203d 206e 702e 7a65  ymmagpos = np.ze
+00004ec0: 726f 7328 5b4e 6f70 732c 2033 5d29 0d0a  ros([Nops, 3])..
+00004ed0: 2020 2020 2020 2020 7379 6d74 696d 706f          symtimpo
+00004ee0: 7320 3d20 6e70 2e7a 6572 6f73 284e 6f70  s = np.zeros(Nop
+00004ef0: 7329 0d0a 2020 2020 2020 2020 666f 7220  s)..        for 
+00004f00: 6d2c 2028 6378 2c20 6379 2c20 637a 2920  m, (cx, cy, cz) 
+00004f10: 696e 2065 6e75 6d65 7261 7465 2875 7677  in enumerate(uvw
+00004f20: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00004f30: 4e69 2c20 4e6a 203d 206d 202a 204e 6365  Ni, Nj = m * Nce
+00004f40: 6e4f 7073 2c20 286d 202b 2031 2920 2a20  nOps, (m + 1) * 
+00004f50: 4e63 656e 4f70 730d 0a20 2020 2020 2020  NcenOps..       
+00004f60: 2020 2020 2063 656e 5f75 7677 203d 2067       cen_uvw = g
+00004f70: 656e 5f73 796d 5f70 6f73 2873 796d 6365  en_sym_pos(symce
+00004f80: 6e2c 2063 782c 2063 792c 2063 7a29 0d0a  n, cx, cy, cz)..
+00004f90: 2020 2020 2020 2020 2020 2020 6365 6e5f              cen_
+00004fa0: 7576 7720 3d20 6669 7469 6e63 656c 6c28  uvw = fitincell(
+00004fb0: 6365 6e5f 7576 7729 0d0a 2020 2020 2020  cen_uvw)..      
+00004fc0: 2020 2020 2020 7379 6d70 6f73 5b4e 693a        sympos[Ni:
+00004fd0: 4e6a 2c20 3a5d 203d 2063 656e 5f75 7677  Nj, :] = cen_uvw
+00004fe0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00004ff0: 636d 782c 2063 6d79 2c20 636d 7a20 3d20  cmx, cmy, cmz = 
+00005000: 6d61 675f 7576 775b 6d5d 0d0a 2020 2020  mag_uvw[m]..    
+00005010: 2020 2020 2020 2020 6d61 675f 6365 6e20          mag_cen 
+00005020: 3d20 6765 6e5f 7379 6d5f 706f 7328 7379  = gen_sym_pos(sy
+00005030: 6d63 656e 6d61 672c 2063 6d78 2c20 636d  mcenmag, cmx, cm
+00005040: 792c 2063 6d7a 290d 0a20 2020 2020 2020  y, cmz)..       
+00005050: 2020 2020 2023 2070 7269 6e74 2827 2020       # print('  
+00005060: 5379 6d7b 3a32 2e30 667d 3a20 7b3a 3130  Sym{:2.0f}: {:10
+00005070: 737d 2028 7b3a 352e 3266 7d2c 7b3a 352e  s} ({:5.2f},{:5.
+00005080: 3266 7d2c 7b3a 352e 3266 7d29 272e 666f  2f},{:5.2f})'.fo
+00005090: 726d 6174 286d 2c53 5b6d 5d2c 636d 782c  rmat(m,S[m],cmx,
+000050a0: 636d 792c 636d 7a29 290d 0a20 2020 2020  cmy,cmz))..     
+000050b0: 2020 2020 2020 2023 2066 6f72 206f 2069         # for o i
+000050c0: 6e20 7261 6e67 6528 6c65 6e28 6d61 675f  n range(len(mag_
+000050d0: 6365 6e29 293a 0d0a 2020 2020 2020 2020  cen)):..        
+000050e0: 2020 2020 2320 7072 696e 7428 2720 2020      # print('   
+000050f0: 2043 656e 7b3a 312e 3066 7d3a 207b 3a31   Cen{:1.0f}: {:1
+00005100: 3073 7d20 287b 3a35 2e32 667d 2c7b 3a35  0s} ({:5.2f},{:5
+00005110: 2e32 667d 2c7b 3a35 2e32 667d 2927 2e66  .2f},{:5.2f})'.f
+00005120: 6f72 6d61 7428 6f2c 7379 6d63 656e 6d61  ormat(o,symcenma
+00005130: 675b 6f5d 2c2a 6d61 675f 6365 6e5b 6f5d  g[o],*mag_cen[o]
+00005140: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00005150: 7379 6d6d 6167 706f 735b 4e69 3a4e 6a2c  symmagpos[Ni:Nj,
+00005160: 203a 5d20 3d20 6d61 675f 6365 6e0d 0a20   :] = mag_cen.. 
+00005170: 2020 2020 2020 2020 2020 2073 796d 7469             symti
+00005180: 6d70 6f73 5b4e 693a 4e6a 5d20 3d20 7379  mpos[Ni:Nj] = sy
+00005190: 6d74 696d 5b6d 5d20 2a20 6e70 2e61 7272  mtim[m] * np.arr
+000051a0: 6179 2873 796d 6365 6e74 696d 290d 0a0d  ay(symcentim)...
+000051b0: 0a20 2020 2020 2020 2023 2052 656d 6f76  .        # Remov
+000051c0: 6520 6475 706c 6963 6174 6573 0d0a 2020  e duplicates..  
+000051d0: 2020 2020 2020 6e65 7761 7272 6179 2c20        newarray, 
+000051e0: 756e 6971 7565 6964 782c 206d 6174 6368  uniqueidx, match
+000051f0: 6964 7820 3d20 6667 2e75 6e69 7175 655f  idx = fg.unique_
+00005200: 7665 6374 6f72 2873 796d 706f 732c 2030  vector(sympos, 0
+00005210: 2e30 3129 0d0a 2020 2020 2020 2020 6365  .01)..        ce
+00005220: 6e5f 7576 7720 3d20 7379 6d70 6f73 5b75  n_uvw = sympos[u
+00005230: 6e69 7175 6569 6478 2c20 3a5d 0d0a 2020  niqueidx, :]..  
+00005240: 2020 2020 2020 6d61 675f 6365 6e20 3d20        mag_cen = 
+00005250: 7379 6d6d 6167 706f 735b 756e 6971 7565  symmagpos[unique
+00005260: 6964 782c 203a 5d0d 0a20 2020 2020 2020  idx, :]..       
+00005270: 2073 796d 7469 6d70 6f73 203d 2073 796d   symtimpos = sym
+00005280: 7469 6d70 6f73 5b75 6e69 7175 6569 6478  timpos[uniqueidx
+00005290: 5d0d 0a0d 0a20 2020 2020 2020 2023 2041  ]....        # A
+000052a0: 7070 656e 6420 746f 2050 3120 6174 6f6d  ppend to P1 atom
+000052b0: 7320 6172 7261 7973 0d0a 2020 2020 2020  s arrays..      
+000052c0: 2020 7031 706f 7320 3d20 6e70 2e61 7070    p1pos = np.app
+000052d0: 656e 6428 7031 706f 732c 2063 656e 5f75  end(p1pos, cen_u
+000052e0: 7677 2c20 6178 6973 3d30 290d 0a20 2020  vw, axis=0)..   
+000052f0: 2020 2020 2070 3176 6563 203d 206e 702e       p1vec = np.
+00005300: 6170 7065 6e64 2870 3176 6563 2c20 6d61  append(p1vec, ma
+00005310: 675f 6365 6e2c 2061 7869 733d 3029 0d0a  g_cen, axis=0)..
+00005320: 2020 2020 2020 2020 7031 6d61 6720 3d20          p1mag = 
+00005330: 6e70 2e61 7070 656e 6428 7031 6d61 672c  np.append(p1mag,
+00005340: 206e 702e 7265 7065 6174 2863 6966 5f6d   np.repeat(cif_m
+00005350: 6167 5b6e 5d2c 206c 656e 2863 656e 5f75  ag[n], len(cen_u
+00005360: 7677 2929 290d 0a20 2020 2020 2020 2070  vw)))..        p
+00005370: 3174 696d 203d 206e 702e 6170 7065 6e64  1tim = np.append
+00005380: 2870 3174 696d 2c20 7379 6d74 696d 706f  (p1tim, symtimpo
+00005390: 7329 0d0a 2020 2020 2020 2020 7031 7479  s)..        p1ty
+000053a0: 7020 3d20 6e70 2e61 7070 656e 6428 7031  p = np.append(p1
+000053b0: 7479 702c 206e 702e 7265 7065 6174 2865  typ, np.repeat(e
+000053c0: 6c65 6d65 6e74 5b6e 5d2c 206c 656e 2863  lement[n], len(c
+000053d0: 656e 5f75 7677 2929 290d 0a20 2020 2020  en_uvw)))..     
+000053e0: 2020 2070 316c 626c 203d 206e 702e 6170     p1lbl = np.ap
+000053f0: 7065 6e64 2870 316c 626c 2c20 6e70 2e72  pend(p1lbl, np.r
+00005400: 6570 6561 7428 6c61 6265 6c5b 6e5d 2c20  epeat(label[n], 
+00005410: 6c65 6e28 6365 6e5f 7576 7729 2929 0d0a  len(cen_uvw)))..
+00005420: 2020 2020 2020 2020 7031 6f63 6320 3d20          p1occ = 
+00005430: 6e70 2e61 7070 656e 6428 7031 6f63 632c  np.append(p1occ,
+00005440: 206e 702e 7265 7065 6174 286f 6363 5b6e   np.repeat(occ[n
+00005450: 5d2c 206c 656e 2863 656e 5f75 7677 2929  ], len(cen_uvw))
+00005460: 290d 0a20 2020 2020 2020 2070 3155 6973  )..        p1Uis
+00005470: 6f20 3d20 6e70 2e61 7070 656e 6428 7031  o = np.append(p1
+00005480: 5569 736f 2c20 6e70 2e72 6570 6561 7428  Uiso, np.repeat(
+00005490: 5569 736f 5b6e 5d2c 206c 656e 2863 656e  Uiso[n], len(cen
+000054a0: 5f75 7677 2929 290d 0a0d 0a20 2020 2023  _uvw)))....    #
+000054b0: 2047 6574 2073 7061 6365 2067 726f 7570   Get space group
+000054c0: 0d0a 2020 2020 6966 2027 5f73 796d 6d65  ..    if '_symme
+000054d0: 7472 795f 7370 6163 655f 6772 6f75 705f  try_space_group_
+000054e0: 6e61 6d65 5f48 2d4d 2720 696e 206b 6579  name_H-M' in key
+000054f0: 733a 0d0a 2020 2020 2020 2020 7370 6163  s:..        spac
+00005500: 6567 726f 7570 203d 2063 6966 7661 6c73  egroup = cifvals
+00005510: 5b27 5f73 796d 6d65 7472 795f 7370 6163  ['_symmetry_spac
+00005520: 655f 6772 6f75 705f 6e61 6d65 5f48 2d4d  e_group_name_H-M
+00005530: 275d 0d0a 2020 2020 656c 6966 2027 5f73  ']..    elif '_s
+00005540: 7061 6365 5f67 726f 7570 5f6e 616d 655f  pace_group_name_
+00005550: 482d 4d5f 616c 7427 2069 6e20 6b65 7973  H-M_alt' in keys
+00005560: 3a0d 0a20 2020 2020 2020 2073 7061 6365  :..        space
+00005570: 6772 6f75 7020 3d20 6369 6676 616c 735b  group = cifvals[
+00005580: 275f 7370 6163 655f 6772 6f75 705f 6e61  '_space_group_na
+00005590: 6d65 5f48 2d4d 5f61 6c74 275d 0d0a 2020  me_H-M_alt']..  
+000055a0: 2020 656c 6966 206c 656e 2873 796d 6f70    elif len(symop
+000055b0: 7329 203d 3d20 313a 0d0a 2020 2020 2020  s) == 1:..      
+000055c0: 2020 7370 6163 6567 726f 7570 203d 2027    spacegroup = '
+000055d0: 5031 270d 0a20 2020 2065 6c73 653a 0d0a  P1'..    else:..
+000055e0: 2020 2020 2020 2020 7370 6163 6567 726f          spacegro
+000055f0: 7570 203d 2027 270d 0a20 2020 2069 6620  up = ''..    if 
+00005600: 275f 7379 6d6d 6574 7279 5f49 6e74 5f54  '_symmetry_Int_T
+00005610: 6162 6c65 735f 6e75 6d62 6572 2720 696e  ables_number' in
+00005620: 206b 6579 733a 0d0a 2020 2020 2020 2020   keys:..        
+00005630: 7367 6e20 3d20 666c 6f61 7428 6369 6676  sgn = float(cifv
+00005640: 616c 735b 275f 7379 6d6d 6574 7279 5f49  als['_symmetry_I
+00005650: 6e74 5f54 6162 6c65 735f 6e75 6d62 6572  nt_Tables_number
+00005660: 275d 290d 0a20 2020 2065 6c69 6620 275f  '])..    elif '_
+00005670: 7370 6163 655f 6772 6f75 705f 4954 5f6e  space_group_IT_n
+00005680: 756d 6265 7227 2069 6e20 6b65 7973 3a0d  umber' in keys:.
+00005690: 0a20 2020 2020 2020 2073 676e 203d 2066  .        sgn = f
+000056a0: 6c6f 6174 2863 6966 7661 6c73 5b27 5f73  loat(cifvals['_s
+000056b0: 7061 6365 5f67 726f 7570 5f49 545f 6e75  pace_group_IT_nu
+000056c0: 6d62 6572 275d 290d 0a20 2020 2065 6c69  mber'])..    eli
+000056d0: 6620 7370 6163 6567 726f 7570 203d 3d20  f spacegroup == 
+000056e0: 2750 3127 3a0d 0a20 2020 2020 2020 2073  'P1':..        s
+000056f0: 676e 203d 2031 0d0a 2020 2020 656c 7365  gn = 1..    else
+00005700: 3a0d 0a20 2020 2020 2020 2073 676e 203d  :..        sgn =
+00005710: 2030 0d0a 0d0a 2020 2020 2320 7072 696e   0....    # prin
+00005720: 7420 6d61 675f 706f 730d 0a20 2020 2023  t mag_pos..    #
+00005730: 2070 7269 6e74 2070 316d 6167 0d0a 2020   print p1mag..  
+00005740: 2020 2320 7072 696e 7420 7031 7665 630d    # print p1vec.
+00005750: 0a20 2020 2023 2070 7269 6e74 2066 672e  .    # print fg.
+00005760: 6d61 6728 7031 7665 6329 0d0a 2020 2020  mag(p1vec)..    
+00005770: 2320 4164 6420 7661 6c75 6573 2074 6f20  # Add values to 
+00005780: 7468 6520 6469 6374 0d0a 2020 2020 6372  the dict..    cr
+00005790: 7973 203d 207b 7d0d 0a20 2020 2063 7279  ys = {}..    cry
+000057a0: 735b 2766 696c 656e 616d 6527 5d20 3d20  s['filename'] = 
+000057b0: 6369 6676 616c 735b 2746 696c 656e 616d  cifvals['Filenam
+000057c0: 6527 5d0d 0a20 2020 2063 7279 735b 276e  e']..    crys['n
+000057d0: 616d 6527 5d20 3d20 6369 6676 616c 735b  ame'] = cifvals[
+000057e0: 2746 696c 6554 6974 6c65 275d 0d0a 2020  'FileTitle']..  
+000057f0: 2020 6372 7973 5b27 756e 6974 2076 6563    crys['unit vec
+00005800: 746f 7227 5d20 3d20 5556 0d0a 2020 2020  tor'] = UV..    
+00005810: 6372 7973 5b27 7061 7265 6e74 2063 656c  crys['parent cel
+00005820: 6c27 5d20 3d20 5556 0d0a 2020 2020 6372  l'] = UV..    cr
+00005830: 7973 5b27 6f72 6967 696e 275d 203d 206e  ys['origin'] = n
+00005840: 702e 6172 7261 7928 5b5b 302e 2c20 302e  p.array([[0., 0.
+00005850: 2c20 302e 5d5d 290d 0a20 2020 2063 7279  , 0.]])..    cry
+00005860: 735b 2773 796d 6d65 7472 7927 5d20 3d20  s['symmetry'] = 
+00005870: 7379 6d6f 7073 0d0a 2020 2020 6372 7973  symops..    crys
+00005880: 5b27 6174 6f6d 2074 7970 6527 5d20 3d20  ['atom type'] = 
+00005890: 7031 7479 700d 0a20 2020 2063 7279 735b  p1typ..    crys[
+000058a0: 2761 746f 6d20 6c61 6265 6c27 5d20 3d20  'atom label'] = 
+000058b0: 7031 6c62 6c0d 0a20 2020 2063 7279 735b  p1lbl..    crys[
+000058c0: 2761 746f 6d20 706f 7369 7469 6f6e 275d  'atom position']
+000058d0: 203d 2070 3170 6f73 0d0a 2020 2020 6372   = p1pos..    cr
+000058e0: 7973 5b27 6174 6f6d 206f 6363 7570 616e  ys['atom occupan
+000058f0: 6379 275d 203d 2070 316f 6363 0d0a 2020  cy'] = p1occ..  
+00005900: 2020 6372 7973 5b27 6174 6f6d 2075 6973    crys['atom uis
+00005910: 6f27 5d20 3d20 7031 5569 736f 0d0a 2020  o'] = p1Uiso..  
+00005920: 2020 6372 7973 5b27 6174 6f6d 2075 616e    crys['atom uan
+00005930: 6973 6f27 5d20 3d20 6e70 2e7a 6572 6f73  iso'] = np.zeros
+00005940: 285b 6c65 6e28 7031 706f 7329 2c20 365d  ([len(p1pos), 6]
+00005950: 290d 0a20 2020 2063 7279 735b 276d 6167  )..    crys['mag
+00005960: 206d 6f6d 656e 7427 5d20 3d20 7031 7665   moment'] = p1ve
+00005970: 630d 0a20 2020 2063 7279 735b 276d 6167  c..    crys['mag
+00005980: 2074 696d 6527 5d20 3d20 7031 7469 6d0d   time'] = p1tim.
+00005990: 0a20 2020 2063 7279 735b 276e 6f72 6d61  .    crys['norma
+000059a0: 6c69 7365 275d 203d 2031 2e0d 0a20 2020  lise'] = 1...   
+000059b0: 2063 7279 735b 276d 6973 6327 5d20 3d20   crys['misc'] = 
+000059c0: 5b65 6c65 6d65 6e74 2c20 6c61 6265 6c2c  [element, label,
+000059d0: 2063 6966 5f70 6f73 2c20 6f63 632c 2055   cif_pos, occ, U
+000059e0: 6973 6f5d 0d0a 2020 2020 6372 7973 5b27  iso]..    crys['
+000059f0: 7370 6163 6520 6772 6f75 7027 5d20 3d20  space group'] = 
+00005a00: 7370 6163 6567 726f 7570 0d0a 2020 2020  spacegroup..    
+00005a10: 6372 7973 5b27 7370 6163 6520 6772 6f75  crys['space grou
+00005a20: 7020 6e75 6d62 6572 275d 203d 2073 676e  p number'] = sgn
+00005a30: 0d0a 2020 2020 6372 7973 5b27 6369 6627  ..    crys['cif'
+00005a40: 5d20 3d20 6369 6676 616c 730d 0a20 2020  ] = cifvals..   
+00005a50: 2072 6574 7572 6e20 6372 7973 0d0a 0d0a   return crys....
+00005a60: 0d0a 6465 6620 7772 6974 655f 6369 6628  ..def write_cif(
+00005a70: 6369 6676 616c 732c 2066 696c 656e 616d  cifvals, filenam
+00005a80: 653d 4e6f 6e65 2c20 636f 6d6d 656e 7473  e=None, comments
+00005a90: 3d4e 6f6e 6529 3a0d 0a20 2020 2022 2222  =None):..    """
+00005aa0: 0d0a 2020 2020 5772 6974 6520 2e63 6966  ..    Write .cif
+00005ab0: 2066 696c 6520 7769 7468 2076 616c 7565   file with value
+00005ac0: 7320 6672 6f6d 2061 2063 6966 2064 6963  s from a cif dic
+00005ad0: 742c 0d0a 2020 2020 4f6e 6c79 2062 6173  t,..    Only bas
+00005ae0: 6963 2069 7465 6d73 2061 7265 2073 6176  ic items are sav
+00005af0: 6564 2c20 7261 7468 6572 2074 6861 6e20  ed, rather than 
+00005b00: 7265 7475 726e 696e 6720 7468 6520 6f72  returning the or
+00005b10: 6769 6e61 6c20 6669 6c65 0d0a 2020 2020  ginal file..    
+00005b20: 3a70 6172 616d 2063 6966 7661 6c73 3a20  :param cifvals: 
+00005b30: 6469 6374 2066 726f 6d20 7265 6164 6369  dict from readci
+00005b40: 660d 0a20 2020 203a 7061 7261 6d20 6669  f..    :param fi
+00005b50: 6c65 6e61 6d65 3a20 6669 6c65 6e61 6d65  lename: filename
+00005b60: 2074 6f20 7772 6974 6520 2875 7365 204e   to write (use N
+00005b70: 6f6e 6520 746f 2072 6574 7572 6e20 7374  one to return st
+00005b80: 7269 6e67 290d 0a20 2020 203a 7061 7261  ring)..    :para
+00005b90: 6d20 636f 6d6d 656e 7473 3a20 7374 7220  m comments: str 
+00005ba0: 636f 6d6d 656e 7473 2074 6f20 7772 6974  comments to writ
+00005bb0: 6520 746f 2074 6865 2066 696c 6520 746f  e to the file to
+00005bc0: 7020 6d61 7474 6572 0d0a 2020 2020 3a72  p matter..    :r
+00005bd0: 6574 7572 6e3a 204e 6f6e 650d 0a20 2020  eturn: None..   
+00005be0: 2022 2222 0d0a 0d0a 2020 2020 6b65 7973   """....    keys
+00005bf0: 203d 2063 6966 7661 6c73 2e6b 6579 7328   = cifvals.keys(
+00005c00: 290d 0a0d 0a20 2020 2064 6566 2063 6966  )....    def cif
+00005c10: 5f76 616c 7565 286e 616d 6529 3a0d 0a20  _value(name):.. 
+00005c20: 2020 2020 2020 2069 6620 6e61 6d65 2069         if name i
+00005c30: 6e20 6b65 7973 3a0d 0a20 2020 2020 2020  n keys:..       
+00005c40: 2020 2020 2072 6574 7572 6e20 2725 2d34       return '%-4
+00005c50: 3073 2025 2d31 3273 5c6e 2720 2520 286e  0s %-12s\n' % (n
+00005c60: 616d 652c 2063 6966 7661 6c73 5b6e 616d  ame, cifvals[nam
+00005c70: 655d 290d 0a20 2020 2020 2020 2065 6c73  e])..        els
+00005c80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00005c90: 7072 696e 7428 2725 7320 6e6f 7420 696e  print('%s not in
+00005ca0: 2063 6966 2064 6963 7427 2025 206e 616d   cif dict' % nam
+00005cb0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00005cc0: 7265 7475 726e 2027 252d 3430 7320 252d  return '%-40s %-
+00005cd0: 3132 735c 6e27 2025 2028 6e61 6d65 2c20  12s\n' % (name, 
+00005ce0: 273f 2729 0d0a 0d0a 2020 2020 6465 6620  '?')....    def 
+00005cf0: 6369 665f 6c6f 6f70 286e 616d 6573 293a  cif_loop(names):
+00005d00: 0d0a 2020 2020 2020 2020 6e61 6d65 7320  ..        names 
+00005d10: 3d20 5b6e 616d 6520 666f 7220 6e61 6d65  = [name for name
+00005d20: 2069 6e20 6e61 6d65 7320 6966 206e 616d   in names if nam
+00005d30: 6520 696e 206b 6579 735d 0d0a 2020 2020  e in keys]..    
+00005d40: 2020 2020 6966 206c 656e 286e 616d 6573      if len(names
+00005d50: 2920 3d3d 2030 3a0d 0a20 2020 2020 2020  ) == 0:..       
+00005d60: 2020 2020 2070 7269 6e74 2827 4c6f 6f70       print('Loop
+00005d70: 2049 7465 6d73 206e 6f74 2069 6e20 6369   Items not in ci
+00005d80: 6620 6469 6374 2729 0d0a 2020 2020 2020  f dict')..      
+00005d90: 2020 2020 2020 7265 7475 726e 2027 270d        return ''.
+00005da0: 0a20 2020 2020 2020 206f 7574 203d 2027  .        out = '
+00005db0: 6c6f 6f70 5f5c 6e27 0d0a 2020 2020 2020  loop_\n'..      
+00005dc0: 2020 6f75 7420 2b3d 2027 272e 6a6f 696e    out += ''.join
+00005dd0: 285b 2725 735c 6e27 2025 206e 616d 6520  (['%s\n' % name 
+00005de0: 666f 7220 6e61 6d65 2069 6e20 6e61 6d65  for name in name
+00005df0: 735d 290d 0a20 2020 2020 2020 2076 616c  s])..        val
+00005e00: 7320 3d20 5b63 6966 7661 6c73 5b6e 616d  s = [cifvals[nam
+00005e10: 655d 2066 6f72 206e 616d 6520 696e 206e  e] for name in n
+00005e20: 616d 6573 5d0d 0a20 2020 2020 2020 2066  ames]..        f
+00005e30: 6f72 2076 616c 5f6c 696e 6520 696e 207a  or val_line in z
+00005e40: 6970 282a 7661 6c73 293a 0d0a 2020 2020  ip(*vals):..    
+00005e50: 2020 2020 2020 2020 6f75 7420 2b3d 2027          out += '
+00005e60: 2027 2e6a 6f69 6e28 5b27 252d 3132 7327   '.join(['%-12s'
+00005e70: 2025 2076 616c 2066 6f72 2076 616c 2069   % val for val i
+00005e80: 6e20 7661 6c5f 6c69 6e65 5d29 0d0a 2020  n val_line])..  
+00005e90: 2020 2020 2020 2020 2020 6f75 7420 2b3d            out +=
+00005ea0: 2027 5c6e 270d 0a20 2020 2020 2020 2072   '\n'..        r
+00005eb0: 6574 7572 6e20 6f75 740d 0a0d 0a20 2020  eturn out....   
+00005ec0: 2023 2054 6f70 204d 6174 7465 720d 0a20   # Top Matter.. 
+00005ed0: 2020 2063 203d 2027 232d 2d2d 2d2d 2d2d     c = '#-------
+00005ee0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00005ef0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00005f00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00005f10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00005f20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d5c 6e27  -------------\n'
-00005f30: 0d0a 2020 2020 6320 2b3d 2027 2320 2020  ..    c += '#   
-00005f40: 4372 7973 7461 6c20 5374 7275 6374 7572  Crystal Structur
-00005f50: 653a 2025 735c 6e27 2025 2028 6369 6676  e: %s\n' % (cifv
-00005f60: 616c 735b 2746 696c 6554 6974 6c65 275d  als['FileTitle']
-00005f70: 2069 6620 2746 696c 6554 6974 6c65 2720   if 'FileTitle' 
-00005f80: 696e 206b 6579 7320 656c 7365 2027 2729  in keys else '')
-00005f90: 0d0a 2020 2020 6320 2b3d 2027 232d 2d2d  ..    c += '#---
+00005f10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d5c  ---------------\
+00005f20: 6e27 0d0a 2020 2020 6320 2b3d 2027 2320  n'..    c += '# 
+00005f30: 2020 4372 7973 7461 6c20 5374 7275 6374    Crystal Struct
+00005f40: 7572 653a 2025 735c 6e27 2025 2028 6369  ure: %s\n' % (ci
+00005f50: 6676 616c 735b 2746 696c 6554 6974 6c65  fvals['FileTitle
+00005f60: 275d 2069 6620 2746 696c 6554 6974 6c65  '] if 'FileTitle
+00005f70: 2720 696e 206b 6579 7320 656c 7365 2027  ' in keys else '
+00005f80: 2729 0d0a 2020 2020 6320 2b3d 2027 232d  ')..    c += '#-
+00005f90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00005fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00005fb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00005fc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00005fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00005fe0: 2d2d 2d5c 6e27 0d0a 2020 2020 6320 2b3d  ---\n'..    c +=
-00005ff0: 2027 2320 4349 4620 6372 6561 7465 6420   '# CIF created 
-00006000: 696e 2044 616e 735f 4469 6666 7261 6374  in Dans_Diffract
-00006010: 696f 6e5c 6e27 0d0a 2020 2020 6320 2b3d  ion\n'..    c +=
-00006020: 2027 2320 4f72 6967 696e 616c 2063 6966   '# Original cif
-00006030: 3a5c 6e23 2025 735c 6e27 2025 2028 6369  :\n# %s\n' % (ci
-00006040: 6676 616c 735b 2746 696c 656e 616d 6527  fvals['Filename'
-00006050: 5d20 6966 2027 4669 6c65 6e61 6d65 2720  ] if 'Filename' 
-00006060: 696e 206b 6579 7320 656c 7365 2027 4e6f  in keys else 'No
-00006070: 6e65 2729 0d0a 0d0a 2020 2020 2320 436f  ne')....    # Co
-00006080: 6d6d 656e 7473 0d0a 2020 2020 6320 2b3d  mments..    c +=
-00006090: 2027 2320 436f 6d6d 656e 7473 3a5c 6e27   '# Comments:\n'
-000060a0: 0d0a 2020 2020 6966 2063 6f6d 6d65 6e74  ..    if comment
-000060b0: 733a 0d0a 2020 2020 2020 2020 636f 6d6d  s:..        comm
-000060c0: 656e 7473 203d 2063 6f6d 6d65 6e74 732e  ents = comments.
-000060d0: 7370 6c69 7428 275c 6e27 290d 0a20 2020  split('\n')..   
-000060e0: 2020 2020 2063 202b 3d20 2727 2e6a 6f69       c += ''.joi
-000060f0: 6e28 5b27 2320 2573 5c6e 2720 2520 636f  n(['# %s\n' % co
-00006100: 6d6d 656e 7420 666f 7220 636f 6d6d 656e  mment for commen
-00006110: 7420 696e 2063 6f6d 6d65 6e74 735d 290d  t in comments]).
-00006120: 0a0d 0a20 2020 2023 2043 7279 7374 616c  ...    # Crystal
-00006130: 2044 6174 610d 0a20 2020 2063 202b 3d20   Data..    c += 
-00006140: 275c 6e64 6174 615f 5752 4954 4543 4946  '\ndata_WRITECIF
-00006150: 5c6e 270d 0a20 2020 2063 202b 3d20 6369  \n'..    c += ci
-00006160: 665f 7661 6c75 6528 275f 6368 656d 6963  f_value('_chemic
-00006170: 616c 5f6e 616d 655f 6d69 6e65 7261 6c27  al_name_mineral'
-00006180: 290d 0a20 2020 2063 202b 3d20 6369 665f  )..    c += cif_
-00006190: 7661 6c75 6528 275f 6368 656d 6963 616c  value('_chemical
-000061a0: 5f6e 616d 655f 636f 6d6d 6f6e 2729 0d0a  _name_common')..
-000061b0: 2020 2020 6320 2b3d 2063 6966 5f76 616c      c += cif_val
-000061c0: 7565 2827 5f70 645f 7068 6173 655f 6e61  ue('_pd_phase_na
-000061d0: 6d65 2729 0d0a 2020 2020 6320 2b3d 2063  me')..    c += c
-000061e0: 6966 5f76 616c 7565 2827 5f63 6865 6d69  if_value('_chemi
-000061f0: 6361 6c5f 666f 726d 756c 615f 7375 6d27  cal_formula_sum'
-00006200: 290d 0a20 2020 2063 202b 3d20 6369 665f  )..    c += cif_
-00006210: 7661 6c75 6528 275f 6368 656d 6963 616c  value('_chemical
-00006220: 5f66 6f72 6d75 6c61 5f77 6569 6768 7427  _formula_weight'
-00006230: 290d 0a20 2020 2063 202b 3d20 6369 665f  )..    c += cif_
-00006240: 7661 6c75 6528 275f 6365 6c6c 5f66 6f72  value('_cell_for
-00006250: 6d75 6c61 5f75 6e69 7473 5f5a 2729 0d0a  mula_units_Z')..
-00006260: 0d0a 2020 2020 2320 4365 6c6c 2069 6e66  ..    # Cell inf
-00006270: 6f0d 0a20 2020 2063 202b 3d20 275c 6e23  o..    c += '\n#
-00006280: 2043 656c 6c20 696e 666f 5c6e 270d 0a20   Cell info\n'.. 
-00006290: 2020 2063 202b 3d20 6369 665f 7661 6c75     c += cif_valu
-000062a0: 6528 275f 6365 6c6c 5f6c 656e 6774 685f  e('_cell_length_
-000062b0: 6127 290d 0a20 2020 2063 202b 3d20 6369  a')..    c += ci
-000062c0: 665f 7661 6c75 6528 275f 6365 6c6c 5f6c  f_value('_cell_l
-000062d0: 656e 6774 685f 6227 290d 0a20 2020 2063  ength_b')..    c
-000062e0: 202b 3d20 6369 665f 7661 6c75 6528 275f   += cif_value('_
-000062f0: 6365 6c6c 5f6c 656e 6774 685f 6327 290d  cell_length_c').
-00006300: 0a20 2020 2063 202b 3d20 6369 665f 7661  .    c += cif_va
-00006310: 6c75 6528 275f 6365 6c6c 5f61 6e67 6c65  lue('_cell_angle
-00006320: 5f61 6c70 6861 2729 0d0a 2020 2020 6320  _alpha')..    c 
-00006330: 2b3d 2063 6966 5f76 616c 7565 2827 5f63  += cif_value('_c
-00006340: 656c 6c5f 616e 676c 655f 6265 7461 2729  ell_angle_beta')
-00006350: 0d0a 2020 2020 6320 2b3d 2063 6966 5f76  ..    c += cif_v
-00006360: 616c 7565 2827 5f63 656c 6c5f 616e 676c  alue('_cell_angl
-00006370: 655f 6761 6d6d 6127 290d 0a20 2020 2063  e_gamma')..    c
-00006380: 202b 3d20 6369 665f 7661 6c75 6528 275f   += cif_value('_
-00006390: 6365 6c6c 5f76 6f6c 756d 6527 290d 0a0d  cell_volume')...
-000063a0: 0a20 2020 2023 2053 796d 6d65 7472 7920  .    # Symmetry 
-000063b0: 696e 666f 0d0a 2020 2020 6320 2b3d 2027  info..    c += '
-000063c0: 5c6e 2320 5379 6d6d 6574 7279 2069 6e66  \n# Symmetry inf
-000063d0: 6f5c 6e27 0d0a 2020 2020 6320 2b3d 2063  o\n'..    c += c
-000063e0: 6966 5f76 616c 7565 2827 5f73 796d 6d65  if_value('_symme
-000063f0: 7472 795f 6365 6c6c 5f73 6574 7469 6e67  try_cell_setting
-00006400: 2729 0d0a 2020 2020 6320 2b3d 2063 6966  ')..    c += cif
-00006410: 5f76 616c 7565 2827 5f73 796d 6d65 7472  _value('_symmetr
-00006420: 795f 7370 6163 655f 6772 6f75 705f 6e61  y_space_group_na
-00006430: 6d65 5f48 2d4d 2729 0d0a 2020 2020 6320  me_H-M')..    c 
-00006440: 2b3d 2063 6966 5f76 616c 7565 2827 5f73  += cif_value('_s
-00006450: 796d 6d65 7472 795f 7370 6163 655f 6772  ymmetry_space_gr
-00006460: 6f75 705f 6e61 6d65 5f48 616c 6c27 290d  oup_name_Hall').
-00006470: 0a20 2020 2063 202b 3d20 6369 665f 7661  .    c += cif_va
-00006480: 6c75 6528 275f 7379 6d6d 6574 7279 5f49  lue('_symmetry_I
-00006490: 6e74 5f54 6162 6c65 735f 6e75 6d62 6572  nt_Tables_number
-000064a0: 2729 0d0a 2020 2020 6320 2b3d 2027 5c6e  ')..    c += '\n
-000064b0: 270d 0a20 2020 2063 202b 3d20 6369 665f  '..    c += cif_
-000064c0: 6c6f 6f70 285b 275f 7370 6163 655f 6772  loop(['_space_gr
-000064d0: 6f75 705f 7379 6d6f 705f 6f70 6572 6174  oup_symop_operat
-000064e0: 696f 6e5f 7879 7a27 2c20 275f 7379 6d6d  ion_xyz', '_symm
-000064f0: 6574 7279 5f65 7175 6976 5f70 6f73 5f61  etry_equiv_pos_a
-00006500: 735f 7879 7a27 5d29 0d0a 0d0a 2020 2020  s_xyz'])....    
-00006510: 2320 4174 6f6d 2069 6e66 6f0d 0a20 2020  # Atom info..   
-00006520: 2063 202b 3d20 275c 6e23 2041 746f 6d20   c += '\n# Atom 
-00006530: 696e 666f 5c6e 270d 0a20 2020 2063 202b  info\n'..    c +
-00006540: 3d20 6369 665f 6c6f 6f70 285b 0d0a 2020  = cif_loop([..  
-00006550: 2020 2020 2020 275f 6174 6f6d 5f73 6974        '_atom_sit
-00006560: 655f 6c61 6265 6c27 2c0d 0a20 2020 2020  e_label',..     
-00006570: 2020 2027 5f61 746f 6d5f 7369 7465 5f74     '_atom_site_t
-00006580: 7970 655f 7379 6d62 6f6c 272c 0d0a 2020  ype_symbol',..  
-00006590: 2020 2020 2020 2320 275f 6174 6f6d 5f73        # '_atom_s
-000065a0: 6974 655f 7379 6d6d 6574 7279 5f6d 756c  ite_symmetry_mul
-000065b0: 7469 706c 6963 6974 7927 2c0d 0a20 2020  tiplicity',..   
-000065c0: 2020 2020 2023 2027 5f61 746f 6d5f 7369       # '_atom_si
-000065d0: 7465 5f57 7963 6b6f 6666 5f73 796d 626f  te_Wyckoff_symbo
-000065e0: 6c27 2c0d 0a20 2020 2020 2020 2027 5f61  l',..        '_a
-000065f0: 746f 6d5f 7369 7465 5f66 7261 6374 5f78  tom_site_fract_x
-00006600: 272c 0d0a 2020 2020 2020 2020 275f 6174  ',..        '_at
-00006610: 6f6d 5f73 6974 655f 6672 6163 745f 7927  om_site_fract_y'
-00006620: 2c0d 0a20 2020 2020 2020 2027 5f61 746f  ,..        '_ato
-00006630: 6d5f 7369 7465 5f66 7261 6374 5f7a 272c  m_site_fract_z',
-00006640: 0d0a 2020 2020 2020 2020 275f 6174 6f6d  ..        '_atom
-00006650: 5f73 6974 655f 555f 6973 6f5f 6f72 5f65  _site_U_iso_or_e
-00006660: 7175 6976 272c 0d0a 2020 2020 2020 2020  quiv',..        
-00006670: 275f 6174 6f6d 5f73 6974 655f 6f63 6375  '_atom_site_occu
-00006680: 7061 6e63 7927 2c0d 0a20 2020 205d 290d  pancy',..    ]).
-00006690: 0a0d 0a20 2020 2069 6620 6669 6c65 6e61  ...    if filena
-000066a0: 6d65 2069 7320 4e6f 6e65 3a0d 0a20 2020  me is None:..   
-000066b0: 2020 2020 2072 6574 7572 6e20 630d 0a0d       return c...
-000066c0: 0a20 2020 2066 696c 656e 616d 652c 2065  .    filename, e
-000066d0: 7874 656e 7369 6f6e 203d 206f 732e 7061  xtension = os.pa
-000066e0: 7468 2e73 706c 6974 6578 7428 6669 6c65  th.splitext(file
-000066f0: 6e61 6d65 290d 0a20 2020 2066 696c 656e  name)..    filen
-00006700: 616d 6520 3d20 6669 6c65 6e61 6d65 202b  ame = filename +
-00006710: 2027 2e63 6966 270d 0a20 2020 2077 6974   '.cif'..    wit
-00006720: 6820 6f70 656e 2866 696c 656e 616d 652c  h open(filename,
-00006730: 2027 7774 2729 2061 7320 663a 0d0a 2020   'wt') as f:..  
-00006740: 2020 2020 2020 662e 7772 6974 6528 6329        f.write(c)
-00006750: 0d0a 2020 2020 7072 696e 7428 2743 4946  ..    print('CIF
-00006760: 2077 7269 7474 656e 2074 6f3a 2025 7327   written to: %s'
-00006770: 2025 2066 696c 656e 616d 6529 0d0a 0d0a   % filename)....
-00006780: 0d0a 6465 6620 7772 6974 655f 6d63 6966  ..def write_mcif
-00006790: 2863 6966 7661 6c73 2c20 6669 6c65 6e61  (cifvals, filena
-000067a0: 6d65 3d4e 6f6e 652c 2063 6f6d 6d65 6e74  me=None, comment
-000067b0: 733d 4e6f 6e65 293a 0d0a 2020 2020 2222  s=None):..    ""
-000067c0: 220d 0a20 2020 2057 7269 7465 206d 6167  "..    Write mag
-000067d0: 6e65 7469 6320 2e6d 6369 6620 6669 6c65  netic .mcif file
-000067e0: 2077 6974 6820 7661 6c75 6573 2066 726f   with values fro
-000067f0: 6d20 6120 6369 6620 6469 6374 2c0d 0a20  m a cif dict,.. 
-00006800: 2020 204f 6e6c 7920 6261 7369 6320 6974     Only basic it
-00006810: 656d 7320 6172 6520 7361 7665 642c 2072  ems are saved, r
-00006820: 6174 6865 7220 7468 616e 2072 6574 7572  ather than retur
-00006830: 6e69 6e67 2074 6865 206f 7269 6769 6e61  ning the origina
-00006840: 6c20 6669 6c65 0d0a 2020 2020 3a70 6172  l file..    :par
-00006850: 616d 2063 6966 7661 6c73 3a20 6469 6374  am cifvals: dict
-00006860: 2066 726f 6d20 7265 6164 6369 660d 0a20   from readcif.. 
-00006870: 2020 203a 7061 7261 6d20 6669 6c65 6e61     :param filena
-00006880: 6d65 3a20 6669 6c65 6e61 6d65 2074 6f20  me: filename to 
-00006890: 7772 6974 6520 2875 7365 204e 6f6e 6520  write (use None 
-000068a0: 746f 2072 6574 7572 6e20 7374 7269 6e67  to return string
-000068b0: 290d 0a20 2020 203a 7061 7261 6d20 636f  )..    :param co
-000068c0: 6d6d 656e 7473 3a20 7374 7220 636f 6d6d  mments: str comm
-000068d0: 656e 7473 2074 6f20 7772 6974 6520 746f  ents to write to
-000068e0: 2074 6865 2066 696c 6520 746f 7020 6d61   the file top ma
-000068f0: 7474 6572 0d0a 2020 2020 3a72 6574 7572  tter..    :retur
-00006900: 6e3a 204e 6f6e 650d 0a20 2020 2022 2222  n: None..    """
-00006910: 0d0a 0d0a 2020 2020 6b65 7973 203d 2063  ....    keys = c
-00006920: 6966 7661 6c73 2e6b 6579 7328 290d 0a0d  ifvals.keys()...
-00006930: 0a20 2020 2064 6566 2063 6966 5f76 616c  .    def cif_val
-00006940: 7565 286e 616d 6529 3a0d 0a20 2020 2020  ue(name):..     
-00006950: 2020 2069 6620 6e61 6d65 2069 6e20 6b65     if name in ke
-00006960: 7973 3a0d 0a20 2020 2020 2020 2020 2020  ys:..           
-00006970: 2072 6574 7572 6e20 2725 2d34 3073 2025   return '%-40s %
-00006980: 2d31 3273 5c6e 2720 2520 286e 616d 652c  -12s\n' % (name,
-00006990: 2063 6966 7661 6c73 5b6e 616d 655d 290d   cifvals[name]).
-000069a0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000069b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000069c0: 7428 2725 7320 6e6f 7420 696e 2063 6966  t('%s not in cif
-000069d0: 2064 6963 7427 2025 206e 616d 6529 0d0a   dict' % name)..
-000069e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000069f0: 726e 2027 252d 3430 7320 252d 3132 735c  rn '%-40s %-12s\
-00006a00: 6e27 2025 2028 6e61 6d65 2c20 273f 2729  n' % (name, '?')
-00006a10: 0d0a 0d0a 2020 2020 6465 6620 6369 665f  ....    def cif_
-00006a20: 6c6f 6f70 286e 616d 6573 293a 0d0a 2020  loop(names):..  
-00006a30: 2020 2020 2020 636e 616d 6573 203d 205b        cnames = [
-00006a40: 6e61 6d65 2066 6f72 206e 616d 6520 696e  name for name in
-00006a50: 206e 616d 6573 2069 6620 6e61 6d65 2069   names if name i
-00006a60: 6e20 6b65 7973 5d0d 0a20 2020 2020 2020  n keys]..       
-00006a70: 2069 6620 6c65 6e28 636e 616d 6573 2920   if len(cnames) 
-00006a80: 3c20 6c65 6e28 6e61 6d65 7329 3a0d 0a20  < len(names):.. 
-00006a90: 2020 2020 2020 2020 2020 2069 6e61 6d65             iname
-00006aa0: 7320 3d20 5b6e 616d 6520 666f 7220 6e61  s = [name for na
-00006ab0: 6d65 2069 6e20 6e61 6d65 7320 6966 206e  me in names if n
-00006ac0: 616d 6520 6e6f 7420 696e 206b 6579 735d  ame not in keys]
-00006ad0: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00006ae0: 696e 7428 274c 6f6f 7020 4974 656d 7320  int('Loop Items 
-00006af0: 6e6f 7420 696e 2063 6966 2064 6963 743a  not in cif dict:
-00006b00: 2025 7327 2025 2069 6e61 6d65 7329 0d0a   %s' % inames)..
-00006b10: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
-00006b20: 6e61 6d65 7329 203d 3d20 303a 0d0a 2020  names) == 0:..  
-00006b30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00006b40: 2027 270d 0a20 2020 2020 2020 206f 7574   ''..        out
-00006b50: 203d 2027 6c6f 6f70 5f5c 6e27 0d0a 2020   = 'loop_\n'..  
-00006b60: 2020 2020 2020 6f75 7420 2b3d 2027 272e        out += ''.
-00006b70: 6a6f 696e 285b 2725 735c 6e27 2025 206e  join(['%s\n' % n
-00006b80: 616d 6520 666f 7220 6e61 6d65 2069 6e20  ame for name in 
-00006b90: 636e 616d 6573 5d29 0d0a 2020 2020 2020  cnames])..      
-00006ba0: 2020 7661 6c73 203d 205b 6369 6676 616c    vals = [cifval
-00006bb0: 735b 6e61 6d65 5d20 666f 7220 6e61 6d65  s[name] for name
-00006bc0: 2069 6e20 636e 616d 6573 5d0d 0a20 2020   in cnames]..   
-00006bd0: 2020 2020 2066 6f72 2076 616c 5f6c 696e       for val_lin
-00006be0: 6520 696e 207a 6970 282a 7661 6c73 293a  e in zip(*vals):
-00006bf0: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-00006c00: 7420 2b3d 2027 2027 2e6a 6f69 6e28 5b27  t += ' '.join(['
-00006c10: 252d 3132 7327 2025 2076 616c 2066 6f72  %-12s' % val for
-00006c20: 2076 616c 2069 6e20 7661 6c5f 6c69 6e65   val in val_line
-00006c30: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00006c40: 6f75 7420 2b3d 2027 5c6e 270d 0a20 2020  out += '\n'..   
-00006c50: 2020 2020 2072 6574 7572 6e20 6f75 740d       return out.
-00006c60: 0a0d 0a20 2020 2023 2054 6f70 204d 6174  ...    # Top Mat
-00006c70: 7465 720d 0a20 2020 2063 203d 2027 232d  ter..    c = '#-
+00005fd0: 2d2d 2d2d 2d5c 6e27 0d0a 2020 2020 6320  -----\n'..    c 
+00005fe0: 2b3d 2027 2320 4349 4620 6372 6561 7465  += '# CIF create
+00005ff0: 6420 696e 2044 616e 735f 4469 6666 7261  d in Dans_Diffra
+00006000: 6374 696f 6e5c 6e27 0d0a 2020 2020 6320  ction\n'..    c 
+00006010: 2b3d 2027 2320 4f72 6967 696e 616c 2063  += '# Original c
+00006020: 6966 3a5c 6e23 2025 735c 6e27 2025 2028  if:\n# %s\n' % (
+00006030: 6369 6676 616c 735b 2746 696c 656e 616d  cifvals['Filenam
+00006040: 6527 5d20 6966 2027 4669 6c65 6e61 6d65  e'] if 'Filename
+00006050: 2720 696e 206b 6579 7320 656c 7365 2027  ' in keys else '
+00006060: 4e6f 6e65 2729 0d0a 0d0a 2020 2020 2320  None')....    # 
+00006070: 436f 6d6d 656e 7473 0d0a 2020 2020 6320  Comments..    c 
+00006080: 2b3d 2027 2320 436f 6d6d 656e 7473 3a5c  += '# Comments:\
+00006090: 6e27 0d0a 2020 2020 6966 2063 6f6d 6d65  n'..    if comme
+000060a0: 6e74 733a 0d0a 2020 2020 2020 2020 636f  nts:..        co
+000060b0: 6d6d 656e 7473 203d 2063 6f6d 6d65 6e74  mments = comment
+000060c0: 732e 7370 6c69 7428 275c 6e27 290d 0a20  s.split('\n').. 
+000060d0: 2020 2020 2020 2063 202b 3d20 2727 2e6a         c += ''.j
+000060e0: 6f69 6e28 5b27 2320 2573 5c6e 2720 2520  oin(['# %s\n' % 
+000060f0: 636f 6d6d 656e 7420 666f 7220 636f 6d6d  comment for comm
+00006100: 656e 7420 696e 2063 6f6d 6d65 6e74 735d  ent in comments]
+00006110: 290d 0a0d 0a20 2020 2023 2043 7279 7374  )....    # Cryst
+00006120: 616c 2044 6174 610d 0a20 2020 2063 202b  al Data..    c +
+00006130: 3d20 275c 6e64 6174 615f 5752 4954 4543  = '\ndata_WRITEC
+00006140: 4946 5c6e 270d 0a20 2020 2063 202b 3d20  IF\n'..    c += 
+00006150: 6369 665f 7661 6c75 6528 275f 6368 656d  cif_value('_chem
+00006160: 6963 616c 5f6e 616d 655f 6d69 6e65 7261  ical_name_minera
+00006170: 6c27 290d 0a20 2020 2063 202b 3d20 6369  l')..    c += ci
+00006180: 665f 7661 6c75 6528 275f 6368 656d 6963  f_value('_chemic
+00006190: 616c 5f6e 616d 655f 636f 6d6d 6f6e 2729  al_name_common')
+000061a0: 0d0a 2020 2020 6320 2b3d 2063 6966 5f76  ..    c += cif_v
+000061b0: 616c 7565 2827 5f70 645f 7068 6173 655f  alue('_pd_phase_
+000061c0: 6e61 6d65 2729 0d0a 2020 2020 6320 2b3d  name')..    c +=
+000061d0: 2063 6966 5f76 616c 7565 2827 5f63 6865   cif_value('_che
+000061e0: 6d69 6361 6c5f 666f 726d 756c 615f 7375  mical_formula_su
+000061f0: 6d27 290d 0a20 2020 2063 202b 3d20 6369  m')..    c += ci
+00006200: 665f 7661 6c75 6528 275f 6368 656d 6963  f_value('_chemic
+00006210: 616c 5f66 6f72 6d75 6c61 5f77 6569 6768  al_formula_weigh
+00006220: 7427 290d 0a20 2020 2063 202b 3d20 6369  t')..    c += ci
+00006230: 665f 7661 6c75 6528 275f 6365 6c6c 5f66  f_value('_cell_f
+00006240: 6f72 6d75 6c61 5f75 6e69 7473 5f5a 2729  ormula_units_Z')
+00006250: 0d0a 0d0a 2020 2020 2320 4365 6c6c 2069  ....    # Cell i
+00006260: 6e66 6f0d 0a20 2020 2063 202b 3d20 275c  nfo..    c += '\
+00006270: 6e23 2043 656c 6c20 696e 666f 5c6e 270d  n# Cell info\n'.
+00006280: 0a20 2020 2063 202b 3d20 6369 665f 7661  .    c += cif_va
+00006290: 6c75 6528 275f 6365 6c6c 5f6c 656e 6774  lue('_cell_lengt
+000062a0: 685f 6127 290d 0a20 2020 2063 202b 3d20  h_a')..    c += 
+000062b0: 6369 665f 7661 6c75 6528 275f 6365 6c6c  cif_value('_cell
+000062c0: 5f6c 656e 6774 685f 6227 290d 0a20 2020  _length_b')..   
+000062d0: 2063 202b 3d20 6369 665f 7661 6c75 6528   c += cif_value(
+000062e0: 275f 6365 6c6c 5f6c 656e 6774 685f 6327  '_cell_length_c'
+000062f0: 290d 0a20 2020 2063 202b 3d20 6369 665f  )..    c += cif_
+00006300: 7661 6c75 6528 275f 6365 6c6c 5f61 6e67  value('_cell_ang
+00006310: 6c65 5f61 6c70 6861 2729 0d0a 2020 2020  le_alpha')..    
+00006320: 6320 2b3d 2063 6966 5f76 616c 7565 2827  c += cif_value('
+00006330: 5f63 656c 6c5f 616e 676c 655f 6265 7461  _cell_angle_beta
+00006340: 2729 0d0a 2020 2020 6320 2b3d 2063 6966  ')..    c += cif
+00006350: 5f76 616c 7565 2827 5f63 656c 6c5f 616e  _value('_cell_an
+00006360: 676c 655f 6761 6d6d 6127 290d 0a20 2020  gle_gamma')..   
+00006370: 2063 202b 3d20 6369 665f 7661 6c75 6528   c += cif_value(
+00006380: 275f 6365 6c6c 5f76 6f6c 756d 6527 290d  '_cell_volume').
+00006390: 0a0d 0a20 2020 2023 2053 796d 6d65 7472  ...    # Symmetr
+000063a0: 7920 696e 666f 0d0a 2020 2020 6320 2b3d  y info..    c +=
+000063b0: 2027 5c6e 2320 5379 6d6d 6574 7279 2069   '\n# Symmetry i
+000063c0: 6e66 6f5c 6e27 0d0a 2020 2020 6320 2b3d  nfo\n'..    c +=
+000063d0: 2063 6966 5f76 616c 7565 2827 5f73 796d   cif_value('_sym
+000063e0: 6d65 7472 795f 6365 6c6c 5f73 6574 7469  metry_cell_setti
+000063f0: 6e67 2729 0d0a 2020 2020 6320 2b3d 2063  ng')..    c += c
+00006400: 6966 5f76 616c 7565 2827 5f73 796d 6d65  if_value('_symme
+00006410: 7472 795f 7370 6163 655f 6772 6f75 705f  try_space_group_
+00006420: 6e61 6d65 5f48 2d4d 2729 0d0a 2020 2020  name_H-M')..    
+00006430: 6320 2b3d 2063 6966 5f76 616c 7565 2827  c += cif_value('
+00006440: 5f73 796d 6d65 7472 795f 7370 6163 655f  _symmetry_space_
+00006450: 6772 6f75 705f 6e61 6d65 5f48 616c 6c27  group_name_Hall'
+00006460: 290d 0a20 2020 2063 202b 3d20 6369 665f  )..    c += cif_
+00006470: 7661 6c75 6528 275f 7379 6d6d 6574 7279  value('_symmetry
+00006480: 5f49 6e74 5f54 6162 6c65 735f 6e75 6d62  _Int_Tables_numb
+00006490: 6572 2729 0d0a 2020 2020 6320 2b3d 2027  er')..    c += '
+000064a0: 5c6e 270d 0a20 2020 2063 202b 3d20 6369  \n'..    c += ci
+000064b0: 665f 6c6f 6f70 285b 275f 7370 6163 655f  f_loop(['_space_
+000064c0: 6772 6f75 705f 7379 6d6f 705f 6f70 6572  group_symop_oper
+000064d0: 6174 696f 6e5f 7879 7a27 2c20 275f 7379  ation_xyz', '_sy
+000064e0: 6d6d 6574 7279 5f65 7175 6976 5f70 6f73  mmetry_equiv_pos
+000064f0: 5f61 735f 7879 7a27 5d29 0d0a 0d0a 2020  _as_xyz'])....  
+00006500: 2020 2320 4174 6f6d 2069 6e66 6f0d 0a20    # Atom info.. 
+00006510: 2020 2063 202b 3d20 275c 6e23 2041 746f     c += '\n# Ato
+00006520: 6d20 696e 666f 5c6e 270d 0a20 2020 2063  m info\n'..    c
+00006530: 202b 3d20 6369 665f 6c6f 6f70 285b 0d0a   += cif_loop([..
+00006540: 2020 2020 2020 2020 275f 6174 6f6d 5f73          '_atom_s
+00006550: 6974 655f 6c61 6265 6c27 2c0d 0a20 2020  ite_label',..   
+00006560: 2020 2020 2027 5f61 746f 6d5f 7369 7465       '_atom_site
+00006570: 5f74 7970 655f 7379 6d62 6f6c 272c 0d0a  _type_symbol',..
+00006580: 2020 2020 2020 2020 2320 275f 6174 6f6d          # '_atom
+00006590: 5f73 6974 655f 7379 6d6d 6574 7279 5f6d  _site_symmetry_m
+000065a0: 756c 7469 706c 6963 6974 7927 2c0d 0a20  ultiplicity',.. 
+000065b0: 2020 2020 2020 2023 2027 5f61 746f 6d5f         # '_atom_
+000065c0: 7369 7465 5f57 7963 6b6f 6666 5f73 796d  site_Wyckoff_sym
+000065d0: 626f 6c27 2c0d 0a20 2020 2020 2020 2027  bol',..        '
+000065e0: 5f61 746f 6d5f 7369 7465 5f66 7261 6374  _atom_site_fract
+000065f0: 5f78 272c 0d0a 2020 2020 2020 2020 275f  _x',..        '_
+00006600: 6174 6f6d 5f73 6974 655f 6672 6163 745f  atom_site_fract_
+00006610: 7927 2c0d 0a20 2020 2020 2020 2027 5f61  y',..        '_a
+00006620: 746f 6d5f 7369 7465 5f66 7261 6374 5f7a  tom_site_fract_z
+00006630: 272c 0d0a 2020 2020 2020 2020 275f 6174  ',..        '_at
+00006640: 6f6d 5f73 6974 655f 555f 6973 6f5f 6f72  om_site_U_iso_or
+00006650: 5f65 7175 6976 272c 0d0a 2020 2020 2020  _equiv',..      
+00006660: 2020 275f 6174 6f6d 5f73 6974 655f 6f63    '_atom_site_oc
+00006670: 6375 7061 6e63 7927 2c0d 0a20 2020 205d  cupancy',..    ]
+00006680: 290d 0a0d 0a20 2020 2069 6620 6669 6c65  )....    if file
+00006690: 6e61 6d65 2069 7320 4e6f 6e65 3a0d 0a20  name is None:.. 
+000066a0: 2020 2020 2020 2072 6574 7572 6e20 630d         return c.
+000066b0: 0a0d 0a20 2020 2066 696c 656e 616d 652c  ...    filename,
+000066c0: 2065 7874 656e 7369 6f6e 203d 206f 732e   extension = os.
+000066d0: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
+000066e0: 6c65 6e61 6d65 290d 0a20 2020 2066 696c  lename)..    fil
+000066f0: 656e 616d 6520 3d20 6669 6c65 6e61 6d65  ename = filename
+00006700: 202b 2027 2e63 6966 270d 0a20 2020 2077   + '.cif'..    w
+00006710: 6974 6820 6f70 656e 2866 696c 656e 616d  ith open(filenam
+00006720: 652c 2027 7774 2729 2061 7320 663a 0d0a  e, 'wt') as f:..
+00006730: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+00006740: 6329 0d0a 2020 2020 7072 696e 7428 2743  c)..    print('C
+00006750: 4946 2077 7269 7474 656e 2074 6f3a 2025  IF written to: %
+00006760: 7327 2025 2066 696c 656e 616d 6529 0d0a  s' % filename)..
+00006770: 0d0a 0d0a 6465 6620 7772 6974 655f 6d63  ....def write_mc
+00006780: 6966 2863 6966 7661 6c73 2c20 6669 6c65  if(cifvals, file
+00006790: 6e61 6d65 3d4e 6f6e 652c 2063 6f6d 6d65  name=None, comme
+000067a0: 6e74 733d 4e6f 6e65 293a 0d0a 2020 2020  nts=None):..    
+000067b0: 2222 220d 0a20 2020 2057 7269 7465 206d  """..    Write m
+000067c0: 6167 6e65 7469 6320 2e6d 6369 6620 6669  agnetic .mcif fi
+000067d0: 6c65 2077 6974 6820 7661 6c75 6573 2066  le with values f
+000067e0: 726f 6d20 6120 6369 6620 6469 6374 2c0d  rom a cif dict,.
+000067f0: 0a20 2020 204f 6e6c 7920 6261 7369 6320  .    Only basic 
+00006800: 6974 656d 7320 6172 6520 7361 7665 642c  items are saved,
+00006810: 2072 6174 6865 7220 7468 616e 2072 6574   rather than ret
+00006820: 7572 6e69 6e67 2074 6865 206f 7269 6769  urning the origi
+00006830: 6e61 6c20 6669 6c65 0d0a 2020 2020 3a70  nal file..    :p
+00006840: 6172 616d 2063 6966 7661 6c73 3a20 6469  aram cifvals: di
+00006850: 6374 2066 726f 6d20 7265 6164 6369 660d  ct from readcif.
+00006860: 0a20 2020 203a 7061 7261 6d20 6669 6c65  .    :param file
+00006870: 6e61 6d65 3a20 6669 6c65 6e61 6d65 2074  name: filename t
+00006880: 6f20 7772 6974 6520 2875 7365 204e 6f6e  o write (use Non
+00006890: 6520 746f 2072 6574 7572 6e20 7374 7269  e to return stri
+000068a0: 6e67 290d 0a20 2020 203a 7061 7261 6d20  ng)..    :param 
+000068b0: 636f 6d6d 656e 7473 3a20 7374 7220 636f  comments: str co
+000068c0: 6d6d 656e 7473 2074 6f20 7772 6974 6520  mments to write 
+000068d0: 746f 2074 6865 2066 696c 6520 746f 7020  to the file top 
+000068e0: 6d61 7474 6572 0d0a 2020 2020 3a72 6574  matter..    :ret
+000068f0: 7572 6e3a 204e 6f6e 650d 0a20 2020 2022  urn: None..    "
+00006900: 2222 0d0a 0d0a 2020 2020 6b65 7973 203d  ""....    keys =
+00006910: 2063 6966 7661 6c73 2e6b 6579 7328 290d   cifvals.keys().
+00006920: 0a0d 0a20 2020 2064 6566 2063 6966 5f76  ...    def cif_v
+00006930: 616c 7565 286e 616d 6529 3a0d 0a20 2020  alue(name):..   
+00006940: 2020 2020 2069 6620 6e61 6d65 2069 6e20       if name in 
+00006950: 6b65 7973 3a0d 0a20 2020 2020 2020 2020  keys:..         
+00006960: 2020 2072 6574 7572 6e20 2725 2d34 3073     return '%-40s
+00006970: 2025 2d31 3273 5c6e 2720 2520 286e 616d   %-12s\n' % (nam
+00006980: 652c 2063 6966 7661 6c73 5b6e 616d 655d  e, cifvals[name]
+00006990: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+000069a0: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+000069b0: 696e 7428 2725 7320 6e6f 7420 696e 2063  int('%s not in c
+000069c0: 6966 2064 6963 7427 2025 206e 616d 6529  if dict' % name)
+000069d0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+000069e0: 7475 726e 2027 252d 3430 7320 252d 3132  turn '%-40s %-12
+000069f0: 735c 6e27 2025 2028 6e61 6d65 2c20 273f  s\n' % (name, '?
+00006a00: 2729 0d0a 0d0a 2020 2020 6465 6620 6369  ')....    def ci
+00006a10: 665f 6c6f 6f70 286e 616d 6573 293a 0d0a  f_loop(names):..
+00006a20: 2020 2020 2020 2020 636e 616d 6573 203d          cnames =
+00006a30: 205b 6e61 6d65 2066 6f72 206e 616d 6520   [name for name 
+00006a40: 696e 206e 616d 6573 2069 6620 6e61 6d65  in names if name
+00006a50: 2069 6e20 6b65 7973 5d0d 0a20 2020 2020   in keys]..     
+00006a60: 2020 2069 6620 6c65 6e28 636e 616d 6573     if len(cnames
+00006a70: 2920 3c20 6c65 6e28 6e61 6d65 7329 3a0d  ) < len(names):.
+00006a80: 0a20 2020 2020 2020 2020 2020 2069 6e61  .            ina
+00006a90: 6d65 7320 3d20 5b6e 616d 6520 666f 7220  mes = [name for 
+00006aa0: 6e61 6d65 2069 6e20 6e61 6d65 7320 6966  name in names if
+00006ab0: 206e 616d 6520 6e6f 7420 696e 206b 6579   name not in key
+00006ac0: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
+00006ad0: 7072 696e 7428 274c 6f6f 7020 4974 656d  print('Loop Item
+00006ae0: 7320 6e6f 7420 696e 2063 6966 2064 6963  s not in cif dic
+00006af0: 743a 2025 7327 2025 2069 6e61 6d65 7329  t: %s' % inames)
+00006b00: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00006b10: 2863 6e61 6d65 7329 203d 3d20 303a 0d0a  (cnames) == 0:..
+00006b20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006b30: 726e 2027 270d 0a20 2020 2020 2020 206f  rn ''..        o
+00006b40: 7574 203d 2027 6c6f 6f70 5f5c 6e27 0d0a  ut = 'loop_\n'..
+00006b50: 2020 2020 2020 2020 6f75 7420 2b3d 2027          out += '
+00006b60: 272e 6a6f 696e 285b 2725 735c 6e27 2025  '.join(['%s\n' %
+00006b70: 206e 616d 6520 666f 7220 6e61 6d65 2069   name for name i
+00006b80: 6e20 636e 616d 6573 5d29 0d0a 2020 2020  n cnames])..    
+00006b90: 2020 2020 7661 6c73 203d 205b 6369 6676      vals = [cifv
+00006ba0: 616c 735b 6e61 6d65 5d20 666f 7220 6e61  als[name] for na
+00006bb0: 6d65 2069 6e20 636e 616d 6573 5d0d 0a20  me in cnames].. 
+00006bc0: 2020 2020 2020 2066 6f72 2076 616c 5f6c         for val_l
+00006bd0: 696e 6520 696e 207a 6970 282a 7661 6c73  ine in zip(*vals
+00006be0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00006bf0: 6f75 7420 2b3d 2027 2027 2e6a 6f69 6e28  out += ' '.join(
+00006c00: 5b27 252d 3132 7327 2025 2076 616c 2066  ['%-12s' % val f
+00006c10: 6f72 2076 616c 2069 6e20 7661 6c5f 6c69  or val in val_li
+00006c20: 6e65 5d29 0d0a 2020 2020 2020 2020 2020  ne])..          
+00006c30: 2020 6f75 7420 2b3d 2027 5c6e 270d 0a20    out += '\n'.. 
+00006c40: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
+00006c50: 740d 0a0d 0a20 2020 2023 2054 6f70 204d  t....    # Top M
+00006c60: 6174 7465 720d 0a20 2020 2063 203d 2027  atter..    c = '
+00006c70: 232d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  #---------------
 00006c80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00006c90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00006ca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006cb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006cc0: 2d2d 2d2d 2d5c 6e27 0d0a 2020 2020 6320  -----\n'..    c 
-00006cd0: 2b3d 2027 2320 2020 4372 7973 7461 6c20  += '#   Crystal 
-00006ce0: 5374 7275 6374 7572 653a 2025 735c 6e27  Structure: %s\n'
-00006cf0: 2025 2028 6369 6676 616c 735b 2746 696c   % (cifvals['Fil
-00006d00: 6554 6974 6c65 275d 2069 6620 2746 696c  eTitle'] if 'Fil
-00006d10: 6554 6974 6c65 2720 696e 206b 6579 7320  eTitle' in keys 
-00006d20: 656c 7365 2027 2729 0d0a 2020 2020 6320  else '')..    c 
-00006d30: 2b3d 2027 232d 2d2d 2d2d 2d2d 2d2d 2d2d  += '#-----------
+00006cb0: 2d2d 2d2d 2d2d 2d5c 6e27 0d0a 2020 2020  -------\n'..    
+00006cc0: 6320 2b3d 2027 2320 2020 4372 7973 7461  c += '#   Crysta
+00006cd0: 6c20 5374 7275 6374 7572 653a 2025 735c  l Structure: %s\
+00006ce0: 6e27 2025 2028 6369 6676 616c 735b 2746  n' % (cifvals['F
+00006cf0: 696c 6554 6974 6c65 275d 2069 6620 2746  ileTitle'] if 'F
+00006d00: 696c 6554 6974 6c65 2720 696e 206b 6579  ileTitle' in key
+00006d10: 7320 656c 7365 2027 2729 0d0a 2020 2020  s else '')..    
+00006d20: 6320 2b3d 2027 232d 2d2d 2d2d 2d2d 2d2d  c += '#---------
+00006d30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00006d40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00006d50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006d60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00006d70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d5c 6e27 0d0a  -----------\n'..
-00006d80: 2020 2020 6320 2b3d 2027 2320 4d43 4946      c += '# MCIF
-00006d90: 2063 7265 6174 6564 2069 6e20 4461 6e73   created in Dans
-00006da0: 5f44 6966 6672 6163 7469 6f6e 5c6e 270d  _Diffraction\n'.
-00006db0: 0a20 2020 2063 202b 3d20 2723 204f 7269  .    c += '# Ori
-00006dc0: 6769 6e61 6c20 6369 663a 5c6e 2320 2573  ginal cif:\n# %s
-00006dd0: 5c6e 2720 2520 2863 6966 7661 6c73 5b27  \n' % (cifvals['
-00006de0: 4669 6c65 6e61 6d65 275d 2069 6620 2746  Filename'] if 'F
-00006df0: 696c 656e 616d 6527 2069 6e20 6b65 7973  ilename' in keys
-00006e00: 2065 6c73 6520 274e 6f6e 6527 290d 0a0d   else 'None')...
-00006e10: 0a20 2020 2023 2043 6f6d 6d65 6e74 730d  .    # Comments.
-00006e20: 0a20 2020 2063 202b 3d20 2723 2043 6f6d  .    c += '# Com
-00006e30: 6d65 6e74 733a 5c6e 270d 0a20 2020 2069  ments:\n'..    i
-00006e40: 6620 636f 6d6d 656e 7473 3a0d 0a20 2020  f comments:..   
-00006e50: 2020 2020 2063 6f6d 6d65 6e74 7320 3d20       comments = 
-00006e60: 636f 6d6d 656e 7473 2e73 706c 6974 2827  comments.split('
-00006e70: 5c6e 2729 0d0a 2020 2020 2020 2020 6320  \n')..        c 
-00006e80: 2b3d 2027 272e 6a6f 696e 285b 2723 2025  += ''.join(['# %
-00006e90: 735c 6e27 2025 2063 6f6d 6d65 6e74 2066  s\n' % comment f
-00006ea0: 6f72 2063 6f6d 6d65 6e74 2069 6e20 636f  or comment in co
-00006eb0: 6d6d 656e 7473 5d29 0d0a 0d0a 2020 2020  mments])....    
-00006ec0: 2320 4372 7973 7461 6c20 4461 7461 0d0a  # Crystal Data..
-00006ed0: 2020 2020 6320 2b3d 2027 5c6e 6461 7461      c += '\ndata
-00006ee0: 5f57 5249 5445 4349 465c 6e27 0d0a 2020  _WRITECIF\n'..  
-00006ef0: 2020 6320 2b3d 2063 6966 5f76 616c 7565    c += cif_value
-00006f00: 2827 5f63 6865 6d69 6361 6c5f 6e61 6d65  ('_chemical_name
-00006f10: 5f6d 696e 6572 616c 2729 0d0a 2020 2020  _mineral')..    
-00006f20: 6320 2b3d 2063 6966 5f76 616c 7565 2827  c += cif_value('
-00006f30: 5f63 6865 6d69 6361 6c5f 6e61 6d65 5f63  _chemical_name_c
-00006f40: 6f6d 6d6f 6e27 290d 0a20 2020 2063 202b  ommon')..    c +
-00006f50: 3d20 6369 665f 7661 6c75 6528 275f 7064  = cif_value('_pd
-00006f60: 5f70 6861 7365 5f6e 616d 6527 290d 0a20  _phase_name').. 
-00006f70: 2020 2063 202b 3d20 6369 665f 7661 6c75     c += cif_valu
-00006f80: 6528 275f 6368 656d 6963 616c 5f66 6f72  e('_chemical_for
-00006f90: 6d75 6c61 5f73 756d 2729 0d0a 2020 2020  mula_sum')..    
-00006fa0: 6320 2b3d 2063 6966 5f76 616c 7565 2827  c += cif_value('
-00006fb0: 5f63 6865 6d69 6361 6c5f 666f 726d 756c  _chemical_formul
-00006fc0: 615f 7765 6967 6874 2729 0d0a 2020 2020  a_weight')..    
-00006fd0: 6320 2b3d 2063 6966 5f76 616c 7565 2827  c += cif_value('
-00006fe0: 5f63 656c 6c5f 666f 726d 756c 615f 756e  _cell_formula_un
-00006ff0: 6974 735f 5a27 290d 0a0d 0a20 2020 2023  its_Z')....    #
-00007000: 2043 656c 6c20 696e 666f 0d0a 2020 2020   Cell info..    
-00007010: 6320 2b3d 2027 5c6e 2320 4365 6c6c 2069  c += '\n# Cell i
-00007020: 6e66 6f5c 6e27 0d0a 2020 2020 6320 2b3d  nfo\n'..    c +=
-00007030: 2063 6966 5f76 616c 7565 2827 5f63 656c   cif_value('_cel
-00007040: 6c5f 6c65 6e67 7468 5f61 2729 0d0a 2020  l_length_a')..  
-00007050: 2020 6320 2b3d 2063 6966 5f76 616c 7565    c += cif_value
-00007060: 2827 5f63 656c 6c5f 6c65 6e67 7468 5f62  ('_cell_length_b
-00007070: 2729 0d0a 2020 2020 6320 2b3d 2063 6966  ')..    c += cif
-00007080: 5f76 616c 7565 2827 5f63 656c 6c5f 6c65  _value('_cell_le
-00007090: 6e67 7468 5f63 2729 0d0a 2020 2020 6320  ngth_c')..    c 
-000070a0: 2b3d 2063 6966 5f76 616c 7565 2827 5f63  += cif_value('_c
-000070b0: 656c 6c5f 616e 676c 655f 616c 7068 6127  ell_angle_alpha'
-000070c0: 290d 0a20 2020 2063 202b 3d20 6369 665f  )..    c += cif_
-000070d0: 7661 6c75 6528 275f 6365 6c6c 5f61 6e67  value('_cell_ang
-000070e0: 6c65 5f62 6574 6127 290d 0a20 2020 2063  le_beta')..    c
-000070f0: 202b 3d20 6369 665f 7661 6c75 6528 275f   += cif_value('_
-00007100: 6365 6c6c 5f61 6e67 6c65 5f67 616d 6d61  cell_angle_gamma
-00007110: 2729 0d0a 2020 2020 6320 2b3d 2063 6966  ')..    c += cif
-00007120: 5f76 616c 7565 2827 5f63 656c 6c5f 766f  _value('_cell_vo
-00007130: 6c75 6d65 2729 0d0a 0d0a 2020 2020 2320  lume')....    # 
-00007140: 5379 6d6d 6574 7279 2069 6e66 6f0d 0a20  Symmetry info.. 
-00007150: 2020 2063 202b 3d20 275c 6e23 2053 796d     c += '\n# Sym
-00007160: 6d65 7472 7920 696e 666f 5c6e 270d 0a20  metry info\n'.. 
-00007170: 2020 2063 202b 3d20 6369 665f 7661 6c75     c += cif_valu
-00007180: 6528 275f 7370 6163 655f 6772 6f75 705f  e('_space_group_
-00007190: 6d61 676e 2e6e 756d 6265 725f 424e 5327  magn.number_BNS'
-000071a0: 290d 0a20 2020 2063 202b 3d20 6369 665f  )..    c += cif_
-000071b0: 7661 6c75 6528 275f 7370 6163 655f 6772  value('_space_gr
-000071c0: 6f75 705f 6d61 676e 2e6e 616d 655f 424e  oup_magn.name_BN
-000071d0: 5327 290d 0a20 2020 2063 202b 3d20 275c  S')..    c += '\
-000071e0: 6e27 0d0a 2020 2020 6320 2b3d 2063 6966  n'..    c += cif
-000071f0: 5f6c 6f6f 7028 5b0d 0a20 2020 2020 2020  _loop([..       
-00007200: 2027 5f73 7061 6365 5f67 726f 7570 5f73   '_space_group_s
-00007210: 796d 6f70 5f6d 6167 6e5f 6f70 6572 6174  ymop_magn_operat
-00007220: 696f 6e2e 6964 272c 0d0a 2020 2020 2020  ion.id',..      
-00007230: 2020 275f 7370 6163 655f 6772 6f75 705f    '_space_group_
-00007240: 7379 6d6f 705f 6d61 676e 5f6f 7065 7261  symop_magn_opera
-00007250: 7469 6f6e 2e78 797a 272c 0d0a 2020 2020  tion.xyz',..    
-00007260: 2020 2020 275f 7370 6163 655f 6772 6f75      '_space_grou
-00007270: 705f 7379 6d6f 705f 6d61 676e 5f6f 7065  p_symop_magn_ope
-00007280: 7261 7469 6f6e 2e6d 786d 796d 7a27 2c0d  ration.mxmymz',.
-00007290: 0a20 2020 205d 290d 0a20 2020 2063 202b  .    ])..    c +
-000072a0: 3d20 275c 6e27 0d0a 2020 2020 6320 2b3d  = '\n'..    c +=
-000072b0: 2063 6966 5f6c 6f6f 7028 5b0d 0a20 2020   cif_loop([..   
-000072c0: 2020 2020 2027 5f73 7061 6365 5f67 726f       '_space_gro
-000072d0: 7570 5f73 796d 6f70 5f6d 6167 6e5f 6365  up_symop_magn_ce
-000072e0: 6e74 6572 696e 672e 6964 272c 0d0a 2020  ntering.id',..  
-000072f0: 2020 2020 2020 275f 7370 6163 655f 6772        '_space_gr
-00007300: 6f75 705f 7379 6d6f 705f 6d61 676e 5f63  oup_symop_magn_c
-00007310: 656e 7465 7269 6e67 2e78 797a 272c 0d0a  entering.xyz',..
-00007320: 2020 2020 2020 2020 275f 7370 6163 655f          '_space_
-00007330: 6772 6f75 705f 7379 6d6f 705f 6d61 676e  group_symop_magn
-00007340: 5f63 656e 7465 7269 6e67 2e6d 786d 796d  _centering.mxmym
-00007350: 7a27 2c0d 0a20 2020 205d 290d 0a0d 0a20  z',..    ]).... 
-00007360: 2020 2023 2041 746f 6d20 696e 666f 0d0a     # Atom info..
-00007370: 2020 2020 6320 2b3d 2027 5c6e 2320 4174      c += '\n# At
-00007380: 6f6d 2069 6e66 6f5c 6e27 0d0a 2020 2020  om info\n'..    
-00007390: 6320 2b3d 2063 6966 5f6c 6f6f 7028 5b0d  c += cif_loop([.
-000073a0: 0a20 2020 2020 2020 2027 5f61 746f 6d5f  .        '_atom_
-000073b0: 7369 7465 5f6c 6162 656c 272c 0d0a 2020  site_label',..  
-000073c0: 2020 2020 2020 275f 6174 6f6d 5f73 6974        '_atom_sit
-000073d0: 655f 7479 7065 5f73 796d 626f 6c27 2c0d  e_type_symbol',.
-000073e0: 0a20 2020 2020 2020 2023 2027 5f61 746f  .        # '_ato
-000073f0: 6d5f 7369 7465 5f73 796d 6d65 7472 795f  m_site_symmetry_
-00007400: 6d75 6c74 6970 6c69 6369 7479 272c 0d0a  multiplicity',..
-00007410: 2020 2020 2020 2020 2320 275f 6174 6f6d          # '_atom
-00007420: 5f73 6974 655f 5779 636b 6f66 665f 7379  _site_Wyckoff_sy
-00007430: 6d62 6f6c 272c 0d0a 2020 2020 2020 2020  mbol',..        
-00007440: 275f 6174 6f6d 5f73 6974 655f 6672 6163  '_atom_site_frac
-00007450: 745f 7827 2c0d 0a20 2020 2020 2020 2027  t_x',..        '
-00007460: 5f61 746f 6d5f 7369 7465 5f66 7261 6374  _atom_site_fract
-00007470: 5f79 272c 0d0a 2020 2020 2020 2020 275f  _y',..        '_
-00007480: 6174 6f6d 5f73 6974 655f 6672 6163 745f  atom_site_fract_
-00007490: 7a27 2c0d 0a20 2020 2020 2020 2027 5f61  z',..        '_a
-000074a0: 746f 6d5f 7369 7465 5f55 5f69 736f 5f6f  tom_site_U_iso_o
-000074b0: 725f 6571 7569 7627 2c0d 0a20 2020 2020  r_equiv',..     
-000074c0: 2020 2027 5f61 746f 6d5f 7369 7465 5f6f     '_atom_site_o
-000074d0: 6363 7570 616e 6379 272c 0d0a 2020 2020  ccupancy',..    
-000074e0: 5d29 0d0a 0d0a 2020 2020 2320 4d6f 6d65  ])....    # Mome
-000074f0: 6e74 2069 6e66 6f0d 0a20 2020 2063 202b  nt info..    c +
-00007500: 3d20 275c 6e23 2041 746f 6d20 696e 666f  = '\n# Atom info
-00007510: 5c6e 270d 0a20 2020 2063 202b 3d20 6369  \n'..    c += ci
-00007520: 665f 6c6f 6f70 285b 0d0a 2020 2020 2020  f_loop([..      
-00007530: 2020 275f 6174 6f6d 5f73 6974 655f 6d6f    '_atom_site_mo
-00007540: 6d65 6e74 2e6c 6162 656c 272c 0d0a 2020  ment.label',..  
-00007550: 2020 2020 2020 275f 6174 6f6d 5f73 6974        '_atom_sit
-00007560: 655f 6d6f 6d65 6e74 2e63 7279 7374 616c  e_moment.crystal
-00007570: 6178 6973 5f78 272c 0d0a 2020 2020 2020  axis_x',..      
-00007580: 2020 275f 6174 6f6d 5f73 6974 655f 6d6f    '_atom_site_mo
-00007590: 6d65 6e74 2e63 7279 7374 616c 6178 6973  ment.crystalaxis
-000075a0: 5f79 272c 0d0a 2020 2020 2020 2020 275f  _y',..        '_
-000075b0: 6174 6f6d 5f73 6974 655f 6d6f 6d65 6e74  atom_site_moment
-000075c0: 2e63 7279 7374 616c 6178 6973 5f7a 272c  .crystalaxis_z',
-000075d0: 0d0a 2020 2020 2020 2020 2320 275f 6174  ..        # '_at
-000075e0: 6f6d 5f73 6974 655f 6d6f 6d65 6e74 2e73  om_site_moment.s
-000075f0: 796d 6d66 6f72 6d27 2c0d 0a20 2020 205d  ymmform',..    ]
-00007600: 290d 0a0d 0a20 2020 2069 6620 6669 6c65  )....    if file
-00007610: 6e61 6d65 2069 7320 4e6f 6e65 3a0d 0a20  name is None:.. 
-00007620: 2020 2020 2020 2072 6574 7572 6e20 630d         return c.
-00007630: 0a0d 0a20 2020 2066 696c 656e 616d 652c  ...    filename,
-00007640: 2065 7874 656e 7369 6f6e 203d 206f 732e   extension = os.
-00007650: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
-00007660: 6c65 6e61 6d65 290d 0a20 2020 2066 696c  lename)..    fil
-00007670: 656e 616d 6520 3d20 6669 6c65 6e61 6d65  ename = filename
-00007680: 202b 2027 2e6d 6369 6627 0d0a 2020 2020   + '.mcif'..    
-00007690: 7769 7468 206f 7065 6e28 6669 6c65 6e61  with open(filena
-000076a0: 6d65 2c20 2777 7427 2920 6173 2066 3a0d  me, 'wt') as f:.
-000076b0: 0a20 2020 2020 2020 2066 2e77 7269 7465  .        f.write
-000076c0: 2863 290d 0a20 2020 2070 7269 6e74 2827  (c)..    print('
-000076d0: 4d43 4946 2077 7269 7474 656e 2074 6f3a  MCIF written to:
-000076e0: 2025 7327 2025 2066 696c 656e 616d 6529   %s' % filename)
-000076f0: 0d0a 0d0a 0d0a 272d 2d2d 2d2d 2d2d 2d2d  ......'---------
-00007700: 2d2d 2d2d 2d46 756e 6374 696f 6e73 2074  -----Functions t
-00007710: 6f20 5265 6164 2044 6174 6162 6173 6520  o Read Database 
-00007720: 6669 6c65 732d 2d2d 2d2d 2d2d 2d2d 2d2d  files-----------
-00007730: 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 0d0a 0d0a  -----------'....
-00007740: 0d0a 6465 6620 7265 6164 5f61 746f 6d5f  ..def read_atom_
-00007750: 7072 6f70 6572 7469 6573 5f66 696c 6528  properties_file(
-00007760: 6669 6c65 6469 7229 3a0d 0a20 2020 2022  filedir):..    "
-00007770: 2222 0d0a 2020 2020 5265 6164 7320 7468  ""..    Reads th
-00007780: 6520 7465 7874 2066 696c 6520 2244 616e  e text file "Dan
-00007790: 7320 456c 656d 656e 7420 5072 6f70 6572  s Element Proper
-000077a0: 7469 6573 2e74 7874 220d 0a20 2020 2052  ties.txt"..    R
-000077b0: 6574 7572 6e73 2061 206c 6973 7420 6f66  eturns a list of
-000077c0: 2064 6963 7473 2063 6f6e 7461 696e 696e   dicts containin
-000077d0: 6720 6174 6f6d 6963 2070 726f 7065 7269  g atomic properi
-000077e0: 7465 7320 6672 6f6d 206d 756c 7469 706c  tes from multipl
-000077f0: 6520 736f 7572 6365 730d 0a20 2020 2020  e sources..     
-00007800: 2064 6174 6120 3d20 7265 6164 5f61 746f   data = read_ato
-00007810: 6d5f 7072 6f70 6572 7469 6573 5f66 696c  m_properties_fil
-00007820: 6528 6669 6c65 6469 7229 0d0a 2020 2020  e(filedir)..    
-00007830: 2020 6461 7461 5b32 325d 5b27 456c 656d    data[22]['Elem
-00007840: 656e 7427 5d0d 0a20 2020 203a 7061 7261  ent']..    :para
-00007850: 6d20 6669 6c65 6469 723a 206c 6f63 6174  m filedir: locat
-00007860: 696f 6e20 6f66 2022 4461 6e73 2045 6c65  ion of "Dans Ele
-00007870: 6d65 6e74 2050 726f 7065 7274 6965 732e  ment Properties.
-00007880: 7478 7422 0d0a 2020 2020 3a72 6574 7572  txt"..    :retur
-00007890: 6e3a 205b 6469 6374 2c20 2e2e 2e5d 0d0a  n: [dict, ...]..
-000078a0: 2020 2020 2222 220d 0a20 2020 2077 6974      """..    wit
-000078b0: 6820 6f70 656e 2866 696c 6564 6972 2c20  h open(filedir, 
-000078c0: 2772 7427 2920 6173 2066 3a0d 0a20 2020  'rt') as f:..   
-000078d0: 2020 2020 206c 696e 6573 203d 2066 2e72       lines = f.r
-000078e0: 6561 646c 696e 6573 2829 0d0a 0d0a 2020  eadlines()....  
-000078f0: 2020 6865 6164 203d 204e 6f6e 650d 0a20    head = None.. 
-00007900: 2020 2064 6174 6120 3d20 5b5d 0d0a 2020     data = []..  
-00007910: 2020 666f 7220 6c69 6e65 2069 6e20 6c69    for line in li
-00007920: 6e65 733a 0d0a 2020 2020 2020 2020 2320  nes:..        # 
-00007930: 4865 6164 6572 0d0a 2020 2020 2020 2020  Header..        
-00007940: 6966 2027 2327 2069 6e20 6c69 6e65 3a20  if '#' in line: 
-00007950: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
-00007960: 2020 6966 2068 6561 6420 6973 204e 6f6e    if head is Non
-00007970: 653a 2068 6561 6420 3d20 6c69 6e65 2e73  e: head = line.s
-00007980: 706c 6974 2829 3b20 636f 6e74 696e 7565  plit(); continue
-00007990: 0d0a 2020 2020 2020 2020 2320 4461 7461  ..        # Data
-000079a0: 0d0a 2020 2020 2020 2020 7661 6c73 203d  ..        vals =
-000079b0: 206c 696e 652e 7370 6c69 7428 290d 0a20   line.split().. 
-000079c0: 2020 2020 2020 2065 6c65 6d65 6e74 203d         element =
-000079d0: 207b 7d0d 0a20 2020 2020 2020 2066 6f72   {}..        for
-000079e0: 206e 2069 6e20 7261 6e67 6528 6c65 6e28   n in range(len(
-000079f0: 7661 6c73 2929 3a0d 0a20 2020 2020 2020  vals)):..       
-00007a00: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00007a10: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00007a20: 203d 2069 6e74 2876 616c 735b 6e5d 290d   = int(vals[n]).
-00007a30: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00007a40: 6570 7420 5661 6c75 6545 7272 6f72 3a0d  ept ValueError:.
-00007a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007a60: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00007a70: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00007a80: 203d 2066 6c6f 6174 2876 616c 735b 6e5d   = float(vals[n]
-00007a90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00007aa0: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
-00007ab0: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00007ac0: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00007ad0: 203d 2076 616c 735b 6e5d 0d0a 2020 2020   = vals[n]..    
-00007ae0: 2020 2020 2020 2020 656c 656d 656e 745b          element[
-00007af0: 6865 6164 5b6e 5d5d 203d 2076 616c 7565  head[n]] = value
-00007b00: 0d0a 2020 2020 2020 2020 6461 7461 202b  ..        data +
-00007b10: 3d20 5b65 6c65 6d65 6e74 5d0d 0a20 2020  = [element]..   
-00007b20: 2072 6574 7572 6e20 6461 7461 0d0a 0d0a   return data....
-00007b30: 0d0a 6465 6620 6174 6f6d 5f70 726f 7065  ..def atom_prope
-00007b40: 7274 6965 7328 656c 656d 656e 7473 3d4e  rties(elements=N
-00007b50: 6f6e 652c 2066 6965 6c64 733d 4e6f 6e65  one, fields=None
-00007b60: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
-00007b70: 204c 6f61 6473 2074 6865 2061 746f 6d69   Loads the atomi
-00007b80: 6320 7072 6f70 6572 7469 6573 206f 6620  c properties of 
-00007b90: 6120 7061 7274 6963 756c 6172 2061 746f  a particular ato
-00007ba0: 6d20 6672 6f6d 2061 2064 6174 6162 6173  m from a databas
-00007bb0: 650d 0a20 2020 2041 746f 6d69 6320 7072  e..    Atomic pr
-00007bc0: 6f70 6572 7469 6573 2c20 7363 6174 7465  operties, scatte
-00007bd0: 7269 6e67 206c 656e 6774 6873 2c20 666f  ring lengths, fo
-00007be0: 726d 2066 6163 746f 7273 2061 6e64 2061  rm factors and a
-00007bf0: 6273 6f72 7074 696f 6e20 6564 6765 7320  bsorption edges 
-00007c00: 666f 7220 656c 656d 656e 7473 2075 7074  for elements upt
-00007c10: 6f20 616e 6420 696e 636c 7564 696e 6720  o and including 
-00007c20: 5572 616e 6975 6d2e 0d0a 2020 2020 5661  Uranium...    Va
-00007c30: 6c75 6573 2061 7265 2074 616b 656e 2066  lues are taken f
-00007c40: 726f 6d20 7661 7269 6f75 7320 6f6e 6c69  rom various onli
-00007c50: 6e65 2073 6f75 7263 6573 2c20 7365 6520  ne sources, see 
-00007c60: 6461 7461 2f52 4541 444d 452e 6d64 2066  data/README.md f
-00007c70: 6f72 206d 6f72 6520 6465 7461 696c 732e  or more details.
-00007c80: 0d0a 0d0a 2020 2020 5573 6167 653a 0d0a  ....    Usage:..
-00007c90: 2020 2020 2020 2020 2020 2020 4120 3d20              A = 
-00007ca0: 6174 6f6d 5f70 726f 7065 7274 6965 7328  atom_properties(
-00007cb0: 2920 3e3e 2072 6574 7572 6e73 2073 7472  ) >> returns str
-00007cc0: 7563 7475 7265 6420 6172 7261 7920 6f66  uctured array of
-00007cd0: 2061 6c6c 2070 726f 7065 7274 6965 7320   all properties 
-00007ce0: 666f 7220 616c 6c20 6174 6f6d 7320 415b  for all atoms A[
-00007cf0: 305d 5b27 456c 656d 656e 7427 5d3d 2748  0]['Element']='H
-00007d00: 270d 0a20 2020 2020 2020 2020 2020 2041  '..            A
-00007d10: 203d 2061 746f 6d5f 7072 6f70 6572 7469   = atom_properti
-00007d20: 6573 2827 436f 2729 203e 3e20 7265 7475  es('Co') >> retu
-00007d30: 726e 7320 7374 7275 6374 7572 6564 2061  rns structured a
-00007d40: 7272 6179 206f 6620 616c 6c20 7072 6f70  rray of all prop
-00007d50: 6572 7469 6573 2066 6f72 2031 2065 6c65  erties for 1 ele
-00007d60: 6d65 6e74 0d0a 2020 2020 2020 2020 2020  ment..          
-00007d70: 2020 4220 3d20 6174 6f6d 5f70 726f 7065    B = atom_prope
-00007d80: 7274 6965 7328 2743 6f27 2c27 5765 6967  rties('Co','Weig
-00007d90: 6874 2729 203e 3e20 7265 7475 726e 7320  ht') >> returns 
-00007da0: 7265 6775 6c61 7220 3178 3120 6172 7261  regular 1x1 arra
-00007db0: 790d 0a20 2020 2020 2020 2020 2020 2042  y..            B
-00007dc0: 203d 2061 746f 6d5f 7072 6f70 6572 7469   = atom_properti
-00007dd0: 6573 285b 2743 6f27 2c27 4f27 5d2c 2757  es(['Co','O'],'W
-00007de0: 6569 6768 7427 2920 3e3e 2072 6574 7275  eight') >> retru
-00007df0: 6e73 2072 6567 756c 6172 2032 7831 2061  ns regular 2x1 a
-00007e00: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
-00007e10: 2020 4120 3d20 6174 6f6d 5f70 726f 7065    A = atom_prope
-00007e20: 7274 6965 7328 2743 6f27 2c5b 2761 3127  rties('Co',['a1'
-00007e30: 2c27 6231 272c 2761 3227 2c27 6232 272c  ,'b1','a2','b2',
-00007e40: 2761 3327 2c27 6233 272c 2761 3427 2c27  'a3','b3','a4','
-00007e50: 6234 272c 2763 275d 2920 3e3e 2072 6574  b4','c']) >> ret
-00007e60: 7572 6e73 2073 7472 7563 7475 7265 6420  urns structured 
-00007e70: 6172 7261 7920 6f66 2072 6571 7565 7374  array of request
-00007e80: 6564 2070 726f 7065 7274 6965 730d 0a20  ed properties.. 
-00007e90: 2020 2020 2020 2020 2020 2041 203d 2061             A = a
-00007ea0: 746f 6d5f 7072 6f70 6572 7469 6573 285b  tom_properties([
-00007eb0: 2743 6f27 2c27 4f27 5d2c 5b27 5a27 2c27  'Co','O'],['Z','
-00007ec0: 5765 6967 6874 275d 2920 3e3e 2072 6574  Weight']) >> ret
-00007ed0: 7572 6e73 2032 7832 2073 7472 7563 7475  urns 2x2 structu
-00007ee0: 7265 6420 6172 7261 790d 0a0d 0a20 2020  red array....   
-00007ef0: 2041 7661 696c 6162 6c65 2070 726f 7065   Available prope
-00007f00: 7274 6965 733a 0d0a 2020 2020 2020 2020  rties:..        
-00007f10: 4120 3d20 6174 6f6d 5f70 726f 7065 7274  A = atom_propert
-00007f20: 6965 7328 290d 0a20 2020 2020 2020 2070  ies()..        p
-00007f30: 7269 6e74 2841 2e64 7479 7065 2e6e 616d  rint(A.dtype.nam
-00007f40: 6573 290d 0a20 2020 2020 2020 2070 7269  es)..        pri
-00007f50: 6e74 2861 5b32 355d 5b27 456c 656d 656e  nt(a[25]['Elemen
-00007f60: 7427 5d29 0d0a 2020 2020 2020 2020 3e3e  t'])..        >>
-00007f70: 2027 4665 270d 0a0d 0a20 2020 2041 7661   'Fe'....    Ava
-00007f80: 696c 6162 6c65 2069 6e66 6f72 6d61 7469  ilable informati
-00007f90: 6f6e 2069 6e63 6c75 6465 733a 0d0a 2020  on includes:..  
-00007fa0: 2020 2020 2020 2020 5a20 2020 2020 2020          Z       
-00007fb0: 2020 2020 2020 3d20 456c 656d 656e 7420        = Element 
-00007fc0: 6e75 6d62 6572 0d0a 2020 2020 2020 2020  number..        
-00007fd0: 2020 456c 656d 656e 7420 2020 2020 2020    Element       
-00007fe0: 3d20 456c 656d 656e 7420 7379 6d62 6f6c  = Element symbol
-00007ff0: 0d0a 2020 2020 2020 2020 2020 4e61 6d65  ..          Name
-00008000: 2020 2020 2020 2020 2020 3d20 456c 656d            = Elem
-00008010: 656e 7420 6e61 6d65 0d0a 2020 2020 2020  ent name..      
-00008020: 2020 2020 4772 6f75 7020 2020 2020 2020      Group       
-00008030: 2020 3d20 456c 656d 656e 7420 4772 6f75    = Element Grou
-00008040: 7020 6f6e 2070 6572 696f 6469 6320 7461  p on periodic ta
-00008050: 626c 650d 0a20 2020 2020 2020 2020 2050  ble..          P
-00008060: 6572 696f 6420 2020 2020 2020 203d 2045  eriod        = E
-00008070: 6c65 6d65 6e74 2070 6572 696f 6420 6f6e  lement period on
-00008080: 2070 6572 696f 6469 6320 7461 626c 650d   periodic table.
-00008090: 0a20 2020 2020 2020 2020 2042 6c6f 636b  .          Block
-000080a0: 2020 2020 2020 2020 203d 2045 6c65 6d65           = Eleme
-000080b0: 6e74 2065 6c65 6374 726f 6e69 6320 626c  nt electronic bl
-000080c0: 6f63 6b20 2873 2c70 2c64 2c66 290d 0a20  ock (s,p,d,f).. 
-000080d0: 2020 2020 2020 2020 2056 616c 656e 6365           Valence
-000080e0: 4520 2020 2020 203d 204e 756d 6265 7220  E      = Number 
-000080f0: 6f66 2076 616c 656e 6365 2065 6c65 6374  of valence elect
-00008100: 726f 6e73 0d0a 2020 2020 2020 2020 2020  rons..          
-00008110: 436f 6e66 6967 2020 2020 2020 2020 3d20  Config        = 
-00008120: 456c 656d 656e 7420 656c 6563 7472 6f6e  Element electron
-00008130: 6963 206f 7262 6974 616c 2063 6f6e 6669  ic orbital confi
-00008140: 6775 7261 7469 6f6e 0d0a 2020 2020 2020  guration..      
-00008150: 2020 2020 5261 6469 6920 2020 2020 2020      Radii       
-00008160: 2020 3d20 4174 6f6d 6963 2052 6164 6969    = Atomic Radii
-00008170: 2028 706d 290d 0a20 2020 2020 2020 2020   (pm)..         
-00008180: 2057 6569 6768 7420 2020 2020 2020 203d   Weight        =
-00008190: 2053 7461 6e64 6172 6420 6174 6f6d 6963   Standard atomic
-000081a0: 2077 6569 6768 7420 2867 290d 0a20 2020   weight (g)..   
-000081b0: 2020 2020 2020 2043 6f68 5f62 2020 2020         Coh_b    
-000081c0: 2020 2020 203d 2042 6f75 6e64 2063 6f68       = Bound coh
-000081d0: 6572 656e 7420 6e65 7574 726f 6e20 7363  erent neutron sc
-000081e0: 6174 7465 7269 6e67 206c 656e 6774 680d  attering length.
-000081f0: 0a20 2020 2020 2020 2020 2049 6e63 5f62  .          Inc_b
-00008200: 2020 2020 2020 2020 203d 2042 6f75 6e64           = Bound
-00008210: 2069 6e63 6f68 6572 656e 7420 6e65 7574   incoherent neut
-00008220: 726f 6e20 7363 6174 7465 7269 6e67 206c  ron scattering l
-00008230: 656e 6774 680d 0a20 2020 2020 2020 2020  ength..         
-00008240: 204e 6162 7320 2020 2020 2020 2020 203d   Nabs          =
-00008250: 204e 6575 7472 6f6e 2061 6273 6f72 7074   Neutron absorpt
-00008260: 696f 6e20 636f 6566 6669 6369 656e 740d  ion coefficient.
-00008270: 0a20 2020 2020 2020 2020 204e 7363 6174  .          Nscat
-00008280: 2020 2020 2020 2020 203d 204e 6575 7472           = Neutr
-00008290: 6f6e 2073 6361 7474 6572 696e 6720 636f  on scattering co
-000082a0: 6566 6669 6369 656e 740d 0a20 2020 2020  efficient..     
-000082b0: 2020 2020 2061 3120 2020 2020 2020 2020       a1         
-000082c0: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-000082d0: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-000082e0: 2020 2020 2062 3120 2020 2020 2020 2020       b1         
-000082f0: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-00008300: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008310: 2020 2020 2061 3220 2020 2020 2020 2020       a2         
-00008320: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-00008330: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008340: 2020 2020 2062 3220 2020 2020 2020 2020       b2         
-00008350: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-00008360: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008370: 2020 2020 2061 3320 2020 2020 2020 2020       a3         
-00008380: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-00008390: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-000083a0: 2020 2020 2062 3320 2020 2020 2020 2020       b3         
-000083b0: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-000083c0: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-000083d0: 2020 2020 2061 3420 2020 2020 2020 2020       a4         
-000083e0: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-000083f0: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008400: 2020 2020 2062 3420 2020 2020 2020 2020       b4         
-00008410: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-00008420: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008430: 2020 2020 2063 2020 2020 2020 2020 2020       c          
-00008440: 2020 203d 2045 6c65 6374 726f 6e20 666f     = Electron fo
-00008450: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008460: 2020 2020 206a 305f 4120 2020 2020 2020       j0_A       
-00008470: 2020 203d 204d 6167 6e65 7469 6320 466f     = Magnetic Fo
-00008480: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008490: 2020 2020 206a 305f 6120 2020 2020 2020       j0_a       
-000084a0: 2020 203d 204d 6167 6e65 7469 6320 466f     = Magnetic Fo
-000084b0: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-000084c0: 2020 2020 206a 305f 4220 2020 2020 2020       j0_B       
-000084d0: 2020 203d 204d 6167 6e65 7469 6320 466f     = Magnetic Fo
-000084e0: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-000084f0: 2020 2020 206a 305f 6220 2020 2020 2020       j0_b       
-00008500: 2020 203d 204d 6167 6e65 7469 6320 466f     = Magnetic Fo
-00008510: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008520: 2020 2020 206a 305f 4320 2020 2020 2020       j0_C       
-00008530: 2020 203d 204d 6167 6e65 7469 6320 466f     = Magnetic Fo
-00008540: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008550: 2020 2020 206a 305f 6320 2020 2020 2020       j0_c       
-00008560: 2020 203d 204d 6167 6e65 7469 6320 466f     = Magnetic Fo
-00008570: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-00008580: 2020 2020 206a 305f 4420 2020 2020 2020       j0_D       
-00008590: 2020 203d 204d 6167 6e65 7469 6320 466f     = Magnetic Fo
-000085a0: 726d 2066 6163 746f 720d 0a20 2020 2020  rm factor..     
-000085b0: 2020 2020 204b 2020 2020 2020 2020 2020       K          
-000085c0: 2020 203d 2078 2d72 6179 2061 6273 6f72     = x-ray absor
-000085d0: 7074 696f 6e20 6564 6765 0d0a 2020 2020  ption edge..    
-000085e0: 2020 2020 2020 4c31 2020 2020 2020 2020        L1        
-000085f0: 2020 2020 3d20 782d 7261 7920 6162 736f      = x-ray abso
-00008600: 7270 7469 6f6e 2065 6467 650d 0a20 2020  rption edge..   
-00008610: 2020 2020 2020 204c 3220 2020 2020 2020         L2       
-00008620: 2020 2020 203d 2078 2d72 6179 2061 6273       = x-ray abs
-00008630: 6f72 7074 696f 6e20 6564 6765 0d0a 2020  orption edge..  
-00008640: 2020 2020 2020 2020 4c33 2020 2020 2020          L3      
-00008650: 2020 2020 2020 3d20 782d 7261 7920 6162        = x-ray ab
-00008660: 736f 7270 7469 6f6e 2065 6467 650d 0a20  sorption edge.. 
-00008670: 2020 2020 2020 2020 204d 312e 2e2e 2020           M1...  
-00008680: 2020 2020 2020 203d 2078 2d72 6179 2061         = x-ray a
-00008690: 6273 6f72 7074 696f 6e20 6564 6765 0d0a  bsorption edge..
-000086a0: 2020 2020 2222 220d 0a0d 0a20 2020 2074      """....    t
-000086b0: 7279 3a0d 0a20 2020 2020 2020 2064 6174  ry:..        dat
-000086c0: 6120 3d20 6e70 2e67 656e 6672 6f6d 7478  a = np.genfromtx
-000086d0: 7428 4154 4f4d 4649 4c45 2c20 736b 6970  t(ATOMFILE, skip
-000086e0: 5f68 6561 6465 723d 362c 2064 7479 7065  _header=6, dtype
-000086f0: 3d4e 6f6e 652c 206e 616d 6573 3d54 7275  =None, names=Tru
-00008700: 652c 2065 6e63 6f64 696e 673d 2761 7363  e, encoding='asc
-00008710: 6969 2729 0d0a 2020 2020 6578 6365 7074  ii')..    except
-00008720: 2054 7970 6545 7272 6f72 3a0d 0a20 2020   TypeError:..   
-00008730: 2020 2020 2023 204e 756d 7079 2076 6572       # Numpy ver
-00008740: 7369 6f6e 203c 2031 2e31 340d 0a20 2020  sion < 1.14..   
-00008750: 2020 2020 2064 6174 6120 3d20 6e70 2e67       data = np.g
-00008760: 656e 6672 6f6d 7478 7428 4154 4f4d 4649  enfromtxt(ATOMFI
-00008770: 4c45 2c20 736b 6970 5f68 6561 6465 723d  LE, skip_header=
-00008780: 362c 2064 7479 7065 3d4e 6f6e 652c 206e  6, dtype=None, n
-00008790: 616d 6573 3d54 7275 6529 0d0a 0d0a 2020  ames=True)....  
-000087a0: 2020 6966 2065 6c65 6d65 6e74 7320 6973    if elements is
-000087b0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-000087c0: 2020 2020 2320 656c 656d 656e 7473 206d      # elements m
-000087d0: 7573 7420 6265 2061 206c 6973 7420 652e  ust be a list e.
-000087e0: 672e 205b 2743 6f27 2c27 4f27 5d0d 0a20  g. ['Co','O'].. 
-000087f0: 2020 2020 2020 2065 6c65 6d65 6e74 7320         elements 
-00008800: 3d20 6e70 2e63 6861 722e 6c6f 7765 7228  = np.char.lower(
-00008810: 6e70 2e61 7361 7272 6179 2865 6c65 6d65  np.asarray(eleme
-00008820: 6e74 7329 2e72 6573 6861 7065 282d 3129  nts).reshape(-1)
-00008830: 290d 0a20 2020 2020 2020 2061 6c6c 5f65  )..        all_e
-00008840: 6c65 6d65 6e74 7320 3d20 5b65 6c2e 6c6f  lements = [el.lo
-00008850: 7765 7228 2920 666f 7220 656c 2069 6e20  wer() for el in 
-00008860: 6461 7461 5b27 456c 656d 656e 7427 5d5d  data['Element']]
-00008870: 0d0a 2020 2020 2020 2020 2320 5468 6973  ..        # This
-00008880: 2077 696c 6c20 6572 726f 7220 6966 2074   will error if t
-00008890: 6865 2072 6571 7569 7265 6420 656c 656d  he required elem
-000088a0: 656e 7420 646f 6573 6e27 7420 6578 6973  ent doesn't exis
-000088b0: 740d 0a20 2020 2020 2020 2074 7279 3a0d  t..        try:.
-000088c0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-000088d0: 6578 203d 205b 616c 6c5f 656c 656d 656e  ex = [all_elemen
-000088e0: 7473 2e69 6e64 6578 2865 6c29 2066 6f72  ts.index(el) for
-000088f0: 2065 6c20 696e 2065 6c65 6d65 6e74 735d   el in elements]
-00008900: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-00008910: 2056 616c 7565 4572 726f 7220 6173 2076   ValueError as v
-00008920: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00008930: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-00008940: 2745 6c65 6d65 6e74 206e 6f74 2061 7661  'Element not ava
-00008950: 696c 6162 6c65 3a20 2573 2720 2520 7665  ilable: %s' % ve
-00008960: 290d 0a20 2020 2020 2020 2064 6174 6120  )..        data 
-00008970: 3d20 6461 7461 5b69 6e64 6578 5d0d 0a20  = data[index].. 
-00008980: 2020 2020 2020 2069 6620 6e70 2e61 6e79         if np.any
-00008990: 2864 6174 615b 275a 275d 203e 2039 3229  (data['Z'] > 92)
-000089a0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-000089b0: 7367 203d 2027 456c 656d 656e 7420 2573  sg = 'Element %s
-000089c0: 2064 6f65 7320 6e6f 7420 6861 7665 2063   does not have c
-000089d0: 6f6d 706c 6574 6520 6174 6f6d 6963 2070  omplete atomic p
-000089e0: 726f 7065 7274 6965 732c 2073 6361 7474  roperties, scatt
-000089f0: 6572 696e 6720 6361 6c63 756c 6174 696f  ering calculatio
-00008a00: 6e73 2077 696c 6c20 6265 2069 6e61 6363  ns will be inacc
-00008a10: 7572 6174 652e 270d 0a20 2020 2020 2020  urate.'..       
-00008a20: 2020 2020 2066 6f72 2065 6c20 696e 2064       for el in d
-00008a30: 6174 615b 6461 7461 5b27 5a27 5d20 3e20  ata[data['Z'] > 
-00008a40: 3932 5d3a 0d0a 2020 2020 2020 2020 2020  92]:..          
-00008a50: 2020 2020 2020 7761 726e 286d 7367 2025        warn(msg %
-00008a60: 2065 6c5b 2745 6c65 6d65 6e74 275d 290d   el['Element']).
-00008a70: 0a0d 0a20 2020 2069 6620 6669 656c 6473  ...    if fields
-00008a80: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00008a90: 2020 2072 6574 7572 6e20 6461 7461 0d0a     return data..
-00008aa0: 0d0a 2020 2020 7265 7475 726e 2064 6174  ..    return dat
-00008ab0: 615b 6669 656c 6473 5d0d 0a0d 0a0d 0a64  a[fields]......d
-00008ac0: 6566 2070 7269 6e74 5f61 746f 6d5f 7072  ef print_atom_pr
-00008ad0: 6f70 6572 7469 6573 2865 6c65 6d65 6e74  operties(element
-00008ae0: 733d 4e6f 6e65 293a 0d0a 2020 2020 2222  s=None):..    ""
-00008af0: 220d 0a20 2020 204f 7574 7075 7473 2073  "..    Outputs s
-00008b00: 7472 696e 6720 6f66 2073 746f 7265 6420  tring of stored 
-00008b10: 6174 6f6d 6963 2070 726f 7065 7274 6965  atomic propertie
-00008b20: 730d 0a20 2020 203a 7061 7261 6d20 656c  s..    :param el
-00008b30: 656d 656e 7473 3a20 7374 7220 6f72 206c  ements: str or l
-00008b40: 6973 7420 6f72 204e 6f6e 650d 0a20 2020  ist or None..   
-00008b50: 2020 2020 2020 2020 2073 7472 3a20 2743           str: 'C
-00008b60: 6f27 0d0a 2020 2020 2020 2020 2020 2020  o'..            
-00008b70: 6c69 7374 3a20 5b27 436f 272c 2027 4f27  list: ['Co', 'O'
-00008b80: 5d0d 0a20 2020 203a 7265 7475 726e 3a20  ]..    :return: 
-00008b90: 7374 720d 0a20 2020 2022 2222 0d0a 0d0a  str..    """....
-00008ba0: 2020 2020 7072 6f70 203d 2061 746f 6d5f      prop = atom_
-00008bb0: 7072 6f70 6572 7469 6573 2865 6c65 6d65  properties(eleme
-00008bc0: 6e74 7329 0d0a 2020 2020 6b65 7973 203d  nts)..    keys =
-00008bd0: 2070 726f 702e 6474 7970 652e 6e61 6d65   prop.dtype.name
-00008be0: 730d 0a20 2020 2065 6c65 6e61 6d65 203d  s..    elename =
-00008bf0: 2027 2027 2e6a 6f69 6e28 5b27 2531 3073   ' '.join(['%10s
-00008c00: 2720 2520 656c 6520 666f 7220 656c 6520  ' % ele for ele 
-00008c10: 696e 2070 726f 705b 2745 6c65 6d65 6e74  in prop['Element
-00008c20: 275d 5d29 0d0a 2020 2020 6f75 7420 3d20  ']])..    out = 
-00008c30: 2725 3873 203a 2025 735c 6e27 2025 2028  '%8s : %s\n' % (
-00008c40: 2727 2c20 656c 656e 616d 6529 0d0a 2020  '', elename)..  
-00008c50: 2020 666f 7220 6b65 7920 696e 206b 6579    for key in key
-00008c60: 733a 0d0a 2020 2020 2020 2020 7072 6f70  s:..        prop
-00008c70: 7661 6c20 3d20 2720 272e 6a6f 696e 285b  val = ' '.join([
-00008c80: 2725 3130 7327 2025 2065 6c65 2066 6f72  '%10s' % ele for
-00008c90: 2065 6c65 2069 6e20 7072 6f70 5b6b 6579   ele in prop[key
-00008ca0: 5d5d 290d 0a20 2020 2020 2020 206f 7574  ]])..        out
-00008cb0: 202b 3d20 2725 3873 203a 2025 735c 6e27   += '%8s : %s\n'
-00008cc0: 2025 2028 6b65 792c 2070 726f 7076 616c   % (key, propval
-00008cd0: 290d 0a20 2020 2072 6574 7572 6e20 6f75  )..    return ou
-00008ce0: 740d 0a0d 0a0d 0a64 6566 206e 6575 7472  t......def neutr
-00008cf0: 6f6e 5f73 6361 7474 6572 696e 675f 6c65  on_scattering_le
-00008d00: 6e67 7468 2865 6c65 6d65 6e74 293a 0d0a  ngth(element):..
-00008d10: 2020 2020 2222 220d 0a20 2020 2052 6574      """..    Ret
-00008d20: 7572 6e20 6e65 7574 726f 6e20 7363 6174  urn neutron scat
-00008d30: 7465 7269 6e67 206c 656e 6774 682c 2062  tering length, b
-00008d40: 2c20 696e 2066 6d0d 0a20 2020 2055 7365  , in fm..    Use
-00008d50: 7320 626f 756e 6420 636f 6865 7265 6e74  s bound coherent
-00008d60: 2073 6361 7474 6572 696e 6720 6c65 6e67   scattering leng
-00008d70: 7468 2066 726f 6d20 4e49 5354 0d0a 2020  th from NIST..  
-00008d80: 2020 6874 7470 733a 2f2f 7777 772e 6e63    https://www.nc
-00008d90: 6e72 2e6e 6973 742e 676f 762f 7265 736f  nr.nist.gov/reso
-00008da0: 7572 6365 732f 6e2d 6c65 6e67 7468 732f  urces/n-lengths/
-00008db0: 0d0a 2020 2020 2062 203d 206e 6575 7472  ..     b = neutr
-00008dc0: 6f6e 5f73 6361 7474 6572 696e 675f 6c65  on_scattering_le
-00008dd0: 6e67 7468 2827 436f 2729 0d0a 2020 2020  ngth('Co')..    
-00008de0: 3a70 6172 616d 2065 6c65 6d65 6e74 3a20  :param element: 
-00008df0: 5b6e 2a73 7472 5d20 6c69 7374 206f 7220  [n*str] list or 
-00008e00: 6172 7261 7920 6f66 2065 6c65 6d65 6e74  array of element
-00008e10: 730d 0a20 2020 203a 7265 7475 726e 3a20  s..    :return: 
-00008e20: 5b6e 5d20 6172 7261 7920 6f66 2073 6361  [n] array of sca
-00008e30: 7474 6572 696e 6720 6c65 6e67 7468 730d  ttering lengths.
-00008e40: 0a20 2020 2022 2222 0d0a 2020 2020 6220  .    """..    b 
-00008e50: 3d20 6174 6f6d 5f70 726f 7065 7274 6965  = atom_propertie
-00008e60: 7328 656c 656d 656e 742c 205b 2743 6f68  s(element, ['Coh
-00008e70: 5f62 275d 290d 0a20 2020 2072 6574 7572  _b'])..    retur
-00008e80: 6e20 620d 0a0d 0a0d 0a64 6566 2078 7261  n b......def xra
-00008e90: 795f 7363 6174 7465 7269 6e67 5f66 6163  y_scattering_fac
-00008ea0: 746f 7228 656c 656d 656e 742c 2051 6d61  tor(element, Qma
-00008eb0: 673d 3029 3a0d 0a20 2020 2022 2222 0d0a  g=0):..    """..
-00008ec0: 2020 2020 5265 6164 2058 2d72 6179 2073      Read X-ray s
-00008ed0: 6361 7474 6572 696e 6720 6661 6374 6f72  cattering factor
-00008ee0: 2074 6162 6c65 2c20 6361 6c63 756c 6174   table, calculat
-00008ef0: 6520 6628 7c51 7c29 0d0a 2020 2020 5573  e f(|Q|)..    Us
-00008f00: 6573 2074 6865 2063 6f65 6666 6963 6965  es the coefficie
-00008f10: 6e74 7320 666f 7220 616e 616c 7974 6963  nts for analytic
-00008f20: 616c 2061 7070 726f 7869 6d61 7469 6f6e  al approximation
-00008f30: 2074 6f20 7468 6520 7363 6174 7465 7269   to the scatteri
-00008f40: 6e67 2066 6163 746f 7273 202d 2049 5443  ng factors - ITC
-00008f50: 2c20 7035 3738 2054 6162 6c65 2036 2e31  , p578 Table 6.1
-00008f60: 2e31 2e34 0d0a 2020 2020 2051 6666 203d  .1.4..     Qff =
-00008f70: 2078 7261 795f 7363 6174 7465 7269 6e67   xray_scattering
-00008f80: 5f66 6163 746f 7228 656c 656d 656e 742c  _factor(element,
-00008f90: 2051 6d61 673d 5b30 5d29 0d0a 2020 2020   Qmag=[0])..    
-00008fa0: 3a70 6172 616d 2065 6c65 6d65 6e74 3a20  :param element: 
-00008fb0: 5b6e 2a73 7472 5d20 6c69 7374 206f 7220  [n*str] list or 
-00008fc0: 6172 7261 7920 6f66 2065 6c65 6d65 6e74  array of element
-00008fd0: 730d 0a20 2020 203a 7061 7261 6d20 516d  s..    :param Qm
-00008fe0: 6167 3a20 5b6d 5d20 6172 7261 7920 6f66  ag: [m] array of
-00008ff0: 2077 6176 6576 6563 746f 7220 6469 7374   wavevector dist
-00009000: 616e 6365 2c20 696e 2041 5e2d 310d 0a20  ance, in A^-1.. 
-00009010: 2020 203a 7265 7475 726e 3a20 5b6d 2a6e     :return: [m*n
-00009020: 5d20 6172 7261 7920 6f66 2073 6361 7474  ] array of scatt
-00009030: 6572 696e 6720 6661 6374 6f72 730d 0a20  ering factors.. 
-00009040: 2020 2022 2222 0d0a 0d0a 2020 2020 2320     """....    # 
-00009050: 516d 6167 2073 686f 756c 6420 6265 2061  Qmag should be a
-00009060: 2031 4420 6172 7261 790d 0a20 2020 2051   1D array..    Q
-00009070: 6d61 6720 3d20 6e70 2e61 7361 7272 6179  mag = np.asarray
-00009080: 2851 6d61 6729 2e72 6573 6861 7065 282d  (Qmag).reshape(-
-00009090: 3129 0d0a 0d0a 2020 2020 636f 6566 203d  1)....    coef =
-000090a0: 2061 746f 6d5f 7072 6f70 6572 7469 6573   atom_properties
-000090b0: 2865 6c65 6d65 6e74 2c20 5b27 6131 272c  (element, ['a1',
-000090c0: 2027 6231 272c 2027 6132 272c 2027 6232   'b1', 'a2', 'b2
-000090d0: 272c 2027 6133 272c 2027 6233 272c 2027  ', 'a3', 'b3', '
-000090e0: 6134 272c 2027 6234 272c 2027 6327 5d29  a4', 'b4', 'c'])
-000090f0: 0d0a 0d0a 2020 2020 5166 6620 3d20 6e70  ....    Qff = np
-00009100: 2e7a 6572 6f73 285b 6c65 6e28 516d 6167  .zeros([len(Qmag
-00009110: 292c 206c 656e 2863 6f65 6629 5d29 0d0a  ), len(coef)])..
-00009120: 0d0a 2020 2020 2320 4c6f 6f70 206f 7665  ..    # Loop ove
-00009130: 7220 656c 656d 656e 7473 0d0a 2020 2020  r elements..    
-00009140: 666f 7220 6e20 696e 2072 616e 6765 286c  for n in range(l
-00009150: 656e 2863 6f65 6629 293a 0d0a 2020 2020  en(coef)):..    
-00009160: 2020 2020 6131 203d 2063 6f65 665b 2761      a1 = coef['a
-00009170: 3127 5d5b 6e5d 0d0a 2020 2020 2020 2020  1'][n]..        
-00009180: 6231 203d 2063 6f65 665b 2762 3127 5d5b  b1 = coef['b1'][
-00009190: 6e5d 0d0a 2020 2020 2020 2020 6132 203d  n]..        a2 =
-000091a0: 2063 6f65 665b 2761 3227 5d5b 6e5d 0d0a   coef['a2'][n]..
-000091b0: 2020 2020 2020 2020 6232 203d 2063 6f65          b2 = coe
-000091c0: 665b 2762 3227 5d5b 6e5d 0d0a 2020 2020  f['b2'][n]..    
-000091d0: 2020 2020 6133 203d 2063 6f65 665b 2761      a3 = coef['a
-000091e0: 3327 5d5b 6e5d 0d0a 2020 2020 2020 2020  3'][n]..        
-000091f0: 6233 203d 2063 6f65 665b 2762 3327 5d5b  b3 = coef['b3'][
-00009200: 6e5d 0d0a 2020 2020 2020 2020 6134 203d  n]..        a4 =
-00009210: 2063 6f65 665b 2761 3427 5d5b 6e5d 0d0a   coef['a4'][n]..
-00009220: 2020 2020 2020 2020 6234 203d 2063 6f65          b4 = coe
-00009230: 665b 2762 3427 5d5b 6e5d 0d0a 2020 2020  f['b4'][n]..    
-00009240: 2020 2020 6320 3d20 636f 6566 5b27 6327      c = coef['c'
-00009250: 5d5b 6e5d 0d0a 0d0a 2020 2020 2020 2020  ][n]....        
-00009260: 2320 4172 7261 7920 6d75 6c74 6970 6c69  # Array multipli
-00009270: 6361 7469 6f6e 206f 7665 7220 516d 6167  cation over Qmag
-00009280: 730d 0a20 2020 2020 2020 2066 203d 2061  s..        f = a
-00009290: 3120 2a20 6e70 2e65 7870 282d 6231 202a  1 * np.exp(-b1 *
-000092a0: 2028 516d 6167 202f 2028 3420 2a20 6e70   (Qmag / (4 * np
-000092b0: 2e70 6929 2920 2a2a 2032 2920 2b20 5c0d  .pi)) ** 2) + \.
-000092c0: 0a20 2020 2020 2020 2020 2020 2061 3220  .            a2 
-000092d0: 2a20 6e70 2e65 7870 282d 6232 202a 2028  * np.exp(-b2 * (
-000092e0: 516d 6167 202f 2028 3420 2a20 6e70 2e70  Qmag / (4 * np.p
-000092f0: 6929 2920 2a2a 2032 2920 2b20 5c0d 0a20  i)) ** 2) + \.. 
-00009300: 2020 2020 2020 2020 2020 2061 3320 2a20             a3 * 
-00009310: 6e70 2e65 7870 282d 6233 202a 2028 516d  np.exp(-b3 * (Qm
-00009320: 6167 202f 2028 3420 2a20 6e70 2e70 6929  ag / (4 * np.pi)
-00009330: 2920 2a2a 2032 2920 2b20 5c0d 0a20 2020  ) ** 2) + \..   
-00009340: 2020 2020 2020 2020 2061 3420 2a20 6e70           a4 * np
-00009350: 2e65 7870 282d 6234 202a 2028 516d 6167  .exp(-b4 * (Qmag
-00009360: 202f 2028 3420 2a20 6e70 2e70 6929 2920   / (4 * np.pi)) 
-00009370: 2a2a 2032 2920 2b20 630d 0a20 2020 2020  ** 2) + c..     
-00009380: 2020 2051 6666 5b3a 2c20 6e5d 203d 2066     Qff[:, n] = f
-00009390: 0d0a 2020 2020 7265 7475 726e 2051 6666  ..    return Qff
-000093a0: 0d0a 0d0a 0d0a 6465 6620 7872 6179 5f73  ......def xray_s
-000093b0: 6361 7474 6572 696e 675f 6661 6374 6f72  cattering_factor
-000093c0: 5f57 6161 734b 6972 6628 656c 656d 656e  _WaasKirf(elemen
-000093d0: 742c 2051 6d61 673d 3029 3a0d 0a20 2020  t, Qmag=0):..   
-000093e0: 2022 2222 0d0a 2020 2020 5265 6164 2058   """..    Read X
-000093f0: 2d72 6179 2073 6361 7474 6572 696e 6720  -ray scattering 
-00009400: 6661 6374 6f72 2074 6162 6c65 2c20 6361  factor table, ca
-00009410: 6c63 756c 6174 6520 6628 7c51 7c29 0d0a  lculate f(|Q|)..
-00009420: 2020 2020 5573 6573 2074 6865 2063 6f65      Uses the coe
-00009430: 6666 6963 6965 6e74 7320 666f 7220 616e  fficients for an
-00009440: 616c 7974 6963 616c 2061 7070 726f 7869  alytical approxi
-00009450: 6d61 7469 6f6e 2074 6f20 7468 6520 7363  mation to the sc
-00009460: 6174 7465 7269 6e67 2066 6163 746f 7273  attering factors
-00009470: 2066 726f 6d3a 0d0a 2020 2020 2020 2022   from:..       "
-00009480: 5761 6173 6d61 6965 7220 616e 6420 4b69  Waasmaier and Ki
-00009490: 7266 656c 2c20 4163 7461 2043 7279 7374  rfel, Acta Cryst
-000094a0: 2e20 2831 3939 3529 2041 3531 2c20 3431  . (1995) A51, 41
-000094b0: 362d 3433 3122 0d0a 2020 2020 4669 6c65  6-431"..    File
-000094c0: 2066 726f 6d20 6874 7470 733a 2f2f 6769   from https://gi
-000094d0: 7468 7562 2e63 6f6d 2f64 6966 6670 792f  thub.com/diffpy/
-000094e0: 6c69 6264 6966 6670 792f 626c 6f62 2f6d  libdiffpy/blob/m
-000094f0: 6173 7465 722f 7372 632f 7275 6e74 696d  aster/src/runtim
-00009500: 652f 6630 5f57 6161 734b 6972 662e 6461  e/f0_WaasKirf.da
-00009510: 740d 0a20 2020 2020 5166 6620 3d20 7872  t..     Qff = xr
-00009520: 6179 5f73 6361 7474 6572 696e 675f 6661  ay_scattering_fa
-00009530: 6374 6f72 5f57 6161 734b 6972 6628 656c  ctor_WaasKirf(el
-00009540: 656d 656e 742c 2051 6d61 673d 5b30 5d29  ement, Qmag=[0])
-00009550: 0d0a 2020 2020 3a70 6172 616d 2065 6c65  ..    :param ele
-00009560: 6d65 6e74 3a20 5b6e 2a73 7472 5d20 6c69  ment: [n*str] li
-00009570: 7374 206f 7220 6172 7261 7920 6f66 2065  st or array of e
-00009580: 6c65 6d65 6e74 730d 0a20 2020 203a 7061  lements..    :pa
-00009590: 7261 6d20 516d 6167 3a20 5b6d 5d20 6172  ram Qmag: [m] ar
-000095a0: 7261 7920 6f66 2077 6176 6576 6563 746f  ray of wavevecto
-000095b0: 7220 6469 7374 616e 6365 2c20 696e 2041  r distance, in A
-000095c0: 5e2d 310d 0a20 2020 203a 7265 7475 726e  ^-1..    :return
-000095d0: 3a20 5b6d 2a6e 5d20 6172 7261 7920 6f66  : [m*n] array of
-000095e0: 2073 6361 7474 6572 696e 6720 6661 6374   scattering fact
-000095f0: 6f72 730d 0a20 2020 2022 2222 0d0a 0d0a  ors..    """....
-00009600: 2020 2020 6669 6c65 6e61 6d65 203d 206f      filename = o
-00009610: 732e 7061 7468 2e6a 6f69 6e28 6461 7461  s.path.join(data
-00009620: 6469 722c 2027 6630 5f57 6161 734b 6972  dir, 'f0_WaasKir
-00009630: 662e 6461 7427 290d 0a20 2020 2064 6174  f.dat')..    dat
-00009640: 6120 3d20 6e70 2e6c 6f61 6474 7874 2866  a = np.loadtxt(f
-00009650: 696c 656e 616d 6529 0d0a 2020 2020 2320  ilename)..    # 
-00009660: 6765 7420 6e61 6d65 730d 0a20 2020 2077  get names..    w
-00009670: 6974 6820 6f70 656e 2866 696c 656e 616d  ith open(filenam
-00009680: 6529 2061 7320 663a 0d0a 2020 2020 2020  e) as f:..      
-00009690: 2020 6c69 6e65 7320 3d20 7265 2e66 696e    lines = re.fin
-000096a0: 6461 6c6c 2827 2353 5c73 2b5c 642b 5c73  dall('#S\s+\d+\s
-000096b0: 2b5b 412d 5a5d 2e2a 3f5c 6e27 2c20 662e  +[A-Z].*?\n', f.
-000096c0: 7265 6164 2829 290d 0a20 2020 2020 2020  read())..       
-000096d0: 2074 6162 6c65 5f6e 616d 6573 203d 205b   table_names = [
-000096e0: 6c69 6e65 5b37 3a5d 2e73 7472 6970 2829  line[7:].strip()
-000096f0: 2066 6f72 206c 696e 6520 696e 206c 696e   for line in lin
-00009700: 6573 5d0d 0a0d 0a20 2020 2023 2051 6d61  es]....    # Qma
-00009710: 6720 7368 6f75 6c64 2062 6520 6120 3144  g should be a 1D
-00009720: 2061 7272 6179 0d0a 2020 2020 516d 6167   array..    Qmag
-00009730: 203d 206e 702e 6173 6172 7261 7928 516d   = np.asarray(Qm
-00009740: 6167 292e 7265 7368 6170 6528 2d31 290d  ag).reshape(-1).
-00009750: 0a20 2020 2065 6c65 6d65 6e74 203d 206e  .    element = n
-00009760: 702e 6173 6172 7261 7928 656c 656d 656e  p.asarray(elemen
-00009770: 742c 2064 7479 7065 3d73 7472 292e 7265  t, dtype=str).re
-00009780: 7368 6170 6528 2d31 290d 0a0d 0a20 2020  shape(-1)....   
-00009790: 2023 2064 6174 6120 7461 626c 653a 2061   # data table: a
-000097a0: 3120 2061 3220 2061 3320 2061 3420 2061  1  a2  a3  a4  a
-000097b0: 3520 2063 2020 6231 2020 6232 2020 6233  5  c  b1  b2  b3
-000097c0: 2020 6234 2020 6235 0d0a 2020 2020 6964    b4  b5..    id
-000097d0: 7820 3d20 5b74 6162 6c65 5f6e 616d 6573  x = [table_names
-000097e0: 2e69 6e64 6578 2865 6c29 2066 6f72 2065  .index(el) for e
-000097f0: 6c20 696e 2065 6c65 6d65 6e74 5d0d 0a20  l in element].. 
-00009800: 2020 2063 6f65 6620 3d20 6461 7461 5b69     coef = data[i
-00009810: 6478 2c20 3a5d 0d0a 0d0a 2020 2020 5166  dx, :]....    Qf
-00009820: 6620 3d20 6e70 2e7a 6572 6f73 285b 6c65  f = np.zeros([le
-00009830: 6e28 516d 6167 292c 206c 656e 2865 6c65  n(Qmag), len(ele
-00009840: 6d65 6e74 295d 290d 0a0d 0a20 2020 2023  ment)])....    #
-00009850: 204c 6f6f 7020 6f76 6572 2065 6c65 6d65   Loop over eleme
-00009860: 6e74 730d 0a20 2020 2066 6f72 206e 2069  nts..    for n i
-00009870: 6e20 7261 6e67 6528 6c65 6e28 656c 656d  n range(len(elem
-00009880: 656e 7429 293a 0d0a 2020 2020 2020 2020  ent)):..        
-00009890: 6131 2c20 6132 2c20 6133 2c20 6134 2c20  a1, a2, a3, a4, 
-000098a0: 6135 2c20 632c 2062 312c 2062 322c 2062  a5, c, b1, b2, b
-000098b0: 332c 2062 342c 2062 3520 3d20 636f 6566  3, b4, b5 = coef
-000098c0: 5b6e 2c20 3a5d 0d0a 0d0a 2020 2020 2020  [n, :]....      
-000098d0: 2020 2320 4172 7261 7920 6d75 6c74 6970    # Array multip
-000098e0: 6c69 6361 7469 6f6e 206f 7665 7220 516d  lication over Qm
-000098f0: 6167 730d 0a20 2020 2020 2020 2023 2066  ags..        # f
-00009900: 305b 6b5d 203d 2063 202b 205b 5355 4d20  0[k] = c + [SUM 
-00009910: 615f 6920 2a20 4558 5028 2d62 5f69 202a  a_i * EXP(-b_i *
-00009920: 2028 6b20 5e20 3229 295d 2020 693d 312c   (k ^ 2))]  i=1,
-00009930: 350d 0a20 2020 2020 2020 2066 203d 2061  5..        f = a
-00009940: 3120 2a20 6e70 2e65 7870 282d 6231 202a  1 * np.exp(-b1 *
-00009950: 2028 516d 6167 202f 2028 3420 2a20 6e70   (Qmag / (4 * np
-00009960: 2e70 6929 2920 2a2a 2032 2920 2b20 5c0d  .pi)) ** 2) + \.
-00009970: 0a20 2020 2020 2020 2020 2020 2061 3220  .            a2 
-00009980: 2a20 6e70 2e65 7870 282d 6232 202a 2028  * np.exp(-b2 * (
-00009990: 516d 6167 202f 2028 3420 2a20 6e70 2e70  Qmag / (4 * np.p
-000099a0: 6929 2920 2a2a 2032 2920 2b20 5c0d 0a20  i)) ** 2) + \.. 
-000099b0: 2020 2020 2020 2020 2020 2061 3320 2a20             a3 * 
-000099c0: 6e70 2e65 7870 282d 6233 202a 2028 516d  np.exp(-b3 * (Qm
-000099d0: 6167 202f 2028 3420 2a20 6e70 2e70 6929  ag / (4 * np.pi)
-000099e0: 2920 2a2a 2032 2920 2b20 5c0d 0a20 2020  ) ** 2) + \..   
-000099f0: 2020 2020 2020 2020 2061 3420 2a20 6e70           a4 * np
-00009a00: 2e65 7870 282d 6234 202a 2028 516d 6167  .exp(-b4 * (Qmag
-00009a10: 202f 2028 3420 2a20 6e70 2e70 6929 2920   / (4 * np.pi)) 
-00009a20: 2a2a 2032 2920 2b20 5c0d 0a20 2020 2020  ** 2) + \..     
-00009a30: 2020 2020 2020 2061 3520 2a20 6e70 2e65         a5 * np.e
-00009a40: 7870 282d 6235 202a 2028 516d 6167 202f  xp(-b5 * (Qmag /
-00009a50: 2028 3420 2a20 6e70 2e70 6929 2920 2a2a   (4 * np.pi)) **
-00009a60: 2032 2920 2b20 630d 0a20 2020 2020 2020   2) + c..       
-00009a70: 2051 6666 5b3a 2c20 6e5d 203d 2066 0d0a   Qff[:, n] = f..
-00009a80: 2020 2020 7265 7475 726e 2051 6666 0d0a      return Qff..
-00009a90: 0d0a 0d0a 6465 6620 7872 6179 5f73 6361  ....def xray_sca
-00009aa0: 7474 6572 696e 675f 6661 6374 6f72 5f72  ttering_factor_r
-00009ab0: 6573 6f6e 616e 7428 656c 656d 656e 742c  esonant(element,
-00009ac0: 2051 6d61 672c 2065 6e65 7267 795f 6b65   Qmag, energy_ke
-00009ad0: 7629 3a0d 0a20 2020 2022 2222 0d0a 2020  v):..    """..  
-00009ae0: 2020 5265 6164 2058 2d72 6179 2073 6361    Read X-ray sca
-00009af0: 7474 6572 696e 6720 6661 6374 6f72 2074  ttering factor t
-00009b00: 6162 6c65 2c20 6361 6c63 756c 6174 6520  able, calculate 
-00009b10: 6628 7c51 7c29 0d0a 2020 2020 5573 6573  f(|Q|)..    Uses
-00009b20: 2074 6865 2063 6f65 6666 6963 6965 6e74   the coefficient
-00009b30: 7320 666f 7220 616e 616c 7974 6963 616c  s for analytical
-00009b40: 2061 7070 726f 7869 6d61 7469 6f6e 2074   approximation t
-00009b50: 6f20 7468 6520 7363 6174 7465 7269 6e67  o the scattering
-00009b60: 2066 6163 746f 7273 202d 2049 5443 2c20   factors - ITC, 
-00009b70: 7035 3738 0d0a 2020 2020 2051 6666 203d  p578..     Qff =
-00009b80: 2078 7261 795f 7363 6174 7465 7269 6e67   xray_scattering
-00009b90: 5f66 6163 746f 725f 7265 736f 6e61 6e74  _factor_resonant
-00009ba0: 2865 6c65 6d65 6e74 2c20 656e 6572 6779  (element, energy
-00009bb0: 5f6b 6576 2c20 716d 6167 290d 0a0d 0a20  _kev, qmag).... 
-00009bc0: 2020 2069 6620 7265 736f 6e61 6e74 5f65     if resonant_e
-00009bd0: 6e65 7267 7920 3d20 666c 6f61 7428 656e  nergy = float(en
-00009be0: 6572 6779 2069 6e20 6b65 5629 2c20 7468  ergy in keV), th
-00009bf0: 6520 746f 7461 6c20 6174 6f6d 6963 2073  e total atomic s
-00009c00: 6361 7474 6572 696e 6720 616d 706c 6974  cattering amplit
-00009c10: 7564 6520 7769 6c6c 2062 6520 7265 7475  ude will be retu
-00009c20: 726e 6564 3a0d 0a20 2020 2020 2020 2066  rned:..        f
-00009c30: 287c 517c 2c20 4529 203d 2066 3028 7c51  (|Q|, E) = f0(|Q
-00009c40: 7c29 202b 2066 2728 4529 202d 2069 6627  |) + f'(E) - if'
-00009c50: 2728 4529 0d0a 2020 2020 5365 653a 0d0a  '(E)..    See:..
-00009c60: 2020 2020 3a70 6172 616d 2065 6c65 6d65      :param eleme
-00009c70: 6e74 3a20 5b6e 2a73 7472 5d20 6c69 7374  nt: [n*str] list
-00009c80: 206f 7220 6172 7261 7920 6f66 2065 6c65   or array of ele
-00009c90: 6d65 6e74 730d 0a20 2020 203a 7061 7261  ments..    :para
-00009ca0: 6d20 516d 6167 3a20 5b6d 5d20 6172 7261  m Qmag: [m] arra
-00009cb0: 7920 7761 7665 7665 6374 6f72 2064 6973  y wavevector dis
-00009cc0: 7461 6e63 6520 7c51 7c2c 2069 6e20 415e  tance |Q|, in A^
-00009cd0: 2d31 0d0a 2020 2020 3a70 6172 616d 2065  -1..    :param e
-00009ce0: 6e65 7267 795f 6b65 763a 205b 6f5d 2061  nergy_kev: [o] a
-00009cf0: 7272 6179 2065 6e65 7267 7920 696e 206b  rray energy in k
-00009d00: 6556 0d0a 2020 2020 3a72 6574 7572 6e3a  eV..    :return:
-00009d10: 205b 6d2a 6e2a 6f5d 2063 6f6d 706c 6578   [m*n*o] complex
-00009d20: 2061 7272 6179 206f 6620 7363 6174 7465   array of scatte
-00009d30: 7269 6e67 2066 6163 746f 7273 0d0a 2020  ring factors..  
-00009d40: 2020 2222 220d 0a0d 0a20 2020 2023 2051    """....    # Q
-00009d50: 6d61 6720 616e 6420 656e 6572 6779 5f6b  mag and energy_k
-00009d60: 6576 2073 686f 756c 6420 6265 2061 2031  ev should be a 1
-00009d70: 4420 6172 7261 790d 0a20 2020 2051 6d61  D array..    Qma
-00009d80: 6720 3d20 6e70 2e61 7361 7272 6179 2851  g = np.asarray(Q
-00009d90: 6d61 6729 2e72 6573 6861 7065 282d 3129  mag).reshape(-1)
-00009da0: 0d0a 2020 2020 656e 6572 6779 5f6b 6576  ..    energy_kev
-00009db0: 203d 206e 702e 6173 6172 7261 7928 656e   = np.asarray(en
-00009dc0: 6572 6779 5f6b 6576 292e 7265 7368 6170  ergy_kev).reshap
-00009dd0: 6528 2d31 290d 0a0d 0a20 2020 2063 6f65  e(-1)....    coe
-00009de0: 6620 3d20 6174 6f6d 5f70 726f 7065 7274  f = atom_propert
-00009df0: 6965 7328 656c 656d 656e 742c 205b 2761  ies(element, ['a
-00009e00: 3127 2c20 2762 3127 2c20 2761 3227 2c20  1', 'b1', 'a2', 
-00009e10: 2762 3227 2c20 2761 3327 2c20 2762 3327  'b2', 'a3', 'b3'
-00009e20: 2c20 2761 3427 2c20 2762 3427 2c20 2763  , 'a4', 'b4', 'c
-00009e30: 275d 290d 0a20 2020 2066 312c 2066 3220  '])..    f1, f2 
-00009e40: 3d20 7872 6179 5f64 6973 7065 7273 696f  = xray_dispersio
-00009e50: 6e5f 636f 7272 6563 7469 6f6e 7328 656c  n_corrections(el
-00009e60: 656d 656e 742c 2065 6e65 7267 795f 6b65  ement, energy_ke
-00009e70: 7629 2020 2320 7368 6170 6520 286c 656e  v)  # shape (len
-00009e80: 2865 6e65 7267 7929 2c20 6c65 6e28 656c  (energy), len(el
-00009e90: 656d 656e 7429 290d 0a0d 0a20 2020 2051  ement))....    Q
-00009ea0: 6666 203d 206e 702e 7a65 726f 7328 5b6c  ff = np.zeros([l
-00009eb0: 656e 2851 6d61 6729 2c20 6c65 6e28 636f  en(Qmag), len(co
-00009ec0: 6566 292c 206c 656e 2865 6e65 7267 795f  ef), len(energy_
-00009ed0: 6b65 7629 5d2c 2064 7479 7065 3d63 6f6d  kev)], dtype=com
-00009ee0: 706c 6578 290d 0a20 2020 2023 2042 726f  plex)..    # Bro
-00009ef0: 6164 6361 7374 2064 6973 7065 7273 696f  adcast dispersio
-00009f00: 6e20 636f 7272 6563 7469 6f6e 730d 0a20  n corrections.. 
-00009f10: 2020 2051 6666 5b3a 2c20 3a2c 203a 5d20     Qff[:, :, :] 
-00009f20: 3d20 6631 2e54 202b 2031 6a20 2a20 6632  = f1.T + 1j * f2
-00009f30: 2e54 0d0a 0d0a 2020 2020 2320 4c6f 6f70  .T....    # Loop
-00009f40: 206f 7665 7220 656c 656d 656e 7473 0d0a   over elements..
-00009f50: 2020 2020 666f 7220 6e20 696e 2072 616e      for n in ran
-00009f60: 6765 286c 656e 2863 6f65 6629 293a 0d0a  ge(len(coef)):..
-00009f70: 2020 2020 2020 2020 6131 203d 2063 6f65          a1 = coe
-00009f80: 665b 2761 3127 5d5b 6e5d 0d0a 2020 2020  f['a1'][n]..    
-00009f90: 2020 2020 6231 203d 2063 6f65 665b 2762      b1 = coef['b
-00009fa0: 3127 5d5b 6e5d 0d0a 2020 2020 2020 2020  1'][n]..        
-00009fb0: 6132 203d 2063 6f65 665b 2761 3227 5d5b  a2 = coef['a2'][
-00009fc0: 6e5d 0d0a 2020 2020 2020 2020 6232 203d  n]..        b2 =
-00009fd0: 2063 6f65 665b 2762 3227 5d5b 6e5d 0d0a   coef['b2'][n]..
-00009fe0: 2020 2020 2020 2020 6133 203d 2063 6f65          a3 = coe
-00009ff0: 665b 2761 3327 5d5b 6e5d 0d0a 2020 2020  f['a3'][n]..    
-0000a000: 2020 2020 6233 203d 2063 6f65 665b 2762      b3 = coef['b
-0000a010: 3327 5d5b 6e5d 0d0a 2020 2020 2020 2020  3'][n]..        
-0000a020: 6134 203d 2063 6f65 665b 2761 3427 5d5b  a4 = coef['a4'][
-0000a030: 6e5d 0d0a 2020 2020 2020 2020 6234 203d  n]..        b4 =
-0000a040: 2063 6f65 665b 2762 3427 5d5b 6e5d 0d0a   coef['b4'][n]..
-0000a050: 2020 2020 2020 2020 6320 3d20 636f 6566          c = coef
-0000a060: 5b27 6327 5d5b 6e5d 0d0a 0d0a 2020 2020  ['c'][n]....    
-0000a070: 2020 2020 2320 4172 7261 7920 6d75 6c74      # Array mult
-0000a080: 6970 6c69 6361 7469 6f6e 206f 7665 7220  iplication over 
-0000a090: 516d 6167 730d 0a20 2020 2020 2020 2066  Qmags..        f
-0000a0a0: 203d 2061 3120 2a20 6e70 2e65 7870 282d   = a1 * np.exp(-
-0000a0b0: 6231 202a 2028 516d 6167 202f 2028 3420  b1 * (Qmag / (4 
-0000a0c0: 2a20 6e70 2e70 6929 2920 2a2a 2032 2920  * np.pi)) ** 2) 
-0000a0d0: 2b20 5c0d 0a20 2020 2020 2020 2020 2020  + \..           
-0000a0e0: 2061 3220 2a20 6e70 2e65 7870 282d 6232   a2 * np.exp(-b2
-0000a0f0: 202a 2028 516d 6167 202f 2028 3420 2a20   * (Qmag / (4 * 
-0000a100: 6e70 2e70 6929 2920 2a2a 2032 2920 2b20  np.pi)) ** 2) + 
-0000a110: 5c0d 0a20 2020 2020 2020 2020 2020 2061  \..            a
-0000a120: 3320 2a20 6e70 2e65 7870 282d 6233 202a  3 * np.exp(-b3 *
-0000a130: 2028 516d 6167 202f 2028 3420 2a20 6e70   (Qmag / (4 * np
-0000a140: 2e70 6929 2920 2a2a 2032 2920 2b20 5c0d  .pi)) ** 2) + \.
-0000a150: 0a20 2020 2020 2020 2020 2020 2061 3420  .            a4 
-0000a160: 2a20 6e70 2e65 7870 282d 6234 202a 2028  * np.exp(-b4 * (
+00006d60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d5c 6e27  -------------\n'
+00006d70: 0d0a 2020 2020 6320 2b3d 2027 2320 4d43  ..    c += '# MC
+00006d80: 4946 2063 7265 6174 6564 2069 6e20 4461  IF created in Da
+00006d90: 6e73 5f44 6966 6672 6163 7469 6f6e 5c6e  ns_Diffraction\n
+00006da0: 270d 0a20 2020 2063 202b 3d20 2723 204f  '..    c += '# O
+00006db0: 7269 6769 6e61 6c20 6369 663a 5c6e 2320  riginal cif:\n# 
+00006dc0: 2573 5c6e 2720 2520 2863 6966 7661 6c73  %s\n' % (cifvals
+00006dd0: 5b27 4669 6c65 6e61 6d65 275d 2069 6620  ['Filename'] if 
+00006de0: 2746 696c 656e 616d 6527 2069 6e20 6b65  'Filename' in ke
+00006df0: 7973 2065 6c73 6520 274e 6f6e 6527 290d  ys else 'None').
+00006e00: 0a0d 0a20 2020 2023 2043 6f6d 6d65 6e74  ...    # Comment
+00006e10: 730d 0a20 2020 2063 202b 3d20 2723 2043  s..    c += '# C
+00006e20: 6f6d 6d65 6e74 733a 5c6e 270d 0a20 2020  omments:\n'..   
+00006e30: 2069 6620 636f 6d6d 656e 7473 3a0d 0a20   if comments:.. 
+00006e40: 2020 2020 2020 2063 6f6d 6d65 6e74 7320         comments 
+00006e50: 3d20 636f 6d6d 656e 7473 2e73 706c 6974  = comments.split
+00006e60: 2827 5c6e 2729 0d0a 2020 2020 2020 2020  ('\n')..        
+00006e70: 6320 2b3d 2027 272e 6a6f 696e 285b 2723  c += ''.join(['#
+00006e80: 2025 735c 6e27 2025 2063 6f6d 6d65 6e74   %s\n' % comment
+00006e90: 2066 6f72 2063 6f6d 6d65 6e74 2069 6e20   for comment in 
+00006ea0: 636f 6d6d 656e 7473 5d29 0d0a 0d0a 2020  comments])....  
+00006eb0: 2020 2320 4372 7973 7461 6c20 4461 7461    # Crystal Data
+00006ec0: 0d0a 2020 2020 6320 2b3d 2027 5c6e 6461  ..    c += '\nda
+00006ed0: 7461 5f57 5249 5445 4349 465c 6e27 0d0a  ta_WRITECIF\n'..
+00006ee0: 2020 2020 6320 2b3d 2063 6966 5f76 616c      c += cif_val
+00006ef0: 7565 2827 5f63 6865 6d69 6361 6c5f 6e61  ue('_chemical_na
+00006f00: 6d65 5f6d 696e 6572 616c 2729 0d0a 2020  me_mineral')..  
+00006f10: 2020 6320 2b3d 2063 6966 5f76 616c 7565    c += cif_value
+00006f20: 2827 5f63 6865 6d69 6361 6c5f 6e61 6d65  ('_chemical_name
+00006f30: 5f63 6f6d 6d6f 6e27 290d 0a20 2020 2063  _common')..    c
+00006f40: 202b 3d20 6369 665f 7661 6c75 6528 275f   += cif_value('_
+00006f50: 7064 5f70 6861 7365 5f6e 616d 6527 290d  pd_phase_name').
+00006f60: 0a20 2020 2063 202b 3d20 6369 665f 7661  .    c += cif_va
+00006f70: 6c75 6528 275f 6368 656d 6963 616c 5f66  lue('_chemical_f
+00006f80: 6f72 6d75 6c61 5f73 756d 2729 0d0a 2020  ormula_sum')..  
+00006f90: 2020 6320 2b3d 2063 6966 5f76 616c 7565    c += cif_value
+00006fa0: 2827 5f63 6865 6d69 6361 6c5f 666f 726d  ('_chemical_form
+00006fb0: 756c 615f 7765 6967 6874 2729 0d0a 2020  ula_weight')..  
+00006fc0: 2020 6320 2b3d 2063 6966 5f76 616c 7565    c += cif_value
+00006fd0: 2827 5f63 656c 6c5f 666f 726d 756c 615f  ('_cell_formula_
+00006fe0: 756e 6974 735f 5a27 290d 0a0d 0a20 2020  units_Z')....   
+00006ff0: 2023 2043 656c 6c20 696e 666f 0d0a 2020   # Cell info..  
+00007000: 2020 6320 2b3d 2027 5c6e 2320 4365 6c6c    c += '\n# Cell
+00007010: 2069 6e66 6f5c 6e27 0d0a 2020 2020 6320   info\n'..    c 
+00007020: 2b3d 2063 6966 5f76 616c 7565 2827 5f63  += cif_value('_c
+00007030: 656c 6c5f 6c65 6e67 7468 5f61 2729 0d0a  ell_length_a')..
+00007040: 2020 2020 6320 2b3d 2063 6966 5f76 616c      c += cif_val
+00007050: 7565 2827 5f63 656c 6c5f 6c65 6e67 7468  ue('_cell_length
+00007060: 5f62 2729 0d0a 2020 2020 6320 2b3d 2063  _b')..    c += c
+00007070: 6966 5f76 616c 7565 2827 5f63 656c 6c5f  if_value('_cell_
+00007080: 6c65 6e67 7468 5f63 2729 0d0a 2020 2020  length_c')..    
+00007090: 6320 2b3d 2063 6966 5f76 616c 7565 2827  c += cif_value('
+000070a0: 5f63 656c 6c5f 616e 676c 655f 616c 7068  _cell_angle_alph
+000070b0: 6127 290d 0a20 2020 2063 202b 3d20 6369  a')..    c += ci
+000070c0: 665f 7661 6c75 6528 275f 6365 6c6c 5f61  f_value('_cell_a
+000070d0: 6e67 6c65 5f62 6574 6127 290d 0a20 2020  ngle_beta')..   
+000070e0: 2063 202b 3d20 6369 665f 7661 6c75 6528   c += cif_value(
+000070f0: 275f 6365 6c6c 5f61 6e67 6c65 5f67 616d  '_cell_angle_gam
+00007100: 6d61 2729 0d0a 2020 2020 6320 2b3d 2063  ma')..    c += c
+00007110: 6966 5f76 616c 7565 2827 5f63 656c 6c5f  if_value('_cell_
+00007120: 766f 6c75 6d65 2729 0d0a 0d0a 2020 2020  volume')....    
+00007130: 2320 5379 6d6d 6574 7279 2069 6e66 6f0d  # Symmetry info.
+00007140: 0a20 2020 2063 202b 3d20 275c 6e23 2053  .    c += '\n# S
+00007150: 796d 6d65 7472 7920 696e 666f 5c6e 270d  ymmetry info\n'.
+00007160: 0a20 2020 2063 202b 3d20 6369 665f 7661  .    c += cif_va
+00007170: 6c75 6528 275f 7370 6163 655f 6772 6f75  lue('_space_grou
+00007180: 705f 6d61 676e 2e6e 756d 6265 725f 424e  p_magn.number_BN
+00007190: 5327 290d 0a20 2020 2063 202b 3d20 6369  S')..    c += ci
+000071a0: 665f 7661 6c75 6528 275f 7370 6163 655f  f_value('_space_
+000071b0: 6772 6f75 705f 6d61 676e 2e6e 616d 655f  group_magn.name_
+000071c0: 424e 5327 290d 0a20 2020 2063 202b 3d20  BNS')..    c += 
+000071d0: 275c 6e27 0d0a 2020 2020 6320 2b3d 2063  '\n'..    c += c
+000071e0: 6966 5f6c 6f6f 7028 5b0d 0a20 2020 2020  if_loop([..     
+000071f0: 2020 2027 5f73 7061 6365 5f67 726f 7570     '_space_group
+00007200: 5f73 796d 6f70 5f6d 6167 6e5f 6f70 6572  _symop_magn_oper
+00007210: 6174 696f 6e2e 6964 272c 0d0a 2020 2020  ation.id',..    
+00007220: 2020 2020 275f 7370 6163 655f 6772 6f75      '_space_grou
+00007230: 705f 7379 6d6f 705f 6d61 676e 5f6f 7065  p_symop_magn_ope
+00007240: 7261 7469 6f6e 2e78 797a 272c 0d0a 2020  ration.xyz',..  
+00007250: 2020 2020 2020 275f 7370 6163 655f 6772        '_space_gr
+00007260: 6f75 705f 7379 6d6f 705f 6d61 676e 5f6f  oup_symop_magn_o
+00007270: 7065 7261 7469 6f6e 2e6d 786d 796d 7a27  peration.mxmymz'
+00007280: 2c0d 0a20 2020 205d 290d 0a20 2020 2063  ,..    ])..    c
+00007290: 202b 3d20 275c 6e27 0d0a 2020 2020 6320   += '\n'..    c 
+000072a0: 2b3d 2063 6966 5f6c 6f6f 7028 5b0d 0a20  += cif_loop([.. 
+000072b0: 2020 2020 2020 2027 5f73 7061 6365 5f67         '_space_g
+000072c0: 726f 7570 5f73 796d 6f70 5f6d 6167 6e5f  roup_symop_magn_
+000072d0: 6365 6e74 6572 696e 672e 6964 272c 0d0a  centering.id',..
+000072e0: 2020 2020 2020 2020 275f 7370 6163 655f          '_space_
+000072f0: 6772 6f75 705f 7379 6d6f 705f 6d61 676e  group_symop_magn
+00007300: 5f63 656e 7465 7269 6e67 2e78 797a 272c  _centering.xyz',
+00007310: 0d0a 2020 2020 2020 2020 275f 7370 6163  ..        '_spac
+00007320: 655f 6772 6f75 705f 7379 6d6f 705f 6d61  e_group_symop_ma
+00007330: 676e 5f63 656e 7465 7269 6e67 2e6d 786d  gn_centering.mxm
+00007340: 796d 7a27 2c0d 0a20 2020 205d 290d 0a0d  ymz',..    ])...
+00007350: 0a20 2020 2023 2041 746f 6d20 696e 666f  .    # Atom info
+00007360: 0d0a 2020 2020 6320 2b3d 2027 5c6e 2320  ..    c += '\n# 
+00007370: 4174 6f6d 2069 6e66 6f5c 6e27 0d0a 2020  Atom info\n'..  
+00007380: 2020 6320 2b3d 2063 6966 5f6c 6f6f 7028    c += cif_loop(
+00007390: 5b0d 0a20 2020 2020 2020 2027 5f61 746f  [..        '_ato
+000073a0: 6d5f 7369 7465 5f6c 6162 656c 272c 0d0a  m_site_label',..
+000073b0: 2020 2020 2020 2020 275f 6174 6f6d 5f73          '_atom_s
+000073c0: 6974 655f 7479 7065 5f73 796d 626f 6c27  ite_type_symbol'
+000073d0: 2c0d 0a20 2020 2020 2020 2023 2027 5f61  ,..        # '_a
+000073e0: 746f 6d5f 7369 7465 5f73 796d 6d65 7472  tom_site_symmetr
+000073f0: 795f 6d75 6c74 6970 6c69 6369 7479 272c  y_multiplicity',
+00007400: 0d0a 2020 2020 2020 2020 2320 275f 6174  ..        # '_at
+00007410: 6f6d 5f73 6974 655f 5779 636b 6f66 665f  om_site_Wyckoff_
+00007420: 7379 6d62 6f6c 272c 0d0a 2020 2020 2020  symbol',..      
+00007430: 2020 275f 6174 6f6d 5f73 6974 655f 6672    '_atom_site_fr
+00007440: 6163 745f 7827 2c0d 0a20 2020 2020 2020  act_x',..       
+00007450: 2027 5f61 746f 6d5f 7369 7465 5f66 7261   '_atom_site_fra
+00007460: 6374 5f79 272c 0d0a 2020 2020 2020 2020  ct_y',..        
+00007470: 275f 6174 6f6d 5f73 6974 655f 6672 6163  '_atom_site_frac
+00007480: 745f 7a27 2c0d 0a20 2020 2020 2020 2027  t_z',..        '
+00007490: 5f61 746f 6d5f 7369 7465 5f55 5f69 736f  _atom_site_U_iso
+000074a0: 5f6f 725f 6571 7569 7627 2c0d 0a20 2020  _or_equiv',..   
+000074b0: 2020 2020 2027 5f61 746f 6d5f 7369 7465       '_atom_site
+000074c0: 5f6f 6363 7570 616e 6379 272c 0d0a 2020  _occupancy',..  
+000074d0: 2020 5d29 0d0a 0d0a 2020 2020 2320 4d6f    ])....    # Mo
+000074e0: 6d65 6e74 2069 6e66 6f0d 0a20 2020 2063  ment info..    c
+000074f0: 202b 3d20 275c 6e23 2041 746f 6d20 696e   += '\n# Atom in
+00007500: 666f 5c6e 270d 0a20 2020 2063 202b 3d20  fo\n'..    c += 
+00007510: 6369 665f 6c6f 6f70 285b 0d0a 2020 2020  cif_loop([..    
+00007520: 2020 2020 275f 6174 6f6d 5f73 6974 655f      '_atom_site_
+00007530: 6d6f 6d65 6e74 2e6c 6162 656c 272c 0d0a  moment.label',..
+00007540: 2020 2020 2020 2020 275f 6174 6f6d 5f73          '_atom_s
+00007550: 6974 655f 6d6f 6d65 6e74 2e63 7279 7374  ite_moment.cryst
+00007560: 616c 6178 6973 5f78 272c 0d0a 2020 2020  alaxis_x',..    
+00007570: 2020 2020 275f 6174 6f6d 5f73 6974 655f      '_atom_site_
+00007580: 6d6f 6d65 6e74 2e63 7279 7374 616c 6178  moment.crystalax
+00007590: 6973 5f79 272c 0d0a 2020 2020 2020 2020  is_y',..        
+000075a0: 275f 6174 6f6d 5f73 6974 655f 6d6f 6d65  '_atom_site_mome
+000075b0: 6e74 2e63 7279 7374 616c 6178 6973 5f7a  nt.crystalaxis_z
+000075c0: 272c 0d0a 2020 2020 2020 2020 2320 275f  ',..        # '_
+000075d0: 6174 6f6d 5f73 6974 655f 6d6f 6d65 6e74  atom_site_moment
+000075e0: 2e73 796d 6d66 6f72 6d27 2c0d 0a20 2020  .symmform',..   
+000075f0: 205d 290d 0a0d 0a20 2020 2069 6620 6669   ])....    if fi
+00007600: 6c65 6e61 6d65 2069 7320 4e6f 6e65 3a0d  lename is None:.
+00007610: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007620: 630d 0a0d 0a20 2020 2066 696c 656e 616d  c....    filenam
+00007630: 652c 2065 7874 656e 7369 6f6e 203d 206f  e, extension = o
+00007640: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
+00007650: 6669 6c65 6e61 6d65 290d 0a20 2020 2066  filename)..    f
+00007660: 696c 656e 616d 6520 3d20 6669 6c65 6e61  ilename = filena
+00007670: 6d65 202b 2027 2e6d 6369 6627 0d0a 2020  me + '.mcif'..  
+00007680: 2020 7769 7468 206f 7065 6e28 6669 6c65    with open(file
+00007690: 6e61 6d65 2c20 2777 7427 2920 6173 2066  name, 'wt') as f
+000076a0: 3a0d 0a20 2020 2020 2020 2066 2e77 7269  :..        f.wri
+000076b0: 7465 2863 290d 0a20 2020 2070 7269 6e74  te(c)..    print
+000076c0: 2827 4d43 4946 2077 7269 7474 656e 2074  ('MCIF written t
+000076d0: 6f3a 2025 7327 2025 2066 696c 656e 616d  o: %s' % filenam
+000076e0: 6529 0d0a 0d0a 0d0a 272d 2d2d 2d2d 2d2d  e)......'-------
+000076f0: 2d2d 2d2d 2d2d 2d46 756e 6374 696f 6e73  -------Functions
+00007700: 2074 6f20 5265 6164 2044 6174 6162 6173   to Read Databas
+00007710: 6520 6669 6c65 732d 2d2d 2d2d 2d2d 2d2d  e files---------
+00007720: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 0d0a  -------------'..
+00007730: 0d0a 0d0a 6465 6620 7265 6164 5f61 746f  ....def read_ato
+00007740: 6d5f 7072 6f70 6572 7469 6573 5f66 696c  m_properties_fil
+00007750: 6528 6669 6c65 6469 7229 3a0d 0a20 2020  e(filedir):..   
+00007760: 2022 2222 0d0a 2020 2020 5265 6164 7320   """..    Reads 
+00007770: 7468 6520 7465 7874 2066 696c 6520 2244  the text file "D
+00007780: 616e 7320 456c 656d 656e 7420 5072 6f70  ans Element Prop
+00007790: 6572 7469 6573 2e74 7874 220d 0a20 2020  erties.txt"..   
+000077a0: 2052 6574 7572 6e73 2061 206c 6973 7420   Returns a list 
+000077b0: 6f66 2064 6963 7473 2063 6f6e 7461 696e  of dicts contain
+000077c0: 696e 6720 6174 6f6d 6963 2070 726f 7065  ing atomic prope
+000077d0: 7269 7465 7320 6672 6f6d 206d 756c 7469  rites from multi
+000077e0: 706c 6520 736f 7572 6365 730d 0a20 2020  ple sources..   
+000077f0: 2020 2064 6174 6120 3d20 7265 6164 5f61     data = read_a
+00007800: 746f 6d5f 7072 6f70 6572 7469 6573 5f66  tom_properties_f
+00007810: 696c 6528 6669 6c65 6469 7229 0d0a 2020  ile(filedir)..  
+00007820: 2020 2020 6461 7461 5b32 325d 5b27 456c      data[22]['El
+00007830: 656d 656e 7427 5d0d 0a20 2020 203a 7061  ement']..    :pa
+00007840: 7261 6d20 6669 6c65 6469 723a 206c 6f63  ram filedir: loc
+00007850: 6174 696f 6e20 6f66 2022 4461 6e73 2045  ation of "Dans E
+00007860: 6c65 6d65 6e74 2050 726f 7065 7274 6965  lement Propertie
+00007870: 732e 7478 7422 0d0a 2020 2020 3a72 6574  s.txt"..    :ret
+00007880: 7572 6e3a 205b 6469 6374 2c20 2e2e 2e5d  urn: [dict, ...]
+00007890: 0d0a 2020 2020 2222 220d 0a20 2020 2077  ..    """..    w
+000078a0: 6974 6820 6f70 656e 2866 696c 6564 6972  ith open(filedir
+000078b0: 2c20 2772 7427 2920 6173 2066 3a0d 0a20  , 'rt') as f:.. 
+000078c0: 2020 2020 2020 206c 696e 6573 203d 2066         lines = f
+000078d0: 2e72 6561 646c 696e 6573 2829 0d0a 0d0a  .readlines()....
+000078e0: 2020 2020 6865 6164 203d 204e 6f6e 650d      head = None.
+000078f0: 0a20 2020 2064 6174 6120 3d20 5b5d 0d0a  .    data = []..
+00007900: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
+00007910: 6c69 6e65 733a 0d0a 2020 2020 2020 2020  lines:..        
+00007920: 2320 4865 6164 6572 0d0a 2020 2020 2020  # Header..      
+00007930: 2020 6966 2027 2327 2069 6e20 6c69 6e65    if '#' in line
+00007940: 3a20 636f 6e74 696e 7565 0d0a 2020 2020  : continue..    
+00007950: 2020 2020 6966 2068 6561 6420 6973 204e      if head is N
+00007960: 6f6e 653a 2068 6561 6420 3d20 6c69 6e65  one: head = line
+00007970: 2e73 706c 6974 2829 3b20 636f 6e74 696e  .split(); contin
+00007980: 7565 0d0a 2020 2020 2020 2020 2320 4461  ue..        # Da
+00007990: 7461 0d0a 2020 2020 2020 2020 7661 6c73  ta..        vals
+000079a0: 203d 206c 696e 652e 7370 6c69 7428 290d   = line.split().
+000079b0: 0a20 2020 2020 2020 2065 6c65 6d65 6e74  .        element
+000079c0: 203d 207b 7d0d 0a20 2020 2020 2020 2066   = {}..        f
+000079d0: 6f72 206e 2069 6e20 7261 6e67 6528 6c65  or n in range(le
+000079e0: 6e28 7661 6c73 2929 3a0d 0a20 2020 2020  n(vals)):..     
+000079f0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+00007a00: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00007a10: 7565 203d 2069 6e74 2876 616c 735b 6e5d  ue = int(vals[n]
+00007a20: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00007a30: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+00007a40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00007a50: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00007a60: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00007a70: 7565 203d 2066 6c6f 6174 2876 616c 735b  ue = float(vals[
+00007a80: 6e5d 290d 0a20 2020 2020 2020 2020 2020  n])..           
+00007a90: 2020 2020 2065 7863 6570 7420 5661 6c75       except Valu
+00007aa0: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
+00007ab0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00007ac0: 7565 203d 2076 616c 735b 6e5d 0d0a 2020  ue = vals[n]..  
+00007ad0: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
+00007ae0: 745b 6865 6164 5b6e 5d5d 203d 2076 616c  t[head[n]] = val
+00007af0: 7565 0d0a 2020 2020 2020 2020 6461 7461  ue..        data
+00007b00: 202b 3d20 5b65 6c65 6d65 6e74 5d0d 0a20   += [element].. 
+00007b10: 2020 2072 6574 7572 6e20 6461 7461 0d0a     return data..
+00007b20: 0d0a 0d0a 6465 6620 6174 6f6d 5f70 726f  ....def atom_pro
+00007b30: 7065 7274 6965 7328 656c 656d 656e 7473  perties(elements
+00007b40: 3d4e 6f6e 652c 2066 6965 6c64 733d 4e6f  =None, fields=No
+00007b50: 6e65 293a 0d0a 2020 2020 2222 220d 0a20  ne):..    """.. 
+00007b60: 2020 204c 6f61 6473 2074 6865 2061 746f     Loads the ato
+00007b70: 6d69 6320 7072 6f70 6572 7469 6573 206f  mic properties o
+00007b80: 6620 6120 7061 7274 6963 756c 6172 2061  f a particular a
+00007b90: 746f 6d20 6672 6f6d 2061 2064 6174 6162  tom from a datab
+00007ba0: 6173 650d 0a20 2020 2041 746f 6d69 6320  ase..    Atomic 
+00007bb0: 7072 6f70 6572 7469 6573 2c20 7363 6174  properties, scat
+00007bc0: 7465 7269 6e67 206c 656e 6774 6873 2c20  tering lengths, 
+00007bd0: 666f 726d 2066 6163 746f 7273 2061 6e64  form factors and
+00007be0: 2061 6273 6f72 7074 696f 6e20 6564 6765   absorption edge
+00007bf0: 7320 666f 7220 656c 656d 656e 7473 2075  s for elements u
+00007c00: 7074 6f20 616e 6420 696e 636c 7564 696e  pto and includin
+00007c10: 6720 5572 616e 6975 6d2e 0d0a 2020 2020  g Uranium...    
+00007c20: 5661 6c75 6573 2061 7265 2074 616b 656e  Values are taken
+00007c30: 2066 726f 6d20 7661 7269 6f75 7320 6f6e   from various on
+00007c40: 6c69 6e65 2073 6f75 7263 6573 2c20 7365  line sources, se
+00007c50: 6520 6461 7461 2f52 4541 444d 452e 6d64  e data/README.md
+00007c60: 2066 6f72 206d 6f72 6520 6465 7461 696c   for more detail
+00007c70: 732e 0d0a 0d0a 2020 2020 5573 6167 653a  s.....    Usage:
+00007c80: 0d0a 2020 2020 2020 2020 2020 2020 4120  ..            A 
+00007c90: 3d20 6174 6f6d 5f70 726f 7065 7274 6965  = atom_propertie
+00007ca0: 7328 2920 3e3e 2072 6574 7572 6e73 2073  s() >> returns s
+00007cb0: 7472 7563 7475 7265 6420 6172 7261 7920  tructured array 
+00007cc0: 6f66 2061 6c6c 2070 726f 7065 7274 6965  of all propertie
+00007cd0: 7320 666f 7220 616c 6c20 6174 6f6d 7320  s for all atoms 
+00007ce0: 415b 305d 5b27 456c 656d 656e 7427 5d3d  A[0]['Element']=
+00007cf0: 2748 270d 0a20 2020 2020 2020 2020 2020  'H'..           
+00007d00: 2041 203d 2061 746f 6d5f 7072 6f70 6572   A = atom_proper
+00007d10: 7469 6573 2827 436f 2729 203e 3e20 7265  ties('Co') >> re
+00007d20: 7475 726e 7320 7374 7275 6374 7572 6564  turns structured
+00007d30: 2061 7272 6179 206f 6620 616c 6c20 7072   array of all pr
+00007d40: 6f70 6572 7469 6573 2066 6f72 2031 2065  operties for 1 e
+00007d50: 6c65 6d65 6e74 0d0a 2020 2020 2020 2020  lement..        
+00007d60: 2020 2020 4220 3d20 6174 6f6d 5f70 726f      B = atom_pro
+00007d70: 7065 7274 6965 7328 2743 6f27 2c27 5765  perties('Co','We
+00007d80: 6967 6874 2729 203e 3e20 7265 7475 726e  ight') >> return
+00007d90: 7320 7265 6775 6c61 7220 3178 3120 6172  s regular 1x1 ar
+00007da0: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
+00007db0: 2042 203d 2061 746f 6d5f 7072 6f70 6572   B = atom_proper
+00007dc0: 7469 6573 285b 2743 6f27 2c27 4f27 5d2c  ties(['Co','O'],
+00007dd0: 2757 6569 6768 7427 2920 3e3e 2072 6574  'Weight') >> ret
+00007de0: 7275 6e73 2072 6567 756c 6172 2032 7831  runs regular 2x1
+00007df0: 2061 7272 6179 0d0a 2020 2020 2020 2020   array..        
+00007e00: 2020 2020 4120 3d20 6174 6f6d 5f70 726f      A = atom_pro
+00007e10: 7065 7274 6965 7328 2743 6f27 2c5b 2761  perties('Co',['a
+00007e20: 3127 2c27 6231 272c 2761 3227 2c27 6232  1','b1','a2','b2
+00007e30: 272c 2761 3327 2c27 6233 272c 2761 3427  ','a3','b3','a4'
+00007e40: 2c27 6234 272c 2763 275d 2920 3e3e 2072  ,'b4','c']) >> r
+00007e50: 6574 7572 6e73 2073 7472 7563 7475 7265  eturns structure
+00007e60: 6420 6172 7261 7920 6f66 2072 6571 7565  d array of reque
+00007e70: 7374 6564 2070 726f 7065 7274 6965 730d  sted properties.
+00007e80: 0a20 2020 2020 2020 2020 2020 2041 203d  .            A =
+00007e90: 2061 746f 6d5f 7072 6f70 6572 7469 6573   atom_properties
+00007ea0: 285b 2743 6f27 2c27 4f27 5d2c 5b27 5a27  (['Co','O'],['Z'
+00007eb0: 2c27 5765 6967 6874 275d 2920 3e3e 2072  ,'Weight']) >> r
+00007ec0: 6574 7572 6e73 2032 7832 2073 7472 7563  eturns 2x2 struc
+00007ed0: 7475 7265 6420 6172 7261 790d 0a0d 0a20  tured array.... 
+00007ee0: 2020 2041 7661 696c 6162 6c65 2070 726f     Available pro
+00007ef0: 7065 7274 6965 733a 0d0a 2020 2020 2020  perties:..      
+00007f00: 2020 4120 3d20 6174 6f6d 5f70 726f 7065    A = atom_prope
+00007f10: 7274 6965 7328 290d 0a20 2020 2020 2020  rties()..       
+00007f20: 2070 7269 6e74 2841 2e64 7479 7065 2e6e   print(A.dtype.n
+00007f30: 616d 6573 290d 0a20 2020 2020 2020 2070  ames)..        p
+00007f40: 7269 6e74 2861 5b32 355d 5b27 456c 656d  rint(a[25]['Elem
+00007f50: 656e 7427 5d29 0d0a 2020 2020 2020 2020  ent'])..        
+00007f60: 3e3e 2027 4665 270d 0a0d 0a20 2020 2041  >> 'Fe'....    A
+00007f70: 7661 696c 6162 6c65 2069 6e66 6f72 6d61  vailable informa
+00007f80: 7469 6f6e 2069 6e63 6c75 6465 733a 0d0a  tion includes:..
+00007f90: 2020 2020 2020 2020 2020 5a20 2020 2020            Z     
+00007fa0: 2020 2020 2020 2020 3d20 456c 656d 656e          = Elemen
+00007fb0: 7420 6e75 6d62 6572 0d0a 2020 2020 2020  t number..      
+00007fc0: 2020 2020 456c 656d 656e 7420 2020 2020      Element     
+00007fd0: 2020 3d20 456c 656d 656e 7420 7379 6d62    = Element symb
+00007fe0: 6f6c 0d0a 2020 2020 2020 2020 2020 4e61  ol..          Na
+00007ff0: 6d65 2020 2020 2020 2020 2020 3d20 456c  me          = El
+00008000: 656d 656e 7420 6e61 6d65 0d0a 2020 2020  ement name..    
+00008010: 2020 2020 2020 4772 6f75 7020 2020 2020        Group     
+00008020: 2020 2020 3d20 456c 656d 656e 7420 4772      = Element Gr
+00008030: 6f75 7020 6f6e 2070 6572 696f 6469 6320  oup on periodic 
+00008040: 7461 626c 650d 0a20 2020 2020 2020 2020  table..         
+00008050: 2050 6572 696f 6420 2020 2020 2020 203d   Period        =
+00008060: 2045 6c65 6d65 6e74 2070 6572 696f 6420   Element period 
+00008070: 6f6e 2070 6572 696f 6469 6320 7461 626c  on periodic tabl
+00008080: 650d 0a20 2020 2020 2020 2020 2042 6c6f  e..          Blo
+00008090: 636b 2020 2020 2020 2020 203d 2045 6c65  ck         = Ele
+000080a0: 6d65 6e74 2065 6c65 6374 726f 6e69 6320  ment electronic 
+000080b0: 626c 6f63 6b20 2873 2c70 2c64 2c66 290d  block (s,p,d,f).
+000080c0: 0a20 2020 2020 2020 2020 2056 616c 656e  .          Valen
+000080d0: 6365 4520 2020 2020 203d 204e 756d 6265  ceE      = Numbe
+000080e0: 7220 6f66 2076 616c 656e 6365 2065 6c65  r of valence ele
+000080f0: 6374 726f 6e73 0d0a 2020 2020 2020 2020  ctrons..        
+00008100: 2020 436f 6e66 6967 2020 2020 2020 2020    Config        
+00008110: 3d20 456c 656d 656e 7420 656c 6563 7472  = Element electr
+00008120: 6f6e 6963 206f 7262 6974 616c 2063 6f6e  onic orbital con
+00008130: 6669 6775 7261 7469 6f6e 0d0a 2020 2020  figuration..    
+00008140: 2020 2020 2020 5261 6469 6920 2020 2020        Radii     
+00008150: 2020 2020 3d20 4174 6f6d 6963 2052 6164      = Atomic Rad
+00008160: 6969 2028 706d 290d 0a20 2020 2020 2020  ii (pm)..       
+00008170: 2020 2057 6569 6768 7420 2020 2020 2020     Weight       
+00008180: 203d 2053 7461 6e64 6172 6420 6174 6f6d   = Standard atom
+00008190: 6963 2077 6569 6768 7420 2867 290d 0a20  ic weight (g).. 
+000081a0: 2020 2020 2020 2020 2043 6f68 5f62 2020           Coh_b  
+000081b0: 2020 2020 2020 203d 2042 6f75 6e64 2063         = Bound c
+000081c0: 6f68 6572 656e 7420 6e65 7574 726f 6e20  oherent neutron 
+000081d0: 7363 6174 7465 7269 6e67 206c 656e 6774  scattering lengt
+000081e0: 680d 0a20 2020 2020 2020 2020 2049 6e63  h..          Inc
+000081f0: 5f62 2020 2020 2020 2020 203d 2042 6f75  _b         = Bou
+00008200: 6e64 2069 6e63 6f68 6572 656e 7420 6e65  nd incoherent ne
+00008210: 7574 726f 6e20 7363 6174 7465 7269 6e67  utron scattering
+00008220: 206c 656e 6774 680d 0a20 2020 2020 2020   length..       
+00008230: 2020 204e 6162 7320 2020 2020 2020 2020     Nabs         
+00008240: 203d 204e 6575 7472 6f6e 2061 6273 6f72   = Neutron absor
+00008250: 7074 696f 6e20 636f 6566 6669 6369 656e  ption coefficien
+00008260: 740d 0a20 2020 2020 2020 2020 204e 7363  t..          Nsc
+00008270: 6174 2020 2020 2020 2020 203d 204e 6575  at         = Neu
+00008280: 7472 6f6e 2073 6361 7474 6572 696e 6720  tron scattering 
+00008290: 636f 6566 6669 6369 656e 740d 0a20 2020  coefficient..   
+000082a0: 2020 2020 2020 2061 3120 2020 2020 2020         a1       
+000082b0: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+000082c0: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+000082d0: 2020 2020 2020 2062 3120 2020 2020 2020         b1       
+000082e0: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+000082f0: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+00008300: 2020 2020 2020 2061 3220 2020 2020 2020         a2       
+00008310: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+00008320: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+00008330: 2020 2020 2020 2062 3220 2020 2020 2020         b2       
+00008340: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+00008350: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+00008360: 2020 2020 2020 2061 3320 2020 2020 2020         a3       
+00008370: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+00008380: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+00008390: 2020 2020 2020 2062 3320 2020 2020 2020         b3       
+000083a0: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+000083b0: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+000083c0: 2020 2020 2020 2061 3420 2020 2020 2020         a4       
+000083d0: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+000083e0: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+000083f0: 2020 2020 2020 2062 3420 2020 2020 2020         b4       
+00008400: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+00008410: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+00008420: 2020 2020 2020 2063 2020 2020 2020 2020         c        
+00008430: 2020 2020 203d 2045 6c65 6374 726f 6e20       = Electron 
+00008440: 666f 726d 2066 6163 746f 720d 0a20 2020  form factor..   
+00008450: 2020 2020 2020 206a 305f 4120 2020 2020         j0_A     
+00008460: 2020 2020 203d 204d 6167 6e65 7469 6320       = Magnetic 
+00008470: 466f 726d 2066 6163 746f 720d 0a20 2020  Form factor..   
+00008480: 2020 2020 2020 206a 305f 6120 2020 2020         j0_a     
+00008490: 2020 2020 203d 204d 6167 6e65 7469 6320       = Magnetic 
+000084a0: 466f 726d 2066 6163 746f 720d 0a20 2020  Form factor..   
+000084b0: 2020 2020 2020 206a 305f 4220 2020 2020         j0_B     
+000084c0: 2020 2020 203d 204d 6167 6e65 7469 6320       = Magnetic 
+000084d0: 466f 726d 2066 6163 746f 720d 0a20 2020  Form factor..   
+000084e0: 2020 2020 2020 206a 305f 6220 2020 2020         j0_b     
+000084f0: 2020 2020 203d 204d 6167 6e65 7469 6320       = Magnetic 
+00008500: 466f 726d 2066 6163 746f 720d 0a20 2020  Form factor..   
+00008510: 2020 2020 2020 206a 305f 4320 2020 2020         j0_C     
+00008520: 2020 2020 203d 204d 6167 6e65 7469 6320       = Magnetic 
+00008530: 466f 726d 2066 6163 746f 720d 0a20 2020  Form factor..   
+00008540: 2020 2020 2020 206a 305f 6320 2020 2020         j0_c     
+00008550: 2020 2020 203d 204d 6167 6e65 7469 6320       = Magnetic 
+00008560: 466f 726d 2066 6163 746f 720d 0a20 2020  Form factor..   
+00008570: 2020 2020 2020 206a 305f 4420 2020 2020         j0_D     
+00008580: 2020 2020 203d 204d 6167 6e65 7469 6320       = Magnetic 
+00008590: 466f 726d 2066 6163 746f 720d 0a20 2020  Form factor..   
+000085a0: 2020 2020 2020 204b 2020 2020 2020 2020         K        
+000085b0: 2020 2020 203d 2078 2d72 6179 2061 6273       = x-ray abs
+000085c0: 6f72 7074 696f 6e20 6564 6765 0d0a 2020  orption edge..  
+000085d0: 2020 2020 2020 2020 4c31 2020 2020 2020          L1      
+000085e0: 2020 2020 2020 3d20 782d 7261 7920 6162        = x-ray ab
+000085f0: 736f 7270 7469 6f6e 2065 6467 650d 0a20  sorption edge.. 
+00008600: 2020 2020 2020 2020 204c 3220 2020 2020           L2     
+00008610: 2020 2020 2020 203d 2078 2d72 6179 2061         = x-ray a
+00008620: 6273 6f72 7074 696f 6e20 6564 6765 0d0a  bsorption edge..
+00008630: 2020 2020 2020 2020 2020 4c33 2020 2020            L3    
+00008640: 2020 2020 2020 2020 3d20 782d 7261 7920          = x-ray 
+00008650: 6162 736f 7270 7469 6f6e 2065 6467 650d  absorption edge.
+00008660: 0a20 2020 2020 2020 2020 204d 312e 2e2e  .          M1...
+00008670: 2020 2020 2020 2020 203d 2078 2d72 6179           = x-ray
+00008680: 2061 6273 6f72 7074 696f 6e20 6564 6765   absorption edge
+00008690: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
+000086a0: 2074 7279 3a0d 0a20 2020 2020 2020 2064   try:..        d
+000086b0: 6174 6120 3d20 6e70 2e67 656e 6672 6f6d  ata = np.genfrom
+000086c0: 7478 7428 4154 4f4d 4649 4c45 2c20 736b  txt(ATOMFILE, sk
+000086d0: 6970 5f68 6561 6465 723d 362c 2064 7479  ip_header=6, dty
+000086e0: 7065 3d4e 6f6e 652c 206e 616d 6573 3d54  pe=None, names=T
+000086f0: 7275 652c 2065 6e63 6f64 696e 673d 2761  rue, encoding='a
+00008700: 7363 6969 2729 0d0a 2020 2020 6578 6365  scii')..    exce
+00008710: 7074 2054 7970 6545 7272 6f72 3a0d 0a20  pt TypeError:.. 
+00008720: 2020 2020 2020 2023 204e 756d 7079 2076         # Numpy v
+00008730: 6572 7369 6f6e 203c 2031 2e31 340d 0a20  ersion < 1.14.. 
+00008740: 2020 2020 2020 2064 6174 6120 3d20 6e70         data = np
+00008750: 2e67 656e 6672 6f6d 7478 7428 4154 4f4d  .genfromtxt(ATOM
+00008760: 4649 4c45 2c20 736b 6970 5f68 6561 6465  FILE, skip_heade
+00008770: 723d 362c 2064 7479 7065 3d4e 6f6e 652c  r=6, dtype=None,
+00008780: 206e 616d 6573 3d54 7275 6529 0d0a 0d0a   names=True)....
+00008790: 2020 2020 6966 2065 6c65 6d65 6e74 7320      if elements 
+000087a0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000087b0: 2020 2020 2020 2320 656c 656d 656e 7473        # elements
+000087c0: 206d 7573 7420 6265 2061 206c 6973 7420   must be a list 
+000087d0: 652e 672e 205b 2743 6f27 2c27 4f27 5d0d  e.g. ['Co','O'].
+000087e0: 0a20 2020 2020 2020 2065 6c65 6d65 6e74  .        element
+000087f0: 7320 3d20 6e70 2e63 6861 722e 6c6f 7765  s = np.char.lowe
+00008800: 7228 6e70 2e61 7361 7272 6179 2865 6c65  r(np.asarray(ele
+00008810: 6d65 6e74 7329 2e72 6573 6861 7065 282d  ments).reshape(-
+00008820: 3129 290d 0a20 2020 2020 2020 2061 6c6c  1))..        all
+00008830: 5f65 6c65 6d65 6e74 7320 3d20 5b65 6c2e  _elements = [el.
+00008840: 6c6f 7765 7228 2920 666f 7220 656c 2069  lower() for el i
+00008850: 6e20 6461 7461 5b27 456c 656d 656e 7427  n data['Element'
+00008860: 5d5d 0d0a 2020 2020 2020 2020 2320 5468  ]]..        # Th
+00008870: 6973 2077 696c 6c20 6572 726f 7220 6966  is will error if
+00008880: 2074 6865 2072 6571 7569 7265 6420 656c   the required el
+00008890: 656d 656e 7420 646f 6573 6e27 7420 6578  ement doesn't ex
+000088a0: 6973 740d 0a20 2020 2020 2020 2074 7279  ist..        try
+000088b0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+000088c0: 6e64 6578 203d 205b 616c 6c5f 656c 656d  ndex = [all_elem
+000088d0: 656e 7473 2e69 6e64 6578 2865 6c29 2066  ents.index(el) f
+000088e0: 6f72 2065 6c20 696e 2065 6c65 6d65 6e74  or el in element
+000088f0: 735d 0d0a 2020 2020 2020 2020 6578 6365  s]..        exce
+00008900: 7074 2056 616c 7565 4572 726f 7220 6173  pt ValueError as
+00008910: 2076 653a 0d0a 2020 2020 2020 2020 2020   ve:..          
+00008920: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00008930: 6e28 2745 6c65 6d65 6e74 206e 6f74 2061  n('Element not a
+00008940: 7661 696c 6162 6c65 3a20 2573 2720 2520  vailable: %s' % 
+00008950: 7665 290d 0a20 2020 2020 2020 2064 6174  ve)..        dat
+00008960: 6120 3d20 6461 7461 5b69 6e64 6578 5d0d  a = data[index].
+00008970: 0a20 2020 2020 2020 2069 6620 6e70 2e61  .        if np.a
+00008980: 6e79 2864 6174 615b 275a 275d 203e 2039  ny(data['Z'] > 9
+00008990: 3229 3a0d 0a20 2020 2020 2020 2020 2020  2):..           
+000089a0: 206d 7367 203d 2027 456c 656d 656e 7420   msg = 'Element 
+000089b0: 2573 2064 6f65 7320 6e6f 7420 6861 7665  %s does not have
+000089c0: 2063 6f6d 706c 6574 6520 6174 6f6d 6963   complete atomic
+000089d0: 2070 726f 7065 7274 6965 732c 2073 6361   properties, sca
+000089e0: 7474 6572 696e 6720 6361 6c63 756c 6174  ttering calculat
+000089f0: 696f 6e73 2077 696c 6c20 6265 2069 6e61  ions will be ina
+00008a00: 6363 7572 6174 652e 270d 0a20 2020 2020  ccurate.'..     
+00008a10: 2020 2020 2020 2066 6f72 2065 6c20 696e         for el in
+00008a20: 2064 6174 615b 6461 7461 5b27 5a27 5d20   data[data['Z'] 
+00008a30: 3e20 3932 5d3a 0d0a 2020 2020 2020 2020  > 92]:..        
+00008a40: 2020 2020 2020 2020 7761 726e 286d 7367          warn(msg
+00008a50: 2025 2065 6c5b 2745 6c65 6d65 6e74 275d   % el['Element']
+00008a60: 290d 0a0d 0a20 2020 2069 6620 6669 656c  )....    if fiel
+00008a70: 6473 2069 7320 4e6f 6e65 3a0d 0a20 2020  ds is None:..   
+00008a80: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
+00008a90: 0d0a 0d0a 2020 2020 7265 7475 726e 2064  ....    return d
+00008aa0: 6174 615b 6669 656c 6473 5d0d 0a0d 0a0d  ata[fields].....
+00008ab0: 0a64 6566 2070 7269 6e74 5f61 746f 6d5f  .def print_atom_
+00008ac0: 7072 6f70 6572 7469 6573 2865 6c65 6d65  properties(eleme
+00008ad0: 6e74 733d 4e6f 6e65 293a 0d0a 2020 2020  nts=None):..    
+00008ae0: 2222 220d 0a20 2020 204f 7574 7075 7473  """..    Outputs
+00008af0: 2073 7472 696e 6720 6f66 2073 746f 7265   string of store
+00008b00: 6420 6174 6f6d 6963 2070 726f 7065 7274  d atomic propert
+00008b10: 6965 730d 0a20 2020 203a 7061 7261 6d20  ies..    :param 
+00008b20: 656c 656d 656e 7473 3a20 7374 7220 6f72  elements: str or
+00008b30: 206c 6973 7420 6f72 204e 6f6e 650d 0a20   list or None.. 
+00008b40: 2020 2020 2020 2020 2020 2073 7472 3a20             str: 
+00008b50: 2743 6f27 0d0a 2020 2020 2020 2020 2020  'Co'..          
+00008b60: 2020 6c69 7374 3a20 5b27 436f 272c 2027    list: ['Co', '
+00008b70: 4f27 5d0d 0a20 2020 203a 7265 7475 726e  O']..    :return
+00008b80: 3a20 7374 720d 0a20 2020 2022 2222 0d0a  : str..    """..
+00008b90: 0d0a 2020 2020 7072 6f70 203d 2061 746f  ..    prop = ato
+00008ba0: 6d5f 7072 6f70 6572 7469 6573 2865 6c65  m_properties(ele
+00008bb0: 6d65 6e74 7329 0d0a 2020 2020 6b65 7973  ments)..    keys
+00008bc0: 203d 2070 726f 702e 6474 7970 652e 6e61   = prop.dtype.na
+00008bd0: 6d65 730d 0a20 2020 2065 6c65 6e61 6d65  mes..    elename
+00008be0: 203d 2027 2027 2e6a 6f69 6e28 5b27 2531   = ' '.join(['%1
+00008bf0: 3073 2720 2520 656c 6520 666f 7220 656c  0s' % ele for el
+00008c00: 6520 696e 2070 726f 705b 2745 6c65 6d65  e in prop['Eleme
+00008c10: 6e74 275d 5d29 0d0a 2020 2020 6f75 7420  nt']])..    out 
+00008c20: 3d20 2725 3873 203a 2025 735c 6e27 2025  = '%8s : %s\n' %
+00008c30: 2028 2727 2c20 656c 656e 616d 6529 0d0a   ('', elename)..
+00008c40: 2020 2020 666f 7220 6b65 7920 696e 206b      for key in k
+00008c50: 6579 733a 0d0a 2020 2020 2020 2020 7072  eys:..        pr
+00008c60: 6f70 7661 6c20 3d20 2720 272e 6a6f 696e  opval = ' '.join
+00008c70: 285b 2725 3130 7327 2025 2065 6c65 2066  (['%10s' % ele f
+00008c80: 6f72 2065 6c65 2069 6e20 7072 6f70 5b6b  or ele in prop[k
+00008c90: 6579 5d5d 290d 0a20 2020 2020 2020 206f  ey]])..        o
+00008ca0: 7574 202b 3d20 2725 3873 203a 2025 735c  ut += '%8s : %s\
+00008cb0: 6e27 2025 2028 6b65 792c 2070 726f 7076  n' % (key, propv
+00008cc0: 616c 290d 0a20 2020 2072 6574 7572 6e20  al)..    return 
+00008cd0: 6f75 740d 0a0d 0a0d 0a64 6566 206e 6575  out......def neu
+00008ce0: 7472 6f6e 5f73 6361 7474 6572 696e 675f  tron_scattering_
+00008cf0: 6c65 6e67 7468 2865 6c65 6d65 6e74 293a  length(element):
+00008d00: 0d0a 2020 2020 2222 220d 0a20 2020 2052  ..    """..    R
+00008d10: 6574 7572 6e20 6e65 7574 726f 6e20 7363  eturn neutron sc
+00008d20: 6174 7465 7269 6e67 206c 656e 6774 682c  attering length,
+00008d30: 2062 2c20 696e 2066 6d0d 0a20 2020 2055   b, in fm..    U
+00008d40: 7365 7320 626f 756e 6420 636f 6865 7265  ses bound cohere
+00008d50: 6e74 2073 6361 7474 6572 696e 6720 6c65  nt scattering le
+00008d60: 6e67 7468 2066 726f 6d20 4e49 5354 0d0a  ngth from NIST..
+00008d70: 2020 2020 6874 7470 733a 2f2f 7777 772e      https://www.
+00008d80: 6e63 6e72 2e6e 6973 742e 676f 762f 7265  ncnr.nist.gov/re
+00008d90: 736f 7572 6365 732f 6e2d 6c65 6e67 7468  sources/n-length
+00008da0: 732f 0d0a 2020 2020 2062 203d 206e 6575  s/..     b = neu
+00008db0: 7472 6f6e 5f73 6361 7474 6572 696e 675f  tron_scattering_
+00008dc0: 6c65 6e67 7468 2827 436f 2729 0d0a 2020  length('Co')..  
+00008dd0: 2020 3a70 6172 616d 2065 6c65 6d65 6e74    :param element
+00008de0: 3a20 5b6e 2a73 7472 5d20 6c69 7374 206f  : [n*str] list o
+00008df0: 7220 6172 7261 7920 6f66 2065 6c65 6d65  r array of eleme
+00008e00: 6e74 730d 0a20 2020 203a 7265 7475 726e  nts..    :return
+00008e10: 3a20 5b6e 5d20 6172 7261 7920 6f66 2073  : [n] array of s
+00008e20: 6361 7474 6572 696e 6720 6c65 6e67 7468  cattering length
+00008e30: 730d 0a20 2020 2022 2222 0d0a 2020 2020  s..    """..    
+00008e40: 6220 3d20 6174 6f6d 5f70 726f 7065 7274  b = atom_propert
+00008e50: 6965 7328 656c 656d 656e 742c 205b 2743  ies(element, ['C
+00008e60: 6f68 5f62 275d 290d 0a20 2020 2072 6574  oh_b'])..    ret
+00008e70: 7572 6e20 620d 0a0d 0a0d 0a64 6566 2078  urn b......def x
+00008e80: 7261 795f 7363 6174 7465 7269 6e67 5f66  ray_scattering_f
+00008e90: 6163 746f 7228 656c 656d 656e 742c 2051  actor(element, Q
+00008ea0: 6d61 673d 3029 3a0d 0a20 2020 2022 2222  mag=0):..    """
+00008eb0: 0d0a 2020 2020 5265 6164 2058 2d72 6179  ..    Read X-ray
+00008ec0: 2073 6361 7474 6572 696e 6720 6661 6374   scattering fact
+00008ed0: 6f72 2074 6162 6c65 2c20 6361 6c63 756c  or table, calcul
+00008ee0: 6174 6520 6628 7c51 7c29 0d0a 2020 2020  ate f(|Q|)..    
+00008ef0: 5573 6573 2074 6865 2063 6f65 6666 6963  Uses the coeffic
+00008f00: 6965 6e74 7320 666f 7220 616e 616c 7974  ients for analyt
+00008f10: 6963 616c 2061 7070 726f 7869 6d61 7469  ical approximati
+00008f20: 6f6e 2074 6f20 7468 6520 7363 6174 7465  on to the scatte
+00008f30: 7269 6e67 2066 6163 746f 7273 202d 2049  ring factors - I
+00008f40: 5443 2c20 7035 3738 2054 6162 6c65 2036  TC, p578 Table 6
+00008f50: 2e31 2e31 2e34 0d0a 2020 2020 2051 6666  .1.1.4..     Qff
+00008f60: 203d 2078 7261 795f 7363 6174 7465 7269   = xray_scatteri
+00008f70: 6e67 5f66 6163 746f 7228 656c 656d 656e  ng_factor(elemen
+00008f80: 742c 2051 6d61 673d 5b30 5d29 0d0a 2020  t, Qmag=[0])..  
+00008f90: 2020 3a70 6172 616d 2065 6c65 6d65 6e74    :param element
+00008fa0: 3a20 5b6e 2a73 7472 5d20 6c69 7374 206f  : [n*str] list o
+00008fb0: 7220 6172 7261 7920 6f66 2065 6c65 6d65  r array of eleme
+00008fc0: 6e74 730d 0a20 2020 203a 7061 7261 6d20  nts..    :param 
+00008fd0: 516d 6167 3a20 5b6d 5d20 6172 7261 7920  Qmag: [m] array 
+00008fe0: 6f66 2077 6176 6576 6563 746f 7220 6469  of wavevector di
+00008ff0: 7374 616e 6365 2c20 696e 2041 5e2d 310d  stance, in A^-1.
+00009000: 0a20 2020 203a 7265 7475 726e 3a20 5b6d  .    :return: [m
+00009010: 2a6e 5d20 6172 7261 7920 6f66 2073 6361  *n] array of sca
+00009020: 7474 6572 696e 6720 6661 6374 6f72 730d  ttering factors.
+00009030: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
+00009040: 2320 516d 6167 2073 686f 756c 6420 6265  # Qmag should be
+00009050: 2061 2031 4420 6172 7261 790d 0a20 2020   a 1D array..   
+00009060: 2051 6d61 6720 3d20 6e70 2e61 7361 7272   Qmag = np.asarr
+00009070: 6179 2851 6d61 6729 2e72 6573 6861 7065  ay(Qmag).reshape
+00009080: 282d 3129 0d0a 0d0a 2020 2020 636f 6566  (-1)....    coef
+00009090: 203d 2061 746f 6d5f 7072 6f70 6572 7469   = atom_properti
+000090a0: 6573 2865 6c65 6d65 6e74 2c20 5b27 6131  es(element, ['a1
+000090b0: 272c 2027 6231 272c 2027 6132 272c 2027  ', 'b1', 'a2', '
+000090c0: 6232 272c 2027 6133 272c 2027 6233 272c  b2', 'a3', 'b3',
+000090d0: 2027 6134 272c 2027 6234 272c 2027 6327   'a4', 'b4', 'c'
+000090e0: 5d29 0d0a 0d0a 2020 2020 5166 6620 3d20  ])....    Qff = 
+000090f0: 6e70 2e7a 6572 6f73 285b 6c65 6e28 516d  np.zeros([len(Qm
+00009100: 6167 292c 206c 656e 2863 6f65 6629 5d29  ag), len(coef)])
+00009110: 0d0a 0d0a 2020 2020 2320 4c6f 6f70 206f  ....    # Loop o
+00009120: 7665 7220 656c 656d 656e 7473 0d0a 2020  ver elements..  
+00009130: 2020 666f 7220 6e20 696e 2072 616e 6765    for n in range
+00009140: 286c 656e 2863 6f65 6629 293a 0d0a 2020  (len(coef)):..  
+00009150: 2020 2020 2020 6131 203d 2063 6f65 665b        a1 = coef[
+00009160: 2761 3127 5d5b 6e5d 0d0a 2020 2020 2020  'a1'][n]..      
+00009170: 2020 6231 203d 2063 6f65 665b 2762 3127    b1 = coef['b1'
+00009180: 5d5b 6e5d 0d0a 2020 2020 2020 2020 6132  ][n]..        a2
+00009190: 203d 2063 6f65 665b 2761 3227 5d5b 6e5d   = coef['a2'][n]
+000091a0: 0d0a 2020 2020 2020 2020 6232 203d 2063  ..        b2 = c
+000091b0: 6f65 665b 2762 3227 5d5b 6e5d 0d0a 2020  oef['b2'][n]..  
+000091c0: 2020 2020 2020 6133 203d 2063 6f65 665b        a3 = coef[
+000091d0: 2761 3327 5d5b 6e5d 0d0a 2020 2020 2020  'a3'][n]..      
+000091e0: 2020 6233 203d 2063 6f65 665b 2762 3327    b3 = coef['b3'
+000091f0: 5d5b 6e5d 0d0a 2020 2020 2020 2020 6134  ][n]..        a4
+00009200: 203d 2063 6f65 665b 2761 3427 5d5b 6e5d   = coef['a4'][n]
+00009210: 0d0a 2020 2020 2020 2020 6234 203d 2063  ..        b4 = c
+00009220: 6f65 665b 2762 3427 5d5b 6e5d 0d0a 2020  oef['b4'][n]..  
+00009230: 2020 2020 2020 6320 3d20 636f 6566 5b27        c = coef['
+00009240: 6327 5d5b 6e5d 0d0a 0d0a 2020 2020 2020  c'][n]....      
+00009250: 2020 2320 4172 7261 7920 6d75 6c74 6970    # Array multip
+00009260: 6c69 6361 7469 6f6e 206f 7665 7220 516d  lication over Qm
+00009270: 6167 730d 0a20 2020 2020 2020 2066 203d  ags..        f =
+00009280: 2061 3120 2a20 6e70 2e65 7870 282d 6231   a1 * np.exp(-b1
+00009290: 202a 2028 516d 6167 202f 2028 3420 2a20   * (Qmag / (4 * 
+000092a0: 6e70 2e70 6929 2920 2a2a 2032 2920 2b20  np.pi)) ** 2) + 
+000092b0: 5c0d 0a20 2020 2020 2020 2020 2020 2061  \..            a
+000092c0: 3220 2a20 6e70 2e65 7870 282d 6232 202a  2 * np.exp(-b2 *
+000092d0: 2028 516d 6167 202f 2028 3420 2a20 6e70   (Qmag / (4 * np
+000092e0: 2e70 6929 2920 2a2a 2032 2920 2b20 5c0d  .pi)) ** 2) + \.
+000092f0: 0a20 2020 2020 2020 2020 2020 2061 3320  .            a3 
+00009300: 2a20 6e70 2e65 7870 282d 6233 202a 2028  * np.exp(-b3 * (
+00009310: 516d 6167 202f 2028 3420 2a20 6e70 2e70  Qmag / (4 * np.p
+00009320: 6929 2920 2a2a 2032 2920 2b20 5c0d 0a20  i)) ** 2) + \.. 
+00009330: 2020 2020 2020 2020 2020 2061 3420 2a20             a4 * 
+00009340: 6e70 2e65 7870 282d 6234 202a 2028 516d  np.exp(-b4 * (Qm
+00009350: 6167 202f 2028 3420 2a20 6e70 2e70 6929  ag / (4 * np.pi)
+00009360: 2920 2a2a 2032 2920 2b20 630d 0a20 2020  ) ** 2) + c..   
+00009370: 2020 2020 2051 6666 5b3a 2c20 6e5d 203d       Qff[:, n] =
+00009380: 2066 0d0a 2020 2020 7265 7475 726e 2051   f..    return Q
+00009390: 6666 0d0a 0d0a 0d0a 6465 6620 656c 6563  ff......def elec
+000093a0: 7472 6f6e 5f73 6361 7474 6572 696e 675f  tron_scattering_
+000093b0: 6661 6374 6f72 2865 6c65 6d65 6e74 2c20  factor(element, 
+000093c0: 516d 6167 3d30 293a 0d0a 2020 2020 2222  Qmag=0):..    ""
+000093d0: 220d 0a20 2020 2052 6561 6420 582d 7261  "..    Read X-ra
+000093e0: 7920 7363 6174 7465 7269 6e67 2066 6163  y scattering fac
+000093f0: 746f 7220 7461 626c 652c 2063 616c 6375  tor table, calcu
+00009400: 6c61 7465 2066 287c 517c 290d 0a20 2020  late f(|Q|)..   
+00009410: 2055 7365 7320 7468 6520 636f 6566 6669   Uses the coeffi
+00009420: 6369 656e 7473 2066 6f72 2061 6e61 6c79  cients for analy
+00009430: 7469 6361 6c20 6170 7072 6f78 696d 6174  tical approximat
+00009440: 696f 6e20 746f 2074 6865 2073 6361 7474  ion to the scatt
+00009450: 6572 696e 6720 6661 6374 6f72 7320 0d0a  ering factors ..
+00009460: 2020 2020 2020 5065 6e67 2c20 4c2e 204d        Peng, L. M
+00009470: 2e3b 2041 6374 6120 4372 7973 7461 6c6c  .; Acta Crystall
+00009480: 6f67 7220 4120 2031 3939 362c 2035 3220  ogr A  1996, 52 
+00009490: 2832 292c 2032 3537 e280 9332 3736 2e20  (2), 257...276. 
+000094a0: 0d0a 2020 2020 2020 5065 6e67 2c20 4c2e  ..      Peng, L.
+000094b0: 2d4d 2e20 2041 6374 6120 4372 7973 7420  -M.  Acta Cryst 
+000094c0: 4120 3139 3938 2c20 3534 2028 3429 2c20  A 1998, 54 (4), 
+000094d0: 3438 31e2 8093 3438 352e 200d 0a20 2020  481...485. ..   
+000094e0: 2051 6666 203d 2078 7261 795f 7363 6174   Qff = xray_scat
+000094f0: 7465 7269 6e67 5f66 6163 746f 7228 656c  tering_factor(el
+00009500: 656d 656e 742c 2051 6d61 673d 5b30 5d29  ement, Qmag=[0])
+00009510: 0d0a 2020 2020 3a70 6172 616d 2065 6c65  ..    :param ele
+00009520: 6d65 6e74 3a20 5b6e 2a73 7472 5d20 6c69  ment: [n*str] li
+00009530: 7374 206f 7220 6172 7261 7920 6f66 2065  st or array of e
+00009540: 6c65 6d65 6e74 730d 0a20 2020 203a 7061  lements..    :pa
+00009550: 7261 6d20 516d 6167 3a20 5b6d 5d20 6172  ram Qmag: [m] ar
+00009560: 7261 7920 6f66 2077 6176 6576 6563 746f  ray of wavevecto
+00009570: 7220 6469 7374 616e 6365 2c20 696e 2041  r distance, in A
+00009580: 5e2d 310d 0a20 2020 203a 7265 7475 726e  ^-1..    :return
+00009590: 3a20 5b6d 2a6e 5d20 6172 7261 7920 6f66  : [m*n] array of
+000095a0: 2073 6361 7474 6572 696e 6720 6661 6374   scattering fact
+000095b0: 6f72 730d 0a20 2020 2022 2222 0d0a 0d0a  ors..    """....
+000095c0: 2020 2020 2320 516d 6167 2073 686f 756c      # Qmag shoul
+000095d0: 6420 6265 2061 2031 4420 6172 7261 790d  d be a 1D array.
+000095e0: 0a20 2020 2051 6d61 6720 3d20 6e70 2e61  .    Qmag = np.a
+000095f0: 7361 7272 6179 2851 6d61 6729 2e72 6573  sarray(Qmag).res
+00009600: 6861 7065 282d 3129 0d0a 0d0a 2020 2020  hape(-1)....    
+00009610: 7472 793a 0d0a 2020 2020 2020 2020 6461  try:..        da
+00009620: 7461 203d 206e 702e 6765 6e66 726f 6d74  ta = np.genfromt
+00009630: 7874 2850 454e 4746 494c 452c 2073 6b69  xt(PENGFILE, ski
+00009640: 705f 6865 6164 6572 3d30 2c20 6474 7970  p_header=0, dtyp
+00009650: 653d 4e6f 6e65 2c20 6e61 6d65 733d 5472  e=None, names=Tr
+00009660: 7565 2c20 656e 636f 6469 6e67 3d27 6173  ue, encoding='as
+00009670: 6369 6927 2c20 6465 6c69 6d69 7465 723d  cii', delimiter=
+00009680: 272c 2729 0d0a 2020 2020 6578 6365 7074  ',')..    except
+00009690: 2054 7970 6545 7272 6f72 3a0d 0a20 2020   TypeError:..   
+000096a0: 2020 2020 2023 204e 756d 7079 2076 6572       # Numpy ver
+000096b0: 7369 6f6e 203c 2031 2e31 340d 0a20 2020  sion < 1.14..   
+000096c0: 2020 2020 2064 6174 6120 3d20 6e70 2e67       data = np.g
+000096d0: 656e 6672 6f6d 7478 7428 5045 4e47 4649  enfromtxt(PENGFI
+000096e0: 4c45 2c20 736b 6970 5f68 6561 6465 723d  LE, skip_header=
+000096f0: 302c 2064 7479 7065 3d4e 6f6e 652c 206e  0, dtype=None, n
+00009700: 616d 6573 3d54 7275 652c 2064 656c 696d  ames=True, delim
+00009710: 6974 6572 3d27 2c27 290d 0a20 2020 2023  iter=',')..    #
+00009720: 2065 6c65 6d65 6e74 7320 6d75 7374 2062   elements must b
+00009730: 6520 6120 6c69 7374 2065 2e67 2e20 5b27  e a list e.g. ['
+00009740: 436f 272c 274f 275d 0d0a 2020 2020 656c  Co','O']..    el
+00009750: 656d 656e 7473 5f6c 203d 206e 702e 6173  ements_l = np.as
+00009760: 6172 7261 7928 656c 656d 656e 7429 2e72  array(element).r
+00009770: 6573 6861 7065 282d 3129 0d0a 2020 2020  eshape(-1)..    
+00009780: 616c 6c5f 656c 656d 656e 7473 203d 205b  all_elements = [
+00009790: 656c 2066 6f72 2065 6c20 696e 2064 6174  el for el in dat
+000097a0: 615b 2745 6c65 6d65 6e74 275d 5d0d 0a20  a['Element']].. 
+000097b0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+000097c0: 2069 6e64 6578 203d 205b 616c 6c5f 656c   index = [all_el
+000097d0: 656d 656e 7473 2e69 6e64 6578 2865 6c29  ements.index(el)
+000097e0: 2066 6f72 2065 6c20 696e 2065 6c65 6d65   for el in eleme
+000097f0: 6e74 735f 6c5d 0d0a 2020 2020 6578 6365  nts_l]..    exce
+00009800: 7074 2056 616c 7565 4572 726f 7220 6173  pt ValueError as
+00009810: 2076 653a 0d0a 2020 2020 2020 2020 7261   ve:..        ra
+00009820: 6973 6520 4578 6365 7074 696f 6e28 2745  ise Exception('E
+00009830: 6c65 6d65 6e74 206e 6f74 2061 7661 696c  lement not avail
+00009840: 6162 6c65 3a20 2573 2720 2520 7665 290d  able: %s' % ve).
+00009850: 0a20 2020 2064 6174 6120 3d20 6461 7461  .    data = data
+00009860: 5b69 6e64 6578 5d0d 0a20 2020 2063 6f65  [index]..    coe
+00009870: 6620 3d20 6461 7461 5b5b 2761 3127 2c20  f = data[['a1', 
+00009880: 2762 3127 2c20 2761 3227 2c20 2762 3227  'b1', 'a2', 'b2'
+00009890: 2c20 2761 3327 2c20 2762 3327 2c20 2761  , 'a3', 'b3', 'a
+000098a0: 3427 2c20 2762 3427 2c20 2761 3527 2c20  4', 'b4', 'a5', 
+000098b0: 2762 3527 5d5d 0d0a 0d0a 2020 2020 5166  'b5']]....    Qf
+000098c0: 6620 3d20 6e70 2e7a 6572 6f73 285b 6c65  f = np.zeros([le
+000098d0: 6e28 516d 6167 292c 206c 656e 2863 6f65  n(Qmag), len(coe
+000098e0: 6629 5d29 0d0a 0d0a 2020 2020 2320 4c6f  f)])....    # Lo
+000098f0: 6f70 206f 7665 7220 656c 656d 656e 7473  op over elements
+00009900: 0d0a 2020 2020 666f 7220 6e20 696e 2072  ..    for n in r
+00009910: 616e 6765 286c 656e 2863 6f65 6629 293a  ange(len(coef)):
+00009920: 0d0a 2020 2020 2020 2020 6131 203d 2063  ..        a1 = c
+00009930: 6f65 665b 2761 3127 5d5b 6e5d 0d0a 2020  oef['a1'][n]..  
+00009940: 2020 2020 2020 6231 203d 2063 6f65 665b        b1 = coef[
+00009950: 2762 3127 5d5b 6e5d 0d0a 2020 2020 2020  'b1'][n]..      
+00009960: 2020 6132 203d 2063 6f65 665b 2761 3227    a2 = coef['a2'
+00009970: 5d5b 6e5d 0d0a 2020 2020 2020 2020 6232  ][n]..        b2
+00009980: 203d 2063 6f65 665b 2762 3227 5d5b 6e5d   = coef['b2'][n]
+00009990: 0d0a 2020 2020 2020 2020 6133 203d 2063  ..        a3 = c
+000099a0: 6f65 665b 2761 3327 5d5b 6e5d 0d0a 2020  oef['a3'][n]..  
+000099b0: 2020 2020 2020 6233 203d 2063 6f65 665b        b3 = coef[
+000099c0: 2762 3327 5d5b 6e5d 0d0a 2020 2020 2020  'b3'][n]..      
+000099d0: 2020 6134 203d 2063 6f65 665b 2761 3427    a4 = coef['a4'
+000099e0: 5d5b 6e5d 0d0a 2020 2020 2020 2020 6234  ][n]..        b4
+000099f0: 203d 2063 6f65 665b 2762 3427 5d5b 6e5d   = coef['b4'][n]
+00009a00: 0d0a 2020 2020 2020 2020 6135 203d 2063  ..        a5 = c
+00009a10: 6f65 665b 2761 3527 5d5b 6e5d 0d0a 2020  oef['a5'][n]..  
+00009a20: 2020 2020 2020 6235 203d 2063 6f65 665b        b5 = coef[
+00009a30: 2762 3527 5d5b 6e5d 0d0a 0d0a 2020 2020  'b5'][n]....    
+00009a40: 2020 2020 2320 4172 7261 7920 6d75 6c74      # Array mult
+00009a50: 6970 6c69 6361 7469 6f6e 206f 7665 7220  iplication over 
+00009a60: 516d 6167 730d 0a20 2020 2020 2020 2066  Qmags..        f
+00009a70: 203d 2061 3120 2a20 6e70 2e65 7870 282d   = a1 * np.exp(-
+00009a80: 6231 202a 2028 516d 6167 202f 2028 3420  b1 * (Qmag / (4 
+00009a90: 2a20 6e70 2e70 6929 2920 2a2a 2032 2920  * np.pi)) ** 2) 
+00009aa0: 2b20 5c0d 0a20 2020 2020 2020 2020 2020  + \..           
+00009ab0: 2061 3220 2a20 6e70 2e65 7870 282d 6232   a2 * np.exp(-b2
+00009ac0: 202a 2028 516d 6167 202f 2028 3420 2a20   * (Qmag / (4 * 
+00009ad0: 6e70 2e70 6929 2920 2a2a 2032 2920 2b20  np.pi)) ** 2) + 
+00009ae0: 5c0d 0a20 2020 2020 2020 2020 2020 2061  \..            a
+00009af0: 3320 2a20 6e70 2e65 7870 282d 6233 202a  3 * np.exp(-b3 *
+00009b00: 2028 516d 6167 202f 2028 3420 2a20 6e70   (Qmag / (4 * np
+00009b10: 2e70 6929 2920 2a2a 2032 2920 2b20 5c0d  .pi)) ** 2) + \.
+00009b20: 0a20 2020 2020 2020 2020 2020 2061 3420  .            a4 
+00009b30: 2a20 6e70 2e65 7870 282d 6234 202a 2028  * np.exp(-b4 * (
+00009b40: 516d 6167 202f 2028 3420 2a20 6e70 2e70  Qmag / (4 * np.p
+00009b50: 6929 2920 2a2a 2032 2920 2b20 5c0d 0a20  i)) ** 2) + \.. 
+00009b60: 2020 2020 2020 2020 2020 2061 3520 2a20             a5 * 
+00009b70: 6e70 2e65 7870 282d 6235 202a 2028 516d  np.exp(-b5 * (Qm
+00009b80: 6167 202f 2028 3420 2a20 6e70 2e70 6929  ag / (4 * np.pi)
+00009b90: 2920 2a2a 2032 290d 0a20 2020 2020 2020  ) ** 2)..       
+00009ba0: 2051 6666 5b3a 2c20 6e5d 203d 2066 0d0a   Qff[:, n] = f..
+00009bb0: 2020 2020 7265 7475 726e 2051 6666 0d0a      return Qff..
+00009bc0: 0d0a 0d0a 6465 6620 7872 6179 5f73 6361  ....def xray_sca
+00009bd0: 7474 6572 696e 675f 6661 6374 6f72 5f57  ttering_factor_W
+00009be0: 6161 734b 6972 6628 656c 656d 656e 742c  aasKirf(element,
+00009bf0: 2051 6d61 673d 3029 3a0d 0a20 2020 2022   Qmag=0):..    "
+00009c00: 2222 0d0a 2020 2020 5265 6164 2058 2d72  ""..    Read X-r
+00009c10: 6179 2073 6361 7474 6572 696e 6720 6661  ay scattering fa
+00009c20: 6374 6f72 2074 6162 6c65 2c20 6361 6c63  ctor table, calc
+00009c30: 756c 6174 6520 6628 7c51 7c29 0d0a 2020  ulate f(|Q|)..  
+00009c40: 2020 5573 6573 2074 6865 2063 6f65 6666    Uses the coeff
+00009c50: 6963 6965 6e74 7320 666f 7220 616e 616c  icients for anal
+00009c60: 7974 6963 616c 2061 7070 726f 7869 6d61  ytical approxima
+00009c70: 7469 6f6e 2074 6f20 7468 6520 7363 6174  tion to the scat
+00009c80: 7465 7269 6e67 2066 6163 746f 7273 2066  tering factors f
+00009c90: 726f 6d3a 0d0a 2020 2020 2020 2022 5761  rom:..       "Wa
+00009ca0: 6173 6d61 6965 7220 616e 6420 4b69 7266  asmaier and Kirf
+00009cb0: 656c 2c20 4163 7461 2043 7279 7374 2e20  el, Acta Cryst. 
+00009cc0: 2831 3939 3529 2041 3531 2c20 3431 362d  (1995) A51, 416-
+00009cd0: 3433 3122 0d0a 2020 2020 4669 6c65 2066  431"..    File f
+00009ce0: 726f 6d20 6874 7470 733a 2f2f 6769 7468  rom https://gith
+00009cf0: 7562 2e63 6f6d 2f64 6966 6670 792f 6c69  ub.com/diffpy/li
+00009d00: 6264 6966 6670 792f 626c 6f62 2f6d 6173  bdiffpy/blob/mas
+00009d10: 7465 722f 7372 632f 7275 6e74 696d 652f  ter/src/runtime/
+00009d20: 6630 5f57 6161 734b 6972 662e 6461 740d  f0_WaasKirf.dat.
+00009d30: 0a20 2020 2020 5166 6620 3d20 7872 6179  .     Qff = xray
+00009d40: 5f73 6361 7474 6572 696e 675f 6661 6374  _scattering_fact
+00009d50: 6f72 5f57 6161 734b 6972 6628 656c 656d  or_WaasKirf(elem
+00009d60: 656e 742c 2051 6d61 673d 5b30 5d29 0d0a  ent, Qmag=[0])..
+00009d70: 2020 2020 3a70 6172 616d 2065 6c65 6d65      :param eleme
+00009d80: 6e74 3a20 5b6e 2a73 7472 5d20 6c69 7374  nt: [n*str] list
+00009d90: 206f 7220 6172 7261 7920 6f66 2065 6c65   or array of ele
+00009da0: 6d65 6e74 730d 0a20 2020 203a 7061 7261  ments..    :para
+00009db0: 6d20 516d 6167 3a20 5b6d 5d20 6172 7261  m Qmag: [m] arra
+00009dc0: 7920 6f66 2077 6176 6576 6563 746f 7220  y of wavevector 
+00009dd0: 6469 7374 616e 6365 2c20 696e 2041 5e2d  distance, in A^-
+00009de0: 310d 0a20 2020 203a 7265 7475 726e 3a20  1..    :return: 
+00009df0: 5b6d 2a6e 5d20 6172 7261 7920 6f66 2073  [m*n] array of s
+00009e00: 6361 7474 6572 696e 6720 6661 6374 6f72  cattering factor
+00009e10: 730d 0a20 2020 2022 2222 0d0a 0d0a 2020  s..    """....  
+00009e20: 2020 6669 6c65 6e61 6d65 203d 206f 732e    filename = os.
+00009e30: 7061 7468 2e6a 6f69 6e28 6461 7461 6469  path.join(datadi
+00009e40: 722c 2027 6630 5f57 6161 734b 6972 662e  r, 'f0_WaasKirf.
+00009e50: 6461 7427 290d 0a20 2020 2064 6174 6120  dat')..    data 
+00009e60: 3d20 6e70 2e6c 6f61 6474 7874 2866 696c  = np.loadtxt(fil
+00009e70: 656e 616d 6529 0d0a 2020 2020 2320 6765  ename)..    # ge
+00009e80: 7420 6e61 6d65 730d 0a20 2020 2077 6974  t names..    wit
+00009e90: 6820 6f70 656e 2866 696c 656e 616d 6529  h open(filename)
+00009ea0: 2061 7320 663a 0d0a 2020 2020 2020 2020   as f:..        
+00009eb0: 6c69 6e65 7320 3d20 7265 2e66 696e 6461  lines = re.finda
+00009ec0: 6c6c 2827 2353 5c73 2b5c 642b 5c73 2b5b  ll('#S\s+\d+\s+[
+00009ed0: 412d 5a5d 2e2a 3f5c 6e27 2c20 662e 7265  A-Z].*?\n', f.re
+00009ee0: 6164 2829 290d 0a20 2020 2020 2020 2074  ad())..        t
+00009ef0: 6162 6c65 5f6e 616d 6573 203d 205b 6c69  able_names = [li
+00009f00: 6e65 5b37 3a5d 2e73 7472 6970 2829 2066  ne[7:].strip() f
+00009f10: 6f72 206c 696e 6520 696e 206c 696e 6573  or line in lines
+00009f20: 5d0d 0a0d 0a20 2020 2023 2051 6d61 6720  ]....    # Qmag 
+00009f30: 7368 6f75 6c64 2062 6520 6120 3144 2061  should be a 1D a
+00009f40: 7272 6179 0d0a 2020 2020 516d 6167 203d  rray..    Qmag =
+00009f50: 206e 702e 6173 6172 7261 7928 516d 6167   np.asarray(Qmag
+00009f60: 292e 7265 7368 6170 6528 2d31 290d 0a20  ).reshape(-1).. 
+00009f70: 2020 2065 6c65 6d65 6e74 203d 206e 702e     element = np.
+00009f80: 6173 6172 7261 7928 656c 656d 656e 742c  asarray(element,
+00009f90: 2064 7479 7065 3d73 7472 292e 7265 7368   dtype=str).resh
+00009fa0: 6170 6528 2d31 290d 0a0d 0a20 2020 2023  ape(-1)....    #
+00009fb0: 2064 6174 6120 7461 626c 653a 2061 3120   data table: a1 
+00009fc0: 2061 3220 2061 3320 2061 3420 2061 3520   a2  a3  a4  a5 
+00009fd0: 2063 2020 6231 2020 6232 2020 6233 2020   c  b1  b2  b3  
+00009fe0: 6234 2020 6235 0d0a 2020 2020 6964 7820  b4  b5..    idx 
+00009ff0: 3d20 5b74 6162 6c65 5f6e 616d 6573 2e69  = [table_names.i
+0000a000: 6e64 6578 2865 6c29 2066 6f72 2065 6c20  ndex(el) for el 
+0000a010: 696e 2065 6c65 6d65 6e74 5d0d 0a20 2020  in element]..   
+0000a020: 2063 6f65 6620 3d20 6461 7461 5b69 6478   coef = data[idx
+0000a030: 2c20 3a5d 0d0a 0d0a 2020 2020 5166 6620  , :]....    Qff 
+0000a040: 3d20 6e70 2e7a 6572 6f73 285b 6c65 6e28  = np.zeros([len(
+0000a050: 516d 6167 292c 206c 656e 2865 6c65 6d65  Qmag), len(eleme
+0000a060: 6e74 295d 290d 0a0d 0a20 2020 2023 204c  nt)])....    # L
+0000a070: 6f6f 7020 6f76 6572 2065 6c65 6d65 6e74  oop over element
+0000a080: 730d 0a20 2020 2066 6f72 206e 2069 6e20  s..    for n in 
+0000a090: 7261 6e67 6528 6c65 6e28 656c 656d 656e  range(len(elemen
+0000a0a0: 7429 293a 0d0a 2020 2020 2020 2020 6131  t)):..        a1
+0000a0b0: 2c20 6132 2c20 6133 2c20 6134 2c20 6135  , a2, a3, a4, a5
+0000a0c0: 2c20 632c 2062 312c 2062 322c 2062 332c  , c, b1, b2, b3,
+0000a0d0: 2062 342c 2062 3520 3d20 636f 6566 5b6e   b4, b5 = coef[n
+0000a0e0: 2c20 3a5d 0d0a 0d0a 2020 2020 2020 2020  , :]....        
+0000a0f0: 2320 4172 7261 7920 6d75 6c74 6970 6c69  # Array multipli
+0000a100: 6361 7469 6f6e 206f 7665 7220 516d 6167  cation over Qmag
+0000a110: 730d 0a20 2020 2020 2020 2023 2066 305b  s..        # f0[
+0000a120: 6b5d 203d 2063 202b 205b 5355 4d20 615f  k] = c + [SUM a_
+0000a130: 6920 2a20 4558 5028 2d62 5f69 202a 2028  i * EXP(-b_i * (
+0000a140: 6b20 5e20 3229 295d 2020 693d 312c 350d  k ^ 2))]  i=1,5.
+0000a150: 0a20 2020 2020 2020 2066 203d 2061 3120  .        f = a1 
+0000a160: 2a20 6e70 2e65 7870 282d 6231 202a 2028  * np.exp(-b1 * (
 0000a170: 516d 6167 202f 2028 3420 2a20 6e70 2e70  Qmag / (4 * np.p
-0000a180: 6929 2920 2a2a 2032 2920 2b20 630d 0a20  i)) ** 2) + c.. 
-0000a190: 2020 2020 2020 2066 6f72 2065 2069 6e20         for e in 
-0000a1a0: 7261 6e67 6528 6c65 6e28 656e 6572 6779  range(len(energy
-0000a1b0: 5f6b 6576 2929 3a0d 0a20 2020 2020 2020  _kev)):..       
-0000a1c0: 2020 2020 2051 6666 5b3a 2c20 6e2c 2065       Qff[:, n, e
-0000a1d0: 5d20 2b3d 2066 0d0a 2020 2020 7265 7475  ] += f..    retu
-0000a1e0: 726e 2051 6666 0d0a 0d0a 0d0a 6465 6620  rn Qff......def 
-0000a1f0: 6d61 676e 6574 6963 5f66 6f72 6d5f 6661  magnetic_form_fa
-0000a200: 6374 6f72 2865 6c65 6d65 6e74 2c20 516d  ctor(element, Qm
-0000a210: 6167 3d30 2e29 3a0d 0a20 2020 2022 2222  ag=0.):..    """
-0000a220: 0d0a 2020 2020 5265 6164 204d 6167 6e65  ..    Read Magne
-0000a230: 7469 6320 666f 726d 2066 6163 746f 7220  tic form factor 
-0000a240: 7461 626c 652c 2063 616c 6375 6c61 7465  table, calculate
-0000a250: 203c 6a30 287c 517c 293e 0d0a 2020 2020   <j0(|Q|)>..    
-0000a260: 416e 616c 7974 6963 616c 2061 7070 726f  Analytical appro
-0000a270: 7869 6d61 7469 6f6e 206f 6620 7468 6520  ximation of the 
-0000a280: 6d61 676e 6574 6963 2066 6f72 6d20 6661  magnetic form fa
-0000a290: 6374 6f72 3a0d 0a20 2020 2020 2020 203c  ctor:..        <
-0000a2a0: 6a30 287c 517c 293e 203d 2041 2a65 7870  j0(|Q|)> = A*exp
-0000a2b0: 282d 612a 735e 3229 202b 2042 2a65 7870  (-a*s^2) + B*exp
-0000a2c0: 282d 622a 735e 3229 202b 2043 2a65 7870  (-b*s^2) + C*exp
-0000a2d0: 282d 632a 735e 3229 202b 2044 2c20 7768  (-c*s^2) + D, wh
-0000a2e0: 6572 6520 7320 3d20 7369 6e28 7468 6574  ere s = sin(thet
-0000a2f0: 6129 2f6c 616d 6264 6120 696e 2041 2d31  a)/lambda in A-1
-0000a300: 0d0a 2020 2020 5365 6520 6d6f 7265 2061  ..    See more a
-0000a310: 626f 7574 2074 6865 2061 7070 726f 7869  bout the approxi
-0000a320: 6d61 7469 6f20 6865 7265 3a20 6874 7470  matio here: http
-0000a330: 733a 2f2f 7777 772e 696c 6c2e 6575 2f73  s://www.ill.eu/s
-0000a340: 6974 6573 2f63 6373 6c2f 6666 6163 7473  ites/ccsl/ffacts
-0000a350: 2f66 6661 6374 6e6f 6465 332e 6874 6d6c  /ffactnode3.html
-0000a360: 0d0a 2020 2020 4e6f 7465 3a20 4375 7272  ..    Note: Curr
-0000a370: 656e 746c 7920 6f6e 6c79 204a 3020 7465  ently only J0 te
-0000a380: 726d 7320 6172 6520 7573 6564 2061 6e64  rms are used and
-0000a390: 2035 6420 6174 6f6d 7320 6172 6520 6e6f   5d atoms are no
-0000a3a0: 7420 6375 7272 656e 746c 7920 696e 636c  t currently incl
-0000a3b0: 7564 6564 0d0a 2020 2020 5573 6167 653a  uded..    Usage:
-0000a3c0: 0d0a 2020 2020 2020 2020 2051 6666 203d  ..         Qff =
-0000a3d0: 2072 6561 645f 6d66 6628 656c 656d 656e   read_mff(elemen
-0000a3e0: 742c 516d 6167 290d 0a20 2020 2020 2020  t,Qmag)..       
-0000a3f0: 2020 656c 656d 656e 7420 3d20 7374 7220    element = str 
-0000a400: 656c 656d 656e 7420 6e61 6d65 2c20 652e  element name, e.
-0000a410: 672e 2027 436f 270d 0a20 2020 2020 2020  g. 'Co'..       
-0000a420: 2020 516d 6167 203d 206d 6167 6e69 7475    Qmag = magnitu
-0000a430: 6465 206f 6620 513d 7369 6e28 7468 6574  de of Q=sin(thet
-0000a440: 6129 2f6c 616d 6264 6120 696e 2041 2d31  a)/lambda in A-1
-0000a450: 2061 7420 7768 6963 6820 746f 2063 616c   at which to cal
-0000a460: 6375 616c 7465 2c20 6361 6e20 6265 2061  cualte, can be a
-0000a470: 206c 6973 7420 6f72 2061 7272 6179 2074   list or array t
-0000a480: 6f20 7265 7475 726e 206d 756c 7469 706c  o return multipl
-0000a490: 6520 7661 6c75 6573 0d0a 2020 2020 2020  e values..      
-0000a4a0: 2020 2051 6666 203d 204d 6167 6e65 7469     Qff = Magneti
-0000a4b0: 6320 666f 726d 2066 6163 746f 7220 666f  c form factor fo
-0000a4c0: 7220 656c 656d 656e 7420 6174 2051 6d61  r element at Qma
-0000a4d0: 670d 0a20 2020 2045 2e47 2e0d 0a20 2020  g..    E.G...   
-0000a4e0: 2020 2020 2051 6666 203d 2072 6561 645f       Qff = read_
-0000a4f0: 6d66 6628 2743 6f27 2c6e 702e 6172 616e  mff('Co',np.aran
-0000a500: 6765 2830 2c34 2c30 2e31 2929 0d0a 2020  ge(0,4,0.1))..  
-0000a510: 2020 2222 220d 0a0d 0a20 2020 2023 2051    """....    # Q
-0000a520: 6d61 6720 7368 6f75 6c64 2062 6520 6120  mag should be a 
-0000a530: 3144 2061 7272 6179 0d0a 2020 2020 2320  1D array..    # 
-0000a540: 7320 3d20 7369 6e28 7468 292f 6c61 6d62  s = sin(th)/lamb
-0000a550: 6461 203d 207c 517c 2f34 7069 0d0a 2020  da = |Q|/4pi..  
-0000a560: 2020 7320 3d20 6e70 2e61 7361 7272 6179    s = np.asarray
-0000a570: 2851 6d61 6729 2e72 6573 6861 7065 282d  (Qmag).reshape(-
-0000a580: 3129 202f 2028 3420 2a20 6e70 2e70 6929  1) / (4 * np.pi)
-0000a590: 0d0a 0d0a 2020 2020 636f 6566 203d 2061  ....    coef = a
-0000a5a0: 746f 6d5f 7072 6f70 6572 7469 6573 2865  tom_properties(e
-0000a5b0: 6c65 6d65 6e74 2c20 5b27 6a30 5f41 272c  lement, ['j0_A',
-0000a5c0: 2027 6a30 5f61 272c 2027 6a30 5f42 272c   'j0_a', 'j0_B',
-0000a5d0: 2027 6a30 5f62 272c 2027 6a30 5f43 272c   'j0_b', 'j0_C',
-0000a5e0: 2027 6a30 5f63 272c 2027 6a30 5f44 275d   'j0_c', 'j0_D']
-0000a5f0: 290d 0a0d 0a20 2020 2023 204e 7170 6f69  )....    # Nqpoi
-0000a600: 6e74 696e 6773 2078 204e 656c 656d 656e  ntings x Nelemen
-0000a610: 7473 0d0a 2020 2020 5166 6620 3d20 6e70  ts..    Qff = np
-0000a620: 2e7a 6572 6f73 285b 6c65 6e28 7329 2c20  .zeros([len(s), 
-0000a630: 6c65 6e28 636f 6566 295d 290d 0a0d 0a20  len(coef)]).... 
-0000a640: 2020 2023 204c 6f6f 7020 6f76 6572 2065     # Loop over e
-0000a650: 6c65 6d65 6e74 730d 0a20 2020 2066 6f72  lements..    for
-0000a660: 206e 2069 6e20 7261 6e67 6528 6c65 6e28   n in range(len(
-0000a670: 636f 6566 2929 3a0d 0a20 2020 2020 2020  coef)):..       
-0000a680: 2041 203d 2063 6f65 665b 276a 305f 4127   A = coef['j0_A'
-0000a690: 5d5b 6e5d 0d0a 2020 2020 2020 2020 6120  ][n]..        a 
-0000a6a0: 3d20 636f 6566 5b27 6a30 5f61 275d 5b6e  = coef['j0_a'][n
-0000a6b0: 5d0d 0a20 2020 2020 2020 2042 203d 2063  ]..        B = c
-0000a6c0: 6f65 665b 276a 305f 4227 5d5b 6e5d 0d0a  oef['j0_B'][n]..
-0000a6d0: 2020 2020 2020 2020 6220 3d20 636f 6566          b = coef
-0000a6e0: 5b27 6a30 5f62 275d 5b6e 5d0d 0a20 2020  ['j0_b'][n]..   
-0000a6f0: 2020 2020 2043 203d 2063 6f65 665b 276a       C = coef['j
-0000a700: 305f 4327 5d5b 6e5d 0d0a 2020 2020 2020  0_C'][n]..      
-0000a710: 2020 6320 3d20 636f 6566 5b27 6a30 5f63    c = coef['j0_c
-0000a720: 275d 5b6e 5d0d 0a20 2020 2020 2020 2044  '][n]..        D
-0000a730: 203d 2063 6f65 665b 276a 305f 4427 5d5b   = coef['j0_D'][
-0000a740: 6e5d 0d0a 0d0a 2020 2020 2020 2020 6a30  n]....        j0
-0000a750: 203d 2041 202a 206e 702e 6578 7028 2d61   = A * np.exp(-a
-0000a760: 202a 2073 202a 2a20 3229 202b 205c 0d0a   * s ** 2) + \..
-0000a770: 2020 2020 2020 2020 2020 2020 2042 202a               B *
-0000a780: 206e 702e 6578 7028 2d62 202a 2073 202a   np.exp(-b * s *
-0000a790: 2a20 3229 202b 205c 0d0a 2020 2020 2020  * 2) + \..      
-0000a7a0: 2020 2020 2020 2043 202a 206e 702e 6578         C * np.ex
-0000a7b0: 7028 2d63 202a 2073 202a 2a20 3229 202b  p(-c * s ** 2) +
-0000a7c0: 2044 0d0a 2020 2020 2020 2020 5166 665b   D..        Qff[
-0000a7d0: 3a2c 206e 5d20 3d20 6a30 0d0a 2020 2020  :, n] = j0..    
-0000a7e0: 7265 7475 726e 2051 6666 0d0a 0d0a 0d0a  return Qff......
-0000a7f0: 6465 6620 6174 7465 6e75 6174 696f 6e28  def attenuation(
-0000a800: 656c 656d 656e 745f 7a2c 2065 6e65 7267  element_z, energ
-0000a810: 795f 6b65 5629 3a0d 0a20 2020 2022 2222  y_keV):..    """
-0000a820: 0d0a 2020 2020 2052 6574 7572 6e73 2074  ..     Returns t
-0000a830: 6865 2078 2d72 6179 206d 6173 7320 6174  he x-ray mass at
-0000a840: 7465 6e75 6174 696f 6e2c 2075 2f70 2c20  tenuation, u/p, 
-0000a850: 696e 2063 6d5e 322f 670d 0a20 2020 2020  in cm^2/g..     
-0000a860: 2020 652e 672e 2041 203d 2061 7474 656e    e.g. A = atten
-0000a870: 7561 7469 6f6e 2832 332c 6e70 2e61 7261  uation(23,np.ara
-0000a880: 6e67 6528 372c 382c 302e 3031 2929 2023  nge(7,8,0.01)) #
-0000a890: 2043 750d 0a20 2020 2020 2020 2020 2020   Cu..           
-0000a8a0: 2041 203d 2061 7474 656e 7561 7469 6f6e   A = attenuation
-0000a8b0: 285b 3233 2c32 342c 3235 5d2c 2035 2e36  ([23,24,25], 5.6
-0000a8c0: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-0000a8d0: 203d 2061 7474 656e 7561 7469 6f6e 2831   = attenuation(1
-0000a8e0: 392c 342e 3529 2023 204b 0d0a 2020 2020  9,4.5) # K..    
-0000a8f0: 2222 220d 0a20 2020 2065 6c65 6d65 6e74  """..    element
-0000a900: 5f7a 203d 206e 702e 6173 6172 7261 7928  _z = np.asarray(
-0000a910: 656c 656d 656e 745f 7a29 2e72 6573 6861  element_z).resha
-0000a920: 7065 282d 3129 0d0a 2020 2020 656e 6572  pe(-1)..    ener
-0000a930: 6779 5f6b 6556 203d 206e 702e 6173 6172  gy_keV = np.asar
-0000a940: 7261 7928 656e 6572 6779 5f6b 6556 292e  ray(energy_keV).
-0000a950: 7265 7368 6170 6528 2d31 290d 0a0d 0a20  reshape(-1).... 
-0000a960: 2020 2078 6d61 5f66 696c 6520 3d20 6f73     xma_file = os
-0000a970: 2e70 6174 682e 6a6f 696e 2864 6174 6164  .path.join(datad
-0000a980: 6972 2c20 2758 5261 794d 6173 7341 7474  ir, 'XRayMassAtt
-0000a990: 656e 5f6d 7570 2e64 6174 2729 0d0a 2020  en_mup.dat')..  
-0000a9a0: 2020 786d 615f 6461 7461 203d 206e 702e    xma_data = np.
-0000a9b0: 6c6f 6164 7478 7428 786d 615f 6669 6c65  loadtxt(xma_file
-0000a9c0: 290d 0a0d 0a20 2020 2065 6e65 7267 6965  )....    energie
-0000a9d0: 7320 3d20 786d 615f 6461 7461 5b3a 2c20  s = xma_data[:, 
-0000a9e0: 305d 202f 2031 3030 302e 0d0a 2020 2020  0] / 1000...    
-0000a9f0: 6f75 7420 3d20 6e70 2e7a 6572 6f73 285b  out = np.zeros([
-0000aa00: 6c65 6e28 656e 6572 6779 5f6b 6556 292c  len(energy_keV),
-0000aa10: 206c 656e 2865 6c65 6d65 6e74 5f7a 295d   len(element_z)]
-0000aa20: 290d 0a20 2020 2066 6f72 206e 2c20 7a20  )..    for n, z 
-0000aa30: 696e 2065 6e75 6d65 7261 7465 2865 6c65  in enumerate(ele
-0000aa40: 6d65 6e74 5f7a 293a 0d0a 2020 2020 2020  ment_z):..      
-0000aa50: 2020 2320 496e 7465 7270 6f6c 6174 696e    # Interpolatin
-0000aa60: 6720 7468 6520 6c6f 6720 7661 6c75 6573  g the log values
-0000aa70: 2069 7320 6d75 6368 206d 6f72 6520 7265   is much more re
-0000aa80: 6c69 6162 6c65 0d0a 2020 2020 2020 2020  liable..        
-0000aa90: 6f75 745b 3a2c 206e 5d20 3d20 6e70 2e65  out[:, n] = np.e
-0000aaa0: 7870 286e 702e 696e 7465 7270 286e 702e  xp(np.interp(np.
-0000aab0: 6c6f 6728 656e 6572 6779 5f6b 6556 292c  log(energy_keV),
-0000aac0: 206e 702e 6c6f 6728 656e 6572 6769 6573   np.log(energies
-0000aad0: 292c 206e 702e 6c6f 6728 786d 615f 6461  ), np.log(xma_da
-0000aae0: 7461 5b3a 2c20 7a5d 2929 290d 0a20 2020  ta[:, z])))..   
-0000aaf0: 2020 2020 206f 7574 5b3a 2c20 6e5d 203d       out[:, n] =
-0000ab00: 206e 702e 696e 7465 7270 2865 6e65 7267   np.interp(energ
-0000ab10: 795f 6b65 562c 2065 6e65 7267 6965 732c  y_keV, energies,
-0000ab20: 2078 6d61 5f64 6174 615b 3a2c 207a 5d29   xma_data[:, z])
-0000ab30: 0d0a 2020 2020 6966 206c 656e 2865 6c65  ..    if len(ele
-0000ab40: 6d65 6e74 5f7a 2920 3d3d 2031 3a0d 0a20  ment_z) == 1:.. 
-0000ab50: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
-0000ab60: 745b 3a2c 2030 5d0d 0a20 2020 2072 6574  t[:, 0]..    ret
-0000ab70: 7572 6e20 6f75 740d 0a0d 0a0d 0a64 6566  urn out......def
-0000ab80: 2061 746f 6d69 635f 7363 6174 7465 7269   atomic_scatteri
-0000ab90: 6e67 5f66 6163 746f 7228 656c 656d 656e  ng_factor(elemen
-0000aba0: 742c 2065 6e65 7267 795f 6b65 763d 4e6f  t, energy_kev=No
-0000abb0: 6e65 293a 0d0a 2020 2020 2222 220d 0a20  ne):..    """.. 
-0000abc0: 2020 2052 6561 6420 6174 6f6d 6963 2073     Read atomic s
-0000abd0: 6361 7474 6572 696e 6720 6661 6374 6f72  cattering factor
-0000abe0: 2074 6162 6c65 2c20 6769 7669 6e67 2066   table, giving f
-0000abf0: 312b 6632 2066 6f72 2064 6966 6665 7265  1+f2 for differe
-0000ac00: 6e74 2065 6e65 7267 6965 730d 0a20 2020  nt energies..   
-0000ac10: 2046 726f 6d3a 2068 7474 703a 2f2f 6865   From: http://he
-0000ac20: 6e6b 652e 6c62 6c2e 676f 762f 6f70 7469  nke.lbl.gov/opti
-0000ac30: 6361 6c5f 636f 6e73 7461 6e74 732f 6173  cal_constants/as
-0000ac40: 662e 6874 6d6c 0d0a 2020 2020 3a70 6172  f.html..    :par
-0000ac50: 616d 2065 6c65 6d65 6e74 3a20 7374 7220  am element: str 
-0000ac60: 6f72 206c 6973 7420 6f66 2073 7472 2c20  or list of str, 
-0000ac70: 6e61 6d65 206f 6620 656c 656d 656e 742e  name of element.
-0000ac80: 2049 6620 656c 656d 656e 7420 7374 7269   If element stri
-0000ac90: 6e67 2069 6e63 6c75 6465 7320 6120 6e75  ng includes a nu
-0000aca0: 6d62 6572 2c20 7468 6973 2077 696c 6c20  mber, this will 
-0000acb0: 6d75 6c74 6970 6c79 2076 616c 7565 730d  multiply values.
-0000acc0: 0a20 2020 203a 7061 7261 6d20 656e 6572  .    :param ener
-0000acd0: 6779 5f6b 6576 3a20 666c 6f61 7420 6f72  gy_kev: float or
-0000ace0: 206c 6973 7420 656e 6572 6779 2069 6e20   list energy in 
-0000acf0: 6b65 5620 284e 6f6e 6520 746f 2072 6574  keV (None to ret
-0000ad00: 7572 6e20 6f72 6967 696e 616c 2c20 756e  urn original, un
-0000ad10: 696e 7465 7270 6f6c 6174 6564 206c 6973  interpolated lis
-0000ad20: 7429 0d0a 2020 2020 3a72 6574 7572 6e3a  t)..    :return:
-0000ad30: 2066 312c 2066 322c 2073 6861 7065 2064   f1, f2, shape d
-0000ad40: 6570 656e 6465 6e74 206f 6e20 7368 6170  ependent on shap
-0000ad50: 6573 206f 6620 656c 656d 656e 7420 616e  es of element an
-0000ad60: 6420 656e 6572 6779 5f6b 6576 3a20 2066  d energy_kev:  f
-0000ad70: 6c6f 6174 2c20 6f72 205b 656e 655d 206f  loat, or [ene] o
-0000ad80: 7220 5b65 6c65 2c20 656e 655d 0d0a 2020  r [ele, ene]..  
-0000ad90: 2020 2222 220d 0a20 2020 2061 7366 5f66    """..    asf_f
-0000ada0: 696c 6520 3d20 6f73 2e70 6174 682e 6a6f  ile = os.path.jo
-0000adb0: 696e 2864 6174 6164 6972 2c20 2761 746f  in(datadir, 'ato
-0000adc0: 6d69 635f 7363 6174 7465 7269 6e67 5f66  mic_scattering_f
-0000add0: 6163 746f 7273 2e6e 7079 2729 0d0a 2020  actors.npy')..  
-0000ade0: 2020 6173 6620 3d20 6e70 2e6c 6f61 6428    asf = np.load(
-0000adf0: 6173 665f 6669 6c65 2c20 616c 6c6f 775f  asf_file, allow_
-0000ae00: 7069 636b 6c65 3d54 7275 6529 0d0a 2020  pickle=True)..  
-0000ae10: 2020 6173 6620 3d20 6173 662e 6974 656d    asf = asf.item
-0000ae20: 2829 0d0a 0d0a 2020 2020 656c 656d 656e  ()....    elemen
-0000ae30: 7420 3d20 6e70 2e61 7361 7272 6179 2865  t = np.asarray(e
-0000ae40: 6c65 6d65 6e74 2c20 6474 7970 653d 7374  lement, dtype=st
-0000ae50: 7229 2e72 6573 6861 7065 282d 3129 0d0a  r).reshape(-1)..
-0000ae60: 2020 2020 656e 6572 6779 203d 207b 7d0d      energy = {}.
-0000ae70: 0a20 2020 2066 3120 3d20 7b7d 0d0a 2020  .    f1 = {}..  
-0000ae80: 2020 6632 203d 207b 7d0d 0a20 2020 2066    f2 = {}..    f
-0000ae90: 6f72 2065 6c20 696e 2065 6c65 6d65 6e74  or el in element
-0000aea0: 3a0d 0a20 2020 2020 2020 206e 616d 652c  :..        name,
-0000aeb0: 206f 6363 2c20 6368 6172 6765 203d 2073   occ, charge = s
-0000aec0: 706c 6974 5f65 6c65 6d65 6e74 5f73 796d  plit_element_sym
-0000aed0: 626f 6c28 656c 290d 0a20 2020 2020 2020  bol(el)..       
-0000aee0: 2065 6e65 7267 795b 656c 5d20 3d20 6e70   energy[el] = np
-0000aef0: 2e61 7272 6179 2861 7366 5b6e 616d 655d  .array(asf[name]
-0000af00: 5b27 656e 6572 6779 275d 2920 2f20 3130  ['energy']) / 10
-0000af10: 3030 2e20 2023 2065 5620 2d3e 206b 6556  00.  # eV -> keV
-0000af20: 0d0a 2020 2020 2020 2020 6631 5b65 6c5d  ..        f1[el]
-0000af30: 203d 206e 702e 6172 7261 7928 6173 665b   = np.array(asf[
-0000af40: 6e61 6d65 5d5b 2766 3127 5d29 0d0a 2020  name]['f1'])..  
-0000af50: 2020 2020 2020 6632 5b65 6c5d 203d 206e        f2[el] = n
-0000af60: 702e 6172 7261 7928 6173 665b 6e61 6d65  p.array(asf[name
-0000af70: 5d5b 2766 3227 5d29 0d0a 2020 2020 2020  ]['f2'])..      
-0000af80: 2020 6631 5b65 6c5d 5b66 315b 656c 5d20    f1[el][f1[el] 
-0000af90: 3c20 2d31 3030 305d 203d 206e 702e 6e61  < -1000] = np.na
-0000afa0: 6e0d 0a20 2020 2020 2020 2066 325b 656c  n..        f2[el
-0000afb0: 5d5b 6632 5b65 6c5d 203c 202d 3130 3030  ][f2[el] < -1000
-0000afc0: 5d20 3d20 6e70 2e6e 616e 0d0a 2020 2020  ] = np.nan..    
-0000afd0: 2020 2020 6631 5b65 6c5d 203d 2066 315b      f1[el] = f1[
-0000afe0: 656c 5d20 2a20 6f63 630d 0a20 2020 2020  el] * occ..     
-0000aff0: 2020 2066 325b 656c 5d20 3d20 6632 5b65     f2[el] = f2[e
-0000b000: 6c5d 202a 206f 6363 0d0a 0d0a 2020 2020  l] * occ....    
-0000b010: 6966 2065 6e65 7267 795f 6b65 7620 6973  if energy_kev is
-0000b020: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000b030: 6966 206c 656e 2865 6c65 6d65 6e74 2920  if len(element) 
-0000b040: 3d3d 2031 3a0d 0a20 2020 2020 2020 2020  == 1:..         
-0000b050: 2020 2072 6574 7572 6e20 656e 6572 6779     return energy
-0000b060: 5b65 6c5d 2c20 6631 5b65 6c5d 2c20 6632  [el], f1[el], f2
-0000b070: 5b65 6c5d 0d0a 2020 2020 2020 2020 7265  [el]..        re
-0000b080: 7475 726e 2065 6e65 7267 792c 2066 312c  turn energy, f1,
-0000b090: 2066 320d 0a0d 0a20 2020 2023 2049 6e74   f2....    # Int
-0000b0a0: 6572 706f 6c61 7465 2076 616c 7565 730d  erpolate values.
-0000b0b0: 0a20 2020 2069 6620 6c65 6e28 656c 656d  .    if len(elem
-0000b0c0: 656e 7429 203d 3d20 313a 0d0a 2020 2020  ent) == 1:..    
-0000b0d0: 2020 2020 6966 3120 3d20 6e70 2e69 6e74      if1 = np.int
-0000b0e0: 6572 7028 656e 6572 6779 5f6b 6576 2c20  erp(energy_kev, 
-0000b0f0: 656e 6572 6779 5b65 6c5d 2c20 6631 5b65  energy[el], f1[e
-0000b100: 6c5d 290d 0a20 2020 2020 2020 2069 6632  l])..        if2
-0000b110: 203d 206e 702e 696e 7465 7270 2865 6e65   = np.interp(ene
-0000b120: 7267 795f 6b65 762c 2065 6e65 7267 795b  rgy_kev, energy[
-0000b130: 656c 5d2c 2066 325b 656c 5d29 0d0a 2020  el], f2[el])..  
-0000b140: 2020 2020 2020 7265 7475 726e 2069 6631        return if1
-0000b150: 2c20 6966 320d 0a20 2020 2069 6631 203d  , if2..    if1 =
-0000b160: 206e 702e 7a65 726f 7328 5b6c 656e 2865   np.zeros([len(e
-0000b170: 6c65 6d65 6e74 292c 206e 702e 7369 7a65  lement), np.size
-0000b180: 2865 6e65 7267 795f 6b65 7629 5d29 0d0a  (energy_kev)])..
-0000b190: 2020 2020 6966 3220 3d20 6e70 2e7a 6572      if2 = np.zer
-0000b1a0: 6f73 285b 6c65 6e28 656c 656d 656e 7429  os([len(element)
-0000b1b0: 2c20 6e70 2e73 697a 6528 656e 6572 6779  , np.size(energy
-0000b1c0: 5f6b 6576 295d 290d 0a20 2020 2066 6f72  _kev)])..    for
-0000b1d0: 206e 2c20 656c 2069 6e20 656e 756d 6572   n, el in enumer
-0000b1e0: 6174 6528 656c 656d 656e 7429 3a0d 0a20  ate(element):.. 
-0000b1f0: 2020 2020 2020 2069 6631 5b6e 2c20 3a5d         if1[n, :]
-0000b200: 203d 206e 702e 696e 7465 7270 2865 6e65   = np.interp(ene
-0000b210: 7267 795f 6b65 762c 2065 6e65 7267 795b  rgy_kev, energy[
-0000b220: 656c 5d2c 2066 315b 656c 5d29 0d0a 2020  el], f1[el])..  
-0000b230: 2020 2020 2020 6966 325b 6e2c 203a 5d20        if2[n, :] 
-0000b240: 3d20 6e70 2e69 6e74 6572 7028 656e 6572  = np.interp(ener
-0000b250: 6779 5f6b 6576 2c20 656e 6572 6779 5b65  gy_kev, energy[e
-0000b260: 6c5d 2c20 6632 5b65 6c5d 290d 0a20 2020  l], f2[el])..   
-0000b270: 2072 6574 7572 6e20 6966 312c 2069 6632   return if1, if2
-0000b280: 0d0a 0d0a 0d0a 6465 6620 7068 6f74 6f61  ......def photoa
-0000b290: 6273 6f72 7074 696f 6e5f 6372 6f73 7373  bsorption_crosss
-0000b2a0: 6563 7469 6f6e 2865 6c65 6d65 6e74 732c  ection(elements,
-0000b2b0: 2065 6e65 7267 795f 6b65 7629 3a0d 0a20   energy_kev):.. 
-0000b2c0: 2020 2022 2222 0d0a 2020 2020 4361 6c63     """..    Calc
-0000b2d0: 756c 6174 6520 7468 6520 7068 6f74 6f61  ulate the photoa
-0000b2e0: 6273 6f72 7074 696f 6e20 6372 6f73 7320  bsorption cross 
-0000b2f0: 7365 6374 696f 6e20 6672 6f6d 2074 6865  section from the
-0000b300: 2061 746f 6d69 6320 7363 6174 7465 7269   atomic scatteri
-0000b310: 6e67 2066 6163 746f 7273 0d0a 2020 2020  ng factors..    
-0000b320: 2020 2020 7520 3d20 322a 7230 2a6c 616d      u = 2*r0*lam
-0000b330: 6264 612a 6632 0d0a 2020 2020 5365 653a  bda*f2..    See:
-0000b340: 2068 7474 7073 3a2f 2f68 656e 6b65 2e6c   https://henke.l
-0000b350: 626c 2e67 6f76 2f6f 7074 6963 616c 5f63  bl.gov/optical_c
-0000b360: 6f6e 7374 616e 7473 2f69 6e74 726f 2e68  onstants/intro.h
-0000b370: 746d 6c0d 0a20 2020 203a 7061 7261 6d20  tml..    :param 
-0000b380: 656c 656d 656e 7473 3a20 7374 7220 6f72  elements: str or
-0000b390: 206c 6973 7420 6f66 2073 7472 696e 6720   list of string 
-0000b3a0: 656c 656d 656e 7420 7379 6d62 6f6c 2c20  element symbol, 
-0000b3b0: 6966 206c 6973 742c 2061 6273 6f72 7074  if list, absorpt
-0000b3c0: 696f 6e20 7769 6c6c 2062 6520 7375 6d6d  ion will be summ
-0000b3d0: 6564 206f 7665 7220 656c 656d 656e 7473  ed over elements
-0000b3e0: 0d0a 2020 2020 3a70 6172 616d 2065 6e65  ..    :param ene
-0000b3f0: 7267 795f 6b65 763a 2066 6c6f 6174 206f  rgy_kev: float o
-0000b400: 7220 6172 7261 7920 782d 7261 7920 656e  r array x-ray en
-0000b410: 6572 6779 0d0a 2020 2020 3a72 6574 7572  ergy..    :retur
-0000b420: 6e3a 2066 6c6f 6174 206f 7220 6172 7261  n: float or arra
-0000b430: 7920 5b6c 656e 2865 6e65 7267 7929 5d20  y [len(energy)] 
-0000b440: 6d5e 320d 0a20 2020 2022 2222 0d0a 2020  m^2..    """..  
-0000b450: 2020 6631 2c20 6632 203d 2061 746f 6d69    f1, f2 = atomi
-0000b460: 635f 7363 6174 7465 7269 6e67 5f66 6163  c_scattering_fac
-0000b470: 746f 7228 656c 656d 656e 7473 2c20 656e  tor(elements, en
-0000b480: 6572 6779 5f6b 6576 290d 0a20 2020 2066  ergy_kev)..    f
-0000b490: 3220 3d20 6632 2e72 6573 6861 7065 286e  2 = f2.reshape(n
-0000b4a0: 702e 7369 7a65 2865 6c65 6d65 6e74 7329  p.size(elements)
-0000b4b0: 2c20 6e70 2e73 697a 6528 656e 6572 6779  , np.size(energy
-0000b4c0: 5f6b 6576 2929 2e73 756d 2861 7869 733d  _kev)).sum(axis=
-0000b4d0: 3029 2020 2320 7375 6d20 6f76 6572 2065  0)  # sum over e
-0000b4e0: 6c65 6d65 6e74 730d 0a20 2020 2077 6176  lements..    wav
-0000b4f0: 656c 656e 6774 6820 3d20 656e 6572 6779  elength = energy
-0000b500: 3277 6176 6528 656e 6572 6779 5f6b 6576  2wave(energy_kev
-0000b510: 2920 2a20 3165 2d31 300d 0a20 2020 2072  ) * 1e-10..    r
-0000b520: 6574 7572 6e20 3220 2a20 6667 2e72 3020  eturn 2 * fg.r0 
-0000b530: 2a20 7761 7665 6c65 6e67 7468 202a 2066  * wavelength * f
-0000b540: 320d 0a0d 0a0d 0a64 6566 2078 7261 795f  2......def xray_
-0000b550: 6469 7370 6572 7369 6f6e 5f63 6f72 7265  dispersion_corre
-0000b560: 6374 696f 6e73 2865 6c65 6d65 6e74 732c  ctions(elements,
-0000b570: 2065 6e65 7267 795f 6b65 763d 4e6f 6e65   energy_kev=None
-0000b580: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
-0000b590: 2052 6561 6420 7872 6179 2064 6973 7065   Read xray dispe
-0000b5a0: 7273 696f 6e20 636f 7272 6563 7469 6f6e  rsion correction
-0000b5b0: 7320 6672 6f6d 2061 746f 6d69 6320 7363  s from atomic sc
-0000b5c0: 6174 7465 7269 6e67 2066 6163 746f 7220  attering factor 
-0000b5d0: 7461 626c 652c 2067 6976 696e 6720 6627  table, giving f'
-0000b5e0: 2061 6e64 2066 2220 666f 7220 6469 6666   and f" for diff
-0000b5f0: 6572 656e 7420 656e 6572 6769 6573 0d0a  erent energies..
-0000b600: 2020 2020 4672 6f6d 3a20 6874 7470 3a2f      From: http:/
-0000b610: 2f68 656e 6b65 2e6c 626c 2e67 6f76 2f6f  /henke.lbl.gov/o
-0000b620: 7074 6963 616c 5f63 6f6e 7374 616e 7473  ptical_constants
-0000b630: 2f61 7366 2e68 746d 6c0d 0a20 2020 203a  /asf.html..    :
-0000b640: 7061 7261 6d20 656c 656d 656e 7473 3a20  param elements: 
-0000b650: 6c69 7374 206f 6620 7374 722c 206e 616d  list of str, nam
-0000b660: 6520 6f66 2065 6c65 6d65 6e74 0d0a 2020  e of element..  
-0000b670: 2020 3a70 6172 616d 2065 6e65 7267 795f    :param energy_
-0000b680: 6b65 763a 2066 6c6f 6174 206f 7220 6c69  kev: float or li
-0000b690: 7374 2065 6e65 7267 7920 696e 206b 6556  st energy in keV
-0000b6a0: 2028 4e6f 6e65 2074 6f20 7265 7475 726e   (None to return
-0000b6b0: 206f 7269 6769 6e61 6c2c 2075 6e69 6e74   original, unint
-0000b6c0: 6572 706f 6c61 7465 6420 6c69 7374 290d  erpolated list).
-0000b6d0: 0a20 2020 203a 7265 7475 726e 3a20 6627  .    :return: f'
-0000b6e0: 2c20 6622 2077 6974 6820 7368 6170 6520  , f" with shape 
-0000b6f0: 286c 656e 2865 6e65 7267 7929 2c20 6c65  (len(energy), le
-0000b700: 6e28 656c 656d 656e 7473 2929 0d0a 2020  n(elements))..  
-0000b710: 2020 2222 220d 0a20 2020 2061 7366 5f66    """..    asf_f
-0000b720: 696c 6520 3d20 6f73 2e70 6174 682e 6a6f  ile = os.path.jo
-0000b730: 696e 2864 6174 6164 6972 2c20 2761 746f  in(datadir, 'ato
-0000b740: 6d69 635f 7363 6174 7465 7269 6e67 5f66  mic_scattering_f
-0000b750: 6163 746f 7273 2e6e 7079 2729 0d0a 2020  actors.npy')..  
-0000b760: 2020 6173 6620 3d20 6e70 2e6c 6f61 6428    asf = np.load(
-0000b770: 6173 665f 6669 6c65 2c20 616c 6c6f 775f  asf_file, allow_
-0000b780: 7069 636b 6c65 3d54 7275 6529 0d0a 2020  pickle=True)..  
-0000b790: 2020 6173 6620 3d20 6173 662e 6974 656d    asf = asf.item
-0000b7a0: 2829 0d0a 0d0a 2020 2020 656e 6572 6779  ()....    energy
-0000b7b0: 5f6b 6576 203d 206e 702e 6173 6172 7261  _kev = np.asarra
-0000b7c0: 7928 656e 6572 6779 5f6b 6576 2c20 6474  y(energy_kev, dt
-0000b7d0: 7970 653d 666c 6f61 7429 2e72 6573 6861  ype=float).resha
-0000b7e0: 7065 282d 3129 0d0a 2020 2020 656c 656d  pe(-1)..    elem
-0000b7f0: 656e 7473 203d 206e 702e 6173 6172 7261  ents = np.asarra
-0000b800: 7928 656c 656d 656e 7473 2c20 6474 7970  y(elements, dtyp
-0000b810: 653d 7374 7229 2e72 6573 6861 7065 282d  e=str).reshape(-
-0000b820: 3129 0d0a 2020 2020 6966 3120 3d20 6e70  1)..    if1 = np
-0000b830: 2e7a 6572 6f73 285b 6c65 6e28 656e 6572  .zeros([len(ener
-0000b840: 6779 5f6b 6576 292c 206c 656e 2865 6c65  gy_kev), len(ele
-0000b850: 6d65 6e74 7329 5d29 0d0a 2020 2020 6966  ments)])..    if
-0000b860: 3220 3d20 6e70 2e7a 6572 6f73 285b 6c65  2 = np.zeros([le
-0000b870: 6e28 656e 6572 6779 5f6b 6576 292c 206c  n(energy_kev), l
-0000b880: 656e 2865 6c65 6d65 6e74 7329 5d29 0d0a  en(elements)])..
-0000b890: 2020 2020 666f 7220 6e2c 2065 6c20 696e      for n, el in
-0000b8a0: 2065 6e75 6d65 7261 7465 2865 6c65 6d65   enumerate(eleme
-0000b8b0: 6e74 7329 3a0d 0a20 2020 2020 2020 207a  nts):..        z
-0000b8c0: 203d 2061 7366 5b65 6c5d 5b27 5a27 5d0d   = asf[el]['Z'].
-0000b8d0: 0a20 2020 2020 2020 2065 6e65 7267 7920  .        energy 
-0000b8e0: 3d20 6e70 2e61 7272 6179 2861 7366 5b65  = np.array(asf[e
-0000b8f0: 6c5d 5b27 656e 6572 6779 275d 2920 2f20  l]['energy']) / 
-0000b900: 3130 3030 2e20 2023 2065 5620 2d3e 206b  1000.  # eV -> k
-0000b910: 6556 0d0a 2020 2020 2020 2020 6631 203d  eV..        f1 =
-0000b920: 206e 702e 6172 7261 7928 6173 665b 656c   np.array(asf[el
-0000b930: 5d5b 2766 3127 5d29 0d0a 2020 2020 2020  ]['f1'])..      
-0000b940: 2020 6632 203d 206e 702e 6172 7261 7928    f2 = np.array(
-0000b950: 6173 665b 656c 5d5b 2766 3227 5d29 0d0a  asf[el]['f2'])..
-0000b960: 2020 2020 2020 2020 6631 5b66 3120 3c20          f1[f1 < 
-0000b970: 2d31 3030 305d 203d 206e 702e 6e61 6e0d  -1000] = np.nan.
-0000b980: 0a20 2020 2020 2020 2066 325b 6632 203c  .        f2[f2 <
-0000b990: 202d 3130 3030 5d20 3d20 6e70 2e6e 616e   -1000] = np.nan
-0000b9a0: 0d0a 2020 2020 2020 2020 2320 696e 7465  ..        # inte
-0000b9b0: 7270 6f6c 6174 6520 616e 6420 7375 6274  rpolate and subt
-0000b9c0: 7261 6374 2066 303d 3d5a 0d0a 2020 2020  ract f0==Z..    
-0000b9d0: 2020 2020 6966 315b 3a2c 206e 5d20 3d20      if1[:, n] = 
-0000b9e0: 6e70 2e69 6e74 6572 7028 656e 6572 6779  np.interp(energy
-0000b9f0: 5f6b 6576 2c20 656e 6572 6779 2c20 6631  _kev, energy, f1
-0000ba00: 2920 2d20 7a0d 0a20 2020 2020 2020 2069  ) - z..        i
-0000ba10: 6632 5b3a 2c20 6e5d 203d 202d 6e70 2e69  f2[:, n] = -np.i
-0000ba20: 6e74 6572 7028 656e 6572 6779 5f6b 6576  nterp(energy_kev
-0000ba30: 2c20 656e 6572 6779 2c20 6632 290d 0a20  , energy, f2).. 
-0000ba40: 2020 2072 6574 7572 6e20 6966 312c 2069     return if1, i
-0000ba50: 6632 0d0a 0d0a 0d0a 6465 6620 706f 696e  f2......def poin
-0000ba60: 7467 726f 7570 7328 293a 0d0a 2020 2020  tgroups():..    
-0000ba70: 2222 2252 6561 6420 706f 696e 7467 726f  """Read pointgro
-0000ba80: 7570 2066 696c 652c 2072 6574 7572 6e20  up file, return 
-0000ba90: 6469 6374 2222 220d 0a20 2020 2070 675f  dict"""..    pg_
-0000baa0: 6669 6c65 203d 206f 732e 7061 7468 2e6a  file = os.path.j
-0000bab0: 6f69 6e28 6461 7461 6469 722c 2027 506f  oin(datadir, 'Po
-0000bac0: 696e 7447 726f 7570 732e 6a73 6f6e 2729  intGroups.json')
-0000bad0: 0d0a 2020 2020 7769 7468 206f 7065 6e28  ..    with open(
-0000bae0: 7067 5f66 696c 652c 2027 7227 2920 6173  pg_file, 'r') as
-0000baf0: 2066 703a 0d0a 2020 2020 2020 2020 7067   fp:..        pg
-0000bb00: 203d 206a 736f 6e2e 6c6f 6164 2866 7029   = json.load(fp)
-0000bb10: 0d0a 2020 2020 7265 7475 726e 2070 670d  ..    return pg.
-0000bb20: 0a0d 0a0d 0a64 6566 206c 6f61 645f 706f  .....def load_po
-0000bb30: 696e 7467 726f 7570 2870 675f 6e75 6d62  intgroup(pg_numb
-0000bb40: 6572 293a 0d0a 2020 2020 2222 220d 0a20  er):..    """.. 
-0000bb50: 2020 204c 6f61 6420 706f 696e 7420 6772     Load point gr
-0000bb60: 6f75 7020 7573 696e 6720 6e75 6d62 6572  oup using number
-0000bb70: 0d0a 2020 2020 506f 696e 7420 4772 6f75  ..    Point Grou
-0000bb80: 7073 3a0d 0a20 2020 2054 7269 636c 696e  ps:..    Triclin
-0000bb90: 6963 0d0a 2020 2020 2020 3120 4331 2020  ic..      1 C1  
-0000bba0: 2820 2020 2031 2920 4765 6e50 6f73 3a20  (    1) GenPos: 
-0000bbb0: 2020 310d 0a20 2020 2020 2032 2043 6920    1..      2 Ci 
-0000bbc0: 2028 2020 202d 3129 2047 656e 506f 733a   (   -1) GenPos:
-0000bbd0: 2020 2032 0d0a 2020 2020 4d6f 6e6f 636c     2..    Monocl
-0000bbe0: 696e 6963 0d0a 2020 2020 2020 3320 4332  inic..      3 C2
-0000bbf0: 2020 2820 2020 2032 2920 4765 6e50 6f73    (    2) GenPos
-0000bc00: 3a20 2020 320d 0a20 2020 2020 2034 2043  :   2..      4 C
-0000bc10: 7320 2028 2020 2020 6d29 2047 656e 506f  s  (    m) GenPo
-0000bc20: 733a 2020 2032 0d0a 2020 2020 2020 3520  s:   2..      5 
-0000bc30: 4332 6820 2820 2032 2f6d 2920 4765 6e50  C2h (  2/m) GenP
-0000bc40: 6f73 3a20 2020 340d 0a20 2020 204f 7274  os:   4..    Ort
-0000bc50: 686f 7268 6f6d 6269 630d 0a20 2020 2020  horhombic..     
-0000bc60: 2036 2044 3220 2028 2020 3232 3229 2047   6 D2  (  222) G
-0000bc70: 656e 506f 733a 2020 2034 0d0a 2020 2020  enPos:   4..    
-0000bc80: 2020 3720 4332 7620 2820 206d 6d32 2920    7 C2v (  mm2) 
-0000bc90: 4765 6e50 6f73 3a20 2020 340d 0a20 2020  GenPos:   4..   
-0000bca0: 2020 2038 2044 3268 2028 2020 6d6d 6d29     8 D2h (  mmm)
-0000bcb0: 2047 656e 506f 733a 2020 2038 0d0a 2020   GenPos:   8..  
-0000bcc0: 2020 5465 7472 6167 6f6e 616c 0d0a 2020    Tetragonal..  
-0000bcd0: 2020 2020 3920 4334 2020 2820 2020 2034      9 C4  (    4
-0000bce0: 2920 4765 6e50 6f73 3a20 2020 340d 0a20  ) GenPos:   4.. 
-0000bcf0: 2020 2020 3130 2053 3420 2028 2020 202d      10 S4  (   -
-0000bd00: 3429 2047 656e 506f 733a 2020 2034 0d0a  4) GenPos:   4..
-0000bd10: 2020 2020 2031 3120 4334 6820 2820 2034       11 C4h (  4
-0000bd20: 2f6d 2920 4765 6e50 6f73 3a20 2020 380d  /m) GenPos:   8.
-0000bd30: 0a20 2020 2020 3132 2044 3420 2028 2020  .     12 D4  (  
-0000bd40: 3432 3229 2047 656e 506f 733a 2020 2038  422) GenPos:   8
-0000bd50: 0d0a 2020 2020 2031 3320 4334 7620 2820  ..     13 C4v ( 
-0000bd60: 2034 6d6d 2920 4765 6e50 6f73 3a20 2020   4mm) GenPos:   
-0000bd70: 380d 0a20 2020 2020 3134 2044 3264 2028  8..     14 D2d (
-0000bd80: 202d 3432 6d29 2047 656e 506f 733a 2020   -42m) GenPos:  
-0000bd90: 2038 0d0a 2020 2020 2031 3520 4434 6820   8..     15 D4h 
-0000bda0: 2834 2f6d 6d6d 2920 4765 6e50 6f73 3a20  (4/mmm) GenPos: 
-0000bdb0: 2031 360d 0a20 2020 2054 7269 676f 6e61   16..    Trigona
-0000bdc0: 6c0d 0a20 2020 2020 3136 2043 3320 2028  l..     16 C3  (
-0000bdd0: 2020 2020 3329 2047 656e 506f 733a 2020      3) GenPos:  
-0000bde0: 2033 0d0a 2020 2020 2031 3720 4333 6920   3..     17 C3i 
-0000bdf0: 2820 2020 2d33 2920 4765 6e50 6f73 3a20  (   -3) GenPos: 
-0000be00: 2020 360d 0a20 2020 2020 3138 2044 3320    6..     18 D3 
-0000be10: 2028 2020 3331 3229 2047 656e 506f 733a   (  312) GenPos:
-0000be20: 2020 2036 0d0a 2020 2020 2031 3920 4333     6..     19 C3
-0000be30: 7620 2820 2033 6d31 2920 4765 6e50 6f73  v (  3m1) GenPos
-0000be40: 3a20 2020 360d 0a20 2020 2020 3230 2044  :   6..     20 D
-0000be50: 3364 2028 202d 3331 6d29 2047 656e 506f  3d ( -31m) GenPo
-0000be60: 733a 2020 3132 0d0a 2020 2020 4865 7861  s:  12..    Hexa
-0000be70: 676f 6e61 6c0d 0a20 2020 2020 3231 2043  gonal..     21 C
-0000be80: 3620 2028 2020 2020 3629 2047 656e 506f  6  (    6) GenPo
-0000be90: 733a 2020 2036 0d0a 2020 2020 2032 3220  s:   6..     22 
-0000bea0: 4333 6820 2820 2020 2d36 2920 4765 6e50  C3h (   -6) GenP
-0000beb0: 6f73 3a20 2020 360d 0a20 2020 2020 3233  os:   6..     23
-0000bec0: 2043 3668 2028 2020 362f 6d29 2047 656e   C6h (  6/m) Gen
-0000bed0: 506f 733a 2020 3132 0d0a 2020 2020 2032  Pos:  12..     2
-0000bee0: 3420 4436 2020 2820 2036 3232 2920 4765  4 D6  (  622) Ge
-0000bef0: 6e50 6f73 3a20 2031 320d 0a20 2020 2020  nPos:  12..     
-0000bf00: 3235 2043 3676 2028 2020 366d 6d29 2047  25 C6v (  6mm) G
-0000bf10: 656e 506f 733a 2020 3132 0d0a 2020 2020  enPos:  12..    
-0000bf20: 2032 3620 4433 6820 2820 2d36 6d32 2920   26 D3h ( -6m2) 
-0000bf30: 4765 6e50 6f73 3a20 2031 320d 0a20 2020  GenPos:  12..   
-0000bf40: 2020 3237 2044 3668 2028 362f 6d6d 6d29    27 D6h (6/mmm)
-0000bf50: 2047 656e 506f 733a 2020 3234 0d0a 2020   GenPos:  24..  
-0000bf60: 2020 4375 6269 630d 0a20 2020 2020 3238    Cubic..     28
-0000bf70: 2054 2020 2028 2020 2032 3329 2047 656e   T   (   23) Gen
-0000bf80: 506f 733a 2020 3132 0d0a 2020 2020 2032  Pos:  12..     2
-0000bf90: 3920 5468 2020 2820 206d 2d33 2920 4765  9 Th  (  m-3) Ge
-0000bfa0: 6e50 6f73 3a20 2032 340d 0a20 2020 2020  nPos:  24..     
-0000bfb0: 3330 204f 2020 2028 2020 3433 3229 2047  30 O   (  432) G
-0000bfc0: 656e 506f 733a 2020 3234 0d0a 2020 2020  enPos:  24..    
-0000bfd0: 2033 3120 5464 2020 2820 2d34 336d 2920   31 Td  ( -43m) 
-0000bfe0: 4765 6e50 6f73 3a20 2032 340d 0a20 2020  GenPos:  24..   
-0000bff0: 2020 3332 204f 6820 2028 206d 2d33 6d29    32 Oh  ( m-3m)
-0000c000: 2047 656e 506f 733a 2020 3438 0d0a 2020   GenPos:  48..  
-0000c010: 2020 3a70 6172 616d 2070 675f 6e75 6d62    :param pg_numb
-0000c020: 6572 3a20 696e 7420 6f72 2073 7472 2c20  er: int or str, 
-0000c030: 652e 672e 2027 6375 6269 6327 0d0a 2020  e.g. 'cubic'..  
-0000c040: 2020 3a72 6574 7572 6e3a 2064 6963 740d    :return: dict.
-0000c050: 0a20 2020 2022 2222 0d0a 2020 2020 7472  .    """..    tr
-0000c060: 793a 0d0a 2020 2020 2020 2020 6966 2070  y:..        if p
-0000c070: 675f 6e75 6d62 6572 2e6c 6f77 6572 2829  g_number.lower()
-0000c080: 2069 6e20 5b27 6375 6269 6327 5d3a 0d0a   in ['cubic']:..
-0000c090: 2020 2020 2020 2020 2020 2020 7067 5f6e              pg_n
-0000c0a0: 756d 6265 7220 3d20 3332 0d0a 2020 2020  umber = 32..    
-0000c0b0: 2020 2020 656c 6966 2070 675f 6e75 6d62      elif pg_numb
-0000c0c0: 6572 2e6c 6f77 6572 2829 2069 6e20 5b27  er.lower() in ['
-0000c0d0: 6865 7861 676f 6e61 6c27 2c20 2768 6578  hexagonal', 'hex
-0000c0e0: 275d 3a0d 0a20 2020 2020 2020 2020 2020  ']:..           
-0000c0f0: 2070 675f 6e75 6d62 6572 203d 2032 370d   pg_number = 27.
-0000c100: 0a20 2020 2020 2020 2065 6c69 6620 7067  .        elif pg
-0000c110: 5f6e 756d 6265 722e 6c6f 7765 7228 2920  _number.lower() 
-0000c120: 696e 205b 2774 7269 676f 6e61 6c27 5d3a  in ['trigonal']:
-0000c130: 0d0a 2020 2020 2020 2020 2020 2020 7067  ..            pg
-0000c140: 5f6e 756d 6265 7220 3d20 3230 0d0a 2020  _number = 20..  
-0000c150: 2020 2020 2020 656c 6966 2070 675f 6e75        elif pg_nu
-0000c160: 6d62 6572 2e6c 6f77 6572 2829 2069 6e20  mber.lower() in 
-0000c170: 5b27 7465 7472 6167 6f6e 616c 275d 3a0d  ['tetragonal']:.
-0000c180: 0a20 2020 2020 2020 2020 2020 2070 675f  .            pg_
-0000c190: 6e75 6d62 6572 203d 2031 350d 0a20 2020  number = 15..   
-0000c1a0: 2020 2020 2065 6c69 6620 7067 5f6e 756d       elif pg_num
-0000c1b0: 6265 722e 6c6f 7765 7228 2920 696e 205b  ber.lower() in [
-0000c1c0: 276f 7274 686f 7268 6f6d 6269 6327 5d3a  'orthorhombic']:
-0000c1d0: 0d0a 2020 2020 2020 2020 2020 2020 7067  ..            pg
-0000c1e0: 5f6e 756d 6265 7220 3d20 380d 0a20 2020  _number = 8..   
-0000c1f0: 2020 2020 2065 6c69 6620 7067 5f6e 756d       elif pg_num
-0000c200: 6265 722e 6c6f 7765 7228 2920 696e 205b  ber.lower() in [
-0000c210: 276d 6f6e 6f63 6c69 6e69 6327 2c20 276d  'monoclinic', 'm
-0000c220: 6f6e 6f27 5d3a 0d0a 2020 2020 2020 2020  ono']:..        
-0000c230: 2020 2020 7067 5f6e 756d 6265 7220 3d20      pg_number = 
-0000c240: 350d 0a20 2020 2020 2020 2065 6c69 6620  5..        elif 
-0000c250: 7067 5f6e 756d 6265 722e 6c6f 7765 7228  pg_number.lower(
-0000c260: 2920 696e 205b 2774 7269 636c 696e 6963  ) in ['triclinic
-0000c270: 275d 3a0d 0a20 2020 2020 2020 2020 2020  ']:..           
-0000c280: 2070 675f 6e75 6d62 6572 203d 2032 0d0a   pg_number = 2..
-0000c290: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
-0000c2a0: 6275 7465 4572 726f 723a 0d0a 2020 2020  buteError:..    
-0000c2b0: 2020 2020 7067 5f6e 756d 6265 7220 3d20      pg_number = 
-0000c2c0: 696e 7428 7067 5f6e 756d 6265 7229 0d0a  int(pg_number)..
-0000c2d0: 2020 2020 7265 7475 726e 2070 6f69 6e74      return point
-0000c2e0: 6772 6f75 7073 2829 5b73 7472 2870 675f  groups()[str(pg_
-0000c2f0: 6e75 6d62 6572 295d 0d0a 0d0a 0d0a 6465  number)]......de
-0000c300: 6620 7370 6163 6567 726f 7570 7328 293a  f spacegroups():
-0000c310: 0d0a 2020 2020 2222 220d 0a20 2020 2052  ..    """..    R
-0000c320: 6574 7572 6e20 6120 6469 6374 206f 6620  eturn a dict of 
-0000c330: 616c 6c20 7370 6163 6520 6772 6f75 7073  all space groups
-0000c340: 0d0a 2020 2020 4c6f 6164 6564 2066 726f  ..    Loaded fro
-0000c350: 6d20 6a73 6f6e 2066 696c 6520 6372 6561  m json file crea
-0000c360: 7465 6420 6672 6f6d 2074 6865 2042 696c  ted from the Bil
-0000c370: 6261 6f20 6372 7973 7461 6c6c 6f67 7261  bao crystallogra
-0000c380: 7068 6963 2073 6572 7665 723a 2068 7474  phic server: htt
-0000c390: 7073 3a2f 2f77 7777 2e63 7279 7374 2e65  ps://www.cryst.e
-0000c3a0: 6875 2e65 732f 0d0a 2020 2020 3a72 6574  hu.es/..    :ret
-0000c3b0: 7572 6e3a 2064 6963 7420 7769 7468 206b  urn: dict with k
-0000c3c0: 6579 733a 0d0a 2020 2020 2020 2020 2773  eys:..        's
-0000c3d0: 7061 6365 2067 726f 7570 206e 756d 6265  pace group numbe
-0000c3e0: 7227 0d0a 2020 2020 2020 2020 2773 7061  r'..        'spa
-0000c3f0: 6365 2067 726f 7570 206e 616d 6520 6874  ce group name ht
-0000c400: 6d6c 270d 0a20 2020 2020 2020 2027 7370  ml'..        'sp
-0000c410: 6163 6520 6772 6f75 7020 6e61 6d65 270d  ace group name'.
-0000c420: 0a20 2020 2020 2020 2027 7765 6220 6164  .        'web ad
-0000c430: 6472 6573 7320 6765 6e65 7261 746f 7227  dress generator'
-0000c440: 0d0a 2020 2020 2020 2020 2777 6562 2061  ..        'web a
-0000c450: 6464 7265 7373 2077 7963 6b6f 6666 270d  ddress wyckoff'.
-0000c460: 0a20 2020 2020 2020 2027 7765 6220 6164  .        'web ad
-0000c470: 6472 6573 7320 7369 7465 2063 6865 636b  dress site check
-0000c480: 2720 2020 2020 2320 6164 6472 6573 7320  '     # address 
-0000c490: 2520 2875 2c20 762c 2077 292c 0d0a 2020  % (u, v, w),..  
-0000c4a0: 2020 2020 2020 2767 656e 6572 616c 2070        'general p
-0000c4b0: 6f73 6974 696f 6e73 270d 0a20 2020 2020  ositions'..     
-0000c4c0: 2020 2027 6d61 676e 6574 6963 2073 7061     'magnetic spa
-0000c4d0: 6365 2067 726f 7570 7327 2c0d 0a20 2020  ce groups',..   
-0000c4e0: 2020 2020 2027 706f 7369 7469 6f6e 7320       'positions 
-0000c4f0: 6365 6e74 7269 6e67 270d 0a20 2020 2020  centring'..     
-0000c500: 2020 2027 706f 7369 7469 6f6e 7320 6d75     'positions mu
-0000c510: 6c74 6970 6c69 6369 7479 270d 0a20 2020  ltiplicity'..   
-0000c520: 2020 2020 2027 706f 7369 7469 6f6e 7320       'positions 
-0000c530: 7779 636b 6f66 6620 6c65 7474 6572 270d  wyckoff letter'.
-0000c540: 0a20 2020 2020 2020 2027 706f 7369 7469  .        'positi
-0000c550: 6f6e 7320 7379 6d6d 6574 7279 270d 0a20  ons symmetry'.. 
-0000c560: 2020 2020 2020 2027 706f 7369 7469 6f6e         'position
-0000c570: 7320 636f 6f72 6469 6e61 7465 7327 0d0a  s coordinates'..
-0000c580: 2020 2020 2020 2020 2773 7562 6772 6f75          'subgrou
-0000c590: 7020 6e75 6d62 6572 272c 0d0a 2020 2020  p number',..    
-0000c5a0: 2020 2020 2773 7562 6772 6f75 7020 6e61      'subgroup na
-0000c5b0: 6d65 272c 0d0a 2020 2020 2020 2020 2773  me',..        's
-0000c5c0: 7562 6772 6f75 7020 696e 6465 7827 2c0d  ubgroup index',.
-0000c5d0: 0a20 2020 2020 2020 2027 7375 6267 726f  .        'subgro
-0000c5e0: 7570 2074 7970 6527 0d0a 2020 2020 2222  up type'..    ""
-0000c5f0: 220d 0a20 2020 2073 675f 6669 6c65 203d  "..    sg_file =
-0000c600: 206f 732e 7061 7468 2e6a 6f69 6e28 6461   os.path.join(da
-0000c610: 7461 6469 722c 2027 5370 6163 6547 726f  tadir, 'SpaceGro
-0000c620: 7570 732e 6a73 6f6e 2729 0d0a 2020 2020  ups.json')..    
-0000c630: 7769 7468 206f 7065 6e28 7367 5f66 696c  with open(sg_fil
-0000c640: 652c 2027 7227 2920 6173 2066 703a 0d0a  e, 'r') as fp:..
-0000c650: 2020 2020 2020 2020 7367 5f64 6963 7420          sg_dict 
-0000c660: 3d20 6a73 6f6e 2e6c 6f61 6428 6670 290d  = json.load(fp).
-0000c670: 0a20 2020 2072 6574 7572 6e20 7367 5f64  .    return sg_d
-0000c680: 6963 740d 0a0d 0a0d 0a64 6566 2073 7061  ict......def spa
-0000c690: 6365 6772 6f75 7028 7367 5f6e 756d 6265  cegroup(sg_numbe
-0000c6a0: 7229 3a0d 0a20 2020 2022 2222 0d0a 2020  r):..    """..  
-0000c6b0: 2020 5265 7475 726e 2061 2064 6963 7420    Return a dict 
-0000c6c0: 6f66 2069 6e66 6f72 6d61 7469 6f6e 2066  of information f
-0000c6d0: 6f72 2061 2073 7061 6365 2067 726f 7570  or a space group
-0000c6e0: 0d0a 2020 2020 3a70 6172 616d 2073 675f  ..    :param sg_
-0000c6f0: 6e75 6d62 6572 3a20 696e 7420 7370 6163  number: int spac
-0000c700: 6520 6772 6f75 7020 6e75 6d62 6572 2c20  e group number, 
-0000c710: 6173 2069 6e20 7468 6520 696e 7465 726e  as in the intern
-0000c720: 6174 696f 6e61 6c20 7461 626c 6573 206f  ational tables o
-0000c730: 6620 4372 7973 7461 6c6c 6f67 7261 7068  f Crystallograph
-0000c740: 790d 0a20 2020 203a 7265 7475 726e 3a20  y..    :return: 
-0000c750: 6469 6374 0d0a 2020 2020 2222 220d 0a20  dict..    """.. 
-0000c760: 2020 2073 675f 6e75 6d62 6572 203d 2073     sg_number = s
-0000c770: 7472 2869 6e74 2873 675f 6e75 6d62 6572  tr(int(sg_number
-0000c780: 2929 0d0a 2020 2020 7367 5f64 6963 7420  ))..    sg_dict 
-0000c790: 3d20 7370 6163 6567 726f 7570 7328 290d  = spacegroups().
-0000c7a0: 0a20 2020 2072 6574 7572 6e20 7367 5f64  .    return sg_d
-0000c7b0: 6963 745b 7367 5f6e 756d 6265 725d 0d0a  ict[sg_number]..
-0000c7c0: 0d0a 0d0a 6465 6620 7370 6163 6567 726f  ....def spacegro
-0000c7d0: 7570 5f6c 6973 7428 7367 5f6e 756d 6265  up_list(sg_numbe
-0000c7e0: 7273 3d4e 6f6e 6529 3a0d 0a20 2020 2022  rs=None):..    "
-0000c7f0: 2222 0d0a 2020 2020 5265 7475 726e 2061  ""..    Return a
-0000c800: 2073 7472 7563 7475 7265 6420 6c69 7374   structured list
-0000c810: 206f 6620 7370 6163 6520 6772 6f75 7073   of space groups
-0000c820: 2077 6974 6820 6765 6e65 7261 6c20 6f70   with general op
-0000c830: 6572 6174 696f 6e73 0d0a 2020 2020 3a70  erations..    :p
-0000c840: 6172 616d 2073 675f 6e75 6d62 6572 733a  aram sg_numbers:
-0000c850: 206c 6973 7420 6f66 2073 7061 6365 2067   list of space g
-0000c860: 726f 7570 206e 756d 6265 7273 2028 4e6f  roup numbers (No
-0000c870: 6e65 2066 6f72 2077 686f 6c65 206c 6973  ne for whole lis
-0000c880: 7429 0d0a 2020 2020 3a72 6574 7572 6e3a  t)..    :return:
-0000c890: 2073 7472 0d0a 2020 2020 2222 220d 0a20   str..    """.. 
-0000c8a0: 2020 2069 6620 7367 5f6e 756d 6265 7273     if sg_numbers
-0000c8b0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-0000c8c0: 2020 2073 675f 6e75 6d62 6572 7320 3d20     sg_numbers = 
-0000c8d0: 7261 6e67 6528 312c 2032 3331 290d 0a20  range(1, 231).. 
-0000c8e0: 2020 2073 675f 6e75 6d62 6572 7320 3d20     sg_numbers = 
-0000c8f0: 6e70 2e61 7361 7272 6179 2873 675f 6e75  np.asarray(sg_nu
-0000c900: 6d62 6572 732c 2064 7479 7065 3d73 7472  mbers, dtype=str
-0000c910: 292e 7265 7368 6170 6528 2d31 290d 0a0d  ).reshape(-1)...
-0000c920: 0a20 2020 2073 675f 6469 6374 203d 2073  .    sg_dict = s
-0000c930: 7061 6365 6772 6f75 7073 2829 0d0a 0d0a  pacegroups()....
-0000c940: 2020 2020 6f75 7420 3d20 2727 0d0a 2020      out = ''..  
-0000c950: 2020 666d 7420 3d20 2725 3364 2025 2d31    fmt = '%3d %-1
-0000c960: 3073 203a 2025 3364 203a 2025 735c 6e27  0s : %3d : %s\n'
-0000c970: 0d0a 2020 2020 666f 7220 7367 6e20 696e  ..    for sgn in
-0000c980: 2073 675f 6e75 6d62 6572 733a 0d0a 2020   sg_numbers:..  
-0000c990: 2020 2020 2020 7367 203d 2073 675f 6469        sg = sg_di
-0000c9a0: 6374 5b73 676e 5d0d 0a20 2020 2020 2020  ct[sgn]..       
-0000c9b0: 206e 756d 203d 2073 675b 2773 7061 6365   num = sg['space
-0000c9c0: 2067 726f 7570 206e 756d 6265 7227 5d0d   group number'].
-0000c9d0: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-0000c9e0: 7367 5b27 7370 6163 6520 6772 6f75 7020  sg['space group 
-0000c9f0: 6e61 6d65 275d 0d0a 2020 2020 2020 2020  name']..        
-0000ca00: 7379 6d20 3d20 272c 2027 2e6a 6f69 6e28  sym = ', '.join(
-0000ca10: 7367 5b27 6765 6e65 7261 6c20 706f 7369  sg['general posi
-0000ca20: 7469 6f6e 7327 5d29 0d0a 2020 2020 2020  tions'])..      
-0000ca30: 2020 6e73 796d 203d 206c 656e 2873 675b    nsym = len(sg[
-0000ca40: 2767 656e 6572 616c 2070 6f73 6974 696f  'general positio
-0000ca50: 6e73 275d 290d 0a20 2020 2020 2020 206f  ns'])..        o
-0000ca60: 7574 202b 3d20 666d 7420 2520 286e 756d  ut += fmt % (num
-0000ca70: 2c20 6e61 6d65 2c20 6e73 796d 2c20 7379  , name, nsym, sy
-0000ca80: 6d29 0d0a 2020 2020 7265 7475 726e 206f  m)..    return o
-0000ca90: 7574 0d0a 0d0a 0d0a 6465 6620 7370 6163  ut......def spac
-0000caa0: 6567 726f 7570 5f73 7562 6772 6f75 7073  egroup_subgroups
-0000cab0: 2873 675f 6e75 6d62 6572 293a 0d0a 2020  (sg_number):..  
-0000cac0: 2020 2222 220d 0a20 2020 2052 6574 7572    """..    Retur
-0000cad0: 6e20 6469 6374 206f 6620 6d61 7869 6d61  n dict of maxima
-0000cae0: 6c20 7375 6267 726f 7570 7320 666f 7220  l subgroups for 
-0000caf0: 7370 6163 6567 726f 7570 0d0a 2020 2020  spacegroup..    
-0000cb00: 3a70 6172 616d 2073 675f 6e75 6d62 6572  :param sg_number
-0000cb10: 3a20 7370 6163 6520 6772 6f75 7020 6e75  : space group nu
-0000cb20: 6d62 6572 2028 312d 3233 3029 0d0a 2020  mber (1-230)..  
-0000cb30: 2020 3a72 6574 7572 6e3a 2064 6963 740d    :return: dict.
-0000cb40: 0a20 2020 2022 2222 0d0a 2020 2020 616c  .    """..    al
-0000cb50: 6c5f 7367 203d 2073 7061 6365 6772 6f75  l_sg = spacegrou
-0000cb60: 7073 2829 0d0a 2020 2020 7367 5f6e 756d  ps()..    sg_num
-0000cb70: 6265 7220 3d20 7374 7228 696e 7428 7367  ber = str(int(sg
-0000cb80: 5f6e 756d 6265 7229 290d 0a20 2020 2073  _number))..    s
-0000cb90: 675f 6469 6374 203d 2061 6c6c 5f73 675b  g_dict = all_sg[
-0000cba0: 7367 5f6e 756d 6265 725d 0d0a 2020 2020  sg_number]..    
-0000cbb0: 7375 6267 726f 7570 7320 3d20 7367 5f64  subgroups = sg_d
-0000cbc0: 6963 745b 2273 7562 6772 6f75 7020 6e75  ict["subgroup nu
-0000cbd0: 6d62 6572 225d 0d0a 2020 2020 7265 7475  mber"]..    retu
-0000cbe0: 726e 205b 616c 6c5f 7367 5b6e 756d 5d20  rn [all_sg[num] 
-0000cbf0: 666f 7220 6e75 6d20 696e 2073 7562 6772  for num in subgr
-0000cc00: 6f75 7073 5d0d 0a0d 0a0d 0a64 6566 2073  oups]......def s
-0000cc10: 7061 6365 6772 6f75 705f 7375 6267 726f  pacegroup_subgro
-0000cc20: 7570 735f 6c69 7374 2873 675f 6e75 6d62  ups_list(sg_numb
-0000cc30: 6572 293a 0d0a 2020 2020 2222 220d 0a20  er):..    """.. 
-0000cc40: 2020 2052 6574 7572 6e20 7374 7220 6f66     Return str of
-0000cc50: 206d 6178 696d 616c 2073 7562 6772 6f75   maximal subgrou
-0000cc60: 7073 2066 6f72 2073 7061 6365 6772 6f75  ps for spacegrou
-0000cc70: 700d 0a20 2020 203a 7061 7261 6d20 7367  p..    :param sg
-0000cc80: 5f6e 756d 6265 723a 2073 7061 6365 2067  _number: space g
-0000cc90: 726f 7570 206e 756d 6265 7220 2831 2d32  roup number (1-2
-0000cca0: 3330 290d 0a20 2020 203a 7265 7475 726e  30)..    :return
-0000ccb0: 3a20 7374 720d 0a20 2020 2022 2222 0d0a  : str..    """..
-0000ccc0: 2020 2020 7367 5f64 6963 7420 3d20 7370      sg_dict = sp
-0000ccd0: 6163 6567 726f 7570 2873 675f 6e75 6d62  acegroup(sg_numb
-0000cce0: 6572 290d 0a20 2020 2073 7562 5f6e 756d  er)..    sub_num
-0000ccf0: 203d 2073 675f 6469 6374 5b22 7375 6267   = sg_dict["subg
-0000cd00: 726f 7570 206e 756d 6265 7222 5d0d 0a20  roup number"].. 
-0000cd10: 2020 2073 7562 5f6e 616d 6520 3d20 7367     sub_name = sg
-0000cd20: 5f64 6963 745b 2273 7562 6772 6f75 7020  _dict["subgroup 
-0000cd30: 6e61 6d65 225d 0d0a 2020 2020 7375 625f  name"]..    sub_
-0000cd40: 696e 6465 7820 3d20 7367 5f64 6963 745b  index = sg_dict[
-0000cd50: 2273 7562 6772 6f75 7020 696e 6465 7822  "subgroup index"
-0000cd60: 5d0d 0a20 2020 2073 7562 5f74 7970 6520  ]..    sub_type 
-0000cd70: 3d20 7367 5f64 6963 745b 2273 7562 6772  = sg_dict["subgr
-0000cd80: 6f75 7020 7479 7065 225d 0d0a 2020 2020  oup type"]..    
-0000cd90: 6f75 7420 3d20 2727 0d0a 2020 2020 666d  out = ''..    fm
-0000cda0: 7420 3d20 2750 6172 656e 743a 2025 3373  t = 'Parent: %3s
-0000cdb0: 2053 7562 6772 6f75 703a 2025 3373 2020   Subgroup: %3s  
-0000cdc0: 252d 3130 7320 2049 6e64 6578 3a20 2533  %-10s  Index: %3
-0000cdd0: 7320 2054 7970 653a 2025 3273 5c6e 270d  s  Type: %2s\n'.
-0000cde0: 0a20 2020 2066 6f72 206e 756d 2c20 6e61  .    for num, na
-0000cdf0: 6d65 2c20 696e 6465 782c 2073 7479 7065  me, index, stype
-0000ce00: 2069 6e20 7a69 7028 7375 625f 6e75 6d2c   in zip(sub_num,
-0000ce10: 2073 7562 5f6e 616d 652c 2073 7562 5f69   sub_name, sub_i
-0000ce20: 6e64 6578 2c20 7375 625f 7479 7065 293a  ndex, sub_type):
-0000ce30: 0d0a 2020 2020 2020 2020 6f75 7420 2b3d  ..        out +=
-0000ce40: 2066 6d74 2025 2028 7367 5f6e 756d 6265   fmt % (sg_numbe
-0000ce50: 722c 206e 756d 2c20 6e61 6d65 2c20 696e  r, num, name, in
-0000ce60: 6465 782c 2073 7479 7065 290d 0a20 2020  dex, stype)..   
-0000ce70: 2072 6574 7572 6e20 6f75 740d 0a0d 0a0d   return out.....
-0000ce80: 0a64 6566 2073 7061 6365 6772 6f75 7073  .def spacegroups
-0000ce90: 5f6d 6167 6e65 7469 6328 7367 5f6e 756d  _magnetic(sg_num
-0000cea0: 6265 723d 4e6f 6e65 293a 0d0a 2020 2020  ber=None):..    
-0000ceb0: 2222 220d 0a20 2020 2052 6574 7572 6e73  """..    Returns
-0000cec0: 2064 6963 7420 6f66 206d 6167 6e65 7469   dict of magneti
-0000ced0: 6320 7370 6163 6520 6772 6f75 7073 2066  c space groups f
-0000cee0: 6f72 2072 6571 7569 7265 6420 7370 6163  or required spac
-0000cef0: 6520 6772 6f75 700d 0a20 2020 203a 7061  e group..    :pa
-0000cf00: 7261 6d20 7367 5f6e 756d 6265 723a 2073  ram sg_number: s
-0000cf10: 7061 6365 2067 726f 7570 206e 756d 6265  pace group numbe
-0000cf20: 7220 2831 2d32 3330 2920 6f72 204e 6f6e  r (1-230) or Non
-0000cf30: 6520 746f 2072 6574 7572 6e20 616c 6c20  e to return all 
-0000cf40: 6d61 676e 6574 6963 2073 7061 6365 6772  magnetic spacegr
-0000cf50: 6f75 7073 0d0a 2020 2020 3a72 6574 7572  oups..    :retur
-0000cf60: 6e3a 2064 6963 740d 0a20 2020 2022 2222  n: dict..    """
-0000cf70: 0d0a 0d0a 2020 2020 6d73 675f 6669 6c65  ....    msg_file
-0000cf80: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
-0000cf90: 6461 7461 6469 722c 2027 5370 6163 6547  datadir, 'SpaceG
-0000cfa0: 726f 7570 734d 6167 6e65 7469 632e 6a73  roupsMagnetic.js
-0000cfb0: 6f6e 2729 0d0a 2020 2020 7769 7468 206f  on')..    with o
-0000cfc0: 7065 6e28 6d73 675f 6669 6c65 2c20 2772  pen(msg_file, 'r
-0000cfd0: 2729 2061 7320 6670 3a0d 0a20 2020 2020  ') as fp:..     
-0000cfe0: 2020 206d 7367 5f64 6963 7420 3d20 6a73     msg_dict = js
-0000cff0: 6f6e 2e6c 6f61 6428 6670 290d 0a0d 0a20  on.load(fp).... 
-0000d000: 2020 2069 6620 7367 5f6e 756d 6265 7220     if sg_number 
-0000d010: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0000d020: 2020 7265 7475 726e 206d 7367 5f64 6963    return msg_dic
-0000d030: 740d 0a0d 0a20 2020 2073 675f 6469 6374  t....    sg_dict
-0000d040: 203d 2073 7061 6365 6772 6f75 7028 7367   = spacegroup(sg
-0000d050: 5f6e 756d 6265 7229 0d0a 2020 2020 6d73  _number)..    ms
-0000d060: 675f 6e75 6d62 6572 7320 3d20 7367 5f64  g_numbers = sg_d
-0000d070: 6963 745b 276d 6167 6e65 7469 6320 7370  ict['magnetic sp
-0000d080: 6163 6520 6772 6f75 7073 275d 0d0a 2020  ace groups']..  
-0000d090: 2020 7265 7475 726e 205b 6d73 675f 6469    return [msg_di
-0000d0a0: 6374 5b6e 756d 5d20 666f 7220 6e75 6d20  ct[num] for num 
-0000d0b0: 696e 206d 7367 5f6e 756d 6265 7273 5d0d  in msg_numbers].
-0000d0c0: 0a0d 0a0d 0a64 6566 2073 7061 6365 6772  .....def spacegr
-0000d0d0: 6f75 705f 6d61 676e 6574 6963 286d 7367  oup_magnetic(msg
-0000d0e0: 5f6e 756d 6265 7229 3a0d 0a20 2020 2022  _number):..    "
-0000d0f0: 2222 0d0a 2020 2020 5265 7475 726e 2064  ""..    Return d
-0000d100: 6963 7420 6f66 206d 6167 6e65 7469 6320  ict of magnetic 
-0000d110: 7370 6163 6567 726f 7570 2c20 6769 7665  spacegroup, give
-0000d120: 6e20 6d61 676e 6574 6963 2073 7061 6365  n magnetic space
-0000d130: 6772 6f75 7020 6e75 6d62 6572 0d0a 2020  group number..  
-0000d140: 2020 3a70 6172 616d 206d 7367 5f6e 756d    :param msg_num
-0000d150: 6265 723a 206d 6167 6e65 7469 6320 7370  ber: magnetic sp
-0000d160: 6163 6520 6772 6f75 7020 6e75 6d62 6572  ace group number
-0000d170: 2065 2e67 2e20 3631 2e34 3333 0d0a 2020   e.g. 61.433..  
-0000d180: 2020 3a72 6574 7572 6e3a 2064 6963 7420    :return: dict 
-0000d190: 7769 7468 206b 6579 733a 0d0a 2020 2020  with keys:..    
-0000d1a0: 2020 2020 2770 6172 656e 7420 6e75 6d62      'parent numb
-0000d1b0: 6572 273a 2073 672c 0d0a 2020 2020 2020  er': sg,..      
-0000d1c0: 2020 2773 7061 6365 2067 726f 7570 206e    'space group n
-0000d1d0: 756d 6265 7227 3a20 6e75 6d62 6572 2c0d  umber': number,.
-0000d1e0: 0a20 2020 2020 2020 2027 7370 6163 6520  .        'space 
-0000d1f0: 6772 6f75 7020 6e61 6d65 273a 206c 6162  group name': lab
-0000d200: 656c 2c0d 0a20 2020 2020 2020 2027 7365  el,..        'se
-0000d210: 7474 696e 6727 3a20 7365 7474 696e 672c  tting': setting,
-0000d220: 0d0a 2020 2020 2020 2020 2774 7970 6520  ..        'type 
-0000d230: 6e61 6d65 273a 2074 7970 655f 6e61 6d65  name': type_name
-0000d240: 2c0d 0a20 2020 2020 2020 2027 7265 6c61  ,..        'rela
-0000d250: 7465 6420 6772 6f75 7027 3a20 7265 6c5f  ted group': rel_
-0000d260: 6e75 6d62 6572 2c0d 0a20 2020 2020 2020  number,..       
-0000d270: 2027 7265 6c61 7465 6420 6e61 6d65 273a   'related name':
-0000d280: 2072 656c 5f6e 616d 652c 0d0a 2020 2020   rel_name,..    
-0000d290: 2020 2020 2772 656c 6174 6564 2073 6574      'related set
-0000d2a0: 7469 6e67 273a 2072 656c 5f73 6574 7469  ting': rel_setti
-0000d2b0: 6e67 2c0d 0a20 2020 2020 2020 2027 6f70  ng,..        'op
-0000d2c0: 6572 6174 6f72 7320 6765 6e65 7261 6c27  erators general'
-0000d2d0: 3a20 7879 7a5f 6f70 2c0d 0a20 2020 2020  : xyz_op,..     
-0000d2e0: 2020 2027 6f70 6572 6174 6f72 7320 6d61     'operators ma
-0000d2f0: 676e 6574 6963 273a 206d 786d 796d 7a5f  gnetic': mxmymz_
-0000d300: 6f70 2c0d 0a20 2020 2020 2020 2027 6f70  op,..        'op
-0000d310: 6572 6174 6f72 7320 7469 6d65 273a 2074  erators time': t
-0000d320: 696d 652c 0d0a 2020 2020 2222 220d 0a20  ime,..    """.. 
-0000d330: 2020 206d 7367 5f6e 756d 6265 7220 3d20     msg_number = 
-0000d340: 6e70 2e61 7361 7272 6179 286d 7367 5f6e  np.asarray(msg_n
-0000d350: 756d 6265 722c 2064 7479 7065 3d73 7472  umber, dtype=str
-0000d360: 292e 7265 7368 6170 6528 2d31 290d 0a0d  ).reshape(-1)...
-0000d370: 0a20 2020 206d 7367 5f66 696c 6520 3d20  .    msg_file = 
-0000d380: 6f73 2e70 6174 682e 6a6f 696e 2864 6174  os.path.join(dat
-0000d390: 6164 6972 2c20 2753 7061 6365 4772 6f75  adir, 'SpaceGrou
-0000d3a0: 7073 4d61 676e 6574 6963 2e6a 736f 6e27  psMagnetic.json'
-0000d3b0: 290d 0a20 2020 2077 6974 6820 6f70 656e  )..    with open
-0000d3c0: 286d 7367 5f66 696c 652c 2027 7227 2920  (msg_file, 'r') 
-0000d3d0: 6173 2066 703a 0d0a 2020 2020 2020 2020  as fp:..        
-0000d3e0: 6d73 675f 6469 6374 203d 206a 736f 6e2e  msg_dict = json.
-0000d3f0: 6c6f 6164 2866 7029 0d0a 0d0a 2020 2020  load(fp)....    
-0000d400: 6966 204e 6f6e 6520 696e 206d 7367 5f6e  if None in msg_n
-0000d410: 756d 6265 723a 0d0a 2020 2020 2020 2020  umber:..        
-0000d420: 7265 7475 726e 206d 7367 5f64 6963 740d  return msg_dict.
-0000d430: 0a20 2020 2065 6c69 6620 6c65 6e28 6d73  .    elif len(ms
-0000d440: 675f 6e75 6d62 6572 2920 3d3d 2031 3a0d  g_number) == 1:.
-0000d450: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d460: 6d73 675f 6469 6374 5b6d 7367 5f6e 756d  msg_dict[msg_num
-0000d470: 6265 725b 305d 5d0d 0a20 2020 2065 6c73  ber[0]]..    els
-0000d480: 653a 0d0a 2020 2020 2020 2020 7265 7475  e:..        retu
-0000d490: 726e 205b 6d73 675f 6469 6374 5b6e 756d  rn [msg_dict[num
-0000d4a0: 5d20 666f 7220 6e75 6d20 696e 206d 7367  ] for num in msg
-0000d4b0: 5f6e 756d 6265 725d 0d0a 0d0a 0d0a 6465  _number]......de
-0000d4c0: 6620 7370 6163 6567 726f 7570 5f6d 6167  f spacegroup_mag
-0000d4d0: 6e65 7469 635f 6c69 7374 2873 675f 6e75  netic_list(sg_nu
-0000d4e0: 6d62 6572 293a 0d0a 2020 2020 2222 220d  mber):..    """.
-0000d4f0: 0a20 2020 2052 6574 7572 6e20 7374 7220  .    Return str 
-0000d500: 6c69 7374 206f 6620 6d61 676e 6574 6963  list of magnetic
-0000d510: 2073 7061 6365 2067 726f 7570 730d 0a20   space groups.. 
-0000d520: 2020 203a 7061 7261 6d20 7367 5f6e 756d     :param sg_num
-0000d530: 6265 723a 2073 7061 6365 2067 726f 7570  ber: space group
-0000d540: 206e 756d 6265 7220 2831 2d32 3330 290d   number (1-230).
-0000d550: 0a20 2020 203a 7265 7475 726e 3a20 7374  .    :return: st
-0000d560: 720d 0a20 2020 2022 2222 0d0a 2020 2020  r..    """..    
-0000d570: 6d61 675f 7370 6163 6567 726f 7570 7320  mag_spacegroups 
-0000d580: 3d20 7370 6163 6567 726f 7570 735f 6d61  = spacegroups_ma
-0000d590: 676e 6574 6963 2873 675f 6e75 6d62 6572  gnetic(sg_number
-0000d5a0: 290d 0a20 2020 206f 7574 203d 2027 270d  )..    out = ''.
-0000d5b0: 0a20 2020 2066 6d74 203d 2027 5061 7265  .    fmt = 'Pare
-0000d5c0: 6e74 3a20 2533 7320 4d61 676e 6574 6963  nt: %3s Magnetic
-0000d5d0: 3a20 252d 3130 7320 2025 2d31 3073 2020  : %-10s  %-10s  
-0000d5e0: 5365 7474 696e 673a 2025 3373 2025 3330  Setting: %3s %30
-0000d5f0: 7320 204f 7065 7261 746f 7273 3a20 2573  s  Operators: %s
-0000d600: 5c6e 270d 0a20 2020 2066 6f72 2073 6720  \n'..    for sg 
-0000d610: 696e 206d 6167 5f73 7061 6365 6772 6f75  in mag_spacegrou
-0000d620: 7073 3a0d 0a20 2020 2020 2020 2070 6172  ps:..        par
-0000d630: 656e 7420 3d20 7367 5b27 7061 7265 6e74  ent = sg['parent
-0000d640: 206e 756d 6265 7227 5d0d 0a20 2020 2020   number']..     
-0000d650: 2020 206e 756d 6265 7220 3d20 7367 5b27     number = sg['
-0000d660: 7370 6163 6520 6772 6f75 7020 6e75 6d62  space group numb
-0000d670: 6572 275d 0d0a 2020 2020 2020 2020 6e61  er']..        na
-0000d680: 6d65 203d 2073 675b 2773 7061 6365 2067  me = sg['space g
-0000d690: 726f 7570 206e 616d 6527 5d0d 0a20 2020  roup name']..   
-0000d6a0: 2020 2020 2073 6574 7469 6e67 203d 2073       setting = s
-0000d6b0: 675b 2773 6574 7469 6e67 275d 0d0a 2020  g['setting']..  
-0000d6c0: 2020 2020 2020 7479 7065 6e61 6d65 203d        typename =
-0000d6d0: 2073 675b 2774 7970 6520 6e61 6d65 275d   sg['type name']
-0000d6e0: 0d0a 2020 2020 2020 2020 2320 6f70 7320  ..        # ops 
-0000d6f0: 3d20 7367 5b27 6f70 6572 6174 6f72 7320  = sg['operators 
-0000d700: 6d61 676e 6574 6963 275d 0d0a 2020 2020  magnetic']..    
-0000d710: 2020 2020 6f70 7320 3d20 7367 5b27 706f      ops = sg['po
-0000d720: 7369 7469 6f6e 7320 6d61 676e 6574 6963  sitions magnetic
-0000d730: 275d 0d0a 2020 2020 2020 2020 6f75 7420  ']..        out 
-0000d740: 2b3d 2066 6d74 2025 2028 7061 7265 6e74  += fmt % (parent
-0000d750: 2c20 6e75 6d62 6572 2c20 6e61 6d65 2c20  , number, name, 
-0000d760: 7365 7474 696e 672c 2074 7970 656e 616d  setting, typenam
-0000d770: 652c 206f 7073 290d 0a20 2020 2072 6574  e, ops)..    ret
-0000d780: 7572 6e20 6f75 740d 0a0d 0a0d 0a27 2d2d  urn out......'--
-0000d790: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 456c 656d  ------------Elem
-0000d7a0: 656e 7420 5072 6f70 6572 7469 6573 2026  ent Properties &
-0000d7b0: 2043 6861 7267 652d 2d2d 2d2d 2d2d 2d2d   Charge---------
-0000d7c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 0d0a  -------------'..
-0000d7d0: 0d0a 0d0a 6465 6620 656c 656d 656e 745f  ....def element_
-0000d7e0: 7379 6d62 6f6c 2865 6c65 6d65 6e74 5f5a  symbol(element_Z
-0000d7f0: 3d4e 6f6e 6529 3a0d 0a20 2020 2022 2222  =None):..    """
-0000d800: 0d0a 2020 2020 5265 7475 726e 7320 7468  ..    Returns th
-0000d810: 6520 656c 656d 656e 7420 7379 6d70 6f6c  e element sympol
-0000d820: 2066 6f72 2065 6c65 6d65 6e74 5f5a 0d0a   for element_Z..
-0000d830: 2020 2020 3a70 6172 616d 2065 6c65 6d65      :param eleme
-0000d840: 6e74 5f7a 3a20 696e 7420 6f72 2061 7272  nt_z: int or arr
-0000d850: 6179 206f 7220 4e6f 6e65 2066 6f72 2061  ay or None for a
-0000d860: 6c6c 2065 6c65 6d65 6e74 730d 0a20 2020  ll elements..   
-0000d870: 203a 7265 7475 726e 3a20 7374 720d 0a20   :return: str.. 
-0000d880: 2020 2022 2222 0d0a 2020 2020 7379 6d62     """..    symb
-0000d890: 6f6c 7320 3d20 6174 6f6d 5f70 726f 7065  ols = atom_prope
-0000d8a0: 7274 6965 7328 4e6f 6e65 2c20 2745 6c65  rties(None, 'Ele
-0000d8b0: 6d65 6e74 2729 0d0a 2020 2020 6966 2065  ment')..    if e
-0000d8c0: 6c65 6d65 6e74 5f5a 2069 7320 4e6f 6e65  lement_Z is None
-0000d8d0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0000d8e0: 6e20 7379 6d62 6f6c 730d 0a20 2020 2065  n symbols..    e
-0000d8f0: 6c65 6d65 6e74 5f5a 203d 206e 702e 6173  lement_Z = np.as
-0000d900: 6172 7261 7928 656c 656d 656e 745f 5a29  array(element_Z)
-0000d910: 2e72 6573 6861 7065 282d 3129 0d0a 2020  .reshape(-1)..  
-0000d920: 2020 7265 7475 726e 2073 796d 626f 6c73    return symbols
-0000d930: 5b65 6c65 6d65 6e74 5f5a 202d 2031 5d0d  [element_Z - 1].
-0000d940: 0a0d 0a0d 0a64 6566 2065 6c65 6d65 6e74  .....def element
-0000d950: 5f7a 2865 6c65 6d65 6e74 293a 0d0a 2020  _z(element):..  
-0000d960: 2020 2222 220d 0a20 2020 2052 6574 7572    """..    Retur
-0000d970: 6e73 2074 6865 2065 6c65 6d65 6e74 206e  ns the element n
-0000d980: 756d 6265 7220 5a0d 0a20 2020 203a 7061  umber Z..    :pa
-0000d990: 7261 6d20 656c 656d 656e 743a 2073 7472  ram element: str
-0000d9a0: 0d0a 2020 2020 3a72 6574 7572 6e3a 2069  ..    :return: i
-0000d9b0: 6e74 0d0a 2020 2020 2222 220d 0a20 2020  nt..    """..   
-0000d9c0: 207a 203d 2061 746f 6d5f 7072 6f70 6572   z = atom_proper
-0000d9d0: 7469 6573 2865 6c65 6d65 6e74 2c20 275a  ties(element, 'Z
-0000d9e0: 2729 0d0a 2020 2020 6966 206c 656e 287a  ')..    if len(z
-0000d9f0: 2920 3d3d 2031 3a0d 0a20 2020 2020 2020  ) == 1:..       
-0000da00: 2072 6574 7572 6e20 7a5b 305d 0d0a 2020   return z[0]..  
-0000da10: 2020 7265 7475 726e 207a 0d0a 0d0a 0d0a    return z......
-0000da20: 6465 6620 656c 656d 656e 745f 6e61 6d65  def element_name
-0000da30: 2865 6c65 6d65 6e74 3d4e 6f6e 6529 3a0d  (element=None):.
-0000da40: 0a20 2020 2022 2222 0d0a 2020 2020 5265  .    """..    Re
-0000da50: 7475 726e 7320 7468 6520 656c 656d 656e  turns the elemen
-0000da60: 7420 6e61 6d65 0d0a 2020 2020 3a70 6172  t name..    :par
-0000da70: 616d 2065 6c65 6d65 6e74 3a20 7374 720d  am element: str.
-0000da80: 0a20 2020 203a 7265 7475 726e 3a20 696e  .    :return: in
-0000da90: 740d 0a20 2020 2022 2222 0d0a 2020 2020  t..    """..    
-0000daa0: 6e61 6d65 203d 2061 746f 6d5f 7072 6f70  name = atom_prop
-0000dab0: 6572 7469 6573 2865 6c65 6d65 6e74 2c20  erties(element, 
-0000dac0: 274e 616d 6527 290d 0a20 2020 2069 6620  'Name')..    if 
-0000dad0: 6c65 6e28 6e61 6d65 2920 3d3d 2031 3a0d  len(name) == 1:.
-0000dae0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000daf0: 6e61 6d65 5b30 5d0d 0a20 2020 2072 6574  name[0]..    ret
-0000db00: 7572 6e20 6e61 6d65 0d0a 0d0a 0d0a 6465  urn name......de
-0000db10: 6620 7370 6c69 745f 656c 656d 656e 745f  f split_element_
-0000db20: 7379 6d62 6f6c 2865 6c65 6d65 6e74 293a  symbol(element):
-0000db30: 0d0a 2020 2020 2222 220d 0a20 2020 2046  ..    """..    F
-0000db40: 726f 6d20 656c 656d 656e 7420 7379 6d62  rom element symb
-0000db50: 6f6c 2c20 7370 6c69 7420 6368 6172 6765  ol, split charge
-0000db60: 2061 6e64 206f 6363 7570 616e 6379 0d0a   and occupancy..
-0000db70: 2020 2020 2020 7379 6d62 6f6c 2c20 6f63        symbol, oc
-0000db80: 6375 7061 6e63 792c 2063 6861 7267 6520  cupancy, charge 
-0000db90: 3d20 7370 6c69 745f 656c 656d 656e 745f  = split_element_
-0000dba0: 7379 6d62 6f6c 2827 436f 332b 2729 0d0a  symbol('Co3+')..
-0000dbb0: 2020 2020 416e 7920 6e75 6d62 6572 7320      Any numbers 
-0000dbc0: 6170 7065 6e64 6564 2062 7920 2b2f 2d20  appended by +/- 
-0000dbd0: 6172 6520 7461 6b65 6e20 6173 2063 6861  are taken as cha
-0000dbe0: 7267 652c 206f 7468 6572 7769 7365 2074  rge, otherwise t
-0000dbf0: 6865 7920 6172 6520 636f 756e 7465 6420  hey are counted 
-0000dc00: 6173 206f 6363 7570 616e 6379 2e0d 0a20  as occupancy... 
-0000dc10: 2020 2065 2e67 2e20 2020 2065 6c65 6d65     e.g.    eleme
-0000dc20: 6e74 2020 2020 203e 2020 2073 796d 626f  nt     >   symbo
-0000dc30: 6c20 207c 2020 206f 6363 7570 616e 6379  l  |   occupancy
-0000dc40: 2020 207c 2020 2063 6861 7267 650d 0a20     |   charge.. 
-0000dc50: 2020 2020 2020 2020 2020 2043 6f33 2b20             Co3+ 
-0000dc60: 2020 2020 2020 2020 2020 2043 6f20 2020             Co   
-0000dc70: 2020 2020 2020 2031 2e20 2020 2020 2020         1.       
-0000dc80: 2020 2020 2020 2033 0d0a 2020 2020 2020         3..      
-0000dc90: 2020 2020 2020 332e 324f 322d 2020 2020        3.2O2-    
-0000dca0: 2020 2020 2020 4f20 2020 2020 2020 2020        O         
-0000dcb0: 2020 332e 3220 2020 2020 2020 2020 2020    3.2           
-0000dcc0: 2020 2d32 0d0a 2020 2020 2020 2020 2020    -2..          
-0000dcd0: 2020 6665 3320 2020 2020 2020 2020 2020    fe3           
-0000dce0: 2020 4665 2020 2020 2020 2020 2020 3320    Fe          3 
-0000dcf0: 2020 2020 2020 2020 2020 2020 2020 300d                0.
-0000dd00: 0a20 2020 203a 7061 7261 6d20 656c 656d  .    :param elem
-0000dd10: 656e 743a 2073 7472 0d0a 2020 2020 3a72  ent: str..    :r
-0000dd20: 6574 7572 6e3a 2073 796d 626f 6c3a 2073  eturn: symbol: s
-0000dd30: 7472 0d0a 2020 2020 3a72 6574 7572 6e3a  tr..    :return:
-0000dd40: 206f 6363 7570 616e 6379 3a20 666c 6f61   occupancy: floa
-0000dd50: 740d 0a20 2020 203a 7265 7475 726e 3a20  t..    :return: 
-0000dd60: 6368 6172 6765 3a20 666c 6f61 740d 0a20  charge: float.. 
-0000dd70: 2020 2022 2222 0d0a 2020 2020 2320 4669     """..    # Fi
-0000dd80: 6e64 2065 6c65 6d65 6e74 0d0a 2020 2020  nd element..    
-0000dd90: 7379 6d62 6f6c 203d 2065 6c65 6d65 6e74  symbol = element
-0000dda0: 5f72 6567 6578 2e66 696e 6461 6c6c 2865  _regex.findall(e
-0000ddb0: 6c65 6d65 6e74 295b 305d 0d0a 2020 2020  lement)[0]..    
-0000ddc0: 2320 4669 6e64 2063 6861 7267 650d 0a20  # Find charge.. 
-0000ddd0: 2020 2066 696e 645f 6368 6172 6765 203d     find_charge =
-0000dde0: 2072 652e 6669 6e64 616c 6c28 275b 5c64   re.findall('[\d
-0000ddf0: 5c2e 5d2b 5b5c 2b2d 5d27 2c20 656c 656d  \.]+[\+-]', elem
-0000de00: 656e 7429 0d0a 2020 2020 6966 206c 656e  ent)..    if len
-0000de10: 2866 696e 645f 6368 6172 6765 2920 3e20  (find_charge) > 
-0000de20: 303a 0d0a 2020 2020 2020 2020 6368 6172  0:..        char
-0000de30: 6765 7374 7220 3d20 6669 6e64 5f63 6861  gestr = find_cha
-0000de40: 7267 655b 305d 0d0a 2020 2020 2020 2020  rge[0]..        
-0000de50: 656c 656d 656e 7420 3d20 656c 656d 656e  element = elemen
-0000de60: 742e 7265 706c 6163 6528 6368 6172 6765  t.replace(charge
-0000de70: 7374 722c 2027 2729 0d0a 2020 2020 2020  str, '')..      
-0000de80: 2020 6966 2027 2d27 2069 6e20 6368 6172    if '-' in char
-0000de90: 6765 7374 723a 0d0a 2020 2020 2020 2020  gestr:..        
-0000dea0: 2020 2020 6368 6172 6765 203d 202d 666c      charge = -fl
-0000deb0: 6f61 7428 6368 6172 6765 7374 725b 3a2d  oat(chargestr[:-
-0000dec0: 315d 290d 0a20 2020 2020 2020 2065 6c73  1])..        els
-0000ded0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000dee0: 6368 6172 6765 203d 2066 6c6f 6174 2863  charge = float(c
-0000def0: 6861 7267 6573 7472 5b3a 2d31 5d29 0d0a  hargestr[:-1])..
-0000df00: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000df10: 2020 2063 6861 7267 6520 3d20 302e 0d0a     charge = 0...
-0000df20: 2020 2020 2320 4669 6e64 206f 6363 7570      # Find occup
-0000df30: 616e 6379 0d0a 2020 2020 6669 6e64 5f6f  ancy..    find_o
-0000df40: 6363 203d 2072 652e 6669 6e64 616c 6c28  cc = re.findall(
-0000df50: 275b 5c64 5c2e 5d2b 272c 2065 6c65 6d65  '[\d\.]+', eleme
-0000df60: 6e74 290d 0a20 2020 2069 6620 6c65 6e28  nt)..    if len(
-0000df70: 6669 6e64 5f6f 6363 2920 3e20 303a 0d0a  find_occ) > 0:..
-0000df80: 2020 2020 2020 2020 6f63 6375 7061 6e63          occupanc
-0000df90: 7920 3d20 666c 6f61 7428 6669 6e64 5f6f  y = float(find_o
-0000dfa0: 6363 5b30 5d29 0d0a 2020 2020 656c 7365  cc[0])..    else
-0000dfb0: 3a0d 0a20 2020 2020 2020 206f 6363 7570  :..        occup
-0000dfc0: 616e 6379 203d 2031 2e0d 0a20 2020 2072  ancy = 1...    r
-0000dfd0: 6574 7572 6e20 7379 6d62 6f6c 2c20 6f63  eturn symbol, oc
-0000dfe0: 6375 7061 6e63 792c 2063 6861 7267 650d  cupancy, charge.
-0000dff0: 0a0d 0a0d 0a64 6566 2065 6c65 6d65 6e74  .....def element
-0000e000: 5f63 6861 7267 655f 7374 7269 6e67 2873  _charge_string(s
-0000e010: 796d 626f 6c2c 206f 6363 7570 616e 6379  ymbol, occupancy
-0000e020: 3d31 2e30 2c20 6368 6172 6765 3d30 2e30  =1.0, charge=0.0
-0000e030: 2c20 6c61 7465 783d 4661 6c73 6529 3a0d  , latex=False):.
-0000e040: 0a20 2020 2022 2222 0d0a 2020 2020 5265  .    """..    Re
-0000e050: 7475 726e 2066 6f72 6d61 7474 6564 2073  turn formatted s
-0000e060: 7472 696e 6720 6f66 2065 6c65 6d65 6e74  tring of element
-0000e070: 2077 6974 6820 6f63 6375 7061 6e63 7920   with occupancy 
-0000e080: 616e 6420 6368 6172 6765 0d0a 2020 2020  and charge..    
-0000e090: 3a70 6172 616d 2073 796d 626f 6c3a 2073  :param symbol: s
-0000e0a0: 7472 202d 2065 6c65 6d65 6e74 2073 7472  tr - element str
-0000e0b0: 696e 670d 0a20 2020 203a 7061 7261 6d20  ing..    :param 
-0000e0c0: 6f63 6375 7061 6e63 793a 2066 6c6f 6174  occupancy: float
-0000e0d0: 202d 2065 6c65 6d65 6e74 206f 6363 7570   - element occup
-0000e0e0: 616e 6379 206f 7220 6e75 6d62 6572 206f  ancy or number o
-0000e0f0: 6620 656c 656d 656e 7473 0d0a 2020 2020  f elements..    
-0000e100: 3a70 6172 616d 2063 6861 7267 653a 2066  :param charge: f
-0000e110: 6c6f 6174 202d 2065 6c65 6d65 6e74 2063  loat - element c
-0000e120: 6861 7267 650d 0a20 2020 203a 7061 7261  harge..    :para
-0000e130: 6d20 6c61 7465 783a 2069 6620 5472 7565  m latex: if True
-0000e140: 2c20 7265 7475 726e 7320 7374 7269 6e67  , returns string
-0000e150: 2066 6f72 6d61 7474 6564 2077 6974 6820   formatted with 
-0000e160: 6c61 7465 7820 7461 6773 0d0a 2020 2020  latex tags..    
-0000e170: 3a72 6574 7572 6e3a 2073 7472 0d0a 2020  :return: str..  
-0000e180: 2020 2222 220d 0a20 2020 2069 6620 6162    """..    if ab
-0000e190: 7328 6368 6172 6765 2920 3c20 302e 3031  s(charge) < 0.01
-0000e1a0: 3a0d 0a20 2020 2020 2020 2063 6873 7472  :..        chstr
-0000e1b0: 203d 2027 270d 0a20 2020 2065 6c69 6620   = ''..    elif 
-0000e1c0: 6162 7328 6368 6172 6765 202d 2031 2920  abs(charge - 1) 
-0000e1d0: 3c20 302e 3031 3a0d 0a20 2020 2020 2020  < 0.01:..       
-0000e1e0: 2063 6873 7472 203d 2027 2b27 0d0a 2020   chstr = '+'..  
-0000e1f0: 2020 656c 6966 2061 6273 2863 6861 7267    elif abs(charg
-0000e200: 6520 2b20 3129 203c 2030 2e30 313a 0d0a  e + 1) < 0.01:..
-0000e210: 2020 2020 2020 2020 6368 7374 7220 3d20          chstr = 
-0000e220: 272d 270d 0a20 2020 2065 6c69 6620 6368  '-'..    elif ch
-0000e230: 6172 6765 203e 2030 3a0d 0a20 2020 2020  arge > 0:..     
-0000e240: 2020 2063 6873 7472 203d 2027 2530 2e33     chstr = '%0.3
-0000e250: 672b 2720 2520 6368 6172 6765 0d0a 2020  g+' % charge..  
-0000e260: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0000e270: 2063 6873 7472 203d 2027 2530 2e33 672d   chstr = '%0.3g-
-0000e280: 2720 2520 6162 7328 6368 6172 6765 290d  ' % abs(charge).
-0000e290: 0a0d 0a20 2020 2069 6620 6c61 7465 783a  ...    if latex:
-0000e2a0: 0d0a 2020 2020 2020 2020 6368 7374 7220  ..        chstr 
-0000e2b0: 3d20 2724 5e7b 2573 7d24 2720 2520 6368  = '$^{%s}$' % ch
-0000e2c0: 7374 720d 0a0d 0a20 2020 2069 6620 6e70  str....    if np
-0000e2d0: 2e61 6273 286f 6363 7570 616e 6379 202d  .abs(occupancy -
-0000e2e0: 2031 2920 3c20 302e 3031 3a0d 0a20 2020   1) < 0.01:..   
-0000e2f0: 2020 2020 206f 7574 7374 7220 3d20 2725       outstr = '%
-0000e300: 7325 7327 2025 2028 7379 6d62 6f6c 2c20  s%s' % (symbol, 
-0000e310: 6368 7374 7229 0d0a 2020 2020 656c 7365  chstr)..    else
-0000e320: 3a0d 0a20 2020 2020 2020 206f 7574 7374  :..        outst
-0000e330: 7220 3d20 2725 302e 3367 5b25 7325 735d  r = '%0.3g[%s%s]
-0000e340: 2720 2520 286f 6363 7570 616e 6379 2c20  ' % (occupancy, 
-0000e350: 7379 6d62 6f6c 2c20 6368 7374 7229 0d0a  symbol, chstr)..
-0000e360: 2020 2020 7265 7475 726e 206f 7574 7374      return outst
-0000e370: 720d 0a0d 0a0d 0a64 6566 2073 706c 6974  r......def split
-0000e380: 5f63 6f6d 706f 756e 6428 636f 6d70 6f75  _compound(compou
-0000e390: 6e64 5f6e 616d 6529 3a0d 0a20 2020 2022  nd_name):..    "
-0000e3a0: 2222 0d0a 2020 2020 436f 6e76 6572 7420  ""..    Convert 
-0000e3b0: 6120 6d6f 6c65 6375 6c61 7220 6f72 2063  a molecular or c
-0000e3c0: 6f6d 706f 756e 6420 6e61 6d65 2069 6e74  ompound name int
-0000e3d0: 6f20 6120 6c69 7374 206f 6620 656c 656d  o a list of elem
-0000e3e0: 656e 7473 2061 6e64 206e 756d 6265 7273  ents and numbers
-0000e3f0: 2e0d 0a20 2020 2041 7373 756d 6573 2061  ...    Assumes a
-0000e400: 6c6c 2065 6c65 6d65 6e74 206d 756c 7469  ll element multi
-0000e410: 706c 6963 6174 696f 6e73 2061 7265 2074  plications are t
-0000e420: 6f20 7468 6520 4c45 4654 206f 6620 7468  o the LEFT of th
-0000e430: 6520 656c 656d 656e 7420 6e61 6d65 2e0d  e element name..
-0000e440: 0a20 2020 2056 616c 7565 7320 696e 2062  .    Values in b
-0000e450: 7261 636b 6574 7320 6172 6520 6d75 6c74  rackets are mult
-0000e460: 6970 6c69 6564 206f 7574 2e0d 0a20 2020  iplied out...   
-0000e470: 2045 2e67 2e0d 0a20 2020 2020 2020 2073   E.g...        s
-0000e480: 706c 6974 5f63 6f6d 706f 756e 6428 274d  plit_compound('M
-0000e490: 6e30 2e33 2846 6533 2e36 2843 6f31 2e32  n0.3(Fe3.6(Co1.2
-0000e4a0: 2932 2934 284d 6f30 2e37 5072 3434 2933  )2)4(Mo0.7Pr44)3
-0000e4b0: 2729 0d0a 2020 2020 2020 2020 3e3e 205b  ')..        >> [
-0000e4c0: 274d 6e30 2e33 272c 2027 4665 3134 2e34  'Mn0.3', 'Fe14.4
-0000e4d0: 272c 2027 436f 392e 3627 2c20 274d 6f32  ', 'Co9.6', 'Mo2
-0000e4e0: 2e31 272c 2027 5072 3133 3227 5d0d 0a20  .1', 'Pr132'].. 
-0000e4f0: 2020 203a 7061 7261 6d20 636f 6d70 6f75     :param compou
-0000e500: 6e64 5f6e 616d 653a 2073 7472 0d0a 2020  nd_name: str..  
-0000e510: 2020 3a72 6574 7572 6e3a 206c 6973 7420    :return: list 
-0000e520: 6f66 2073 7472 0d0a 2020 2020 2222 220d  of str..    """.
-0000e530: 0a20 2020 2072 6567 6578 5f65 6c65 6d65  .    regex_eleme
-0000e540: 6e74 5f6e 756d 203d 2072 652e 636f 6d70  nt_num = re.comp
-0000e550: 696c 6528 277c 272e 6a6f 696e 285b 2725  ile('|'.join(['%
-0000e560: 735b 5c64 5c2e 5d2a 2720 2520 656c 2066  s[\d\.]*' % el f
-0000e570: 6f72 2065 6c20 696e 2045 4c45 4d45 4e54  or el in ELEMENT
-0000e580: 5f4c 4953 545d 2929 0d0a 2020 2020 2320  _LIST]))..    # 
-0000e590: 4d75 6c74 6970 6c79 206f 7574 2062 7261  Multiply out bra
-0000e5a0: 636b 6574 730d 0a20 2020 2063 6f6d 706f  ckets..    compo
-0000e5b0: 756e 645f 6e61 6d65 203d 2066 672e 7265  und_name = fg.re
-0000e5c0: 706c 6163 655f 6272 6163 6b65 745f 6d75  place_bracket_mu
-0000e5d0: 6c74 6970 6c65 2863 6f6d 706f 756e 645f  ltiple(compound_
-0000e5e0: 6e61 6d65 290d 0a20 2020 2072 6574 7572  name)..    retur
-0000e5f0: 6e20 7265 6765 785f 656c 656d 656e 745f  n regex_element_
-0000e600: 6e75 6d2e 6669 6e64 616c 6c28 636f 6d70  num.findall(comp
-0000e610: 6f75 6e64 5f6e 616d 6529 0d0a 0d0a 0d0a  ound_name)......
-0000e620: 6465 6620 6f72 6269 7461 6c5f 636f 6e66  def orbital_conf
-0000e630: 6967 7572 6174 696f 6e28 656c 656d 656e  iguration(elemen
-0000e640: 742c 2063 6861 7267 653d 4e6f 6e65 293a  t, charge=None):
-0000e650: 0d0a 2020 2020 2222 220d 0a20 2020 2052  ..    """..    R
-0000e660: 6574 7572 6e73 2074 6865 206f 7262 6974  eturns the orbit
-0000e670: 616c 2063 6f6e 6669 6775 7261 7469 6f6e  al configuration
-0000e680: 206f 6620 616e 2065 6c65 6d65 6e74 2061   of an element a
-0000e690: 7320 6120 6c69 7374 206f 6620 7374 7269  s a list of stri
-0000e6a0: 6e67 730d 0a20 2020 203a 7061 7261 6d20  ngs..    :param 
-0000e6b0: 656c 656d 656e 743a 2073 7472 2c20 656c  element: str, el
-0000e6c0: 656d 656e 7420 6e61 6d65 2c20 652e 672e  ement name, e.g.
-0000e6d0: 2027 4665 2720 6f72 2027 4665 332b 2720   'Fe' or 'Fe3+' 
-0000e6e0: 6f72 2027 302e 3846 6532 2b27 0d0a 2020  or '0.8Fe2+'..  
-0000e6f0: 2020 3a70 6172 616d 2063 6861 7267 653a    :param charge:
-0000e700: 2069 6e74 2c20 656c 656d 656e 7420 6368   int, element ch
-0000e710: 6172 6765 2028 6f76 6572 7772 6974 6573  arge (overwrites
-0000e720: 2063 6861 7267 6520 6769 7665 6e20 696e   charge given in
-0000e730: 2065 6c65 6d65 6e74 290d 0a20 2020 203a   element)..    :
-0000e740: 7265 7475 726e 3a20 5b27 3173 3227 2c20  return: ['1s2', 
-0000e750: 2732 7332 272c 2027 3270 3627 2c20 2e2e  '2s2', '2p6', ..
-0000e760: 2e5d 0d0a 2020 2020 2222 220d 0a20 2020  .]..    """..   
-0000e770: 2073 796d 626f 6c2c 206f 6363 7570 616e   symbol, occupan
-0000e780: 6379 2c20 6368 6172 6765 5f73 7472 203d  cy, charge_str =
-0000e790: 2073 706c 6974 5f65 6c65 6d65 6e74 5f73   split_element_s
-0000e7a0: 796d 626f 6c28 656c 656d 656e 7429 0d0a  ymbol(element)..
-0000e7b0: 2020 2020 7a20 3d20 656c 656d 656e 745f      z = element_
-0000e7c0: 7a28 7379 6d62 6f6c 290d 0a20 2020 2069  z(symbol)..    i
-0000e7d0: 6620 6368 6172 6765 2069 7320 4e6f 6e65  f charge is None
-0000e7e0: 3a0d 0a20 2020 2020 2020 2063 6861 7267  :..        charg
-0000e7f0: 6520 3d20 6368 6172 6765 5f73 7472 0d0a  e = charge_str..
-0000e800: 2020 2020 6e65 777a 203d 207a 202d 2069      newz = z - i
-0000e810: 6e74 2863 6861 7267 6529 2020 2320 666c  nt(charge)  # fl
-0000e820: 6f6f 720d 0a20 2020 2069 6620 6e65 777a  oor..    if newz
-0000e830: 203c 2031 3a20 6e65 777a 203d 2031 0d0a   < 1: newz = 1..
-0000e840: 2020 2020 6966 206e 6577 7a20 3e20 3131      if newz > 11
-0000e850: 383a 206e 6577 7a20 3d20 3131 380d 0a20  8: newz = 118.. 
-0000e860: 2020 2065 6c65 6d65 6e74 203d 2065 6c65     element = ele
-0000e870: 6d65 6e74 5f73 796d 626f 6c28 6e65 777a  ment_symbol(newz
-0000e880: 290d 0a20 2020 2063 6f6e 6669 6720 3d20  )..    config = 
-0000e890: 6174 6f6d 5f70 726f 7065 7274 6965 7328  atom_properties(
-0000e8a0: 656c 656d 656e 742c 2027 436f 6e66 6967  element, 'Config
-0000e8b0: 2729 0d0a 2020 2020 7265 7475 726e 2063  ')..    return c
-0000e8c0: 6f6e 6669 675b 305d 2e73 706c 6974 2827  onfig[0].split('
-0000e8d0: 2e27 290d 0a0d 0a0d 0a64 6566 2064 6566  .')......def def
-0000e8e0: 6175 6c74 5f61 746f 6d5f 6368 6172 6765  ault_atom_charge
-0000e8f0: 2865 6c65 6d65 6e74 293a 0d0a 2020 2020  (element):..    
-0000e900: 2222 220d 0a20 2020 2052 6574 7572 6e73  """..    Returns
-0000e910: 2074 6865 2064 6566 6175 6c74 2063 6861   the default cha
-0000e920: 7267 6520 7661 6c75 6520 666f 7220 7468  rge value for th
-0000e930: 6520 656c 656d 656e 740d 0a20 2020 203a  e element..    :
-0000e940: 7061 7261 6d20 656c 656d 656e 743a 2073  param element: s
-0000e950: 7472 3a20 2746 6527 0d0a 2020 2020 3a72  tr: 'Fe'..    :r
-0000e960: 6574 7572 6e3a 2069 6e74 206f 7220 6e61  eturn: int or na
-0000e970: 6e0d 0a20 2020 2022 2222 0d0a 0d0a 2020  n..    """....  
-0000e980: 2020 656c 656d 656e 7420 3d20 6e70 2e61    element = np.a
-0000e990: 7361 7272 6179 2865 6c65 6d65 6e74 292e  sarray(element).
-0000e9a0: 7265 7368 6170 6528 2d31 290d 0a20 2020  reshape(-1)..   
-0000e9b0: 2063 6861 7267 6520 3d20 6e70 2e7a 6572   charge = np.zer
-0000e9c0: 6f73 286c 656e 2865 6c65 6d65 6e74 2929  os(len(element))
-0000e9d0: 0d0a 2020 2020 666f 7220 6e20 696e 2072  ..    for n in r
-0000e9e0: 616e 6765 286c 656e 2865 6c65 6d65 6e74  ange(len(element
-0000e9f0: 2929 3a0d 0a20 2020 2020 2020 2073 796d  )):..        sym
-0000ea00: 626f 6c2c 206f 6363 7570 616e 6379 2c20  bol, occupancy, 
-0000ea10: 656c 6563 6861 7267 6520 3d20 7370 6c69  elecharge = spli
-0000ea20: 745f 656c 656d 656e 745f 7379 6d62 6f6c  t_element_symbol
-0000ea30: 2865 6c65 6d65 6e74 5b6e 5d29 0d0a 2020  (element[n])..  
-0000ea40: 2020 2020 2020 6772 6f75 7020 3d20 6174        group = at
-0000ea50: 6f6d 5f70 726f 7065 7274 6965 7328 7379  om_properties(sy
-0000ea60: 6d62 6f6c 2c20 2747 726f 7570 2729 5b30  mbol, 'Group')[0
-0000ea70: 5d0d 0a20 2020 2020 2020 2069 6620 656c  ]..        if el
-0000ea80: 6563 6861 7267 6520 213d 2030 3a0d 0a20  echarge != 0:.. 
-0000ea90: 2020 2020 2020 2020 2020 2063 6861 7267             charg
-0000eaa0: 655b 6e5d 203d 2065 6c65 6368 6172 6765  e[n] = elecharge
-0000eab0: 0d0a 2020 2020 2020 2020 656c 6966 2067  ..        elif g
-0000eac0: 726f 7570 203d 3d20 313a 0d0a 2020 2020  roup == 1:..    
-0000ead0: 2020 2020 2020 2020 6368 6172 6765 5b6e          charge[n
-0000eae0: 5d20 3d20 3120 2a20 6f63 6375 7061 6e63  ] = 1 * occupanc
-0000eaf0: 790d 0a20 2020 2020 2020 2065 6c69 6620  y..        elif 
-0000eb00: 6772 6f75 7020 3d3d 2032 3a0d 0a20 2020  group == 2:..   
-0000eb10: 2020 2020 2020 2020 2063 6861 7267 655b           charge[
-0000eb20: 6e5d 203d 2032 202a 206f 6363 7570 616e  n] = 2 * occupan
-0000eb30: 6379 0d0a 2020 2020 2020 2020 656c 6966  cy..        elif
-0000eb40: 2067 726f 7570 203d 3d20 3136 3a0d 0a20   group == 16:.. 
-0000eb50: 2020 2020 2020 2020 2020 2063 6861 7267             charg
-0000eb60: 655b 6e5d 203d 202d 3220 2a20 6f63 6375  e[n] = -2 * occu
-0000eb70: 7061 6e63 790d 0a20 2020 2020 2020 2065  pancy..        e
-0000eb80: 6c69 6620 6772 6f75 7020 3d3d 2031 373a  lif group == 17:
-0000eb90: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
-0000eba0: 6172 6765 5b6e 5d20 3d20 2d31 202a 206f  arge[n] = -1 * o
-0000ebb0: 6363 7570 616e 6379 0d0a 2020 2020 2020  ccupancy..      
-0000ebc0: 2020 656c 6966 2067 726f 7570 203d 3d20    elif group == 
-0000ebd0: 3138 3a0d 0a20 2020 2020 2020 2020 2020  18:..           
-0000ebe0: 2063 6861 7267 655b 6e5d 203d 2030 0d0a   charge[n] = 0..
-0000ebf0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000ec00: 2020 2020 2020 2020 2020 2063 6861 7267             charg
-0000ec10: 655b 6e5d 203d 206e 702e 6e61 6e0d 0a20  e[n] = np.nan.. 
-0000ec20: 2020 2069 6620 6c65 6e28 6368 6172 6765     if len(charge
-0000ec30: 2920 3d3d 2031 3a0d 0a20 2020 2020 2020  ) == 1:..       
-0000ec40: 2072 6574 7572 6e20 6368 6172 6765 5b30   return charge[0
-0000ec50: 5d0d 0a20 2020 2072 6574 7572 6e20 6368  ]..    return ch
-0000ec60: 6172 6765 0d0a 0d0a 0d0a 6465 6620 6261  arge......def ba
-0000ec70: 6c61 6e63 655f 6174 6f6d 5f63 6861 7267  lance_atom_charg
-0000ec80: 6528 6c69 7374 5f6f 665f 656c 656d 656e  e(list_of_elemen
-0000ec90: 7473 2c20 6f63 6375 7061 6e63 793d 4e6f  ts, occupancy=No
-0000eca0: 6e65 293a 0d0a 2020 2020 2222 220d 0a20  ne):..    """.. 
-0000ecb0: 2020 2044 6574 6572 6d69 6e65 2074 6865     Determine the
-0000ecc0: 2064 6566 6175 6c74 2063 6861 7267 6573   default charges
-0000ecd0: 2061 6e64 2061 7373 6967 6e20 7265 6d61   and assign rema
-0000ece0: 696e 696e 6720 6368 6172 6765 2074 6f0d  ining charge to.
-0000ecf0: 0a20 2020 2075 6e73 7065 6369 6669 6564  .    unspecified
-0000ed00: 2065 6c65 6d65 6e74 730d 0a20 2020 203a   elements..    :
-0000ed10: 7061 7261 6d20 6c69 7374 5f6f 665f 656c  param list_of_el
-0000ed20: 656d 656e 7473 3a0d 0a20 2020 203a 7265  ements:..    :re
-0000ed30: 7475 726e 3a20 5b6c 6973 7420 6f66 2063  turn: [list of c
-0000ed40: 6861 7267 6573 5d0d 0a20 2020 2022 2222  harges]..    """
-0000ed50: 0d0a 0d0a 2020 2020 6966 206f 6363 7570  ....    if occup
-0000ed60: 616e 6379 2069 7320 4e6f 6e65 3a0d 0a20  ancy is None:.. 
-0000ed70: 2020 2020 2020 206f 6363 7570 616e 6379         occupancy
-0000ed80: 203d 206e 702e 6f6e 6573 286c 656e 286c   = np.ones(len(l
-0000ed90: 6973 745f 6f66 5f65 6c65 6d65 6e74 7329  ist_of_elements)
-0000eda0: 290d 0a20 2020 2065 6c73 653a 0d0a 2020  )..    else:..  
-0000edb0: 2020 2020 2020 6f63 6375 7061 6e63 7920        occupancy 
-0000edc0: 3d20 6e70 2e61 7361 7272 6179 286f 6363  = np.asarray(occ
-0000edd0: 7570 616e 6379 290d 0a0d 0a20 2020 2063  upancy)....    c
-0000ede0: 6861 7267 6520 3d20 6e70 2e7a 6572 6f73  harge = np.zeros
-0000edf0: 286c 656e 286c 6973 745f 6f66 5f65 6c65  (len(list_of_ele
-0000ee00: 6d65 6e74 7329 290d 0a20 2020 2066 6f72  ments))..    for
-0000ee10: 206e 2069 6e20 7261 6e67 6528 6c65 6e28   n in range(len(
-0000ee20: 6c69 7374 5f6f 665f 656c 656d 656e 7473  list_of_elements
-0000ee30: 2929 3a0d 0a20 2020 2020 2020 205f 2c20  )):..        _, 
-0000ee40: 6f63 632c 205f 203d 2073 706c 6974 5f65  occ, _ = split_e
-0000ee50: 6c65 6d65 6e74 5f73 796d 626f 6c28 6c69  lement_symbol(li
-0000ee60: 7374 5f6f 665f 656c 656d 656e 7473 5b6e  st_of_elements[n
-0000ee70: 5d29 0d0a 2020 2020 2020 2020 6368 6172  ])..        char
-0000ee80: 6765 5b6e 5d20 3d20 6f63 6375 7061 6e63  ge[n] = occupanc
-0000ee90: 795b 6e5d 202a 2064 6566 6175 6c74 5f61  y[n] * default_a
-0000eea0: 746f 6d5f 6368 6172 6765 286c 6973 745f  tom_charge(list_
-0000eeb0: 6f66 5f65 6c65 6d65 6e74 735b 6e5d 290d  of_elements[n]).
-0000eec0: 0a20 2020 2020 2020 206f 6363 7570 616e  .        occupan
-0000eed0: 6379 5b6e 5d20 3d20 6f63 6375 7061 6e63  cy[n] = occupanc
-0000eee0: 795b 6e5d 202a 206f 6363 0d0a 0d0a 2020  y[n] * occ....  
-0000eef0: 2020 7265 6d61 696e 696e 675f 6368 6172    remaining_char
-0000ef00: 6765 203d 202d 6e70 2e6e 616e 7375 6d28  ge = -np.nansum(
-0000ef10: 6368 6172 6765 290d 0a20 2020 2075 6e63  charge)..    unc
-0000ef20: 6861 7267 6564 203d 206e 702e 7375 6d28  harged = np.sum(
-0000ef30: 6f63 6375 7061 6e63 795b 6e70 2e69 736e  occupancy[np.isn
-0000ef40: 616e 2863 6861 7267 6529 5d29 0d0a 2020  an(charge)])..  
-0000ef50: 2020 666f 7220 6e20 696e 2072 616e 6765    for n in range
-0000ef60: 286c 656e 286c 6973 745f 6f66 5f65 6c65  (len(list_of_ele
-0000ef70: 6d65 6e74 7329 293a 0d0a 2020 2020 2020  ments)):..      
-0000ef80: 2020 6966 206e 702e 6973 6e61 6e28 6368    if np.isnan(ch
-0000ef90: 6172 6765 5b6e 5d29 3a0d 0a20 2020 2020  arge[n]):..     
-0000efa0: 2020 2020 2020 2063 6861 7267 655b 6e5d         charge[n]
-0000efb0: 203d 206f 6363 7570 616e 6379 5b6e 5d20   = occupancy[n] 
-0000efc0: 2a20 7265 6d61 696e 696e 675f 6368 6172  * remaining_char
-0000efd0: 6765 202f 2075 6e63 6861 7267 6564 0d0a  ge / uncharged..
-0000efe0: 2020 2020 7265 7475 726e 2063 6861 7267      return charg
-0000eff0: 650d 0a0d 0a0d 0a64 6566 2061 7272 616e  e......def arran
-0000f000: 6765 5f61 746f 6d5f 6f72 6465 7228 6c69  ge_atom_order(li
-0000f010: 7374 5f6f 665f 656c 656d 656e 7473 293a  st_of_elements):
-0000f020: 0d0a 2020 2020 2222 220d 0a20 2020 2041  ..    """..    A
-0000f030: 7272 616e 6765 2061 206c 6973 7420 6f66  rrange a list of
-0000f040: 2065 6c65 6d65 6e74 7320 696e 2074 6865   elements in the
-0000f050: 2063 6f72 7265 6374 2063 6865 6d69 6361   correct chemica
-0000f060: 6c20 6f72 6465 720d 0a20 2020 2020 205b  l order..      [
-0000f070: 274c 6927 2c27 436f 272c 274f 275d 203d  'Li','Co','O'] =
-0000f080: 2061 7272 616e 6765 5f61 746f 6d5f 6f72   arrange_atom_or
-0000f090: 6465 7228 5b27 436f 272c 2027 4f27 2c20  der(['Co', 'O', 
-0000f0a0: 274c 6927 5d29 0d0a 2020 2020 3a70 6172  'Li'])..    :par
-0000f0b0: 616d 206c 6973 745f 6f66 5f65 6c65 6d65  am list_of_eleme
-0000f0c0: 6e74 733a 205b 6c69 7374 206f 6620 7374  nts: [list of st
-0000f0d0: 725d 0d0a 2020 2020 3a72 6574 7572 6e3a  r]..    :return:
-0000f0e0: 205b 6c69 7374 206f 6620 7374 725d 0d0a   [list of str]..
-0000f0f0: 2020 2020 2222 220d 0a0d 0a20 2020 206c      """....    l
-0000f100: 6973 745f 6f66 5f65 6c65 6d65 6e74 7320  ist_of_elements 
-0000f110: 3d20 6e70 2e61 7361 7272 6179 286c 6973  = np.asarray(lis
-0000f120: 745f 6f66 5f65 6c65 6d65 6e74 7329 0d0a  t_of_elements)..
-0000f130: 2020 2020 6772 6f75 7020 3d20 6174 6f6d      group = atom
-0000f140: 5f70 726f 7065 7274 6965 7328 6c69 7374  _properties(list
-0000f150: 5f6f 665f 656c 656d 656e 7473 2c20 2747  _of_elements, 'G
-0000f160: 726f 7570 2729 0d0a 2020 2020 6964 7820  roup')..    idx 
-0000f170: 3d20 6e70 2e61 7267 736f 7274 2867 726f  = np.argsort(gro
-0000f180: 7570 290d 0a20 2020 2072 6574 7572 6e20  up)..    return 
-0000f190: 6c69 7374 286c 6973 745f 6f66 5f65 6c65  list(list_of_ele
-0000f1a0: 6d65 6e74 735b 6964 785d 290d 0a0d 0a0d  ments[idx]).....
-0000f1b0: 0a64 6566 2063 6f75 6e74 5f61 746f 6d73  .def count_atoms
-0000f1c0: 286c 6973 745f 6f66 5f65 6c65 6d65 6e74  (list_of_element
-0000f1d0: 732c 206f 6363 7570 616e 6379 3d4e 6f6e  s, occupancy=Non
-0000f1e0: 652c 2064 6976 6964 6562 793d 312c 206c  e, divideby=1, l
-0000f1f0: 6174 6578 3d46 616c 7365 293a 0d0a 2020  atex=False):..  
-0000f200: 2020 2222 220d 0a20 2020 2043 6f75 6e74    """..    Count
-0000f210: 2061 746f 6d73 2069 6e20 6120 6c69 7374   atoms in a list
-0000f220: 206f 6620 656c 656d 656e 7473 2c20 7265   of elements, re
-0000f230: 7475 726e 696e 6720 636f 6e64 656e 6365  turning condence
-0000f240: 6420 6c69 7374 206f 6620 656c 656d 656e  d list of elemen
-0000f250: 7473 0d0a 2020 2020 3a70 6172 616d 206c  ts..    :param l
-0000f260: 6973 745f 6f66 5f65 6c65 6d65 6e74 733a  ist_of_elements:
-0000f270: 206c 6973 7420 6f66 2065 6c65 6d65 6e74   list of element
-0000f280: 2073 796d 626f 6c73 0d0a 2020 2020 3a70   symbols..    :p
-0000f290: 6172 616d 206f 6363 7570 616e 6379 3a20  aram occupancy: 
-0000f2a0: 6c69 7374 206f 6620 6f63 6375 7061 6e63  list of occupanc
-0000f2b0: 6965 7320 6f66 2065 6163 6820 656c 656d  ies of each elem
-0000f2c0: 656e 7420 2864 6566 6175 6c74 3d4e 6f6e  ent (default=Non
-0000f2d0: 6529 0d0a 2020 2020 3a70 6172 616d 2064  e)..    :param d
-0000f2e0: 6976 6964 6562 793a 2064 6976 6964 6520  ivideby: divide 
-0000f2f0: 6561 6368 2063 6f75 6e74 2062 7920 7468  each count by th
-0000f300: 6973 2028 6465 6661 756c 743d 3129 0d0a  is (default=1)..
-0000f310: 2020 2020 3a70 6172 616d 206c 6174 6578      :param latex
-0000f320: 3a20 4661 6c73 652a 2f54 7275 650d 0a20  : False*/True.. 
-0000f330: 2020 203a 7265 7475 726e 3a20 5b6c 6973     :return: [lis
-0000f340: 7420 6f66 2073 7472 5d0d 0a20 2020 2022  t of str]..    "
-0000f350: 2222 0d0a 0d0a 2020 2020 6966 206f 6363  ""....    if occ
-0000f360: 7570 616e 6379 2069 7320 4e6f 6e65 3a0d  upancy is None:.
-0000f370: 0a20 2020 2020 2020 206f 6363 7570 616e  .        occupan
-0000f380: 6379 203d 206e 702e 6f6e 6573 286c 656e  cy = np.ones(len
-0000f390: 286c 6973 745f 6f66 5f65 6c65 6d65 6e74  (list_of_element
-0000f3a0: 7329 290d 0a0d 0a20 2020 2023 2043 6f75  s))....    # Cou
-0000f3b0: 6e74 2065 6c65 6d65 6e74 730d 0a20 2020  nt elements..   
-0000f3c0: 2061 7473 203d 206e 702e 756e 6971 7565   ats = np.unique
-0000f3d0: 286c 6973 745f 6f66 5f65 6c65 6d65 6e74  (list_of_element
-0000f3e0: 7329 0d0a 2020 2020 6174 7320 3d20 6172  s)..    ats = ar
-0000f3f0: 7261 6e67 655f 6174 6f6d 5f6f 7264 6572  range_atom_order
-0000f400: 2861 7473 2920 2023 2061 7272 616e 6765  (ats)  # arrange
-0000f410: 2074 6869 7320 6279 2061 6c63 616c 692f   this by alcali/
-0000f420: 544d 2f4f 0d0a 2020 2020 6f75 7473 7472  TM/O..    outstr
-0000f430: 203d 205b 5d0d 0a20 2020 2066 6f72 2061   = []..    for a
-0000f440: 2069 6e20 6174 733a 0d0a 2020 2020 2020   in ats:..      
-0000f450: 2020 6174 6e6f 203d 2073 756d 285b 6f63    atno = sum([oc
-0000f460: 6375 7061 6e63 795b 6e5d 2066 6f72 206e  cupancy[n] for n
-0000f470: 2c20 7820 696e 2065 6e75 6d65 7261 7465  , x in enumerate
-0000f480: 286c 6973 745f 6f66 5f65 6c65 6d65 6e74  (list_of_element
-0000f490: 7329 2069 6620 7820 3d3d 2061 5d29 202f  s) if x == a]) /
-0000f4a0: 2066 6c6f 6174 2864 6976 6964 6562 7929   float(divideby)
-0000f4b0: 0d0a 2020 2020 2020 2020 6966 206e 702e  ..        if np.
-0000f4c0: 6162 7328 6174 6e6f 202d 2031 2920 3c20  abs(atno - 1) < 
-0000f4d0: 302e 3031 3a0d 0a20 2020 2020 2020 2020  0.01:..         
-0000f4e0: 2020 2061 7473 7472 203d 2027 270d 0a20     atstr = ''.. 
-0000f4f0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000f500: 2020 2020 2020 2020 2020 6174 7374 7220            atstr 
-0000f510: 3d20 2725 302e 3267 2720 2520 6174 6e6f  = '%0.2g' % atno
-0000f520: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000f530: 206c 6174 6578 3a0d 0a20 2020 2020 2020   latex:..       
-0000f540: 2020 2020 2020 2020 2061 7473 7472 203d           atstr =
-0000f550: 2027 245f 7b25 737d 2427 2025 2061 7473   '$_{%s}$' % ats
-0000f560: 7472 0d0a 0d0a 2020 2020 2020 2020 6f75  tr....        ou
-0000f570: 7473 7472 202b 3d20 5b27 2573 2573 2720  tstr += ['%s%s' 
-0000f580: 2520 2861 2c20 6174 7374 7229 5d0d 0a20  % (a, atstr)].. 
-0000f590: 2020 2072 6574 7572 6e20 6f75 7473 7472     return outstr
-0000f5a0: 0d0a 0d0a 0d0a 6465 6620 636f 756e 745f  ......def count_
-0000f5b0: 6368 6172 6765 7328 6c69 7374 5f6f 665f  charges(list_of_
-0000f5c0: 656c 656d 656e 7473 2c20 6f63 6375 7061  elements, occupa
-0000f5d0: 6e63 793d 4e6f 6e65 2c20 6469 7669 6465  ncy=None, divide
-0000f5e0: 6279 3d31 2c20 6c61 7465 783d 4661 6c73  by=1, latex=Fals
-0000f5f0: 6529 3a0d 0a20 2020 2022 2222 0d0a 2020  e):..    """..  
-0000f600: 2020 436f 756e 7420 6174 6f6d 7320 696e    Count atoms in
-0000f610: 2061 206c 6973 7420 6f66 2065 6c65 6d65   a list of eleme
-0000f620: 6e74 732c 2072 6574 7572 6e69 6e67 2063  nts, returning c
-0000f630: 6f6e 6465 6e63 6564 206c 6973 7420 6f66  ondenced list of
-0000f640: 2065 6c65 6d65 6e74 7320 7769 7468 2063   elements with c
-0000f650: 6861 7267 6573 0d0a 2020 2020 3a70 6172  harges..    :par
-0000f660: 616d 206c 6973 745f 6f66 5f65 6c65 6d65  am list_of_eleme
-0000f670: 6e74 733a 206c 6973 7420 6f66 2065 6c65  nts: list of ele
-0000f680: 6d65 6e74 2073 796d 626f 6c73 0d0a 2020  ment symbols..  
-0000f690: 2020 3a70 6172 616d 206f 6363 7570 616e    :param occupan
-0000f6a0: 6379 3a20 6c69 7374 206f 6620 6f63 6375  cy: list of occu
-0000f6b0: 7061 6e63 6965 7320 6f66 2065 6163 6820  pancies of each 
-0000f6c0: 656c 656d 656e 7420 2864 6566 6175 6c74  element (default
-0000f6d0: 3d4e 6f6e 6529 0d0a 2020 2020 3a70 6172  =None)..    :par
-0000f6e0: 616d 2064 6976 6964 6562 793a 2064 6976  am divideby: div
-0000f6f0: 6964 6520 6561 6368 2063 6f75 6e74 2062  ide each count b
-0000f700: 7920 7468 6973 2028 6465 6661 756c 743d  y this (default=
-0000f710: 3129 0d0a 2020 2020 3a70 6172 616d 206c  1)..    :param l
-0000f720: 6174 6578 3a20 4661 6c73 652a 2f54 7275  atex: False*/Tru
-0000f730: 650d 0a20 2020 203a 7265 7475 726e 3a20  e..    :return: 
-0000f740: 5b6c 6973 7420 6f66 2073 7472 5d0d 0a20  [list of str].. 
-0000f750: 2020 2022 2222 0d0a 0d0a 2020 2020 6966     """....    if
-0000f760: 206f 6363 7570 616e 6379 2069 7320 4e6f   occupancy is No
-0000f770: 6e65 3a0d 0a20 2020 2020 2020 206f 6363  ne:..        occ
-0000f780: 7570 616e 6379 203d 206e 702e 6f6e 6573  upancy = np.ones
-0000f790: 286c 656e 286c 6973 745f 6f66 5f65 6c65  (len(list_of_ele
-0000f7a0: 6d65 6e74 7329 290d 0a0d 0a20 2020 2023  ments))....    #
-0000f7b0: 2044 6574 6572 6d69 6e65 2065 6c65 6d65   Determine eleme
-0000f7c0: 6e74 2063 6861 7267 6573 0d0a 2020 2020  nt charges..    
-0000f7d0: 6368 6172 6765 203d 2062 616c 616e 6365  charge = balance
-0000f7e0: 5f61 746f 6d5f 6368 6172 6765 286c 6973  _atom_charge(lis
-0000f7f0: 745f 6f66 5f65 6c65 6d65 6e74 732c 206f  t_of_elements, o
-0000f800: 6363 7570 616e 6379 290d 0a0d 0a20 2020  ccupancy)....   
-0000f810: 2023 2043 6f75 6e74 2065 6c65 6d65 6e74   # Count element
-0000f820: 730d 0a20 2020 2061 7473 203d 206e 702e  s..    ats = np.
-0000f830: 756e 6971 7565 286c 6973 745f 6f66 5f65  unique(list_of_e
-0000f840: 6c65 6d65 6e74 7329 0d0a 2020 2020 6174  lements)..    at
-0000f850: 7320 3d20 6172 7261 6e67 655f 6174 6f6d  s = arrange_atom
-0000f860: 5f6f 7264 6572 2861 7473 2920 2023 2061  _order(ats)  # a
-0000f870: 7272 616e 6765 2074 6869 7320 6279 2061  rrange this by a
-0000f880: 6c63 616c 692f 544d 2f4f 0d0a 2020 2020  lcali/TM/O..    
-0000f890: 6174 6e6f 203d 207b 7d0d 0a20 2020 2063  atno = {}..    c
-0000f8a0: 686e 6f20 3d20 7b7d 0d0a 2020 2020 666f  hno = {}..    fo
-0000f8b0: 7220 6120 696e 2061 7473 3a0d 0a20 2020  r a in ats:..   
-0000f8c0: 2020 2020 2061 746e 6f5b 615d 203d 2073       atno[a] = s
-0000f8d0: 756d 285b 6f63 6375 7061 6e63 795b 6e5d  um([occupancy[n]
-0000f8e0: 2066 6f72 206e 2c20 7820 696e 2065 6e75   for n, x in enu
-0000f8f0: 6d65 7261 7465 286c 6973 745f 6f66 5f65  merate(list_of_e
-0000f900: 6c65 6d65 6e74 7329 2069 6620 7820 3d3d  lements) if x ==
-0000f910: 2061 5d29 202f 2066 6c6f 6174 2864 6976   a]) / float(div
-0000f920: 6964 6562 7929 0d0a 2020 2020 2020 2020  ideby)..        
-0000f930: 6368 6e6f 5b61 5d20 3d20 7375 6d28 5b63  chno[a] = sum([c
-0000f940: 6861 7267 655b 6e5d 2066 6f72 206e 2c20  harge[n] for n, 
-0000f950: 7820 696e 2065 6e75 6d65 7261 7465 286c  x in enumerate(l
-0000f960: 6973 745f 6f66 5f65 6c65 6d65 6e74 7329  ist_of_elements)
-0000f970: 2069 6620 7820 3d3d 2061 5d29 202f 2028   if x == a]) / (
-0000f980: 6174 6e6f 5b61 5d20 2a20 666c 6f61 7428  atno[a] * float(
-0000f990: 6469 7669 6465 6279 2929 0d0a 0d0a 2020  divideby))....  
-0000f9a0: 2020 6f75 7473 7472 203d 205b 5d0d 0a20    outstr = [].. 
-0000f9b0: 2020 2066 6f72 2061 2069 6e20 6174 733a     for a in ats:
-0000f9c0: 0d0a 2020 2020 2020 2020 6f75 7473 7472  ..        outstr
-0000f9d0: 202b 3d20 5b65 6c65 6d65 6e74 5f63 6861   += [element_cha
-0000f9e0: 7267 655f 7374 7269 6e67 2861 2c20 6174  rge_string(a, at
-0000f9f0: 6e6f 5b61 5d2c 2063 686e 6f5b 615d 2c20  no[a], chno[a], 
-0000fa00: 6c61 7465 7829 5d0d 0a20 2020 2072 6574  latex)]..    ret
-0000fa10: 7572 6e20 6f75 7473 7472 0d0a 0d0a 0d0a  urn outstr......
-0000fa20: 6465 6620 6d6f 6c65 6375 6c61 725f 7765  def molecular_we
-0000fa30: 6967 6874 2863 6f6d 706f 756e 645f 6e61  ight(compound_na
-0000fa40: 6d65 293a 0d0a 2020 2020 2222 220d 0a20  me):..    """.. 
-0000fa50: 2020 2043 616c 6375 6c61 7465 2074 6865     Calculate the
-0000fa60: 206d 6f6c 6563 756c 6172 2077 6569 6768   molecular weigh
-0000fa70: 7420 6f66 2067 6976 656e 2063 6f6d 706f  t of given compo
-0000fa80: 756e 640d 0a20 2020 203a 7061 7261 6d20  und..    :param 
-0000fa90: 636f 6d70 6f75 6e64 5f6e 616d 653a 2073  compound_name: s
-0000faa0: 7472 2065 6c65 6d65 6e74 730d 0a20 2020  tr elements..   
-0000fab0: 203a 7265 7475 726e 3a20 666c 6f61 7420   :return: float 
-0000fac0: 7765 6967 6874 2069 6e20 670d 0a20 2020  weight in g..   
-0000fad0: 2022 2222 0d0a 2020 2020 656c 5f6c 6973   """..    el_lis
-0000fae0: 7420 3d20 7370 6c69 745f 636f 6d70 6f75  t = split_compou
-0000faf0: 6e64 2863 6f6d 706f 756e 645f 6e61 6d65  nd(compound_name
-0000fb00: 290d 0a20 2020 2077 6569 6768 7420 3d20  )..    weight = 
-0000fb10: 300d 0a20 2020 2066 6f72 2065 6c20 696e  0..    for el in
-0000fb20: 2065 6c5f 6c69 7374 3a0d 0a20 2020 2020   el_list:..     
-0000fb30: 2020 206e 616d 652c 206f 6363 2c20 6368     name, occ, ch
-0000fb40: 6172 6765 203d 2073 706c 6974 5f65 6c65  arge = split_ele
-0000fb50: 6d65 6e74 5f73 796d 626f 6c28 656c 290d  ment_symbol(el).
-0000fb60: 0a20 2020 2020 2020 2077 6569 6768 7420  .        weight 
-0000fb70: 2b3d 206f 6363 202a 2061 746f 6d5f 7072  += occ * atom_pr
-0000fb80: 6f70 6572 7469 6573 286e 616d 652c 2027  operties(name, '
-0000fb90: 5765 6967 6874 2729 5b30 5d0d 0a20 2020  Weight')[0]..   
-0000fba0: 2072 6574 7572 6e20 7765 6967 6874 0d0a   return weight..
-0000fbb0: 0d0a 0d0a 6465 6620 7872 6179 5f61 7474  ....def xray_att
-0000fbc0: 656e 7561 7469 6f6e 5f6c 656e 6774 6828  enuation_length(
-0000fbd0: 656c 656d 656e 7473 2c20 656e 6572 6779  elements, energy
-0000fbe0: 5f6b 6576 2c20 6174 6f6d 5f70 6572 5f76  _kev, atom_per_v
-0000fbf0: 6f6c 756d 652c 2067 7261 7a69 6e67 5f61  olume, grazing_a
-0000fc00: 6e67 6c65 3d39 3029 3a0d 0a20 2020 2022  ngle=90):..    "
-0000fc10: 2222 0d0a 2020 2020 4361 6c63 7561 6c74  ""..    Calcualt
-0000fc20: 6520 7468 6520 6174 7465 6e75 6174 696f  e the attenuatio
-0000fc30: 6e20 6c65 6e67 7468 2069 6e20 6d69 6372  n length in micr
-0000fc40: 6f6e 730d 0a20 2020 2054 6865 2064 6570  ons..    The dep
-0000fc50: 7468 2069 6e74 6f20 7468 6520 6d61 7465  th into the mate
-0000fc60: 7269 616c 206d 6561 7375 7265 6420 616c  rial measured al
-0000fc70: 6f6e 6720 7468 6520 7375 7266 6163 6520  ong the surface 
-0000fc80: 6e6f 726d 616c 2077 6865 7265 2074 6865  normal where the
-0000fc90: 2069 6e74 656e 7369 7479 206f 660d 0a20   intensity of.. 
-0000fca0: 2020 2078 2d72 6179 7320 6661 6c6c 7320     x-rays falls 
-0000fcb0: 746f 2031 2f65 206f 6620 6974 7320 7661  to 1/e of its va
-0000fcc0: 6c75 6520 6174 2074 6865 2073 7572 6661  lue at the surfa
-0000fcd0: 6365 2e0d 0a20 2020 2020 2041 203d 2073  ce...      A = s
-0000fce0: 696e 2874 6829 202f 206e 202a 206d 750d  in(th) / n * mu.
-0000fcf0: 0a20 2020 203a 7061 7261 6d20 656c 656d  .    :param elem
-0000fd00: 656e 7473 3a20 7374 7220 6f72 206c 6973  ents: str or lis
-0000fd10: 7420 6f66 2073 7472 2c20 6966 206c 6973  t of str, if lis
-0000fd20: 7420 2d20 6162 736f 7270 7469 6f6e 2077  t - absorption w
-0000fd30: 696c 6c20 6265 2073 756d 6d65 6420 6f76  ill be summed ov
-0000fd40: 6572 2065 6c65 6d65 6e74 730d 0a20 2020  er elements..   
-0000fd50: 203a 7061 7261 6d20 656e 6572 6779 5f6b   :param energy_k
-0000fd60: 6576 3a20 666c 6f61 7420 6172 7261 790d  ev: float array.
-0000fd70: 0a20 2020 203a 7061 7261 6d20 6174 6f6d  .    :param atom
-0000fd80: 5f70 6572 5f76 6f6c 756d 653a 2066 6c6f  _per_volume: flo
-0000fd90: 6174 2061 746f 6d73 2070 6572 2041 5e33  at atoms per A^3
-0000fda0: 0d0a 2020 2020 3a70 6172 616d 2067 7261  ..    :param gra
-0000fdb0: 7a69 6e67 5f61 6e67 6c65 3a20 696e 6369  zing_angle: inci
-0000fdc0: 6465 6e63 6520 616e 676c 6520 7265 6c61  dence angle rela
-0000fdd0: 7469 7665 2074 6f20 7468 6520 7375 7266  tive to the surf
-0000fde0: 6163 652c 2069 6e20 6465 6772 6565 730d  ace, in degrees.
-0000fdf0: 0a20 2020 203a 7265 7475 726e 3a20 666c  .    :return: fl
-0000fe00: 6f61 7420 6f72 2061 7272 6179 2069 6e20  oat or array in 
-0000fe10: 6d69 6372 6f6e 730d 0a20 2020 2022 2222  microns..    """
-0000fe20: 0d0a 2020 2020 6d75 203d 2070 686f 746f  ..    mu = photo
-0000fe30: 6162 736f 7270 7469 6f6e 5f63 726f 7373  absorption_cross
-0000fe40: 7365 6374 696f 6e28 656c 656d 656e 7473  section(elements
-0000fe50: 2c20 656e 6572 6779 5f6b 6576 290d 0a20  , energy_kev).. 
-0000fe60: 2020 2073 7572 6661 6365 5f6e 6f72 6d61     surface_norma
-0000fe70: 6c20 3d20 6e70 2e73 696e 2820 6e70 2e64  l = np.sin( np.d
-0000fe80: 6567 3272 6164 2867 7261 7a69 6e67 5f61  eg2rad(grazing_a
-0000fe90: 6e67 6c65 2929 0d0a 2020 2020 7265 7475  ngle))..    retu
-0000fea0: 726e 2073 7572 6661 6365 5f6e 6f72 6d61  rn surface_norma
-0000feb0: 6c20 2a20 3165 3620 2f20 2831 6533 3020  l * 1e6 / (1e30 
-0000fec0: 2a20 6174 6f6d 5f70 6572 5f76 6f6c 756d  * atom_per_volum
-0000fed0: 6520 2a20 6d75 290d 0a0d 0a0d 0a64 6566  e * mu)......def
-0000fee0: 2078 7261 795f 7472 616e 736d 6973 7369   xray_transmissi
-0000fef0: 6f6e 2865 6c65 6d65 6e74 732c 2065 6e65  on(elements, ene
-0000ff00: 7267 795f 6b65 762c 2061 746f 6d5f 7065  rgy_kev, atom_pe
-0000ff10: 725f 766f 6c75 6d65 2c20 6469 7374 616e  r_volume, distan
-0000ff20: 6365 5f75 6d29 3a0d 0a20 2020 2022 2222  ce_um):..    """
-0000ff30: 0d0a 2020 2020 4361 6c63 756c 6174 6520  ..    Calculate 
-0000ff40: 7468 6520 7472 616e 7369 6d73 7369 6f6e  the transimssion
-0000ff50: 206f 6620 782d 7261 7973 2074 6872 6f75   of x-rays throu
-0000ff60: 6768 2061 2074 6869 636b 2073 6c61 620d  gh a thick slab.
-0000ff70: 0a20 2020 2020 2054 2f54 3020 3d20 6578  .      T/T0 = ex
-0000ff80: 7028 2d6e 2a6d 752a 6429 0d0a 2020 2020  p(-n*mu*d)..    
-0000ff90: 3a70 6172 616d 2065 6c65 6d65 6e74 733a  :param elements:
-0000ffa0: 2073 7472 206f 7220 6c69 7374 206f 6620   str or list of 
-0000ffb0: 7374 722c 2069 6620 6c69 7374 202d 2061  str, if list - a
-0000ffc0: 6273 6f72 7074 696f 6e20 7769 6c6c 2062  bsorption will b
-0000ffd0: 6520 7375 6d6d 6564 206f 7665 7220 656c  e summed over el
-0000ffe0: 656d 656e 7473 0d0a 2020 2020 3a70 6172  ements..    :par
-0000fff0: 616d 2065 6e65 7267 795f 6b65 763a 2066  am energy_kev: f
-00010000: 6c6f 6174 2061 7272 6179 0d0a 2020 2020  loat array..    
-00010010: 3a70 6172 616d 2061 746f 6d5f 7065 725f  :param atom_per_
-00010020: 766f 6c75 6d65 3a20 666c 6f61 7420 6174  volume: float at
-00010030: 6f6d 7320 7065 7220 415e 330d 0a20 2020  oms per A^3..   
-00010040: 203a 7061 7261 6d20 6469 7374 616e 6365   :param distance
-00010050: 5f75 6d3a 2066 6c6f 6174 2064 6973 7461  _um: float dista
-00010060: 6e63 6520 696e 206d 6963 726f 6e73 0d0a  nce in microns..
-00010070: 2020 2020 3a72 6574 7572 6e3a 2066 6c6f      :return: flo
-00010080: 6174 206f 7220 6172 7261 790d 0a20 2020  at or array..   
-00010090: 2022 2222 0d0a 2020 2020 6d75 203d 2070   """..    mu = p
-000100a0: 686f 746f 6162 736f 7270 7469 6f6e 5f63  hotoabsorption_c
-000100b0: 726f 7373 7365 6374 696f 6e28 656c 656d  rosssection(elem
-000100c0: 656e 7473 2c20 656e 6572 6779 5f6b 6576  ents, energy_kev
-000100d0: 2920 2023 2066 6c6f 6174 2c20 6f72 205b  )  # float, or [
-000100e0: 656e 655d 0d0a 2020 2020 7265 7475 726e  ene]..    return
-000100f0: 206e 702e 6578 7028 2d61 746f 6d5f 7065   np.exp(-atom_pe
-00010100: 725f 766f 6c75 6d65 202a 2031 6533 3020  r_volume * 1e30 
-00010110: 2a20 6d75 202a 2064 6973 7461 6e63 655f  * mu * distance_
-00010120: 756d 202a 2031 652d 3629 0d0a 0d0a 0d0a  um * 1e-6)......
-00010130: 6465 6620 7872 6179 5f72 6566 7261 6374  def xray_refract
-00010140: 6976 655f 696e 6465 7828 656c 656d 656e  ive_index(elemen
-00010150: 7473 2c20 656e 6572 6779 5f6b 6576 2c20  ts, energy_kev, 
-00010160: 6174 6f6d 5f70 6572 5f76 6f6c 756d 6529  atom_per_volume)
-00010170: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-00010180: 4361 6c63 756c 6174 6520 7468 6520 636f  Calculate the co
-00010190: 6d70 6c65 7820 696e 6465 7820 6f66 2072  mplex index of r
-000101a0: 6566 7261 6374 696f 6e20 6f66 2061 206d  efraction of a m
-000101b0: 6174 6572 6961 6c0d 0a20 2020 2020 206e  aterial..      n
-000101c0: 203d 2031 202d 2028 312f 3270 6929 4e2a   = 1 - (1/2pi)N*
-000101d0: 7230 2a6c 616d 6264 615e 322a 2866 312b  r0*lambda^2*(f1+
-000101e0: 6966 3229 203d 2031 202d 2044 656c 7461  if2) = 1 - Delta
-000101f0: 202d 2069 4265 7461 0d0a 2020 2020 3a70   - iBeta..    :p
-00010200: 6172 616d 2065 6c65 6d65 6e74 733a 2073  aram elements: s
-00010210: 7472 206f 7220 6c69 7374 206f 6620 7374  tr or list of st
-00010220: 722c 2069 6620 6c69 7374 2061 746f 6d69  r, if list atomi
-00010230: 6320 7363 6174 7465 7269 6e67 2066 6163  c scattering fac
-00010240: 746f 7273 2077 696c 6c20 6265 2073 756d  tors will be sum
-00010250: 6d65 6420 6f76 6572 2065 6c65 6d65 6e74  med over element
-00010260: 730d 0a20 2020 203a 7061 7261 6d20 656e  s..    :param en
-00010270: 6572 6779 5f6b 6576 3a20 666c 6f61 7420  ergy_kev: float 
-00010280: 6172 7261 790d 0a20 2020 203a 7061 7261  array..    :para
-00010290: 6d20 6174 6f6d 5f70 6572 5f76 6f6c 756d  m atom_per_volum
-000102a0: 653a 2066 6c6f 6174 2061 746f 6d73 2070  e: float atoms p
-000102b0: 6572 2041 5e33 0d0a 2020 2020 3a72 6574  er A^3..    :ret
-000102c0: 7572 6e3a 2063 6f6d 706c 6578 2066 6c6f  urn: complex flo
-000102d0: 6174 206f 7220 6172 7261 790d 0a20 2020  at or array..   
-000102e0: 2022 2222 0d0a 2020 2020 6631 2c20 6632   """..    f1, f2
-000102f0: 203d 2061 746f 6d69 635f 7363 6174 7465   = atomic_scatte
-00010300: 7269 6e67 5f66 6163 746f 7228 656c 656d  ring_factor(elem
-00010310: 656e 7473 2c20 656e 6572 6779 5f6b 6576  ents, energy_kev
-00010320: 290d 0a20 2020 2066 7420 3d20 6631 202b  )..    ft = f1 +
-00010330: 2031 6a20 2a20 6632 0d0a 2020 2020 6674   1j * f2..    ft
-00010340: 203d 2066 742e 7265 7368 6170 6528 6e70   = ft.reshape(np
-00010350: 2e73 697a 6528 656c 656d 656e 7473 292c  .size(elements),
-00010360: 206e 702e 7369 7a65 2865 6e65 7267 795f   np.size(energy_
-00010370: 6b65 7629 292e 7375 6d28 6178 6973 3d30  kev)).sum(axis=0
-00010380: 2920 2023 2073 756d 206f 7665 7220 656c  )  # sum over el
-00010390: 656d 656e 7473 0d0a 2020 2020 6174 6f6d  ements..    atom
-000103a0: 5f70 6572 5f76 6f6c 756d 6520 3d20 6174  _per_volume = at
-000103b0: 6f6d 5f70 6572 5f76 6f6c 756d 6520 2a20  om_per_volume * 
-000103c0: 3165 3330 2020 2320 6174 6f6d 2070 6572  1e30  # atom per
-000103d0: 206d 5e33 0d0a 2020 2020 7761 7665 6c65   m^3..    wavele
-000103e0: 6e67 7468 203d 2065 6e65 7267 7932 7761  ngth = energy2wa
-000103f0: 7665 2865 6e65 7267 795f 6b65 7629 202a  ve(energy_kev) *
-00010400: 2031 652d 3130 2020 2320 6d0d 0a20 2020   1e-10  # m..   
-00010410: 2072 6574 7572 6e20 3120 2d20 2866 7420   return 1 - (ft 
-00010420: 2a20 6667 2e72 3020 2a20 6174 6f6d 5f70  * fg.r0 * atom_p
-00010430: 6572 5f76 6f6c 756d 6520 2a20 7761 7665  er_volume * wave
-00010440: 6c65 6e67 7468 2a2a 3220 2f20 2832 202a  length**2 / (2 *
-00010450: 2066 672e 7069 2929 0d0a 0d0a 0d0a 6465   fg.pi))......de
-00010460: 6620 7872 6179 5f72 6566 6c65 6374 6976  f xray_reflectiv
-00010470: 6974 7928 656c 656d 656e 7473 2c20 656e  ity(elements, en
-00010480: 6572 6779 5f6b 6576 2c20 6174 6f6d 5f70  ergy_kev, atom_p
-00010490: 6572 5f76 6f6c 756d 652c 2067 7261 7a69  er_volume, grazi
-000104a0: 6e67 5f61 6e67 6c65 293a 0d0a 2020 2020  ng_angle):..    
-000104b0: 2222 220d 0a20 2020 2043 616c 6375 6c61  """..    Calcula
-000104c0: 7465 2074 6865 2073 7065 6375 6c61 7220  te the specular 
-000104d0: 7265 666c 6563 7469 7669 7479 206f 6620  reflectivity of 
-000104e0: 6120 6d61 7465 7269 616c 0d0a 2020 2020  a material..    
-000104f0: 2020 4e4f 5420 4355 5252 454e 544c 5920    NOT CURRENTLY 
-00010500: 574f 524b 494e 470d 0a20 2020 203a 7061  WORKING..    :pa
-00010510: 7261 6d20 656c 656d 656e 7473 3a20 7374  ram elements: st
-00010520: 7220 6f72 206c 6973 7420 6f66 2073 7472  r or list of str
-00010530: 2c20 6966 206c 6973 7420 2d20 6162 736f  , if list - abso
-00010540: 7270 7469 6f6e 2077 696c 6c20 6265 2073  rption will be s
-00010550: 756d 6d65 6420 6f76 6572 2065 6c65 6d65  ummed over eleme
-00010560: 6e74 730d 0a20 2020 203a 7061 7261 6d20  nts..    :param 
-00010570: 656e 6572 6779 5f6b 6576 3a20 666c 6f61  energy_kev: floa
-00010580: 7420 6172 7261 790d 0a20 2020 203a 7061  t array..    :pa
-00010590: 7261 6d20 6174 6f6d 5f70 6572 5f76 6f6c  ram atom_per_vol
-000105a0: 756d 653a 2066 6c6f 6174 2061 746f 6d73  ume: float atoms
-000105b0: 2070 6572 2041 5e33 0d0a 2020 2020 3a70   per A^3..    :p
-000105c0: 6172 616d 2067 7261 7a69 6e67 5f61 6e67  aram grazing_ang
-000105d0: 6c65 3a20 696e 6369 6465 6e63 6520 616e  le: incidence an
-000105e0: 676c 6520 7265 6c61 7469 7665 2074 6f20  gle relative to 
-000105f0: 7468 6520 7375 7266 6163 652c 2069 6e20  the surface, in 
-00010600: 6465 6772 6565 730d 0a20 2020 203a 7265  degrees..    :re
-00010610: 7475 726e 3a20 666c 6f61 7420 6f72 2061  turn: float or a
-00010620: 7272 6179 0d0a 2020 2020 2222 220d 0a20  rray..    """.. 
-00010630: 2020 2023 7761 7665 6c65 6e67 7468 203d     #wavelength =
-00010640: 2065 6e65 7267 7932 7761 7665 2865 6e65   energy2wave(ene
-00010650: 7267 795f 6b65 7629 202a 2031 652d 3130  rgy_kev) * 1e-10
-00010660: 0d0a 2020 2020 7265 6669 6e64 6578 203d  ..    refindex =
-00010670: 2078 7261 795f 7265 6672 6163 7469 7665   xray_refractive
-00010680: 5f69 6e64 6578 2865 6c65 6d65 6e74 732c  _index(elements,
-00010690: 2065 6e65 7267 795f 6b65 762c 2061 746f   energy_kev, ato
-000106a0: 6d5f 7065 725f 766f 6c75 6d65 290d 0a20  m_per_volume).. 
-000106b0: 2020 2023 7069 6c61 6d62 6461 203d 2032     #pilambda = 2
-000106c0: 202a 2066 672e 7069 202f 2077 6176 656c   * fg.pi / wavel
-000106d0: 656e 6774 680d 0a20 2020 2063 6f73 7468  ength..    costh
-000106e0: 203d 206e 702e 636f 7328 6e70 2e64 6567   = np.cos(np.deg
-000106f0: 3272 6164 2867 7261 7a69 6e67 5f61 6e67  2rad(grazing_ang
-00010700: 6c65 2929 0d0a 2020 2020 6b69 203d 2063  le))..    ki = c
-00010710: 6f73 7468 0d0a 2020 2020 6b74 203d 206e  osth..    kt = n
-00010720: 702e 7371 7274 2872 6566 696e 6465 782a  p.sqrt(refindex*
-00010730: 6e70 2e63 6f6e 6a28 7265 6669 6e64 6578  np.conj(refindex
-00010740: 2920 2d20 636f 7374 682a 2a32 290d 0a20  ) - costh**2).. 
-00010750: 2020 2072 203d 2028 6b69 202d 206b 7429     r = (ki - kt)
-00010760: 2f28 6b69 202b 206b 7429 0d0a 2020 2020  /(ki + kt)..    
-00010770: 7265 7475 726e 206e 702e 7265 616c 2872  return np.real(r
-00010780: 202a 206e 702e 636f 6e6a 2872 2929 0d0a   * np.conj(r))..
-00010790: 0d0a 0d0a 6465 6620 6d6f 6c65 6375 6c61  ....def molecula
-000107a0: 725f 6174 7465 6e75 6174 696f 6e5f 6c65  r_attenuation_le
-000107b0: 6e67 7468 2863 6865 6d69 6361 6c5f 666f  ngth(chemical_fo
-000107c0: 726d 756c 612c 2065 6e65 7267 795f 6b65  rmula, energy_ke
-000107d0: 762c 2064 656e 7369 7479 2c20 6772 617a  v, density, graz
-000107e0: 696e 675f 616e 676c 653d 3930 293a 0d0a  ing_angle=90):..
-000107f0: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
-00010800: 6375 616c 7465 2058 2d52 6179 2041 7474  cualte X-Ray Att
-00010810: 656e 7561 7469 6f6e 204c 656e 6774 680d  enuation Length.
-00010820: 0a20 2020 2045 7175 6976 616c 656e 7420  .    Equivalent 
-00010830: 746f 3a20 6874 7470 733a 2f2f 6865 6e6b  to: https://henk
-00010840: 652e 6c62 6c2e 676f 762f 6f70 7469 6361  e.lbl.gov/optica
-00010850: 6c5f 636f 6e73 7461 6e74 732f 6174 7465  l_constants/atte
-00010860: 6e32 2e68 746d 6c0d 0a20 2020 2042 6173  n2.html..    Bas
-00010870: 6564 206f 6e20 666f 726d 756c 6173 2066  ed on formulas f
-00010880: 726f 6d3a 2048 656e 6b65 2c20 4775 6c6c  rom: Henke, Gull
-00010890: 696b 736f 6e2c 2061 6e64 2044 6176 6973  ikson, and Davis
-000108a0: 2c20 4174 6f6d 6963 2044 6174 6120 616e  , Atomic Data an
-000108b0: 6420 4e75 636c 6561 7220 4461 7461 2054  d Nuclear Data T
-000108c0: 6162 6c65 7320 3534 206e 6f2e 322c 2031  ables 54 no.2, 1
-000108d0: 3831 2d33 3432 2028 4a75 6c79 2031 3939  81-342 (July 199
-000108e0: 3329 0d0a 2020 2020 3a70 6172 616d 2063  3)..    :param c
-000108f0: 6865 6d69 6361 6c5f 666f 726d 756c 613a  hemical_formula:
-00010900: 2073 7472 206d 6f6c 6563 756c 6172 2066   str molecular f
-00010910: 6f72 6d75 6c61 0d0a 2020 2020 3a70 6172  ormula..    :par
-00010920: 616d 2065 6e65 7267 795f 6b65 763a 2066  am energy_kev: f
-00010930: 6c6f 6174 206f 7220 6172 7261 792c 2078  loat or array, x
-00010940: 2d72 6179 2065 6e65 7267 7920 696e 206b  -ray energy in k
-00010950: 6556 0d0a 2020 2020 3a70 6172 616d 2064  eV..    :param d
-00010960: 656e 7369 7479 3a20 666c 6f61 7420 6465  ensity: float de
-00010970: 6e73 6974 7920 696e 2067 2f63 6d5e 330d  nsity in g/cm^3.
-00010980: 0a20 2020 203a 7061 7261 6d20 6772 617a  .    :param graz
-00010990: 696e 675f 616e 676c 653a 2069 6e63 6964  ing_angle: incid
-000109a0: 656e 6365 2061 6e67 6c65 2072 656c 6174  ence angle relat
-000109b0: 6976 6520 746f 2074 6865 2073 7572 6661  ive to the surfa
-000109c0: 6365 2c20 696e 2064 6567 7265 6573 0d0a  ce, in degrees..
-000109d0: 2020 2020 3a72 6574 7572 6e3a 2066 6c6f      :return: flo
-000109e0: 6174 206f 7220 6172 7261 792c 2069 6e20  at or array, in 
-000109f0: 6d69 6372 6f6e 730d 0a20 2020 2022 2222  microns..    """
-00010a00: 0d0a 2020 2020 656c 656d 656e 7473 203d  ..    elements =
-00010a10: 2073 706c 6974 5f63 6f6d 706f 756e 6428   split_compound(
-00010a20: 6368 656d 6963 616c 5f66 6f72 6d75 6c61  chemical_formula
-00010a30: 290d 0a20 2020 2077 6569 6768 7420 3d20  )..    weight = 
-00010a40: 6d6f 6c65 6375 6c61 725f 7765 6967 6874  molecular_weight
-00010a50: 2863 6865 6d69 6361 6c5f 666f 726d 756c  (chemical_formul
-00010a60: 6129 0d0a 2020 2020 6174 6f6d 5f70 6572  a)..    atom_per
-00010a70: 5f76 6f6c 756d 6520 3d20 3165 2d32 3420  _volume = 1e-24 
-00010a80: 2a20 6465 6e73 6974 7920 2a20 6667 2e4e  * density * fg.N
-00010a90: 6120 2f20 7765 6967 6874 2020 2320 6174  a / weight  # at
-00010aa0: 6f6d 7320 7065 7220 415e 330d 0a20 2020  oms per A^3..   
-00010ab0: 2072 6574 7572 6e20 7872 6179 5f61 7474   return xray_att
-00010ac0: 656e 7561 7469 6f6e 5f6c 656e 6774 6828  enuation_length(
-00010ad0: 656c 656d 656e 7473 2c20 656e 6572 6779  elements, energy
-00010ae0: 5f6b 6576 2c20 6174 6f6d 5f70 6572 5f76  _kev, atom_per_v
-00010af0: 6f6c 756d 652c 2067 7261 7a69 6e67 5f61  olume, grazing_a
-00010b00: 6e67 6c65 290d 0a0d 0a0d 0a64 6566 206d  ngle)......def m
-00010b10: 6f6c 6563 756c 6172 5f72 6566 7261 6374  olecular_refract
-00010b20: 6976 655f 696e 6465 7828 6368 656d 6963  ive_index(chemic
-00010b30: 616c 5f66 6f72 6d75 6c61 2c20 656e 6572  al_formula, ener
-00010b40: 6779 5f6b 6576 2c20 6465 6e73 6974 7929  gy_kev, density)
-00010b50: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-00010b60: 4361 6c63 756c 6174 6520 436f 6d70 6c65  Calculate Comple
-00010b70: 7820 496e 6465 7820 6f66 2052 6566 7261  x Index of Refra
-00010b80: 6374 696f 6e0d 0a20 2020 2020 2020 206e  ction..        n
-00010b90: 203d 2031 202d 2028 312f 3270 6929 4e2a   = 1 - (1/2pi)N*
-00010ba0: 7230 2a6c 616d 6264 615e 322a 2866 312b  r0*lambda^2*(f1+
-00010bb0: 6966 3229 203d 2031 202d 2044 656c 7461  if2) = 1 - Delta
-00010bc0: 202d 2069 4265 7461 0d0a 2020 2020 4571   - iBeta..    Eq
-00010bd0: 7569 7661 6c65 6e74 2074 6f3a 2068 7474  uivalent to: htt
-00010be0: 7073 3a2f 2f68 656e 6b65 2e6c 626c 2e67  ps://henke.lbl.g
-00010bf0: 6f76 2f6f 7074 6963 616c 5f63 6f6e 7374  ov/optical_const
-00010c00: 616e 7473 2f67 6574 6462 322e 6874 6d6c  ants/getdb2.html
-00010c10: 0d0a 2020 2020 4261 7365 6420 6f6e 2066  ..    Based on f
-00010c20: 6f72 6d75 6c61 7320 6672 6f6d 3a20 4865  ormulas from: He
-00010c30: 6e6b 652c 2047 756c 6c69 6b73 6f6e 2c20  nke, Gullikson, 
-00010c40: 616e 6420 4461 7669 732c 2041 746f 6d69  and Davis, Atomi
-00010c50: 6320 4461 7461 2061 6e64 204e 7563 6c65  c Data and Nucle
-00010c60: 6172 2044 6174 6120 5461 626c 6573 2035  ar Data Tables 5
-00010c70: 3420 6e6f 2e32 2c20 3138 312d 3334 3220  4 no.2, 181-342 
-00010c80: 284a 756c 7920 3139 3933 290d 0a20 2020  (July 1993)..   
-00010c90: 203a 7061 7261 6d20 6368 656d 6963 616c   :param chemical
-00010ca0: 5f66 6f72 6d75 6c61 3a20 7374 7220 6d6f  _formula: str mo
-00010cb0: 6c65 6375 6c61 7220 666f 726d 756c 610d  lecular formula.
-00010cc0: 0a20 2020 203a 7061 7261 6d20 656e 6572  .    :param ener
-00010cd0: 6779 5f6b 6576 3a20 666c 6f61 7420 6f72  gy_kev: float or
-00010ce0: 2061 7272 6179 2c20 782d 7261 7920 656e   array, x-ray en
-00010cf0: 6572 6779 2069 6e20 6b65 560d 0a20 2020  ergy in keV..   
-00010d00: 203a 7061 7261 6d20 6465 6e73 6974 793a   :param density:
-00010d10: 2066 6c6f 6174 2064 656e 7369 7479 2069   float density i
-00010d20: 6e20 672f 636d 5e33 0d0a 2020 2020 3a72  n g/cm^3..    :r
-00010d30: 6574 7572 6e3a 206e 2863 6f6d 706c 6578  eturn: n(complex
-00010d40: 292c 2044 656c 7461 2c20 4265 7461 0d0a  ), Delta, Beta..
-00010d50: 2020 2020 2222 220d 0a20 2020 2065 6c65      """..    ele
-00010d60: 6d65 6e74 7320 3d20 7370 6c69 745f 636f  ments = split_co
-00010d70: 6d70 6f75 6e64 2863 6865 6d69 6361 6c5f  mpound(chemical_
-00010d80: 666f 726d 756c 6129 0d0a 2020 2020 7765  formula)..    we
-00010d90: 6967 6874 203d 206d 6f6c 6563 756c 6172  ight = molecular
-00010da0: 5f77 6569 6768 7428 6368 656d 6963 616c  _weight(chemical
-00010db0: 5f66 6f72 6d75 6c61 290d 0a20 2020 2061  _formula)..    a
-00010dc0: 746f 6d5f 7065 725f 766f 6c75 6d65 203d  tom_per_volume =
-00010dd0: 2031 652d 3234 202a 2064 656e 7369 7479   1e-24 * density
-00010de0: 202a 2066 672e 4e61 202f 2077 6569 6768   * fg.Na / weigh
-00010df0: 7420 2023 2061 746f 6d73 2070 6572 2041  t  # atoms per A
-00010e00: 5e33 0d0a 2020 2020 6e20 3d20 7872 6179  ^3..    n = xray
-00010e10: 5f72 6566 7261 6374 6976 655f 696e 6465  _refractive_inde
-00010e20: 7828 656c 656d 656e 7473 2c20 656e 6572  x(elements, ener
-00010e30: 6779 5f6b 6576 2c20 6174 6f6d 5f70 6572  gy_kev, atom_per
-00010e40: 5f76 6f6c 756d 6529 0d0a 2020 2020 6465  _volume)..    de
-00010e50: 6c74 6120 3d20 3120 2d20 6e70 2e72 6561  lta = 1 - np.rea
-00010e60: 6c28 6e29 0d0a 2020 2020 6265 7461 203d  l(n)..    beta =
-00010e70: 202d 6e70 2e69 6d61 6728 6e29 0d0a 2020   -np.imag(n)..  
-00010e80: 2020 7265 7475 726e 206e 2c20 6465 6c74    return n, delt
-00010e90: 612c 2062 6574 610d 0a0d 0a0d 0a64 6566  a, beta......def
-00010ea0: 2066 696c 7465 725f 7472 616e 736d 6973   filter_transmis
-00010eb0: 7369 6f6e 2863 6865 6d69 6361 6c5f 666f  sion(chemical_fo
-00010ec0: 726d 756c 612c 2065 6e65 7267 795f 6b65  rmula, energy_ke
-00010ed0: 762c 2064 656e 7369 7479 2c20 7468 6963  v, density, thic
-00010ee0: 6b6e 6573 735f 756d 3d31 3030 293a 0d0a  kness_um=100):..
-00010ef0: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
-00010f00: 6375 6c61 7465 2074 7261 6e73 6d69 7373  culate transmiss
-00010f10: 696f 6e20 6f66 2078 2d72 6179 2074 6872  ion of x-ray thr
-00010f20: 6f75 6768 2061 2073 6c61 6220 6f66 206d  ough a slab of m
-00010f30: 6174 6572 6961 6c0d 0a20 2020 2045 7175  aterial..    Equ
-00010f40: 6976 616c 656e 7420 746f 2068 7474 7073  ivalent to https
-00010f50: 3a2f 2f68 656e 6b65 2e6c 626c 2e67 6f76  ://henke.lbl.gov
-00010f60: 2f6f 7074 6963 616c 5f63 6f6e 7374 616e  /optical_constan
-00010f70: 7473 2f66 696c 7465 7232 2e68 746d 6c0d  ts/filter2.html.
-00010f80: 0a20 2020 2042 6173 6564 206f 6e20 666f  .    Based on fo
-00010f90: 726d 756c 6173 2066 726f 6d3a 2048 656e  rmulas from: Hen
-00010fa0: 6b65 2c20 4775 6c6c 696b 736f 6e2c 2061  ke, Gullikson, a
-00010fb0: 6e64 2044 6176 6973 2c20 4174 6f6d 6963  nd Davis, Atomic
-00010fc0: 2044 6174 6120 616e 6420 4e75 636c 6561   Data and Nuclea
-00010fd0: 7220 4461 7461 2054 6162 6c65 7320 3534  r Data Tables 54
-00010fe0: 206e 6f2e 322c 2031 3831 2d33 3432 2028   no.2, 181-342 (
-00010ff0: 4a75 6c79 2031 3939 3329 0d0a 2020 2020  July 1993)..    
-00011000: 3a70 6172 616d 2063 6865 6d69 6361 6c5f  :param chemical_
-00011010: 666f 726d 756c 613a 2073 7472 206d 6f6c  formula: str mol
-00011020: 6563 756c 6172 2066 6f72 6d75 6c61 0d0a  ecular formula..
-00011030: 2020 2020 3a70 6172 616d 2065 6e65 7267      :param energ
-00011040: 795f 6b65 763a 2066 6c6f 6174 206f 7220  y_kev: float or 
-00011050: 6172 7261 792c 2078 2d72 6179 2065 6e65  array, x-ray ene
-00011060: 7267 7920 696e 206b 6556 0d0a 2020 2020  rgy in keV..    
-00011070: 3a70 6172 616d 2064 656e 7369 7479 3a20  :param density: 
-00011080: 666c 6f61 7420 6465 6e73 6974 7920 696e  float density in
-00011090: 2067 2f63 6d5e 330d 0a20 2020 203a 7061   g/cm^3..    :pa
-000110a0: 7261 6d20 7468 6963 6b6e 6573 735f 756d  ram thickness_um
-000110b0: 3a20 736c 6162 2074 6869 636b 6e65 7373  : slab thickness
-000110c0: 2069 6e20 6d69 6372 6f6e 730d 0a20 2020   in microns..   
-000110d0: 203a 7265 7475 726e 3a20 666c 6f61 7420   :return: float 
-000110e0: 6f72 2061 7272 6179 0d0a 2020 2020 2222  or array..    ""
-000110f0: 220d 0a20 2020 2065 6c65 6d65 6e74 7320  "..    elements 
-00011100: 3d20 7370 6c69 745f 636f 6d70 6f75 6e64  = split_compound
-00011110: 2863 6865 6d69 6361 6c5f 666f 726d 756c  (chemical_formul
-00011120: 6129 0d0a 2020 2020 7765 6967 6874 203d  a)..    weight =
-00011130: 206d 6f6c 6563 756c 6172 5f77 6569 6768   molecular_weigh
-00011140: 7428 6368 656d 6963 616c 5f66 6f72 6d75  t(chemical_formu
-00011150: 6c61 290d 0a20 2020 2061 746f 6d5f 7065  la)..    atom_pe
-00011160: 725f 766f 6c75 6d65 203d 2031 652d 3234  r_volume = 1e-24
-00011170: 202a 2064 656e 7369 7479 202a 2066 672e   * density * fg.
-00011180: 4e61 202f 2077 6569 6768 7420 2023 2061  Na / weight  # a
-00011190: 746f 6d73 2070 6572 2041 5e33 0d0a 2020  toms per A^3..  
-000111a0: 2020 7265 7475 726e 2078 7261 795f 7472    return xray_tr
-000111b0: 616e 736d 6973 7369 6f6e 2865 6c65 6d65  ansmission(eleme
-000111c0: 6e74 732c 2065 6e65 7267 795f 6b65 762c  nts, energy_kev,
-000111d0: 2061 746f 6d5f 7065 725f 766f 6c75 6d65   atom_per_volume
-000111e0: 2c20 7468 6963 6b6e 6573 735f 756d 290d  , thickness_um).
-000111f0: 0a0d 0a0d 0a27 2d2d 2d2d 2d2d 2d2d 2d2d  .....'----------
-00011200: 2d2d 2d2d 2d2d 2d2d 2d4c 6174 7469 6365  ---------Lattice
-00011210: 2054 7261 6e73 666f 726d 6174 696f 6e73   Transformations
-00011220: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00011230: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 270d  --------------'.
-00011240: 0a0d 0a0d 0a64 6566 2052 6353 7028 5556  .....def RcSp(UV
-00011250: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
-00011260: 2047 656e 6572 6174 6520 7265 6369 7072   Generate recipr
-00011270: 6f63 616c 2063 656c 6c20 6672 6f6d 2072  ocal cell from r
-00011280: 6561 6c20 7370 6163 6520 756e 6974 2076  eal space unit v
-00011290: 6563 6f72 730d 0a20 2020 2055 7361 6765  ecors..    Usage
-000112a0: 3a0d 0a20 2020 2055 5673 203d 2052 6353  :..    UVs = RcS
-000112b0: 7028 5556 290d 0a20 2020 2020 2055 5620  p(UV)..      UV 
-000112c0: 3d20 5b5b 3378 335d 5d20 6d61 7472 6978  = [[3x3]] matrix
-000112d0: 206f 6620 7665 6374 6f72 7320 5b61 2c62   of vectors [a,b
-000112e0: 2c63 5d0d 0a20 2020 2022 2222 0d0a 0d0a  ,c]..    """....
-000112f0: 2020 2020 2320 6231 203d 2032 2a6e 702e      # b1 = 2*np.
-00011300: 7069 2a6e 702e 6372 6f73 7328 5556 5b31  pi*np.cross(UV[1
-00011310: 5d2c 5556 5b32 5d29 2f6e 702e 646f 7428  ],UV[2])/np.dot(
-00011320: 5556 5b30 5d2c 6e70 2e63 726f 7373 2855  UV[0],np.cross(U
-00011330: 565b 315d 2c55 565b 325d 2929 0d0a 2020  V[1],UV[2]))..  
-00011340: 2020 2320 6232 203d 2032 2a6e 702e 7069    # b2 = 2*np.pi
-00011350: 2a6e 702e 6372 6f73 7328 5556 5b32 5d2c  *np.cross(UV[2],
-00011360: 5556 5b30 5d29 2f6e 702e 646f 7428 5556  UV[0])/np.dot(UV
-00011370: 5b30 5d2c 6e70 2e63 726f 7373 2855 565b  [0],np.cross(UV[
-00011380: 315d 2c55 565b 325d 2929 0d0a 2020 2020  1],UV[2]))..    
-00011390: 2320 6233 203d 2032 2a6e 702e 7069 2a6e  # b3 = 2*np.pi*n
-000113a0: 702e 6372 6f73 7328 5556 5b30 5d2c 5556  p.cross(UV[0],UV
-000113b0: 5b31 5d29 2f6e 702e 646f 7428 5556 5b30  [1])/np.dot(UV[0
-000113c0: 5d2c 6e70 2e63 726f 7373 2855 565b 315d  ],np.cross(UV[1]
-000113d0: 2c55 565b 325d 2929 0d0a 2020 2020 2320  ,UV[2]))..    # 
-000113e0: 5556 7320 3d20 6e70 2e61 7272 6179 285b  UVs = np.array([
-000113f0: 6231 2c62 322c 6233 5d29 0d0a 0d0a 2020  b1,b2,b3])....  
-00011400: 2020 5556 7320 3d20 3220 2a20 6e70 2e70    UVs = 2 * np.p
-00011410: 6920 2a20 6e70 2e6c 696e 616c 672e 696e  i * np.linalg.in
-00011420: 7628 5556 292e 540d 0a20 2020 2072 6574  v(UV).T..    ret
-00011430: 7572 6e20 5556 730d 0a0d 0a0d 0a64 6566  urn UVs......def
-00011440: 2069 6e64 7828 512c 2055 5629 3a0d 0a20   indx(Q, UV):.. 
-00011450: 2020 2022 2222 0d0a 2020 2020 496e 6465     """..    Inde
-00011460: 7820 5128 782c 792c 7a29 206f 6e20 6f6e  x Q(x,y,z) on on
-00011470: 206c 6174 7469 6365 205b 682c 6b2c 6c5d   lattice [h,k,l]
-00011480: 2077 6974 6820 756e 6974 2076 6563 746f   with unit vecto
-00011490: 7273 2055 560d 0a20 2020 2055 7361 6765  rs UV..    Usage
-000114a0: 3a0d 0a20 2020 2020 2048 4b4c 203d 2069  :..      HKL = i
-000114b0: 6e64 7828 512c 5556 290d 0a20 2020 2020  ndx(Q,UV)..     
-000114c0: 2051 203d 205b 5b6e 7833 5d5d 2061 7272   Q = [[nx3]] arr
-000114d0: 6179 206f 6620 7665 6374 6f72 730d 0a20  ay of vectors.. 
-000114e0: 2020 2020 2055 5620 3d20 5b5b 3378 335d       UV = [[3x3]
-000114f0: 5d20 6d61 7472 6978 206f 6620 7665 6374  ] matrix of vect
-00011500: 6f72 7320 5b61 2c62 2c63 5d0d 0a20 2020  ors [a,b,c]..   
-00011510: 2022 2222 0d0a 2020 2020 484b 4c20 3d20   """..    HKL = 
-00011520: 6e70 2e64 6f74 2851 2c20 6e70 2e6c 696e  np.dot(Q, np.lin
-00011530: 616c 672e 696e 7628 5556 2929 0d0a 2020  alg.inv(UV))..  
-00011540: 2020 7265 7475 726e 2048 4b4c 0d0a 0d0a    return HKL....
-00011550: 0d0a 6465 6620 6c61 7470 6172 766f 6c75  ..def latparvolu
-00011560: 6d65 2861 2c20 623d 4e6f 6e65 2c20 633d  me(a, b=None, c=
-00011570: 4e6f 6e65 2c20 616c 7068 613d 3930 2e2c  None, alpha=90.,
-00011580: 2062 6574 613d 3930 2e2c 2067 616d 6d61   beta=90., gamma
-00011590: 3d39 302e 293a 0d0a 2020 2020 2222 220d  =90.):..    """.
-000115a0: 0a20 2020 2043 616c 6375 616c 7465 2074  .    Calcualte t
-000115b0: 6865 2075 6e69 7420 6365 6c6c 2076 6f6c  he unit cell vol
-000115c0: 756d 6520 696e 2041 5e33 0d0a 2020 2020  ume in A^3..    
-000115d0: 3a70 6172 616d 2061 2c20 622c 2063 3a20  :param a, b, c: 
-000115e0: 666c 6f61 7420 6c61 7474 6963 6520 7061  float lattice pa
-000115f0: 7261 6d65 7465 7273 0d0a 2020 2020 3a70  rameters..    :p
-00011600: 6172 616d 2061 6c70 6861 2c20 6265 7461  aram alpha, beta
-00011610: 2c20 6761 6d6d 613a 2066 6c6f 6174 206c  , gamma: float l
-00011620: 6174 7469 6365 2061 6e67 6c65 730d 0a20  attice angles.. 
-00011630: 2020 203a 7265 7475 726e 3a20 666c 6f61     :return: floa
-00011640: 7420 766f 6c75 6d65 2069 6e20 416e 6773  t volume in Angs
-00011650: 7472 6f6d 5e33 0d0a 2020 2020 2222 220d  trom^3..    """.
-00011660: 0a20 2020 2069 6620 6220 6973 204e 6f6e  .    if b is Non
-00011670: 653a 0d0a 2020 2020 2020 2020 6220 3d20  e:..        b = 
-00011680: 610d 0a20 2020 2069 6620 6320 6973 204e  a..    if c is N
-00011690: 6f6e 653a 0d0a 2020 2020 2020 2020 6320  one:..        c 
-000116a0: 3d20 610d 0a20 2020 2063 6120 3d20 6e70  = a..    ca = np
-000116b0: 2e63 6f73 286e 702e 6465 6732 7261 6428  .cos(np.deg2rad(
-000116c0: 616c 7068 6129 290d 0a20 2020 2063 6220  alpha))..    cb 
-000116d0: 3d20 6e70 2e63 6f73 286e 702e 6465 6732  = np.cos(np.deg2
-000116e0: 7261 6428 6265 7461 2929 0d0a 2020 2020  rad(beta))..    
-000116f0: 6367 203d 206e 702e 636f 7328 6e70 2e64  cg = np.cos(np.d
-00011700: 6567 3272 6164 2867 616d 6d61 2929 0d0a  eg2rad(gamma))..
-00011710: 2020 2020 7265 7475 726e 206e 702e 7371      return np.sq
-00011720: 7274 2861 2a2a 3220 2a20 622a 2a32 202a  rt(a**2 * b**2 *
-00011730: 2063 2a2a 3220 2a20 2831 202b 2032 202a   c**2 * (1 + 2 *
-00011740: 2063 6120 2a20 6362 202a 2063 6720 2d20   ca * cb * cg - 
-00011750: 6361 2a2a 3220 2d20 6362 2a2a 3220 2d20  ca**2 - cb**2 - 
-00011760: 6367 2a2a 3229 290d 0a0d 0a0d 0a64 6566  cg**2))......def
-00011770: 206c 6174 7061 725f 7265 6369 7072 6f63   latpar_reciproc
-00011780: 616c 2855 5629 3a0d 0a20 2020 2022 2222  al(UV):..    """
-00011790: 0d0a 2020 2020 5265 7475 726e 2074 6865  ..    Return the
-000117a0: 2072 6563 6970 726f 6361 6c20 6c61 7474   reciprocal latt
-000117b0: 6963 6520 7061 7261 6d65 7465 7273 2069  ice parameters i
-000117c0: 6e20 696e 7665 7273 652d 616e 6773 7472  n inverse-angstr
-000117d0: 6f6d 7320 616e 6420 6465 6772 6565 730d  oms and degrees.
-000117e0: 0a20 2020 203a 7061 7261 6d20 5556 3a20  .    :param UV: 
-000117f0: 5b33 2a33 5d20 756e 6974 2076 6563 746f  [3*3] unit vecto
-00011800: 7220 5b61 2c62 2c63 5d0d 0a20 2020 203a  r [a,b,c]..    :
-00011810: 7265 7475 726e 3a20 612a 2c20 622a 2c20  return: a*, b*, 
-00011820: 632a 2c20 616c 7068 612a 2c20 6265 7461  c*, alpha*, beta
-00011830: 2a2c 2067 616d 6d61 2a0d 0a20 2020 2022  *, gamma*..    "
-00011840: 2222 0d0a 2020 2020 5556 7320 3d20 5263  ""..    UVs = Rc
-00011850: 5370 2855 5629 202f 2028 3220 2a20 6e70  Sp(UV) / (2 * np
-00011860: 2e70 6929 0d0a 2020 2020 6231 2c20 6232  .pi)..    b1, b2
-00011870: 2c20 6233 203d 2066 672e 6d61 6728 5556  , b3 = fg.mag(UV
-00011880: 7329 0d0a 2020 2020 6265 7461 3320 3d20  s)..    beta3 = 
-00011890: 6667 2e61 6e67 2855 5673 5b30 2c20 3a5d  fg.ang(UVs[0, :]
-000118a0: 2c20 5556 735b 312c 203a 5d2c 2027 6465  , UVs[1, :], 'de
-000118b0: 6727 290d 0a20 2020 2062 6574 6132 203d  g')..    beta2 =
-000118c0: 2066 672e 616e 6728 5556 735b 302c 203a   fg.ang(UVs[0, :
-000118d0: 5d2c 2055 5673 5b32 2c20 3a5d 2c20 2764  ], UVs[2, :], 'd
-000118e0: 6567 2729 0d0a 2020 2020 6265 7461 3120  eg')..    beta1 
-000118f0: 3d20 6667 2e61 6e67 2855 5673 5b31 2c20  = fg.ang(UVs[1, 
-00011900: 3a5d 2c20 5556 735b 322c 203a 5d2c 2027  :], UVs[2, :], '
-00011910: 6465 6727 290d 0a20 2020 2072 6574 7572  deg')..    retur
-00011920: 6e20 6231 2c20 6232 2c20 6233 2c20 6265  n b1, b2, b3, be
-00011930: 7461 312c 2062 6574 6132 2c20 6265 7461  ta1, beta2, beta
-00011940: 330d 0a0d 0a0d 0a64 6566 2042 6d61 7472  3......def Bmatr
-00011950: 6978 2855 5629 3a0d 0a20 2020 2022 2222  ix(UV):..    """
-00011960: 0d0a 2020 2020 4361 6c63 756c 6174 6520  ..    Calculate 
-00011970: 7468 6520 4275 7369 6e67 2061 6e64 204c  the Busing and L
-00011980: 6576 7920 4220 6d61 7472 6978 2066 726f  evy B matrix fro
-00011990: 6d20 6120 7265 616c 2073 7061 6365 2055  m a real space U
-000119a0: 560d 0a20 2020 2022 6368 6f6f 7365 2074  V..    "choose t
-000119b0: 6865 2078 2d61 7869 7320 7061 7261 6c6c  he x-axis parall
-000119c0: 656c 2074 6f20 612a 2c20 7468 6520 792d  el to a*, the y-
-000119d0: 6178 6973 2069 6e20 7468 6520 706c 616e  axis in the plan
-000119e0: 6520 6f66 2061 2a20 616e 6420 622a 2c20  e of a* and b*, 
-000119f0: 616e 6420 7468 6520 7a2d 6178 6973 2070  and the z-axis p
-00011a00: 6572 7065 6e64 6963 756c 6172 2074 6f20  erpendicular to 
-00011a10: 7468 6174 2070 6c61 6e65 220d 0a20 2020  that plane"..   
-00011a20: 2046 726f 6d3a 2057 2e20 522e 2042 7573   From: W. R. Bus
-00011a30: 696e 6720 616e 6420 482e 2041 2e20 4c65  ing and H. A. Le
-00011a40: 7679 2c20 4163 7461 2043 7279 7374 2e20  vy, Acta Cryst. 
-00011a50: 2831 3936 3729 2e20 3232 2c20 3435 372d  (1967). 22, 457-
-00011a60: 3436 340d 0a20 2020 2022 416e 676c 6520  464..    "Angle 
-00011a70: 6361 6c63 756c 6174 696f 6e73 2066 6f72  calculations for
-00011a80: 2033 2d20 616e 6420 342d 6369 7263 6c65   3- and 4-circle
-00011a90: 2058 2d72 6179 2061 6e64 206e 6575 7472   X-ray and neutr
-00011aa0: 6f6e 2064 6966 6672 6163 746f 6d65 7465  on diffractomete
-00011ab0: 7273 220d 0a20 2020 2053 6565 2061 6c73  rs"..    See als
-00011ac0: 6f3a 2068 7474 7073 3a2f 2f64 6f63 732e  o: https://docs.
-00011ad0: 6d61 6e74 6964 7072 6f6a 6563 742e 6f72  mantidproject.or
-00011ae0: 672f 6e69 6768 746c 792f 636f 6e63 6570  g/nightly/concep
-00011af0: 7473 2f4c 6174 7469 6365 2e68 746d 6c0d  ts/Lattice.html.
-00011b00: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
-00011b10: 2222 220d 0a20 2020 2061 312c 2061 322c  """..    a1, a2,
-00011b20: 2061 3320 3d20 6667 2e6d 6167 2855 5629   a3 = fg.mag(UV)
-00011b30: 0d0a 2020 2020 616c 7068 6133 203d 2066  ..    alpha3 = f
-00011b40: 672e 616e 6728 5556 5b30 2c20 3a5d 2c20  g.ang(UV[0, :], 
-00011b50: 5556 5b31 2c20 3a5d 290d 0a20 2020 2061  UV[1, :])..    a
-00011b60: 6c70 6861 3220 3d20 6667 2e61 6e67 2855  lpha2 = fg.ang(U
-00011b70: 565b 302c 203a 5d2c 2055 565b 322c 203a  V[0, :], UV[2, :
-00011b80: 5d29 0d0a 2020 2020 616c 7068 6131 203d  ])..    alpha1 =
-00011b90: 2066 672e 616e 6728 5556 5b31 2c20 3a5d   fg.ang(UV[1, :]
-00011ba0: 2c20 5556 5b32 2c20 3a5d 290d 0a20 2020  , UV[2, :])..   
-00011bb0: 2055 5673 203d 2052 6353 7028 5556 2920   UVs = RcSp(UV) 
-00011bc0: 2f20 2832 202a 206e 702e 7069 290d 0a20  / (2 * np.pi).. 
-00011bd0: 2020 2062 312c 2062 322c 2062 3320 3d20     b1, b2, b3 = 
-00011be0: 6667 2e6d 6167 2855 5673 290d 0a20 2020  fg.mag(UVs)..   
-00011bf0: 2062 6574 6133 203d 2066 672e 616e 6728   beta3 = fg.ang(
-00011c00: 5556 735b 302c 203a 5d2c 2055 5673 5b31  UVs[0, :], UVs[1
-00011c10: 2c20 3a5d 290d 0a20 2020 2062 6574 6132  , :])..    beta2
-00011c20: 203d 2066 672e 616e 6728 5556 735b 302c   = fg.ang(UVs[0,
-00011c30: 203a 5d2c 2055 5673 5b32 2c20 3a5d 290d   :], UVs[2, :]).
-00011c40: 0a20 2020 2062 6574 6131 203d 2066 672e  .    beta1 = fg.
-00011c50: 616e 6728 5556 735b 312c 203a 5d2c 2055  ang(UVs[1, :], U
-00011c60: 5673 5b32 2c20 3a5d 290d 0a0d 0a20 2020  Vs[2, :])....   
-00011c70: 2042 203d 206e 702e 6172 7261 7928 5b5b   B = np.array([[
-00011c80: 6231 2c20 6232 202a 206e 702e 636f 7328  b1, b2 * np.cos(
-00011c90: 6265 7461 3329 2c20 6233 202a 206e 702e  beta3), b3 * np.
-00011ca0: 636f 7328 6265 7461 3229 5d2c 0d0a 2020  cos(beta2)],..  
-00011cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cc0: 5b30 2c20 6232 202a 206e 702e 7369 6e28  [0, b2 * np.sin(
-00011cd0: 6265 7461 3329 2c20 2d62 3320 2a20 6e70  beta3), -b3 * np
-00011ce0: 2e73 696e 2862 6574 6132 2920 2a20 6e70  .sin(beta2) * np
-00011cf0: 2e63 6f73 2861 6c70 6861 3129 5d2c 0d0a  .cos(alpha1)],..
-00011d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d10: 2020 5b30 2c20 302c 2031 202f 2061 335d    [0, 0, 1 / a3]
-00011d20: 5d29 0d0a 2020 2020 7265 7475 726e 2032  ])..    return 2
-00011d30: 202a 206e 702e 7069 202a 2042 2020 2320   * np.pi * B  # 
-00011d40: 6571 7569 7661 6c65 6e74 2074 6f20 7472  equivalent to tr
-00011d50: 616e 7370 6f73 6528 5556 7329 0d0a 2020  anspose(UVs)..  
-00011d60: 2020 2222 220d 0a20 2020 2072 6574 7572    """..    retur
-00011d70: 6e20 5263 5370 2855 5629 2e54 0d0a 0d0a  n RcSp(UV).T....
-00011d80: 0d0a 6465 6620 6c61 7470 6172 426d 6174  ..def latparBmat
-00011d90: 7269 7828 612c 2062 3d4e 6f6e 652c 2063  rix(a, b=None, c
-00011da0: 3d4e 6f6e 652c 2061 6c70 6861 3d39 302e  =None, alpha=90.
-00011db0: 2c20 6265 7461 3d39 302e 2c20 6761 6d6d  , beta=90., gamm
-00011dc0: 613d 3930 2e29 3a0d 0a20 2020 2022 2222  a=90.):..    """
-00011dd0: 0d0a 2020 2020 4361 6c63 756c 6174 6520  ..    Calculate 
-00011de0: 7468 6520 4275 7369 6e67 2061 6e64 204c  the Busing and L
-00011df0: 6576 7920 4220 6d61 7472 6978 2066 726f  evy B matrix fro
-00011e00: 6d20 6120 7265 616c 2073 7061 6365 2055  m a real space U
-00011e10: 560d 0a20 2020 2022 6368 6f6f 7365 2020  V..    "choose  
-00011e20: 7468 6520 7820 2061 7869 7320 7061 7261  the x  axis para
-00011e30: 6c6c 656c 2020 746f 2061 2c20 7468 6520  llel  to a, the 
-00011e40: 2079 2020 6178 6973 2020 696e 2020 7468   y  axis  in  th
-00011e50: 6520 2070 6c61 6e65 2020 6f66 2020 6120  e  plane  of  a 
-00011e60: 2061 6e64 2020 622c 2020 616e 6420 2074   and  b,  and  t
-00011e70: 6865 2020 7a20 2061 7869 730d 0a20 2020  he  z  axis..   
-00011e80: 2070 6572 7065 6e64 6963 756c 6172 2020   perpendicular  
-00011e90: 746f 2020 7468 6174 2020 706c 616e 6522  to  that  plane"
-00011ea0: 0d0a 2020 2020 4672 6f6d 3a20 572e 2052  ..    From: W. R
-00011eb0: 2e20 4275 7369 6e67 2061 6e64 2048 2e20  . Busing and H. 
-00011ec0: 412e 204c 6576 792c 2041 6374 6120 4372  A. Levy, Acta Cr
-00011ed0: 7973 742e 2028 3139 3637 292e 2032 322c  yst. (1967). 22,
-00011ee0: 2034 3537 2d34 3634 0d0a 2020 2020 2241   457-464..    "A
-00011ef0: 6e67 6c65 2063 616c 6375 6c61 7469 6f6e  ngle calculation
-00011f00: 7320 666f 7220 332d 2061 6e64 2034 2d63  s for 3- and 4-c
-00011f10: 6972 636c 6520 582d 7261 7920 616e 6420  ircle X-ray and 
-00011f20: 6e65 7574 726f 6e20 6469 6666 7261 6374  neutron diffract
-00011f30: 6f6d 6574 6572 7322 0d0a 2020 2020 5365  ometers"..    Se
-00011f40: 6520 616c 736f 3a20 6874 7470 733a 2f2f  e also: https://
-00011f50: 646f 6373 2e6d 616e 7469 6470 726f 6a65  docs.mantidproje
-00011f60: 6374 2e6f 7267 2f6e 6967 6874 6c79 2f63  ct.org/nightly/c
-00011f70: 6f6e 6365 7074 732f 4c61 7474 6963 652e  oncepts/Lattice.
-00011f80: 6874 6d6c 0d0a 2020 2020 3a70 6172 616d  html..    :param
-00011f90: 2061 2c20 622c 2063 3a20 666c 6f61 7420   a, b, c: float 
-00011fa0: 6c61 7474 6963 6520 7061 7261 6d65 7465  lattice paramete
-00011fb0: 7273 0d0a 2020 2020 3a70 6172 616d 2061  rs..    :param a
-00011fc0: 6c70 6861 2c20 6265 7461 2c20 6761 6d6d  lpha, beta, gamm
-00011fd0: 613a 2066 6c6f 6174 206c 6174 7469 6365  a: float lattice
-00011fe0: 2061 6e67 6c65 730d 0a20 2020 203a 7265   angles..    :re
-00011ff0: 7475 726e 3a20 5b33 2a33 5d20 6172 7261  turn: [3*3] arra
-00012000: 790d 0a20 2020 2022 2222 0d0a 2020 2020  y..    """..    
-00012010: 6966 2062 2069 7320 4e6f 6e65 3a0d 0a20  if b is None:.. 
-00012020: 2020 2020 2020 2062 203d 2061 0d0a 2020         b = a..  
-00012030: 2020 6966 2063 2069 7320 4e6f 6e65 3a0d    if c is None:.
-00012040: 0a20 2020 2020 2020 2063 203d 2061 0d0a  .        c = a..
-00012050: 2020 2020 7576 203d 206c 6174 7061 7232      uv = latpar2
-00012060: 7576 5f72 6f74 2861 2c62 2c20 632c 2061  uv_rot(a,b, c, a
-00012070: 6c70 6861 2c20 6265 7461 2c20 6761 6d6d  lpha, beta, gamm
-00012080: 6129 0d0a 2020 2020 7265 7475 726e 2042  a)..    return B
-00012090: 6d61 7472 6978 2875 7629 0d0a 0d0a 0d0a  matrix(uv)......
-000120a0: 6465 6620 756d 6174 7269 7828 615f 6178  def umatrix(a_ax
-000120b0: 6973 3d4e 6f6e 652c 2062 5f61 7869 733d  is=None, b_axis=
-000120c0: 4e6f 6e65 2c20 635f 6178 6973 3d4e 6f6e  None, c_axis=Non
-000120d0: 6529 3a0d 0a20 2020 2022 2222 0d0a 2020  e):..    """..  
-000120e0: 2020 4465 6669 6e65 2061 6e20 6f72 6965    Define an orie
-000120f0: 6e74 6174 696f 6e20 6d61 7472 6978 2069  ntation matrix i
-00012100: 6e20 7468 6520 6469 6666 7261 6374 6f6d  n the diffractom
-00012110: 6574 6572 2066 7261 6d65 0d0a 2020 2020  eter frame..    
-00012120: 4469 6666 7261 6374 6f6d 6574 6572 2066  Diffractometer f
-00012130: 7261 6d65 2061 6363 6f72 6469 6e67 2074  rame according t
-00012140: 6f20 4669 672e 2031 2c20 482e 2059 6f75  o Fig. 1, H. You
-00012150: 2c20 4a2e 2041 7070 6c2e 2043 7279 7374  , J. Appl. Cryst
-00012160: 2033 3220 2831 3939 3929 2c20 3631 342d   32 (1999), 614-
-00012170: 3632 330d 0a20 2020 2020 207a 2d61 7869  623..      z-axi
-00012180: 7320 3a20 6178 6973 2070 6172 616c 6c65  s : axis paralle
-00012190: 6c20 746f 2074 6865 2070 6869 2072 6f74  l to the phi rot
-000121a0: 6174 696f 6e20 6178 6973 2077 6865 6e20  ation axis when 
-000121b0: 616c 6c20 616e 676c 6573 2030 2028 746f  all angles 0 (to
-000121c0: 7761 7264 7320 7761 6c6c 2028 2b78 2920  wards wall (+x) 
-000121d0: 696e 206c 6162 2066 7261 6d65 290d 0a20  in lab frame).. 
-000121e0: 2020 2020 2078 2d61 7869 7320 3a20 7665       x-axis : ve
-000121f0: 6374 6f72 206e 6f72 6d61 6c20 746f 2070  ctor normal to p
-00012200: 6869 2061 7869 7320 7768 6572 6520 7068  hi axis where ph
-00012210: 693d 3020 2874 6f77 6172 6420 6365 696c  i=0 (toward ceil
-00012220: 696e 6720 282b 7929 2069 6e20 6c61 6220  ing (+y) in lab 
-00012230: 6672 616d 6529 0d0a 2020 2020 2020 792d  frame)..      y-
-00012240: 6178 6973 203a 2076 6563 746f 7220 6e6f  axis : vector no
-00012250: 726d 616c 2074 6f20 782c 7a20 6178 6573  rmal to x,z axes
-00012260: 2028 7061 7261 6c6c 656c 2074 6f20 6265   (parallel to be
-00012270: 616d 2028 2b7a 2920 696e 206c 6162 2066  am (+z) in lab f
-00012280: 7261 6d65 290d 0a20 2020 203a 7061 7261  rame)..    :para
-00012290: 6d20 615f 6178 6973 3a20 6469 7265 6374  m a_axis: direct
-000122a0: 696f 6e20 6f66 2061 2069 6e20 7468 6520  ion of a in the 
-000122b0: 6469 6666 7261 6374 6f6d 6574 6572 2066  diffractometer f
-000122c0: 7261 6d65 0d0a 2020 2020 3a70 6172 616d  rame..    :param
-000122d0: 2062 5f61 7869 733a 2064 6972 6563 7469   b_axis: directi
-000122e0: 6f6e 206f 6620 6220 696e 2074 6865 2064  on of b in the d
-000122f0: 6966 6672 6163 746f 6d65 7465 7220 6672  iffractometer fr
-00012300: 616d 650d 0a20 2020 203a 7061 7261 6d20  ame..    :param 
-00012310: 635f 6178 6973 3a20 6469 7265 6374 696f  c_axis: directio
-00012320: 6e20 6f66 2063 2069 6e20 7468 6520 6469  n of c in the di
-00012330: 6666 7261 6374 6f6d 6574 6572 2066 7261  ffractometer fra
-00012340: 6d65 0d0a 2020 2020 3a72 6574 7572 6e3a  me..    :return:
-00012350: 205b 332a 335d 2061 7272 6179 0d0a 2020   [3*3] array..  
-00012360: 2020 2222 220d 0a20 2020 2061 5f61 7869    """..    a_axi
-00012370: 7320 3d20 6667 2e6e 6f72 6d28 6e70 2e63  s = fg.norm(np.c
-00012380: 726f 7373 2862 5f61 7869 732c 2063 5f61  ross(b_axis, c_a
-00012390: 7869 7329 2920 6966 2061 5f61 7869 7320  xis)) if a_axis 
-000123a0: 6973 204e 6f6e 6520 656c 7365 2066 672e  is None else fg.
-000123b0: 6e6f 726d 2861 5f61 7869 7329 0d0a 2020  norm(a_axis)..  
-000123c0: 2020 625f 6178 6973 203d 2066 672e 6e6f    b_axis = fg.no
-000123d0: 726d 286e 702e 6372 6f73 7328 635f 6178  rm(np.cross(c_ax
-000123e0: 6973 2c20 615f 6178 6973 2929 2069 6620  is, a_axis)) if 
-000123f0: 625f 6178 6973 2069 7320 4e6f 6e65 2065  b_axis is None e
-00012400: 6c73 6520 6667 2e6e 6f72 6d28 625f 6178  lse fg.norm(b_ax
-00012410: 6973 290d 0a20 2020 2063 5f61 7869 7320  is)..    c_axis 
-00012420: 3d20 6667 2e6e 6f72 6d28 6e70 2e63 726f  = fg.norm(np.cro
-00012430: 7373 2861 5f61 7869 732c 2062 5f61 7869  ss(a_axis, b_axi
-00012440: 7329 2920 6966 2063 5f61 7869 7320 6973  s)) if c_axis is
-00012450: 204e 6f6e 6520 656c 7365 2066 672e 6e6f   None else fg.no
-00012460: 726d 2863 5f61 7869 7329 0d0a 2020 2020  rm(c_axis)..    
-00012470: 2372 6574 7572 6e20 6e70 2e61 7272 6179  #return np.array
-00012480: 285b 615f 6178 6973 2c20 625f 6178 6973  ([a_axis, b_axis
-00012490: 2c20 635f 6178 6973 5d2c 2064 7479 7065  , c_axis], dtype
-000124a0: 3d66 6c6f 6174 290d 0a20 2020 2069 6620  =float)..    if 
-000124b0: 6e70 2e61 6273 286e 702e 646f 7428 635f  np.abs(np.dot(c_
-000124c0: 6178 6973 2c20 615f 6178 6973 2929 203e  axis, a_axis)) >
-000124d0: 2030 2e39 393a 0d0a 2020 2020 2020 2020   0.99:..        
-000124e0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-000124f0: 2741 7865 7320 6d75 7374 206e 6f74 2062  'Axes must not b
-00012500: 6520 7061 7261 6c6c 656c 2729 0d0a 2020  e parallel')..  
-00012510: 2020 7265 7475 726e 2066 672e 6e6f 726d    return fg.norm
-00012520: 616c 5f62 6173 6973 2863 5f61 7869 732c  al_basis(c_axis,
-00012530: 2061 5f61 7869 7329 0d0a 0d0a 0d0a 6465   a_axis)......de
-00012540: 6620 7562 6d61 7472 6978 2875 762c 2075  f ubmatrix(uv, u
-00012550: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
-00012560: 2052 6574 7572 6e20 5542 206d 6174 7269   Return UB matri
-00012570: 780d 0a20 2020 203a 7061 7261 6d20 7576  x..    :param uv
-00012580: 3a20 5b33 2a33 5d20 756e 6974 2076 6563  : [3*3] unit vec
-00012590: 746f 7220 5b61 2c62 2c63 5d0d 0a20 2020  tor [a,b,c]..   
-000125a0: 203a 7061 7261 6d20 753a 205b 332a 335d   :param u: [3*3]
-000125b0: 206f 7269 656e 7461 7469 6f6e 206d 6174   orientation mat
-000125c0: 7269 7820 696e 2074 6865 2064 6966 6672  rix in the diffr
-000125d0: 6163 746f 6d65 7465 7220 6672 616d 650d  actometer frame.
-000125e0: 0a20 2020 203a 7265 7475 726e 3a20 5b33  .    :return: [3
-000125f0: 2a33 5d20 6172 7261 790d 0a20 2020 2022  *3] array..    "
-00012600: 2222 0d0a 2020 2020 6220 3d20 426d 6174  ""..    b = Bmat
-00012610: 7269 7828 7576 290d 0a20 2020 2072 6574  rix(uv)..    ret
-00012620: 7572 6e20 6e70 2e64 6f74 2875 2c20 6229  urn np.dot(u, b)
-00012630: 0d0a 0d0a 0d0a 6465 6620 726f 746d 6174  ......def rotmat
-00012640: 7269 787a 2870 6869 293a 0d0a 2020 2020  rixz(phi):..    
-00012650: 2222 220d 0a20 2020 2047 656e 6572 6174  """..    Generat
-00012660: 6520 6469 6666 7261 6374 6f6d 6574 6572  e diffractometer
-00012670: 2072 6f74 6174 696f 6e20 6d61 7472 6978   rotation matrix
-00012680: 2070 6869 2028 6574 612c 2064 656c 7461   phi (eta, delta
-00012690: 2920 6162 6f75 7420 7a2d 6178 6973 0d0a  ) about z-axis..
-000126a0: 2020 2020 3a70 6172 616d 2070 6869 3a20      :param phi: 
-000126b0: 666c 6f61 7420 616e 676c 6520 696e 2064  float angle in d
-000126c0: 6567 7265 6573 0d0a 2020 2020 3a72 6574  egrees..    :ret
-000126d0: 7572 6e3a 205b 332a 335d 2061 7272 6179  urn: [3*3] array
-000126e0: 0d0a 2020 2020 2222 220d 0a20 2020 2070  ..    """..    p
-000126f0: 6869 203d 206e 702e 6465 6732 7261 6428  hi = np.deg2rad(
-00012700: 7068 6929 0d0a 2020 2020 6320 3d20 6e70  phi)..    c = np
-00012710: 2e63 6f73 2870 6869 290d 0a20 2020 2073  .cos(phi)..    s
-00012720: 203d 206e 702e 7369 6e28 7068 6929 0d0a   = np.sin(phi)..
-00012730: 2020 2020 7265 7475 726e 206e 702e 6172      return np.ar
-00012740: 7261 7928 5b5b 632c 2073 2c20 305d 2c20  ray([[c, s, 0], 
-00012750: 5b2d 732c 2063 2c20 305d 2c20 5b30 2c20  [-s, c, 0], [0, 
-00012760: 302c 2031 5d5d 290d 0a0d 0a0d 0a64 6566  0, 1]])......def
-00012770: 2072 6f74 6d61 7472 6978 7928 6368 6929   rotmatrixy(chi)
-00012780: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-00012790: 4765 6e65 7261 7465 2064 6966 6672 6163  Generate diffrac
-000127a0: 746f 6d65 7465 7220 726f 7461 7469 6f6e  tometer rotation
-000127b0: 206d 6174 7269 7820 6368 6920 6162 6f75   matrix chi abou
-000127c0: 7420 792d 6178 6973 0d0a 2020 2020 3a70  t y-axis..    :p
-000127d0: 6172 616d 2063 6869 3a20 666c 6f61 7420  aram chi: float 
-000127e0: 616e 676c 6520 696e 2064 6567 7265 6573  angle in degrees
-000127f0: 0d0a 2020 2020 3a72 6574 7572 6e3a 205b  ..    :return: [
-00012800: 332a 335d 2061 7272 6179 0d0a 2020 2020  3*3] array..    
-00012810: 2222 220d 0a20 2020 2063 6869 203d 206e  """..    chi = n
-00012820: 702e 6465 6732 7261 6428 6368 6929 0d0a  p.deg2rad(chi)..
-00012830: 2020 2020 6320 3d20 6e70 2e63 6f73 2863      c = np.cos(c
-00012840: 6869 290d 0a20 2020 2073 203d 206e 702e  hi)..    s = np.
-00012850: 7369 6e28 6368 6929 0d0a 2020 2020 7265  sin(chi)..    re
-00012860: 7475 726e 206e 702e 6172 7261 7928 5b5b  turn np.array([[
-00012870: 632c 2030 2c20 735d 2c20 5b30 2c20 312c  c, 0, s], [0, 1,
-00012880: 2030 5d2c 205b 2d73 2c20 302c 2063 5d5d   0], [-s, 0, c]]
-00012890: 290d 0a0d 0a0d 0a64 6566 2072 6f74 6d61  )......def rotma
-000128a0: 7472 6978 7828 6d75 293a 0d0a 2020 2020  trixx(mu):..    
-000128b0: 2222 220d 0a20 2020 2047 656e 6572 6174  """..    Generat
-000128c0: 6520 6469 6666 7261 6374 6f6d 6574 6572  e diffractometer
-000128d0: 2072 6f74 6174 696f 6e20 6d61 7472 6978   rotation matrix
-000128e0: 206d 7520 2867 616d 6d61 2920 6162 6f75   mu (gamma) abou
-000128f0: 7420 782d 6178 6973 0d0a 2020 2020 3a70  t x-axis..    :p
-00012900: 6172 616d 206d 753a 2066 6c6f 6174 2061  aram mu: float a
-00012910: 6e67 6c65 2069 6e20 6465 6772 6565 730d  ngle in degrees.
-00012920: 0a20 2020 203a 7265 7475 726e 3a20 5b33  .    :return: [3
-00012930: 2a33 5d20 6172 7261 790d 0a20 2020 2022  *3] array..    "
-00012940: 2222 0d0a 2020 2020 6d75 203d 206e 702e  ""..    mu = np.
-00012950: 6465 6732 7261 6428 6d75 290d 0a20 2020  deg2rad(mu)..   
-00012960: 2063 203d 206e 702e 636f 7328 6d75 290d   c = np.cos(mu).
-00012970: 0a20 2020 2073 203d 206e 702e 7369 6e28  .    s = np.sin(
-00012980: 6d75 290d 0a20 2020 2072 6574 7572 6e20  mu)..    return 
-00012990: 6e70 2e61 7272 6179 285b 5b31 2c20 302c  np.array([[1, 0,
-000129a0: 2030 5d2c 205b 302c 2063 2c20 2d73 5d2c   0], [0, c, -s],
-000129b0: 205b 302c 2073 2c20 635d 5d29 0d0a 0d0a   [0, s, c]])....
-000129c0: 0d0a 6465 6620 6469 6666 7261 6374 6f6d  ..def diffractom
-000129d0: 6574 6572 5f72 6f74 6174 696f 6e28 7068  eter_rotation(ph
-000129e0: 693d 302c 2063 6869 3d30 2c20 6574 613d  i=0, chi=0, eta=
-000129f0: 302c 206d 753d 3029 3a0d 0a20 2020 2022  0, mu=0):..    "
-00012a00: 2222 0d0a 2020 2020 4765 6e65 7261 7465  ""..    Generate
-00012a10: 2074 6865 2036 2d61 7869 7320 6469 6666   the 6-axis diff
-00012a20: 7261 636f 6d65 7465 7220 726f 7461 7469  racometer rotati
-00012a30: 6f6e 206d 6174 7269 780d 0a20 2020 2020  on matrix..     
-00012a40: 2052 203d 204d 202a 2045 202a 2058 202a   R = M * E * X *
-00012a50: 2050 0d0a 2020 2020 416c 736f 2063 616c   P..    Also cal
-00012a60: 6c65 6420 5a20 696e 2048 2e20 596f 752c  led Z in H. You,
-00012a70: 204a 2e20 4170 706c 2e20 4372 7973 7420   J. Appl. Cryst 
-00012a80: 3332 2028 3139 3939 292c 2036 3134 2d36  32 (1999), 614-6
-00012a90: 3233 0d0a 2020 2020 3a70 6172 616d 2070  23..    :param p
-00012aa0: 6869 3a20 666c 6f61 7420 616e 676c 6520  hi: float angle 
-00012ab0: 696e 2064 6567 7265 6573 0d0a 2020 2020  in degrees..    
-00012ac0: 3a70 6172 616d 2063 6869 3a20 666c 6f61  :param chi: floa
-00012ad0: 7420 616e 676c 6520 696e 2064 6567 7265  t angle in degre
-00012ae0: 6573 0d0a 2020 2020 3a70 6172 616d 2065  es..    :param e
-00012af0: 7461 3a20 666c 6f61 7420 616e 676c 6520  ta: float angle 
-00012b00: 696e 2064 6567 7265 6573 0d0a 2020 2020  in degrees..    
-00012b10: 3a70 6172 616d 206d 753a 2066 6c6f 6174  :param mu: float
-00012b20: 2061 6e67 6c65 2069 6e20 6465 6772 6565   angle in degree
-00012b30: 730d 0a20 2020 203a 7265 7475 726e 3a20  s..    :return: 
-00012b40: 205b 332a 335d 2061 7272 6179 0d0a 2020   [3*3] array..  
-00012b50: 2020 2222 220d 0a20 2020 2050 203d 2072    """..    P = r
-00012b60: 6f74 6d61 7472 6978 7a28 7068 6929 0d0a  otmatrixz(phi)..
-00012b70: 2020 2020 5820 3d20 726f 746d 6174 7269      X = rotmatri
-00012b80: 7879 2863 6869 290d 0a20 2020 2045 203d  xy(chi)..    E =
-00012b90: 2072 6f74 6d61 7472 6978 7a28 6574 6129   rotmatrixz(eta)
-00012ba0: 0d0a 2020 2020 4d20 3d20 726f 746d 6174  ..    M = rotmat
-00012bb0: 7269 7878 286d 7529 0d0a 2020 2020 7265  rixx(mu)..    re
-00012bc0: 7475 726e 206e 702e 646f 7428 4d2c 206e  turn np.dot(M, n
-00012bd0: 702e 646f 7428 452c 206e 702e 646f 7428  p.dot(E, np.dot(
-00012be0: 582c 2050 2929 290d 0a0d 0a0d 0a64 6566  X, P)))......def
-00012bf0: 2064 6966 6632 6c61 6228 7665 632c 206c   diff2lab(vec, l
-00012c00: 6162 3d4e 6f6e 6529 3a0d 0a20 2020 2022  ab=None):..    "
-00012c10: 2222 0d0a 2020 2020 436f 6e76 6572 7420  ""..    Convert 
-00012c20: 6265 7477 6565 6e20 6469 6666 7261 6374  between diffract
-00012c30: 6f6d 6574 6572 2066 7261 6d65 2061 6e64  ometer frame and
-00012c40: 206c 6162 2066 7261 6d65 0d0a 2020 2020   lab frame..    
-00012c50: 4c61 6220 6672 616d 6520 6163 636f 7264  Lab frame accord
-00012c60: 696e 6720 746f 2044 6961 6d6f 6e64 2049  ing to Diamond I
-00012c70: 3136 2062 6561 6d6c 696e 650d 0a20 2020  16 beamline..   
-00012c80: 2044 6966 6672 6163 746f 6d65 7465 7220   Diffractometer 
-00012c90: 6672 616d 6520 6163 636f 7264 696e 6720  frame according 
-00012ca0: 746f 2046 6967 2e20 312c 2048 2e20 596f  to Fig. 1, H. Yo
-00012cb0: 752c 204a 2e20 4170 706c 2e20 4372 7973  u, J. Appl. Crys
-00012cc0: 7420 3332 2028 3139 3939 292c 2036 3134  t 32 (1999), 614
-00012cd0: 2d36 3233 0d0a 2020 2020 2020 7a2d 6178  -623..      z-ax
-00012ce0: 6973 203a 2061 7869 7320 7061 7261 6c6c  is : axis parall
-00012cf0: 656c 2074 6f20 7468 6520 7068 6920 726f  el to the phi ro
-00012d00: 7461 7469 6f6e 2061 7869 7320 7768 656e  tation axis when
-00012d10: 2061 6c6c 2061 6e67 6c65 7320 3020 2874   all angles 0 (t
-00012d20: 6f77 6172 6473 2077 616c 6c20 282b 7829  owards wall (+x)
-00012d30: 2069 6e20 6c61 6220 6672 616d 6529 0d0a   in lab frame)..
-00012d40: 2020 2020 2020 782d 6178 6973 203a 2076        x-axis : v
-00012d50: 6563 746f 7220 6e6f 726d 616c 2074 6f20  ector normal to 
-00012d60: 7068 6920 6178 6973 2077 6865 7265 2070  phi axis where p
-00012d70: 6869 3d30 2028 746f 7761 7264 2063 6569  hi=0 (toward cei
-00012d80: 6c69 6e67 2028 2b79 2920 696e 206c 6162  ling (+y) in lab
-00012d90: 2066 7261 6d65 290d 0a20 2020 2020 2079   frame)..      y
-00012da0: 2d61 7869 7320 3a20 7665 6374 6f72 206e  -axis : vector n
-00012db0: 6f72 6d61 6c20 746f 2078 2c7a 2061 7865  ormal to x,z axe
-00012dc0: 7320 2870 6172 616c 6c65 6c20 746f 2062  s (parallel to b
-00012dd0: 6561 6d20 282b 7a29 2069 6e20 6c61 6220  eam (+z) in lab 
-00012de0: 6672 616d 6529 0d0a 2020 2020 3a70 6172  frame)..    :par
-00012df0: 616d 2076 6563 3a20 5b33 2a6e 5d20 6172  am vec: [3*n] ar
-00012e00: 7261 7920 6f66 2076 6563 746f 7273 0d0a  ray of vectors..
-00012e10: 2020 2020 3a70 6172 616d 206c 6162 3a20      :param lab: 
-00012e20: 5b33 2a33 5d20 7472 616e 7366 6f72 6d61  [3*3] transforma
-00012e30: 7469 6f6e 206d 6174 7269 782c 204e 6f6e  tion matrix, Non
-00012e40: 653d 2828 302c 312c 3029 2c28 302c 302c  e=((0,1,0),(0,0,
-00012e50: 3129 2c28 312c 302c 3029 290d 0a20 2020  1),(1,0,0))..   
-00012e60: 203a 7265 7475 726e 3a20 5b33 2a6e 5d20   :return: [3*n] 
-00012e70: 6172 7261 7920 6f66 2076 6563 746f 7273  array of vectors
-00012e80: 0d0a 2020 2020 2222 220d 0a20 2020 2069  ..    """..    i
-00012e90: 6620 6c61 6220 6973 204e 6f6e 653a 0d0a  f lab is None:..
-00012ea0: 2020 2020 2020 2020 6c61 6220 3d20 6e70          lab = np
-00012eb0: 2e61 7272 6179 285b 5b30 2c20 302c 2031  .array([[0, 0, 1
-00012ec0: 5d2c 205b 312c 2030 2c20 305d 2c20 5b30  ], [1, 0, 0], [0
-00012ed0: 2c20 312c 2030 5d5d 2920 2023 2028 785f  , 1, 0]])  # (x_
-00012ee0: 6c61 6220 7c7c 207a 5f64 6966 662c 2079  lab || z_diff, y
-00012ef0: 5f6c 6162 207c 7c20 785f 6469 6666 2c20  _lab || x_diff, 
-00012f00: 7a5f 6c61 6220 7c7c 2079 5f64 6966 6629  z_lab || y_diff)
-00012f10: 0d0a 2020 2020 7265 7475 726e 206e 702e  ..    return np.
-00012f20: 646f 7428 6c61 622c 206e 702e 7472 616e  dot(lab, np.tran
-00012f30: 7370 6f73 6528 7665 6329 292e 540d 0a0d  spose(vec)).T...
-00012f40: 0a0d 0a64 6566 206c 6162 7665 6374 6f72  ...def labvector
-00012f50: 2876 6563 2c20 553d 4e6f 6e65 2c20 523d  (vec, U=None, R=
-00012f60: 4e6f 6e65 2c20 4c41 423d 4e6f 6e65 293a  None, LAB=None):
-00012f70: 0d0a 2020 2020 2222 220d 0a20 2020 2054  ..    """..    T
-00012f80: 7261 6e73 666f 726d 2061 6e79 2076 6563  ransform any vec
-00012f90: 746f 7220 7468 726f 7567 6820 7468 6520  tor through the 
-00012fa0: 6f72 6965 6e74 6174 696f 6e2c 2072 6f74  orientation, rot
-00012fb0: 6174 696f 6e20 616e 6420 6c61 6220 7472  ation and lab tr
-00012fc0: 616e 7366 6f72 6d61 7469 6f6e 730d 0a20  ansformations.. 
-00012fd0: 2020 203a 7061 7261 6d20 7665 633a 205b     :param vec: [
-00012fe0: 6e2a 335d 2061 7272 6179 206f 6620 7665  n*3] array of ve
-00012ff0: 6374 6f72 7320 696e 2074 6865 2064 6966  ctors in the dif
-00013000: 6672 6163 746f 6d65 7465 7220 6672 616d  fractometer fram
-00013010: 650d 0a20 2020 203a 7061 7261 6d20 553a  e..    :param U:
-00013020: 205b 332a 335d 206f 7269 7465 6e61 7469   [3*3] oritenati
-00013030: 6f6e 206d 6174 7269 7820 2873 6565 2075  on matrix (see u
-00013040: 6d61 7472 6978 290d 0a20 2020 203a 7061  matrix)..    :pa
-00013050: 7261 6d20 523a 205b 3378 335d 2072 6f74  ram R: [3x3] rot
-00013060: 6174 696f 6e20 6d61 7472 6978 2028 7365  ation matrix (se
-00013070: 6520 6469 6666 7261 6374 6f6d 6574 6572  e diffractometer
-00013080: 5f72 6f74 6174 696f 6e29 0d0a 2020 2020  _rotation)..    
-00013090: 3a70 6172 616d 204c 4142 3a20 5b33 7833  :param LAB: [3x3
-000130a0: 5d20 7472 616e 7366 6f72 6d61 7469 6f6e  ] transformation
-000130b0: 206d 6174 7269 7820 6265 7477 6565 6e20   matrix between 
-000130c0: 6469 6666 7261 6374 6f6d 6574 6572 2066  diffractometer f
-000130d0: 7261 6d65 2061 6e64 206c 6162 2066 7261  rame and lab fra
-000130e0: 6d65 0d0a 2020 2020 3a72 6574 7572 6e3a  me..    :return:
-000130f0: 205b 6e2a 335d 2061 7272 6179 206f 6620   [n*3] array of 
-00013100: 5120 7665 6374 6f72 7320 696e 2074 6865  Q vectors in the
-00013110: 206c 6162 2063 6f6f 7264 696e 6174 6520   lab coordinate 
-00013120: 7379 7374 656d 0d0a 2020 2020 2222 220d  system..    """.
-00013130: 0a20 2020 2069 6620 5520 6973 204e 6f6e  .    if U is Non
-00013140: 653a 0d0a 2020 2020 2020 2020 5520 3d20  e:..        U = 
-00013150: 6e70 2e65 7965 2833 290d 0a20 2020 2069  np.eye(3)..    i
-00013160: 6620 5220 6973 204e 6f6e 653a 0d0a 2020  f R is None:..  
-00013170: 2020 2020 2020 5220 3d20 6e70 2e65 7965        R = np.eye
-00013180: 2833 290d 0a20 2020 2069 6620 4c41 4220  (3)..    if LAB 
-00013190: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-000131a0: 2020 4c41 4220 3d20 6e70 2e61 7272 6179    LAB = np.array
-000131b0: 285b 5b30 2c20 302c 2031 5d2c 205b 312c  ([[0, 0, 1], [1,
-000131c0: 2030 2c20 305d 2c20 5b30 2c20 312c 2030   0, 0], [0, 1, 0
-000131d0: 5d5d 2920 2023 2028 785f 6c61 6220 7c7c  ]])  # (x_lab ||
-000131e0: 207a 5f64 6966 662c 2079 5f6c 6162 207c   z_diff, y_lab |
-000131f0: 7c20 785f 6469 6666 2c20 7a5f 6c61 6220  | x_diff, z_lab 
-00013200: 7c7c 2079 5f64 6966 6629 0d0a 2020 2020  || y_diff)..    
-00013210: 7265 7475 726e 206e 702e 646f 7428 4c41  return np.dot(LA
-00013220: 422c 206e 702e 646f 7428 522c 206e 702e  B, np.dot(R, np.
-00013230: 646f 7428 552c 206e 702e 7472 616e 7370  dot(U, np.transp
-00013240: 6f73 6528 7665 6329 2929 292e 540d 0a0d  ose(vec)))).T...
-00013250: 0a0d 0a64 6566 206c 6162 7761 7665 7665  ...def labwaveve
-00013260: 6374 6f72 2868 6b6c 2c20 5556 2c20 553d  ctor(hkl, UV, U=
-00013270: 4e6f 6e65 2c20 523d 4e6f 6e65 2c20 4c41  None, R=None, LA
-00013280: 423d 4e6f 6e65 293a 0d0a 2020 2020 2222  B=None):..    ""
-00013290: 220d 0a20 2020 2043 616c 6375 6c61 7465  "..    Calculate
-000132a0: 2074 6865 206c 6162 2077 6176 6576 6563   the lab wavevec
-000132b0: 746f 7220 7573 696e 6720 7468 6520 756e  tor using the un
-000132c0: 6974 2d76 6563 746f 722c 206f 7269 7465  it-vector, orite
-000132d0: 6e61 7469 6f6e 206d 6174 7269 7820 616e  nation matrix an
-000132e0: 6420 726f 7461 7469 6f6e 206d 6174 7269  d rotation matri
-000132f0: 780d 0a20 2020 2052 6574 7572 6e73 2076  x..    Returns v
-00013300: 6563 746f 7273 2069 6e20 7468 6520 6c61  ectors in the la
-00013310: 6220 636f 6f72 6469 6e61 7465 2073 7973  b coordinate sys
-00013320: 7465 6d2c 2062 7920 6465 6661 756c 7420  tem, by default 
-00013330: 6465 6669 6e65 6420 6c69 6b65 2044 6961  defined like Dia
-00013340: 6d6f 6e64 204c 6967 6874 2053 6f75 7263  mond Light Sourc
-00013350: 653a 0d0a 2020 2020 2020 782d 6178 6973  e:..      x-axis
-00013360: 203a 2061 7761 7920 6672 6f6d 2073 796e   : away from syn
-00013370: 6368 726f 7472 6f6e 2072 696e 672c 2074  chrotron ring, t
-00013380: 6f77 6172 6473 2077 616c 6c0d 0a20 2020  owards wall..   
-00013390: 2020 2079 2d61 7869 7320 3a20 746f 7761     y-axis : towa
-000133a0: 7264 7320 6365 696c 696e 670d 0a20 2020  rds ceiling..   
-000133b0: 2020 207a 2d61 7869 7320 3a20 616c 6f6e     z-axis : alon
-000133c0: 6720 6265 616d 2064 6972 6563 7469 6f6e  g beam direction
-000133d0: 0d0a 2020 2020 3a70 6172 616d 2068 6b6c  ..    :param hkl
-000133e0: 3a20 5b33 786e 5d20 6172 7261 7920 6f66  : [3xn] array of
-000133f0: 2028 682c 206b 2c20 6c29 2072 6563 6970   (h, k, l) recip
-00013400: 726f 6361 6c20 6c61 7474 6963 6520 7665  rocal lattice ve
-00013410: 6374 6f72 730d 0a20 2020 203a 7061 7261  ctors..    :para
-00013420: 6d20 5556 3a20 5b33 2a33 5d20 556e 6974  m UV: [3*3] Unit
-00013430: 2d76 6563 746f 7220 6d61 7472 6978 2028  -vector matrix (
-00013440: 7365 6520 6c61 7470 6172 3275 625f 726f  see latpar2ub_ro
-00013450: 7429 0d0a 2020 2020 3a70 6172 616d 2055  t)..    :param U
-00013460: 3a20 5b33 2a33 5d20 6f72 6974 656e 6174  : [3*3] oritenat
-00013470: 696f 6e20 6d61 7472 6978 2028 7365 6520  ion matrix (see 
-00013480: 756d 6174 7269 7829 0d0a 2020 2020 3a70  umatrix)..    :p
-00013490: 6172 616d 2052 3a20 5b33 7833 5d20 726f  aram R: [3x3] ro
-000134a0: 7461 7469 6f6e 206d 6174 7269 7820 2873  tation matrix (s
-000134b0: 6565 2064 6966 6672 6163 746f 6d65 7465  ee diffractomete
-000134c0: 725f 726f 7461 7469 6f6e 290d 0a20 2020  r_rotation)..   
-000134d0: 203a 7061 7261 6d20 4c41 423a 205b 3378   :param LAB: [3x
-000134e0: 335d 2074 7261 6e73 666f 726d 6174 696f  3] transformatio
-000134f0: 6e20 6d61 7472 6978 2062 6574 7765 656e  n matrix between
-00013500: 2064 6966 6672 6163 746f 6d65 7465 7220   diffractometer 
-00013510: 6672 616d 6520 616e 6420 6c61 6220 6672  frame and lab fr
-00013520: 616d 650d 0a20 2020 203a 7265 7475 726e  ame..    :return
-00013530: 3a20 5b33 786e 5d20 6172 7261 7920 6f66  : [3xn] array of
-00013540: 2051 2076 6563 746f 7273 2069 6e20 7468   Q vectors in th
-00013550: 6520 6c61 6220 636f 6f72 6469 6e61 7465  e lab coordinate
-00013560: 2073 7973 7465 6d0d 0a20 2020 2022 2222   system..    """
-00013570: 0d0a 2020 2020 6966 2055 2069 7320 4e6f  ..    if U is No
-00013580: 6e65 3a0d 0a20 2020 2020 2020 2055 203d  ne:..        U =
-00013590: 206e 702e 6579 6528 3329 0d0a 2020 2020   np.eye(3)..    
-000135a0: 6966 2052 2069 7320 4e6f 6e65 3a0d 0a20  if R is None:.. 
-000135b0: 2020 2020 2020 2052 203d 206e 702e 6579         R = np.ey
-000135c0: 6528 3329 0d0a 2020 2020 6966 204c 4142  e(3)..    if LAB
-000135d0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000135e0: 2020 204c 4142 203d 206e 702e 6172 7261     LAB = np.arra
-000135f0: 7928 5b5b 302c 2030 2c20 315d 2c20 5b31  y([[0, 0, 1], [1
-00013600: 2c20 302c 2030 5d2c 205b 302c 2031 2c20  , 0, 0], [0, 1, 
-00013610: 305d 5d29 2020 2320 2878 5f6c 6162 207c  0]])  # (x_lab |
-00013620: 7c20 7a5f 6469 6666 2c20 795f 6c61 6220  | z_diff, y_lab 
-00013630: 7c7c 2078 5f64 6966 662c 207a 5f6c 6162  || x_diff, z_lab
-00013640: 207c 7c20 795f 6469 6666 290d 0a20 2020   || y_diff)..   
-00013650: 2042 203d 2042 6d61 7472 6978 2855 5629   B = Bmatrix(UV)
-00013660: 0d0a 2020 2020 7265 7475 726e 206e 702e  ..    return np.
-00013670: 646f 7428 4c41 422c 206e 702e 646f 7428  dot(LAB, np.dot(
-00013680: 522c 206e 702e 646f 7428 552c 206e 702e  R, np.dot(U, np.
-00013690: 646f 7428 422c 206e 702e 7472 616e 7370  dot(B, np.transp
-000136a0: 6f73 6528 686b 6c29 2929 2929 2e54 0d0a  ose(hkl))))).T..
-000136b0: 0d0a 0d0a 6465 6620 6469 6666 3663 6972  ....def diff6cir
-000136c0: 636c 6571 2864 656c 7461 2c20 6761 6d6d  cleq(delta, gamm
-000136d0: 612c 2065 6e65 7267 795f 6b65 763d 4e6f  a, energy_kev=No
-000136e0: 6e65 2c20 7761 7665 6c65 6e67 7468 3d31  ne, wavelength=1
-000136f0: 2e30 2c20 6c61 623d 4e6f 6e65 293a 0d0a  .0, lab=None):..
-00013700: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
-00013710: 6375 616c 7465 2077 6176 6576 6563 746f  cualte wavevecto
-00013720: 7220 696e 2064 6966 6672 6163 746f 6d65  r in diffractome
-00013730: 7465 7220 6178 6973 2075 7369 6e67 2064  ter axis using d
-00013740: 6574 6563 746f 7220 616e 676c 6573 0d0a  etector angles..
-00013750: 2020 2020 3a70 6172 616d 2064 656c 7461      :param delta
-00013760: 3a20 666c 6f61 7420 616e 676c 6520 696e  : float angle in
-00013770: 2064 6567 7265 6573 2069 6e20 7665 7274   degrees in vert
-00013780: 6963 616c 2064 6972 6563 7469 6f6e 2028  ical direction (
-00013790: 6162 6f75 7420 6469 6666 2d7a 290d 0a20  about diff-z).. 
-000137a0: 2020 203a 7061 7261 6d20 6761 6d6d 613a     :param gamma:
-000137b0: 2066 6c6f 6174 2061 6e67 6c65 2069 6e20   float angle in 
-000137c0: 6465 6772 6565 7320 696e 2068 6f72 697a  degrees in horiz
-000137d0: 6f6e 7461 6c20 6469 7265 6374 696f 6e20  ontal direction 
-000137e0: 2861 626f 7574 2064 6966 662d 7829 0d0a  (about diff-x)..
-000137f0: 2020 2020 3a70 6172 616d 2065 6e65 7267      :param energ
-00013800: 795f 6b65 763a 2066 6c6f 6174 2065 6e65  y_kev: float ene
-00013810: 7267 7920 696e 204b 6556 0d0a 2020 2020  rgy in KeV..    
-00013820: 3a70 6172 616d 2077 6176 656c 656e 6774  :param wavelengt
-00013830: 683a 2066 6c6f 6174 2077 6176 656c 656e  h: float wavelen
-00013840: 6774 6820 696e 2041 0d0a 2020 2020 3a70  gth in A..    :p
-00013850: 6172 616d 206c 6162 3a20 5b33 2a33 5d20  aram lab: [3*3] 
-00013860: 6c61 6220 7472 616e 7366 6f72 6d61 7469  lab transformati
-00013870: 6f6e 206d 6174 7269 780d 0a20 2020 203a  on matrix..    :
-00013880: 7265 7475 726e 3a20 5b31 2a33 5d0d 0a20  return: [1*3].. 
-00013890: 2020 2022 2222 0d0a 2020 2020 6966 2065     """..    if e
-000138a0: 6e65 7267 795f 6b65 7620 6973 206e 6f74  nergy_kev is not
-000138b0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000138c0: 7761 7665 6c65 6e67 7468 203d 2065 6e65  wavelength = ene
-000138d0: 7267 7932 7761 7665 2865 6e65 7267 795f  rgy2wave(energy_
-000138e0: 6b65 7629 0d0a 0d0a 2020 2020 6b20 3d20  kev)....    k = 
-000138f0: 3220 2a20 6e70 2e70 6920 2f20 7761 7665  2 * np.pi / wave
-00013900: 6c65 6e67 7468 0d0a 2020 2020 6465 6c74  length..    delt
-00013910: 6120 3d20 6e70 2e64 6567 3272 6164 2864  a = np.deg2rad(d
-00013920: 656c 7461 290d 0a20 2020 2067 616d 6d61  elta)..    gamma
-00013930: 203d 206e 702e 6465 6732 7261 6428 6761   = np.deg2rad(ga
-00013940: 6d6d 6129 0d0a 2020 2020 7364 203d 206e  mma)..    sd = n
-00013950: 702e 7369 6e28 6465 6c74 6129 0d0a 2020  p.sin(delta)..  
-00013960: 2020 6364 203d 206e 702e 636f 7328 6465    cd = np.cos(de
-00013970: 6c74 6129 0d0a 2020 2020 7367 203d 206e  lta)..    sg = n
-00013980: 702e 7369 6e28 6761 6d6d 6129 0d0a 2020  p.sin(gamma)..  
-00013990: 2020 6367 203d 206e 702e 636f 7328 6761    cg = np.cos(ga
-000139a0: 6d6d 6129 0d0a 2020 2020 7265 7475 726e  mma)..    return
-000139b0: 2064 6966 6632 6c61 6228 6b20 2a20 6e70   diff2lab(k * np
-000139c0: 2e61 7272 6179 285b 7364 2c20 6364 202a  .array([sd, cd *
-000139d0: 2063 6720 2d20 312c 2063 6420 2a20 7367   cg - 1, cd * sg
-000139e0: 5d29 2c20 6c61 6229 0d0a 0d0a 0d0a 6465  ]), lab)......de
-000139f0: 6620 6469 6666 3663 6972 636c 656b 2864  f diff6circlek(d
-00013a00: 656c 7461 2c20 6761 6d6d 612c 2065 6e65  elta, gamma, ene
-00013a10: 7267 795f 6b65 763d 4e6f 6e65 2c20 7761  rgy_kev=None, wa
-00013a20: 7665 6c65 6e67 7468 3d31 2e30 2c20 6c61  velength=1.0, la
-00013a30: 623d 4e6f 6e65 293a 0d0a 2020 2020 2222  b=None):..    ""
-00013a40: 220d 0a20 2020 2043 616c 6375 616c 7465  "..    Calcualte
-00013a50: 2069 6e63 6964 656e 7420 616e 6420 6669   incident and fi
-00013a60: 6e61 6c20 7761 7665 7665 6374 6f72 7320  nal wavevectors 
-00013a70: 696e 2064 6966 6672 6163 746f 6d65 7465  in diffractomete
-00013a80: 7220 6178 6973 2075 7369 6e67 2064 6574  r axis using det
-00013a90: 6563 746f 7220 616e 676c 6573 0d0a 2020  ector angles..  
-00013aa0: 2020 3a70 6172 616d 2064 656c 7461 3a20    :param delta: 
-00013ab0: 666c 6f61 7420 616e 676c 6520 696e 2064  float angle in d
-00013ac0: 6567 7265 6573 2069 6e20 7665 7274 6963  egrees in vertic
-00013ad0: 616c 2064 6972 6563 7469 6f6e 2028 6162  al direction (ab
-00013ae0: 6f75 7420 6469 6666 2d7a 290d 0a20 2020  out diff-z)..   
-00013af0: 203a 7061 7261 6d20 6761 6d6d 613a 2066   :param gamma: f
-00013b00: 6c6f 6174 2061 6e67 6c65 2069 6e20 6465  loat angle in de
-00013b10: 6772 6565 7320 696e 2068 6f72 697a 6f6e  grees in horizon
-00013b20: 7461 6c20 6469 7265 6374 696f 6e20 2861  tal direction (a
-00013b30: 626f 7574 2064 6966 662d 7829 0d0a 2020  bout diff-x)..  
-00013b40: 2020 3a70 6172 616d 2065 6e65 7267 795f    :param energy_
-00013b50: 6b65 763a 2066 6c6f 6174 2065 6e65 7267  kev: float energ
-00013b60: 7920 696e 204b 6556 0d0a 2020 2020 3a70  y in KeV..    :p
-00013b70: 6172 616d 2077 6176 656c 656e 6774 683a  aram wavelength:
-00013b80: 2066 6c6f 6174 2077 6176 656c 656e 6774   float wavelengt
-00013b90: 6820 696e 2041 0d0a 2020 2020 3a70 6172  h in A..    :par
-00013ba0: 616d 206c 6162 3a20 5b33 2a33 5d20 6c61  am lab: [3*3] la
-00013bb0: 6220 7472 616e 7366 6f72 6d61 7469 6f6e  b transformation
-00013bc0: 206d 6174 7269 780d 0a20 2020 203a 7265   matrix..    :re
-00013bd0: 7475 726e 3a20 5b31 2a33 5d2c 205b 312a  turn: [1*3], [1*
-00013be0: 335d 203a 206b 692c 206b 660d 0a20 2020  3] : ki, kf..   
-00013bf0: 2022 2222 0d0a 2020 2020 6966 2065 6e65   """..    if ene
-00013c00: 7267 795f 6b65 7620 6973 206e 6f74 204e  rgy_kev is not N
-00013c10: 6f6e 653a 0d0a 2020 2020 2020 2020 7761  one:..        wa
-00013c20: 7665 6c65 6e67 7468 203d 2065 6e65 7267  velength = energ
-00013c30: 7932 7761 7665 2865 6e65 7267 795f 6b65  y2wave(energy_ke
-00013c40: 7629 0d0a 0d0a 2020 2020 6b20 3d20 3220  v)....    k = 2 
-00013c50: 2a20 6e70 2e70 6920 2f20 7761 7665 6c65  * np.pi / wavele
-00013c60: 6e67 7468 0d0a 2020 2020 2320 7120 3d20  ngth..    # q = 
-00013c70: 6b66 202d 206b 690d 0a20 2020 2071 203d  kf - ki..    q =
-00013c80: 2064 6966 6636 6369 7263 6c65 7128 6465   diff6circleq(de
-00013c90: 6c74 612c 2067 616d 6d61 2c20 656e 6572  lta, gamma, ener
-00013ca0: 6779 5f6b 6576 2c20 7761 7665 6c65 6e67  gy_kev, waveleng
-00013cb0: 7468 2c20 6c61 6229 0d0a 2020 2020 6b69  th, lab)..    ki
-00013cc0: 203d 206b 202a 2064 6966 6632 6c61 6228   = k * diff2lab(
-00013cd0: 5b30 2c20 312c 2030 5d2c 206c 6162 290d  [0, 1, 0], lab).
-00013ce0: 0a20 2020 206b 6620 3d20 7120 2b20 6b69  .    kf = q + ki
-00013cf0: 0d0a 2020 2020 7265 7475 726e 206b 692c  ..    return ki,
-00013d00: 206b 660d 0a0d 0a0d 0a64 6566 2064 6966   kf......def dif
-00013d10: 6636 6369 7263 6c65 3268 6b6c 2875 622c  f6circle2hkl(ub,
-00013d20: 2070 6869 3d30 2c20 6368 693d 302c 2065   phi=0, chi=0, e
-00013d30: 7461 3d30 2c20 6d75 3d30 2c20 6465 6c74  ta=0, mu=0, delt
-00013d40: 613d 302c 2067 616d 6d61 3d30 2c20 656e  a=0, gamma=0, en
-00013d50: 6572 6779 5f6b 6576 3d4e 6f6e 652c 2077  ergy_kev=None, w
-00013d60: 6176 656c 656e 6774 683d 312e 302c 206c  avelength=1.0, l
-00013d70: 6162 3d4e 6f6e 6529 3a0d 0a20 2020 2022  ab=None):..    "
-00013d80: 2222 0d0a 2020 2020 5265 7475 726e 205b  ""..    Return [
-00013d90: 682c 6b2c 6c5d 2070 6f73 6974 696f 6e20  h,k,l] position 
-00013da0: 6f66 2064 6966 6672 6163 746f 6d65 7465  of diffractomete
-00013db0: 7220 6178 6573 2077 6974 6820 6769 7665  r axes with give
-00013dc0: 6e20 5542 2061 6e64 2065 6e65 7267 790d  n UB and energy.
-00013dd0: 0a20 2020 203a 7061 7261 6d20 7562 3a20  .    :param ub: 
-00013de0: 5b33 2a33 5d20 6172 7261 7920 5542 206f  [3*3] array UB o
-00013df0: 7269 656e 7461 7469 6f6e 206d 6174 7269  rientation matri
-00013e00: 7820 666f 6c6c 6f77 696e 6720 4275 7369  x following Busi
-00013e10: 6e67 2026 204c 6576 790d 0a20 2020 203a  ng & Levy..    :
-00013e20: 7061 7261 6d20 7068 693a 2066 6c6f 6174  param phi: float
-00013e30: 2073 616d 706c 6520 616e 676c 6520 696e   sample angle in
-00013e40: 2064 6567 7265 6573 0d0a 2020 2020 3a70   degrees..    :p
-00013e50: 6172 616d 2063 6869 3a20 666c 6f61 7420  aram chi: float 
-00013e60: 7361 6d70 6c65 2061 6e67 6c65 2069 6e20  sample angle in 
-00013e70: 6465 6772 6565 730d 0a20 2020 203a 7061  degrees..    :pa
-00013e80: 7261 6d20 6574 613a 2066 6c6f 6174 2073  ram eta: float s
-00013e90: 616d 706c 6520 616e 676c 6520 696e 2064  ample angle in d
-00013ea0: 6567 7265 6573 0d0a 2020 2020 3a70 6172  egrees..    :par
-00013eb0: 616d 206d 753a 2066 6c6f 6174 2073 616d  am mu: float sam
-00013ec0: 706c 6520 616e 676c 6520 696e 2064 6567  ple angle in deg
-00013ed0: 7265 6573 0d0a 2020 2020 3a70 6172 616d  rees..    :param
-00013ee0: 2064 656c 7461 3a20 666c 6f61 7420 6465   delta: float de
-00013ef0: 7465 6374 6f72 2061 6e67 6c65 2069 6e20  tector angle in 
-00013f00: 6465 6772 6565 730d 0a20 2020 203a 7061  degrees..    :pa
-00013f10: 7261 6d20 6761 6d6d 613a 2066 6c6f 6174  ram gamma: float
-00013f20: 2064 6574 6563 746f 7220 616e 676c 6520   detector angle 
-00013f30: 696e 2064 6567 7265 6573 0d0a 2020 2020  in degrees..    
-00013f40: 3a70 6172 616d 2065 6e65 7267 795f 6b65  :param energy_ke
-00013f50: 763a 2066 6c6f 6174 2065 6e65 7267 7920  v: float energy 
-00013f60: 696e 204b 6556 0d0a 2020 2020 3a70 6172  in KeV..    :par
-00013f70: 616d 2077 6176 656c 656e 6774 683a 2066  am wavelength: f
-00013f80: 6c6f 6174 2077 6176 656c 656e 6774 6820  loat wavelength 
-00013f90: 696e 2041 0d0a 2020 2020 3a70 6172 616d  in A..    :param
-00013fa0: 206c 6162 3a20 5b33 2a33 5d20 6c61 6220   lab: [3*3] lab 
-00013fb0: 7472 616e 7366 6f72 6d61 7469 6f6e 206d  transformation m
-00013fc0: 6174 7269 780d 0a20 2020 203a 7265 7475  atrix..    :retu
-00013fd0: 726e 3a20 5b68 2c6b 2c6c 5d0d 0a20 2020  rn: [h,k,l]..   
-00013fe0: 2022 2222 0d0a 2020 2020 7120 3d20 6469   """..    q = di
-00013ff0: 6666 3663 6972 636c 6571 2864 656c 7461  ff6circleq(delta
-00014000: 2c20 6761 6d6d 612c 2065 6e65 7267 795f  , gamma, energy_
-00014010: 6b65 762c 2077 6176 656c 656e 6774 682c  kev, wavelength,
-00014020: 206c 6162 2920 2023 2059 6f75 2051 6c20   lab)  # You Ql 
-00014030: 2831 3229 0d0a 2020 2020 7a20 3d20 6469  (12)..    z = di
-00014040: 6666 7261 6374 6f6d 6574 6572 5f72 6f74  ffractometer_rot
-00014050: 6174 696f 6e28 7068 692c 2063 6869 2c20  ation(phi, chi, 
-00014060: 6574 612c 206d 7529 2020 2320 596f 7520  eta, mu)  # You 
-00014070: 5a20 2831 3329 0d0a 0d0a 2020 2020 696e  Z (13)....    in
-00014080: 765f 7562 203d 206e 702e 6c69 6e61 6c67  v_ub = np.linalg
-00014090: 2e69 6e76 2875 6229 0d0a 2020 2020 696e  .inv(ub)..    in
-000140a0: 765f 7a20 3d20 6e70 2e6c 696e 616c 672e  v_z = np.linalg.
-000140b0: 696e 7628 7a29 0d0a 0d0a 2020 2020 6870  inv(z)....    hp
-000140c0: 6869 203d 206e 702e 646f 7428 696e 765f  hi = np.dot(inv_
-000140d0: 7a2c 2071 290d 0a20 2020 2072 6574 7572  z, q)..    retur
-000140e0: 6e20 6e70 2e64 6f74 2869 6e76 5f75 622c  n np.dot(inv_ub,
-000140f0: 2068 7068 6929 2e54 0d0a 0d0a 0d0a 6465   hphi).T......de
-00014100: 6620 6d61 7848 4b4c 2851 6d61 782c 2055  f maxHKL(Qmax, U
-00014110: 5629 3a0d 0a20 2020 2022 2222 0d0a 2020  V):..    """..  
-00014120: 2020 5265 7475 726e 7320 7468 6520 6d61    Returns the ma
-00014130: 7869 6d75 6d20 696e 6465 7865 7320 666f  ximum indexes fo
-00014140: 7220 6769 7665 6e20 6d61 7820 7261 6469  r given max radi
-00014150: 7573 0d0a 2020 2020 652e 672e 0d0a 2020  us..    e.g...  
-00014160: 2020 2020 2020 5556 7374 6172 203d 2052        UVstar = R
-00014170: 6353 7028 5b5b 332c 302c 305d 2c5b 302c  cSp([[3,0,0],[0,
-00014180: 332c 305d 2c5b 302c 302c 3130 5d5d 2920  3,0],[0,0,10]]) 
-00014190: 2320 415e 2d31 0d0a 2020 2020 2020 2020  # A^-1..        
-000141a0: 516d 6178 203d 2034 2e35 2023 2041 5e2d  Qmax = 4.5 # A^-
-000141b0: 310d 0a20 2020 2020 2020 206d 6178 5f68  1..        max_h
-000141c0: 6b6c 203d 206d 6178 484b 4c28 516d 6178  kl = maxHKL(Qmax
-000141d0: 2c55 5673 7461 7229 0d0a 2020 2020 2020  ,UVstar)..      
-000141e0: 2020 6d61 785f 686b 6c20 3d0d 0a20 2020    max_hkl =..   
-000141f0: 2020 2020 203e 3e3e 205b 332c 332c 385d       >>> [3,3,8]
-00014200: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
-00014210: 2051 706f 7320 3d20 5b5b 516d 6178 2c20   Qpos = [[Qmax, 
-00014220: 516d 6178 2c20 516d 6178 5d2c 0d0a 2020  Qmax, Qmax],..  
-00014230: 2020 2020 2020 2020 2020 5b2d 516d 6178            [-Qmax
-00014240: 2c20 516d 6178 2c20 516d 6178 5d2c 0d0a  , Qmax, Qmax],..
-00014250: 2020 2020 2020 2020 2020 2020 5b51 6d61              [Qma
-00014260: 782c 202d 516d 6178 2c20 516d 6178 5d2c  x, -Qmax, Qmax],
-00014270: 0d0a 2020 2020 2020 2020 2020 2020 5b2d  ..            [-
-00014280: 516d 6178 2c20 2d51 6d61 782c 2051 6d61  Qmax, -Qmax, Qma
-00014290: 785d 2c0d 0a20 2020 2020 2020 2020 2020  x],..           
-000142a0: 205b 516d 6178 2c20 516d 6178 2c20 2d51   [Qmax, Qmax, -Q
-000142b0: 6d61 785d 2c0d 0a20 2020 2020 2020 2020  max],..         
-000142c0: 2020 205b 2d51 6d61 782c 2051 6d61 782c     [-Qmax, Qmax,
-000142d0: 202d 516d 6178 5d2c 0d0a 2020 2020 2020   -Qmax],..      
-000142e0: 2020 2020 2020 5b51 6d61 782c 202d 516d        [Qmax, -Qm
-000142f0: 6178 2c20 2d51 6d61 785d 2c0d 0a20 2020  ax, -Qmax],..   
-00014300: 2020 2020 2020 2020 205b 2d51 6d61 782c           [-Qmax,
-00014310: 202d 516d 6178 2c20 2d51 6d61 785d 5d0d   -Qmax, -Qmax]].
-00014320: 0a20 2020 2068 6b6c 203d 2069 6e64 7828  .    hkl = indx(
-00014330: 5170 6f73 2c20 5556 290d 0a20 2020 2072  Qpos, UV)..    r
-00014340: 6574 7572 6e20 6e70 2e63 6569 6c28 6e70  eturn np.ceil(np
-00014350: 2e61 6273 2868 6b6c 292e 6d61 7828 6178  .abs(hkl).max(ax
-00014360: 6973 3d30 2929 2e61 7374 7970 6528 696e  is=0)).astype(in
-00014370: 7429 0d0a 0d0a 0d0a 6465 6620 6765 6e48  t)......def genH
-00014380: 4b4c 2848 2c20 4b3d 4e6f 6e65 2c20 4c3d  KL(H, K=None, L=
-00014390: 4e6f 6e65 293a 0d0a 2020 2020 2222 220d  None):..    """.
-000143a0: 0a20 2020 2047 656e 6572 6174 6520 484b  .    Generate HK
-000143b0: 4c20 6172 7261 7920 7769 7468 2061 6c6c  L array with all
-000143c0: 2063 6f6d 6269 6e61 7469 6f6e 7320 7769   combinations wi
-000143d0: 7468 696e 2072 616e 6765 2073 7065 6369  thin range speci
-000143e0: 6669 6564 0d0a 2020 2020 5573 6167 653a  fied..    Usage:
-000143f0: 0d0a 2020 2020 2020 484b 4c20 3d20 6765  ..      HKL = ge
-00014400: 6e48 4b4c 286d 6178 290d 0a20 2020 2020  nHKL(max)..     
-00014410: 2020 696e 7420 6d61 7820 3d20 6765 6e65    int max = gene
-00014420: 7261 7465 7320 6561 6368 2068 2c6b 2c6c  rates each h,k,l
-00014430: 2066 726f 6d20 2d6d 6178 2074 6f20 6d61   from -max to ma
-00014440: 780d 0a20 2020 2020 2048 4b4c 203d 2067  x..      HKL = g
-00014450: 656e 484b 4c28 5b6d 696e 2c6d 6178 5d29  enHKL([min,max])
-00014460: 0d0a 2020 2020 2020 2069 6e74 206d 696e  ..       int min
-00014470: 2c20 696e 7420 6d61 7820 3d20 6765 6e65  , int max = gene
-00014480: 7261 7465 7320 682c 6c2c 6c20 6672 6f6d  rates h,l,l from
-00014490: 206d 696e 2074 6f20 6d61 780d 0a20 2020   min to max..   
-000144a0: 2020 2048 4b4c 203d 2067 656e 484b 4c28     HKL = genHKL(
-000144b0: 5b68 6d69 6e2c 686d 6178 5d2c 5b6b 6d69  [hmin,hmax],[kmi
-000144c0: 6e2c 6b6d 6178 5d2c 5b6c 6d69 6e2c 6c6d  n,kmax],[lmin,lm
-000144d0: 6178 5d29 0d0a 2020 2020 2020 2068 6d69  ax])..       hmi
-000144e0: 6e2c 686d 6178 203d 206d 696e 2061 6e64  n,hmax = min and
-000144f0: 206d 6178 2076 616c 7565 7320 666f 7220   max values for 
-00014500: 682c 206b 2061 6e64 206c 2072 6573 7065  h, k and l respe
-00014510: 6374 6976 6c65 790d 0a0d 0a20 2020 2020  ctivley....     
-00014520: 2061 7272 6179 2048 4b4c 203d 205b 5b6e   array HKL = [[n
-00014530: 7833 5d5d 2061 7272 6179 206f 6620 5b68  x3]] array of [h
-00014540: 2c6b 2c6c 5d20 7665 6374 6f72 730d 0a0d  ,k,l] vectors...
-00014550: 0a20 2020 2045 2e47 2e0d 0a20 2020 2020  .    E.G...     
-00014560: 2048 4b4c 203d 2067 656e 484b 4c28 2d33   HKL = genHKL(-3
-00014570: 290d 0a20 2020 2045 2e47 2e0d 0a20 2020  )..    E.G...   
-00014580: 2020 2048 4b4c 203d 2067 656e 484b 4c28     HKL = genHKL(
-00014590: 5b2d 312c 315d 290d 0a20 2020 2045 2e47  [-1,1])..    E.G
-000145a0: 2e0d 0a20 2020 2020 2048 4b4c 203d 2067  ...      HKL = g
-000145b0: 656e 484b 4c28 5b2d 322c 325d 2c5b 302c  enHKL([-2,2],[0,
-000145c0: 335d 2c5b 312c 315d 290d 0a20 2020 2022  3],[1,1])..    "
-000145d0: 2222 0d0a 0d0a 2020 2020 6966 204b 2069  ""....    if K i
-000145e0: 7320 4e6f 6e65 3a20 4b20 3d20 480d 0a20  s None: K = H.. 
-000145f0: 2020 2069 6620 4c20 6973 204e 6f6e 653a     if L is None:
-00014600: 204c 203d 2048 0d0a 0d0a 2020 2020 4820   L = H....    H 
-00014610: 3d20 6e70 2e61 7361 7272 6179 2848 290d  = np.asarray(H).
-00014620: 0a20 2020 204b 203d 206e 702e 6173 6172  .    K = np.asar
-00014630: 7261 7928 4b29 0d0a 2020 2020 4c20 3d20  ray(K)..    L = 
-00014640: 6e70 2e61 7361 7272 6179 284c 290d 0a0d  np.asarray(L)...
-00014650: 0a20 2020 2069 6620 482e 7369 7a65 203d  .    if H.size =
-00014660: 3d20 313a 0d0a 2020 2020 2020 2020 4820  = 1:..        H 
-00014670: 3d20 6e70 2e61 7272 6179 285b 482c 202d  = np.array([H, -
-00014680: 485d 290d 0a20 2020 2069 6620 4b2e 7369  H])..    if K.si
-00014690: 7a65 203d 3d20 313a 0d0a 2020 2020 2020  ze == 1:..      
-000146a0: 2020 4b20 3d20 6e70 2e61 7272 6179 285b    K = np.array([
-000146b0: 4b2c 202d 4b5d 290d 0a20 2020 2069 6620  K, -K])..    if 
-000146c0: 4c2e 7369 7a65 203d 3d20 313a 0d0a 2020  L.size == 1:..  
-000146d0: 2020 2020 2020 4c20 3d20 6e70 2e61 7272        L = np.arr
-000146e0: 6179 285b 4c2c 202d 4c5d 290d 0a0d 0a20  ay([L, -L]).... 
-000146f0: 2020 2069 6620 485b 305d 203e 2048 5b31     if H[0] > H[1
-00014700: 5d3a 0d0a 2020 2020 2020 2020 4873 7465  ]:..        Hste
-00014710: 7020 3d20 2d31 0d0a 2020 2020 656c 7365  p = -1..    else
-00014720: 3a0d 0a20 2020 2020 2020 2048 7374 6570  :..        Hstep
-00014730: 203d 2031 0d0a 2020 2020 6966 204b 5b30   = 1..    if K[0
-00014740: 5d20 3e20 4b5b 315d 3a0d 0a20 2020 2020  ] > K[1]:..     
-00014750: 2020 204b 7374 6570 203d 202d 310d 0a20     Kstep = -1.. 
-00014760: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00014770: 2020 4b73 7465 7020 3d20 312e 300d 0a20    Kstep = 1.0.. 
-00014780: 2020 2069 6620 4c5b 305d 203e 204c 5b31     if L[0] > L[1
-00014790: 5d3a 0d0a 2020 2020 2020 2020 4c73 7465  ]:..        Lste
-000147a0: 7020 3d20 2d31 2e30 0d0a 2020 2020 656c  p = -1.0..    el
-000147b0: 7365 3a0d 0a20 2020 2020 2020 204c 7374  se:..        Lst
-000147c0: 6570 203d 2031 2e30 0d0a 0d0a 2020 2020  ep = 1.0....    
-000147d0: 4872 616e 6765 203d 206e 702e 6172 616e  Hrange = np.aran
-000147e0: 6765 2848 5b30 5d2c 2048 5b31 5d20 2b20  ge(H[0], H[1] + 
-000147f0: 4873 7465 702c 2048 7374 6570 290d 0a20  Hstep, Hstep).. 
-00014800: 2020 204b 7261 6e67 6520 3d20 6e70 2e61     Krange = np.a
-00014810: 7261 6e67 6528 4b5b 305d 2c20 4b5b 315d  range(K[0], K[1]
-00014820: 202b 204b 7374 6570 2c20 4b73 7465 7029   + Kstep, Kstep)
-00014830: 0d0a 2020 2020 4c72 616e 6765 203d 206e  ..    Lrange = n
-00014840: 702e 6172 616e 6765 284c 5b30 5d2c 204c  p.arange(L[0], L
-00014850: 5b31 5d20 2b20 4c73 7465 702c 2048 7374  [1] + Lstep, Hst
-00014860: 6570 290d 0a20 2020 204b 4b2c 2048 482c  ep)..    KK, HH,
-00014870: 204c 4c20 3d20 6e70 2e6d 6573 6867 7269   LL = np.meshgri
-00014880: 6428 4b72 616e 6765 2c20 4872 616e 6765  d(Krange, Hrange
-00014890: 2c20 4c72 616e 6765 290d 0a0d 0a20 2020  , Lrange)....   
-000148a0: 2072 6574 7572 6e20 6e70 2e61 7361 7272   return np.asarr
-000148b0: 6179 285b 4848 2e72 6176 656c 2829 2c20  ay([HH.ravel(), 
-000148c0: 4b4b 2e72 6176 656c 2829 2c20 4c4c 2e72  KK.ravel(), LL.r
-000148d0: 6176 656c 2829 5d2c 2064 7479 7065 3d69  avel()], dtype=i
-000148e0: 6e74 292e 540d 0a0d 0a0d 0a64 6566 2066  nt).T......def f
-000148f0: 6974 696e 6365 6c6c 2875 7677 293a 0d0a  itincell(uvw):..
-00014900: 2020 2020 2222 220d 0a20 2020 2053 6574      """..    Set
-00014910: 2061 6c6c 2066 7261 6374 696f 6e61 6c20   all fractional 
-00014920: 636f 6f64 696e 6174 6573 2062 6574 7765  coodinates betwe
-00014930: 656e 2030 2061 6e64 2031 0d0a 2020 2020  en 0 and 1..    
-00014940: 5573 6167 653a 0d0a 2020 2020 2020 7576  Usage:..      uv
-00014950: 7720 3d20 6669 7469 6e63 656c 6c28 7576  w = fitincell(uv
-00014960: 7729 0d0a 2020 2020 2020 7576 7720 3d20  w)..      uvw = 
-00014970: 5b5b 6e78 335d 5d20 6172 7261 7920 6f66  [[nx3]] array of
-00014980: 2066 7261 6374 696f 6e61 6c20 7665 6374   fractional vect
-00014990: 6f72 7320 5b75 2c76 2c77 5d0d 0a20 2020  ors [u,v,w]..   
-000149a0: 2022 2222 0d0a 2020 2020 7768 696c 6520   """..    while 
-000149b0: 6e70 2e61 6e79 2875 7677 203e 2030 2e39  np.any(uvw > 0.9
-000149c0: 3929 206f 7220 6e70 2e61 6e79 2875 7677  9) or np.any(uvw
-000149d0: 203c 202d 302e 3031 293a 0d0a 2020 2020   < -0.01):..    
-000149e0: 2020 2020 7576 775b 7576 7720 3e20 302e      uvw[uvw > 0.
-000149f0: 3939 5d20 3d20 7576 775b 7576 7720 3e20  99] = uvw[uvw > 
-00014a00: 302e 3939 5d20 2d20 312e 0d0a 2020 2020  0.99] - 1...    
-00014a10: 2020 2020 7576 775b 7576 7720 3c20 2d30      uvw[uvw < -0
-00014a20: 2e30 315d 203d 2075 7677 5b75 7677 203c  .01] = uvw[uvw <
-00014a30: 202d 302e 3031 5d20 2b20 312e 0d0a 2020   -0.01] + 1...  
-00014a40: 2020 7265 7475 726e 2075 7677 0d0a 0d0a    return uvw....
-00014a50: 0d0a 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ..'-------------
-00014a60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 5379  --------------Sy
-00014a70: 6d6d 6574 7279 2d2d 2d2d 2d2d 2d2d 2d2d  mmetry----------
-00014a80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00014a90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 0d0a 0d0a  -----------'....
-00014aa0: 0d0a 6465 6620 6765 6e5f 7379 6d5f 706f  ..def gen_sym_po
-00014ab0: 7328 7379 6d5f 6f70 732c 2078 2c20 792c  s(sym_ops, x, y,
-00014ac0: 207a 293a 0d0a 2020 2020 2222 220d 0a20   z):..    """.. 
-00014ad0: 2020 2047 656e 6572 6174 6520 706f 7369     Generate posi
-00014ae0: 7469 6f6e 7320 6672 6f6d 2073 796d 6d65  tions from symme
-00014af0: 7472 7920 6f70 6572 6174 696f 6e73 0d0a  try operations..
-00014b00: 2020 2020 5573 6167 653a 0d0a 2020 2020      Usage:..    
-00014b10: 2020 7576 7720 3d20 6765 6e5f 7379 6d5f    uvw = gen_sym_
-00014b20: 706f 7328 7379 6d5f 6f70 732c 782c 792c  pos(sym_ops,x,y,
-00014b30: 7a29 0d0a 2020 2020 2020 7379 6d5f 6f70  z)..      sym_op
-00014b40: 7320 3d20 5b6e 2a27 782c 792c 7a27 5d20  s = [n*'x,y,z'] 
-00014b50: 6172 7261 7920 6f66 2073 7472 696e 6720  array of string 
-00014b60: 7379 6d6d 6574 7279 206f 7065 7261 7469  symmetry operati
-00014b70: 6f6e 730d 0a20 2020 2020 2078 2c79 2c7a  ons..      x,y,z
-00014b80: 203d 2066 7261 6374 696f 6e61 6c20 636f   = fractional co
-00014b90: 6f72 6469 6e61 7465 7320 6f66 2061 746f  ordinates of ato
-00014ba0: 6d69 6320 706f 7369 6974 6f6e 2074 6f20  mic posiiton to 
-00014bb0: 6265 206d 6f64 6966 6965 6420 6279 2073  be modified by s
-00014bc0: 796d 6d65 7472 790d 0a20 2020 2020 2075  ymmetry..      u
-00014bd0: 7677 203d 205b 5b6e 7833 5d5d 2061 7272  vw = [[nx3]] arr
-00014be0: 6179 206f 6620 7379 6d6d 6574 7279 2064  ay of symmetry d
-00014bf0: 6566 696e 6564 2066 6163 7469 6f6e 616c  efined factional
-00014c00: 2063 6f6f 7264 696e 6174 6573 205b 752c   coordinates [u,
-00014c10: 762c 775d 0d0a 0d0a 2020 2020 452e 472e  v,w]....    E.G.
-00014c20: 0d0a 2020 2020 2020 7576 7720 3d20 6765  ..      uvw = ge
-00014c30: 6e5f 7379 6d5f 706f 7328 5b27 782c 792c  n_sym_pos(['x,y,
-00014c40: 7a27 2c27 792c 2d78 2c7a 2b31 2f32 275d  z','y,-x,z+1/2']
-00014c50: 2c30 2e31 2c30 2e32 2c30 2e33 290d 0a20  ,0.1,0.2,0.3).. 
-00014c60: 2020 2020 2075 7677 203e 3e20 5b5b 302e       uvw >> [[0.
-00014c70: 312c 302e 322c 302e 335d 202c 205b 302e  1,0.2,0.3] , [0.
-00014c80: 322c 2d30 2e31 2c30 2e38 5d5d 0d0a 2020  2,-0.1,0.8]]..  
-00014c90: 2020 2222 220d 0a20 2020 2075 7677 203d    """..    uvw =
-00014ca0: 206e 702e 7a65 726f 7328 5b6c 656e 2873   np.zeros([len(s
-00014cb0: 796d 5f6f 7073 292c 2033 5d29 0d0a 2020  ym_ops), 3])..  
-00014cc0: 2020 666f 7220 6e20 696e 2072 616e 6765    for n in range
-00014cd0: 286c 656e 2873 796d 5f6f 7073 2929 3a0d  (len(sym_ops)):.
-00014ce0: 0a20 2020 2020 2020 2073 796d 203d 2073  .        sym = s
-00014cf0: 796d 5f6f 7073 5b6e 5d0d 0a20 2020 2020  ym_ops[n]..     
-00014d00: 2020 2073 796d 203d 2073 796d 2e6c 6f77     sym = sym.low
-00014d10: 6572 2829 0d0a 2020 2020 2020 2020 2320  er()..        # 
-00014d20: 4576 616c 7561 7465 2073 7472 696e 6720  Evaluate string 
-00014d30: 7379 6d6d 6574 7279 206f 7065 7261 7469  symmetry operati
-00014d40: 6f6e 2069 6e20 7465 726d 7320 6f66 2078  on in terms of x
-00014d50: 2c79 2c7a 0d0a 2020 2020 2020 2020 7379  ,y,z..        sy
-00014d60: 6d20 3d20 7379 6d2e 7265 706c 6163 6528  m = sym.replace(
-00014d70: 272f 272c 2027 2e2f 2729 0d0a 2020 2020  '/', './')..    
-00014d80: 2020 2020 7379 6d20 3d20 7379 6d2e 7374      sym = sym.st
-00014d90: 7269 7028 275c 225c 2727 290d 0a20 2020  rip('\"\'')..   
-00014da0: 2020 2020 2073 796d 203d 2073 796d 2e72       sym = sym.r
-00014db0: 6570 6c61 6365 2827 6d78 272c 2027 7827  eplace('mx', 'x'
-00014dc0: 292e 7265 706c 6163 6528 276d 7927 2c20  ).replace('my', 
-00014dd0: 2779 2729 2e72 6570 6c61 6365 2827 6d7a  'y').replace('mz
-00014de0: 272c 2027 7a27 290d 0a20 2020 2020 2020  ', 'z')..       
-00014df0: 206f 7574 203d 2065 7661 6c28 7379 6d29   out = eval(sym)
-00014e00: 0d0a 2020 2020 2020 2020 7576 775b 6e5d  ..        uvw[n]
-00014e10: 203d 206e 702e 6172 7261 7928 6f75 745b   = np.array(out[
-00014e20: 303a 335d 2920 2b20 302e 3020 2023 2061  0:3]) + 0.0  # a
-00014e30: 6464 207a 6572 6f20 746f 2072 656d 6f76  dd zero to remov
-00014e40: 6520 2d30 2e30 2076 616c 7565 730d 0a20  e -0.0 values.. 
-00014e50: 2020 2072 6574 7572 6e20 7576 770d 0a0d     return uvw...
-00014e60: 0a0d 0a64 6566 2067 656e 5f73 796d 6365  ...def gen_symce
-00014e70: 6e5f 706f 7328 7379 6d5f 6f70 732c 2063  n_pos(sym_ops, c
-00014e80: 656e 5f6f 7073 2c20 782c 2079 2c20 7a29  en_ops, x, y, z)
-00014e90: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-00014ea0: 4765 6e65 7261 7465 2070 6f73 6974 696f  Generate positio
-00014eb0: 6e73 2066 726f 6d20 7379 6d6d 6574 7279  ns from symmetry
-00014ec0: 2061 6e64 2063 656e 7472 696e 6720 6f70   and centring op
-00014ed0: 6572 6174 696f 6e73 0d0a 2020 2020 5573  erations..    Us
-00014ee0: 6167 653a 0d0a 2020 2020 2020 7576 7720  age:..      uvw 
-00014ef0: 3d20 6765 6e5f 7379 6d63 656e 5f70 6f73  = gen_symcen_pos
-00014f00: 2873 796d 5f6f 7073 2c63 656e 5f6f 7073  (sym_ops,cen_ops
-00014f10: 2c78 2c79 2c7a 290d 0a20 2020 2020 2073  ,x,y,z)..      s
-00014f20: 796d 5f6f 7073 203d 205b 6e2a 2778 2c79  ym_ops = [n*'x,y
-00014f30: 2c7a 275d 2061 7272 6179 206f 6620 7374  ,z'] array of st
-00014f40: 7269 6e67 2073 796d 6d65 7472 7920 6f70  ring symmetry op
-00014f50: 6572 6174 696f 6e73 0d0a 2020 2020 2020  erations..      
-00014f60: 6365 6e5f 6f70 7320 3d20 5b6d 2a27 782c  cen_ops = [m*'x,
-00014f70: 792c 7a27 5d20 6172 7261 7920 6f66 2073  y,z'] array of s
-00014f80: 7472 696e 6720 6365 6e74 7269 6e67 206f  tring centring o
-00014f90: 7065 7261 7469 6f6e 730d 0a20 2020 2020  perations..     
-00014fa0: 2078 2c79 2c7a 203d 2066 7261 6374 696f   x,y,z = fractio
-00014fb0: 6e61 6c20 636f 6f72 6469 6e61 7465 7320  nal coordinates 
-00014fc0: 6f66 2061 746f 6d69 6320 706f 7369 6974  of atomic posiit
-00014fd0: 6f6e 2074 6f20 6265 206d 6f64 6966 6965  on to be modifie
-00014fe0: 6420 6279 2073 796d 6d65 7472 790d 0a20  d by symmetry.. 
-00014ff0: 2020 2020 2075 7677 203d 205b 5b6e 7833       uvw = [[nx3
-00015000: 5d5d 2061 7272 6179 206f 6620 7379 6d6d  ]] array of symm
-00015010: 6574 7279 2064 6566 696e 6564 2066 6163  etry defined fac
-00015020: 7469 6f6e 616c 2063 6f6f 7264 696e 6174  tional coordinat
-00015030: 6573 205b 752c 762c 775d 0d0a 0d0a 2020  es [u,v,w]....  
-00015040: 2020 452e 472e 0d0a 2020 2020 2020 7576    E.G...      uv
-00015050: 7720 3d20 6765 6e5f 7379 6d63 656e 5f70  w = gen_symcen_p
-00015060: 6f73 285b 2778 2c79 2c7a 272c 2779 2c2d  os(['x,y,z','y,-
-00015070: 782c 7a2b 312f 3227 5d2c 5b27 782c 792c  x,z+1/2'],['x,y,
-00015080: 7a27 2c27 782b 312f 332c 792b 312f 332c  z','x+1/3,y+1/3,
-00015090: 7a27 5d2c 302e 312c 302e 322c 302e 3329  z'],0.1,0.2,0.3)
-000150a0: 0d0a 2020 2020 2020 7576 7720 3e3e 205b  ..      uvw >> [
-000150b0: 5b30 2e31 2c30 2e32 2c30 2e33 5d20 2c20  [0.1,0.2,0.3] , 
-000150c0: 5b30 2e34 3333 2c30 2e35 3333 2c30 2e33  [0.433,0.533,0.3
-000150d0: 5d20 2c20 5b30 2e32 2c2d 302e 312c 302e  ] , [0.2,-0.1,0.
-000150e0: 385d 202c 205b 302e 3533 332c 2d30 2e32  8] , [0.533,-0.2
-000150f0: 3333 2c30 2e38 5d5d 0d0a 2020 2020 2222  33,0.8]]..    ""
-00015100: 220d 0a0d 0a20 2020 204e 7379 6d4f 7073  "....    NsymOps
-00015110: 203d 206c 656e 2873 796d 5f6f 7073 290d   = len(sym_ops).
-00015120: 0a20 2020 204e 6365 6e4f 7073 203d 206c  .    NcenOps = l
-00015130: 656e 2863 656e 5f6f 7073 290d 0a20 2020  en(cen_ops)..   
-00015140: 204e 6f70 7320 3d20 4e73 796d 4f70 7320   Nops = NsymOps 
-00015150: 2a20 4e63 656e 4f70 730d 0a0d 0a20 2020  * NcenOps....   
-00015160: 2075 7677 203d 2067 656e 5f73 796d 5f70   uvw = gen_sym_p
-00015170: 6f73 2873 796d 5f6f 7073 2c20 782c 2079  os(sym_ops, x, y
-00015180: 2c20 7a29 0d0a 0d0a 2020 2020 7379 6d70  , z)....    symp
-00015190: 6f73 203d 206e 702e 7a65 726f 7328 5b4e  os = np.zeros([N
-000151a0: 6f70 732c 2033 5d29 0d0a 2020 2020 666f  ops, 3])..    fo
-000151b0: 7220 6d20 696e 2072 616e 6765 284e 7379  r m in range(Nsy
-000151c0: 6d4f 7073 293a 0d0a 2020 2020 2020 2020  mOps):..        
-000151d0: 6378 2c20 6379 2c20 637a 203d 2075 7677  cx, cy, cz = uvw
-000151e0: 5b6d 5d0d 0a20 2020 2020 2020 204e 692c  [m]..        Ni,
-000151f0: 204e 6a20 3d20 6d20 2a20 4e63 656e 4f70   Nj = m * NcenOp
-00015200: 732c 2028 6d20 2b20 3129 202a 204e 6365  s, (m + 1) * Nce
-00015210: 6e4f 7073 0d0a 2020 2020 2020 2020 6365  nOps..        ce
-00015220: 6e5f 7576 7720 3d20 6765 6e5f 7379 6d5f  n_uvw = gen_sym_
-00015230: 706f 7328 6365 6e5f 6f70 732c 2063 782c  pos(cen_ops, cx,
-00015240: 2063 792c 2063 7a29 0d0a 2020 2020 2020   cy, cz)..      
-00015250: 2020 7379 6d70 6f73 5b4e 693a 4e6a 2c20    sympos[Ni:Nj, 
-00015260: 3a5d 203d 2063 656e 5f75 7677 0d0a 2020  :] = cen_uvw..  
-00015270: 2020 7265 7475 726e 2073 796d 706f 730d    return sympos.
-00015280: 0a0d 0a0d 0a64 6566 2067 656e 5f73 796d  .....def gen_sym
-00015290: 5f75 6e69 7175 6528 7379 6d5f 6f70 732c  _unique(sym_ops,
-000152a0: 2078 2c20 792c 207a 2c20 6365 6e5f 6f70   x, y, z, cen_op
-000152b0: 733d 4e6f 6e65 293a 0d0a 2020 2020 2222  s=None):..    ""
-000152c0: 220d 0a20 2020 2047 656e 6572 6174 6520  "..    Generate 
-000152d0: 706f 7369 7469 6f6e 7320 6672 6f6d 2073  positions from s
-000152e0: 796d 6d65 7472 7920 6f70 6572 6174 696f  ymmetry operatio
-000152f0: 6e73 2077 6974 6820 6964 656e 7469 616c  ns with idential
-00015300: 2070 6f73 6974 696f 6e73 2072 656d 6f76   positions remov
-00015310: 6564 0d0a 2020 2020 5573 6167 653a 0d0a  ed..    Usage:..
-00015320: 2020 2020 2020 7576 7720 3d20 6765 6e5f        uvw = gen_
-00015330: 7379 6d5f 756e 6971 7565 2873 796d 5f6f  sym_unique(sym_o
-00015340: 7073 2c78 2c79 2c7a 290d 0a20 2020 2045  ps,x,y,z)..    E
-00015350: 2e47 2e0d 0a20 2020 2020 2075 7677 203d  .G...      uvw =
-00015360: 2067 656e 5f73 796d 5f75 6e69 7175 6528   gen_sym_unique(
-00015370: 5b27 782c 792c 7a27 2c27 792c 2d78 2c7a  ['x,y,z','y,-x,z
-00015380: 2b31 2f32 272c 2778 2c79 2c7a 275d 2c30  +1/2','x,y,z'],0
-00015390: 2e31 2c30 2e32 2c30 2e33 290d 0a20 2020  .1,0.2,0.3)..   
-000153a0: 2020 2075 7677 203e 3e20 5b5b 302e 312c     uvw >> [[0.1,
-000153b0: 302e 322c 302e 335d 202c 205b 302e 322c  0.2,0.3] , [0.2,
-000153c0: 2d30 2e31 2c30 2e38 5d5d 0d0a 2020 2020  -0.1,0.8]]..    
-000153d0: 3a70 6172 616d 2073 796d 5f6f 7073 3a20  :param sym_ops: 
-000153e0: 6c69 7374 206f 6620 7374 7220 2d20 7379  list of str - sy
-000153f0: 6d6d 6574 7279 206f 7065 7261 7469 6f6e  mmetry operation
-00015400: 730d 0a20 2020 203a 7061 7261 6d20 783a  s..    :param x:
-00015410: 2066 6c6f 6174 0d0a 2020 2020 3a70 6172   float..    :par
-00015420: 616d 2079 3a20 666c 6f61 740d 0a20 2020  am y: float..   
-00015430: 203a 7061 7261 6d20 7a3a 2066 6c6f 6174   :param z: float
-00015440: 0d0a 2020 2020 3a70 6172 616d 2063 656e  ..    :param cen
-00015450: 5f6f 7073 3a20 4f70 7469 6f6e 616c 202d  _ops: Optional -
-00015460: 206c 6973 7420 6f66 2073 7472 2066 6f72   list of str for
-00015470: 2063 656e 7472 696e 6720 6f70 6572 6174   centring operat
-00015480: 696f 6e73 0d0a 2020 2020 3a72 6574 7572  ions..    :retur
-00015490: 6e3a 2061 7272 6179 206f 6620 706f 7369  n: array of posi
-000154a0: 7469 6f6e 730d 0a20 2020 2022 2222 0d0a  tions..    """..
-000154b0: 2020 2020 6966 2063 656e 5f6f 7073 3a0d      if cen_ops:.
-000154c0: 0a20 2020 2020 2020 2073 796d 5f78 797a  .        sym_xyz
-000154d0: 203d 2067 656e 5f73 796d 6365 6e5f 706f   = gen_symcen_po
-000154e0: 7328 7379 6d5f 6f70 732c 2063 656e 5f6f  s(sym_ops, cen_o
-000154f0: 7073 2c20 782c 2079 2c20 7a29 0d0a 2020  ps, x, y, z)..  
-00015500: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00015510: 2073 796d 5f78 797a 203d 2067 656e 5f73   sym_xyz = gen_s
-00015520: 796d 5f70 6f73 2873 796d 5f6f 7073 2c20  ym_pos(sym_ops, 
-00015530: 782c 2079 2c20 7a29 0d0a 2020 2020 7379  x, y, z)..    sy
-00015540: 6d5f 7879 7a20 3d20 6669 7469 6e63 656c  m_xyz = fitincel
-00015550: 6c28 7379 6d5f 7879 7a29 0d0a 2020 2020  l(sym_xyz)..    
-00015560: 2320 5265 6d6f 7665 2069 6465 6e74 6963  # Remove identic
-00015570: 616c 2070 6f73 6974 696f 6e73 0d0a 2020  al positions..  
-00015580: 2020 756e 6971 7565 5f78 797a 2c20 756e    unique_xyz, un
-00015590: 6971 7565 6964 782c 206d 6174 6368 6964  iqueidx, matchid
-000155a0: 7820 3d20 6667 2e75 6e69 7175 655f 7665  x = fg.unique_ve
-000155b0: 6374 6f72 2873 796d 5f78 797a 2c20 746f  ctor(sym_xyz, to
-000155c0: 6c3d 302e 3031 290d 0a20 2020 2072 6574  l=0.01)..    ret
-000155d0: 7572 6e20 756e 6971 7565 5f78 797a 0d0a  urn unique_xyz..
-000155e0: 0d0a 0d0a 6465 6620 6765 6e5f 7379 6d63  ....def gen_symc
-000155f0: 656e 5f6f 7073 2873 796d 5f6f 7073 2c20  en_ops(sym_ops, 
-00015600: 6365 6e5f 6f70 7329 3a0d 0a20 2020 2022  cen_ops):..    "
-00015610: 2222 0d0a 2020 2020 4275 696c 6420 636f  ""..    Build co
-00015620: 6d70 6c65 7465 206c 6973 7420 6f66 2073  mplete list of s
-00015630: 796d 6d65 7472 7920 6f70 6572 6174 696f  ymmetry operatio
-00015640: 6e73 2066 726f 6d20 7379 6d6d 6574 7279  ns from symmetry
-00015650: 2061 6e64 2063 656e 7472 696e 6720 7665   and centring ve
-00015660: 6374 6f72 730d 0a20 2020 2055 7361 6765  ctors..    Usage
-00015670: 3a0d 0a20 2020 2020 206f 7073 203d 2067  :..      ops = g
-00015680: 656e 5f73 796d 6365 6e5f 6f70 7328 7379  en_symcen_ops(sy
-00015690: 6d5f 6f70 732c 6365 6e5f 6f70 7329 0d0a  m_ops,cen_ops)..
-000156a0: 2020 2020 2020 7379 6d5f 6f70 7320 3d20        sym_ops = 
-000156b0: 5b6e 2a27 782c 792c 7a27 5d20 6172 7261  [n*'x,y,z'] arra
-000156c0: 7920 6f66 2073 7472 696e 6720 7379 6d6d  y of string symm
-000156d0: 6574 7279 206f 7065 7261 7469 6f6e 730d  etry operations.
-000156e0: 0a20 2020 2020 2063 656e 5f6f 7073 203d  .      cen_ops =
-000156f0: 205b 6d2a 2778 2c79 2c7a 275d 2061 7272   [m*'x,y,z'] arr
-00015700: 6179 206f 6620 7374 7269 6e67 2063 656e  ay of string cen
-00015710: 7472 696e 6720 6f70 6572 6174 696f 6e73  tring operations
-00015720: 0d0a 2020 2020 2020 6f70 7320 3d20 5b6e  ..      ops = [n
-00015730: 2a6d 2a27 782c 792c 7a27 5d20 6172 7261  *m*'x,y,z'] arra
-00015740: 7920 6f66 2073 7472 696e 6720 7379 6d6d  y of string symm
-00015750: 6574 7279 206f 7065 7261 7469 6f6e 730d  etry operations.
-00015760: 0a0d 0a20 2020 2045 2e47 2e0d 0a20 2020  ...    E.G...   
-00015770: 2020 206f 7073 203d 2067 656e 5f73 796d     ops = gen_sym
-00015780: 6365 6e5f 706f 7328 5b27 782c 792c 7a27  cen_pos(['x,y,z'
-00015790: 2c27 792c 2d78 2c7a 2b31 2f32 275d 2c5b  ,'y,-x,z+1/2'],[
-000157a0: 2778 2c79 2c7a 272c 2778 2b31 2f33 2c79  'x,y,z','x+1/3,y
-000157b0: 2b31 2f33 2c7a 275d 290d 0a20 2020 2020  +1/3,z'])..     
-000157c0: 203e 3e20 6f70 7320 3d20 5b27 782c 792c   >> ops = ['x,y,
-000157d0: 7a27 2c27 782b 312f 332c 792b 312f 332c  z','x+1/3,y+1/3,
-000157e0: 7a27 2c27 792c 2d78 2c7a 2b31 2f32 272c  z','y,-x,z+1/2',
-000157f0: 2779 2b31 2f33 2c2d 782b 312f 332c 7a2b  'y+1/3,-x+1/3,z+
-00015800: 312f 3227 5d0d 0a20 2020 2022 2222 0d0a  1/2']..    """..
-00015810: 0d0a 2020 2020 6f70 7320 3d20 5b5d 0d0a  ..    ops = []..
-00015820: 2020 2020 666f 7220 7379 6d20 696e 2073      for sym in s
-00015830: 796d 5f6f 7073 3a0d 0a20 2020 2020 2020  ym_ops:..       
-00015840: 2073 796d 203d 2073 796d 2e6c 6f77 6572   sym = sym.lower
-00015850: 2829 0d0a 2020 2020 2020 2020 7379 6d20  ()..        sym 
-00015860: 3d20 7379 6d2e 7374 7269 7028 275c 225c  = sym.strip('\"\
-00015870: 2727 290d 0a20 2020 2020 2020 2073 5f6f  '')..        s_o
-00015880: 7020 3d20 7379 6d2e 7370 6c69 7428 272c  p = sym.split(',
-00015890: 2729 0d0a 2020 2020 2020 2020 7820 3d20  ')..        x = 
-000158a0: 735f 6f70 5b30 5d2e 7374 7269 7028 290d  s_op[0].strip().
-000158b0: 0a20 2020 2020 2020 2079 203d 2073 5f6f  .        y = s_o
-000158c0: 705b 315d 2e73 7472 6970 2829 0d0a 2020  p[1].strip()..  
-000158d0: 2020 2020 2020 7a20 3d20 735f 6f70 5b32        z = s_op[2
-000158e0: 5d2e 7374 7269 7028 290d 0a20 2020 2020  ].strip()..     
-000158f0: 2020 2069 6620 6c65 6e28 735f 6f70 2920     if len(s_op) 
-00015900: 3e20 333a 0d0a 2020 2020 2020 2020 2020  > 3:..          
-00015910: 2020 7420 3d20 696e 7428 735f 6f70 5b33    t = int(s_op[3
-00015920: 5d29 0d0a 2020 2020 2020 2020 656c 7365  ])..        else
-00015930: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
-00015940: 203d 2031 0d0a 2020 2020 2020 2020 666f   = 1..        fo
-00015950: 7220 6365 6e20 696e 2063 656e 5f6f 7073  r cen in cen_ops
-00015960: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-00015970: 656e 203d 2063 656e 2e6c 6f77 6572 2829  en = cen.lower()
-00015980: 0d0a 2020 2020 2020 2020 2020 2020 6365  ..            ce
-00015990: 6e20 3d20 6365 6e2e 7374 7269 7028 275c  n = cen.strip('\
-000159a0: 225c 2727 290d 0a20 2020 2020 2020 2020  "\'')..         
-000159b0: 2020 206f 7020 3d20 6365 6e2e 7265 706c     op = cen.repl
-000159c0: 6163 6528 2778 272c 2027 6127 292e 7265  ace('x', 'a').re
-000159d0: 706c 6163 6528 2779 272c 2027 6227 292e  place('y', 'b').
-000159e0: 7265 706c 6163 6528 277a 272c 2027 6327  replace('z', 'c'
-000159f0: 2920 2023 2061 766f 6964 2072 6570 6c61  )  # avoid repla
-00015a00: 6369 6e67 2078 2f79 2074 7769 6365 0d0a  cing x/y twice..
-00015a10: 2020 2020 2020 2020 2020 2020 6f70 203d              op =
-00015a20: 206f 702e 7265 706c 6163 6528 2761 272c   op.replace('a',
-00015a30: 2078 292e 7265 706c 6163 6528 2762 272c   x).replace('b',
-00015a40: 2079 292e 7265 706c 6163 6528 2763 272c   y).replace('c',
-00015a50: 207a 290d 0a20 2020 2020 2020 2020 2020   z)..           
-00015a60: 206f 7020 3d20 6f70 2e72 6570 6c61 6365   op = op.replace
-00015a70: 2827 2d2d 272c 2027 2729 0d0a 2020 2020  ('--', '')..    
-00015a80: 2020 2020 2020 2020 6966 206f 702e 636f          if op.co
-00015a90: 756e 7428 272c 2729 203e 2032 3a0d 0a20  unt(',') > 2:.. 
-00015aa0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00015ab0: 7020 3d20 6f70 2e73 706c 6974 2827 2c27  p = op.split(','
-00015ac0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00015ad0: 2020 206f 705b 335d 203d 2027 252b 6427     op[3] = '%+d'
-00015ae0: 2025 2028 696e 7428 6f70 5b33 5d29 202a   % (int(op[3]) *
-00015af0: 2074 290d 0a20 2020 2020 2020 2020 2020   t)..           
-00015b00: 2020 2020 206f 7020 3d20 272c 272e 6a6f       op = ','.jo
-00015b10: 696e 286f 7029 0d0a 2020 2020 2020 2020  in(op)..        
-00015b20: 2020 2020 6f70 7320 2b3d 205b 6f70 5d0d      ops += [op].
-00015b30: 0a20 2020 2072 6574 7572 6e20 6f70 730d  .    return ops.
-00015b40: 0a0d 0a0d 0a64 6566 2067 656e 5f73 796d  .....def gen_sym
-00015b50: 5f72 6566 2873 796d 5f6f 7073 2c20 686b  _ref(sym_ops, hk
-00015b60: 6c29 3a0d 0a20 2020 2022 2222 0d0a 2020  l):..    """..  
-00015b70: 2020 2047 656e 6572 6174 6520 7379 6d6d     Generate symm
-00015b80: 6574 7269 6320 7265 666c 6563 7469 6f6e  etric reflection
-00015b90: 7320 6769 7665 6e20 7379 6d6d 6574 7279  s given symmetry
-00015ba0: 206f 7065 7261 7469 6f6e 730d 0a20 2020   operations..   
-00015bb0: 2020 2020 2020 7379 6d68 6b6c 203d 2067        symhkl = g
-00015bc0: 656e 5f73 796d 5f72 6566 2873 796d 5f6f  en_sym_ref(sym_o
-00015bd0: 7073 2c68 2c6b 2c6c 290d 0a20 2020 2022  ps,h,k,l)..    "
-00015be0: 2222 0d0a 0d0a 2020 2020 686b 6c20 3d20  ""....    hkl = 
-00015bf0: 6e70 2e61 7361 7272 6179 2868 6b6c 2c20  np.asarray(hkl, 
-00015c00: 6474 7970 653d 666c 6f61 7429 0d0a 0d0a  dtype=float)....
-00015c10: 2020 2020 2320 4765 7420 7472 616e 7366      # Get transf
-00015c20: 6f72 6d61 7469 6f6e 206d 6174 7269 6365  ormation matrice
-00015c30: 730d 0a20 2020 2073 796d 5f6d 6174 203d  s..    sym_mat =
-00015c40: 2067 656e 5f73 796d 5f6d 6174 2873 796d   gen_sym_mat(sym
-00015c50: 5f6f 7073 290d 0a20 2020 206e 6f70 7320  _ops)..    nops 
-00015c60: 3d20 6c65 6e28 7379 6d5f 6f70 7329 0d0a  = len(sym_ops)..
-00015c70: 0d0a 2020 2020 7379 6d68 6b6c 203d 206e  ..    symhkl = n
-00015c80: 702e 7a65 726f 7328 5b6e 6f70 732c 2033  p.zeros([nops, 3
-00015c90: 5d29 0d0a 2020 2020 666f 7220 6e2c 2073  ])..    for n, s
-00015ca0: 796d 2069 6e20 656e 756d 6572 6174 6528  ym in enumerate(
-00015cb0: 7379 6d5f 6d61 7429 3a0d 0a20 2020 2020  sym_mat):..     
-00015cc0: 2020 2023 206d 756c 7469 706c 7920 6f6e     # multiply on
-00015cd0: 6c79 2062 7920 7468 6520 726f 7461 7469  ly by the rotati
-00015ce0: 6f6e 616c 2070 6172 740d 0a20 2020 2020  onal part..     
-00015cf0: 2020 2073 796d 686b 6c5b 6e2c 203a 5d20     symhkl[n, :] 
-00015d00: 3d20 6e70 2e64 6f74 2868 6b6c 2c20 7379  = np.dot(hkl, sy
-00015d10: 6d5b 3a33 2c20 3a33 5d29 0d0a 0d0a 2020  m[:3, :3])....  
-00015d20: 2020 7265 7475 726e 2073 796d 686b 6c0d    return symhkl.
-00015d30: 0a0d 0a0d 0a64 6566 2073 756d 5f73 796d  .....def sum_sym
-00015d40: 5f72 6566 2873 796d 686b 6c29 3a0d 0a20  _ref(symhkl):.. 
-00015d50: 2020 2022 2222 0d0a 2020 2020 5265 6d6f     """..    Remo
-00015d60: 7665 2065 7175 6976 616c 656e 7420 686b  ve equivalent hk
-00015d70: 6c20 706f 7369 7469 6f6e 7320 616e 6420  l positions and 
-00015d80: 7265 7475 726e 2074 6865 206e 756d 6265  return the numbe
-00015d90: 7220 6f66 2074 696d 6573 2065 6163 6820  r of times each 
-00015da0: 6973 2067 656e 6572 6174 6564 2e0d 0a20  is generated... 
-00015db0: 2020 2022 2222 0d0a 2020 2020 2320 5265     """..    # Re
-00015dc0: 6d6f 7665 2064 7570 6c69 6361 7465 2070  move duplicate p
-00015dd0: 6f73 6974 696f 6e73 0d0a 2020 2020 756e  ositions..    un
-00015de0: 6971 7565 686b 6c2c 2075 6e69 7175 6569  iquehkl, uniquei
-00015df0: 6478 2c20 6d61 7463 6869 6478 203d 2066  dx, matchidx = f
-00015e00: 672e 756e 6971 7565 5f76 6563 746f 7228  g.unique_vector(
-00015e10: 7379 6d68 6b6c 5b3a 2c20 3a33 5d2c 2030  symhkl[:, :3], 0
-00015e20: 2e30 3129 0d0a 0d0a 2020 2020 2320 5375  .01)....    # Su
-00015e30: 6d20 696e 7465 6e73 6974 7920 6174 2064  m intensity at d
-00015e40: 7570 6c69 6361 7465 2070 6f73 6974 696f  uplicate positio
-00015e50: 6e73 0d0a 2020 2020 7375 6d69 6e74 203d  ns..    sumint =
-00015e60: 206e 702e 7a65 726f 7328 6c65 6e28 756e   np.zeros(len(un
-00015e70: 6971 7565 686b 6c29 290d 0a20 2020 2066  iquehkl))..    f
-00015e80: 6f72 206e 2069 6e20 7261 6e67 6528 6c65  or n in range(le
-00015e90: 6e28 756e 6971 7565 686b 6c29 293a 0d0a  n(uniquehkl)):..
-00015ea0: 2020 2020 2020 2020 7375 6d69 6e74 5b6e          sumint[n
-00015eb0: 5d20 3d20 6d61 7463 6869 6478 2e63 6f75  ] = matchidx.cou
-00015ec0: 6e74 286e 290d 0a0d 0a20 2020 2072 6574  nt(n)....    ret
-00015ed0: 7572 6e20 756e 6971 7565 686b 6c2c 2073  urn uniquehkl, s
-00015ee0: 756d 696e 740d 0a0d 0a0d 0a64 6566 2067  umint......def g
-00015ef0: 656e 5f73 796d 5f6d 6174 2873 796d 5f6f  en_sym_mat(sym_o
-00015f00: 7073 293a 0d0a 2020 2020 2222 220d 0a20  ps):..    """.. 
-00015f10: 2020 2020 4765 6e65 7261 7465 2074 7261      Generate tra
-00015f20: 6e73 666f 726d 6174 696f 6e20 6d61 7472  nsformation matr
-00015f30: 6978 2066 726f 6d20 7379 6d6d 6574 7279  ix from symmetry
-00015f40: 206f 7065 7261 7469 6f6e 0d0a 2020 2020   operation..    
-00015f50: 2043 7572 7265 6e74 6c79 2076 6572 7920   Currently very 
-00015f60: 7567 6c79 2062 7574 2069 7420 7365 656d  ugly but it seem
-00015f70: 7320 746f 2077 6f72 6b0d 0a20 2020 2020  s to work..     
-00015f80: 5465 7374 6564 2069 6e20 5465 7374 2f74  Tested in Test/t
-00015f90: 6573 745f 6765 6e5f 7379 6d5f 6d61 7420  est_gen_sym_mat 
-00015fa0: 2d20 666f 756e 6420 746f 2062 6520 6661  - found to be fa
-00015fb0: 7374 2061 6e64 2072 656c 6961 626c 652e  st and reliable.
-00015fc0: 0d0a 2020 2020 2073 796d 5f6d 6174 203d  ..     sym_mat =
-00015fd0: 2067 656e 5f73 796d 5f6d 6174 285b 2778   gen_sym_mat(['x
-00015fe0: 2c79 2c7a 272c 2779 2c2d 782c 7a2b 312f  ,y,z','y,-x,z+1/
-00015ff0: 3227 5d29 0d0a 2020 2020 2073 796d 5f6d  2'])..     sym_m
-00016000: 6174 5b30 5d20 3d20 5b5b 2031 2e2c 2020  at[0] = [[ 1.,  
-00016010: 302e 2c20 2030 2e2c 2020 302e 5d2c 0d0a  0.,  0.,  0.],..
-00016020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016030: 2020 205b 2030 2e2c 2020 312e 2c20 2030     [ 0.,  1.,  0
-00016040: 2e2c 2020 302e 5d2c 0d0a 2020 2020 2020  .,  0.],..      
-00016050: 2020 2020 2020 2020 2020 2020 205b 2030               [ 0
-00016060: 2e2c 2020 302e 2c20 2031 2e2c 2020 302e  .,  0.,  1.,  0.
-00016070: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00016080: 2020 2020 2020 205b 2030 2e2c 2020 302e         [ 0.,  0.
-00016090: 2c20 2030 2e2c 2020 312e 5d5d 290d 0a20  ,  0.,  1.]]).. 
-000160a0: 2020 2020 7379 6d5f 6d61 745b 315d 203d      sym_mat[1] =
-000160b0: 205b 5b20 302e 202c 2020 312e 202c 2020   [[ 0. ,  1. ,  
-000160c0: 302e 202c 2020 302e 205d 2c0d 0a20 2020  0. ,  0. ],..   
-000160d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160e0: 5b2d 312e 202c 2020 302e 202c 2020 302e  [-1. ,  0. ,  0.
-000160f0: 202c 2020 302e 205d 2c0d 0a20 2020 2020   ,  0. ],..     
-00016100: 2020 2020 2020 2020 2020 2020 2020 5b20                [ 
-00016110: 302e 202c 2020 302e 202c 2020 312e 202c  0. ,  0. ,  1. ,
-00016120: 2020 302e 355d 2c0d 0a20 2020 2020 2020    0.5],..       
-00016130: 2020 2020 2020 2020 2020 2020 5b20 302e              [ 0.
-00016140: 2c20 2020 302e 2c20 2020 302e 2c20 2020  ,   0.,   0.,   
-00016150: 312e 5d5d 0d0a 2020 2020 2222 220d 0a0d  1.]]..    """...
-00016160: 0a20 2020 2073 796d 5f6f 7073 203d 206e  .    sym_ops = n
-00016170: 702e 6173 6172 7261 7928 7379 6d5f 6f70  p.asarray(sym_op
-00016180: 732c 2064 7479 7065 3d73 7472 292e 7265  s, dtype=str).re
-00016190: 7368 6170 6528 2d31 290d 0a0d 0a20 2020  shape(-1)....   
-000161a0: 2073 796d 5f6d 6174 203d 205b 5d0d 0a20   sym_mat = [].. 
-000161b0: 2020 2066 6f72 2073 796d 2069 6e20 7379     for sym in sy
-000161c0: 6d5f 6f70 733a 0d0a 2020 2020 2020 2020  m_ops:..        
-000161d0: 7379 6d20 3d20 7379 6d2e 6c6f 7765 7228  sym = sym.lower(
-000161e0: 290d 0a20 2020 2020 2020 2073 796d 203d  )..        sym =
-000161f0: 2073 796d 2e73 7472 6970 2827 5c22 5c27   sym.strip('\"\'
-00016200: 2729 0d0a 2020 2020 2020 2020 7379 6d20  ')..        sym 
-00016210: 3d20 7379 6d2e 7265 706c 6163 6528 272f  = sym.replace('/
-00016220: 272c 2027 2e2f 2729 2020 2320 666c 6f61  ', './')  # floa
-00016230: 7420 6469 7669 7369 6f6e 0d0a 2020 2020  t division..    
-00016240: 2020 2020 6f70 7320 3d20 7379 6d2e 7370      ops = sym.sp
-00016250: 6c69 7428 272c 2729 0d0a 2020 2020 2020  lit(',')..      
-00016260: 2020 6d61 7420 3d20 6e70 2e7a 6572 6f73    mat = np.zeros
-00016270: 2828 342c 2034 2929 0d0a 2020 2020 2020  ((4, 4))..      
-00016280: 2020 6d61 745b 332c 2033 5d20 3d20 310d    mat[3, 3] = 1.
-00016290: 0a0d 0a20 2020 2020 2020 2066 6f72 206e  ...        for n
-000162a0: 2069 6e20 7261 6e67 6528 3329 3a0d 0a20   in range(3):.. 
-000162b0: 2020 2020 2020 2020 2020 206f 7020 3d20             op = 
-000162c0: 6f70 735b 6e5d 0d0a 2020 2020 2020 2020  ops[n]..        
-000162d0: 2020 2020 6966 2027 7827 2069 6e20 6f70      if 'x' in op
-000162e0: 3a20 6d61 745b 6e2c 2030 5d20 3d20 310d  : mat[n, 0] = 1.
-000162f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016300: 272d 7827 2069 6e20 6f70 3a20 6d61 745b  '-x' in op: mat[
-00016310: 6e2c 2030 5d20 3d20 2d31 0d0a 2020 2020  n, 0] = -1..    
-00016320: 2020 2020 2020 2020 6966 2027 7927 2069          if 'y' i
-00016330: 6e20 6f70 3a20 6d61 745b 6e2c 2031 5d20  n op: mat[n, 1] 
-00016340: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-00016350: 2069 6620 272d 7927 2069 6e20 6f70 3a20   if '-y' in op: 
-00016360: 6d61 745b 6e2c 2031 5d20 3d20 2d31 0d0a  mat[n, 1] = -1..
-00016370: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00016380: 7a27 2069 6e20 6f70 3a20 6d61 745b 6e2c  z' in op: mat[n,
-00016390: 2032 5d20 3d20 310d 0a20 2020 2020 2020   2] = 1..       
-000163a0: 2020 2020 2069 6620 272d 7a27 2069 6e20       if '-z' in 
-000163b0: 6f70 3a20 6d61 745b 6e2c 2032 5d20 3d20  op: mat[n, 2] = 
-000163c0: 2d31 0d0a 0d0a 2020 2020 2020 2020 2020  -1....          
-000163d0: 2020 2320 7265 6d6f 7665 2074 6865 7365    # remove these
-000163e0: 2070 6172 7473 0d0a 2020 2020 2020 2020   parts..        
-000163f0: 2020 2020 6f70 203d 206f 702e 7265 706c      op = op.repl
-00016400: 6163 6528 272d 7827 2c20 2727 292e 7265  ace('-x', '').re
-00016410: 706c 6163 6528 2778 272c 2027 2729 0d0a  place('x', '')..
-00016420: 2020 2020 2020 2020 2020 2020 6f70 203d              op =
-00016430: 206f 702e 7265 706c 6163 6528 272d 7927   op.replace('-y'
-00016440: 2c20 2727 292e 7265 706c 6163 6528 2779  , '').replace('y
-00016450: 272c 2027 2729 0d0a 2020 2020 2020 2020  ', '')..        
-00016460: 2020 2020 6f70 203d 206f 702e 7265 706c      op = op.repl
-00016470: 6163 6528 272d 7a27 2c20 2727 292e 7265  ace('-z', '').re
-00016480: 706c 6163 6528 277a 272c 2027 2729 0d0a  place('z', '')..
-00016490: 2020 2020 2020 2020 2020 2020 6f70 203d              op =
-000164a0: 206f 702e 7265 706c 6163 6528 272b 272c   op.replace('+',
-000164b0: 2027 2729 0d0a 0d0a 2020 2020 2020 2020   '')....        
-000164c0: 2020 2020 6966 206c 656e 286f 702e 7374      if len(op.st
-000164d0: 7269 7028 2929 203e 2030 3a0d 0a20 2020  rip()) > 0:..   
-000164e0: 2020 2020 2020 2020 2020 2020 206d 6174               mat
-000164f0: 5b6e 2c20 335d 203d 2065 7661 6c28 6f70  [n, 3] = eval(op
-00016500: 290d 0a20 2020 2020 2020 2073 796d 5f6d  )..        sym_m
-00016510: 6174 202b 3d20 5b6d 6174 5d0d 0a20 2020  at += [mat]..   
-00016520: 2072 6574 7572 6e20 7379 6d5f 6d61 740d   return sym_mat.
-00016530: 0a0d 0a0d 0a64 6566 2073 796d 5f6d 6174  .....def sym_mat
-00016540: 3273 7472 2873 796d 5f6d 6174 2c20 7469  2str(sym_mat, ti
-00016550: 6d65 3d4e 6f6e 6529 3a0d 0a20 2020 2022  me=None):..    "
-00016560: 2222 0d0a 2020 2020 4765 6e65 7261 7465  ""..    Generate
-00016570: 2073 796d 6d65 7472 7920 6f70 6572 6174   symmetry operat
-00016580: 696f 6e20 7374 7269 6e67 2066 726f 6d20  ion string from 
-00016590: 6d61 7472 6978 0d0a 2020 2020 3a70 6172  matrix..    :par
-000165a0: 616d 2073 796d 5f6d 6174 3a20 6172 7261  am sym_mat: arra
-000165b0: 7920 5b33 7833 5d20 6f72 205b 3478 345d  y [3x3] or [4x4]
-000165c0: 0d0a 2020 2020 3a70 6172 616d 2074 696d  ..    :param tim
-000165d0: 653a 202b 2f2d 3120 6f72 204e 6f6e 650d  e: +/-1 or None.
-000165e0: 0a20 2020 203a 7265 7475 726e 3a20 7374  .    :return: st
-000165f0: 7220 2778 2c79 2c7a 282c 3129 270d 0a20  r 'x,y,z(,1)'.. 
-00016600: 2020 2022 2222 0d0a 2020 2020 7379 6d5f     """..    sym_
-00016610: 6d61 7420 3d20 6e70 2e61 7361 7272 6179  mat = np.asarray
-00016620: 2873 796d 5f6d 6174 290d 0a0d 0a20 2020  (sym_mat)....   
-00016630: 2072 6f74 203d 2073 796d 5f6d 6174 5b3a   rot = sym_mat[:
-00016640: 332c 203a 335d 0d0a 2020 2020 6966 2073  3, :3]..    if s
-00016650: 796d 5f6d 6174 2e73 6861 7065 5b31 5d20  ym_mat.shape[1] 
-00016660: 3d3d 2034 3a0d 0a20 2020 2020 2020 2074  == 4:..        t
-00016670: 7261 6e73 203d 2073 796d 5f6d 6174 5b3a  rans = sym_mat[:
-00016680: 2c20 335d 0d0a 2020 2020 656c 7365 3a0d  , 3]..    else:.
-00016690: 0a20 2020 2020 2020 2074 7261 6e73 203d  .        trans =
-000166a0: 206e 702e 7a65 726f 7328 3329 0d0a 0d0a   np.zeros(3)....
-000166b0: 2020 2020 6465 6e6f 6d69 6e61 746f 7273      denominators
-000166c0: 203d 2072 616e 6765 2832 2c20 3829 0d0a   = range(2, 8)..
-000166d0: 2020 2020 6f75 7420 3d20 5b5d 0d0a 2020      out = []..  
-000166e0: 2020 666f 7220 6e20 696e 2072 616e 6765    for n in range
-000166f0: 2833 293a 0d0a 2020 2020 2020 2020 2320  (3):..        # 
-00016700: 436f 6e76 6572 7420 726f 7461 7469 6f6e  Convert rotation
-00016710: 616c 2070 6172 740d 0a20 2020 2020 2020  al part..       
-00016720: 2078 797a 203d 2027 2531 2e33 6778 2b25   xyz = '%1.3gx+%
-00016730: 312e 3367 792b 2531 2e33 677a 2720 2520  1.3gy+%1.3gz' % 
-00016740: 2872 6f74 5b6e 5d5b 305d 2c20 726f 745b  (rot[n][0], rot[
-00016750: 6e5d 5b31 5d2c 2072 6f74 5b6e 5d5b 325d  n][1], rot[n][2]
-00016760: 290d 0a20 2020 2020 2020 2078 797a 203d  )..        xyz =
-00016770: 2072 652e 7375 6228 275b 2b2d 5d3f 305b   re.sub('[+-]?0[
-00016780: 7879 7a5d 272c 2027 272c 2078 797a 292e  xyz]', '', xyz).
-00016790: 7265 706c 6163 6528 2731 272c 2027 2729  replace('1', '')
-000167a0: 2e72 6570 6c61 6365 2827 2b2d 272c 2027  .replace('+-', '
-000167b0: 2d27 292e 7374 7269 7028 272b 2729 0d0a  -').strip('+')..
-000167c0: 0d0a 2020 2020 2020 2020 2320 436f 6e76  ..        # Conv
-000167d0: 6572 7420 7472 616e 736c 6174 696f 6e61  ert translationa
-000167e0: 6c20 7061 7274 0d0a 2020 2020 2020 2020  l part..        
-000167f0: 6966 2061 6273 2874 7261 6e73 5b6e 5d29  if abs(trans[n])
-00016800: 203c 2030 2e30 313a 0d0a 2020 2020 2020   < 0.01:..      
-00016810: 2020 2020 2020 6164 6420 3d20 2727 0d0a        add = ''..
-00016820: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00016830: 2020 2020 2020 2020 2020 2063 686b 203d             chk =
-00016840: 205b 2864 202a 2074 7261 6e73 5b6e 5d29   [(d * trans[n])
-00016850: 2025 2031 203c 2030 2e30 3120 666f 7220   % 1 < 0.01 for 
-00016860: 6420 696e 2064 656e 6f6d 696e 6174 6f72  d in denominator
-00016870: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
-00016880: 6966 2061 6e79 2863 686b 293a 0d0a 2020  if any(chk):..  
-00016890: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000168a0: 6e6f 6d20 3d20 6465 6e6f 6d69 6e61 746f  nom = denominato
-000168b0: 7273 5b63 686b 2e69 6e64 6578 2854 7275  rs[chk.index(Tru
-000168c0: 6529 5d0d 0a20 2020 2020 2020 2020 2020  e)]..           
-000168d0: 2020 2020 2061 6464 203d 2027 2b25 312e       add = '+%1.
-000168e0: 3066 2f25 312e 3066 2720 2520 2864 656e  0f/%1.0f' % (den
-000168f0: 6f6d 202a 2074 7261 6e73 5b6e 5d2c 2064  om * trans[n], d
-00016900: 656e 6f6d 290d 0a20 2020 2020 2020 2020  enom)..         
-00016910: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00016920: 2020 2020 2020 2020 2020 6164 6420 3d20            add = 
-00016930: 272b 2531 2e34 6727 2025 2074 7261 6e73  '+%1.4g' % trans
-00016940: 5b6e 5d0d 0a20 2020 2020 2020 2020 2020  [n]..           
-00016950: 2061 6464 203d 2061 6464 2e72 6570 6c61   add = add.repla
-00016960: 6365 2827 2b2d 272c 2027 2b27 290d 0a20  ce('+-', '+').. 
-00016970: 2020 2020 2020 2023 2070 7269 6e74 286e         # print(n
-00016980: 2c20 726f 745b 6e5d 2c20 7472 616e 735b  , rot[n], trans[
-00016990: 6e5d 2c20 7879 7a2c 2061 6464 290d 0a20  n], xyz, add).. 
-000169a0: 2020 2020 2020 206f 7574 202b 3d20 5b78         out += [x
-000169b0: 797a 202b 2061 6464 5d0d 0a20 2020 2069  yz + add]..    i
-000169c0: 6620 7469 6d65 2069 7320 6e6f 7420 4e6f  f time is not No
-000169d0: 6e65 3a0d 0a20 2020 2020 2020 206f 7574  ne:..        out
-000169e0: 202b 3d20 5b27 252b 312e 3367 2720 2520   += ['%+1.3g' % 
-000169f0: 7469 6d65 5d0d 0a20 2020 2072 6574 7572  time]..    retur
-00016a00: 6e20 272c 272e 6a6f 696e 286f 7574 290d  n ','.join(out).
-00016a10: 0a0d 0a0d 0a64 6566 2073 796d 5f6f 705f  .....def sym_op_
-00016a20: 7265 636f 676e 6973 6572 2873 796d 5f6f  recogniser(sym_o
-00016a30: 7073 293a 0d0a 2020 2020 2222 220d 0a20  ps):..    """.. 
-00016a40: 2020 2045 7661 6c75 6174 6573 2073 796d     Evaluates sym
-00016a50: 6d65 7472 7920 6f70 6572 6174 696f 6e73  metry operations
-00016a60: 2061 6e64 2072 6574 7572 6e73 2073 7472   and returns str
-00016a70: 206e 616d 6520 6f66 206f 7065 7261 7469   name of operati
-00016a80: 6f6e 0d0a 0d0a 2020 2020 446f 6573 6e27  on....    Doesn'
-00016a90: 7420 776f 726b 2079 6574 202d 2077 6f72  t work yet - wor
-00016aa0: 6b73 206f 6e20 7369 6d70 6c65 2073 7973  ks on simple sys
-00016ab0: 7465 6d73 2062 7574 206e 6f74 2074 7269  tems but not tri
-00016ac0: 676f 6e61 6c20 6f72 2068 6578 6167 6f6e  gonal or hexagon
-00016ad0: 616c 206f 7065 7261 7469 6f6e 7320 2d20  al operations - 
-00016ae0: 666f 7220 6578 616d 706c 6520 7367 3136  for example sg16
-00016af0: 370d 0a20 2020 2022 2222 0d0a 2020 2020  7..    """..    
-00016b00: 7072 696e 7428 2744 6f65 736e 7420 776f  print('Doesnt wo
-00016b10: 726b 2079 6574 2121 2127 290d 0a20 2020  rk yet!!!')..   
-00016b20: 2073 796d 5f6f 7073 203d 206e 702e 6173   sym_ops = np.as
-00016b30: 6172 7261 7928 7379 6d5f 6f70 732c 2064  array(sym_ops, d
-00016b40: 7479 7065 3d73 7472 292e 7265 7368 6170  type=str).reshap
-00016b50: 6528 2d31 290d 0a20 2020 2073 796d 5f6d  e(-1)..    sym_m
-00016b60: 6174 7320 3d20 6765 6e5f 7379 6d5f 6d61  ats = gen_sym_ma
-00016b70: 7428 7379 6d5f 6f70 7329 0d0a 2020 2020  t(sym_ops)..    
-00016b80: 4445 4255 4720 3d20 5472 7565 0d0a 2020  DEBUG = True..  
-00016b90: 2020 6f75 7420 3d20 5b5d 0d0a 2020 2020    out = []..    
-00016ba0: 666f 7220 6f70 2c20 6d20 696e 207a 6970  for op, m in zip
-00016bb0: 2873 796d 5f6f 7073 2c20 7379 6d5f 6d61  (sym_ops, sym_ma
-00016bc0: 7473 293a 0d0a 2020 2020 2020 2020 6e73  ts):..        ns
-00016bd0: 203d 206f 702e 636f 756e 7428 272d 2729   = op.count('-')
-00016be0: 2020 2320 303d 7472 616e 736c 6174 696f    # 0=translatio
-00016bf0: 6e2c 2031 3d6d 6972 726f 722c 2032 3d72  n, 1=mirror, 2=r
-00016c00: 6f74 6174 696f 6e2c 2033 3d69 6e76 6572  otation, 3=inver
-00016c10: 7369 6f6e 0d0a 2020 2020 2020 2020 7061  sion..        pa
-00016c20: 7269 7479 203d 206e 702e 6c69 6e61 6c67  rity = np.linalg
-00016c30: 2e64 6574 286d 5b3a 332c 203a 335d 2920  .det(m[:3, :3]) 
-00016c40: 2023 2064 6574 6572 6d69 6e61 6e74 206f   # determinant o
-00016c50: 6620 6f70 6572 6174 696f 6e20 2d20 2b2f  f operation - +/
-00016c60: 2d31 0d0a 2020 2020 2020 2020 7472 616e  -1..        tran
-00016c70: 736c 6174 696f 6e20 3d20 6e70 2e73 756d  slation = np.sum
-00016c80: 286e 702e 6162 7328 6d5b 3a33 2c20 335d  (np.abs(m[:3, 3]
-00016c90: 2929 0d0a 2020 2020 2020 2020 6d73 756d  ))..        msum
-00016ca0: 203d 206e 702e 7375 6d28 6d5b 3a33 2c20   = np.sum(m[:3, 
-00016cb0: 3a33 5d29 0d0a 2020 2020 2020 2020 6173  :3])..        as
-00016cc0: 756d 203d 206e 702e 7375 6d28 6e70 2e61  um = np.sum(np.a
-00016cd0: 6273 286d 5b3a 332c 203a 335d 2929 0d0a  bs(m[:3, :3]))..
-00016ce0: 2020 2020 2020 2020 6966 2044 4542 5547          if DEBUG
-00016cf0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-00016d00: 7269 6e74 2866 227b 6f70 3a32 3073 7d3a  rint(f"{op:20s}:
-00016d10: 206e 733d 7b6e 737d 2c20 7061 7269 7479   ns={ns}, parity
-00016d20: 3d7b 7061 7269 7479 7d2c 2074 7261 6e73  ={parity}, trans
-00016d30: 6c61 7469 6f6e 3d7b 7472 616e 736c 6174  lation={translat
-00016d40: 696f 6e7d 2c20 7375 6d3d 7b6d 7375 6d7d  ion}, sum={msum}
-00016d50: 2c20 6162 7373 756d 3d7b 6173 756d 7d22  , abssum={asum}"
-00016d60: 290d 0a20 2020 2020 2020 2069 6620 6e73  )..        if ns
-00016d70: 203d 3d20 303a 2020 2320 7472 616e 736c   == 0:  # transl
-00016d80: 6174 696f 6e0d 0a20 2020 2020 2020 2020  ation..         
-00016d90: 2020 2069 6620 7472 616e 736c 6174 696f     if translatio
-00016da0: 6e20 3c20 302e 3031 3a0d 0a20 2020 2020  n < 0.01:..     
-00016db0: 2020 2020 2020 2020 2020 206f 7574 202b             out +
-00016dc0: 3d20 5b27 3127 5d0d 0a20 2020 2020 2020  = ['1']..       
-00016dd0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00016de0: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
-00016df0: 2b3d 205b 2774 2825 2e32 672c 252e 3267  += ['t(%.2g,%.2g
-00016e00: 2c25 2e32 6729 2720 2520 286d 5b33 2c20  ,%.2g)' % (m[3, 
-00016e10: 305d 2c20 6d5b 332c 2031 5d2c 206d 5b33  0], m[3, 1], m[3
-00016e20: 2c20 325d 295d 0d0a 2020 2020 2020 2020  , 2])]..        
-00016e30: 656c 6966 206e 7320 3d3d 2033 3a20 2023  elif ns == 3:  #
-00016e40: 2069 6e76 6572 7369 6f6e 0d0a 2020 2020   inversion..    
-00016e50: 2020 2020 2020 2020 6f75 7420 2b3d 205b          out += [
-00016e60: 272d 3127 5d0d 0a20 2020 2020 2020 2065  '-1']..        e
-00016e70: 6c69 6620 7061 7269 7479 203e 2030 3a20  lif parity > 0: 
-00016e80: 2023 2072 6f74 6174 696f 6e0d 0a20 2020   # rotation..   
-00016e90: 2020 2020 2020 2020 2069 6620 7472 616e           if tran
-00016ea0: 736c 6174 696f 6e20 3c20 302e 3031 3a0d  slation < 0.01:.
-00016eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ec0: 206f 7574 202b 3d20 5b27 526f 7461 7469   out += ['Rotati
-00016ed0: 6f6e 275d 0d0a 2020 2020 2020 2020 2020  on']..          
-00016ee0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00016ef0: 2020 2020 2020 2020 206f 7574 202b 3d20           out += 
-00016f00: 5b27 5363 7265 7727 5d0d 0a20 2020 2020  ['Screw']..     
-00016f10: 2020 2065 6c69 6620 7061 7269 7479 203c     elif parity <
-00016f20: 2031 3a20 2023 206d 6972 726f 720d 0a20   1:  # mirror.. 
-00016f30: 2020 2020 2020 2020 2020 2069 6620 7472             if tr
-00016f40: 616e 736c 6174 696f 6e20 3c20 302e 3031  anslation < 0.01
-00016f50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00016f60: 2020 206f 7574 202b 3d20 5b27 4d69 7272     out += ['Mirr
-00016f70: 6f72 275d 0d0a 2020 2020 2020 2020 2020  or']..          
-00016f80: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00016f90: 2020 2020 2020 2020 206f 7574 202b 3d20           out += 
-00016fa0: 5b27 476c 6964 6527 5d0d 0a20 2020 2020  ['Glide']..     
-00016fb0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00016fc0: 2020 2020 2020 6f75 7420 2b3d 205b 2755        out += ['U
-00016fd0: 6e6b 6e6f 776e 275d 0d0a 2020 2020 7265  nknown']..    re
-00016fe0: 7475 726e 206f 7574 0d0a 0d0a 0d0a 6465  turn out......de
-00016ff0: 6620 7379 6d5f 6f70 5f64 6574 2873 796d  f sym_op_det(sym
-00017000: 5f6f 7073 293a 0d0a 2020 2020 2222 220d  _ops):..    """.
-00017010: 0a20 2020 2052 6574 7572 6e20 7468 6520  .    Return the 
-00017020: 6465 7465 726d 696e 616e 7420 6f66 2061  determinant of a
-00017030: 2073 796d 6d65 7472 7920 6f70 6572 6174   symmetry operat
-00017040: 696f 6e0d 0a20 2020 203a 7061 7261 6d20  ion..    :param 
-00017050: 7379 6d5f 6f70 733a 2073 7472 2065 2e67  sym_ops: str e.g
-00017060: 2e20 2778 2c2d 792c 7a2b 312f 3227 206f  . 'x,-y,z+1/2' o
-00017070: 7220 2779 2c20 782b 792c 202d 7a2c 202d  r 'y, x+y, -z, -
-00017080: 3127 206f 7220 6c69 7374 206f 6620 7374  1' or list of st
-00017090: 7220 5b27 782c 792c 7a27 2c2e 2e2e 5d0d  r ['x,y,z',...].
-000170a0: 0a20 2020 203a 7265 7475 726e 3a20 666c  .    :return: fl
-000170b0: 6f61 7420 7c64 6574 7c20 6f72 206c 6973  oat |det| or lis
-000170c0: 7420 6f66 2066 6c6f 6174 730d 0a20 2020  t of floats..   
-000170d0: 2022 2222 0d0a 2020 2020 6d61 7420 3d20   """..    mat = 
-000170e0: 6765 6e5f 7379 6d5f 6d61 7428 7379 6d5f  gen_sym_mat(sym_
-000170f0: 6f70 7329 0d0a 2020 2020 6966 206c 656e  ops)..    if len
-00017100: 286d 6174 2920 3d3d 2031 3a0d 0a20 2020  (mat) == 1:..   
-00017110: 2020 2020 2072 6574 7572 6e20 6e70 2e6c       return np.l
-00017120: 696e 616c 672e 6465 7428 6d61 745b 305d  inalg.det(mat[0]
-00017130: 5b3a 332c 203a 335d 290d 0a20 2020 2072  [:3, :3])..    r
-00017140: 6574 7572 6e20 5b6e 702e 6c69 6e61 6c67  eturn [np.linalg
-00017150: 2e64 6574 286d 5b3a 332c 203a 335d 2920  .det(m[:3, :3]) 
-00017160: 666f 7220 6d20 696e 206d 6174 5d0d 0a0d  for m in mat]...
-00017170: 0a0d 0a64 6566 2067 656e 5f73 796d 5f61  ...def gen_sym_a
-00017180: 7869 616c 5f76 6563 746f 7228 7379 6d5f  xial_vector(sym_
-00017190: 6f70 732c 2078 2c20 792c 207a 293a 0d0a  ops, x, y, z):..
-000171a0: 2020 2020 2222 220d 0a20 2020 2020 5472      """..     Tr
-000171b0: 616e 7366 6f72 6d20 6178 6961 6c20 7665  ansform axial ve
-000171c0: 6374 6f72 2062 7920 7379 6d6d 6574 7279  ctor by symmetry
-000171d0: 206f 7065 7261 7469 6f6e 730d 0a20 2020   operations..   
-000171e0: 2055 7361 6765 3a0d 0a20 2020 2020 2075   Usage:..      u
-000171f0: 7677 203d 2067 656e 5f73 796d 6365 6e5f  vw = gen_symcen_
-00017200: 706f 7328 7379 6d5f 6f70 732c 6365 6e5f  pos(sym_ops,cen_
-00017210: 6f70 732c 782c 792c 7a29 0d0a 2020 2020  ops,x,y,z)..    
-00017220: 2020 7379 6d5f 6f70 7320 3d20 5b6e 2a27    sym_ops = [n*'
-00017230: 782c 792c 7a27 5d20 6172 7261 7920 6f66  x,y,z'] array of
-00017240: 2073 7472 696e 6720 7379 6d6d 6574 7279   string symmetry
-00017250: 206f 7065 7261 7469 6f6e 730d 0a20 2020   operations..   
-00017260: 2020 2063 656e 5f6f 7073 203d 205b 6d2a     cen_ops = [m*
-00017270: 2778 2c79 2c7a 275d 2061 7272 6179 206f  'x,y,z'] array o
-00017280: 6620 7374 7269 6e67 2063 656e 7472 696e  f string centrin
-00017290: 6720 6f70 6572 6174 696f 6e73 0d0a 2020  g operations..  
-000172a0: 2020 2020 782c 792c 7a20 3d20 6672 6163      x,y,z = frac
-000172b0: 7469 6f6e 616c 2063 6f6f 7264 696e 6174  tional coordinat
-000172c0: 6573 206f 6620 6174 6f6d 6963 2070 6f73  es of atomic pos
-000172d0: 6969 746f 6e20 746f 2062 6520 6d6f 6469  iiton to be modi
-000172e0: 6669 6564 2062 7920 7379 6d6d 6574 7279  fied by symmetry
-000172f0: 0d0a 2020 2020 2020 7576 7720 3d20 5b5b  ..      uvw = [[
-00017300: 6e78 335d 5d20 6172 7261 7920 6f66 2073  nx3]] array of s
-00017310: 796d 6d65 7472 7920 6465 6669 6e65 6420  ymmetry defined 
-00017320: 6661 6374 696f 6e61 6c20 636f 6f72 6469  factional coordi
-00017330: 6e61 7465 7320 5b75 2c76 2c77 5d0d 0a0d  nates [u,v,w]...
-00017340: 0a20 2020 2045 2e47 2e0d 0a20 2020 2020  .    E.G...     
-00017350: 2075 7677 203d 2067 656e 5f73 796d 6365   uvw = gen_symce
-00017360: 6e5f 706f 7328 5b27 782c 792c 7a27 2c27  n_pos(['x,y,z','
-00017370: 792c 2d78 2c7a 2b31 2f32 275d 2c5b 2778  y,-x,z+1/2'],['x
-00017380: 2c79 2c7a 272c 2778 2b31 2f33 2c79 2b31  ,y,z','x+1/3,y+1
-00017390: 2f33 2c7a 275d 2c30 2e31 2c30 2e32 2c30  /3,z'],0.1,0.2,0
-000173a0: 2e33 290d 0a20 2020 2020 2075 7677 203e  .3)..      uvw >
-000173b0: 3e20 5b5b 302e 312c 302e 322c 302e 335d  > [[0.1,0.2,0.3]
-000173c0: 202c 205b 302e 3433 332c 302e 3533 332c   , [0.433,0.533,
-000173d0: 302e 335d 202c 205b 302e 322c 2d30 2e31  0.3] , [0.2,-0.1
-000173e0: 2c30 2e38 5d20 2c20 5b30 2e35 3333 2c2d  ,0.8] , [0.533,-
-000173f0: 302e 3233 332c 302e 385d 5d0d 0a20 2020  0.233,0.8]]..   
-00017400: 203a 7061 7261 6d20 7379 6d5f 6f70 733a   :param sym_ops:
-00017410: 0d0a 2020 2020 3a70 6172 616d 2078 3a0d  ..    :param x:.
-00017420: 0a20 2020 203a 7061 7261 6d20 793a 0d0a  .    :param y:..
-00017430: 2020 2020 3a70 6172 616d 207a 3a0d 0a20      :param z:.. 
-00017440: 2020 203a 7265 7475 726e 3a0d 0a20 2020     :return:..   
-00017450: 2022 2222 0d0a 2020 2020 6d61 7420 3d20   """..    mat = 
-00017460: 6765 6e5f 7379 6d5f 6d61 7428 7379 6d5f  gen_sym_mat(sym_
-00017470: 6f70 7329 0d0a 2020 2020 7265 7475 726e  ops)..    return
-00017480: 205b 6e70 2e6c 696e 616c 672e 6465 7428   [np.linalg.det(
-00017490: 6d5b 3a33 2c20 3a33 5d29 202a 206e 702e  m[:3, :3]) * np.
-000174a0: 646f 7428 6d5b 3a33 2c20 3a33 5d2c 2028  dot(m[:3, :3], (
-000174b0: 782c 2079 2c20 7a29 2920 666f 7220 6d20  x, y, z)) for m 
-000174c0: 696e 206d 6174 5d0d 0a0d 0a0d 0a64 6566  in mat]......def
-000174d0: 2069 6e76 6572 745f 7379 6d28 7379 6d5f   invert_sym(sym_
-000174e0: 6f70 293a 0d0a 2020 2020 2222 220d 0a20  op):..    """.. 
-000174f0: 2020 2049 6e76 6572 7420 7468 6520 7369     Invert the si
-00017500: 676e 206f 6620 7468 6520 6769 7665 6e20  gn of the given 
-00017510: 7379 6d6d 6574 7279 206f 7065 7261 7469  symmetry operati
-00017520: 6f6e 0d0a 2020 2020 5573 6167 653a 0d0a  on..    Usage:..
-00017530: 2020 2020 2020 6e65 775f 6f70 203d 2069        new_op = i
-00017540: 6e76 6572 745f 7379 6d28 7379 6d5f 6f70  nvert_sym(sym_op
-00017550: 290d 0a20 2020 2020 2073 796d 5f6f 7020  )..      sym_op 
-00017560: 3d20 7374 7220 7379 6d6d 6574 7279 206f  = str symmetry o
-00017570: 7065 7261 7469 6f6e 2065 2e67 2e20 2778  peration e.g. 'x
-00017580: 2c79 2c7a 270d 0a20 2020 2020 206e 6577  ,y,z'..      new
-00017590: 5f6f 7020 3d20 696e 7665 7274 6564 2073  _op = inverted s
-000175a0: 796d 6d65 7472 790d 0a20 2020 2045 2e47  ymmetry..    E.G
-000175b0: 2e0d 0a20 2020 2020 206e 6577 5f6f 7020  ...      new_op 
-000175c0: 3d20 696e 7665 7274 5f73 796d 2827 782c  = invert_sym('x,
-000175d0: 792c 7a27 290d 0a20 2020 2020 203e 3e20  y,z')..      >> 
-000175e0: 6e65 775f 6f70 203d 2027 2d78 2c2d 792c  new_op = '-x,-y,
-000175f0: 2d7a 270d 0a20 2020 2022 2222 0d0a 2020  -z'..    """..  
-00017600: 2020 7379 6d5f 6f70 203d 2073 796d 5f6f    sym_op = sym_o
-00017610: 702e 6c6f 7765 7228 290d 0a20 2020 206e  p.lower()..    n
-00017620: 6577 5f6f 7020 3d20 7379 6d5f 6f70 2e72  ew_op = sym_op.r
-00017630: 6570 6c61 6365 2827 7827 2c20 272d 7827  eplace('x', '-x'
-00017640: 292e 7265 706c 6163 6528 2779 272c 2027  ).replace('y', '
-00017650: 2d79 2729 2e72 6570 6c61 6365 2827 7a27  -y').replace('z'
-00017660: 2c20 272d 7a27 292e 7265 706c 6163 6528  , '-z').replace(
-00017670: 272d 2d27 2c20 272b 2729 2e72 6570 6c61  '--', '+').repla
-00017680: 6365 2827 2b2d 272c 2027 2d27 290d 0a20  ce('+-', '-').. 
-00017690: 2020 2072 6574 7572 6e20 6e65 775f 6f70     return new_op
-000176a0: 0d0a 0d0a 0d0a 6465 6620 7379 6d5f 6f70  ......def sym_op
-000176b0: 5f74 696d 6528 6f70 6572 6174 696f 6e73  _time(operations
-000176c0: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
-000176d0: 2052 6574 7572 6e20 7468 6520 7469 6d65   Return the time
-000176e0: 2073 796d 6d65 7472 7920 6f66 2061 2073   symmetry of a s
-000176f0: 796d 6d65 7472 7920 6f70 6572 6174 696f  ymmetry operatio
-00017700: 6e0d 0a20 2020 203a 7061 7261 6d20 6f70  n..    :param op
-00017710: 6572 6174 696f 6e73 3a20 6c69 7374 2873  erations: list(s
-00017720: 7472 2920 652e 672e 205b 2778 2c2d 792c  tr) e.g. ['x,-y,
-00017730: 7a2b 312f 3227 2c20 2779 2c20 782b 792c  z+1/2', 'y, x+y,
-00017740: 202d 7a2c 202d 3127 5d0d 0a20 2020 203a   -z, -1']..    :
-00017750: 7265 7475 726e 3a20 6c69 7374 2c20 2b2f  return: list, +/
-00017760: 2d31 0d0a 2020 2020 2222 220d 0a20 2020  -1..    """..   
-00017770: 206f 7065 7261 7469 6f6e 7320 3d20 6e70   operations = np
-00017780: 2e61 7361 7272 6179 286f 7065 7261 7469  .asarray(operati
-00017790: 6f6e 7329 2e72 6573 6861 7065 282d 3129  ons).reshape(-1)
-000177a0: 0d0a 2020 2020 745f 6f70 203d 206e 702e  ..    t_op = np.
-000177b0: 656d 7074 7928 6c65 6e28 6f70 6572 6174  empty(len(operat
-000177c0: 696f 6e73 2929 0d0a 2020 2020 666f 7220  ions))..    for 
-000177d0: 6e2c 2073 796d 5f6f 7020 696e 2065 6e75  n, sym_op in enu
-000177e0: 6d65 7261 7465 286f 7065 7261 7469 6f6e  merate(operation
-000177f0: 7329 3a0d 0a20 2020 2020 2020 206f 7073  s):..        ops
-00017800: 203d 2073 796d 5f6f 702e 7370 6c69 7428   = sym_op.split(
-00017810: 272c 2729 0d0a 2020 2020 2020 2020 6966  ',')..        if
-00017820: 206c 656e 286f 7073 2920 3c20 343a 0d0a   len(ops) < 4:..
-00017830: 2020 2020 2020 2020 2020 2020 745f 6f70              t_op
-00017840: 5b6e 5d20 3d20 310d 0a20 2020 2020 2020  [n] = 1..       
-00017850: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00017860: 2020 2020 745f 6f70 5b6e 5d20 3d20 696e      t_op[n] = in
-00017870: 7428 6f70 735b 335d 290d 0a20 2020 2072  t(ops[3])..    r
-00017880: 6574 7572 6e20 6c69 7374 2874 5f6f 7029  eturn list(t_op)
-00017890: 0d0a 0d0a 0d0a 6465 6620 7379 6d5f 6f70  ......def sym_op
-000178a0: 5f6d 7828 6f70 6572 6174 696f 6e73 293a  _mx(operations):
-000178b0: 0d0a 2020 2020 2222 220d 0a20 2020 2043  ..    """..    C
-000178c0: 6f6e 7665 7274 2065 6163 6820 6f70 6572  onvert each oper
-000178d0: 6174 696f 6e20 6672 6f6d 2078 2c79 2c7a  ation from x,y,z
-000178e0: 2074 6f20 6d78 2c6d 792c 6d7a 0d0a 2020   to mx,my,mz..  
-000178f0: 2020 3a70 6172 616d 206f 7065 7261 7469    :param operati
-00017900: 6f6e 733a 205b 2778 2c79 2c7a 272c 5d0d  ons: ['x,y,z',].
-00017910: 0a20 2020 203a 7265 7475 726e 3a20 5b27  .    :return: ['
-00017920: 6d78 2c6d 792c 6d7a 272c 5d0d 0a20 2020  mx,my,mz',]..   
-00017930: 2022 2222 0d0a 2020 2020 6f70 6572 6174   """..    operat
-00017940: 696f 6e73 203d 206c 6973 7428 6e70 2e61  ions = list(np.a
-00017950: 7361 7272 6179 286f 7065 7261 7469 6f6e  sarray(operation
-00017960: 7329 2e72 6573 6861 7065 282d 3129 290d  s).reshape(-1)).
-00017970: 0a20 2020 2066 6f72 206e 2069 6e20 7261  .    for n in ra
-00017980: 6e67 6528 6c65 6e28 6f70 6572 6174 696f  nge(len(operatio
-00017990: 6e73 2929 3a0d 0a20 2020 2020 2020 2069  ns)):..        i
-000179a0: 6620 276d 7827 2069 6e20 6f70 6572 6174  f 'mx' in operat
-000179b0: 696f 6e73 5b6e 5d3a 2063 6f6e 7469 6e75  ions[n]: continu
-000179c0: 650d 0a20 2020 2020 2020 206f 7065 7261  e..        opera
-000179d0: 7469 6f6e 735b 6e5d 203d 206f 7065 7261  tions[n] = opera
-000179e0: 7469 6f6e 735b 6e5d 2e72 6570 6c61 6365  tions[n].replace
-000179f0: 2827 7827 2c20 276d 7827 292e 7265 706c  ('x', 'mx').repl
-00017a00: 6163 6528 2779 272c 2027 6d79 2729 2e72  ace('y', 'my').r
-00017a10: 6570 6c61 6365 2827 7a27 2c20 276d 7a27  eplace('z', 'mz'
-00017a20: 290d 0a20 2020 2072 6574 7572 6e20 6f70  )..    return op
-00017a30: 6572 6174 696f 6e73 0d0a 0d0a 0d0a 6465  erations......de
-00017a40: 6620 7379 6d6d 6574 7279 5f6f 7073 326d  f symmetry_ops2m
-00017a50: 6167 6e65 7469 6328 6f70 6572 6174 696f  agnetic(operatio
-00017a60: 6e73 293a 0d0a 2020 2020 2222 220d 0a20  ns):..    """.. 
-00017a70: 2020 2043 6f6e 7665 7274 206c 6973 7420     Convert list 
-00017a80: 6f66 2073 7472 696e 6720 7379 6d6d 6574  of string symmet
-00017a90: 7279 206f 7065 7261 7469 6f6e 7320 746f  ry operations to
-00017aa0: 206d 6167 6e65 7469 6320 7379 6d6d 6574   magnetic symmet
-00017ab0: 7279 206f 7065 7261 7469 6f6e 730d 0a20  ry operations.. 
-00017ac0: 2020 2053 6565 2056 6573 7461 5f4d 616e     See Vesta_Man
-00017ad0: 7561 6c2e 7064 6620 5365 6374 696f 6e20  ual.pdf Section 
-00017ae0: 392e 312e 3120 2243 7265 6174 696f 6e20  9.1.1 "Creation 
-00017af0: 616e 6420 6564 6974 696e 6720 6f66 2061  and editing of a
-00017b00: 2076 6563 746f 7222 0d0a 2020 2020 4d61   vector"..    Ma
-00017b10: 676e 6574 6963 2073 796d 6d65 7472 790d  gnetic symmetry.
-00017b20: 0a20 2020 2020 2020 20c2 b527 203d 2054  .        ..' = T
-00017b30: 504d c2b5 0d0a 2020 2020 5420 3d20 5469  PM....    T = Ti
-00017b40: 6d65 206f 7065 7261 746f 7273 2078 2c79  me operators x,y
-00017b50: 2c7a 2c28 2b31 290d 0a20 2020 2050 203d  ,z,(+1)..    P =
-00017b60: 2050 6172 6974 7920 6f70 6572 6174 6f72   Parity operator
-00017b70: 2028 6465 7465 726d 696e 616e 7420 6f66   (determinant of
-00017b80: 204d 290d 0a20 2020 204d 203d 2053 796d   M)..    M = Sym
-00017b90: 6d65 7472 7920 6f70 6572 6174 6f72 2077  metry operator w
-00017ba0: 6974 686f 7574 2074 7261 6e73 6c61 7469  ithout translati
-00017bb0: 6f6e 730d 0a0d 0a20 2020 203a 7061 7261  ons....    :para
-00017bc0: 6d20 6f70 6572 6174 696f 6e73 3a20 6c69  m operations: li
-00017bd0: 7374 206f 6620 7374 7220 5b27 782c 792c  st of str ['x,y,
-00017be0: 7a27 2c5d 0d0a 2020 2020 3a72 6574 7572  z',]..    :retur
-00017bf0: 6e3a 206c 6973 7420 6f66 2073 7472 205b  n: list of str [
-00017c00: 2778 2c79 2c7a 275d 0d0a 2020 2020 2222  'x,y,z']..    ""
-00017c10: 220d 0a20 2020 206f 7065 7261 7469 6f6e  "..    operation
-00017c20: 7320 3d20 6e70 2e61 7361 7272 6179 286f  s = np.asarray(o
-00017c30: 7065 7261 7469 6f6e 7329 2e72 6573 6861  perations).resha
-00017c40: 7065 282d 3129 0d0a 2020 2020 2320 436f  pe(-1)..    # Co
-00017c50: 6e76 6572 7420 6f70 6572 6174 696f 6e73  nvert operations
-00017c60: 2074 6f20 6d61 7472 6963 6573 0d0a 2020   to matrices..  
-00017c70: 2020 6d61 745f 6f70 7320 3d20 6765 6e5f    mat_ops = gen_
-00017c80: 7379 6d5f 6d61 7428 6f70 6572 6174 696f  sym_mat(operatio
-00017c90: 6e73 290d 0a20 2020 2074 696d 5f6f 7073  ns)..    tim_ops
-00017ca0: 203d 2073 796d 5f6f 705f 7469 6d65 286f   = sym_op_time(o
-00017cb0: 7065 7261 7469 6f6e 7329 0d0a 2020 2020  perations)..    
-00017cc0: 7374 725f 6f70 7320 3d20 5b5d 0d0a 2020  str_ops = []..  
-00017cd0: 2020 666f 7220 6e2c 206d 6174 2069 6e20    for n, mat in 
-00017ce0: 656e 756d 6572 6174 6528 6d61 745f 6f70  enumerate(mat_op
-00017cf0: 7329 3a0d 0a20 2020 2020 2020 2023 2047  s):..        # G
-00017d00: 6574 2074 696d 6520 6f70 6572 6174 696f  et time operatio
-00017d10: 6e0d 0a20 2020 2020 2020 2074 203d 2074  n..        t = t
-00017d20: 696d 5f6f 7073 5b6e 5d0d 0a0d 0a20 2020  im_ops[n]....   
-00017d30: 2020 2020 2023 204f 6e6c 7920 7573 6520       # Only use 
-00017d40: 726f 7461 7469 6f6e 616c 2070 6172 740d  rotational part.
-00017d50: 0a20 2020 2020 2020 206d 203d 206d 6174  .        m = mat
-00017d60: 5b3a 332c 203a 335d 0d0a 0d0a 2020 2020  [:3, :3]....    
-00017d70: 2020 2020 2320 4765 7420 7061 7269 7479      # Get parity
-00017d80: 0d0a 2020 2020 2020 2020 7020 3d20 6e70  ..        p = np
-00017d90: 2e6c 696e 616c 672e 6465 7428 6d29 0d0a  .linalg.det(m)..
-00017da0: 0d0a 2020 2020 2020 2020 2320 4765 6e65  ..        # Gene
-00017db0: 7261 7465 2073 7472 696e 670d 0a20 2020  rate string..   
-00017dc0: 2020 2020 206d 6167 5f73 7472 203d 2073       mag_str = s
-00017dd0: 796d 5f6d 6174 3273 7472 2874 202a 2070  ym_mat2str(t * p
-00017de0: 202a 206d 290d 0a20 2020 2020 2020 2023   * m)..        #
-00017df0: 206d 6167 5f73 7472 203d 206d 6167 5f73   mag_str = mag_s
-00017e00: 7472 2e72 6570 6c61 6365 2827 7827 2c20  tr.replace('x', 
-00017e10: 276d 7827 292e 7265 706c 6163 6528 2779  'mx').replace('y
-00017e20: 272c 2027 6d79 2729 2e72 6570 6c61 6365  ', 'my').replace
-00017e30: 2827 7a27 2c20 276d 7a27 290d 0a20 2020  ('z', 'mz')..   
-00017e40: 2020 2020 2073 7472 5f6f 7073 202b 3d20       str_ops += 
-00017e50: 5b6d 6167 5f73 7472 5d0d 0a20 2020 2072  [mag_str]..    r
-00017e60: 6574 7572 6e20 7374 725f 6f70 730d 0a0d  eturn str_ops...
-00017e70: 0a0d 0a64 6566 206f 7274 686f 676f 6e61  ...def orthogona
-00017e80: 6c5f 6178 6573 2878 5f61 7869 733d 2831  l_axes(x_axis=(1
-00017e90: 2c20 302c 2030 292c 2079 5f61 7869 733d  , 0, 0), y_axis=
-00017ea0: 2830 2c20 312c 2030 2929 3a0d 0a20 2020  (0, 1, 0)):..   
-00017eb0: 2022 2222 0d0a 2020 2020 5265 7475 726e   """..    Return
-00017ec0: 7320 6f72 7468 6f67 6f6e 616c 2072 6967  s orthogonal rig
-00017ed0: 6874 2d68 616e 6465 6420 6361 7274 6573  ht-handed cartes
-00017ee0: 6961 6e20 6178 6573 2062 6173 6564 206f  ian axes based o
-00017ef0: 6e20 7468 6520 706c 616e 6520 6f66 2074  n the plane of t
-00017f00: 776f 206e 6f6e 2d70 6572 7065 6e64 6963  wo non-perpendic
-00017f10: 756c 6172 2076 6563 746f 7273 0d0a 2020  ular vectors..  
-00017f20: 2020 452e 472e 0d0a 2020 2020 2020 2020    E.G...        
-00017f30: 782c 792c 7a20 3d20 6f72 7468 6f67 6f6e  x,y,z = orthogon
-00017f40: 616c 5f61 7865 7328 5b31 2c30 2c30 5d2c  al_axes([1,0,0],
-00017f50: 5b30 2e35 2c30 2e35 2c30 5d29 0d0a 2020  [0.5,0.5,0])..  
-00017f60: 2020 2020 2020 3e3e 2078 203d 2061 7272        >> x = arr
-00017f70: 6179 285b 312c 302c 305d 290d 0a20 2020  ay([1,0,0])..   
-00017f80: 2020 2020 203e 3e20 7920 3d20 6172 7261       >> y = arra
-00017f90: 7928 5b30 2c31 2c30 5d29 0d0a 2020 2020  y([0,1,0])..    
-00017fa0: 2020 2020 3e3e 207a 203d 2061 7272 6179      >> z = array
-00017fb0: 285b 302c 302c 315d 290d 0a20 2020 2045  ([0,0,1])..    E
-00017fc0: 2e47 2e0d 0a20 2020 2020 2020 2078 2c79  .G...        x,y
-00017fd0: 2c7a 203d 206f 7274 686f 676f 6e61 6c5f  ,z = orthogonal_
-00017fe0: 6178 6573 285b 302c 312c 305d 2c5b 302c  axes([0,1,0],[0,
-00017ff0: 302c 315d 290d 0a20 2020 2020 2020 203e  0,1])..        >
-00018000: 3e20 7820 3d20 6172 7261 7928 5b30 2c31  > x = array([0,1
-00018010: 2c30 5d29 0d0a 2020 2020 2020 2020 3e3e  ,0])..        >>
-00018020: 2079 203d 2061 7272 6179 285b 302c 302c   y = array([0,0,
-00018030: 315d 290d 0a20 2020 2020 2020 203e 3e20  1])..        >> 
-00018040: 7a20 3d20 6172 7261 7928 5b31 2c30 2c30  z = array([1,0,0
-00018050: 5d29 0d0a 2020 2020 2222 220d 0a0d 0a20  ])..    """.... 
-00018060: 2020 2078 5f63 6172 7420 3d20 6667 2e6e     x_cart = fg.n
-00018070: 6f72 6d28 785f 6178 6973 290d 0a20 2020  orm(x_axis)..   
-00018080: 2079 5f63 6172 7420 3d20 6667 2e6e 6f72   y_cart = fg.nor
-00018090: 6d28 795f 6178 6973 290d 0a20 2020 207a  m(y_axis)..    z
-000180a0: 5f63 6172 7420 3d20 6667 2e6e 6f72 6d28  _cart = fg.norm(
-000180b0: 6e70 2e63 726f 7373 2878 5f63 6172 742c  np.cross(x_cart,
-000180c0: 2079 5f63 6172 7429 2920 2023 207a 2069   y_cart))  # z i
-000180d0: 7320 7065 7270 2e20 746f 2078 2b79 0d0a  s perp. to x+y..
-000180e0: 2020 2020 795f 6361 7274 203d 206e 702e      y_cart = np.
-000180f0: 6372 6f73 7328 785f 6361 7274 2c20 7a5f  cross(x_cart, z_
-00018100: 6361 7274 2920 2023 206d 616b 6520 7375  cart)  # make su
-00018110: 7265 2079 2069 7320 7065 7270 2e20 746f  re y is perp. to
-00018120: 2078 0d0a 2020 2020 7265 7475 726e 2078   x..    return x
-00018130: 5f63 6172 742c 2079 5f63 6172 742c 207a  _cart, y_cart, z
-00018140: 5f63 6172 740d 0a0d 0a0d 0a27 2d2d 2d2d  _cart......'----
-00018150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018160: 2d2d 2d2d 2d2d 2d2d 436f 6e76 6572 7369  --------Conversi
-00018170: 6f6e 732d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ons-------------
-00018180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018190: 2d2d 270d 0a0d 0a0d 0a64 6566 2067 656e  --'......def gen
-000181a0: 5f6c 6174 7469 6365 5f70 6172 616d 6574  _lattice_paramet
-000181b0: 6572 7328 6c61 7474 6963 655f 7061 7261  ers(lattice_para
-000181c0: 6d65 7465 7273 3d28 292c 202a 6172 6773  meters=(), *args
-000181d0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-000181e0: 2020 2222 220d 0a20 2020 2047 656e 6572    """..    Gener
-000181f0: 6174 6520 6c69 7374 206f 6620 6c61 7474  ate list of latt
-00018200: 6963 6520 7061 7261 6d65 7465 7273 3a0d  ice parameters:.
-00018210: 0a20 2020 2020 612c 622c 632c 616c 7068  .     a,b,c,alph
-00018220: 612c 6265 7461 2c67 616d 6d61 203d 2067  a,beta,gamma = g
-00018230: 656e 5f6c 6174 7469 6365 5f70 6172 616d  en_lattice_param
-00018240: 6574 6572 7328 6172 6773 290d 0a20 2020  eters(args)..   
-00018250: 2061 7267 733a 0d0a 2020 2020 2020 3120   args:..      1 
-00018260: 2d3e 2061 3d62 3d63 3d31 2c61 6c70 6861  -> a=b=c=1,alpha
-00018270: 3d62 6574 613d 6761 6d6d 613d 3930 0d0a  =beta=gamma=90..
-00018280: 2020 2020 2020 5b31 2c32 2c33 5d20 2d3e        [1,2,3] ->
-00018290: 2061 3d31 2c62 3d32 2c63 3d33 2c61 6c70   a=1,b=2,c=3,alp
-000182a0: 6861 3d62 6574 613d 6761 6d6d 613d 3930  ha=beta=gamma=90
-000182b0: 0d0a 2020 2020 2020 5b31 2c32 2c33 2c31  ..      [1,2,3,1
-000182c0: 3230 5d20 2d3e 2061 3d31 2c62 3d32 2c63  20] -> a=1,b=2,c
-000182d0: 3d33 2c61 6c70 6861 3d62 6574 613d 3930  =3,alpha=beta=90
-000182e0: 2c67 616d 6d61 3d31 3230 0d0a 2020 2020  ,gamma=120..    
-000182f0: 2020 5b31 2c32 2c33 2c31 302c 3230 2c33    [1,2,3,10,20,3
-00018300: 305d 202d 3e20 613d 312c 623d 322c 633d  0] -> a=1,b=2,c=
-00018310: 332c 616c 7068 613d 3130 2c62 6574 613d  3,alpha=10,beta=
-00018320: 3230 2c67 616d 6d61 3d33 300d 0a20 2020  20,gamma=30..   
-00018330: 2020 2031 2c32 2c33 2c31 302c 3230 2c33     1,2,3,10,20,3
-00018340: 3020 2d3e 2061 3d31 2c62 3d32 2c63 3d33  0 -> a=1,b=2,c=3
-00018350: 2c61 6c70 6861 3d31 302c 6265 7461 3d32  ,alpha=10,beta=2
-00018360: 302c 6761 6d6d 613d 3330 0d0a 2020 2020  0,gamma=30..    
-00018370: 2020 613d 312c 623d 322c 633d 332c 616c    a=1,b=2,c=3,al
-00018380: 7068 613d 3130 2c62 6574 613d 3230 2c67  pha=10,beta=20,g
-00018390: 616d 6d61 3d33 3020 2d3e 2061 3d31 2c62  amma=30 -> a=1,b
-000183a0: 3d32 2c63 3d33 2c61 6c70 6861 3d31 302c  =2,c=3,alpha=10,
-000183b0: 6265 7461 3d32 302c 6761 6d6d 613d 3330  beta=20,gamma=30
-000183c0: 0d0a 2020 2020 3a70 6172 616d 206c 6174  ..    :param lat
-000183d0: 7469 6365 5f70 6172 616d 6574 6572 733a  tice_parameters:
-000183e0: 2066 6c6f 6174 206f 7220 6c69 7374 0d0a   float or list..
-000183f0: 2020 2020 3a70 6172 616d 2061 7267 733a      :param args:
-00018400: 2066 6c6f 6174 730d 0a20 2020 203a 7061   floats..    :pa
-00018410: 7261 6d20 6b77 6172 6773 3a20 6c61 7474  ram kwargs: latt
-00018420: 6963 6520 7061 7261 6d65 7465 7273 0d0a  ice parameters..
-00018430: 2020 2020 3a72 6574 7572 6e3a 2061 2c62      :return: a,b
-00018440: 2c63 2c61 6c70 6861 2c62 6574 612c 6761  ,c,alpha,beta,ga
-00018450: 6d6d 610d 0a20 2020 2022 2222 0d0a 0d0a  mma..    """....
-00018460: 2020 2020 6c61 7474 6963 655f 7061 7261      lattice_para
-00018470: 6d65 7465 7273 203d 206e 702e 6172 7261  meters = np.arra
-00018480: 7928 6c61 7474 6963 655f 7061 7261 6d65  y(lattice_parame
-00018490: 7465 7273 2c20 6474 7970 653d 666c 6f61  ters, dtype=floa
-000184a0: 7429 2e72 6573 6861 7065 282d 3129 0d0a  t).reshape(-1)..
-000184b0: 2020 2020 6c61 7474 6963 655f 7061 7261      lattice_para
-000184c0: 6d65 7465 7273 203d 206e 702e 6170 7065  meters = np.appe
-000184d0: 6e64 286c 6174 7469 6365 5f70 6172 616d  nd(lattice_param
-000184e0: 6574 6572 732c 2061 7267 7329 0d0a 2020  eters, args)..  
-000184f0: 2020 6966 206c 656e 286c 6174 7469 6365    if len(lattice
-00018500: 5f70 6172 616d 6574 6572 7329 206e 6f74  _parameters) not
-00018510: 2069 6e20 5b30 2c20 312c 2033 2c20 342c   in [0, 1, 3, 4,
-00018520: 2036 5d3a 0d0a 2020 2020 2020 2020 7261   6]:..        ra
-00018530: 6973 6520 4578 6365 7074 696f 6e28 2749  ise Exception('I
-00018540: 6e63 6f72 7265 6374 206e 756d 6265 7220  ncorrect number 
-00018550: 6f66 206c 6174 7469 6365 2070 6172 616d  of lattice param
-00018560: 6574 6572 7327 290d 0a20 2020 2061 203d  eters')..    a =
-00018570: 2062 203d 2063 203d 2031 2e30 0d0a 2020   b = c = 1.0..  
-00018580: 2020 616c 7068 6120 3d20 6265 7461 203d    alpha = beta =
-00018590: 2067 616d 6d61 203d 2039 302e 300d 0a0d   gamma = 90.0...
-000185a0: 0a20 2020 2069 6620 6c65 6e28 6c61 7474  .    if len(latt
-000185b0: 6963 655f 7061 7261 6d65 7465 7273 2920  ice_parameters) 
-000185c0: 3e20 303a 0d0a 2020 2020 2020 2020 6120  > 0:..        a 
-000185d0: 3d20 6c61 7474 6963 655f 7061 7261 6d65  = lattice_parame
-000185e0: 7465 7273 5b30 5d0d 0a20 2020 2020 2020  ters[0]..       
-000185f0: 2062 203d 2031 2e30 202a 2061 0d0a 2020   b = 1.0 * a..  
-00018600: 2020 2020 2020 6320 3d20 312e 3020 2a20        c = 1.0 * 
-00018610: 610d 0a0d 0a20 2020 2069 6620 6c65 6e28  a....    if len(
-00018620: 6c61 7474 6963 655f 7061 7261 6d65 7465  lattice_paramete
-00018630: 7273 2920 3e20 313a 0d0a 2020 2020 2020  rs) > 1:..      
-00018640: 2020 6220 3d20 6c61 7474 6963 655f 7061    b = lattice_pa
-00018650: 7261 6d65 7465 7273 5b31 5d0d 0a20 2020  rameters[1]..   
-00018660: 2020 2020 2063 203d 206c 6174 7469 6365       c = lattice
-00018670: 5f70 6172 616d 6574 6572 735b 325d 0d0a  _parameters[2]..
-00018680: 0d0a 2020 2020 6966 206c 656e 286c 6174  ..    if len(lat
-00018690: 7469 6365 5f70 6172 616d 6574 6572 7329  tice_parameters)
-000186a0: 203d 3d20 343a 0d0a 2020 2020 2020 2020   == 4:..        
-000186b0: 6761 6d6d 6120 3d20 6c61 7474 6963 655f  gamma = lattice_
-000186c0: 7061 7261 6d65 7465 7273 5b33 5d0d 0a0d  parameters[3]...
-000186d0: 0a20 2020 2069 6620 6c65 6e28 6c61 7474  .    if len(latt
-000186e0: 6963 655f 7061 7261 6d65 7465 7273 2920  ice_parameters) 
-000186f0: 3d3d 2036 3a0d 0a20 2020 2020 2020 2061  == 6:..        a
-00018700: 6c70 6861 203d 206c 6174 7469 6365 5f70  lpha = lattice_p
-00018710: 6172 616d 6574 6572 735b 335d 0d0a 2020  arameters[3]..  
-00018720: 2020 2020 2020 6265 7461 203d 206c 6174        beta = lat
-00018730: 7469 6365 5f70 6172 616d 6574 6572 735b  tice_parameters[
-00018740: 345d 0d0a 2020 2020 2020 2020 6761 6d6d  4]..        gamm
-00018750: 6120 3d20 6c61 7474 6963 655f 7061 7261  a = lattice_para
-00018760: 6d65 7465 7273 5b35 5d0d 0a0d 0a20 2020  meters[5]....   
-00018770: 2069 6620 2761 2720 696e 206b 7761 7267   if 'a' in kwarg
-00018780: 733a 0d0a 2020 2020 2020 2020 6120 3d20  s:..        a = 
-00018790: 666c 6f61 7428 6b77 6172 6773 2e67 6574  float(kwargs.get
-000187a0: 2827 6127 2929 0d0a 2020 2020 6966 2027  ('a'))..    if '
-000187b0: 6227 2069 6e20 6b77 6172 6773 3a0d 0a20  b' in kwargs:.. 
-000187c0: 2020 2020 2020 2062 203d 2066 6c6f 6174         b = float
-000187d0: 286b 7761 7267 732e 6765 7428 2762 2729  (kwargs.get('b')
-000187e0: 290d 0a20 2020 2069 6620 2763 2720 696e  )..    if 'c' in
-000187f0: 206b 7761 7267 733a 0d0a 2020 2020 2020   kwargs:..      
-00018800: 2020 6320 3d20 666c 6f61 7428 6b77 6172    c = float(kwar
-00018810: 6773 2e67 6574 2827 6327 2929 0d0a 2020  gs.get('c'))..  
-00018820: 2020 6966 2027 616c 7068 6127 2069 6e20    if 'alpha' in 
-00018830: 6b77 6172 6773 3a0d 0a20 2020 2020 2020  kwargs:..       
-00018840: 2061 6c70 6861 203d 2066 6c6f 6174 286b   alpha = float(k
-00018850: 7761 7267 732e 6765 7428 2761 6c70 6861  wargs.get('alpha
-00018860: 2729 290d 0a20 2020 2069 6620 2762 6574  '))..    if 'bet
-00018870: 6127 2069 6e20 6b77 6172 6773 3a0d 0a20  a' in kwargs:.. 
-00018880: 2020 2020 2020 2062 6574 6120 3d20 666c         beta = fl
-00018890: 6f61 7428 6b77 6172 6773 2e67 6574 2827  oat(kwargs.get('
-000188a0: 6265 7461 2729 290d 0a20 2020 2069 6620  beta'))..    if 
-000188b0: 2767 616d 6d61 2720 696e 206b 7761 7267  'gamma' in kwarg
-000188c0: 733a 0d0a 2020 2020 2020 2020 6761 6d6d  s:..        gamm
-000188d0: 6120 3d20 666c 6f61 7428 6b77 6172 6773  a = float(kwargs
-000188e0: 2e67 6574 2827 6761 6d6d 6127 2929 0d0a  .get('gamma'))..
-000188f0: 2020 2020 7265 7475 726e 2061 2c20 622c      return a, b,
-00018900: 2063 2c20 616c 7068 612c 2062 6574 612c   c, alpha, beta,
-00018910: 2067 616d 6d61 0d0a 0d0a 0d0a 6465 6620   gamma......def 
-00018920: 6c61 7470 6172 3275 7628 6c61 7474 6963  latpar2uv(lattic
-00018930: 655f 7061 7261 6d65 7465 7273 3d28 292c  e_parameters=(),
-00018940: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00018950: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
-00018960: 2043 6f6e 7665 7274 2061 2c62 2c63 2c61   Convert a,b,c,a
-00018970: 6c70 6861 2c62 6574 612c 6761 6d6d 6120  lpha,beta,gamma 
-00018980: 746f 2055 563d 5b41 2c42 2c43 5d0d 0a20  to UV=[A,B,C].. 
-00018990: 2020 2020 5556 203d 206c 6174 7061 7232      UV = latpar2
-000189a0: 7576 2861 2c62 2c63 2c61 6c70 6861 3d39  uv(a,b,c,alpha=9
-000189b0: 302e 2c62 6574 613d 3930 2e2c 6761 6d6d  0.,beta=90.,gamm
-000189c0: 613d 3132 302e 290d 0a20 2020 2020 5665  a=120.)..     Ve
-000189d0: 6374 6f72 2063 2069 7320 6465 6669 6e65  ctor c is define
-000189e0: 6420 616c 6f6e 6720 5b30 2c30 2c31 5d0d  d along [0,0,1].
-000189f0: 0a20 2020 2020 5665 6374 6f72 2061 2061  .     Vector a a
-00018a00: 6e64 2062 2061 7265 2064 6566 696e 6564  nd b are defined
-00018a10: 2062 7920 7468 6520 616e 676c 6573 0d0a   by the angles..
-00018a20: 2020 2020 2222 220d 0a20 2020 2061 2c20      """..    a, 
-00018a30: 622c 2063 2c20 616c 7068 612c 2062 6574  b, c, alpha, bet
-00018a40: 612c 2067 616d 6d61 203d 2067 656e 5f6c  a, gamma = gen_l
-00018a50: 6174 7469 6365 5f70 6172 616d 6574 6572  attice_parameter
-00018a60: 7328 6c61 7474 6963 655f 7061 7261 6d65  s(lattice_parame
-00018a70: 7465 7273 2c20 2a61 7267 732c 202a 2a6b  ters, *args, **k
-00018a80: 7761 7267 7329 0d0a 0d0a 2020 2020 2320  wargs)....    # 
-00018a90: 4672 6f6d 2068 7474 703a 2f2f 7079 6d61  From http://pyma
-00018aa0: 7467 656e 2e6f 7267 2f5f 6d6f 6475 6c65  tgen.org/_module
-00018ab0: 732f 7079 6d61 7467 656e 2f63 6f72 652f  s/pymatgen/core/
-00018ac0: 6c61 7474 6963 652e 6874 6d6c 0d0a 2020  lattice.html..  
-00018ad0: 2020 616c 7068 615f 7220 3d20 6e70 2e72    alpha_r = np.r
-00018ae0: 6164 6961 6e73 2861 6c70 6861 290d 0a20  adians(alpha).. 
-00018af0: 2020 2062 6574 615f 7220 3d20 6e70 2e72     beta_r = np.r
-00018b00: 6164 6961 6e73 2862 6574 6129 0d0a 2020  adians(beta)..  
-00018b10: 2020 6761 6d6d 615f 7220 3d20 6e70 2e72    gamma_r = np.r
-00018b20: 6164 6961 6e73 2867 616d 6d61 290d 0a20  adians(gamma).. 
-00018b30: 2020 2076 616c 203d 2028 6e70 2e63 6f73     val = (np.cos
-00018b40: 2861 6c70 6861 5f72 2920 2a20 6e70 2e63  (alpha_r) * np.c
-00018b50: 6f73 2862 6574 615f 7229 202d 206e 702e  os(beta_r) - np.
-00018b60: 636f 7328 6761 6d6d 615f 7229 2920 5c0d  cos(gamma_r)) \.
-00018b70: 0a20 2020 2020 2020 2020 202f 2028 6e70  .          / (np
-00018b80: 2e73 696e 2861 6c70 6861 5f72 2920 2a20  .sin(alpha_r) * 
-00018b90: 6e70 2e73 696e 2862 6574 615f 7229 290d  np.sin(beta_r)).
-00018ba0: 0a20 2020 2023 2053 6f6d 6574 696d 6573  .    # Sometimes
-00018bb0: 2072 6f75 6e64 696e 6720 6572 726f 7273   rounding errors
-00018bc0: 2072 6573 756c 7420 696e 2076 616c 7565   result in value
-00018bd0: 7320 736c 6967 6874 6c79 203e 2031 2e0d  s slightly > 1..
-00018be0: 0a20 2020 2076 616c 203d 2061 6273 2876  .    val = abs(v
-00018bf0: 616c 290d 0a20 2020 2067 616d 6d61 5f73  al)..    gamma_s
-00018c00: 7461 7220 3d20 6e70 2e61 7263 636f 7328  tar = np.arccos(
-00018c10: 7661 6c29 0d0a 2020 2020 6161 203d 205b  val)..    aa = [
-00018c20: 6120 2a20 6e70 2e73 696e 2862 6574 615f  a * np.sin(beta_
-00018c30: 7229 2c20 302e 302c 2061 202a 206e 702e  r), 0.0, a * np.
-00018c40: 636f 7328 6265 7461 5f72 295d 0d0a 2020  cos(beta_r)]..  
-00018c50: 2020 6262 203d 205b 2d62 202a 206e 702e    bb = [-b * np.
-00018c60: 7369 6e28 616c 7068 615f 7229 202a 206e  sin(alpha_r) * n
-00018c70: 702e 636f 7328 6761 6d6d 615f 7374 6172  p.cos(gamma_star
-00018c80: 292c 0d0a 2020 2020 2020 2020 2020 6220  ),..          b 
-00018c90: 2a20 6e70 2e73 696e 2861 6c70 6861 5f72  * np.sin(alpha_r
-00018ca0: 2920 2a20 6e70 2e73 696e 2867 616d 6d61  ) * np.sin(gamma
-00018cb0: 5f73 7461 7229 2c0d 0a20 2020 2020 2020  _star),..       
-00018cc0: 2020 2062 202a 206e 702e 636f 7328 616c     b * np.cos(al
-00018cd0: 7068 615f 7229 5d0d 0a20 2020 2063 6320  pha_r)]..    cc 
-00018ce0: 3d20 5b30 2e30 2c20 302e 302c 2063 5d0d  = [0.0, 0.0, c].
-00018cf0: 0a0d 0a20 2020 2072 6574 7572 6e20 6e70  ...    return np
-00018d00: 2e72 6f75 6e64 286e 702e 6172 7261 7928  .round(np.array(
-00018d10: 5b61 612c 2062 622c 2063 635d 292c 2038  [aa, bb, cc]), 8
-00018d20: 290d 0a0d 0a0d 0a64 6566 206c 6174 7061  )......def latpa
-00018d30: 7232 7576 5f72 6f74 286c 6174 7469 6365  r2uv_rot(lattice
-00018d40: 5f70 6172 616d 6574 6572 733d 2829 2c20  _parameters=(), 
-00018d50: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-00018d60: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-00018d70: 436f 6e76 6572 7420 612c 622c 632c 616c  Convert a,b,c,al
-00018d80: 7068 612c 6265 7461 2c67 616d 6d61 2074  pha,beta,gamma t
-00018d90: 6f20 5556 3d5b 412c 422c 435d 0d0a 2020  o UV=[A,B,C]..  
-00018da0: 2020 2055 5620 3d20 6c61 7470 6172 3275     UV = latpar2u
-00018db0: 765f 726f 7428 612c 622c 632c 616c 7068  v_rot(a,b,c,alph
-00018dc0: 613d 3930 2e2c 6265 7461 3d39 302e 2c67  a=90.,beta=90.,g
-00018dd0: 616d 6d61 3d31 3230 2e29 0d0a 2020 2020  amma=120.)..    
-00018de0: 2056 6563 746f 7220 6220 6973 2064 6566   Vector b is def
-00018df0: 696e 6564 2061 6c6f 6e67 205b 302c 312c  ined along [0,1,
-00018e00: 305d 0d0a 2020 2020 2056 6563 746f 7220  0]..     Vector 
-00018e10: 6120 616e 6420 6320 6172 6520 6465 6669  a and c are defi
-00018e20: 6e65 6420 6279 2074 6865 2061 6e67 6c65  ned by the angle
-00018e30: 730d 0a20 2020 2022 2222 0d0a 2020 2020  s..    """..    
-00018e40: 612c 2062 2c20 632c 2061 6c70 6861 2c20  a, b, c, alpha, 
-00018e50: 6265 7461 2c20 6761 6d6d 6120 3d20 6765  beta, gamma = ge
-00018e60: 6e5f 6c61 7474 6963 655f 7061 7261 6d65  n_lattice_parame
-00018e70: 7465 7273 286c 6174 7469 6365 5f70 6172  ters(lattice_par
-00018e80: 616d 6574 6572 732c 202a 6172 6773 2c20  ameters, *args, 
-00018e90: 2a2a 6b77 6172 6773 290d 0a0d 0a20 2020  **kwargs)....   
-00018ea0: 2023 2046 726f 6d20 6874 7470 3a2f 2f70   # From http://p
-00018eb0: 796d 6174 6765 6e2e 6f72 672f 5f6d 6f64  ymatgen.org/_mod
-00018ec0: 756c 6573 2f70 796d 6174 6765 6e2f 636f  ules/pymatgen/co
-00018ed0: 7265 2f6c 6174 7469 6365 2e68 746d 6c0d  re/lattice.html.
-00018ee0: 0a20 2020 2061 6c70 6861 5f72 203d 206e  .    alpha_r = n
-00018ef0: 702e 7261 6469 616e 7328 616c 7068 6129  p.radians(alpha)
-00018f00: 0d0a 2020 2020 6265 7461 5f72 203d 206e  ..    beta_r = n
-00018f10: 702e 7261 6469 616e 7328 6761 6d6d 6129  p.radians(gamma)
-00018f20: 0d0a 2020 2020 6761 6d6d 615f 7220 3d20  ..    gamma_r = 
-00018f30: 6e70 2e72 6164 6961 6e73 2862 6574 6129  np.radians(beta)
-00018f40: 0d0a 2020 2020 7661 6c20 3d20 286e 702e  ..    val = (np.
-00018f50: 636f 7328 616c 7068 615f 7229 202a 206e  cos(alpha_r) * n
-00018f60: 702e 636f 7328 6265 7461 5f72 2920 2d20  p.cos(beta_r) - 
-00018f70: 6e70 2e63 6f73 2867 616d 6d61 5f72 2929  np.cos(gamma_r))
-00018f80: 205c 0d0a 2020 2020 2020 2020 2020 2f20   \..          / 
-00018f90: 286e 702e 7369 6e28 616c 7068 615f 7229  (np.sin(alpha_r)
-00018fa0: 202a 206e 702e 7369 6e28 6265 7461 5f72   * np.sin(beta_r
-00018fb0: 2929 0d0a 2020 2020 2320 536f 6d65 7469  ))..    # Someti
-00018fc0: 6d65 7320 726f 756e 6469 6e67 2065 7272  mes rounding err
-00018fd0: 6f72 7320 7265 7375 6c74 2069 6e20 7661  ors result in va
-00018fe0: 6c75 6573 2073 6c69 6768 746c 7920 3e20  lues slightly > 
-00018ff0: 312e 0d0a 2020 2020 7661 6c20 3d20 6162  1...    val = ab
-00019000: 7328 7661 6c29 0d0a 2020 2020 6761 6d6d  s(val)..    gamm
-00019010: 615f 7374 6172 203d 206e 702e 6172 6363  a_star = np.arcc
-00019020: 6f73 2876 616c 290d 0a20 2020 2061 6120  os(val)..    aa 
-00019030: 3d20 5b61 202a 206e 702e 7369 6e28 6265  = [a * np.sin(be
-00019040: 7461 5f72 292c 2061 202a 206e 702e 636f  ta_r), a * np.co
-00019050: 7328 6265 7461 5f72 292c 2030 2e30 5d0d  s(beta_r), 0.0].
-00019060: 0a20 2020 2062 6220 3d20 5b30 2e30 2c20  .    bb = [0.0, 
-00019070: 622c 2030 2e30 5d0d 0a20 2020 2063 6320  b, 0.0]..    cc 
-00019080: 3d20 5b2d 6320 2a20 6e70 2e73 696e 2861  = [-c * np.sin(a
-00019090: 6c70 6861 5f72 2920 2a20 6e70 2e63 6f73  lpha_r) * np.cos
-000190a0: 2867 616d 6d61 5f73 7461 7229 2c0d 0a20  (gamma_star),.. 
-000190b0: 2020 2020 2020 2020 2063 202a 206e 702e           c * np.
-000190c0: 636f 7328 616c 7068 615f 7229 2c0d 0a20  cos(alpha_r),.. 
-000190d0: 2020 2020 2020 2020 2063 202a 206e 702e           c * np.
-000190e0: 7369 6e28 616c 7068 615f 7229 202a 206e  sin(alpha_r) * n
-000190f0: 702e 7369 6e28 6761 6d6d 615f 7374 6172  p.sin(gamma_star
-00019100: 295d 0d0a 0d0a 2020 2020 7265 7475 726e  )]....    return
-00019110: 206e 702e 726f 756e 6428 6e70 2e61 7272   np.round(np.arr
-00019120: 6179 285b 6161 2c20 6262 2c20 6363 5d29  ay([aa, bb, cc])
-00019130: 2c20 3829 0d0a 0d0a 0d0a 6465 6620 5556  , 8)......def UV
-00019140: 326c 6174 7061 7228 5556 293a 0d0a 2020  2latpar(UV):..  
-00019150: 2020 2222 220d 0a20 2020 2043 6f6e 7665    """..    Conve
-00019160: 7274 2055 563d 5b61 2c62 2c63 5d20 746f  rt UV=[a,b,c] to
-00019170: 2061 2c62 2c63 2c61 6c70 6861 2c62 6574   a,b,c,alpha,bet
-00019180: 612c 6761 6d6d 610d 0a20 2020 2020 612c  a,gamma..     a,
-00019190: 622c 632c 616c 7068 612c 6265 7461 2c67  b,c,alpha,beta,g
-000191a0: 616d 6d61 203d 2055 5632 6c61 7470 6172  amma = UV2latpar
-000191b0: 2855 5629 0d0a 2020 2020 2222 220d 0a0d  (UV)..    """...
-000191c0: 0a20 2020 2061 203d 206e 702e 7371 7274  .    a = np.sqrt
-000191d0: 286e 702e 7375 6d28 5556 5b30 5d20 2a2a  (np.sum(UV[0] **
-000191e0: 2032 2929 0d0a 2020 2020 6220 3d20 6e70   2))..    b = np
-000191f0: 2e73 7172 7428 6e70 2e73 756d 2855 565b  .sqrt(np.sum(UV[
-00019200: 315d 202a 2a20 3229 290d 0a20 2020 2063  1] ** 2))..    c
-00019210: 203d 206e 702e 7371 7274 286e 702e 7375   = np.sqrt(np.su
-00019220: 6d28 5556 5b32 5d20 2a2a 2032 2929 0d0a  m(UV[2] ** 2))..
-00019230: 2020 2020 616c 7068 6120 3d20 6e70 2e61      alpha = np.a
-00019240: 7263 7461 6e32 286e 702e 6c69 6e61 6c67  rctan2(np.linalg
-00019250: 2e6e 6f72 6d28 6e70 2e63 726f 7373 2855  .norm(np.cross(U
-00019260: 565b 315d 2c20 5556 5b32 5d29 292c 206e  V[1], UV[2])), n
-00019270: 702e 646f 7428 5556 5b31 5d2c 2055 565b  p.dot(UV[1], UV[
-00019280: 325d 2929 202a 2031 3830 202f 206e 702e  2])) * 180 / np.
-00019290: 7069 0d0a 2020 2020 6265 7461 203d 206e  pi..    beta = n
-000192a0: 702e 6172 6374 616e 3228 6e70 2e6c 696e  p.arctan2(np.lin
-000192b0: 616c 672e 6e6f 726d 286e 702e 6372 6f73  alg.norm(np.cros
-000192c0: 7328 5556 5b30 5d2c 2055 565b 325d 2929  s(UV[0], UV[2]))
-000192d0: 2c20 6e70 2e64 6f74 2855 565b 305d 2c20  , np.dot(UV[0], 
-000192e0: 5556 5b32 5d29 2920 2a20 3138 3020 2f20  UV[2])) * 180 / 
-000192f0: 6e70 2e70 690d 0a20 2020 2067 616d 6d61  np.pi..    gamma
-00019300: 203d 206e 702e 6172 6374 616e 3228 6e70   = np.arctan2(np
-00019310: 2e6c 696e 616c 672e 6e6f 726d 286e 702e  .linalg.norm(np.
-00019320: 6372 6f73 7328 5556 5b30 5d2c 2055 565b  cross(UV[0], UV[
-00019330: 315d 2929 2c20 6e70 2e64 6f74 2855 565b  1])), np.dot(UV[
-00019340: 305d 2c20 5556 5b31 5d29 2920 2a20 3138  0], UV[1])) * 18
-00019350: 3020 2f20 6e70 2e70 690d 0a20 2020 2072  0 / np.pi..    r
-00019360: 6574 7572 6e20 612c 2062 2c20 632c 2061  eturn a, b, c, a
-00019370: 6c70 6861 2c20 6265 7461 2c20 6761 6d6d  lpha, beta, gamm
-00019380: 610d 0a0d 0a0d 0a64 6566 2068 6b6c 3251  a......def hkl2Q
-00019390: 2868 6b6c 2c20 5556 7374 6172 293a 0d0a  (hkl, UVstar):..
-000193a0: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
-000193b0: 7665 7274 2072 6566 6c65 6374 696f 6e20  vert reflection 
-000193c0: 696e 6469 6365 7320 2868 6b6c 2920 746f  indices (hkl) to
-000193d0: 206f 7274 686f 676f 6e61 6c20 6261 7369   orthogonal basi
-000193e0: 7320 696e 2041 2d31 0d0a 2020 2020 3a70  s in A-1..    :p
-000193f0: 6172 616d 2068 6b6c 3a20 5b6e 7833 5d20  aram hkl: [nx3] 
-00019400: 6172 7261 7920 6f66 2072 6566 6c65 6374  array of reflect
-00019410: 696f 6e73 0d0a 2020 2020 3a70 6172 616d  ions..    :param
-00019420: 2055 563a 205b 3378 335d 2061 7272 6179   UV: [3x3] array
-00019430: 206f 6620 756e 6974 2063 656c 6c20 7665   of unit cell ve
-00019440: 6374 6f72 7320 5b5b 6131 2c61 322c 6133  ctors [[a1,a2,a3
-00019450: 5d2c 5b62 312c 6232 2c62 335d 2c5b 6331  ],[b1,b2,b3],[c1
-00019460: 2c63 322c 6333 5d5d 0d0a 2020 2020 3a72  ,c2,c3]]..    :r
-00019470: 6574 7572 6e3a 205b 6e78 335d 2061 7272  eturn: [nx3] arr
-00019480: 6179 206f 6620 7761 7665 7665 6374 6f72  ay of wavevector
-00019490: 7320 696e 2061 6e20 6f72 7468 6f67 6f6e  s in an orthogon
-000194a0: 616c 2062 6173 6973 2c20 696e 2041 2d31  al basis, in A-1
-000194b0: 0d0a 2020 2020 2222 220d 0a20 2020 2072  ..    """..    r
-000194c0: 6574 7572 6e20 6e70 2e64 6f74 2868 6b6c  eturn np.dot(hkl
-000194d0: 2c20 5556 7374 6172 290d 0a0d 0a0d 0a64  , UVstar)......d
-000194e0: 6566 2051 3268 6b6c 2871 7665 632c 2055  ef Q2hkl(qvec, U
-000194f0: 5673 7461 7229 3a0d 0a20 2020 2022 2222  Vstar):..    """
-00019500: 0d0a 2020 2020 496e 6465 7820 7665 6374  ..    Index vect
-00019510: 6f72 7320 696e 2061 6e20 6f72 7468 6f6e  ors in an orthon
-00019520: 616c 2062 6173 6973 2077 6974 6820 6120  al basis with a 
-00019530: 7265 6369 7072 6f63 616c 2062 6173 6973  reciprocal basis
-00019540: 0d0a 2020 2020 3a70 6172 616d 2071 7665  ..    :param qve
-00019550: 633a 205b 6e78 335d 2061 7272 6179 206f  c: [nx3] array o
-00019560: 6620 636f 6f72 6469 6e61 7465 7320 696e  f coordinates in
-00019570: 2061 6e20 6f72 7468 6f67 6f6e 616c 2062   an orthogonal b
-00019580: 6173 6973 2069 6e20 412d 310d 0a20 2020  asis in A-1..   
-00019590: 203a 7061 7261 6d20 5556 3a20 5b33 7833   :param UV: [3x3
-000195a0: 5d20 6172 7261 7920 6f66 2075 6e69 7420  ] array of unit 
-000195b0: 6365 6c6c 2076 6563 746f 7273 205b 5b61  cell vectors [[a
-000195c0: 312c 6132 2c61 335d 2c5b 6231 2c62 322c  1,a2,a3],[b1,b2,
-000195d0: 6233 5d2c 5b63 312c 6332 2c63 335d 5d0d  b3],[c1,c2,c3]].
-000195e0: 0a20 2020 203a 7265 7475 726e 3a20 5b6e  .    :return: [n
-000195f0: 7833 5d20 6172 7261 7920 6f66 2076 6563  x3] array of vec
-00019600: 746f 7273 2069 6e20 7265 6369 7072 6f63  tors in reciproc
-00019610: 616c 206c 6174 7469 6365 2075 6e69 7473  al lattice units
-00019620: 0d0a 2020 2020 2222 220d 0a20 2020 2072  ..    """..    r
-00019630: 6574 7572 6e20 6667 2e69 6e64 6578 5f63  eturn fg.index_c
-00019640: 6f6f 7264 696e 6174 6573 2871 7665 632c  oordinates(qvec,
-00019650: 2055 5673 7461 7229 0d0a 0d0a 0d0a 6465   UVstar)......de
-00019660: 6620 686b 6c32 516d 6167 2868 6b6c 2c20  f hkl2Qmag(hkl, 
-00019670: 5556 7374 6172 293a 0d0a 2020 2020 2222  UVstar):..    ""
-00019680: 220d 0a20 2020 2043 616c 6375 616c 7465  "..    Calcualte
-00019690: 206d 6167 6e69 7475 6465 206f 6620 5120   magnitude of Q 
-000196a0: 6672 6f6d 2068 6b6c 2072 6566 6c65 6374  from hkl reflect
-000196b0: 696f 6e0d 0a20 2020 203a 7061 7261 6d20  ion..    :param 
-000196c0: 686b 6c3a 205b 6e78 335d 2061 7272 6179  hkl: [nx3] array
-000196d0: 206f 6620 7265 666c 6563 7469 6f6e 730d   of reflections.
-000196e0: 0a20 2020 203a 7061 7261 6d20 5556 3a20  .    :param UV: 
-000196f0: 5b33 7833 5d20 6172 7261 7920 6f66 2075  [3x3] array of u
-00019700: 6e69 7420 6365 6c6c 2076 6563 746f 7273  nit cell vectors
-00019710: 0d0a 2020 2020 3a72 6574 7572 6e3a 205b  ..    :return: [
-00019720: 6e78 315d 2061 7272 6179 206f 6620 7761  nx1] array of wa
-00019730: 7665 7665 6374 6f72 206d 6167 6e69 7475  vevector magnitu
-00019740: 6465 732c 2069 6e20 412d 310d 0a20 2020  des, in A-1..   
-00019750: 2022 2222 0d0a 2020 2020 5120 3d20 6e70   """..    Q = np
-00019760: 2e64 6f74 2868 6b6c 2c20 5556 7374 6172  .dot(hkl, UVstar
-00019770: 290d 0a20 2020 2072 6574 7572 6e20 6667  )..    return fg
-00019780: 2e6d 6167 2851 290d 0a0d 0a0d 0a64 6566  .mag(Q)......def
-00019790: 2068 6b6c 3274 776f 7468 6574 6128 686b   hkl2twotheta(hk
-000197a0: 6c2c 2055 5673 7461 722c 2065 6e65 7267  l, UVstar, energ
-000197b0: 795f 6b65 763d 3137 2e37 3934 293a 0d0a  y_kev=17.794):..
-000197c0: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
-000197d0: 6375 616c 7465 2064 2d73 7061 6369 6e67  cualte d-spacing
-000197e0: 2066 726f 6d20 686b 6c20 7265 666c 6563   from hkl reflec
-000197f0: 7469 6f6e 0d0a 2020 2020 3a70 6172 616d  tion..    :param
-00019800: 2068 6b6c 3a20 5b6e 7833 5d20 6172 7261   hkl: [nx3] arra
-00019810: 7920 6f66 2072 6566 6c65 6374 696f 6e73  y of reflections
-00019820: 0d0a 2020 2020 3a70 6172 616d 2055 563a  ..    :param UV:
-00019830: 205b 3378 335d 2061 7272 6179 206f 6620   [3x3] array of 
-00019840: 756e 6974 2063 656c 6c20 7665 6374 6f72  unit cell vector
-00019850: 730d 0a20 2020 203a 7061 7261 6d20 656e  s..    :param en
-00019860: 6572 6779 5f6b 6576 3a20 666c 6f61 7420  ergy_kev: float 
-00019870: 656e 6572 6779 2069 6e20 6b65 560d 0a20  energy in keV.. 
-00019880: 2020 203a 7265 7475 726e 3a20 5b6e 7831     :return: [nx1
-00019890: 5d20 6172 7261 7920 6f66 2064 2d73 7061  ] array of d-spa
-000198a0: 6369 6e67 2069 6e20 410d 0a20 2020 2022  cing in A..    "
-000198b0: 2222 0d0a 2020 2020 7120 3d20 6e70 2e64  ""..    q = np.d
-000198c0: 6f74 2868 6b6c 2c20 5556 7374 6172 290d  ot(hkl, UVstar).
-000198d0: 0a20 2020 2071 5f6d 6167 203d 2066 672e  .    q_mag = fg.
-000198e0: 6d61 6728 7129 0d0a 2020 2020 7265 7475  mag(q)..    retu
-000198f0: 726e 2063 616c 3274 6865 7461 2871 5f6d  rn cal2theta(q_m
-00019900: 6167 2c20 656e 6572 6779 5f6b 6576 290d  ag, energy_kev).
-00019910: 0a0d 0a0d 0a64 6566 2068 6b6c 3264 7370  .....def hkl2dsp
-00019920: 6163 6528 686b 6c2c 2055 5673 7461 7229  ace(hkl, UVstar)
-00019930: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-00019940: 4361 6c63 7561 6c74 6520 642d 7370 6163  Calcualte d-spac
-00019950: 696e 6720 6672 6f6d 2068 6b6c 2072 6566  ing from hkl ref
-00019960: 6c65 6374 696f 6e0d 0a20 2020 203a 7061  lection..    :pa
-00019970: 7261 6d20 686b 6c3a 205b 6e78 335d 2061  ram hkl: [nx3] a
-00019980: 7272 6179 206f 6620 7265 666c 6563 7469  rray of reflecti
-00019990: 6f6e 730d 0a20 2020 203a 7061 7261 6d20  ons..    :param 
-000199a0: 5556 3a20 5b33 7833 5d20 6172 7261 7920  UV: [3x3] array 
-000199b0: 6f66 2072 6563 6970 726f 6361 6c20 756e  of reciprocal un
-000199c0: 6974 2063 656c 6c20 7665 6374 6f72 730d  it cell vectors.
-000199d0: 0a20 2020 203a 7265 7475 726e 3a20 5b6e  .    :return: [n
-000199e0: 7831 5d20 6172 7261 7920 6f66 2064 2d73  x1] array of d-s
-000199f0: 7061 6369 6e67 2069 6e20 410d 0a20 2020  pacing in A..   
-00019a00: 2022 2222 0d0a 2020 2020 5120 3d20 6e70   """..    Q = np
-00019a10: 2e64 6f74 2868 6b6c 2c20 5556 7374 6172  .dot(hkl, UVstar
-00019a20: 290d 0a20 2020 2051 6d61 6720 3d20 6667  )..    Qmag = fg
-00019a30: 2e6d 6167 2851 290d 0a20 2020 2072 6574  .mag(Q)..    ret
-00019a40: 7572 6e20 7132 6473 7061 6365 2851 6d61  urn q2dspace(Qma
-00019a50: 6729 0d0a 0d0a 0d0a 6465 6620 6c61 7474  g)......def latt
-00019a60: 6963 655f 686b 6c32 6473 7061 6365 2868  ice_hkl2dspace(h
-00019a70: 6b6c 2c20 6c61 7474 6963 655f 7061 7261  kl, lattice_para
-00019a80: 6d65 7465 7273 3d28 292c 202a 6172 6773  meters=(), *args
-00019a90: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00019aa0: 2020 2222 220d 0a20 2020 2043 616c 6375    """..    Calcu
-00019ab0: 616c 7465 2064 7370 6163 6520 6672 6f6d  alte dspace from
-00019ac0: 206c 6174 7469 6365 2070 6172 616d 6574   lattice paramet
-00019ad0: 6572 730d 0a20 2020 203a 7061 7261 6d20  ers..    :param 
-00019ae0: 686b 6c3a 205b 6e78 335d 2061 7272 6179  hkl: [nx3] array
-00019af0: 206f 6620 7265 666c 6563 7469 6f6e 730d   of reflections.
-00019b00: 0a20 2020 203a 7061 7261 6d20 6c61 7474  .    :param latt
-00019b10: 6963 655f 7061 7261 6d65 7465 7273 3a20  ice_parameters: 
-00019b20: 612c 622c 632c 616c 7068 612c 6265 7461  a,b,c,alpha,beta
-00019b30: 2c67 616d 6d61 0d0a 2020 2020 3a72 6574  ,gamma..    :ret
-00019b40: 7572 6e3a 2066 6c6f 6174 2c20 642d 7370  urn: float, d-sp
-00019b50: 6163 696e 6720 696e 2041 0d0a 2020 2020  acing in A..    
-00019b60: 2222 220d 0a20 2020 2075 7620 3d20 6c61  """..    uv = la
-00019b70: 7470 6172 3275 7628 6c61 7474 6963 655f  tpar2uv(lattice_
-00019b80: 7061 7261 6d65 7465 7273 2c20 2a61 7267  parameters, *arg
-00019b90: 732c 202a 2a6b 7761 7267 7329 0d0a 2020  s, **kwargs)..  
-00019ba0: 2020 7576 7320 3d20 5263 5370 2875 7629    uvs = RcSp(uv)
-00019bb0: 0d0a 2020 2020 7265 7475 726e 2068 6b6c  ..    return hkl
-00019bc0: 3264 7370 6163 6528 686b 6c2c 2075 7673  2dspace(hkl, uvs
-00019bd0: 290d 0a0d 0a0d 0a64 6566 206c 6174 7469  )......def latti
-00019be0: 6365 5f68 6b6c 3274 776f 7468 6574 6128  ce_hkl2twotheta(
-00019bf0: 686b 6c2c 2065 6e65 7267 795f 6b65 763d  hkl, energy_kev=
-00019c00: 3137 2e37 3934 2c20 6c61 7474 6963 655f  17.794, lattice_
-00019c10: 7061 7261 6d65 7465 7273 3d28 292c 202a  parameters=(), *
-00019c20: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-00019c30: 0d0a 2020 2020 2222 220d 0a20 2020 2043  ..    """..    C
-00019c40: 616c 6375 616c 7465 2064 7370 6163 6520  alcualte dspace 
-00019c50: 6672 6f6d 206c 6174 7469 6365 2070 6172  from lattice par
-00019c60: 616d 6574 6572 730d 0a20 2020 203a 7061  ameters..    :pa
-00019c70: 7261 6d20 686b 6c3a 205b 6e78 335d 2061  ram hkl: [nx3] a
-00019c80: 7272 6179 206f 6620 7265 666c 6563 7469  rray of reflecti
-00019c90: 6f6e 730d 0a20 2020 203a 7061 7261 6d20  ons..    :param 
-00019ca0: 656e 6572 6779 5f6b 6576 3a20 666c 6f61  energy_kev: floa
-00019cb0: 742c 2072 6164 6961 7469 6f6e 2065 6e65  t, radiation ene
-00019cc0: 7267 7920 696e 206b 6556 0d0a 2020 2020  rgy in keV..    
-00019cd0: 3a70 6172 616d 206c 6174 7469 6365 5f70  :param lattice_p
-00019ce0: 6172 616d 6574 6572 733a 2061 2c62 2c63  arameters: a,b,c
-00019cf0: 2c61 6c70 6861 2c62 6574 612c 6761 6d6d  ,alpha,beta,gamm
-00019d00: 610d 0a20 2020 203a 7265 7475 726e 3a20  a..    :return: 
-00019d10: 666c 6f61 742c 2064 2d73 7061 6369 6e67  float, d-spacing
-00019d20: 2069 6e20 410d 0a20 2020 2022 2222 0d0a   in A..    """..
-00019d30: 2020 2020 7576 203d 206c 6174 7061 7232      uv = latpar2
-00019d40: 7576 286c 6174 7469 6365 5f70 6172 616d  uv(lattice_param
-00019d50: 6574 6572 732c 202a 6172 6773 2c20 2a2a  eters, *args, **
-00019d60: 6b77 6172 6773 290d 0a20 2020 2075 7673  kwargs)..    uvs
-00019d70: 203d 2052 6353 7028 7576 290d 0a20 2020   = RcSp(uv)..   
-00019d80: 2072 6574 7572 6e20 686b 6c32 7477 6f74   return hkl2twot
-00019d90: 6865 7461 2868 6b6c 2c20 7576 732c 2065  heta(hkl, uvs, e
-00019da0: 6e65 7267 795f 6b65 7629 0d0a 0d0a 0d0a  nergy_kev)......
-00019db0: 6465 6620 6361 6c71 6d61 6728 7477 6f74  def calqmag(twot
-00019dc0: 6865 7461 2c20 656e 6572 6779 5f6b 6576  heta, energy_kev
-00019dd0: 3d31 372e 3739 3429 3a0d 0a20 2020 2022  =17.794):..    "
-00019de0: 2222 0d0a 2020 2020 4361 6c63 756c 6174  ""..    Calculat
-00019df0: 6520 7c51 7c20 6174 2061 2070 6172 7469  e |Q| at a parti
-00019e00: 6375 6c61 7220 322d 7468 6574 6120 2864  cular 2-theta (d
-00019e10: 6567 2920 666f 7220 656e 6572 6779 2069  eg) for energy i
-00019e20: 6e20 6b65 560d 0a20 2020 2020 6d61 6751  n keV..     magQ
-00019e30: 203d 2063 616c 716d 6167 2874 776f 7468   = calqmag(twoth
-00019e40: 6574 612c 2065 6e65 7267 795f 6b65 763d  eta, energy_kev=
-00019e50: 3137 2e37 3934 290d 0a20 2020 2022 2222  17.794)..    """
-00019e60: 0d0a 0d0a 2020 2020 656e 6572 6779 203d  ....    energy =
-00019e70: 2065 6e65 7267 795f 6b65 7620 2a20 3130   energy_kev * 10
-00019e80: 3030 2e30 2020 2320 656e 6572 6779 2069  00.0  # energy i
-00019e90: 6e20 6556 0d0a 2020 2020 7468 6574 6120  n eV..    theta 
-00019ea0: 3d20 7477 6f74 6865 7461 202a 206e 702e  = twotheta * np.
-00019eb0: 7069 202f 2033 3630 2020 2320 7468 6574  pi / 360  # thet
-00019ec0: 6120 696e 2072 6164 6961 6e73 0d0a 2020  a in radians..  
-00019ed0: 2020 2320 4361 6c63 756c 6174 6520 7c51    # Calculate |Q
-00019ee0: 7c0d 0a20 2020 206d 6167 7120 3d20 6e70  |..    magq = np
-00019ef0: 2e73 696e 2874 6865 7461 2920 2a20 656e  .sin(theta) * en
-00019f00: 6572 6779 202a 2066 672e 6520 2a20 3420  ergy * fg.e * 4 
-00019f10: 2a20 6e70 2e70 6920 2f20 2866 672e 6820  * np.pi / (fg.h 
-00019f20: 2a20 6667 2e63 202a 2031 6531 3029 0d0a  * fg.c * 1e10)..
-00019f30: 2020 2020 7265 7475 726e 206d 6167 710d      return magq.
-00019f40: 0a0d 0a0d 0a64 6566 2063 616c 3274 6865  .....def cal2the
-00019f50: 7461 2871 6d61 672c 2065 6e65 7267 795f  ta(qmag, energy_
-00019f60: 6b65 763d 3137 2e37 3934 293a 0d0a 2020  kev=17.794):..  
-00019f70: 2020 2222 220d 0a20 2020 2043 616c 6375    """..    Calcu
-00019f80: 6c61 7465 2074 6865 7461 2061 7420 7061  late theta at pa
-00019f90: 7274 6963 756c 6172 2065 6e65 7267 7920  rticular energy 
-00019fa0: 696e 206b 6556 2066 726f 6d20 7c51 7c0d  in keV from |Q|.
-00019fb0: 0a20 2020 2020 7477 6f74 6865 7461 203d  .     twotheta =
-00019fc0: 2063 616c 3274 6865 7461 2851 6d61 672c   cal2theta(Qmag,
-00019fd0: 656e 6572 6779 5f6b 6576 3d31 372e 3739  energy_kev=17.79
-00019fe0: 3429 0d0a 2020 2020 2222 220d 0a0d 0a20  4)..    """.... 
-00019ff0: 2020 2065 6e65 7267 7920 3d20 656e 6572     energy = ener
-0001a000: 6779 5f6b 6576 202a 2031 3030 302e 3020  gy_kev * 1000.0 
-0001a010: 2023 2065 6e65 7267 7920 696e 2065 560d   # energy in eV.
-0001a020: 0a20 2020 2023 2043 616c 6375 6c61 7465  .    # Calculate
-0001a030: 2032 7468 6574 6120 616e 676c 6573 2066   2theta angles f
-0001a040: 6f72 2078 2d72 6179 730d 0a20 2020 2074  or x-rays..    t
-0001a050: 776f 7468 6574 6120 3d20 3220 2a20 6e70  wotheta = 2 * np
-0001a060: 2e61 7263 7369 6e28 716d 6167 202a 2031  .arcsin(qmag * 1
-0001a070: 6531 3020 2a20 6667 2e68 202a 2066 672e  e10 * fg.h * fg.
-0001a080: 6320 2f20 2865 6e65 7267 7920 2a20 6667  c / (energy * fg
-0001a090: 2e65 202a 2034 202a 206e 702e 7069 2929  .e * 4 * np.pi))
-0001a0a0: 0d0a 2020 2020 2320 7265 7475 726e 2078  ..    # return x
-0001a0b0: 3254 2069 6e20 6465 6772 6565 730d 0a20  2T in degrees.. 
-0001a0c0: 2020 2074 776f 7468 6574 6120 3d20 7477     twotheta = tw
-0001a0d0: 6f74 6865 7461 202a 2031 3830 202f 206e  otheta * 180 / n
-0001a0e0: 702e 7069 0d0a 2020 2020 7265 7475 726e  p.pi..    return
-0001a0f0: 2074 776f 7468 6574 610d 0a0d 0a0d 0a64   twotheta......d
-0001a100: 6566 2063 616c 6473 7061 6365 2874 776f  ef caldspace(two
-0001a110: 7468 6574 612c 2065 6e65 7267 795f 6b65  theta, energy_ke
-0001a120: 763d 3137 2e37 3934 293a 0d0a 2020 2020  v=17.794):..    
-0001a130: 2222 220d 0a20 2020 2043 616c 6375 6c61  """..    Calcula
-0001a140: 7465 2064 2d73 7061 6369 6e67 2066 726f  te d-spacing fro
-0001a150: 6d20 7477 6f2d 7468 6574 610d 0a20 2020  m two-theta..   
-0001a160: 2020 6473 7061 6365 203d 2063 616c 6473    dspace = calds
-0001a170: 7061 6365 2874 7468 2c20 656e 6572 6779  pace(tth, energy
-0001a180: 5f6b 6576 290d 0a20 2020 2022 2222 0d0a  _kev)..    """..
-0001a190: 2020 2020 716d 6167 203d 2063 616c 716d      qmag = calqm
-0001a1a0: 6167 2874 776f 7468 6574 612c 2065 6e65  ag(twotheta, ene
-0001a1b0: 7267 795f 6b65 7629 0d0a 2020 2020 6473  rgy_kev)..    ds
-0001a1c0: 7061 6365 203d 2071 3264 7370 6163 6528  pace = q2dspace(
-0001a1d0: 716d 6167 290d 0a20 2020 2072 6574 7572  qmag)..    retur
-0001a1e0: 6e20 6473 7061 6365 0d0a 0d0a 0d0a 6465  n dspace......de
-0001a1f0: 6620 6361 6c6c 6174 7469 6365 2874 776f  f callattice(two
-0001a200: 7468 6574 612c 2065 6e65 7267 795f 6b65  theta, energy_ke
-0001a210: 763d 3137 2e37 3934 2c20 686b 6c3d 2831  v=17.794, hkl=(1
-0001a220: 2c20 302c 2030 2929 3a0d 0a20 2020 2022  , 0, 0)):..    "
-0001a230: 2222 0d0a 2020 2020 4361 6c63 756c 6174  ""..    Calculat
-0001a240: 6520 6375 6269 6320 6c61 7474 6963 6520  e cubic lattice 
-0001a250: 7061 7261 6d65 7465 722c 2061 2066 726f  parameter, a fro
-0001a260: 6d20 7265 666c 6563 7469 6f6e 2074 776f  m reflection two
-0001a270: 2d74 6865 7461 0d0a 2020 2020 3a70 6172  -theta..    :par
-0001a280: 616d 2074 776f 7468 6574 613a 2042 7261  am twotheta: Bra
-0001a290: 6767 2061 6e67 6c65 2c20 6465 670d 0a20  gg angle, deg.. 
-0001a2a0: 2020 203a 7061 7261 6d20 656e 6572 6779     :param energy
-0001a2b0: 5f6b 6576 3a20 656e 6572 6779 2069 6e20  _kev: energy in 
-0001a2c0: 6b65 560d 0a20 2020 203a 7061 7261 6d20  keV..    :param 
-0001a2d0: 686b 6c3a 2072 6566 6c65 6374 696f 6e20  hkl: reflection 
-0001a2e0: 2863 7562 6963 206f 6e6c 790d 0a20 2020  (cubic only..   
-0001a2f0: 203a 7265 7475 726e 3a20 666c 6f61 742c   :return: float,
-0001a300: 206c 6174 7469 6365 2063 6f6e 7461 6e74   lattice contant
-0001a310: 0d0a 2020 2020 2222 220d 0a20 2020 2071  ..    """..    q
-0001a320: 6d61 6720 3d20 6361 6c71 6d61 6728 7477  mag = calqmag(tw
-0001a330: 6f74 6865 7461 2c20 656e 6572 6779 5f6b  otheta, energy_k
-0001a340: 6576 290d 0a20 2020 2064 7370 6163 6520  ev)..    dspace 
-0001a350: 3d20 7132 6473 7061 6365 2871 6d61 6729  = q2dspace(qmag)
-0001a360: 0d0a 2020 2020 7265 7475 726e 2064 7370  ..    return dsp
-0001a370: 6163 6520 2a20 6e70 2e73 7172 7428 6e70  ace * np.sqrt(np
-0001a380: 2e73 756d 286e 702e 7371 7561 7265 2868  .sum(np.square(h
-0001a390: 6b6c 2929 290d 0a0d 0a0d 0a64 6566 2071  kl)))......def q
-0001a3a0: 3264 7370 6163 6528 716d 6167 293a 0d0a  2dspace(qmag):..
-0001a3b0: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
-0001a3c0: 6375 6c61 7465 2064 2d73 7061 6369 6e67  culate d-spacing
-0001a3d0: 2066 726f 6d20 7c51 7c0d 0a20 2020 2020   from |Q|..     
-0001a3e0: 2020 2020 6473 7061 6365 203d 2071 3264      dspace = q2d
-0001a3f0: 7370 6163 6528 516d 6167 290d 0a20 2020  space(Qmag)..   
-0001a400: 2022 2222 0d0a 2020 2020 7265 7475 726e   """..    return
-0001a410: 2032 202a 206e 702e 7069 202f 2071 6d61   2 * np.pi / qma
-0001a420: 670d 0a0d 0a0d 0a64 6566 2064 7370 6163  g......def dspac
-0001a430: 6532 7128 6473 7061 6365 293a 0d0a 2020  e2q(dspace):..  
-0001a440: 2020 2222 220d 0a20 2020 2043 616c 6375    """..    Calcu
-0001a450: 6c61 7465 2064 2d73 7061 6369 6e67 2066  late d-spacing f
-0001a460: 726f 6d20 7c51 7c0d 0a20 2020 2020 2020  rom |Q|..       
-0001a470: 2020 516d 6167 203d 2071 3264 7370 6163    Qmag = q2dspac
-0001a480: 6528 6473 7061 6365 290d 0a20 2020 2022  e(dspace)..    "
-0001a490: 2222 0d0a 2020 2020 7265 7475 726e 2032  ""..    return 2
-0001a4a0: 202a 206e 702e 7069 202f 2064 7370 6163   * np.pi / dspac
-0001a4b0: 650d 0a0d 0a0d 0a64 6566 2071 3275 6e69  e......def q2uni
-0001a4c0: 7473 2871 6d61 672c 2075 6e69 7473 3d27  ts(qmag, units='
-0001a4d0: 7474 6827 2c20 656e 6572 6779 5f6b 6576  tth', energy_kev
-0001a4e0: 3d4e 6f6e 6529 3a0d 0a20 2020 2022 2222  =None):..    """
-0001a4f0: 0d0a 2020 2020 436f 6e76 6572 7420 7c51  ..    Convert |Q
-0001a500: 7c20 696e 2041 5e2d 3120 746f 2063 686f  | in A^-1 to cho
-0001a510: 6963 6520 6f66 2075 6e69 7473 0d0a 2020  ice of units..  
-0001a520: 2020 3a70 6172 616d 2071 6d61 673a 2066    :param qmag: f
-0001a530: 6c6f 6174 206f 7220 6172 7261 7920 696e  loat or array in
-0001a540: 2069 6e76 6572 7365 2d41 6e67 7374 726f   inverse-Angstro
-0001a550: 6d0d 0a20 2020 203a 7061 7261 6d20 756e  m..    :param un
-0001a560: 6974 733a 2073 7472 3a20 2774 7468 272c  its: str: 'tth',
-0001a570: 2027 6473 7061 6365 272c 2027 7127 2028   'dspace', 'q' (
-0001a580: 7261 6973 6573 2056 616c 7565 4572 726f  raises ValueErro
-0001a590: 7220 6966 2077 726f 6e67 290d 0a20 2020  r if wrong)..   
-0001a5a0: 203a 7061 7261 6d20 656e 6572 6779 5f6b   :param energy_k
-0001a5b0: 6576 3a20 666c 6f61 740d 0a20 2020 203a  ev: float..    :
-0001a5c0: 7265 7475 726e 3a20 666c 6f61 7420 6f72  return: float or
-0001a5d0: 2061 7272 6179 0d0a 2020 2020 2222 220d   array..    """.
-0001a5e0: 0a20 2020 2075 6e69 7473 203d 2075 6e69  .    units = uni
-0001a5f0: 7473 2e6c 6f77 6572 2829 2e72 6570 6c61  ts.lower().repla
-0001a600: 6365 2827 2027 2c20 2727 292e 7265 706c  ce(' ', '').repl
-0001a610: 6163 6528 272d 272c 2027 2729 0d0a 2020  ace('-', '')..  
-0001a620: 2020 6966 2027 7127 2069 6e20 756e 6974    if 'q' in unit
-0001a630: 733a 0d0a 2020 2020 2020 2020 7265 7475  s:..        retu
-0001a640: 726e 2071 6d61 670d 0a20 2020 2069 6620  rn qmag..    if 
-0001a650: 756e 6974 7320 696e 205b 2764 272c 2027  units in ['d', '
-0001a660: 6473 7061 6365 272c 2027 6473 7061 6369  dspace', 'dspaci
-0001a670: 6e67 272c 2027 616e 6773 7472 6f6d 272c  ng', 'angstrom',
-0001a680: 2027 4127 5d3a 0d0a 2020 2020 2020 2020   'A']:..        
-0001a690: 7265 7475 726e 2071 3264 7370 6163 6528  return q2dspace(
-0001a6a0: 716d 6167 290d 0a20 2020 2069 6620 756e  qmag)..    if un
-0001a6b0: 6974 7320 696e 205b 2774 7468 272c 2027  its in ['tth', '
-0001a6c0: 616e 676c 6527 2c20 2774 776f 7468 6574  angle', 'twothet
-0001a6d0: 6127 2c20 2774 6865 7461 272c 2027 6465  a', 'theta', 'de
-0001a6e0: 6727 2c20 2764 6567 7265 6573 275d 3a0d  g', 'degrees']:.
-0001a6f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001a700: 6361 6c32 7468 6574 6128 716d 6167 2c20  cal2theta(qmag, 
-0001a710: 656e 6572 6779 5f6b 6576 290d 0a20 2020  energy_kev)..   
-0001a720: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0001a730: 7228 2725 7320 6973 206e 6f74 2061 2076  r('%s is not a v
-0001a740: 616c 6964 2075 6e69 7427 2025 2075 6e69  alid unit' % uni
-0001a750: 7473 290d 0a0d 0a0d 0a64 6566 2072 6573  ts)......def res
-0001a760: 6f6c 7574 696f 6e32 656e 6572 6779 2872  olution2energy(r
-0001a770: 6573 2c20 7477 6f74 6865 7461 3d31 3830  es, twotheta=180
-0001a780: 2e29 3a0d 0a20 2020 2022 2222 0d0a 2020  .):..    """..  
-0001a790: 2020 4361 6c63 7561 6c74 6520 7468 6520    Calcualte the 
-0001a7a0: 656e 6572 6779 2072 6571 7569 7265 6420  energy required 
-0001a7b0: 746f 2061 6368 6965 7665 2061 2073 7065  to achieve a spe
-0001a7c0: 6369 6669 6320 7265 736f 6c75 7469 6f6e  cific resolution
-0001a7d0: 2061 7420 6120 6769 7665 6e20 7477 6f2d   at a given two-
-0001a7e0: 7468 6574 610d 0a20 2020 203a 7061 7261  theta..    :para
-0001a7f0: 6d20 7265 733a 206d 6561 7375 7265 6d65  m res: measureme
-0001a800: 6e74 2072 6573 6f6c 7574 696f 6e20 696e  nt resolution in
-0001a810: 2041 2028 3d3d 642d 7370 6163 696e 6729   A (==d-spacing)
-0001a820: 0d0a 2020 2020 3a70 6172 616d 2074 776f  ..    :param two
-0001a830: 7468 6574 613a 2042 7261 6767 2061 6e67  theta: Bragg ang
-0001a840: 6c65 2069 6e20 4465 6772 6565 730d 0a20  le in Degrees.. 
-0001a850: 2020 203a 7265 7475 726e 3a20 666c 6f61     :return: floa
-0001a860: 740d 0a20 2020 2022 2222 0d0a 2020 2020  t..    """..    
-0001a870: 7468 6574 6120 3d20 7477 6f74 6865 7461  theta = twotheta
-0001a880: 202a 206e 702e 7069 202f 2033 3630 2020   * np.pi / 360  
-0001a890: 2320 7468 6574 6120 696e 2072 6164 6961  # theta in radia
-0001a8a0: 6e73 0d0a 2020 2020 7265 7475 726e 2028  ns..    return (
-0001a8b0: 6667 2e68 202a 2066 672e 6320 2a20 3165  fg.h * fg.c * 1e
-0001a8c0: 3130 2920 2f20 2872 6573 202a 206e 702e  10) / (res * np.
-0001a8d0: 7369 6e28 7468 6574 6129 202a 2066 672e  sin(theta) * fg.
-0001a8e0: 6520 2a20 3220 2a20 3130 3030 2e29 0d0a  e * 2 * 1000.)..
-0001a8f0: 0d0a 0d0a 6465 6620 7761 7665 3265 6e65  ....def wave2ene
-0001a900: 7267 7928 7761 7665 6c65 6e67 7468 293a  rgy(wavelength):
-0001a910: 0d0a 2020 2020 2222 220d 0a20 2020 2043  ..    """..    C
-0001a920: 6f6e 7665 7274 7320 7761 7665 6c65 6e67  onverts waveleng
-0001a930: 7468 2069 6e20 4120 746f 2065 6e65 7267  th in A to energ
-0001a940: 7920 696e 206b 6556 0d0a 2020 2020 2045  y in keV..     E
-0001a950: 6e65 7267 7920 3d20 7761 7665 3265 6e65  nergy = wave2ene
-0001a960: 7267 7928 7761 7665 6c65 6e67 7468 290d  rgy(wavelength).
-0001a970: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
-0001a980: 2320 5349 3a20 4520 3d20 6863 2f6c 616d  # SI: E = hc/lam
-0001a990: 6264 610d 0a20 2020 206c 616d 203d 2077  bda..    lam = w
-0001a9a0: 6176 656c 656e 6774 6820 2a20 6667 2e41  avelength * fg.A
-0001a9b0: 0d0a 2020 2020 4520 3d20 6667 2e68 202a  ..    E = fg.h *
-0001a9c0: 2066 672e 6320 2f20 6c61 6d0d 0a0d 0a20   fg.c / lam.... 
-0001a9d0: 2020 2023 2045 6c65 6374 726f 6e20 566f     # Electron Vo
-0001a9e0: 6c74 733a 0d0a 2020 2020 456e 6572 6779  lts:..    Energy
-0001a9f0: 203d 2045 202f 2066 672e 650d 0a20 2020   = E / fg.e..   
-0001aa00: 2072 6574 7572 6e20 456e 6572 6779 202f   return Energy /
-0001aa10: 2031 3030 302e 300d 0a0d 0a0d 0a64 6566   1000.0......def
-0001aa20: 2065 6e65 7267 7932 7761 7665 2865 6e65   energy2wave(ene
-0001aa30: 7267 795f 6b65 7629 3a0d 0a20 2020 2022  rgy_kev):..    "
-0001aa40: 2222 0d0a 2020 2020 436f 6e76 6572 7473  ""..    Converts
-0001aa50: 2065 6e65 7267 7920 696e 206b 6556 2074   energy in keV t
-0001aa60: 6f20 7761 7665 6c65 6e67 7468 2069 6e20  o wavelength in 
-0001aa70: 410d 0a20 2020 2020 7761 7665 6c65 6e67  A..     waveleng
-0001aa80: 7468 203d 2065 6e65 7267 7932 7761 7665  th = energy2wave
-0001aa90: 2865 6e65 7267 7929 0d0a 2020 2020 2222  (energy)..    ""
-0001aaa0: 220d 0a0d 0a20 2020 2023 2045 6c65 6374  "....    # Elect
-0001aab0: 726f 6e20 566f 6c74 733a 0d0a 2020 2020  ron Volts:..    
-0001aac0: 4520 3d20 3130 3030 202a 2065 6e65 7267  E = 1000 * energ
-0001aad0: 795f 6b65 7620 2a20 6667 2e65 0d0a 0d0a  y_kev * fg.e....
-0001aae0: 2020 2020 2320 5349 3a20 4520 3d20 6863      # SI: E = hc
-0001aaf0: 2f6c 616d 6264 610d 0a20 2020 206c 616d  /lambda..    lam
-0001ab00: 203d 2066 672e 6820 2a20 6667 2e63 202f   = fg.h * fg.c /
-0001ab10: 2045 0d0a 2020 2020 7761 7665 6c65 6e67   E..    waveleng
-0001ab20: 7468 203d 206c 616d 202f 2066 672e 410d  th = lam / fg.A.
-0001ab30: 0a20 2020 2072 6574 7572 6e20 7761 7665  .    return wave
-0001ab40: 6c65 6e67 7468 0d0a 0d0a 0d0a 6465 6620  length......def 
-0001ab50: 7761 7665 7665 6374 6f72 2865 6e65 7267  wavevector(energ
-0001ab60: 795f 6b65 763d 4e6f 6e65 2c20 7761 7665  y_kev=None, wave
-0001ab70: 6c65 6e67 7468 3d4e 6f6e 6529 3a0d 0a20  length=None):.. 
-0001ab80: 2020 2022 2222 5265 7475 726e 2077 6176     """Return wav
-0001ab90: 6576 6563 746f 7220 3d20 3270 692f 6c61  evector = 2pi/la
-0001aba0: 6d62 6461 2222 220d 0a20 2020 2069 6620  mbda"""..    if 
-0001abb0: 7761 7665 6c65 6e67 7468 2069 7320 4e6f  wavelength is No
-0001abc0: 6e65 3a0d 0a20 2020 2020 2020 2077 6176  ne:..        wav
-0001abd0: 656c 656e 6774 6820 3d20 656e 6572 6779  elength = energy
-0001abe0: 3277 6176 6528 656e 6572 6779 5f6b 6576  2wave(energy_kev
-0001abf0: 290d 0a20 2020 2072 6574 7572 6e20 3220  )..    return 2 
-0001ac00: 2a20 6e70 2e70 6920 2f20 7761 7665 6c65  * np.pi / wavele
-0001ac10: 6e67 7468 0d0a 0d0a 0d0a 6465 6620 6269  ngth......def bi
-0001ac20: 736f 3275 6973 6f28 6269 736f 293a 0d0a  so2uiso(biso):..
-0001ac30: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
-0001ac40: 7665 7274 2042 2069 736f 7472 6f70 6963  vert B isotropic
-0001ac50: 2074 6865 726d 616c 2070 6172 616d 6574   thermal paramet
-0001ac60: 6572 7320 746f 2055 2069 736f 7472 6f70  ers to U isotrop
-0001ac70: 6963 2074 6865 726d 616c 2070 6172 616d  ic thermal param
-0001ac80: 6574 6572 730d 0a20 2020 203a 7061 7261  eters..    :para
-0001ac90: 6d20 6269 736f 3a20 4269 736f 2076 616c  m biso: Biso val
-0001aca0: 7565 206f 7220 6172 7261 790d 0a20 2020  ue or array..   
-0001acb0: 203a 7265 7475 726e 3a20 5569 736f 2076   :return: Uiso v
-0001acc0: 616c 7565 206f 7220 6172 7261 790d 0a20  alue or array.. 
-0001acd0: 2020 2022 2222 0d0a 2020 2020 6269 736f     """..    biso
-0001ace0: 203d 206e 702e 6173 6172 7261 7928 6269   = np.asarray(bi
-0001acf0: 736f 2c20 6474 7970 653d 666c 6f61 7429  so, dtype=float)
-0001ad00: 0d0a 2020 2020 7265 7475 726e 2062 6973  ..    return bis
-0001ad10: 6f20 2f20 2838 202a 206e 702e 7069 202a  o / (8 * np.pi *
-0001ad20: 2a20 3229 0d0a 0d0a 0d0a 6465 6620 7569  * 2)......def ui
-0001ad30: 736f 3262 6973 6f28 7569 736f 293a 0d0a  so2biso(uiso):..
-0001ad40: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
-0001ad50: 7665 7274 2055 2069 736f 7472 6f70 6963  vert U isotropic
-0001ad60: 2074 6865 726d 616c 2070 6172 616d 6574   thermal paramet
-0001ad70: 6572 7320 746f 2042 2069 736f 7472 6f70  ers to B isotrop
-0001ad80: 6963 2074 6865 726d 616c 2070 6172 616d  ic thermal param
-0001ad90: 6574 6572 730d 0a20 2020 203a 7061 7261  eters..    :para
-0001ada0: 6d20 7569 736f 3a20 5569 736f 2076 616c  m uiso: Uiso val
-0001adb0: 7565 206f 7220 6172 7261 790d 0a20 2020  ue or array..   
-0001adc0: 203a 7265 7475 726e 3a20 4269 736f 2076   :return: Biso v
-0001add0: 616c 7565 206f 7220 6172 7261 790d 0a20  alue or array.. 
-0001ade0: 2020 2022 2222 0d0a 2020 2020 7569 736f     """..    uiso
-0001adf0: 203d 206e 702e 6173 6172 7261 7928 7569   = np.asarray(ui
-0001ae00: 736f 2c20 6474 7970 653d 666c 6f61 7429  so, dtype=float)
-0001ae10: 0d0a 2020 2020 7265 7475 726e 2075 6973  ..    return uis
-0001ae20: 6f20 2a20 2838 202a 206e 702e 7069 202a  o * (8 * np.pi *
-0001ae30: 2a20 3229 0d0a 0d0a 0d0a 6465 6620 6575  * 2)......def eu
-0001ae40: 6c65 725f 756e 6974 5f76 6563 746f 7228  ler_unit_vector(
-0001ae50: 7576 772c 2075 7629 3a0d 0a20 2020 2022  uvw, uv):..    "
-0001ae60: 2222 0d0a 2020 2020 436f 6e76 6572 7420  ""..    Convert 
-0001ae70: 7665 6374 6f72 2069 6e20 6120 7370 6563  vector in a spec
-0001ae80: 6966 6963 2062 6173 6973 2074 6f20 6120  ific basis to a 
-0001ae90: 6361 7274 6573 6961 6e20 6261 7369 7320  cartesian basis 
-0001aea0: 616e 6420 6e6f 726d 616c 6973 6520 746f  and normalise to
-0001aeb0: 2061 2075 6e69 7420 7665 6374 6f72 0d0a   a unit vector..
-0001aec0: 2020 2020 3a70 6172 616d 2075 7677 3a20      :param uvw: 
-0001aed0: 5b6e 7833 5d20 6172 7261 7920 6173 205b  [nx3] array as [
-0001aee0: 5b75 2c76 2c77 5d5d 0d0a 2020 2020 3a70  [u,v,w]]..    :p
-0001aef0: 6172 616d 2075 763a 205b 3378 335d 2c20  aram uv: [3x3], 
-0001af00: 6261 7369 7320 7665 6374 6f72 7320 5b61  basis vectors [a
-0001af10: 2c62 2c63 5d0d 0a20 2020 203a 7265 7475  ,b,c]..    :retu
-0001af20: 726e 3a20 5b6e 7833 5d20 6172 7261 7920  rn: [nx3] array 
-0001af30: 7879 7a2f 7c78 797a 7c2c 2077 6865 7265  xyz/|xyz|, where
-0001af40: 2078 2c79 2c7a 203d 2075 2a61 2b76 2a62   x,y,z = u*a+v*b
-0001af50: 2b77 2a63 0d0a 2020 2020 2222 220d 0a20  +w*c..    """.. 
-0001af60: 2020 2078 797a 203d 206e 702e 646f 7428     xyz = np.dot(
-0001af70: 7576 772c 2075 7629 0d0a 2020 2020 7265  uvw, uv)..    re
-0001af80: 7475 726e 2066 672e 6e6f 726d 2878 797a  turn fg.norm(xyz
-0001af90: 290d 0a0d 0a0d 0a64 6566 2065 756c 6572  )......def euler
-0001afa0: 5f6d 6f6d 656e 7428 6d78 6d79 6d7a 2c20  _moment(mxmymz, 
-0001afb0: 7576 293a 0d0a 2020 2020 2222 220d 0a20  uv):..    """.. 
-0001afc0: 2020 2043 6f6e 7665 7274 206d 6f6d 656e     Convert momen
-0001afd0: 7420 6d78 6d79 6d7a 2063 6f6f 7264 696e  t mxmymz coordin
-0001afe0: 6174 6573 2066 726f 6d20 6369 6620 696e  ates from cif in
-0001aff0: 746f 2065 756c 6572 6961 6e20 6261 7369  to eulerian basi
-0001b000: 730d 0a20 2020 203a 7061 7261 6d20 6d78  s..    :param mx
-0001b010: 6d79 6d7a 3a20 5b6e 7833 5d20 6172 7261  mymz: [nx3] arra
-0001b020: 792c 2075 6e69 7473 206f 6620 426f 6872  y, units of Bohr
-0001b030: 206d 6167 6e65 746f 6e2c 2064 6972 6563   magneton, direc
-0001b040: 7465 6420 616c 6f6e 6720 612c 622c 630d  ted along a,b,c.
-0001b050: 0a20 2020 203a 7061 7261 6d20 7576 3a20  .    :param uv: 
-0001b060: 5b33 7833 5d20 6172 7261 792c 2062 6173  [3x3] array, bas
-0001b070: 6973 2076 6563 746f 7273 205b 612c 622c  is vectors [a,b,
-0001b080: 635d 0d0a 2020 2020 3a72 6574 7572 6e3a  c]..    :return:
-0001b090: 206d 6f6d 656e 7473 205b 6e78 335d 2061   moments [nx3] a
-0001b0a0: 7272 6179 2c20 756e 6974 7320 6f66 2042  rray, units of B
-0001b0b0: 6f68 7220 6d61 676e 6574 6f6e 2c20 6469  ohr magneton, di
-0001b0c0: 7265 6374 6564 2061 6c6f 6e67 2078 2c79  rected along x,y
-0001b0d0: 2c7a 0d0a 2020 2020 2222 220d 0a20 2020  ,z..    """..   
-0001b0e0: 2023 2043 616c 6375 6c61 7465 206d 6f6d   # Calculate mom
-0001b0f0: 656e 740d 0a20 2020 206d 6f6d 656e 746d  ent..    momentm
-0001b100: 6167 203d 2066 672e 6d61 6728 6d78 6d79  ag = fg.mag(mxmy
-0001b110: 6d7a 292e 7265 7368 6170 6528 5b2d 312c  mz).reshape([-1,
-0001b120: 2031 5d29 0d0a 2020 2020 6d6f 6d65 6e74   1])..    moment
-0001b130: 7879 7a20 3d20 6e70 2e64 6f74 286d 786d  xyz = np.dot(mxm
-0001b140: 796d 7a2c 2075 7629 0d0a 2020 2020 6d6f  ymz, uv)..    mo
-0001b150: 6d65 6e74 203d 206d 6f6d 656e 746d 6167  ment = momentmag
-0001b160: 202a 2066 672e 6e6f 726d 286d 6f6d 656e   * fg.norm(momen
-0001b170: 7478 797a 2920 2023 2062 726f 6164 6361  txyz)  # broadca
-0001b180: 7374 206e 2a31 2078 206e 2a33 203d 206e  st n*1 x n*3 = n
-0001b190: 2a33 0d0a 2020 2020 6d6f 6d65 6e74 5b6e  *3..    moment[n
-0001b1a0: 702e 6973 6e61 6e28 6d6f 6d65 6e74 295d  p.isnan(moment)]
-0001b1b0: 203d 2030 2e0d 0a20 2020 2072 6574 7572   = 0...    retur
-0001b1c0: 6e20 6d6f 6d65 6e74 0d0a 0d0a 0d0a 6465  n moment......de
-0001b1d0: 6620 6469 6666 7261 6374 6f6d 6574 6572  f diffractometer
-0001b1e0: 5f51 2865 7461 2c20 6465 6c74 612c 2065  _Q(eta, delta, e
-0001b1f0: 6e65 7267 795f 6b65 763d 382e 3029 3a0d  nergy_kev=8.0):.
-0001b200: 0a20 2020 2022 2222 0d0a 2020 2020 4361  .    """..    Ca
-0001b210: 6c63 756c 6174 6520 7761 7665 7665 6374  lculate wavevect
-0001b220: 6f72 2074 7261 6e73 6665 722c 2051 2066  or transfer, Q f
-0001b230: 6f72 2064 6966 6672 6163 746f 6d65 7465  or diffractomete
-0001b240: 7220 7769 7468 696e 2074 6865 2073 6361  r within the sca
-0001b250: 7474 6572 696e 6720 706c 616e 652e 0d0a  ttering plane...
-0001b260: 2020 2020 2020 2051 782c 5179 203d 2064         Qx,Qy = d
-0001b270: 6966 6672 6163 746f 6d65 7465 725f 5128  iffractometer_Q(
-0001b280: 6574 612c 6465 6c74 612c 656e 6572 6779  eta,delta,energy
-0001b290: 5f6b 6576 290d 0a20 2020 2020 2020 6574  _kev)..       et
-0001b2a0: 6120 3d20 616e 676c 6520 2864 6567 2920  a = angle (deg) 
-0001b2b0: 6f66 2073 616d 706c 650d 0a20 2020 2020  of sample..     
-0001b2c0: 2020 6465 6c74 6120 3d20 616e 676c 6520    delta = angle 
-0001b2d0: 2864 6567 2920 6f66 2064 6574 6563 746f  (deg) of detecto
-0001b2e0: 720d 0a20 2020 2020 2020 656e 6572 6779  r..       energy
-0001b2f0: 5f6b 6576 203d 2065 6e65 7267 7920 696e  _kev = energy in
-0001b300: 206b 6556 0d0a 0d0a 2020 2020 2020 2043   keV....       C
-0001b310: 6f6f 7264 696e 6174 6520 7379 7374 656d  oordinate system
-0001b320: 2028 7269 6768 7420 6861 6e64 6564 293a   (right handed):
-0001b330: 0d0a 2020 2020 2020 2020 7820 2d20 6469  ..        x - di
-0001b340: 7265 6374 696f 6e20 616c 6f6e 6720 6265  rection along be
-0001b350: 616d 2c20 2b76 6520 6973 2066 726f 6d20  am, +ve is from 
-0001b360: 736f 7572 6365 2074 6f20 7361 6d70 6c65  source to sample
-0001b370: 0d0a 2020 2020 2020 2020 7920 2d20 6469  ..        y - di
-0001b380: 7265 6374 696f 6e20 7665 7274 6963 6c65  rection verticle
-0001b390: 0d0a 2020 2020 2020 2020 7a20 2d20 6469  ..        z - di
-0001b3a0: 7265 6374 696f 6e20 686f 7269 7a6f 6e74  rection horizont
-0001b3b0: 616c 0d0a 0d0a 2020 2020 2020 204e 6f74  al....       Not
-0001b3c0: 653a 2043 7572 7265 6e74 6c79 206f 6e6c  e: Currently onl
-0001b3d0: 7920 696e 2074 6865 2076 6572 7469 636c  y in the verticl
-0001b3e0: 6520 6765 6f6d 6574 7279 210d 0a20 2020  e geometry!..   
-0001b3f0: 2022 2222 0d0a 0d0a 2020 2020 6465 6c74   """....    delt
-0001b400: 6120 3d20 6e70 2e72 6164 6961 6e73 2864  a = np.radians(d
-0001b410: 656c 7461 290d 0a20 2020 2065 7461 203d  elta)..    eta =
-0001b420: 206e 702e 7261 6469 616e 7328 6574 6129   np.radians(eta)
-0001b430: 0d0a 2020 2020 4b20 3d20 3145 2d31 3020  ..    K = 1E-10 
-0001b440: 2a20 3130 3030 202a 2032 202a 206e 702e  * 1000 * 2 * np.
-0001b450: 7069 202a 2028 656e 6572 6779 5f6b 6576  pi * (energy_kev
-0001b460: 202a 2066 672e 6529 202f 2028 6667 2e68   * fg.e) / (fg.h
-0001b470: 202a 2066 672e 6329 2020 2320 4b20 7665   * fg.c)  # K ve
-0001b480: 6374 6f72 206d 6167 6e69 7475 6465 0d0a  ctor magnitude..
-0001b490: 0d0a 2020 2020 5178 203d 204b 202a 2028  ..    Qx = K * (
-0001b4a0: 6e70 2e63 6f73 2865 7461 2920 2d20 6e70  np.cos(eta) - np
-0001b4b0: 2e63 6f73 2864 656c 7461 202d 2065 7461  .cos(delta - eta
-0001b4c0: 2929 0d0a 2020 2020 5179 203d 204b 202a  ))..    Qy = K *
-0001b4d0: 2028 6e70 2e73 696e 2864 656c 7461 202d   (np.sin(delta -
-0001b4e0: 2065 7461 2920 2b20 6e70 2e73 696e 2865   eta) + np.sin(e
-0001b4f0: 7461 2929 0d0a 2020 2020 7265 7475 726e  ta))..    return
-0001b500: 2051 782c 2051 790d 0a0d 0a0d 0a64 6566   Qx, Qy......def
-0001b510: 2068 6b6c 3273 7472 2868 6b6c 293a 0d0a   hkl2str(hkl):..
-0001b520: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
-0001b530: 7665 7274 2068 6b6c 2074 6f20 7374 7269  vert hkl to stri
-0001b540: 6e67 2028 682c 6b2c 6c29 0d0a 2020 2020  ng (h,k,l)..    
-0001b550: 3a70 6172 616d 2068 6b6c 3a0d 0a20 2020  :param hkl:..   
-0001b560: 203a 7265 7475 726e 3a20 7374 7220 2728   :return: str '(
-0001b570: 682c 6b2c 6c29 270d 0a20 2020 2022 2222  h,k,l)'..    """
-0001b580: 0d0a 0d0a 2020 2020 6f75 7420 3d20 2728  ....    out = '(
-0001b590: 2531 2e33 672c 2531 2e33 672c 2531 2e33  %1.3g,%1.3g,%1.3
-0001b5a0: 6729 270d 0a20 2020 2068 6b6c 203d 206e  g)'..    hkl = n
-0001b5b0: 702e 6173 6172 7261 7928 686b 6c2c 2064  p.asarray(hkl, d
-0001b5c0: 7479 7065 3d66 6c6f 6174 292e 7265 7368  type=float).resh
-0001b5d0: 6170 6528 5b2d 312c 2033 5d29 0d0a 2020  ape([-1, 3])..  
-0001b5e0: 2020 686b 6c20 3d20 6e70 2e61 726f 756e    hkl = np.aroun
-0001b5f0: 6428 686b 6c2c 2035 290d 0a20 2020 2072  d(hkl, 5)..    r
-0001b600: 6574 7572 6e20 275c 6e27 2e6a 6f69 6e28  eturn '\n'.join(
-0001b610: 5b6f 7574 2025 2028 785b 305d 2c20 785b  [out % (x[0], x[
-0001b620: 315d 2c20 785b 325d 2920 666f 7220 7820  1], x[2]) for x 
-0001b630: 696e 2068 6b6c 5d29 0d0a 0d0a 0d0a 6465  in hkl])......de
-0001b640: 6620 6375 7432 706f 7764 6572 2871 782c  f cut2powder(qx,
-0001b650: 2071 792c 2071 7a2c 2063 7574 293a 0d0a   qy, qz, cut):..
-0001b660: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
-0001b670: 7665 7274 2032 4420 7265 6369 7072 6f63  vert 2D reciproc
-0001b680: 616c 2073 7061 6365 2063 7574 2074 6f20  al space cut to 
-0001b690: 706f 7764 6572 2070 6174 7465 726e 0d0a  powder pattern..
-0001b6a0: 2020 2020 3a70 6172 616d 2071 783a 205b      :param qx: [
-0001b6b0: 6e2c 6d5d 2061 7272 6179 206f 6620 5120  n,m] array of Q 
-0001b6c0: 636f 6f72 6469 6e61 7465 7320 696e 2078  coordinates in x
-0001b6d0: 0d0a 2020 2020 3a70 6172 616d 2071 793a  ..    :param qy:
-0001b6e0: 205b 6e2c 6d5d 2061 7272 6179 206f 6620   [n,m] array of 
-0001b6f0: 5120 636f 6f72 6469 6e61 7465 7320 696e  Q coordinates in
-0001b700: 2079 0d0a 2020 2020 3a70 6172 616d 2071   y..    :param q
-0001b710: 7a3a 205b 6e2c 6d5d 2061 7272 6179 206f  z: [n,m] array o
-0001b720: 7220 666c 6f61 7420 6f66 2051 2063 6f6f  r float of Q coo
-0001b730: 7264 696e 6174 6573 2069 6e20 7a0d 0a20  rdinates in z.. 
-0001b740: 2020 203a 7061 7261 6d20 6375 743a 205b     :param cut: [
-0001b750: 6e2c 6d5d 2061 7272 6179 206f 6620 696e  n,m] array of in
-0001b760: 7465 6e73 6974 6965 730d 0a20 2020 203a  tensities..    :
-0001b770: 7265 7475 726e 3a20 716d 5b6f 5d2c 2070  return: qm[o], p
-0001b780: 6f77 5b6f 5d0d 0a20 2020 2022 2222 0d0a  ow[o]..    """..
-0001b790: 2020 2020 7171 203d 206e 702e 7371 7274      qq = np.sqrt
-0001b7a0: 2871 7820 2a2a 2032 202b 2071 7920 2a2a  (qx ** 2 + qy **
-0001b7b0: 2032 202b 2071 7a20 2a2a 2032 290d 0a20   2 + qz ** 2).. 
-0001b7c0: 2020 2072 6574 7572 6e20 6667 2e67 7269     return fg.gri
-0001b7d0: 645f 696e 7465 6e73 6974 7928 7171 2e72  d_intensity(qq.r
-0001b7e0: 6176 656c 2829 2c20 6375 742e 7261 7665  avel(), cut.rave
-0001b7f0: 6c28 2929 0d0a 0d0a 0d0a 272d 2d2d 2d2d  l())......'-----
-0001b800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001b810: 2d2d 2d2d 2d4d 6973 6320 4372 7973 7461  -----Misc Crysta
-0001b820: 6c20 5072 6f67 7261 6d73 2d2d 2d2d 2d2d  l Programs------
-0001b830: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001b840: 2d2d 270d 0a0d 0a0d 0a64 6566 2073 7472  --'......def str
-0001b850: 3265 6c65 6d65 6e74 2873 7472 696e 6729  2element(string)
-0001b860: 3a0d 0a20 2020 2022 2222 4669 6e64 7320  :..    """Finds 
-0001b870: 656c 656d 656e 7420 6e61 6d65 2069 6e20  element name in 
-0001b880: 7374 7269 6e67 2222 220d 0a20 2020 2072  string"""..    r
-0001b890: 6573 756c 7420 3d20 656c 656d 656e 745f  esult = element_
-0001b8a0: 7265 6765 782e 6669 6e64 616c 6c28 7374  regex.findall(st
-0001b8b0: 7269 6e67 290d 0a20 2020 2069 6620 6c65  ring)..    if le
-0001b8c0: 6e28 7265 7375 6c74 2920 3d3d 2030 3a0d  n(result) == 0:.
-0001b8d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001b8e0: 4661 6c73 650d 0a20 2020 2072 6574 7572  False..    retur
-0001b8f0: 6e20 7265 7375 6c74 5b30 5d2e 6361 7069  n result[0].capi
-0001b900: 7461 6c69 7a65 2829 0d0a 0d0a 0d0a 6465  talize()......de
-0001b910: 6620 6465 6279 6577 616c 6c65 7228 7569  f debyewaller(ui
-0001b920: 736f 2c20 516d 6167 3d30 293a 0d0a 2020  so, Qmag=0):..  
-0001b930: 2020 2222 220d 0a20 2020 2043 616c 6375    """..    Calcu
-0001b940: 6c61 7465 2074 6865 2064 6562 7965 2077  late the debye w
-0001b950: 616c 6c65 7220 6661 6374 6f72 2066 6f72  aller factor for
-0001b960: 2061 2070 6172 7469 6375 6c61 7220 510d   a particular Q.
-0001b970: 0a20 2020 2020 5420 3d20 6465 6279 6577  .     T = debyew
-0001b980: 616c 6c65 7228 7569 736f 2c51 6d61 673d  aller(uiso,Qmag=
-0001b990: 5b30 5d29 0d0a 0d0a 2020 2020 2020 2020  [0])....        
-0001b9a0: 5420 3d20 6578 7028 202d 322a 7069 5e32  T = exp( -2*pi^2
-0001b9b0: 2a55 6973 6f2f 645e 3220 290d 0a20 2020  *Uiso/d^2 )..   
-0001b9c0: 2020 2020 2054 203d 2065 7870 2820 2d55       T = exp( -U
-0001b9d0: 6973 6f2f 3220 2a20 515e 3220 290d 0a20  iso/2 * Q^2 ).. 
-0001b9e0: 2020 2022 2222 0d0a 0d0a 2020 2020 7569     """....    ui
-0001b9f0: 736f 203d 206e 702e 6173 6172 7261 7928  so = np.asarray(
-0001ba00: 7569 736f 2c20 6474 7970 653d 666c 6f61  uiso, dtype=floa
-0001ba10: 7429 2e72 6573 6861 7065 2831 2c20 2d31  t).reshape(1, -1
-0001ba20: 290d 0a20 2020 2051 6d61 6720 3d20 6e70  )..    Qmag = np
-0001ba30: 2e61 7361 7272 6179 2851 6d61 672c 2064  .asarray(Qmag, d
-0001ba40: 7479 7065 3d66 6c6f 6174 292e 7265 7368  type=float).resh
-0001ba50: 6170 6528 2d31 2c20 3129 0d0a 0d0a 2020  ape(-1, 1)....  
-0001ba60: 2020 2320 5461 6c6c 203d 206e 702e 6578    # Tall = np.ex
-0001ba70: 7028 2d30 2e35 202a 206e 702e 646f 7428  p(-0.5 * np.dot(
-0001ba80: 516d 6167 2c20 7569 736f 2929 2020 2320  Qmag, uiso))  # 
-0001ba90: 4e6f 7420 7375 7265 2077 6865 7265 2074  Not sure where t
-0001baa0: 6869 7320 636f 6d65 7320 6672 6f6d 2e2e  his comes from..
-0001bab0: 2e20 4a6f 6e27 7320 6e6f 7465 733f 0d0a  . Jon's notes?..
-0001bac0: 2020 2020 5461 6c6c 203d 206e 702e 6578      Tall = np.ex
-0001bad0: 7028 2d30 2e35 202a 206e 702e 646f 7428  p(-0.5 * np.dot(
-0001bae0: 516d 6167 202a 2a20 322c 2075 6973 6f29  Qmag ** 2, uiso)
-0001baf0: 290d 0a20 2020 2072 6574 7572 6e20 5461  )..    return Ta
-0001bb00: 6c6c 0d0a 0d0a 0d0a 6465 6620 706f 7764  ll......def powd
-0001bb10: 6572 5f61 7665 7261 6765 2874 7468 2c20  er_average(tth, 
-0001bb20: 656e 6572 6779 5f6b 6576 293a 0d0a 2020  energy_kev):..  
-0001bb30: 2020 2222 220d 0a20 2020 2052 6574 7572    """..    Retur
-0001bb40: 6e20 7468 6520 706f 7764 6572 2061 7665  n the powder ave
-0001bb50: 7261 6765 2063 6f72 7265 6374 696f 6e20  rage correction 
-0001bb60: 666f 7220 696e 7465 6e73 6974 6965 7320  for intensities 
-0001bb70: 6174 2061 2067 6976 656e 2074 776f 2d74  at a given two-t
-0001bb80: 6865 7461 0d0a 2020 2020 2020 2020 4970  heta..        Ip
-0001bb90: 203d 2049 302a 5041 2c20 2020 2050 4120   = I0*PA,    PA 
-0001bba0: 3d20 312f 7c51 7c5e 320d 0a20 2020 203a  = 1/|Q|^2..    :
-0001bbb0: 7061 7261 6d20 7474 683a 2074 776f 2d74  param tth: two-t
-0001bbc0: 6865 7461 2069 6e20 6465 670d 0a20 2020  heta in deg..   
-0001bbd0: 203a 7061 7261 6d20 656e 6572 6779 5f6b   :param energy_k
-0001bbe0: 6576 3a20 656e 6572 6779 2069 6e20 6b65  ev: energy in ke
-0001bbf0: 560d 0a20 2020 203a 7265 7475 726e 3a20  V..    :return: 
-0001bc00: 5041 0d0a 2020 2020 2222 220d 0a20 2020  PA..    """..   
-0001bc10: 2071 203d 2063 616c 716d 6167 2874 7468   q = calqmag(tth
-0001bc20: 2c20 656e 6572 6779 5f6b 6576 290d 0a20  , energy_kev).. 
-0001bc30: 2020 2072 6574 7572 6e20 3120 2f20 7120     return 1 / q 
-0001bc40: 2a2a 2032 0d0a 0d0a 0d0a 6465 6620 6772  ** 2......def gr
-0001bc50: 6f75 705f 696e 7465 6e73 6974 6965 7328  oup_intensities(
-0001bc60: 715f 7661 6c75 6573 2c20 696e 7465 6e73  q_values, intens
-0001bc70: 6974 792c 206d 696e 5f6f 7665 726c 6170  ity, min_overlap
-0001bc80: 3d30 2e30 3129 3a0d 0a20 2020 2022 2222  =0.01):..    """
-0001bc90: 0d0a 2020 2020 4772 6f75 7020 7265 666c  ..    Group refl
-0001bca0: 6563 7469 6f6e 7320 7769 7468 696e 2074  ections within t
-0001bcb0: 6865 206f 7665 726c 6170 2c20 7265 7475  he overlap, retu
-0001bcc0: 726e 696e 6720 7468 6520 696e 6465 7820  rning the index 
-0001bcd0: 6d61 7820 696e 7465 6e73 6974 7920 6f66  max intensity of
-0001bce0: 2065 6163 6820 6772 6f75 700d 0a20 2020   each group..   
-0001bcf0: 203a 7061 7261 6d20 715f 7661 6c75 6573   :param q_values
-0001bd00: 3a20 5b31 2a6e 5d20 6172 7261 7920 6f66  : [1*n] array of
-0001bd10: 2066 6c6f 6174 732c 2070 6f73 6974 696f   floats, positio
-0001bd20: 6e20 7061 7261 6d65 7465 7220 6f66 2065  n parameter of e
-0001bd30: 6163 6820 7265 666c 6563 7469 6f6e 0d0a  ach reflection..
-0001bd40: 2020 2020 3a70 6172 616d 2069 6e74 656e      :param inten
-0001bd50: 7369 7479 3a20 5b31 2a6e 5d20 6172 7261  sity: [1*n] arra
-0001bd60: 7920 6f66 2066 6c6f 6174 732c 2069 6e74  y of floats, int
-0001bd70: 656e 7369 7479 2070 6172 616d 6574 6572  ensity parameter
-0001bd80: 206f 6620 6561 6368 2072 6566 6c65 6374   of each reflect
-0001bd90: 696f 6e0d 0a20 2020 203a 7061 7261 6d20  ion..    :param 
-0001bda0: 6d69 6e5f 6f76 6572 6c61 703a 2066 6c6f  min_overlap: flo
-0001bdb0: 6174 2c20 686f 7720 636c 6f73 6520 7468  at, how close th
-0001bdc0: 6520 7265 666c 6563 7469 6f6e 7320 6172  e reflections ar
-0001bdd0: 6520 746f 2062 6520 6772 6f75 7065 640d  e to be grouped.
-0001bde0: 0a20 2020 203a 7265 7475 726e 3a20 6772  .    :return: gr
-0001bdf0: 6f75 705f 6964 783a 205b 312a 6d5d 2061  oup_idx: [1*m] a
-0001be00: 7272 6179 206f 6620 696e 7420 696e 6465  rray of int inde
-0001be10: 780d 0a20 2020 2022 2222 0d0a 0d0a 2020  x..    """....  
-0001be20: 2020 6772 6f75 7073 2c20 6172 7261 795f    groups, array_
-0001be30: 696e 6465 782c 2067 726f 7570 5f69 6e64  index, group_ind
-0001be40: 6578 2c20 636f 756e 7473 203d 2066 672e  ex, counts = fg.
-0001be50: 6772 6f75 7028 715f 7661 6c75 6573 2c20  group(q_values, 
-0001be60: 6d69 6e5f 6f76 6572 6c61 7029 0d0a 0d0a  min_overlap)....
-0001be70: 2020 2020 2320 6c6f 6f70 206f 7665 7220      # loop over 
-0001be80: 6772 6f75 7073 2061 6e64 2073 656c 6563  groups and selec
-0001be90: 7420 7265 666c 6563 7469 6f6e 2077 6974  t reflection wit
-0001bea0: 6820 6c61 7267 6573 7420 696e 7465 6e73  h largest intens
-0001beb0: 6974 790d 0a20 2020 2072 6566 5f6e 203d  ity..    ref_n =
-0001bec0: 206e 702e 7a65 726f 7328 6c65 6e28 6772   np.zeros(len(gr
-0001bed0: 6f75 7073 292c 2064 7479 7065 3d69 6e74  oups), dtype=int
-0001bee0: 290d 0a20 2020 2066 6f72 206e 2069 6e20  )..    for n in 
-0001bef0: 7261 6e67 6528 6c65 6e28 6772 6f75 7073  range(len(groups
-0001bf00: 2929 3a0d 0a20 2020 2020 2020 2061 7267  )):..        arg
-0001bf10: 7320 3d20 6e70 2e77 6865 7265 2861 7272  s = np.where(arr
-0001bf20: 6179 5f69 6e64 6578 203d 3d20 6e29 5b30  ay_index == n)[0
-0001bf30: 5d0d 0a20 2020 2020 2020 2023 2066 696e  ]..        # fin
-0001bf40: 6420 6d61 7820 696e 7465 6e73 6974 790d  d max intensity.
-0001bf50: 0a20 2020 2020 2020 2072 6566 5f6e 5b6e  .        ref_n[n
-0001bf60: 5d20 3d20 6172 6773 5b6e 702e 6172 676d  ] = args[np.argm
-0001bf70: 6178 2869 6e74 656e 7369 7479 5b61 7267  ax(intensity[arg
-0001bf80: 735d 295d 0d0a 2020 2020 7265 7475 726e  s])]..    return
-0001bf90: 2072 6566 5f6e 0d0a 0d0a 0d0a 6465 6620   ref_n......def 
-0001bfa0: 6361 6c63 5f76 6f6c 2855 5629 3a0d 0a20  calc_vol(UV):.. 
-0001bfb0: 2020 2022 4361 6c63 756c 6174 6520 766f     "Calculate vo
-0001bfc0: 6c75 6d65 2069 6e20 416e 6773 7472 6f6d  lume in Angstrom
-0001bfd0: 5e33 2066 726f 6d20 756e 6974 2076 6563  ^3 from unit vec
-0001bfe0: 746f 7273 220d 0a20 2020 2061 2c20 622c  tors"..    a, b,
-0001bff0: 2063 203d 2055 560d 0a20 2020 2072 6574   c = UV..    ret
-0001c000: 7572 6e20 6e70 2e64 6f74 2861 2c20 6e70  urn np.dot(a, np
-0001c010: 2e63 726f 7373 2862 2c20 6329 290d 0a0d  .cross(b, c))...
-0001c020: 0a0d 0a64 6566 2063 6966 3274 6162 6c65  ...def cif2table
-0001c030: 2863 6966 293a 0d0a 2020 2020 2222 220d  (cif):..    """.
-0001c040: 0a20 2020 2047 656e 6572 6174 6520 4c61  .    Generate La
-0001c050: 7465 7820 7461 626c 6520 6f66 2061 746f  tex table of ato
-0001c060: 6d69 6320 706f 7369 7469 6f6e 7320 6672  mic positions fr
-0001c070: 6f6d 2063 6966 2064 6963 7469 6f6e 6172  om cif dictionar
-0001c080: 790d 0a20 2020 203a 7061 7261 6d20 6369  y..    :param ci
-0001c090: 663a 2063 6966 2064 6963 7420 6672 6f6d  f: cif dict from
-0001c0a0: 2072 6561 6463 6966 0d0a 2020 2020 3a72   readcif..    :r
-0001c0b0: 6574 7572 6e3a 2073 7472 0d0a 2020 2020  eturn: str..    
-0001c0c0: 2222 220d 0a0d 0a20 2020 206b 6579 7320  """....    keys 
-0001c0d0: 3d20 6369 662e 6b65 7973 2829 0d0a 0d0a  = cif.keys()....
-0001c0e0: 2020 2020 2320 4765 6e65 7261 7465 2075      # Generate u
-0001c0f0: 6e69 7420 7665 6374 6f72 730d 0a20 2020  nit vectors..   
-0001c100: 2061 203d 2063 6966 5b27 5f63 656c 6c5f   a = cif['_cell_
-0001c110: 6c65 6e67 7468 5f61 275d 0d0a 2020 2020  length_a']..    
-0001c120: 6220 3d20 6369 665b 275f 6365 6c6c 5f6c  b = cif['_cell_l
-0001c130: 656e 6774 685f 6227 5d0d 0a20 2020 2063  ength_b']..    c
-0001c140: 203d 2063 6966 5b27 5f63 656c 6c5f 6c65   = cif['_cell_le
-0001c150: 6e67 7468 5f63 275d 0d0a 2020 2020 616c  ngth_c']..    al
-0001c160: 7068 6120 3d20 6369 665b 275f 6365 6c6c  pha = cif['_cell
-0001c170: 5f61 6e67 6c65 5f61 6c70 6861 275d 0d0a  _angle_alpha']..
-0001c180: 2020 2020 6265 7461 203d 2063 6966 5b27      beta = cif['
-0001c190: 5f63 656c 6c5f 616e 676c 655f 6265 7461  _cell_angle_beta
-0001c1a0: 275d 0d0a 2020 2020 6761 6d6d 6120 3d20  ']..    gamma = 
-0001c1b0: 6369 665b 275f 6365 6c6c 5f61 6e67 6c65  cif['_cell_angle
-0001c1c0: 5f67 616d 6d61 275d 0d0a 2020 2020 6c70  _gamma']..    lp
-0001c1d0: 203d 2072 2761 3d25 735c 4141 2c20 623d   = r'a=%s\AA, b=
-0001c1e0: 2573 5c41 412c 2063 3d25 735c 4141 2c20  %s\AA, c=%s\AA, 
-0001c1f0: 245c 616c 7068 6124 3d25 732c 2024 5c62  $\alpha$=%s, $\b
-0001c200: 6574 6124 3d25 732c 2024 5c67 616d 6d61  eta$=%s, $\gamma
-0001c210: 243d 2573 2720 2520 2861 2c20 622c 2063  $=%s' % (a, b, c
-0001c220: 2c20 616c 7068 612c 2062 6574 612c 2067  , alpha, beta, g
-0001c230: 616d 6d61 290d 0a0d 0a20 2020 2023 2047  amma)....    # G
-0001c240: 6574 2061 746f 6d20 6e61 6d65 7320 2620  et atom names & 
-0001c250: 6c61 6265 6c73 0d0a 2020 2020 6c61 6265  labels..    labe
-0001c260: 6c20 3d20 6369 665b 275f 6174 6f6d 5f73  l = cif['_atom_s
-0001c270: 6974 655f 6c61 6265 6c27 5d0d 0a0d 0a20  ite_label'].... 
-0001c280: 2020 2023 2054 6865 726d 616c 2070 6172     # Thermal par
-0001c290: 616d 6574 6572 730d 0a20 2020 2069 6620  ameters..    if 
-0001c2a0: 275f 6174 6f6d 5f73 6974 655f 555f 6973  '_atom_site_U_is
-0001c2b0: 6f5f 6f72 5f65 7175 6976 2720 696e 206b  o_or_equiv' in k
-0001c2c0: 6579 733a 0d0a 2020 2020 2020 2020 755f  eys:..        u_
-0001c2d0: 6f72 5f62 203d 2027 5524 5f7b 6973 6f7d  or_b = 'U$_{iso}
-0001c2e0: 2427 0d0a 2020 2020 2020 2020 7569 736f  $'..        uiso
-0001c2f0: 203d 2063 6966 5b27 5f61 746f 6d5f 7369   = cif['_atom_si
-0001c300: 7465 5f55 5f69 736f 5f6f 725f 6571 7569  te_U_iso_or_equi
-0001c310: 7627 5d0d 0a20 2020 2065 6c69 6620 275f  v']..    elif '_
-0001c320: 6174 6f6d 5f73 6974 655f 425f 6973 6f5f  atom_site_B_iso_
-0001c330: 6f72 5f65 7175 6976 2720 696e 206b 6579  or_equiv' in key
-0001c340: 733a 0d0a 2020 2020 2020 2020 755f 6f72  s:..        u_or
-0001c350: 5f62 203d 2027 4224 5f7b 6973 6f7d 2427  _b = 'B$_{iso}$'
-0001c360: 0d0a 2020 2020 2020 2020 7569 736f 203d  ..        uiso =
-0001c370: 2063 6966 5b27 5f61 746f 6d5f 7369 7465   cif['_atom_site
-0001c380: 5f42 5f69 736f 5f6f 725f 6571 7569 7627  _B_iso_or_equiv'
-0001c390: 5d0d 0a20 2020 2065 6c73 653a 0d0a 2020  ]..    else:..  
-0001c3a0: 2020 2020 2020 755f 6f72 5f62 203d 2027        u_or_b = '
-0001c3b0: 5524 5f7b 6973 6f7d 2427 0d0a 2020 2020  U$_{iso}$'..    
-0001c3c0: 2020 2020 7569 736f 203d 205b 2730 2e30      uiso = ['0.0
-0001c3d0: 3030 275d 202a 206c 656e 286c 6162 656c  00'] * len(label
-0001c3e0: 290d 0a20 2020 2023 204f 6363 7570 616e  )..    # Occupan
-0001c3f0: 6379 0d0a 2020 2020 6966 2027 5f61 746f  cy..    if '_ato
-0001c400: 6d5f 7369 7465 5f6f 6363 7570 616e 6379  m_site_occupancy
-0001c410: 2720 696e 206b 6579 733a 0d0a 2020 2020  ' in keys:..    
-0001c420: 2020 2020 6f63 6320 3d20 6369 665b 275f      occ = cif['_
-0001c430: 6174 6f6d 5f73 6974 655f 6f63 6375 7061  atom_site_occupa
-0001c440: 6e63 7927 5d0d 0a20 2020 2065 6c73 653a  ncy']..    else:
-0001c450: 0d0a 2020 2020 2020 2020 6f63 6320 3d20  ..        occ = 
-0001c460: 5b27 312e 3027 5d20 2a20 6c65 6e28 6c61  ['1.0'] * len(la
-0001c470: 6265 6c29 0d0a 2020 2020 2320 4d75 6c74  bel)..    # Mult
-0001c480: 6970 6c69 6369 7479 0d0a 2020 2020 6966  iplicity..    if
-0001c490: 2027 5f61 746f 6d5f 7369 7465 5f73 6974   '_atom_site_sit
-0001c4a0: 655f 7379 6d6d 6574 7279 5f6d 756c 7469  e_symmetry_multi
-0001c4b0: 706c 6963 6974 7927 2069 6e20 6b65 7973  plicity' in keys
-0001c4c0: 3a0d 0a20 2020 2020 2020 206d 756c 7420  :..        mult 
-0001c4d0: 3d20 5b73 202b 2027 6127 2066 6f72 2073  = [s + 'a' for s
-0001c4e0: 2069 6e20 6369 665b 275f 6174 6f6d 5f73   in cif['_atom_s
-0001c4f0: 6974 655f 7369 7465 5f73 796d 6d65 7472  ite_site_symmetr
-0001c500: 795f 6d75 6c74 6970 6c69 6369 7479 275d  y_multiplicity']
-0001c510: 5d0d 0a20 2020 2065 6c73 653a 0d0a 2020  ]..    else:..  
-0001c520: 2020 2020 2020 6d75 6c74 203d 205b 2731        mult = ['1
-0001c530: 6127 5d20 2a20 6c65 6e28 6c61 6265 6c29  a'] * len(label)
-0001c540: 0d0a 0d0a 2020 2020 2320 4765 7420 636f  ....    # Get co
-0001c550: 6f72 6469 6e61 7465 730d 0a20 2020 2075  ordinates..    u
-0001c560: 203d 2063 6966 5b27 5f61 746f 6d5f 7369   = cif['_atom_si
-0001c570: 7465 5f66 7261 6374 5f78 275d 0d0a 2020  te_fract_x']..  
-0001c580: 2020 7620 3d20 6369 665b 275f 6174 6f6d    v = cif['_atom
-0001c590: 5f73 6974 655f 6672 6163 745f 7927 5d0d  _site_fract_y'].
-0001c5a0: 0a20 2020 2077 203d 2063 6966 5b27 5f61  .    w = cif['_a
-0001c5b0: 746f 6d5f 7369 7465 5f66 7261 6374 5f7a  tom_site_fract_z
-0001c5c0: 275d 0d0a 0d0a 2020 2020 2320 4765 7420  ']....    # Get 
-0001c5d0: 7370 6163 6520 6772 6f75 700d 0a20 2020  space group..   
-0001c5e0: 2069 6620 275f 7379 6d6d 6574 7279 5f73   if '_symmetry_s
-0001c5f0: 7061 6365 5f67 726f 7570 5f6e 616d 655f  pace_group_name_
-0001c600: 482d 4d27 2069 6e20 6b65 7973 3a0d 0a20  H-M' in keys:.. 
-0001c610: 2020 2020 2020 2073 7061 6365 6772 6f75         spacegrou
-0001c620: 7020 3d20 6369 665b 275f 7379 6d6d 6574  p = cif['_symmet
-0001c630: 7279 5f73 7061 6365 5f67 726f 7570 5f6e  ry_space_group_n
-0001c640: 616d 655f 482d 4d27 5d0d 0a20 2020 2065  ame_H-M']..    e
-0001c650: 6c69 6620 275f 7370 6163 655f 6772 6f75  lif '_space_grou
-0001c660: 705f 6e61 6d65 5f48 2d4d 5f61 6c74 2720  p_name_H-M_alt' 
-0001c670: 696e 206b 6579 733a 0d0a 2020 2020 2020  in keys:..      
-0001c680: 2020 7370 6163 6567 726f 7570 203d 2063    spacegroup = c
-0001c690: 6966 5b27 5f73 7061 6365 5f67 726f 7570  if['_space_group
-0001c6a0: 5f6e 616d 655f 482d 4d5f 616c 7427 5d0d  _name_H-M_alt'].
-0001c6b0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
-0001c6c0: 2020 2020 7370 6163 6567 726f 7570 203d      spacegroup =
-0001c6d0: 2027 270d 0a20 2020 2069 6620 275f 7379   ''..    if '_sy
-0001c6e0: 6d6d 6574 7279 5f49 6e74 5f54 6162 6c65  mmetry_Int_Table
-0001c6f0: 735f 6e75 6d62 6572 2720 696e 206b 6579  s_number' in key
-0001c700: 733a 0d0a 2020 2020 2020 2020 7367 6e20  s:..        sgn 
-0001c710: 3d20 666c 6f61 7428 6369 665b 275f 7379  = float(cif['_sy
-0001c720: 6d6d 6574 7279 5f49 6e74 5f54 6162 6c65  mmetry_Int_Table
-0001c730: 735f 6e75 6d62 6572 275d 290d 0a20 2020  s_number'])..   
-0001c740: 2065 6c69 6620 275f 7370 6163 655f 6772   elif '_space_gr
-0001c750: 6f75 705f 4954 5f6e 756d 6265 7227 2069  oup_IT_number' i
-0001c760: 6e20 6b65 7973 3a0d 0a20 2020 2020 2020  n keys:..       
-0001c770: 2073 676e 203d 2066 6c6f 6174 2863 6966   sgn = float(cif
-0001c780: 5b27 5f73 7061 6365 5f67 726f 7570 5f49  ['_space_group_I
-0001c790: 545f 6e75 6d62 6572 275d 290d 0a20 2020  T_number'])..   
-0001c7a0: 2065 6c69 6620 7370 6163 6567 726f 7570   elif spacegroup
-0001c7b0: 203d 3d20 2750 3127 3a0d 0a20 2020 2020   == 'P1':..     
-0001c7c0: 2020 2073 676e 203d 2031 0d0a 2020 2020     sgn = 1..    
-0001c7d0: 656c 7365 3a0d 0a20 2020 2020 2020 2073  else:..        s
-0001c7e0: 676e 203d 2030 0d0a 0d0a 2020 2020 2320  gn = 0....    # 
-0001c7f0: 4164 6974 696f 6e61 6c20 6465 7461 696c  Aditional detail
-0001c800: 733a 0d0a 2020 2020 6966 2027 4669 6c65  s:..    if 'File
-0001c810: 5469 746c 6527 2069 6e20 6b65 7973 3a0d  Title' in keys:.
-0001c820: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-0001c830: 6369 665b 2746 696c 6554 6974 6c65 275d  cif['FileTitle']
-0001c840: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-0001c850: 2020 2020 206e 616d 6520 3d20 2773 616d       name = 'sam
-0001c860: 706c 6527 0d0a 0d0a 2020 2020 6578 7472  ple'....    extr
-0001c870: 6120 3d20 5b5d 0d0a 2020 2020 6966 2027  a = []..    if '
-0001c880: 5f63 656c 6c5f 6d65 6173 7572 656d 656e  _cell_measuremen
-0001c890: 745f 7465 6d70 6572 6174 7572 6527 2069  t_temperature' i
-0001c8a0: 6e20 6b65 7973 3a0d 0a20 2020 2020 2020  n keys:..       
-0001c8b0: 2065 7874 7261 202b 3d20 5b27 5420 3d20   extra += ['T = 
-0001c8c0: 2573 2720 2520 6369 665b 275f 6365 6c6c  %s' % cif['_cell
-0001c8d0: 5f6d 6561 7375 7265 6d65 6e74 5f74 656d  _measurement_tem
-0001c8e0: 7065 7261 7475 7265 275d 5d0d 0a20 2020  perature']]..   
-0001c8f0: 2069 6620 275f 6469 6666 726e 5f72 6566   if '_diffrn_ref
-0001c900: 6c6e 735f 6e75 6d62 6572 2720 696e 206b  lns_number' in k
-0001c910: 6579 733a 0d0a 2020 2020 2020 2020 6578  eys:..        ex
-0001c920: 7472 6120 2b3d 205b 2725 7320 7265 666c  tra += ['%s refl
-0001c930: 6563 7469 6f6e 7327 2025 2063 6966 5b27  ections' % cif['
-0001c940: 5f64 6966 6672 6e5f 7265 666c 6e73 5f6e  _diffrn_reflns_n
-0001c950: 756d 6265 7227 5d5d 0d0a 2020 2020 6966  umber']]..    if
-0001c960: 2027 5f72 6566 696e 655f 6c73 5f77 525f   '_refine_ls_wR_
-0001c970: 6661 6374 6f72 5f72 6566 2720 696e 206b  factor_ref' in k
-0001c980: 6579 733a 0d0a 2020 2020 2020 2020 6578  eys:..        ex
-0001c990: 7472 6120 2b3d 205b 2752 245f 7724 203d  tra += ['R$_w$ =
-0001c9a0: 2025 342e 3266 5c5c 2525 2720 2520 2866   %4.2f\\%%' % (f
-0001c9b0: 6c6f 6174 2863 6966 5b27 5f72 6566 696e  loat(cif['_refin
-0001c9c0: 655f 6c73 5f77 525f 6661 6374 6f72 5f72  e_ls_wR_factor_r
-0001c9d0: 6566 275d 2920 2a20 3130 3029 5d0d 0a20  ef']) * 100)].. 
-0001c9e0: 2020 2065 7874 7261 203d 2027 2c20 272e     extra = ', '.
-0001c9f0: 6a6f 696e 2865 7874 7261 290d 0a0d 0a20  join(extra).... 
-0001ca00: 2020 2023 2043 7265 6174 6520 7461 626c     # Create tabl
-0001ca10: 6520 7374 720d 0a20 2020 206f 7574 203d  e str..    out =
-0001ca20: 2027 2525 2025 735c 6e27 2025 2063 6966   '%% %s\n' % cif
-0001ca30: 5b27 4669 6c65 6e61 6d65 275d 0d0a 2020  ['Filename']..  
-0001ca40: 2020 6f75 7420 2b3d 2027 5c5c 6265 6769    out += '\\begi
-0001ca50: 6e7b 7461 626c 657d 5b68 7470 5d5c 6e27  n{table}[htp]\n'
-0001ca60: 0d0a 2020 2020 6f75 7420 2b3d 2027 2020  ..    out += '  
-0001ca70: 2020 5c5c 6365 6e74 6572 696e 675c 6e27    \\centering\n'
-0001ca80: 0d0a 2020 2020 6f75 7420 2b3d 2027 2020  ..    out += '  
-0001ca90: 2020 2020 205c 5c62 6567 696e 7b74 6162       \\begin{tab
-0001caa0: 756c 6172 7d7b 637c 637c 6363 6363 637d  ular}{c|c|ccccc}
-0001cab0: 5c6e 270d 0a20 2020 206f 7574 202b 3d20  \n'..    out += 
-0001cac0: 2720 2020 2020 2020 2020 2020 2020 2620  '             & 
-0001cad0: 5369 7465 2026 2078 2026 2079 2026 207a  Site & x & y & z
-0001cae0: 2026 204f 6363 2e20 2620 2573 205c 5c5c   & Occ. & %s \\\
-0001caf0: 5c20 5c68 6c69 6e65 5c6e 2720 2520 755f  \ \hline\n' % u_
-0001cb00: 6f72 5f62 0d0a 2020 2020 666d 7420 3d20  or_b..    fmt = 
-0001cb10: 2720 2020 2020 2020 2025 3473 2026 2025  '        %4s & %
-0001cb20: 3573 2026 2025 7320 2620 2573 2026 2025  5s & %s & %s & %
-0001cb30: 7320 2620 2573 2026 2025 7320 5c5c 5c5c  s & %s & %s \\\\
-0001cb40: 5c6e 270d 0a20 2020 2066 6f72 206e 2069  \n'..    for n i
-0001cb50: 6e20 7261 6e67 6528 6c65 6e28 6c61 6265  n range(len(labe
-0001cb60: 6c29 293a 0d0a 2020 2020 2020 2020 6f75  l)):..        ou
-0001cb70: 7420 2b3d 2066 6d74 2025 2028 6c61 6265  t += fmt % (labe
-0001cb80: 6c5b 6e5d 2c20 6d75 6c74 5b6e 5d2c 2075  l[n], mult[n], u
-0001cb90: 5b6e 5d2c 2076 5b6e 5d2c 2077 5b6e 5d2c  [n], v[n], w[n],
-0001cba0: 206f 6363 5b6e 5d2c 2075 6973 6f5b 6e5d   occ[n], uiso[n]
-0001cbb0: 290d 0a20 2020 206f 7574 202b 3d20 2720  )..    out += ' 
-0001cbc0: 2020 2020 2020 205c 5c65 6e64 7b74 6162         \\end{tab
-0001cbd0: 756c 6172 7d5c 6e27 0d0a 2020 2020 6f75  ular}\n'..    ou
-0001cbe0: 7420 2b3d 2027 2020 2020 5c5c 6361 7074  t += '    \\capt
-0001cbf0: 696f 6e7b 2573 2077 6974 6820 2573 2e20  ion{%s with %s. 
-0001cc00: 2573 7d5c 6e27 2025 2028 6e61 6d65 2c20  %s}\n' % (name, 
-0001cc10: 6c70 2c20 6578 7472 6129 0d0a 2020 2020  lp, extra)..    
-0001cc20: 6f75 7420 2b3d 2027 2020 2020 5c5c 6c61  out += '    \\la
-0001cc30: 6265 6c7b 7461 623a 7d5c 6e27 0d0a 2020  bel{tab:}\n'..  
-0001cc40: 2020 6f75 7420 2b3d 2027 5c5c 656e 647b    out += '\\end{
-0001cc50: 7461 626c 657d 5c6e 270d 0a20 2020 2072  table}\n'..    r
-0001cc60: 6574 7572 6e20 6f75 740d 0a              eturn out..
+0000a180: 6929 2920 2a2a 2032 2920 2b20 5c0d 0a20  i)) ** 2) + \.. 
+0000a190: 2020 2020 2020 2020 2020 2061 3220 2a20             a2 * 
+0000a1a0: 6e70 2e65 7870 282d 6232 202a 2028 516d  np.exp(-b2 * (Qm
+0000a1b0: 6167 202f 2028 3420 2a20 6e70 2e70 6929  ag / (4 * np.pi)
+0000a1c0: 2920 2a2a 2032 2920 2b20 5c0d 0a20 2020  ) ** 2) + \..   
+0000a1d0: 2020 2020 2020 2020 2061 3320 2a20 6e70           a3 * np
+0000a1e0: 2e65 7870 282d 6233 202a 2028 516d 6167  .exp(-b3 * (Qmag
+0000a1f0: 202f 2028 3420 2a20 6e70 2e70 6929 2920   / (4 * np.pi)) 
+0000a200: 2a2a 2032 2920 2b20 5c0d 0a20 2020 2020  ** 2) + \..     
+0000a210: 2020 2020 2020 2061 3420 2a20 6e70 2e65         a4 * np.e
+0000a220: 7870 282d 6234 202a 2028 516d 6167 202f  xp(-b4 * (Qmag /
+0000a230: 2028 3420 2a20 6e70 2e70 6929 2920 2a2a   (4 * np.pi)) **
+0000a240: 2032 2920 2b20 5c0d 0a20 2020 2020 2020   2) + \..       
+0000a250: 2020 2020 2061 3520 2a20 6e70 2e65 7870       a5 * np.exp
+0000a260: 282d 6235 202a 2028 516d 6167 202f 2028  (-b5 * (Qmag / (
+0000a270: 3420 2a20 6e70 2e70 6929 2920 2a2a 2032  4 * np.pi)) ** 2
+0000a280: 2920 2b20 630d 0a20 2020 2020 2020 2051  ) + c..        Q
+0000a290: 6666 5b3a 2c20 6e5d 203d 2066 0d0a 2020  ff[:, n] = f..  
+0000a2a0: 2020 7265 7475 726e 2051 6666 0d0a 0d0a    return Qff....
+0000a2b0: 0d0a 6465 6620 7872 6179 5f73 6361 7474  ..def xray_scatt
+0000a2c0: 6572 696e 675f 6661 6374 6f72 5f72 6573  ering_factor_res
+0000a2d0: 6f6e 616e 7428 656c 656d 656e 742c 2051  onant(element, Q
+0000a2e0: 6d61 672c 2065 6e65 7267 795f 6b65 7629  mag, energy_kev)
+0000a2f0: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+0000a300: 5265 6164 2058 2d72 6179 2073 6361 7474  Read X-ray scatt
+0000a310: 6572 696e 6720 6661 6374 6f72 2074 6162  ering factor tab
+0000a320: 6c65 2c20 6361 6c63 756c 6174 6520 6628  le, calculate f(
+0000a330: 7c51 7c29 0d0a 2020 2020 5573 6573 2074  |Q|)..    Uses t
+0000a340: 6865 2063 6f65 6666 6963 6965 6e74 7320  he coefficients 
+0000a350: 666f 7220 616e 616c 7974 6963 616c 2061  for analytical a
+0000a360: 7070 726f 7869 6d61 7469 6f6e 2074 6f20  pproximation to 
+0000a370: 7468 6520 7363 6174 7465 7269 6e67 2066  the scattering f
+0000a380: 6163 746f 7273 202d 2049 5443 2c20 7035  actors - ITC, p5
+0000a390: 3738 0d0a 2020 2020 2051 6666 203d 2078  78..     Qff = x
+0000a3a0: 7261 795f 7363 6174 7465 7269 6e67 5f66  ray_scattering_f
+0000a3b0: 6163 746f 725f 7265 736f 6e61 6e74 2865  actor_resonant(e
+0000a3c0: 6c65 6d65 6e74 2c20 656e 6572 6779 5f6b  lement, energy_k
+0000a3d0: 6576 2c20 716d 6167 290d 0a0d 0a20 2020  ev, qmag)....   
+0000a3e0: 2069 6620 7265 736f 6e61 6e74 5f65 6e65   if resonant_ene
+0000a3f0: 7267 7920 3d20 666c 6f61 7428 656e 6572  rgy = float(ener
+0000a400: 6779 2069 6e20 6b65 5629 2c20 7468 6520  gy in keV), the 
+0000a410: 746f 7461 6c20 6174 6f6d 6963 2073 6361  total atomic sca
+0000a420: 7474 6572 696e 6720 616d 706c 6974 7564  ttering amplitud
+0000a430: 6520 7769 6c6c 2062 6520 7265 7475 726e  e will be return
+0000a440: 6564 3a0d 0a20 2020 2020 2020 2066 287c  ed:..        f(|
+0000a450: 517c 2c20 4529 203d 2066 3028 7c51 7c29  Q|, E) = f0(|Q|)
+0000a460: 202b 2066 2728 4529 202d 2069 6627 2728   + f'(E) - if''(
+0000a470: 4529 0d0a 2020 2020 5365 653a 0d0a 2020  E)..    See:..  
+0000a480: 2020 3a70 6172 616d 2065 6c65 6d65 6e74    :param element
+0000a490: 3a20 5b6e 2a73 7472 5d20 6c69 7374 206f  : [n*str] list o
+0000a4a0: 7220 6172 7261 7920 6f66 2065 6c65 6d65  r array of eleme
+0000a4b0: 6e74 730d 0a20 2020 203a 7061 7261 6d20  nts..    :param 
+0000a4c0: 516d 6167 3a20 5b6d 5d20 6172 7261 7920  Qmag: [m] array 
+0000a4d0: 7761 7665 7665 6374 6f72 2064 6973 7461  wavevector dista
+0000a4e0: 6e63 6520 7c51 7c2c 2069 6e20 415e 2d31  nce |Q|, in A^-1
+0000a4f0: 0d0a 2020 2020 3a70 6172 616d 2065 6e65  ..    :param ene
+0000a500: 7267 795f 6b65 763a 205b 6f5d 2061 7272  rgy_kev: [o] arr
+0000a510: 6179 2065 6e65 7267 7920 696e 206b 6556  ay energy in keV
+0000a520: 0d0a 2020 2020 3a72 6574 7572 6e3a 205b  ..    :return: [
+0000a530: 6d2a 6e2a 6f5d 2063 6f6d 706c 6578 2061  m*n*o] complex a
+0000a540: 7272 6179 206f 6620 7363 6174 7465 7269  rray of scatteri
+0000a550: 6e67 2066 6163 746f 7273 0d0a 2020 2020  ng factors..    
+0000a560: 2222 220d 0a0d 0a20 2020 2023 2051 6d61  """....    # Qma
+0000a570: 6720 616e 6420 656e 6572 6779 5f6b 6576  g and energy_kev
+0000a580: 2073 686f 756c 6420 6265 2061 2031 4420   should be a 1D 
+0000a590: 6172 7261 790d 0a20 2020 2051 6d61 6720  array..    Qmag 
+0000a5a0: 3d20 6e70 2e61 7361 7272 6179 2851 6d61  = np.asarray(Qma
+0000a5b0: 6729 2e72 6573 6861 7065 282d 3129 0d0a  g).reshape(-1)..
+0000a5c0: 2020 2020 656e 6572 6779 5f6b 6576 203d      energy_kev =
+0000a5d0: 206e 702e 6173 6172 7261 7928 656e 6572   np.asarray(ener
+0000a5e0: 6779 5f6b 6576 292e 7265 7368 6170 6528  gy_kev).reshape(
+0000a5f0: 2d31 290d 0a0d 0a20 2020 2063 6f65 6620  -1)....    coef 
+0000a600: 3d20 6174 6f6d 5f70 726f 7065 7274 6965  = atom_propertie
+0000a610: 7328 656c 656d 656e 742c 205b 2761 3127  s(element, ['a1'
+0000a620: 2c20 2762 3127 2c20 2761 3227 2c20 2762  , 'b1', 'a2', 'b
+0000a630: 3227 2c20 2761 3327 2c20 2762 3327 2c20  2', 'a3', 'b3', 
+0000a640: 2761 3427 2c20 2762 3427 2c20 2763 275d  'a4', 'b4', 'c']
+0000a650: 290d 0a20 2020 2066 312c 2066 3220 3d20  )..    f1, f2 = 
+0000a660: 7872 6179 5f64 6973 7065 7273 696f 6e5f  xray_dispersion_
+0000a670: 636f 7272 6563 7469 6f6e 7328 656c 656d  corrections(elem
+0000a680: 656e 742c 2065 6e65 7267 795f 6b65 7629  ent, energy_kev)
+0000a690: 2020 2320 7368 6170 6520 286c 656e 2865    # shape (len(e
+0000a6a0: 6e65 7267 7929 2c20 6c65 6e28 656c 656d  nergy), len(elem
+0000a6b0: 656e 7429 290d 0a0d 0a20 2020 2051 6666  ent))....    Qff
+0000a6c0: 203d 206e 702e 7a65 726f 7328 5b6c 656e   = np.zeros([len
+0000a6d0: 2851 6d61 6729 2c20 6c65 6e28 636f 6566  (Qmag), len(coef
+0000a6e0: 292c 206c 656e 2865 6e65 7267 795f 6b65  ), len(energy_ke
+0000a6f0: 7629 5d2c 2064 7479 7065 3d63 6f6d 706c  v)], dtype=compl
+0000a700: 6578 290d 0a20 2020 2023 2042 726f 6164  ex)..    # Broad
+0000a710: 6361 7374 2064 6973 7065 7273 696f 6e20  cast dispersion 
+0000a720: 636f 7272 6563 7469 6f6e 730d 0a20 2020  corrections..   
+0000a730: 2051 6666 5b3a 2c20 3a2c 203a 5d20 3d20   Qff[:, :, :] = 
+0000a740: 6631 2e54 202d 2031 6a20 2a20 6632 2e54  f1.T - 1j * f2.T
+0000a750: 2020 2320 6368 616e 6765 2066 726f 6d20    # change from 
+0000a760: 2b20 746f 202d 206f 6e20 322f 4a75 6c79  + to - on 2/July
+0000a770: 2f32 3032 330d 0a0d 0a20 2020 2023 204c  /2023....    # L
+0000a780: 6f6f 7020 6f76 6572 2065 6c65 6d65 6e74  oop over element
+0000a790: 730d 0a20 2020 2066 6f72 206e 2069 6e20  s..    for n in 
+0000a7a0: 7261 6e67 6528 6c65 6e28 636f 6566 2929  range(len(coef))
+0000a7b0: 3a0d 0a20 2020 2020 2020 2061 3120 3d20  :..        a1 = 
+0000a7c0: 636f 6566 5b27 6131 275d 5b6e 5d0d 0a20  coef['a1'][n].. 
+0000a7d0: 2020 2020 2020 2062 3120 3d20 636f 6566         b1 = coef
+0000a7e0: 5b27 6231 275d 5b6e 5d0d 0a20 2020 2020  ['b1'][n]..     
+0000a7f0: 2020 2061 3220 3d20 636f 6566 5b27 6132     a2 = coef['a2
+0000a800: 275d 5b6e 5d0d 0a20 2020 2020 2020 2062  '][n]..        b
+0000a810: 3220 3d20 636f 6566 5b27 6232 275d 5b6e  2 = coef['b2'][n
+0000a820: 5d0d 0a20 2020 2020 2020 2061 3320 3d20  ]..        a3 = 
+0000a830: 636f 6566 5b27 6133 275d 5b6e 5d0d 0a20  coef['a3'][n].. 
+0000a840: 2020 2020 2020 2062 3320 3d20 636f 6566         b3 = coef
+0000a850: 5b27 6233 275d 5b6e 5d0d 0a20 2020 2020  ['b3'][n]..     
+0000a860: 2020 2061 3420 3d20 636f 6566 5b27 6134     a4 = coef['a4
+0000a870: 275d 5b6e 5d0d 0a20 2020 2020 2020 2062  '][n]..        b
+0000a880: 3420 3d20 636f 6566 5b27 6234 275d 5b6e  4 = coef['b4'][n
+0000a890: 5d0d 0a20 2020 2020 2020 2063 203d 2063  ]..        c = c
+0000a8a0: 6f65 665b 2763 275d 5b6e 5d0d 0a0d 0a20  oef['c'][n].... 
+0000a8b0: 2020 2020 2020 2023 2041 7272 6179 206d         # Array m
+0000a8c0: 756c 7469 706c 6963 6174 696f 6e20 6f76  ultiplication ov
+0000a8d0: 6572 2051 6d61 6773 0d0a 2020 2020 2020  er Qmags..      
+0000a8e0: 2020 6620 3d20 6131 202a 206e 702e 6578    f = a1 * np.ex
+0000a8f0: 7028 2d62 3120 2a20 2851 6d61 6720 2f20  p(-b1 * (Qmag / 
+0000a900: 2834 202a 206e 702e 7069 2929 202a 2a20  (4 * np.pi)) ** 
+0000a910: 3229 202b 205c 0d0a 2020 2020 2020 2020  2) + \..        
+0000a920: 2020 2020 6132 202a 206e 702e 6578 7028      a2 * np.exp(
+0000a930: 2d62 3220 2a20 2851 6d61 6720 2f20 2834  -b2 * (Qmag / (4
+0000a940: 202a 206e 702e 7069 2929 202a 2a20 3229   * np.pi)) ** 2)
+0000a950: 202b 205c 0d0a 2020 2020 2020 2020 2020   + \..          
+0000a960: 2020 6133 202a 206e 702e 6578 7028 2d62    a3 * np.exp(-b
+0000a970: 3320 2a20 2851 6d61 6720 2f20 2834 202a  3 * (Qmag / (4 *
+0000a980: 206e 702e 7069 2929 202a 2a20 3229 202b   np.pi)) ** 2) +
+0000a990: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+0000a9a0: 6134 202a 206e 702e 6578 7028 2d62 3420  a4 * np.exp(-b4 
+0000a9b0: 2a20 2851 6d61 6720 2f20 2834 202a 206e  * (Qmag / (4 * n
+0000a9c0: 702e 7069 2929 202a 2a20 3229 202b 2063  p.pi)) ** 2) + c
+0000a9d0: 0d0a 2020 2020 2020 2020 666f 7220 6520  ..        for e 
+0000a9e0: 696e 2072 616e 6765 286c 656e 2865 6e65  in range(len(ene
+0000a9f0: 7267 795f 6b65 7629 293a 0d0a 2020 2020  rgy_kev)):..    
+0000aa00: 2020 2020 2020 2020 5166 665b 3a2c 206e          Qff[:, n
+0000aa10: 2c20 655d 202b 3d20 660d 0a20 2020 2072  , e] += f..    r
+0000aa20: 6574 7572 6e20 5166 660d 0a0d 0a0d 0a64  eturn Qff......d
+0000aa30: 6566 206d 6167 6e65 7469 635f 666f 726d  ef magnetic_form
+0000aa40: 5f66 6163 746f 7228 656c 656d 656e 742c  _factor(element,
+0000aa50: 2051 6d61 673d 302e 293a 0d0a 2020 2020   Qmag=0.):..    
+0000aa60: 2222 220d 0a20 2020 2052 6561 6420 4d61  """..    Read Ma
+0000aa70: 676e 6574 6963 2066 6f72 6d20 6661 6374  gnetic form fact
+0000aa80: 6f72 2074 6162 6c65 2c20 6361 6c63 756c  or table, calcul
+0000aa90: 6174 6520 3c6a 3028 7c51 7c29 3e0d 0a20  ate <j0(|Q|)>.. 
+0000aaa0: 2020 2041 6e61 6c79 7469 6361 6c20 6170     Analytical ap
+0000aab0: 7072 6f78 696d 6174 696f 6e20 6f66 2074  proximation of t
+0000aac0: 6865 206d 6167 6e65 7469 6320 666f 726d  he magnetic form
+0000aad0: 2066 6163 746f 723a 0d0a 2020 2020 2020   factor:..      
+0000aae0: 2020 3c6a 3028 7c51 7c29 3e20 3d20 412a    <j0(|Q|)> = A*
+0000aaf0: 6578 7028 2d61 2a73 5e32 2920 2b20 422a  exp(-a*s^2) + B*
+0000ab00: 6578 7028 2d62 2a73 5e32 2920 2b20 432a  exp(-b*s^2) + C*
+0000ab10: 6578 7028 2d63 2a73 5e32 2920 2b20 442c  exp(-c*s^2) + D,
+0000ab20: 2077 6865 7265 2073 203d 2073 696e 2874   where s = sin(t
+0000ab30: 6865 7461 292f 6c61 6d62 6461 2069 6e20  heta)/lambda in 
+0000ab40: 412d 310d 0a20 2020 2053 6565 206d 6f72  A-1..    See mor
+0000ab50: 6520 6162 6f75 7420 7468 6520 6170 7072  e about the appr
+0000ab60: 6f78 696d 6174 696f 2068 6572 653a 2068  oximatio here: h
+0000ab70: 7474 7073 3a2f 2f77 7777 2e69 6c6c 2e65  ttps://www.ill.e
+0000ab80: 752f 7369 7465 732f 6363 736c 2f66 6661  u/sites/ccsl/ffa
+0000ab90: 6374 732f 6666 6163 746e 6f64 6533 2e68  cts/ffactnode3.h
+0000aba0: 746d 6c0d 0a20 2020 204e 6f74 653a 2043  tml..    Note: C
+0000abb0: 7572 7265 6e74 6c79 206f 6e6c 7920 4a30  urrently only J0
+0000abc0: 2074 6572 6d73 2061 7265 2075 7365 6420   terms are used 
+0000abd0: 616e 6420 3564 2061 746f 6d73 2061 7265  and 5d atoms are
+0000abe0: 206e 6f74 2063 7572 7265 6e74 6c79 2069   not currently i
+0000abf0: 6e63 6c75 6465 640d 0a20 2020 2055 7361  ncluded..    Usa
+0000ac00: 6765 3a0d 0a20 2020 2020 2020 2020 5166  ge:..         Qf
+0000ac10: 6620 3d20 7265 6164 5f6d 6666 2865 6c65  f = read_mff(ele
+0000ac20: 6d65 6e74 2c51 6d61 6729 0d0a 2020 2020  ment,Qmag)..    
+0000ac30: 2020 2020 2065 6c65 6d65 6e74 203d 2073       element = s
+0000ac40: 7472 2065 6c65 6d65 6e74 206e 616d 652c  tr element name,
+0000ac50: 2065 2e67 2e20 2743 6f27 0d0a 2020 2020   e.g. 'Co'..    
+0000ac60: 2020 2020 2051 6d61 6720 3d20 6d61 676e       Qmag = magn
+0000ac70: 6974 7564 6520 6f66 2051 3d73 696e 2874  itude of Q=sin(t
+0000ac80: 6865 7461 292f 6c61 6d62 6461 2069 6e20  heta)/lambda in 
+0000ac90: 412d 3120 6174 2077 6869 6368 2074 6f20  A-1 at which to 
+0000aca0: 6361 6c63 7561 6c74 652c 2063 616e 2062  calcualte, can b
+0000acb0: 6520 6120 6c69 7374 206f 7220 6172 7261  e a list or arra
+0000acc0: 7920 746f 2072 6574 7572 6e20 6d75 6c74  y to return mult
+0000acd0: 6970 6c65 2076 616c 7565 730d 0a20 2020  iple values..   
+0000ace0: 2020 2020 2020 5166 6620 3d20 4d61 676e        Qff = Magn
+0000acf0: 6574 6963 2066 6f72 6d20 6661 6374 6f72  etic form factor
+0000ad00: 2066 6f72 2065 6c65 6d65 6e74 2061 7420   for element at 
+0000ad10: 516d 6167 0d0a 2020 2020 452e 472e 0d0a  Qmag..    E.G...
+0000ad20: 2020 2020 2020 2020 5166 6620 3d20 7265          Qff = re
+0000ad30: 6164 5f6d 6666 2827 436f 272c 6e70 2e61  ad_mff('Co',np.a
+0000ad40: 7261 6e67 6528 302c 342c 302e 3129 290d  range(0,4,0.1)).
+0000ad50: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
+0000ad60: 2320 516d 6167 2073 686f 756c 6420 6265  # Qmag should be
+0000ad70: 2061 2031 4420 6172 7261 790d 0a20 2020   a 1D array..   
+0000ad80: 2023 2073 203d 2073 696e 2874 6829 2f6c   # s = sin(th)/l
+0000ad90: 616d 6264 6120 3d20 7c51 7c2f 3470 690d  ambda = |Q|/4pi.
+0000ada0: 0a20 2020 2073 203d 206e 702e 6173 6172  .    s = np.asar
+0000adb0: 7261 7928 516d 6167 292e 7265 7368 6170  ray(Qmag).reshap
+0000adc0: 6528 2d31 2920 2f20 2834 202a 206e 702e  e(-1) / (4 * np.
+0000add0: 7069 290d 0a0d 0a20 2020 2063 6f65 6620  pi)....    coef 
+0000ade0: 3d20 6174 6f6d 5f70 726f 7065 7274 6965  = atom_propertie
+0000adf0: 7328 656c 656d 656e 742c 205b 276a 305f  s(element, ['j0_
+0000ae00: 4127 2c20 276a 305f 6127 2c20 276a 305f  A', 'j0_a', 'j0_
+0000ae10: 4227 2c20 276a 305f 6227 2c20 276a 305f  B', 'j0_b', 'j0_
+0000ae20: 4327 2c20 276a 305f 6327 2c20 276a 305f  C', 'j0_c', 'j0_
+0000ae30: 4427 5d29 0d0a 0d0a 2020 2020 2320 4e71  D'])....    # Nq
+0000ae40: 706f 696e 7469 6e67 7320 7820 4e65 6c65  pointings x Nele
+0000ae50: 6d65 6e74 730d 0a20 2020 2051 6666 203d  ments..    Qff =
+0000ae60: 206e 702e 7a65 726f 7328 5b6c 656e 2873   np.zeros([len(s
+0000ae70: 292c 206c 656e 2863 6f65 6629 5d29 0d0a  ), len(coef)])..
+0000ae80: 0d0a 2020 2020 2320 4c6f 6f70 206f 7665  ..    # Loop ove
+0000ae90: 7220 656c 656d 656e 7473 0d0a 2020 2020  r elements..    
+0000aea0: 666f 7220 6e20 696e 2072 616e 6765 286c  for n in range(l
+0000aeb0: 656e 2863 6f65 6629 293a 0d0a 2020 2020  en(coef)):..    
+0000aec0: 2020 2020 4120 3d20 636f 6566 5b27 6a30      A = coef['j0
+0000aed0: 5f41 275d 5b6e 5d0d 0a20 2020 2020 2020  _A'][n]..       
+0000aee0: 2061 203d 2063 6f65 665b 276a 305f 6127   a = coef['j0_a'
+0000aef0: 5d5b 6e5d 0d0a 2020 2020 2020 2020 4220  ][n]..        B 
+0000af00: 3d20 636f 6566 5b27 6a30 5f42 275d 5b6e  = coef['j0_B'][n
+0000af10: 5d0d 0a20 2020 2020 2020 2062 203d 2063  ]..        b = c
+0000af20: 6f65 665b 276a 305f 6227 5d5b 6e5d 0d0a  oef['j0_b'][n]..
+0000af30: 2020 2020 2020 2020 4320 3d20 636f 6566          C = coef
+0000af40: 5b27 6a30 5f43 275d 5b6e 5d0d 0a20 2020  ['j0_C'][n]..   
+0000af50: 2020 2020 2063 203d 2063 6f65 665b 276a       c = coef['j
+0000af60: 305f 6327 5d5b 6e5d 0d0a 2020 2020 2020  0_c'][n]..      
+0000af70: 2020 4420 3d20 636f 6566 5b27 6a30 5f44    D = coef['j0_D
+0000af80: 275d 5b6e 5d0d 0a0d 0a20 2020 2020 2020  '][n]....       
+0000af90: 206a 3020 3d20 4120 2a20 6e70 2e65 7870   j0 = A * np.exp
+0000afa0: 282d 6120 2a20 7320 2a2a 2032 2920 2b20  (-a * s ** 2) + 
+0000afb0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+0000afc0: 4220 2a20 6e70 2e65 7870 282d 6220 2a20  B * np.exp(-b * 
+0000afd0: 7320 2a2a 2032 2920 2b20 5c0d 0a20 2020  s ** 2) + \..   
+0000afe0: 2020 2020 2020 2020 2020 4320 2a20 6e70            C * np
+0000aff0: 2e65 7870 282d 6320 2a20 7320 2a2a 2032  .exp(-c * s ** 2
+0000b000: 2920 2b20 440d 0a20 2020 2020 2020 2051  ) + D..        Q
+0000b010: 6666 5b3a 2c20 6e5d 203d 206a 300d 0a20  ff[:, n] = j0.. 
+0000b020: 2020 2072 6574 7572 6e20 5166 660d 0a0d     return Qff...
+0000b030: 0a0d 0a64 6566 2061 7474 656e 7561 7469  ...def attenuati
+0000b040: 6f6e 2865 6c65 6d65 6e74 5f7a 2c20 656e  on(element_z, en
+0000b050: 6572 6779 5f6b 6556 293a 0d0a 2020 2020  ergy_keV):..    
+0000b060: 2222 220d 0a20 2020 2020 5265 7475 726e  """..     Return
+0000b070: 7320 7468 6520 782d 7261 7920 6d61 7373  s the x-ray mass
+0000b080: 2061 7474 656e 7561 7469 6f6e 2c20 752f   attenuation, u/
+0000b090: 702c 2069 6e20 636d 5e32 2f67 0d0a 2020  p, in cm^2/g..  
+0000b0a0: 2020 2020 2065 2e67 2e20 4120 3d20 6174       e.g. A = at
+0000b0b0: 7465 6e75 6174 696f 6e28 3233 2c6e 702e  tenuation(23,np.
+0000b0c0: 6172 616e 6765 2837 2c38 2c30 2e30 3129  arange(7,8,0.01)
+0000b0d0: 2920 2320 4375 0d0a 2020 2020 2020 2020  ) # Cu..        
+0000b0e0: 2020 2020 4120 3d20 6174 7465 6e75 6174      A = attenuat
+0000b0f0: 696f 6e28 5b32 332c 3234 2c32 355d 2c20  ion([23,24,25], 
+0000b100: 352e 3629 0d0a 2020 2020 2020 2020 2020  5.6)..          
+0000b110: 2020 6120 3d20 6174 7465 6e75 6174 696f    a = attenuatio
+0000b120: 6e28 3139 2c34 2e35 2920 2320 4b0d 0a20  n(19,4.5) # K.. 
+0000b130: 2020 2022 2222 0d0a 2020 2020 656c 656d     """..    elem
+0000b140: 656e 745f 7a20 3d20 6e70 2e61 7361 7272  ent_z = np.asarr
+0000b150: 6179 2865 6c65 6d65 6e74 5f7a 292e 7265  ay(element_z).re
+0000b160: 7368 6170 6528 2d31 290d 0a20 2020 2065  shape(-1)..    e
+0000b170: 6e65 7267 795f 6b65 5620 3d20 6e70 2e61  nergy_keV = np.a
+0000b180: 7361 7272 6179 2865 6e65 7267 795f 6b65  sarray(energy_ke
+0000b190: 5629 2e72 6573 6861 7065 282d 3129 0d0a  V).reshape(-1)..
+0000b1a0: 0d0a 2020 2020 786d 615f 6669 6c65 203d  ..    xma_file =
+0000b1b0: 206f 732e 7061 7468 2e6a 6f69 6e28 6461   os.path.join(da
+0000b1c0: 7461 6469 722c 2027 5852 6179 4d61 7373  tadir, 'XRayMass
+0000b1d0: 4174 7465 6e5f 6d75 702e 6461 7427 290d  Atten_mup.dat').
+0000b1e0: 0a20 2020 2078 6d61 5f64 6174 6120 3d20  .    xma_data = 
+0000b1f0: 6e70 2e6c 6f61 6474 7874 2878 6d61 5f66  np.loadtxt(xma_f
+0000b200: 696c 6529 0d0a 0d0a 2020 2020 656e 6572  ile)....    ener
+0000b210: 6769 6573 203d 2078 6d61 5f64 6174 615b  gies = xma_data[
+0000b220: 3a2c 2030 5d20 2f20 3130 3030 2e0d 0a20  :, 0] / 1000... 
+0000b230: 2020 206f 7574 203d 206e 702e 7a65 726f     out = np.zero
+0000b240: 7328 5b6c 656e 2865 6e65 7267 795f 6b65  s([len(energy_ke
+0000b250: 5629 2c20 6c65 6e28 656c 656d 656e 745f  V), len(element_
+0000b260: 7a29 5d29 0d0a 2020 2020 666f 7220 6e2c  z)])..    for n,
+0000b270: 207a 2069 6e20 656e 756d 6572 6174 6528   z in enumerate(
+0000b280: 656c 656d 656e 745f 7a29 3a0d 0a20 2020  element_z):..   
+0000b290: 2020 2020 2023 2049 6e74 6572 706f 6c61       # Interpola
+0000b2a0: 7469 6e67 2074 6865 206c 6f67 2076 616c  ting the log val
+0000b2b0: 7565 7320 6973 206d 7563 6820 6d6f 7265  ues is much more
+0000b2c0: 2072 656c 6961 626c 650d 0a20 2020 2020   reliable..     
+0000b2d0: 2020 206f 7574 5b3a 2c20 6e5d 203d 206e     out[:, n] = n
+0000b2e0: 702e 6578 7028 6e70 2e69 6e74 6572 7028  p.exp(np.interp(
+0000b2f0: 6e70 2e6c 6f67 2865 6e65 7267 795f 6b65  np.log(energy_ke
+0000b300: 5629 2c20 6e70 2e6c 6f67 2865 6e65 7267  V), np.log(energ
+0000b310: 6965 7329 2c20 6e70 2e6c 6f67 2878 6d61  ies), np.log(xma
+0000b320: 5f64 6174 615b 3a2c 207a 5d29 2929 0d0a  _data[:, z])))..
+0000b330: 2020 2020 2020 2020 6f75 745b 3a2c 206e          out[:, n
+0000b340: 5d20 3d20 6e70 2e69 6e74 6572 7028 656e  ] = np.interp(en
+0000b350: 6572 6779 5f6b 6556 2c20 656e 6572 6769  ergy_keV, energi
+0000b360: 6573 2c20 786d 615f 6461 7461 5b3a 2c20  es, xma_data[:, 
+0000b370: 7a5d 290d 0a20 2020 2069 6620 6c65 6e28  z])..    if len(
+0000b380: 656c 656d 656e 745f 7a29 203d 3d20 313a  element_z) == 1:
+0000b390: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000b3a0: 206f 7574 5b3a 2c20 305d 0d0a 2020 2020   out[:, 0]..    
+0000b3b0: 7265 7475 726e 206f 7574 0d0a 0d0a 0d0a  return out......
+0000b3c0: 6465 6620 6174 6f6d 6963 5f73 6361 7474  def atomic_scatt
+0000b3d0: 6572 696e 675f 6661 6374 6f72 2865 6c65  ering_factor(ele
+0000b3e0: 6d65 6e74 2c20 656e 6572 6779 5f6b 6576  ment, energy_kev
+0000b3f0: 3d4e 6f6e 6529 3a0d 0a20 2020 2022 2222  =None):..    """
+0000b400: 0d0a 2020 2020 5265 6164 2061 746f 6d69  ..    Read atomi
+0000b410: 6320 7363 6174 7465 7269 6e67 2066 6163  c scattering fac
+0000b420: 746f 7220 7461 626c 652c 2067 6976 696e  tor table, givin
+0000b430: 6720 6631 2b66 3220 666f 7220 6469 6666  g f1+f2 for diff
+0000b440: 6572 656e 7420 656e 6572 6769 6573 0d0a  erent energies..
+0000b450: 2020 2020 4672 6f6d 3a20 6874 7470 3a2f      From: http:/
+0000b460: 2f68 656e 6b65 2e6c 626c 2e67 6f76 2f6f  /henke.lbl.gov/o
+0000b470: 7074 6963 616c 5f63 6f6e 7374 616e 7473  ptical_constants
+0000b480: 2f61 7366 2e68 746d 6c0d 0a20 2020 203a  /asf.html..    :
+0000b490: 7061 7261 6d20 656c 656d 656e 743a 2073  param element: s
+0000b4a0: 7472 206f 7220 6c69 7374 206f 6620 7374  tr or list of st
+0000b4b0: 722c 206e 616d 6520 6f66 2065 6c65 6d65  r, name of eleme
+0000b4c0: 6e74 2e20 4966 2065 6c65 6d65 6e74 2073  nt. If element s
+0000b4d0: 7472 696e 6720 696e 636c 7564 6573 2061  tring includes a
+0000b4e0: 206e 756d 6265 722c 2074 6869 7320 7769   number, this wi
+0000b4f0: 6c6c 206d 756c 7469 706c 7920 7661 6c75  ll multiply valu
+0000b500: 6573 0d0a 2020 2020 3a70 6172 616d 2065  es..    :param e
+0000b510: 6e65 7267 795f 6b65 763a 2066 6c6f 6174  nergy_kev: float
+0000b520: 206f 7220 6c69 7374 2065 6e65 7267 7920   or list energy 
+0000b530: 696e 206b 6556 2028 4e6f 6e65 2074 6f20  in keV (None to 
+0000b540: 7265 7475 726e 206f 7269 6769 6e61 6c2c  return original,
+0000b550: 2075 6e69 6e74 6572 706f 6c61 7465 6420   uninterpolated 
+0000b560: 6c69 7374 290d 0a20 2020 203a 7265 7475  list)..    :retu
+0000b570: 726e 3a20 6631 2c20 6632 2c20 7368 6170  rn: f1, f2, shap
+0000b580: 6520 6465 7065 6e64 656e 7420 6f6e 2073  e dependent on s
+0000b590: 6861 7065 7320 6f66 2065 6c65 6d65 6e74  hapes of element
+0000b5a0: 2061 6e64 2065 6e65 7267 795f 6b65 763a   and energy_kev:
+0000b5b0: 2020 666c 6f61 742c 206f 7220 5b65 6e65    float, or [ene
+0000b5c0: 5d20 6f72 205b 656c 652c 2065 6e65 5d0d  ] or [ele, ene].
+0000b5d0: 0a20 2020 2022 2222 0d0a 2020 2020 6173  .    """..    as
+0000b5e0: 665f 6669 6c65 203d 206f 732e 7061 7468  f_file = os.path
+0000b5f0: 2e6a 6f69 6e28 6461 7461 6469 722c 2027  .join(datadir, '
+0000b600: 6174 6f6d 6963 5f73 6361 7474 6572 696e  atomic_scatterin
+0000b610: 675f 6661 6374 6f72 732e 6e70 7927 290d  g_factors.npy').
+0000b620: 0a20 2020 2061 7366 203d 206e 702e 6c6f  .    asf = np.lo
+0000b630: 6164 2861 7366 5f66 696c 652c 2061 6c6c  ad(asf_file, all
+0000b640: 6f77 5f70 6963 6b6c 653d 5472 7565 290d  ow_pickle=True).
+0000b650: 0a20 2020 2061 7366 203d 2061 7366 2e69  .    asf = asf.i
+0000b660: 7465 6d28 290d 0a0d 0a20 2020 2065 6c65  tem()....    ele
+0000b670: 6d65 6e74 203d 206e 702e 6173 6172 7261  ment = np.asarra
+0000b680: 7928 656c 656d 656e 742c 2064 7479 7065  y(element, dtype
+0000b690: 3d73 7472 292e 7265 7368 6170 6528 2d31  =str).reshape(-1
+0000b6a0: 290d 0a20 2020 2065 6e65 7267 7920 3d20  )..    energy = 
+0000b6b0: 7b7d 0d0a 2020 2020 6631 203d 207b 7d0d  {}..    f1 = {}.
+0000b6c0: 0a20 2020 2066 3220 3d20 7b7d 0d0a 2020  .    f2 = {}..  
+0000b6d0: 2020 666f 7220 656c 2069 6e20 656c 656d    for el in elem
+0000b6e0: 656e 743a 0d0a 2020 2020 2020 2020 6e61  ent:..        na
+0000b6f0: 6d65 2c20 6f63 632c 2063 6861 7267 6520  me, occ, charge 
+0000b700: 3d20 7370 6c69 745f 656c 656d 656e 745f  = split_element_
+0000b710: 7379 6d62 6f6c 2865 6c29 0d0a 2020 2020  symbol(el)..    
+0000b720: 2020 2020 656e 6572 6779 5b65 6c5d 203d      energy[el] =
+0000b730: 206e 702e 6172 7261 7928 6173 665b 6e61   np.array(asf[na
+0000b740: 6d65 5d5b 2765 6e65 7267 7927 5d29 202f  me]['energy']) /
+0000b750: 2031 3030 302e 2020 2320 6556 202d 3e20   1000.  # eV -> 
+0000b760: 6b65 560d 0a20 2020 2020 2020 2066 315b  keV..        f1[
+0000b770: 656c 5d20 3d20 6e70 2e61 7272 6179 2861  el] = np.array(a
+0000b780: 7366 5b6e 616d 655d 5b27 6631 275d 290d  sf[name]['f1']).
+0000b790: 0a20 2020 2020 2020 2066 325b 656c 5d20  .        f2[el] 
+0000b7a0: 3d20 6e70 2e61 7272 6179 2861 7366 5b6e  = np.array(asf[n
+0000b7b0: 616d 655d 5b27 6632 275d 290d 0a20 2020  ame]['f2'])..   
+0000b7c0: 2020 2020 2066 315b 656c 5d5b 6631 5b65       f1[el][f1[e
+0000b7d0: 6c5d 203c 202d 3130 3030 5d20 3d20 6e70  l] < -1000] = np
+0000b7e0: 2e6e 616e 0d0a 2020 2020 2020 2020 6632  .nan..        f2
+0000b7f0: 5b65 6c5d 5b66 325b 656c 5d20 3c20 2d31  [el][f2[el] < -1
+0000b800: 3030 305d 203d 206e 702e 6e61 6e0d 0a20  000] = np.nan.. 
+0000b810: 2020 2020 2020 2066 315b 656c 5d20 3d20         f1[el] = 
+0000b820: 6631 5b65 6c5d 202a 206f 6363 0d0a 2020  f1[el] * occ..  
+0000b830: 2020 2020 2020 6632 5b65 6c5d 203d 2066        f2[el] = f
+0000b840: 325b 656c 5d20 2a20 6f63 630d 0a0d 0a20  2[el] * occ.... 
+0000b850: 2020 2069 6620 656e 6572 6779 5f6b 6576     if energy_kev
+0000b860: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+0000b870: 2020 2069 6620 6c65 6e28 656c 656d 656e     if len(elemen
+0000b880: 7429 203d 3d20 313a 0d0a 2020 2020 2020  t) == 1:..      
+0000b890: 2020 2020 2020 7265 7475 726e 2065 6e65        return ene
+0000b8a0: 7267 795b 656c 5d2c 2066 315b 656c 5d2c  rgy[el], f1[el],
+0000b8b0: 2066 325b 656c 5d0d 0a20 2020 2020 2020   f2[el]..       
+0000b8c0: 2072 6574 7572 6e20 656e 6572 6779 2c20   return energy, 
+0000b8d0: 6631 2c20 6632 0d0a 0d0a 2020 2020 2320  f1, f2....    # 
+0000b8e0: 496e 7465 7270 6f6c 6174 6520 7661 6c75  Interpolate valu
+0000b8f0: 6573 0d0a 2020 2020 6966 206c 656e 2865  es..    if len(e
+0000b900: 6c65 6d65 6e74 2920 3d3d 2031 3a0d 0a20  lement) == 1:.. 
+0000b910: 2020 2020 2020 2069 6631 203d 206e 702e         if1 = np.
+0000b920: 696e 7465 7270 2865 6e65 7267 795f 6b65  interp(energy_ke
+0000b930: 762c 2065 6e65 7267 795b 656c 5d2c 2066  v, energy[el], f
+0000b940: 315b 656c 5d29 0d0a 2020 2020 2020 2020  1[el])..        
+0000b950: 6966 3220 3d20 6e70 2e69 6e74 6572 7028  if2 = np.interp(
+0000b960: 656e 6572 6779 5f6b 6576 2c20 656e 6572  energy_kev, ener
+0000b970: 6779 5b65 6c5d 2c20 6632 5b65 6c5d 290d  gy[el], f2[el]).
+0000b980: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b990: 6966 312c 2069 6632 0d0a 2020 2020 6966  if1, if2..    if
+0000b9a0: 3120 3d20 6e70 2e7a 6572 6f73 285b 6c65  1 = np.zeros([le
+0000b9b0: 6e28 656c 656d 656e 7429 2c20 6e70 2e73  n(element), np.s
+0000b9c0: 697a 6528 656e 6572 6779 5f6b 6576 295d  ize(energy_kev)]
+0000b9d0: 290d 0a20 2020 2069 6632 203d 206e 702e  )..    if2 = np.
+0000b9e0: 7a65 726f 7328 5b6c 656e 2865 6c65 6d65  zeros([len(eleme
+0000b9f0: 6e74 292c 206e 702e 7369 7a65 2865 6e65  nt), np.size(ene
+0000ba00: 7267 795f 6b65 7629 5d29 0d0a 2020 2020  rgy_kev)])..    
+0000ba10: 666f 7220 6e2c 2065 6c20 696e 2065 6e75  for n, el in enu
+0000ba20: 6d65 7261 7465 2865 6c65 6d65 6e74 293a  merate(element):
+0000ba30: 0d0a 2020 2020 2020 2020 6966 315b 6e2c  ..        if1[n,
+0000ba40: 203a 5d20 3d20 6e70 2e69 6e74 6572 7028   :] = np.interp(
+0000ba50: 656e 6572 6779 5f6b 6576 2c20 656e 6572  energy_kev, ener
+0000ba60: 6779 5b65 6c5d 2c20 6631 5b65 6c5d 290d  gy[el], f1[el]).
+0000ba70: 0a20 2020 2020 2020 2069 6632 5b6e 2c20  .        if2[n, 
+0000ba80: 3a5d 203d 206e 702e 696e 7465 7270 2865  :] = np.interp(e
+0000ba90: 6e65 7267 795f 6b65 762c 2065 6e65 7267  nergy_kev, energ
+0000baa0: 795b 656c 5d2c 2066 325b 656c 5d29 0d0a  y[el], f2[el])..
+0000bab0: 2020 2020 7265 7475 726e 2069 6631 2c20      return if1, 
+0000bac0: 6966 320d 0a0d 0a0d 0a64 6566 2070 686f  if2......def pho
+0000bad0: 746f 6162 736f 7270 7469 6f6e 5f63 726f  toabsorption_cro
+0000bae0: 7373 7365 6374 696f 6e28 656c 656d 656e  sssection(elemen
+0000baf0: 7473 2c20 656e 6572 6779 5f6b 6576 293a  ts, energy_kev):
+0000bb00: 0d0a 2020 2020 2222 220d 0a20 2020 2043  ..    """..    C
+0000bb10: 616c 6375 6c61 7465 2074 6865 2070 686f  alculate the pho
+0000bb20: 746f 6162 736f 7270 7469 6f6e 2063 726f  toabsorption cro
+0000bb30: 7373 2073 6563 7469 6f6e 2066 726f 6d20  ss section from 
+0000bb40: 7468 6520 6174 6f6d 6963 2073 6361 7474  the atomic scatt
+0000bb50: 6572 696e 6720 6661 6374 6f72 730d 0a20  ering factors.. 
+0000bb60: 2020 2020 2020 2075 203d 2032 2a72 302a         u = 2*r0*
+0000bb70: 6c61 6d62 6461 2a66 320d 0a20 2020 2053  lambda*f2..    S
+0000bb80: 6565 3a20 6874 7470 733a 2f2f 6865 6e6b  ee: https://henk
+0000bb90: 652e 6c62 6c2e 676f 762f 6f70 7469 6361  e.lbl.gov/optica
+0000bba0: 6c5f 636f 6e73 7461 6e74 732f 696e 7472  l_constants/intr
+0000bbb0: 6f2e 6874 6d6c 0d0a 2020 2020 3a70 6172  o.html..    :par
+0000bbc0: 616d 2065 6c65 6d65 6e74 733a 2073 7472  am elements: str
+0000bbd0: 206f 7220 6c69 7374 206f 6620 7374 7269   or list of stri
+0000bbe0: 6e67 2065 6c65 6d65 6e74 2073 796d 626f  ng element symbo
+0000bbf0: 6c2c 2069 6620 6c69 7374 2c20 6162 736f  l, if list, abso
+0000bc00: 7270 7469 6f6e 2077 696c 6c20 6265 2073  rption will be s
+0000bc10: 756d 6d65 6420 6f76 6572 2065 6c65 6d65  ummed over eleme
+0000bc20: 6e74 730d 0a20 2020 203a 7061 7261 6d20  nts..    :param 
+0000bc30: 656e 6572 6779 5f6b 6576 3a20 666c 6f61  energy_kev: floa
+0000bc40: 7420 6f72 2061 7272 6179 2078 2d72 6179  t or array x-ray
+0000bc50: 2065 6e65 7267 790d 0a20 2020 203a 7265   energy..    :re
+0000bc60: 7475 726e 3a20 666c 6f61 7420 6f72 2061  turn: float or a
+0000bc70: 7272 6179 205b 6c65 6e28 656e 6572 6779  rray [len(energy
+0000bc80: 295d 206d 5e32 0d0a 2020 2020 2222 220d  )] m^2..    """.
+0000bc90: 0a20 2020 2066 312c 2066 3220 3d20 6174  .    f1, f2 = at
+0000bca0: 6f6d 6963 5f73 6361 7474 6572 696e 675f  omic_scattering_
+0000bcb0: 6661 6374 6f72 2865 6c65 6d65 6e74 732c  factor(elements,
+0000bcc0: 2065 6e65 7267 795f 6b65 7629 0d0a 2020   energy_kev)..  
+0000bcd0: 2020 6632 203d 2066 322e 7265 7368 6170    f2 = f2.reshap
+0000bce0: 6528 6e70 2e73 697a 6528 656c 656d 656e  e(np.size(elemen
+0000bcf0: 7473 292c 206e 702e 7369 7a65 2865 6e65  ts), np.size(ene
+0000bd00: 7267 795f 6b65 7629 292e 7375 6d28 6178  rgy_kev)).sum(ax
+0000bd10: 6973 3d30 2920 2023 2073 756d 206f 7665  is=0)  # sum ove
+0000bd20: 7220 656c 656d 656e 7473 0d0a 2020 2020  r elements..    
+0000bd30: 7761 7665 6c65 6e67 7468 203d 2065 6e65  wavelength = ene
+0000bd40: 7267 7932 7761 7665 2865 6e65 7267 795f  rgy2wave(energy_
+0000bd50: 6b65 7629 202a 2031 652d 3130 0d0a 2020  kev) * 1e-10..  
+0000bd60: 2020 7265 7475 726e 2032 202a 2066 672e    return 2 * fg.
+0000bd70: 7230 202a 2077 6176 656c 656e 6774 6820  r0 * wavelength 
+0000bd80: 2a20 6632 0d0a 0d0a 0d0a 6465 6620 7872  * f2......def xr
+0000bd90: 6179 5f64 6973 7065 7273 696f 6e5f 636f  ay_dispersion_co
+0000bda0: 7272 6563 7469 6f6e 7328 656c 656d 656e  rrections(elemen
+0000bdb0: 7473 2c20 656e 6572 6779 5f6b 6576 3d4e  ts, energy_kev=N
+0000bdc0: 6f6e 6529 3a0d 0a20 2020 2022 2222 0d0a  one):..    """..
+0000bdd0: 2020 2020 5265 6164 2078 7261 7920 6469      Read xray di
+0000bde0: 7370 6572 7369 6f6e 2063 6f72 7265 6374  spersion correct
+0000bdf0: 696f 6e73 2066 726f 6d20 6174 6f6d 6963  ions from atomic
+0000be00: 2073 6361 7474 6572 696e 6720 6661 6374   scattering fact
+0000be10: 6f72 2074 6162 6c65 2c20 6769 7669 6e67  or table, giving
+0000be20: 2066 2720 616e 6420 6622 2066 6f72 2064   f' and f" for d
+0000be30: 6966 6665 7265 6e74 2065 6e65 7267 6965  ifferent energie
+0000be40: 730d 0a20 2020 2046 726f 6d3a 2068 7474  s..    From: htt
+0000be50: 703a 2f2f 6865 6e6b 652e 6c62 6c2e 676f  p://henke.lbl.go
+0000be60: 762f 6f70 7469 6361 6c5f 636f 6e73 7461  v/optical_consta
+0000be70: 6e74 732f 6173 662e 6874 6d6c 0d0a 2020  nts/asf.html..  
+0000be80: 2020 3a70 6172 616d 2065 6c65 6d65 6e74    :param element
+0000be90: 733a 206c 6973 7420 6f66 2073 7472 2c20  s: list of str, 
+0000bea0: 6e61 6d65 206f 6620 656c 656d 656e 740d  name of element.
+0000beb0: 0a20 2020 203a 7061 7261 6d20 656e 6572  .    :param ener
+0000bec0: 6779 5f6b 6576 3a20 666c 6f61 7420 6f72  gy_kev: float or
+0000bed0: 206c 6973 7420 656e 6572 6779 2069 6e20   list energy in 
+0000bee0: 6b65 5620 284e 6f6e 6520 746f 2072 6574  keV (None to ret
+0000bef0: 7572 6e20 6f72 6967 696e 616c 2c20 756e  urn original, un
+0000bf00: 696e 7465 7270 6f6c 6174 6564 206c 6973  interpolated lis
+0000bf10: 7429 0d0a 2020 2020 3a72 6574 7572 6e3a  t)..    :return:
+0000bf20: 2066 272c 2066 2220 7769 7468 2073 6861   f', f" with sha
+0000bf30: 7065 2028 6c65 6e28 656e 6572 6779 292c  pe (len(energy),
+0000bf40: 206c 656e 2865 6c65 6d65 6e74 7329 290d   len(elements)).
+0000bf50: 0a20 2020 2022 2222 0d0a 2020 2020 6173  .    """..    as
+0000bf60: 665f 6669 6c65 203d 206f 732e 7061 7468  f_file = os.path
+0000bf70: 2e6a 6f69 6e28 6461 7461 6469 722c 2027  .join(datadir, '
+0000bf80: 6174 6f6d 6963 5f73 6361 7474 6572 696e  atomic_scatterin
+0000bf90: 675f 6661 6374 6f72 732e 6e70 7927 290d  g_factors.npy').
+0000bfa0: 0a20 2020 2061 7366 203d 206e 702e 6c6f  .    asf = np.lo
+0000bfb0: 6164 2861 7366 5f66 696c 652c 2061 6c6c  ad(asf_file, all
+0000bfc0: 6f77 5f70 6963 6b6c 653d 5472 7565 290d  ow_pickle=True).
+0000bfd0: 0a20 2020 2061 7366 203d 2061 7366 2e69  .    asf = asf.i
+0000bfe0: 7465 6d28 290d 0a0d 0a20 2020 2065 6e65  tem()....    ene
+0000bff0: 7267 795f 6b65 7620 3d20 6e70 2e61 7361  rgy_kev = np.asa
+0000c000: 7272 6179 2865 6e65 7267 795f 6b65 762c  rray(energy_kev,
+0000c010: 2064 7479 7065 3d66 6c6f 6174 292e 7265   dtype=float).re
+0000c020: 7368 6170 6528 2d31 290d 0a20 2020 2065  shape(-1)..    e
+0000c030: 6c65 6d65 6e74 7320 3d20 6e70 2e61 7361  lements = np.asa
+0000c040: 7272 6179 2865 6c65 6d65 6e74 732c 2064  rray(elements, d
+0000c050: 7479 7065 3d73 7472 292e 7265 7368 6170  type=str).reshap
+0000c060: 6528 2d31 290d 0a20 2020 2069 6631 203d  e(-1)..    if1 =
+0000c070: 206e 702e 7a65 726f 7328 5b6c 656e 2865   np.zeros([len(e
+0000c080: 6e65 7267 795f 6b65 7629 2c20 6c65 6e28  nergy_kev), len(
+0000c090: 656c 656d 656e 7473 295d 290d 0a20 2020  elements)])..   
+0000c0a0: 2069 6632 203d 206e 702e 7a65 726f 7328   if2 = np.zeros(
+0000c0b0: 5b6c 656e 2865 6e65 7267 795f 6b65 7629  [len(energy_kev)
+0000c0c0: 2c20 6c65 6e28 656c 656d 656e 7473 295d  , len(elements)]
+0000c0d0: 290d 0a20 2020 2066 6f72 206e 2c20 656c  )..    for n, el
+0000c0e0: 2069 6e20 656e 756d 6572 6174 6528 656c   in enumerate(el
+0000c0f0: 656d 656e 7473 293a 0d0a 2020 2020 2020  ements):..      
+0000c100: 2020 7a20 3d20 6173 665b 656c 5d5b 275a    z = asf[el]['Z
+0000c110: 275d 0d0a 2020 2020 2020 2020 656e 6572  ']..        ener
+0000c120: 6779 203d 206e 702e 6172 7261 7928 6173  gy = np.array(as
+0000c130: 665b 656c 5d5b 2765 6e65 7267 7927 5d29  f[el]['energy'])
+0000c140: 202f 2031 3030 302e 2020 2320 6556 202d   / 1000.  # eV -
+0000c150: 3e20 6b65 560d 0a20 2020 2020 2020 2066  > keV..        f
+0000c160: 3120 3d20 6e70 2e61 7272 6179 2861 7366  1 = np.array(asf
+0000c170: 5b65 6c5d 5b27 6631 275d 290d 0a20 2020  [el]['f1'])..   
+0000c180: 2020 2020 2066 3220 3d20 6e70 2e61 7272       f2 = np.arr
+0000c190: 6179 2861 7366 5b65 6c5d 5b27 6632 275d  ay(asf[el]['f2']
+0000c1a0: 290d 0a20 2020 2020 2020 2066 315b 6631  )..        f1[f1
+0000c1b0: 203c 202d 3130 3030 5d20 3d20 6e70 2e6e   < -1000] = np.n
+0000c1c0: 616e 0d0a 2020 2020 2020 2020 6632 5b66  an..        f2[f
+0000c1d0: 3220 3c20 2d31 3030 305d 203d 206e 702e  2 < -1000] = np.
+0000c1e0: 6e61 6e0d 0a20 2020 2020 2020 2023 2069  nan..        # i
+0000c1f0: 6e74 6572 706f 6c61 7465 2061 6e64 2073  nterpolate and s
+0000c200: 7562 7472 6163 7420 6630 3d3d 5a0d 0a20  ubtract f0==Z.. 
+0000c210: 2020 2020 2020 2069 6631 5b3a 2c20 6e5d         if1[:, n]
+0000c220: 203d 206e 702e 696e 7465 7270 2865 6e65   = np.interp(ene
+0000c230: 7267 795f 6b65 762c 2065 6e65 7267 792c  rgy_kev, energy,
+0000c240: 2066 3129 202d 207a 0d0a 2020 2020 2020   f1) - z..      
+0000c250: 2020 6966 325b 3a2c 206e 5d20 3d20 2d6e    if2[:, n] = -n
+0000c260: 702e 696e 7465 7270 2865 6e65 7267 795f  p.interp(energy_
+0000c270: 6b65 762c 2065 6e65 7267 792c 2066 3229  kev, energy, f2)
+0000c280: 0d0a 2020 2020 7265 7475 726e 2069 6631  ..    return if1
+0000c290: 2c20 6966 320d 0a0d 0a0d 0a64 6566 2070  , if2......def p
+0000c2a0: 6f69 6e74 6772 6f75 7073 2829 3a0d 0a20  ointgroups():.. 
+0000c2b0: 2020 2022 2222 5265 6164 2070 6f69 6e74     """Read point
+0000c2c0: 6772 6f75 7020 6669 6c65 2c20 7265 7475  group file, retu
+0000c2d0: 726e 2064 6963 7422 2222 0d0a 2020 2020  rn dict"""..    
+0000c2e0: 7067 5f66 696c 6520 3d20 6f73 2e70 6174  pg_file = os.pat
+0000c2f0: 682e 6a6f 696e 2864 6174 6164 6972 2c20  h.join(datadir, 
+0000c300: 2750 6f69 6e74 4772 6f75 7073 2e6a 736f  'PointGroups.jso
+0000c310: 6e27 290d 0a20 2020 2077 6974 6820 6f70  n')..    with op
+0000c320: 656e 2870 675f 6669 6c65 2c20 2772 2729  en(pg_file, 'r')
+0000c330: 2061 7320 6670 3a0d 0a20 2020 2020 2020   as fp:..       
+0000c340: 2070 6720 3d20 6a73 6f6e 2e6c 6f61 6428   pg = json.load(
+0000c350: 6670 290d 0a20 2020 2072 6574 7572 6e20  fp)..    return 
+0000c360: 7067 0d0a 0d0a 0d0a 6465 6620 6c6f 6164  pg......def load
+0000c370: 5f70 6f69 6e74 6772 6f75 7028 7067 5f6e  _pointgroup(pg_n
+0000c380: 756d 6265 7229 3a0d 0a20 2020 2022 2222  umber):..    """
+0000c390: 0d0a 2020 2020 4c6f 6164 2070 6f69 6e74  ..    Load point
+0000c3a0: 2067 726f 7570 2075 7369 6e67 206e 756d   group using num
+0000c3b0: 6265 720d 0a20 2020 2050 6f69 6e74 2047  ber..    Point G
+0000c3c0: 726f 7570 733a 0d0a 2020 2020 5472 6963  roups:..    Tric
+0000c3d0: 6c69 6e69 630d 0a20 2020 2020 2031 2043  linic..      1 C
+0000c3e0: 3120 2028 2020 2020 3129 2047 656e 506f  1  (    1) GenPo
+0000c3f0: 733a 2020 2031 0d0a 2020 2020 2020 3220  s:   1..      2 
+0000c400: 4369 2020 2820 2020 2d31 2920 4765 6e50  Ci  (   -1) GenP
+0000c410: 6f73 3a20 2020 320d 0a20 2020 204d 6f6e  os:   2..    Mon
+0000c420: 6f63 6c69 6e69 630d 0a20 2020 2020 2033  oclinic..      3
+0000c430: 2043 3220 2028 2020 2020 3229 2047 656e   C2  (    2) Gen
+0000c440: 506f 733a 2020 2032 0d0a 2020 2020 2020  Pos:   2..      
+0000c450: 3420 4373 2020 2820 2020 206d 2920 4765  4 Cs  (    m) Ge
+0000c460: 6e50 6f73 3a20 2020 320d 0a20 2020 2020  nPos:   2..     
+0000c470: 2035 2043 3268 2028 2020 322f 6d29 2047   5 C2h (  2/m) G
+0000c480: 656e 506f 733a 2020 2034 0d0a 2020 2020  enPos:   4..    
+0000c490: 4f72 7468 6f72 686f 6d62 6963 0d0a 2020  Orthorhombic..  
+0000c4a0: 2020 2020 3620 4432 2020 2820 2032 3232      6 D2  (  222
+0000c4b0: 2920 4765 6e50 6f73 3a20 2020 340d 0a20  ) GenPos:   4.. 
+0000c4c0: 2020 2020 2037 2043 3276 2028 2020 6d6d       7 C2v (  mm
+0000c4d0: 3229 2047 656e 506f 733a 2020 2034 0d0a  2) GenPos:   4..
+0000c4e0: 2020 2020 2020 3820 4432 6820 2820 206d        8 D2h (  m
+0000c4f0: 6d6d 2920 4765 6e50 6f73 3a20 2020 380d  mm) GenPos:   8.
+0000c500: 0a20 2020 2054 6574 7261 676f 6e61 6c0d  .    Tetragonal.
+0000c510: 0a20 2020 2020 2039 2043 3420 2028 2020  .      9 C4  (  
+0000c520: 2020 3429 2047 656e 506f 733a 2020 2034    4) GenPos:   4
+0000c530: 0d0a 2020 2020 2031 3020 5334 2020 2820  ..     10 S4  ( 
+0000c540: 2020 2d34 2920 4765 6e50 6f73 3a20 2020    -4) GenPos:   
+0000c550: 340d 0a20 2020 2020 3131 2043 3468 2028  4..     11 C4h (
+0000c560: 2020 342f 6d29 2047 656e 506f 733a 2020    4/m) GenPos:  
+0000c570: 2038 0d0a 2020 2020 2031 3220 4434 2020   8..     12 D4  
+0000c580: 2820 2034 3232 2920 4765 6e50 6f73 3a20  (  422) GenPos: 
+0000c590: 2020 380d 0a20 2020 2020 3133 2043 3476    8..     13 C4v
+0000c5a0: 2028 2020 346d 6d29 2047 656e 506f 733a   (  4mm) GenPos:
+0000c5b0: 2020 2038 0d0a 2020 2020 2031 3420 4432     8..     14 D2
+0000c5c0: 6420 2820 2d34 326d 2920 4765 6e50 6f73  d ( -42m) GenPos
+0000c5d0: 3a20 2020 380d 0a20 2020 2020 3135 2044  :   8..     15 D
+0000c5e0: 3468 2028 342f 6d6d 6d29 2047 656e 506f  4h (4/mmm) GenPo
+0000c5f0: 733a 2020 3136 0d0a 2020 2020 5472 6967  s:  16..    Trig
+0000c600: 6f6e 616c 0d0a 2020 2020 2031 3620 4333  onal..     16 C3
+0000c610: 2020 2820 2020 2033 2920 4765 6e50 6f73    (    3) GenPos
+0000c620: 3a20 2020 330d 0a20 2020 2020 3137 2043  :   3..     17 C
+0000c630: 3369 2028 2020 202d 3329 2047 656e 506f  3i (   -3) GenPo
+0000c640: 733a 2020 2036 0d0a 2020 2020 2031 3820  s:   6..     18 
+0000c650: 4433 2020 2820 2033 3132 2920 4765 6e50  D3  (  312) GenP
+0000c660: 6f73 3a20 2020 360d 0a20 2020 2020 3139  os:   6..     19
+0000c670: 2043 3376 2028 2020 336d 3129 2047 656e   C3v (  3m1) Gen
+0000c680: 506f 733a 2020 2036 0d0a 2020 2020 2032  Pos:   6..     2
+0000c690: 3020 4433 6420 2820 2d33 316d 2920 4765  0 D3d ( -31m) Ge
+0000c6a0: 6e50 6f73 3a20 2031 320d 0a20 2020 2048  nPos:  12..    H
+0000c6b0: 6578 6167 6f6e 616c 0d0a 2020 2020 2032  exagonal..     2
+0000c6c0: 3120 4336 2020 2820 2020 2036 2920 4765  1 C6  (    6) Ge
+0000c6d0: 6e50 6f73 3a20 2020 360d 0a20 2020 2020  nPos:   6..     
+0000c6e0: 3232 2043 3368 2028 2020 202d 3629 2047  22 C3h (   -6) G
+0000c6f0: 656e 506f 733a 2020 2036 0d0a 2020 2020  enPos:   6..    
+0000c700: 2032 3320 4336 6820 2820 2036 2f6d 2920   23 C6h (  6/m) 
+0000c710: 4765 6e50 6f73 3a20 2031 320d 0a20 2020  GenPos:  12..   
+0000c720: 2020 3234 2044 3620 2028 2020 3632 3229    24 D6  (  622)
+0000c730: 2047 656e 506f 733a 2020 3132 0d0a 2020   GenPos:  12..  
+0000c740: 2020 2032 3520 4336 7620 2820 2036 6d6d     25 C6v (  6mm
+0000c750: 2920 4765 6e50 6f73 3a20 2031 320d 0a20  ) GenPos:  12.. 
+0000c760: 2020 2020 3236 2044 3368 2028 202d 366d      26 D3h ( -6m
+0000c770: 3229 2047 656e 506f 733a 2020 3132 0d0a  2) GenPos:  12..
+0000c780: 2020 2020 2032 3720 4436 6820 2836 2f6d       27 D6h (6/m
+0000c790: 6d6d 2920 4765 6e50 6f73 3a20 2032 340d  mm) GenPos:  24.
+0000c7a0: 0a20 2020 2043 7562 6963 0d0a 2020 2020  .    Cubic..    
+0000c7b0: 2032 3820 5420 2020 2820 2020 3233 2920   28 T   (   23) 
+0000c7c0: 4765 6e50 6f73 3a20 2031 320d 0a20 2020  GenPos:  12..   
+0000c7d0: 2020 3239 2054 6820 2028 2020 6d2d 3329    29 Th  (  m-3)
+0000c7e0: 2047 656e 506f 733a 2020 3234 0d0a 2020   GenPos:  24..  
+0000c7f0: 2020 2033 3020 4f20 2020 2820 2034 3332     30 O   (  432
+0000c800: 2920 4765 6e50 6f73 3a20 2032 340d 0a20  ) GenPos:  24.. 
+0000c810: 2020 2020 3331 2054 6420 2028 202d 3433      31 Td  ( -43
+0000c820: 6d29 2047 656e 506f 733a 2020 3234 0d0a  m) GenPos:  24..
+0000c830: 2020 2020 2033 3220 4f68 2020 2820 6d2d       32 Oh  ( m-
+0000c840: 336d 2920 4765 6e50 6f73 3a20 2034 380d  3m) GenPos:  48.
+0000c850: 0a20 2020 203a 7061 7261 6d20 7067 5f6e  .    :param pg_n
+0000c860: 756d 6265 723a 2069 6e74 206f 7220 7374  umber: int or st
+0000c870: 722c 2065 2e67 2e20 2763 7562 6963 270d  r, e.g. 'cubic'.
+0000c880: 0a20 2020 203a 7265 7475 726e 3a20 6469  .    :return: di
+0000c890: 6374 0d0a 2020 2020 2222 220d 0a20 2020  ct..    """..   
+0000c8a0: 2074 7279 3a0d 0a20 2020 2020 2020 2069   try:..        i
+0000c8b0: 6620 7067 5f6e 756d 6265 722e 6c6f 7765  f pg_number.lowe
+0000c8c0: 7228 2920 696e 205b 2763 7562 6963 275d  r() in ['cubic']
+0000c8d0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+0000c8e0: 675f 6e75 6d62 6572 203d 2033 320d 0a20  g_number = 32.. 
+0000c8f0: 2020 2020 2020 2065 6c69 6620 7067 5f6e         elif pg_n
+0000c900: 756d 6265 722e 6c6f 7765 7228 2920 696e  umber.lower() in
+0000c910: 205b 2768 6578 6167 6f6e 616c 272c 2027   ['hexagonal', '
+0000c920: 6865 7827 5d3a 0d0a 2020 2020 2020 2020  hex']:..        
+0000c930: 2020 2020 7067 5f6e 756d 6265 7220 3d20      pg_number = 
+0000c940: 3237 0d0a 2020 2020 2020 2020 656c 6966  27..        elif
+0000c950: 2070 675f 6e75 6d62 6572 2e6c 6f77 6572   pg_number.lower
+0000c960: 2829 2069 6e20 5b27 7472 6967 6f6e 616c  () in ['trigonal
+0000c970: 275d 3a0d 0a20 2020 2020 2020 2020 2020  ']:..           
+0000c980: 2070 675f 6e75 6d62 6572 203d 2032 300d   pg_number = 20.
+0000c990: 0a20 2020 2020 2020 2065 6c69 6620 7067  .        elif pg
+0000c9a0: 5f6e 756d 6265 722e 6c6f 7765 7228 2920  _number.lower() 
+0000c9b0: 696e 205b 2774 6574 7261 676f 6e61 6c27  in ['tetragonal'
+0000c9c0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+0000c9d0: 7067 5f6e 756d 6265 7220 3d20 3135 0d0a  pg_number = 15..
+0000c9e0: 2020 2020 2020 2020 656c 6966 2070 675f          elif pg_
+0000c9f0: 6e75 6d62 6572 2e6c 6f77 6572 2829 2069  number.lower() i
+0000ca00: 6e20 5b27 6f72 7468 6f72 686f 6d62 6963  n ['orthorhombic
+0000ca10: 275d 3a0d 0a20 2020 2020 2020 2020 2020  ']:..           
+0000ca20: 2070 675f 6e75 6d62 6572 203d 2038 0d0a   pg_number = 8..
+0000ca30: 2020 2020 2020 2020 656c 6966 2070 675f          elif pg_
+0000ca40: 6e75 6d62 6572 2e6c 6f77 6572 2829 2069  number.lower() i
+0000ca50: 6e20 5b27 6d6f 6e6f 636c 696e 6963 272c  n ['monoclinic',
+0000ca60: 2027 6d6f 6e6f 275d 3a0d 0a20 2020 2020   'mono']:..     
+0000ca70: 2020 2020 2020 2070 675f 6e75 6d62 6572         pg_number
+0000ca80: 203d 2035 0d0a 2020 2020 2020 2020 656c   = 5..        el
+0000ca90: 6966 2070 675f 6e75 6d62 6572 2e6c 6f77  if pg_number.low
+0000caa0: 6572 2829 2069 6e20 5b27 7472 6963 6c69  er() in ['tricli
+0000cab0: 6e69 6327 5d3a 0d0a 2020 2020 2020 2020  nic']:..        
+0000cac0: 2020 2020 7067 5f6e 756d 6265 7220 3d20      pg_number = 
+0000cad0: 320d 0a20 2020 2065 7863 6570 7420 4174  2..    except At
+0000cae0: 7472 6962 7574 6545 7272 6f72 3a0d 0a20  tributeError:.. 
+0000caf0: 2020 2020 2020 2070 675f 6e75 6d62 6572         pg_number
+0000cb00: 203d 2069 6e74 2870 675f 6e75 6d62 6572   = int(pg_number
+0000cb10: 290d 0a20 2020 2072 6574 7572 6e20 706f  )..    return po
+0000cb20: 696e 7467 726f 7570 7328 295b 7374 7228  intgroups()[str(
+0000cb30: 7067 5f6e 756d 6265 7229 5d0d 0a0d 0a0d  pg_number)].....
+0000cb40: 0a64 6566 2073 7061 6365 6772 6f75 7073  .def spacegroups
+0000cb50: 2829 3a0d 0a20 2020 2022 2222 0d0a 2020  ():..    """..  
+0000cb60: 2020 5265 7475 726e 2061 2064 6963 7420    Return a dict 
+0000cb70: 6f66 2061 6c6c 2073 7061 6365 2067 726f  of all space gro
+0000cb80: 7570 730d 0a20 2020 204c 6f61 6465 6420  ups..    Loaded 
+0000cb90: 6672 6f6d 206a 736f 6e20 6669 6c65 2063  from json file c
+0000cba0: 7265 6174 6564 2066 726f 6d20 7468 6520  reated from the 
+0000cbb0: 4269 6c62 616f 2063 7279 7374 616c 6c6f  Bilbao crystallo
+0000cbc0: 6772 6170 6869 6320 7365 7276 6572 3a20  graphic server: 
+0000cbd0: 6874 7470 733a 2f2f 7777 772e 6372 7973  https://www.crys
+0000cbe0: 742e 6568 752e 6573 2f0d 0a20 2020 203a  t.ehu.es/..    :
+0000cbf0: 7265 7475 726e 3a20 6469 6374 2077 6974  return: dict wit
+0000cc00: 6820 6b65 7973 3a0d 0a20 2020 2020 2020  h keys:..       
+0000cc10: 2027 7370 6163 6520 6772 6f75 7020 6e75   'space group nu
+0000cc20: 6d62 6572 270d 0a20 2020 2020 2020 2027  mber'..        '
+0000cc30: 7370 6163 6520 6772 6f75 7020 6e61 6d65  space group name
+0000cc40: 2068 746d 6c27 0d0a 2020 2020 2020 2020   html'..        
+0000cc50: 2773 7061 6365 2067 726f 7570 206e 616d  'space group nam
+0000cc60: 6527 0d0a 2020 2020 2020 2020 2777 6562  e'..        'web
+0000cc70: 2061 6464 7265 7373 2067 656e 6572 6174   address generat
+0000cc80: 6f72 270d 0a20 2020 2020 2020 2027 7765  or'..        'we
+0000cc90: 6220 6164 6472 6573 7320 7779 636b 6f66  b address wyckof
+0000cca0: 6627 0d0a 2020 2020 2020 2020 2777 6562  f'..        'web
+0000ccb0: 2061 6464 7265 7373 2073 6974 6520 6368   address site ch
+0000ccc0: 6563 6b27 2020 2020 2023 2061 6464 7265  eck'     # addre
+0000ccd0: 7373 2025 2028 752c 2076 2c20 7729 2c0d  ss % (u, v, w),.
+0000cce0: 0a20 2020 2020 2020 2027 6765 6e65 7261  .        'genera
+0000ccf0: 6c20 706f 7369 7469 6f6e 7327 0d0a 2020  l positions'..  
+0000cd00: 2020 2020 2020 276d 6167 6e65 7469 6320        'magnetic 
+0000cd10: 7370 6163 6520 6772 6f75 7073 272c 0d0a  space groups',..
+0000cd20: 2020 2020 2020 2020 2770 6f73 6974 696f          'positio
+0000cd30: 6e73 2063 656e 7472 696e 6727 0d0a 2020  ns centring'..  
+0000cd40: 2020 2020 2020 2770 6f73 6974 696f 6e73        'positions
+0000cd50: 206d 756c 7469 706c 6963 6974 7927 0d0a   multiplicity'..
+0000cd60: 2020 2020 2020 2020 2770 6f73 6974 696f          'positio
+0000cd70: 6e73 2077 7963 6b6f 6666 206c 6574 7465  ns wyckoff lette
+0000cd80: 7227 0d0a 2020 2020 2020 2020 2770 6f73  r'..        'pos
+0000cd90: 6974 696f 6e73 2073 796d 6d65 7472 7927  itions symmetry'
+0000cda0: 0d0a 2020 2020 2020 2020 2770 6f73 6974  ..        'posit
+0000cdb0: 696f 6e73 2063 6f6f 7264 696e 6174 6573  ions coordinates
+0000cdc0: 270d 0a20 2020 2020 2020 2027 7375 6267  '..        'subg
+0000cdd0: 726f 7570 206e 756d 6265 7227 2c0d 0a20  roup number',.. 
+0000cde0: 2020 2020 2020 2027 7375 6267 726f 7570         'subgroup
+0000cdf0: 206e 616d 6527 2c0d 0a20 2020 2020 2020   name',..       
+0000ce00: 2027 7375 6267 726f 7570 2069 6e64 6578   'subgroup index
+0000ce10: 272c 0d0a 2020 2020 2020 2020 2773 7562  ',..        'sub
+0000ce20: 6772 6f75 7020 7479 7065 270d 0a20 2020  group type'..   
+0000ce30: 2022 2222 0d0a 2020 2020 7367 5f66 696c   """..    sg_fil
+0000ce40: 6520 3d20 6f73 2e70 6174 682e 6a6f 696e  e = os.path.join
+0000ce50: 2864 6174 6164 6972 2c20 2753 7061 6365  (datadir, 'Space
+0000ce60: 4772 6f75 7073 2e6a 736f 6e27 290d 0a20  Groups.json').. 
+0000ce70: 2020 2077 6974 6820 6f70 656e 2873 675f     with open(sg_
+0000ce80: 6669 6c65 2c20 2772 2729 2061 7320 6670  file, 'r') as fp
+0000ce90: 3a0d 0a20 2020 2020 2020 2073 675f 6469  :..        sg_di
+0000cea0: 6374 203d 206a 736f 6e2e 6c6f 6164 2866  ct = json.load(f
+0000ceb0: 7029 0d0a 2020 2020 7265 7475 726e 2073  p)..    return s
+0000cec0: 675f 6469 6374 0d0a 0d0a 0d0a 6465 6620  g_dict......def 
+0000ced0: 7370 6163 6567 726f 7570 2873 675f 6e75  spacegroup(sg_nu
+0000cee0: 6d62 6572 293a 0d0a 2020 2020 2222 220d  mber):..    """.
+0000cef0: 0a20 2020 2052 6574 7572 6e20 6120 6469  .    Return a di
+0000cf00: 6374 206f 6620 696e 666f 726d 6174 696f  ct of informatio
+0000cf10: 6e20 666f 7220 6120 7370 6163 6520 6772  n for a space gr
+0000cf20: 6f75 700d 0a20 2020 203a 7061 7261 6d20  oup..    :param 
+0000cf30: 7367 5f6e 756d 6265 723a 2069 6e74 2073  sg_number: int s
+0000cf40: 7061 6365 2067 726f 7570 206e 756d 6265  pace group numbe
+0000cf50: 722c 2061 7320 696e 2074 6865 2069 6e74  r, as in the int
+0000cf60: 6572 6e61 7469 6f6e 616c 2074 6162 6c65  ernational table
+0000cf70: 7320 6f66 2043 7279 7374 616c 6c6f 6772  s of Crystallogr
+0000cf80: 6170 6879 0d0a 2020 2020 3a72 6574 7572  aphy..    :retur
+0000cf90: 6e3a 2064 6963 740d 0a20 2020 2022 2222  n: dict..    """
+0000cfa0: 0d0a 2020 2020 7367 5f6e 756d 6265 7220  ..    sg_number 
+0000cfb0: 3d20 7374 7228 696e 7428 7367 5f6e 756d  = str(int(sg_num
+0000cfc0: 6265 7229 290d 0a20 2020 2073 675f 6469  ber))..    sg_di
+0000cfd0: 6374 203d 2073 7061 6365 6772 6f75 7073  ct = spacegroups
+0000cfe0: 2829 0d0a 2020 2020 7265 7475 726e 2073  ()..    return s
+0000cff0: 675f 6469 6374 5b73 675f 6e75 6d62 6572  g_dict[sg_number
+0000d000: 5d0d 0a0d 0a0d 0a64 6566 2073 7061 6365  ]......def space
+0000d010: 6772 6f75 705f 6c69 7374 2873 675f 6e75  group_list(sg_nu
+0000d020: 6d62 6572 733d 4e6f 6e65 293a 0d0a 2020  mbers=None):..  
+0000d030: 2020 2222 220d 0a20 2020 2052 6574 7572    """..    Retur
+0000d040: 6e20 6120 7374 7275 6374 7572 6564 206c  n a structured l
+0000d050: 6973 7420 6f66 2073 7061 6365 2067 726f  ist of space gro
+0000d060: 7570 7320 7769 7468 2067 656e 6572 616c  ups with general
+0000d070: 206f 7065 7261 7469 6f6e 730d 0a20 2020   operations..   
+0000d080: 203a 7061 7261 6d20 7367 5f6e 756d 6265   :param sg_numbe
+0000d090: 7273 3a20 6c69 7374 206f 6620 7370 6163  rs: list of spac
+0000d0a0: 6520 6772 6f75 7020 6e75 6d62 6572 7320  e group numbers 
+0000d0b0: 284e 6f6e 6520 666f 7220 7768 6f6c 6520  (None for whole 
+0000d0c0: 6c69 7374 290d 0a20 2020 203a 7265 7475  list)..    :retu
+0000d0d0: 726e 3a20 7374 720d 0a20 2020 2022 2222  rn: str..    """
+0000d0e0: 0d0a 2020 2020 6966 2073 675f 6e75 6d62  ..    if sg_numb
+0000d0f0: 6572 7320 6973 204e 6f6e 653a 0d0a 2020  ers is None:..  
+0000d100: 2020 2020 2020 7367 5f6e 756d 6265 7273        sg_numbers
+0000d110: 203d 2072 616e 6765 2831 2c20 3233 3129   = range(1, 231)
+0000d120: 0d0a 2020 2020 7367 5f6e 756d 6265 7273  ..    sg_numbers
+0000d130: 203d 206e 702e 6173 6172 7261 7928 7367   = np.asarray(sg
+0000d140: 5f6e 756d 6265 7273 2c20 6474 7970 653d  _numbers, dtype=
+0000d150: 7374 7229 2e72 6573 6861 7065 282d 3129  str).reshape(-1)
+0000d160: 0d0a 0d0a 2020 2020 7367 5f64 6963 7420  ....    sg_dict 
+0000d170: 3d20 7370 6163 6567 726f 7570 7328 290d  = spacegroups().
+0000d180: 0a0d 0a20 2020 206f 7574 203d 2027 270d  ...    out = ''.
+0000d190: 0a20 2020 2066 6d74 203d 2027 2533 6420  .    fmt = '%3d 
+0000d1a0: 252d 3130 7320 3a20 2533 6420 3a20 2573  %-10s : %3d : %s
+0000d1b0: 5c6e 270d 0a20 2020 2066 6f72 2073 676e  \n'..    for sgn
+0000d1c0: 2069 6e20 7367 5f6e 756d 6265 7273 3a0d   in sg_numbers:.
+0000d1d0: 0a20 2020 2020 2020 2073 6720 3d20 7367  .        sg = sg
+0000d1e0: 5f64 6963 745b 7367 6e5d 0d0a 2020 2020  _dict[sgn]..    
+0000d1f0: 2020 2020 6e75 6d20 3d20 7367 5b27 7370      num = sg['sp
+0000d200: 6163 6520 6772 6f75 7020 6e75 6d62 6572  ace group number
+0000d210: 275d 0d0a 2020 2020 2020 2020 6e61 6d65  ']..        name
+0000d220: 203d 2073 675b 2773 7061 6365 2067 726f   = sg['space gro
+0000d230: 7570 206e 616d 6527 5d0d 0a20 2020 2020  up name']..     
+0000d240: 2020 2073 796d 203d 2027 2c20 272e 6a6f     sym = ', '.jo
+0000d250: 696e 2873 675b 2767 656e 6572 616c 2070  in(sg['general p
+0000d260: 6f73 6974 696f 6e73 275d 290d 0a20 2020  ositions'])..   
+0000d270: 2020 2020 206e 7379 6d20 3d20 6c65 6e28       nsym = len(
+0000d280: 7367 5b27 6765 6e65 7261 6c20 706f 7369  sg['general posi
+0000d290: 7469 6f6e 7327 5d29 0d0a 2020 2020 2020  tions'])..      
+0000d2a0: 2020 6f75 7420 2b3d 2066 6d74 2025 2028    out += fmt % (
+0000d2b0: 6e75 6d2c 206e 616d 652c 206e 7379 6d2c  num, name, nsym,
+0000d2c0: 2073 796d 290d 0a20 2020 2072 6574 7572   sym)..    retur
+0000d2d0: 6e20 6f75 740d 0a0d 0a0d 0a64 6566 2073  n out......def s
+0000d2e0: 7061 6365 6772 6f75 705f 7375 6267 726f  pacegroup_subgro
+0000d2f0: 7570 7328 7367 5f6e 756d 6265 7229 3a0d  ups(sg_number):.
+0000d300: 0a20 2020 2022 2222 0d0a 2020 2020 5265  .    """..    Re
+0000d310: 7475 726e 2064 6963 7420 6f66 206d 6178  turn dict of max
+0000d320: 696d 616c 2073 7562 6772 6f75 7073 2066  imal subgroups f
+0000d330: 6f72 2073 7061 6365 6772 6f75 700d 0a20  or spacegroup.. 
+0000d340: 2020 203a 7061 7261 6d20 7367 5f6e 756d     :param sg_num
+0000d350: 6265 723a 2073 7061 6365 2067 726f 7570  ber: space group
+0000d360: 206e 756d 6265 7220 2831 2d32 3330 290d   number (1-230).
+0000d370: 0a20 2020 203a 7265 7475 726e 3a20 6469  .    :return: di
+0000d380: 6374 0d0a 2020 2020 2222 220d 0a20 2020  ct..    """..   
+0000d390: 2061 6c6c 5f73 6720 3d20 7370 6163 6567   all_sg = spaceg
+0000d3a0: 726f 7570 7328 290d 0a20 2020 2073 675f  roups()..    sg_
+0000d3b0: 6e75 6d62 6572 203d 2073 7472 2869 6e74  number = str(int
+0000d3c0: 2873 675f 6e75 6d62 6572 2929 0d0a 2020  (sg_number))..  
+0000d3d0: 2020 7367 5f64 6963 7420 3d20 616c 6c5f    sg_dict = all_
+0000d3e0: 7367 5b73 675f 6e75 6d62 6572 5d0d 0a20  sg[sg_number].. 
+0000d3f0: 2020 2073 7562 6772 6f75 7073 203d 2073     subgroups = s
+0000d400: 675f 6469 6374 5b22 7375 6267 726f 7570  g_dict["subgroup
+0000d410: 206e 756d 6265 7222 5d0d 0a20 2020 2072   number"]..    r
+0000d420: 6574 7572 6e20 5b61 6c6c 5f73 675b 6e75  eturn [all_sg[nu
+0000d430: 6d5d 2066 6f72 206e 756d 2069 6e20 7375  m] for num in su
+0000d440: 6267 726f 7570 735d 0d0a 0d0a 0d0a 6465  bgroups]......de
+0000d450: 6620 7370 6163 6567 726f 7570 5f73 7562  f spacegroup_sub
+0000d460: 6772 6f75 7073 5f6c 6973 7428 7367 5f6e  groups_list(sg_n
+0000d470: 756d 6265 723d 4e6f 6e65 2c20 7367 5f64  umber=None, sg_d
+0000d480: 6963 743d 4e6f 6e65 293a 0d0a 2020 2020  ict=None):..    
+0000d490: 2222 220d 0a20 2020 2052 6574 7572 6e20  """..    Return 
+0000d4a0: 7374 7220 6f66 206d 6178 696d 616c 2073  str of maximal s
+0000d4b0: 7562 6772 6f75 7073 2066 6f72 2073 7061  ubgroups for spa
+0000d4c0: 6365 6772 6f75 700d 0a20 2020 203a 7061  cegroup..    :pa
+0000d4d0: 7261 6d20 7367 5f6e 756d 6265 723a 2073  ram sg_number: s
+0000d4e0: 7061 6365 2067 726f 7570 206e 756d 6265  pace group numbe
+0000d4f0: 7220 2831 2d32 3330 290d 0a20 2020 203a  r (1-230)..    :
+0000d500: 7061 7261 6d20 7367 5f64 6963 743a 2061  param sg_dict: a
+0000d510: 6c74 6572 6e61 7465 2069 6e70 7574 2c20  lternate input, 
+0000d520: 7370 6163 6567 726f 7570 2064 6963 7420  spacegroup dict 
+0000d530: 6672 6f6d 2073 7061 6365 6772 6f75 7020  from spacegroup 
+0000d540: 6675 6e63 7469 6f6e 0d0a 2020 2020 3a72  function..    :r
+0000d550: 6574 7572 6e3a 2073 7472 0d0a 2020 2020  eturn: str..    
+0000d560: 2222 220d 0a20 2020 2069 6620 7367 5f6e  """..    if sg_n
+0000d570: 756d 6265 7220 6973 206e 6f74 204e 6f6e  umber is not Non
+0000d580: 653a 0d0a 2020 2020 2020 2020 7367 5f64  e:..        sg_d
+0000d590: 6963 7420 3d20 7370 6163 6567 726f 7570  ict = spacegroup
+0000d5a0: 2873 675f 6e75 6d62 6572 290d 0a20 2020  (sg_number)..   
+0000d5b0: 2073 7562 5f6e 756d 203d 2073 675f 6469   sub_num = sg_di
+0000d5c0: 6374 5b22 7375 6267 726f 7570 206e 756d  ct["subgroup num
+0000d5d0: 6265 7222 5d0d 0a20 2020 2073 7562 5f6e  ber"]..    sub_n
+0000d5e0: 616d 6520 3d20 7367 5f64 6963 745b 2273  ame = sg_dict["s
+0000d5f0: 7562 6772 6f75 7020 6e61 6d65 225d 0d0a  ubgroup name"]..
+0000d600: 2020 2020 7375 625f 696e 6465 7820 3d20      sub_index = 
+0000d610: 7367 5f64 6963 745b 2273 7562 6772 6f75  sg_dict["subgrou
+0000d620: 7020 696e 6465 7822 5d0d 0a20 2020 2073  p index"]..    s
+0000d630: 7562 5f74 7970 6520 3d20 7367 5f64 6963  ub_type = sg_dic
+0000d640: 745b 2273 7562 6772 6f75 7020 7479 7065  t["subgroup type
+0000d650: 225d 0d0a 2020 2020 6f75 7420 3d20 2727  "]..    out = ''
+0000d660: 0d0a 2020 2020 666d 7420 3d20 2750 6172  ..    fmt = 'Par
+0000d670: 656e 743a 2025 3373 2053 7562 6772 6f75  ent: %3s Subgrou
+0000d680: 703a 2025 3373 2020 252d 3130 7320 2049  p: %3s  %-10s  I
+0000d690: 6e64 6578 3a20 2533 7320 2054 7970 653a  ndex: %3s  Type:
+0000d6a0: 2025 3273 5c6e 270d 0a20 2020 2066 6f72   %2s\n'..    for
+0000d6b0: 206e 756d 2c20 6e61 6d65 2c20 696e 6465   num, name, inde
+0000d6c0: 782c 2073 7479 7065 2069 6e20 7a69 7028  x, stype in zip(
+0000d6d0: 7375 625f 6e75 6d2c 2073 7562 5f6e 616d  sub_num, sub_nam
+0000d6e0: 652c 2073 7562 5f69 6e64 6578 2c20 7375  e, sub_index, su
+0000d6f0: 625f 7479 7065 293a 0d0a 2020 2020 2020  b_type):..      
+0000d700: 2020 6f75 7420 2b3d 2066 6d74 2025 2028    out += fmt % (
+0000d710: 7367 5f6e 756d 6265 722c 206e 756d 2c20  sg_number, num, 
+0000d720: 6e61 6d65 2c20 696e 6465 782c 2073 7479  name, index, sty
+0000d730: 7065 290d 0a20 2020 2072 6574 7572 6e20  pe)..    return 
+0000d740: 6f75 740d 0a0d 0a0d 0a64 6566 2073 7061  out......def spa
+0000d750: 6365 6772 6f75 7073 5f6d 6167 6e65 7469  cegroups_magneti
+0000d760: 6328 7367 5f6e 756d 6265 723d 4e6f 6e65  c(sg_number=None
+0000d770: 2c20 7367 5f64 6963 743d 4e6f 6e65 293a  , sg_dict=None):
+0000d780: 0d0a 2020 2020 2222 220d 0a20 2020 2052  ..    """..    R
+0000d790: 6574 7572 6e73 2064 6963 7420 6f66 206d  eturns dict of m
+0000d7a0: 6167 6e65 7469 6320 7370 6163 6520 6772  agnetic space gr
+0000d7b0: 6f75 7073 2066 6f72 2072 6571 7569 7265  oups for require
+0000d7c0: 6420 7370 6163 6520 6772 6f75 700d 0a20  d space group.. 
+0000d7d0: 2020 203a 7061 7261 6d20 7367 5f6e 756d     :param sg_num
+0000d7e0: 6265 723a 2073 7061 6365 2067 726f 7570  ber: space group
+0000d7f0: 206e 756d 6265 7220 2831 2d32 3330 2920   number (1-230) 
+0000d800: 6f72 204e 6f6e 6520 746f 2072 6574 7572  or None to retur
+0000d810: 6e20 616c 6c20 6d61 676e 6574 6963 2073  n all magnetic s
+0000d820: 7061 6365 6772 6f75 7073 0d0a 2020 2020  pacegroups..    
+0000d830: 3a70 6172 616d 2073 675f 6469 6374 3a20  :param sg_dict: 
+0000d840: 616c 7465 726e 6174 6520 696e 7075 742c  alternate input,
+0000d850: 2073 7061 6365 6772 6f75 7020 6469 6374   spacegroup dict
+0000d860: 2066 726f 6d20 7370 6163 6567 726f 7570   from spacegroup
+0000d870: 2066 756e 6374 696f 6e0d 0a20 2020 203a   function..    :
+0000d880: 7265 7475 726e 3a20 6469 6374 0d0a 2020  return: dict..  
+0000d890: 2020 2222 220d 0a0d 0a20 2020 206d 7367    """....    msg
+0000d8a0: 5f66 696c 6520 3d20 6f73 2e70 6174 682e  _file = os.path.
+0000d8b0: 6a6f 696e 2864 6174 6164 6972 2c20 2753  join(datadir, 'S
+0000d8c0: 7061 6365 4772 6f75 7073 4d61 676e 6574  paceGroupsMagnet
+0000d8d0: 6963 2e6a 736f 6e27 290d 0a20 2020 2077  ic.json')..    w
+0000d8e0: 6974 6820 6f70 656e 286d 7367 5f66 696c  ith open(msg_fil
+0000d8f0: 652c 2027 7227 2920 6173 2066 703a 0d0a  e, 'r') as fp:..
+0000d900: 2020 2020 2020 2020 6d73 675f 6469 6374          msg_dict
+0000d910: 203d 206a 736f 6e2e 6c6f 6164 2866 7029   = json.load(fp)
+0000d920: 0d0a 0d0a 2020 2020 6966 2073 675f 6e75  ....    if sg_nu
+0000d930: 6d62 6572 2069 7320 4e6f 6e65 2061 6e64  mber is None and
+0000d940: 2073 675f 6469 6374 2069 7320 4e6f 6e65   sg_dict is None
+0000d950: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+0000d960: 6e20 6d73 675f 6469 6374 0d0a 2020 2020  n msg_dict..    
+0000d970: 6966 2073 675f 6e75 6d62 6572 2069 7320  if sg_number is 
+0000d980: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0000d990: 2020 2073 675f 6469 6374 203d 2073 7061     sg_dict = spa
+0000d9a0: 6365 6772 6f75 7028 7367 5f6e 756d 6265  cegroup(sg_numbe
+0000d9b0: 7229 0d0a 2020 2020 6d73 675f 6e75 6d62  r)..    msg_numb
+0000d9c0: 6572 7320 3d20 7367 5f64 6963 745b 276d  ers = sg_dict['m
+0000d9d0: 6167 6e65 7469 6320 7370 6163 6520 6772  agnetic space gr
+0000d9e0: 6f75 7073 275d 0d0a 2020 2020 7265 7475  oups']..    retu
+0000d9f0: 726e 205b 6d73 675f 6469 6374 5b6e 756d  rn [msg_dict[num
+0000da00: 5d20 666f 7220 6e75 6d20 696e 206d 7367  ] for num in msg
+0000da10: 5f6e 756d 6265 7273 5d0d 0a0d 0a0d 0a64  _numbers]......d
+0000da20: 6566 2073 7061 6365 6772 6f75 705f 6d61  ef spacegroup_ma
+0000da30: 676e 6574 6963 286d 7367 5f6e 756d 6265  gnetic(msg_numbe
+0000da40: 7229 3a0d 0a20 2020 2022 2222 0d0a 2020  r):..    """..  
+0000da50: 2020 5265 7475 726e 2064 6963 7420 6f66    Return dict of
+0000da60: 206d 6167 6e65 7469 6320 7370 6163 6567   magnetic spaceg
+0000da70: 726f 7570 2c20 6769 7665 6e20 6d61 676e  roup, given magn
+0000da80: 6574 6963 2073 7061 6365 6772 6f75 7020  etic spacegroup 
+0000da90: 6e75 6d62 6572 0d0a 2020 2020 3a70 6172  number..    :par
+0000daa0: 616d 206d 7367 5f6e 756d 6265 723a 206d  am msg_number: m
+0000dab0: 6167 6e65 7469 6320 7370 6163 6520 6772  agnetic space gr
+0000dac0: 6f75 7020 6e75 6d62 6572 2065 2e67 2e20  oup number e.g. 
+0000dad0: 3631 2e34 3333 0d0a 2020 2020 3a72 6574  61.433..    :ret
+0000dae0: 7572 6e3a 2064 6963 7420 7769 7468 206b  urn: dict with k
+0000daf0: 6579 733a 0d0a 2020 2020 2020 2020 2770  eys:..        'p
+0000db00: 6172 656e 7420 6e75 6d62 6572 273a 2073  arent number': s
+0000db10: 672c 0d0a 2020 2020 2020 2020 2773 7061  g,..        'spa
+0000db20: 6365 2067 726f 7570 206e 756d 6265 7227  ce group number'
+0000db30: 3a20 6e75 6d62 6572 2c0d 0a20 2020 2020  : number,..     
+0000db40: 2020 2027 7370 6163 6520 6772 6f75 7020     'space group 
+0000db50: 6e61 6d65 273a 206c 6162 656c 2c0d 0a20  name': label,.. 
+0000db60: 2020 2020 2020 2027 7365 7474 696e 6727         'setting'
+0000db70: 3a20 7365 7474 696e 672c 0d0a 2020 2020  : setting,..    
+0000db80: 2020 2020 2774 7970 6520 6e61 6d65 273a      'type name':
+0000db90: 2074 7970 655f 6e61 6d65 2c0d 0a20 2020   type_name,..   
+0000dba0: 2020 2020 2027 7265 6c61 7465 6420 6772       'related gr
+0000dbb0: 6f75 7027 3a20 7265 6c5f 6e75 6d62 6572  oup': rel_number
+0000dbc0: 2c0d 0a20 2020 2020 2020 2027 7265 6c61  ,..        'rela
+0000dbd0: 7465 6420 6e61 6d65 273a 2072 656c 5f6e  ted name': rel_n
+0000dbe0: 616d 652c 0d0a 2020 2020 2020 2020 2772  ame,..        'r
+0000dbf0: 656c 6174 6564 2073 6574 7469 6e67 273a  elated setting':
+0000dc00: 2072 656c 5f73 6574 7469 6e67 2c0d 0a20   rel_setting,.. 
+0000dc10: 2020 2020 2020 2027 6f70 6572 6174 6f72         'operator
+0000dc20: 7320 6765 6e65 7261 6c27 3a20 7879 7a5f  s general': xyz_
+0000dc30: 6f70 2c0d 0a20 2020 2020 2020 2027 6f70  op,..        'op
+0000dc40: 6572 6174 6f72 7320 6d61 676e 6574 6963  erators magnetic
+0000dc50: 273a 206d 786d 796d 7a5f 6f70 2c0d 0a20  ': mxmymz_op,.. 
+0000dc60: 2020 2020 2020 2027 6f70 6572 6174 6f72         'operator
+0000dc70: 7320 7469 6d65 273a 2074 696d 652c 0d0a  s time': time,..
+0000dc80: 2020 2020 2222 220d 0a20 2020 206d 7367      """..    msg
+0000dc90: 5f6e 756d 6265 7220 3d20 6e70 2e61 7361  _number = np.asa
+0000dca0: 7272 6179 286d 7367 5f6e 756d 6265 722c  rray(msg_number,
+0000dcb0: 2064 7479 7065 3d73 7472 292e 7265 7368   dtype=str).resh
+0000dcc0: 6170 6528 2d31 290d 0a0d 0a20 2020 206d  ape(-1)....    m
+0000dcd0: 7367 5f66 696c 6520 3d20 6f73 2e70 6174  sg_file = os.pat
+0000dce0: 682e 6a6f 696e 2864 6174 6164 6972 2c20  h.join(datadir, 
+0000dcf0: 2753 7061 6365 4772 6f75 7073 4d61 676e  'SpaceGroupsMagn
+0000dd00: 6574 6963 2e6a 736f 6e27 290d 0a20 2020  etic.json')..   
+0000dd10: 2077 6974 6820 6f70 656e 286d 7367 5f66   with open(msg_f
+0000dd20: 696c 652c 2027 7227 2920 6173 2066 703a  ile, 'r') as fp:
+0000dd30: 0d0a 2020 2020 2020 2020 6d73 675f 6469  ..        msg_di
+0000dd40: 6374 203d 206a 736f 6e2e 6c6f 6164 2866  ct = json.load(f
+0000dd50: 7029 0d0a 0d0a 2020 2020 6966 204e 6f6e  p)....    if Non
+0000dd60: 6520 696e 206d 7367 5f6e 756d 6265 723a  e in msg_number:
+0000dd70: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000dd80: 206d 7367 5f64 6963 740d 0a20 2020 2065   msg_dict..    e
+0000dd90: 6c69 6620 6c65 6e28 6d73 675f 6e75 6d62  lif len(msg_numb
+0000dda0: 6572 2920 3d3d 2031 3a0d 0a20 2020 2020  er) == 1:..     
+0000ddb0: 2020 2072 6574 7572 6e20 6d73 675f 6469     return msg_di
+0000ddc0: 6374 5b6d 7367 5f6e 756d 6265 725b 305d  ct[msg_number[0]
+0000ddd0: 5d0d 0a20 2020 2065 6c73 653a 0d0a 2020  ]..    else:..  
+0000dde0: 2020 2020 2020 7265 7475 726e 205b 6d73        return [ms
+0000ddf0: 675f 6469 6374 5b6e 756d 5d20 666f 7220  g_dict[num] for 
+0000de00: 6e75 6d20 696e 206d 7367 5f6e 756d 6265  num in msg_numbe
+0000de10: 725d 0d0a 0d0a 0d0a 6465 6620 7370 6163  r]......def spac
+0000de20: 6567 726f 7570 5f6d 6167 6e65 7469 635f  egroup_magnetic_
+0000de30: 6c69 7374 2873 675f 6e75 6d62 6572 3d4e  list(sg_number=N
+0000de40: 6f6e 652c 2073 675f 6469 6374 3d4e 6f6e  one, sg_dict=Non
+0000de50: 6529 3a0d 0a20 2020 2022 2222 0d0a 2020  e):..    """..  
+0000de60: 2020 5265 7475 726e 2073 7472 206c 6973    Return str lis
+0000de70: 7420 6f66 206d 6167 6e65 7469 6320 7370  t of magnetic sp
+0000de80: 6163 6520 6772 6f75 7073 0d0a 2020 2020  ace groups..    
+0000de90: 3a70 6172 616d 2073 675f 6e75 6d62 6572  :param sg_number
+0000dea0: 3a20 7370 6163 6520 6772 6f75 7020 6e75  : space group nu
+0000deb0: 6d62 6572 2028 312d 3233 3029 0d0a 2020  mber (1-230)..  
+0000dec0: 2020 3a70 6172 616d 2073 675f 6469 6374    :param sg_dict
+0000ded0: 3a20 616c 7465 726e 6174 6520 696e 7075  : alternate inpu
+0000dee0: 742c 2073 7061 6365 6772 6f75 7020 6469  t, spacegroup di
+0000def0: 6374 2066 726f 6d20 7370 6163 6567 726f  ct from spacegro
+0000df00: 7570 2066 756e 6374 696f 6e0d 0a20 2020  up function..   
+0000df10: 203a 7265 7475 726e 3a20 7374 720d 0a20   :return: str.. 
+0000df20: 2020 2022 2222 0d0a 2020 2020 6d61 675f     """..    mag_
+0000df30: 7370 6163 6567 726f 7570 7320 3d20 7370  spacegroups = sp
+0000df40: 6163 6567 726f 7570 735f 6d61 676e 6574  acegroups_magnet
+0000df50: 6963 2873 675f 6e75 6d62 6572 2c20 7367  ic(sg_number, sg
+0000df60: 5f64 6963 7429 0d0a 0d0a 2020 2020 6f75  _dict)....    ou
+0000df70: 7420 3d20 2727 0d0a 2020 2020 666d 7420  t = ''..    fmt 
+0000df80: 3d20 2750 6172 656e 743a 2025 3373 204d  = 'Parent: %3s M
+0000df90: 6167 6e65 7469 633a 2025 2d31 3073 2020  agnetic: %-10s  
+0000dfa0: 252d 3130 7320 2053 6574 7469 6e67 3a20  %-10s  Setting: 
+0000dfb0: 2533 7320 2533 3073 2020 4f70 6572 6174  %3s %30s  Operat
+0000dfc0: 6f72 733a 2025 735c 6e27 0d0a 2020 2020  ors: %s\n'..    
+0000dfd0: 666f 7220 7367 2069 6e20 6d61 675f 7370  for sg in mag_sp
+0000dfe0: 6163 6567 726f 7570 733a 0d0a 2020 2020  acegroups:..    
+0000dff0: 2020 2020 7061 7265 6e74 203d 2073 675b      parent = sg[
+0000e000: 2770 6172 656e 7420 6e75 6d62 6572 275d  'parent number']
+0000e010: 0d0a 2020 2020 2020 2020 6e75 6d62 6572  ..        number
+0000e020: 203d 2073 675b 2773 7061 6365 2067 726f   = sg['space gro
+0000e030: 7570 206e 756d 6265 7227 5d0d 0a20 2020  up number']..   
+0000e040: 2020 2020 206e 616d 6520 3d20 7367 5b27       name = sg['
+0000e050: 7370 6163 6520 6772 6f75 7020 6e61 6d65  space group name
+0000e060: 275d 0d0a 2020 2020 2020 2020 7365 7474  ']..        sett
+0000e070: 696e 6720 3d20 7367 5b27 7365 7474 696e  ing = sg['settin
+0000e080: 6727 5d0d 0a20 2020 2020 2020 2074 7970  g']..        typ
+0000e090: 656e 616d 6520 3d20 7367 5b27 7479 7065  ename = sg['type
+0000e0a0: 206e 616d 6527 5d0d 0a20 2020 2020 2020   name']..       
+0000e0b0: 2023 206f 7073 203d 2073 675b 276f 7065   # ops = sg['ope
+0000e0c0: 7261 746f 7273 206d 6167 6e65 7469 6327  rators magnetic'
+0000e0d0: 5d0d 0a20 2020 2020 2020 206f 7073 203d  ]..        ops =
+0000e0e0: 2073 675b 2770 6f73 6974 696f 6e73 206d   sg['positions m
+0000e0f0: 6167 6e65 7469 6327 5d0d 0a20 2020 2020  agnetic']..     
+0000e100: 2020 206f 7574 202b 3d20 666d 7420 2520     out += fmt % 
+0000e110: 2870 6172 656e 742c 206e 756d 6265 722c  (parent, number,
+0000e120: 206e 616d 652c 2073 6574 7469 6e67 2c20   name, setting, 
+0000e130: 7479 7065 6e61 6d65 2c20 6f70 7329 0d0a  typename, ops)..
+0000e140: 2020 2020 7265 7475 726e 206f 7574 0d0a      return out..
+0000e150: 0d0a 0d0a 6465 6620 6669 6e64 5f73 7061  ....def find_spa
+0000e160: 6365 6772 6f75 7028 7367 5f73 796d 626f  cegroup(sg_symbo
+0000e170: 6c29 3a0d 0a20 2020 2022 2222 0d0a 2020  l):..    """..  
+0000e180: 2020 4669 6e64 2061 2073 7061 6365 6772    Find a spacegr
+0000e190: 6f75 7020 6261 7365 6420 6f6e 2074 6865  oup based on the
+0000e1a0: 2069 6465 6e74 6966 7969 6e67 2073 796d   identifying sym
+0000e1b0: 626f 6c0d 0a20 2020 203a 7061 7261 6d20  bol..    :param 
+0000e1c0: 7367 5f73 796d 626f 6c3a 2073 7472 2c20  sg_symbol: str, 
+0000e1d0: 652e 672e 2027 4664 2d33 6d27 0d0a 2020  e.g. 'Fd-3m'..  
+0000e1e0: 2020 3a72 6574 7572 6e3a 2073 7061 6365    :return: space
+0000e1f0: 6772 6f75 7020 6469 6374 206f 7220 4e6f  group dict or No
+0000e200: 6e65 2069 6620 6e6f 7420 666f 756e 640d  ne if not found.
+0000e210: 0a20 2020 2022 2222 0d0a 2020 2020 7367  .    """..    sg
+0000e220: 5f73 796d 626f 6c20 3d20 7367 5f73 796d  _symbol = sg_sym
+0000e230: 626f 6c2e 7265 706c 6163 6528 2720 272c  bol.replace(' ',
+0000e240: 2027 2729 2e72 6570 6c61 6365 2827 5c22   '').replace('\"
+0000e250: 272c 2027 2729 0d0a 2020 2020 7367 5f64  ', '')..    sg_d
+0000e260: 6963 7420 3d20 7370 6163 6567 726f 7570  ict = spacegroup
+0000e270: 7328 290d 0a20 2020 2073 675f 6b65 7973  s()..    sg_keys
+0000e280: 203d 206c 6973 7428 7367 5f64 6963 742e   = list(sg_dict.
+0000e290: 6b65 7973 2829 290d 0a20 2020 2073 675f  keys())..    sg_
+0000e2a0: 6e61 6d65 7320 3d20 5b73 675f 6469 6374  names = [sg_dict
+0000e2b0: 5b73 675d 5b27 7370 6163 6520 6772 6f75  [sg]['space grou
+0000e2c0: 7020 6e61 6d65 275d 2066 6f72 2073 6720  p name'] for sg 
+0000e2d0: 696e 2073 675f 6469 6374 5d0d 0a20 2020  in sg_dict]..   
+0000e2e0: 2069 6620 7367 5f73 796d 626f 6c20 696e   if sg_symbol in
+0000e2f0: 2073 675f 6e61 6d65 733a 0d0a 2020 2020   sg_names:..    
+0000e300: 2020 2020 6b65 7920 3d20 7367 5f6b 6579      key = sg_key
+0000e310: 735b 7367 5f6e 616d 6573 2e69 6e64 6578  s[sg_names.index
+0000e320: 2873 675f 7379 6d62 6f6c 295d 0d0a 2020  (sg_symbol)]..  
+0000e330: 2020 2020 2020 7265 7475 726e 2073 675f        return sg_
+0000e340: 6469 6374 5b6b 6579 5d0d 0a20 2020 2073  dict[key]..    s
+0000e350: 675f 6469 6374 203d 2073 7061 6365 6772  g_dict = spacegr
+0000e360: 6f75 7073 5f6d 6167 6e65 7469 6328 290d  oups_magnetic().
+0000e370: 0a20 2020 2073 675f 6b65 7973 203d 206c  .    sg_keys = l
+0000e380: 6973 7428 7367 5f64 6963 742e 6b65 7973  ist(sg_dict.keys
+0000e390: 2829 290d 0a20 2020 2073 675f 6e61 6d65  ())..    sg_name
+0000e3a0: 7320 3d20 5b73 675f 6469 6374 5b73 675d  s = [sg_dict[sg]
+0000e3b0: 5b27 7370 6163 6520 6772 6f75 7020 6e61  ['space group na
+0000e3c0: 6d65 275d 2066 6f72 2073 6720 696e 2073  me'] for sg in s
+0000e3d0: 675f 6469 6374 5d0d 0a20 2020 2069 6620  g_dict]..    if 
+0000e3e0: 7367 5f73 796d 626f 6c20 696e 2073 675f  sg_symbol in sg_
+0000e3f0: 6e61 6d65 733a 0d0a 2020 2020 2020 2020  names:..        
+0000e400: 6b65 7920 3d20 7367 5f6b 6579 735b 7367  key = sg_keys[sg
+0000e410: 5f6e 616d 6573 2e69 6e64 6578 2873 675f  _names.index(sg_
+0000e420: 7379 6d62 6f6c 295d 0d0a 2020 2020 2020  symbol)]..      
+0000e430: 2020 7265 7475 726e 2073 675f 6469 6374    return sg_dict
+0000e440: 5b6b 6579 5d0d 0a20 2020 2072 6574 7572  [key]..    retur
+0000e450: 6e20 4e6f 6e65 0d0a 0d0a 0d0a 6465 6620  n None......def 
+0000e460: 7779 636b 6f66 665f 6c61 6265 6c73 2873  wyckoff_labels(s
+0000e470: 7061 6365 6772 6f75 705f 6469 6374 2c20  pacegroup_dict, 
+0000e480: 5556 5729 3a0d 0a20 2020 2022 2222 0d0a  UVW):..    """..
+0000e490: 2020 2020 5265 7475 726e 2057 7963 6b6f      Return Wycko
+0000e4a0: 6666 2073 6974 6520 6c61 6265 6c73 2066  ff site labels f
+0000e4b0: 6f72 2067 6976 656e 2070 6f73 6974 696f  or given positio
+0000e4c0: 6e73 0d0a 2020 2020 3a70 6172 616d 2073  ns..    :param s
+0000e4d0: 7061 6365 6772 6f75 705f 6469 6374 3a20  pacegroup_dict: 
+0000e4e0: 7370 6163 6567 726f 7570 2064 6963 7420  spacegroup dict 
+0000e4f0: 6672 6f6d 2074 6162 6c65 732c 2069 6620  from tables, if 
+0000e500: 6d61 676e 6574 6963 2073 7061 6365 6772  magnetic spacegr
+0000e510: 6f75 7020 6769 7665 6e2c 2075 7365 7320  oup given, uses 
+0000e520: 7468 6520 7061 7265 6e74 2073 7061 6365  the parent space
+0000e530: 6772 6f75 700d 0a20 2020 203a 7061 7261  group..    :para
+0000e540: 6d20 5556 573a 206e 2a33 2061 7272 6179  m UVW: n*3 array
+0000e550: 285b 752c 762c 775d 2920 6174 6f6d 6963  ([u,v,w]) atomic
+0000e560: 2070 6f73 6974 696f 6e73 2069 6e20 6672   positions in fr
+0000e570: 6163 7469 6f6e 616c 2063 6f6f 7264 696e  actional coordin
+0000e580: 6174 6573 0d0a 2020 2020 3a72 6574 7572  ates..    :retur
+0000e590: 6e3a 206c 6973 745b 6e5d 206f 6620 5779  n: list[n] of Wy
+0000e5a0: 636b 6f66 6620 7369 7465 206c 6574 7465  ckoff site lette
+0000e5b0: 7273 0d0a 2020 2020 2222 220d 0a0d 0a20  rs..    """.... 
+0000e5c0: 2020 2069 6620 2770 6172 656e 7420 6e75     if 'parent nu
+0000e5d0: 6d62 6572 2720 696e 2073 7061 6365 6772  mber' in spacegr
+0000e5e0: 6f75 705f 6469 6374 3a0d 0a20 2020 2020  oup_dict:..     
+0000e5f0: 2020 2023 206d 6167 6e65 7469 6320 7370     # magnetic sp
+0000e600: 6163 6567 726f 7570 202d 2064 6f65 736e  acegroup - doesn
+0000e610: 2774 2063 6f6e 7461 696e 2077 7963 6b6f  't contain wycko
+0000e620: 6666 206c 6574 7465 7273 0d0a 2020 2020  ff letters..    
+0000e630: 2020 2020 7370 6163 6567 726f 7570 5f64      spacegroup_d
+0000e640: 6963 7420 3d20 7370 6163 6567 726f 7570  ict = spacegroup
+0000e650: 2873 7061 6365 6772 6f75 705f 6469 6374  (spacegroup_dict
+0000e660: 5b27 7061 7265 6e74 206e 756d 6265 7227  ['parent number'
+0000e670: 5d29 0d0a 0d0a 2020 2020 6765 6e65 7261  ])....    genera
+0000e680: 6c5f 706f 7369 7469 6f6e 7320 3d20 7370  l_positions = sp
+0000e690: 6163 6567 726f 7570 5f64 6963 745b 2767  acegroup_dict['g
+0000e6a0: 656e 6572 616c 2070 6f73 6974 696f 6e73  eneral positions
+0000e6b0: 275d 0d0a 2020 2020 7779 636b 6f66 665f  ']..    wyckoff_
+0000e6c0: 706f 7369 7469 6f6e 7320 3d20 7370 6163  positions = spac
+0000e6d0: 6567 726f 7570 5f64 6963 745b 2770 6f73  egroup_dict['pos
+0000e6e0: 6974 696f 6e73 2063 6f6f 7264 696e 6174  itions coordinat
+0000e6f0: 6573 275d 5b3a 3a2d 315d 0d0a 2020 2020  es'][::-1]..    
+0000e700: 7779 636b 6f66 665f 6c65 7474 6572 7320  wyckoff_letters 
+0000e710: 3d20 7370 6163 6567 726f 7570 5f64 6963  = spacegroup_dic
+0000e720: 745b 2770 6f73 6974 696f 6e73 2077 7963  t['positions wyc
+0000e730: 6b6f 6666 206c 6574 7465 7227 5d5b 3a3a  koff letter'][::
+0000e740: 2d31 5d0d 0a20 2020 206d 756c 7469 706c  -1]..    multipl
+0000e750: 6963 6974 7920 3d20 7370 6163 6567 726f  icity = spacegro
+0000e760: 7570 5f64 6963 745b 2770 6f73 6974 696f  up_dict['positio
+0000e770: 6e73 206d 756c 7469 706c 6963 6974 7927  ns multiplicity'
+0000e780: 5d5b 3a3a 2d31 5d0d 0a20 2020 2073 796d  ][::-1]..    sym
+0000e790: 6d65 7472 7920 3d20 7370 6163 6567 726f  metry = spacegro
+0000e7a0: 7570 5f64 6963 745b 2770 6f73 6974 696f  up_dict['positio
+0000e7b0: 6e73 2073 796d 6d65 7472 7927 5d5b 3a3a  ns symmetry'][::
+0000e7c0: 2d31 5d0d 0a0d 0a20 2020 2073 6974 6573  -1]....    sites
+0000e7d0: 203d 205b 2725 7325 7320 2825 7329 2720   = ['%s%s (%s)' 
+0000e7e0: 2520 286d 2c20 6c2c 2073 2920 666f 7220  % (m, l, s) for 
+0000e7f0: 6c2c 206d 2c20 7320 696e 207a 6970 2877  l, m, s in zip(w
+0000e800: 7963 6b6f 6666 5f6c 6574 7465 7273 2c20  yckoff_letters, 
+0000e810: 6d75 6c74 6970 6c69 6369 7479 2c20 7379  multiplicity, sy
+0000e820: 6d6d 6574 7279 295d 0d0a 0d0a 2020 2020  mmetry)]....    
+0000e830: 5556 5720 3d20 6e70 2e61 7361 7272 6179  UVW = np.asarray
+0000e840: 2855 5657 2c20 6474 7970 653d 666c 6f61  (UVW, dtype=floa
+0000e850: 7429 2e72 6573 6861 7065 2828 2d31 2c20  t).reshape((-1, 
+0000e860: 3329 290d 0a20 2020 2075 7677 5f6c 6574  3))..    uvw_let
+0000e870: 7465 7273 203d 205b 7779 636b 6f66 665f  ters = [wyckoff_
+0000e880: 6c65 7474 6572 735b 2d31 5d20 666f 7220  letters[-1] for 
+0000e890: 6e20 696e 2072 616e 6765 286c 656e 2855  n in range(len(U
+0000e8a0: 5657 2929 5d0d 0a20 2020 2066 6f72 206e  VW))]..    for n
+0000e8b0: 2069 6e20 7261 6e67 6528 6c65 6e28 5556   in range(len(UV
+0000e8c0: 5729 293a 0d0a 2020 2020 2020 2020 752c  W)):..        u,
+0000e8d0: 2076 2c20 7720 3d20 5556 575b 6e5d 0d0a   v, w = UVW[n]..
+0000e8e0: 2020 2020 2020 2020 2320 466f 7220 6561          # For ea
+0000e8f0: 6368 2070 6f73 6974 696f 6e2c 2067 656e  ch position, gen
+0000e900: 6572 6174 6520 616c 6c20 6765 6e65 7261  erate all genera
+0000e910: 6c20 706f 7369 7469 6f6e 730d 0a20 2020  l positions..   
+0000e920: 2020 2020 2073 796d 5f75 7677 203d 2066       sym_uvw = f
+0000e930: 6974 696e 6365 6c6c 2867 656e 5f73 796d  itincell(gen_sym
+0000e940: 5f70 6f73 2867 656e 6572 616c 5f70 6f73  _pos(general_pos
+0000e950: 6974 696f 6e73 2c20 752c 2076 2c20 7729  itions, u, v, w)
+0000e960: 290d 0a20 2020 2020 2020 2066 6f72 2077  )..        for w
+0000e970: 7963 6b6f 6666 5f6f 7073 2c20 6c65 7474  yckoff_ops, lett
+0000e980: 6572 2069 6e20 7a69 7028 7779 636b 6f66  er in zip(wyckof
+0000e990: 665f 706f 7369 7469 6f6e 732c 2073 6974  f_positions, sit
+0000e9a0: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
+0000e9b0: 2020 2320 6c6f 6f70 696e 6720 6672 6f6d    # looping from
+0000e9c0: 2073 6d61 6c6c 6573 7420 746f 206d 6f73   smallest to mos
+0000e9d0: 7420 6765 6e65 7261 6c2c 2063 6865 636b  t general, check
+0000e9e0: 2069 6620 6669 7273 7420 5779 636b 6f66   if first Wyckof
+0000e9f0: 6620 706f 7369 7469 6f6e 2069 7320 696e  f position is in
+0000ea00: 2067 656e 6572 616c 2070 6f73 6974 696f   general positio
+0000ea10: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
+0000ea20: 7472 6961 6c5f 7576 7720 3d20 6669 7469  trial_uvw = fiti
+0000ea30: 6e63 656c 6c28 6765 6e5f 7379 6d5f 706f  ncell(gen_sym_po
+0000ea40: 7328 7779 636b 6f66 665f 6f70 735b 3a31  s(wyckoff_ops[:1
+0000ea50: 5d2c 2075 2c20 762c 2077 2929 5b30 5d0d  ], u, v, w))[0].
+0000ea60: 0a20 2020 2020 2020 2020 2020 2064 6966  .            dif
+0000ea70: 6620 3d20 6667 2e6d 6167 2873 796d 5f75  f = fg.mag(sym_u
+0000ea80: 7677 202d 2074 7269 616c 5f75 7677 290d  vw - trial_uvw).
+0000ea90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000eaa0: 6469 6666 2e6d 696e 2829 203c 2030 2e30  diff.min() < 0.0
+0000eab0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+0000eac0: 2020 2020 7576 775f 6c65 7474 6572 735b      uvw_letters[
+0000ead0: 6e5d 203d 206c 6574 7465 720d 0a20 2020  n] = letter..   
+0000eae0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0000eaf0: 616b 0d0a 2020 2020 7265 7475 726e 2075  ak..    return u
+0000eb00: 7677 5f6c 6574 7465 7273 0d0a 0d0a 0d0a  vw_letters......
+0000eb10: 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d45  '--------------E
+0000eb20: 6c65 6d65 6e74 2050 726f 7065 7274 6965  lement Propertie
+0000eb30: 7320 2620 4368 6172 6765 2d2d 2d2d 2d2d  s & Charge------
+0000eb40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000eb50: 270d 0a0d 0a0d 0a64 6566 2065 6c65 6d65  '......def eleme
+0000eb60: 6e74 5f73 796d 626f 6c28 656c 656d 656e  nt_symbol(elemen
+0000eb70: 745f 5a3d 4e6f 6e65 293a 0d0a 2020 2020  t_Z=None):..    
+0000eb80: 2222 220d 0a20 2020 2052 6574 7572 6e73  """..    Returns
+0000eb90: 2074 6865 2065 6c65 6d65 6e74 2073 796d   the element sym
+0000eba0: 706f 6c20 666f 7220 656c 656d 656e 745f  pol for element_
+0000ebb0: 5a0d 0a20 2020 203a 7061 7261 6d20 656c  Z..    :param el
+0000ebc0: 656d 656e 745f 7a3a 2069 6e74 206f 7220  ement_z: int or 
+0000ebd0: 6172 7261 7920 6f72 204e 6f6e 6520 666f  array or None fo
+0000ebe0: 7220 616c 6c20 656c 656d 656e 7473 0d0a  r all elements..
+0000ebf0: 2020 2020 3a72 6574 7572 6e3a 2073 7472      :return: str
+0000ec00: 0d0a 2020 2020 2222 220d 0a20 2020 2073  ..    """..    s
+0000ec10: 796d 626f 6c73 203d 2061 746f 6d5f 7072  ymbols = atom_pr
+0000ec20: 6f70 6572 7469 6573 284e 6f6e 652c 2027  operties(None, '
+0000ec30: 456c 656d 656e 7427 290d 0a20 2020 2069  Element')..    i
+0000ec40: 6620 656c 656d 656e 745f 5a20 6973 204e  f element_Z is N
+0000ec50: 6f6e 653a 0d0a 2020 2020 2020 2020 7265  one:..        re
+0000ec60: 7475 726e 2073 796d 626f 6c73 0d0a 2020  turn symbols..  
+0000ec70: 2020 656c 656d 656e 745f 5a20 3d20 6e70    element_Z = np
+0000ec80: 2e61 7361 7272 6179 2865 6c65 6d65 6e74  .asarray(element
+0000ec90: 5f5a 292e 7265 7368 6170 6528 2d31 290d  _Z).reshape(-1).
+0000eca0: 0a20 2020 2072 6574 7572 6e20 7379 6d62  .    return symb
+0000ecb0: 6f6c 735b 656c 656d 656e 745f 5a20 2d20  ols[element_Z - 
+0000ecc0: 315d 0d0a 0d0a 0d0a 6465 6620 656c 656d  1]......def elem
+0000ecd0: 656e 745f 7a28 656c 656d 656e 7429 3a0d  ent_z(element):.
+0000ece0: 0a20 2020 2022 2222 0d0a 2020 2020 5265  .    """..    Re
+0000ecf0: 7475 726e 7320 7468 6520 656c 656d 656e  turns the elemen
+0000ed00: 7420 6e75 6d62 6572 205a 0d0a 2020 2020  t number Z..    
+0000ed10: 3a70 6172 616d 2065 6c65 6d65 6e74 3a20  :param element: 
+0000ed20: 7374 720d 0a20 2020 203a 7265 7475 726e  str..    :return
+0000ed30: 3a20 696e 740d 0a20 2020 2022 2222 0d0a  : int..    """..
+0000ed40: 2020 2020 7a20 3d20 6174 6f6d 5f70 726f      z = atom_pro
+0000ed50: 7065 7274 6965 7328 656c 656d 656e 742c  perties(element,
+0000ed60: 2027 5a27 290d 0a20 2020 2069 6620 6c65   'Z')..    if le
+0000ed70: 6e28 7a29 203d 3d20 313a 0d0a 2020 2020  n(z) == 1:..    
+0000ed80: 2020 2020 7265 7475 726e 207a 5b30 5d0d      return z[0].
+0000ed90: 0a20 2020 2072 6574 7572 6e20 7a0d 0a0d  .    return z...
+0000eda0: 0a0d 0a64 6566 2065 6c65 6d65 6e74 5f6e  ...def element_n
+0000edb0: 616d 6528 656c 656d 656e 743d 4e6f 6e65  ame(element=None
+0000edc0: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+0000edd0: 2052 6574 7572 6e73 2074 6865 2065 6c65   Returns the ele
+0000ede0: 6d65 6e74 206e 616d 650d 0a20 2020 203a  ment name..    :
+0000edf0: 7061 7261 6d20 656c 656d 656e 743a 2073  param element: s
+0000ee00: 7472 0d0a 2020 2020 3a72 6574 7572 6e3a  tr..    :return:
+0000ee10: 2069 6e74 0d0a 2020 2020 2222 220d 0a20   int..    """.. 
+0000ee20: 2020 206e 616d 6520 3d20 6174 6f6d 5f70     name = atom_p
+0000ee30: 726f 7065 7274 6965 7328 656c 656d 656e  roperties(elemen
+0000ee40: 742c 2027 4e61 6d65 2729 0d0a 2020 2020  t, 'Name')..    
+0000ee50: 6966 206c 656e 286e 616d 6529 203d 3d20  if len(name) == 
+0000ee60: 313a 0d0a 2020 2020 2020 2020 7265 7475  1:..        retu
+0000ee70: 726e 206e 616d 655b 305d 0d0a 2020 2020  rn name[0]..    
+0000ee80: 7265 7475 726e 206e 616d 650d 0a0d 0a0d  return name.....
+0000ee90: 0a64 6566 2073 706c 6974 5f65 6c65 6d65  .def split_eleme
+0000eea0: 6e74 5f73 796d 626f 6c28 656c 656d 656e  nt_symbol(elemen
+0000eeb0: 7429 3a0d 0a20 2020 2022 2222 0d0a 2020  t):..    """..  
+0000eec0: 2020 4672 6f6d 2065 6c65 6d65 6e74 2073    From element s
+0000eed0: 796d 626f 6c2c 2073 706c 6974 2063 6861  ymbol, split cha
+0000eee0: 7267 6520 616e 6420 6f63 6375 7061 6e63  rge and occupanc
+0000eef0: 790d 0a20 2020 2020 2073 796d 626f 6c2c  y..      symbol,
+0000ef00: 206f 6363 7570 616e 6379 2c20 6368 6172   occupancy, char
+0000ef10: 6765 203d 2073 706c 6974 5f65 6c65 6d65  ge = split_eleme
+0000ef20: 6e74 5f73 796d 626f 6c28 2743 6f33 2b27  nt_symbol('Co3+'
+0000ef30: 290d 0a20 2020 2041 6e79 206e 756d 6265  )..    Any numbe
+0000ef40: 7273 2061 7070 656e 6465 6420 6279 202b  rs appended by +
+0000ef50: 2f2d 2061 7265 2074 616b 656e 2061 7320  /- are taken as 
+0000ef60: 6368 6172 6765 2c20 6f74 6865 7277 6973  charge, otherwis
+0000ef70: 6520 7468 6579 2061 7265 2063 6f75 6e74  e they are count
+0000ef80: 6564 2061 7320 6f63 6375 7061 6e63 792e  ed as occupancy.
+0000ef90: 0d0a 2020 2020 652e 672e 2020 2020 656c  ..    e.g.    el
+0000efa0: 656d 656e 7420 2020 2020 3e20 2020 7379  ement     >   sy
+0000efb0: 6d62 6f6c 2020 7c20 2020 6f63 6375 7061  mbol  |   occupa
+0000efc0: 6e63 7920 2020 7c20 2020 6368 6172 6765  ncy   |   charge
+0000efd0: 0d0a 2020 2020 2020 2020 2020 2020 436f  ..            Co
+0000efe0: 332b 2020 2020 2020 2020 2020 2020 436f  3+            Co
+0000eff0: 2020 2020 2020 2020 2020 312e 2020 2020            1.    
+0000f000: 2020 2020 2020 2020 2020 330d 0a20 2020            3..   
+0000f010: 2020 2020 2020 2020 2033 2e32 4f32 2d20           3.2O2- 
+0000f020: 2020 2020 2020 2020 204f 2020 2020 2020           O      
+0000f030: 2020 2020 2033 2e32 2020 2020 2020 2020       3.2        
+0000f040: 2020 2020 202d 320d 0a20 2020 2020 2020       -2..       
+0000f050: 2020 2020 2066 6533 2020 2020 2020 2020       fe3        
+0000f060: 2020 2020 2046 6520 2020 2020 2020 2020       Fe         
+0000f070: 2033 2020 2020 2020 2020 2020 2020 2020   3              
+0000f080: 2030 0d0a 2020 2020 3a70 6172 616d 2065   0..    :param e
+0000f090: 6c65 6d65 6e74 3a20 7374 720d 0a20 2020  lement: str..   
+0000f0a0: 203a 7265 7475 726e 3a20 7379 6d62 6f6c   :return: symbol
+0000f0b0: 3a20 7374 720d 0a20 2020 203a 7265 7475  : str..    :retu
+0000f0c0: 726e 3a20 6f63 6375 7061 6e63 793a 2066  rn: occupancy: f
+0000f0d0: 6c6f 6174 0d0a 2020 2020 3a72 6574 7572  loat..    :retur
+0000f0e0: 6e3a 2063 6861 7267 653a 2066 6c6f 6174  n: charge: float
+0000f0f0: 0d0a 2020 2020 2222 220d 0a20 2020 2023  ..    """..    #
+0000f100: 2046 696e 6420 656c 656d 656e 740d 0a20   Find element.. 
+0000f110: 2020 2073 796d 626f 6c20 3d20 656c 656d     symbol = elem
+0000f120: 656e 745f 7265 6765 782e 6669 6e64 616c  ent_regex.findal
+0000f130: 6c28 656c 656d 656e 7429 5b30 5d0d 0a20  l(element)[0].. 
+0000f140: 2020 2023 2046 696e 6420 6368 6172 6765     # Find charge
+0000f150: 0d0a 2020 2020 6669 6e64 5f63 6861 7267  ..    find_charg
+0000f160: 6520 3d20 7265 2e66 696e 6461 6c6c 2827  e = re.findall('
+0000f170: 5b5c 645c 2e5d 2b5b 5c2b 2d5d 272c 2065  [\d\.]+[\+-]', e
+0000f180: 6c65 6d65 6e74 290d 0a20 2020 2069 6620  lement)..    if 
+0000f190: 6c65 6e28 6669 6e64 5f63 6861 7267 6529  len(find_charge)
+0000f1a0: 203e 2030 3a0d 0a20 2020 2020 2020 2063   > 0:..        c
+0000f1b0: 6861 7267 6573 7472 203d 2066 696e 645f  hargestr = find_
+0000f1c0: 6368 6172 6765 5b30 5d0d 0a20 2020 2020  charge[0]..     
+0000f1d0: 2020 2065 6c65 6d65 6e74 203d 2065 6c65     element = ele
+0000f1e0: 6d65 6e74 2e72 6570 6c61 6365 2863 6861  ment.replace(cha
+0000f1f0: 7267 6573 7472 2c20 2727 290d 0a20 2020  rgestr, '')..   
+0000f200: 2020 2020 2069 6620 272d 2720 696e 2063       if '-' in c
+0000f210: 6861 7267 6573 7472 3a0d 0a20 2020 2020  hargestr:..     
+0000f220: 2020 2020 2020 2063 6861 7267 6520 3d20         charge = 
+0000f230: 2d66 6c6f 6174 2863 6861 7267 6573 7472  -float(chargestr
+0000f240: 5b3a 2d31 5d29 0d0a 2020 2020 2020 2020  [:-1])..        
+0000f250: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000f260: 2020 2063 6861 7267 6520 3d20 666c 6f61     charge = floa
+0000f270: 7428 6368 6172 6765 7374 725b 3a2d 315d  t(chargestr[:-1]
+0000f280: 290d 0a20 2020 2065 6c73 653a 0d0a 2020  )..    else:..  
+0000f290: 2020 2020 2020 6368 6172 6765 203d 2030        charge = 0
+0000f2a0: 2e0d 0a20 2020 2023 2046 696e 6420 6f63  ...    # Find oc
+0000f2b0: 6375 7061 6e63 790d 0a20 2020 2066 696e  cupancy..    fin
+0000f2c0: 645f 6f63 6320 3d20 7265 2e66 696e 6461  d_occ = re.finda
+0000f2d0: 6c6c 2827 5b5c 645c 2e5d 2b27 2c20 656c  ll('[\d\.]+', el
+0000f2e0: 656d 656e 7429 0d0a 2020 2020 6966 206c  ement)..    if l
+0000f2f0: 656e 2866 696e 645f 6f63 6329 203e 2030  en(find_occ) > 0
+0000f300: 3a0d 0a20 2020 2020 2020 206f 6363 7570  :..        occup
+0000f310: 616e 6379 203d 2066 6c6f 6174 2866 696e  ancy = float(fin
+0000f320: 645f 6f63 635b 305d 290d 0a20 2020 2065  d_occ[0])..    e
+0000f330: 6c73 653a 0d0a 2020 2020 2020 2020 6f63  lse:..        oc
+0000f340: 6375 7061 6e63 7920 3d20 312e 0d0a 2020  cupancy = 1...  
+0000f350: 2020 7265 7475 726e 2073 796d 626f 6c2c    return symbol,
+0000f360: 206f 6363 7570 616e 6379 2c20 6368 6172   occupancy, char
+0000f370: 6765 0d0a 0d0a 0d0a 6465 6620 656c 656d  ge......def elem
+0000f380: 656e 745f 6368 6172 6765 5f73 7472 696e  ent_charge_strin
+0000f390: 6728 7379 6d62 6f6c 2c20 6f63 6375 7061  g(symbol, occupa
+0000f3a0: 6e63 793d 312e 302c 2063 6861 7267 653d  ncy=1.0, charge=
+0000f3b0: 302e 302c 206c 6174 6578 3d46 616c 7365  0.0, latex=False
+0000f3c0: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+0000f3d0: 2052 6574 7572 6e20 666f 726d 6174 7465   Return formatte
+0000f3e0: 6420 7374 7269 6e67 206f 6620 656c 656d  d string of elem
+0000f3f0: 656e 7420 7769 7468 206f 6363 7570 616e  ent with occupan
+0000f400: 6379 2061 6e64 2063 6861 7267 650d 0a20  cy and charge.. 
+0000f410: 2020 203a 7061 7261 6d20 7379 6d62 6f6c     :param symbol
+0000f420: 3a20 7374 7220 2d20 656c 656d 656e 7420  : str - element 
+0000f430: 7374 7269 6e67 0d0a 2020 2020 3a70 6172  string..    :par
+0000f440: 616d 206f 6363 7570 616e 6379 3a20 666c  am occupancy: fl
+0000f450: 6f61 7420 2d20 656c 656d 656e 7420 6f63  oat - element oc
+0000f460: 6375 7061 6e63 7920 6f72 206e 756d 6265  cupancy or numbe
+0000f470: 7220 6f66 2065 6c65 6d65 6e74 730d 0a20  r of elements.. 
+0000f480: 2020 203a 7061 7261 6d20 6368 6172 6765     :param charge
+0000f490: 3a20 666c 6f61 7420 2d20 656c 656d 656e  : float - elemen
+0000f4a0: 7420 6368 6172 6765 0d0a 2020 2020 3a70  t charge..    :p
+0000f4b0: 6172 616d 206c 6174 6578 3a20 6966 2054  aram latex: if T
+0000f4c0: 7275 652c 2072 6574 7572 6e73 2073 7472  rue, returns str
+0000f4d0: 696e 6720 666f 726d 6174 7465 6420 7769  ing formatted wi
+0000f4e0: 7468 206c 6174 6578 2074 6167 730d 0a20  th latex tags.. 
+0000f4f0: 2020 203a 7265 7475 726e 3a20 7374 720d     :return: str.
+0000f500: 0a20 2020 2022 2222 0d0a 2020 2020 6966  .    """..    if
+0000f510: 2061 6273 2863 6861 7267 6529 203c 2030   abs(charge) < 0
+0000f520: 2e30 313a 0d0a 2020 2020 2020 2020 6368  .01:..        ch
+0000f530: 7374 7220 3d20 2727 0d0a 2020 2020 656c  str = ''..    el
+0000f540: 6966 2061 6273 2863 6861 7267 6520 2d20  if abs(charge - 
+0000f550: 3129 203c 2030 2e30 313a 0d0a 2020 2020  1) < 0.01:..    
+0000f560: 2020 2020 6368 7374 7220 3d20 272b 270d      chstr = '+'.
+0000f570: 0a20 2020 2065 6c69 6620 6162 7328 6368  .    elif abs(ch
+0000f580: 6172 6765 202b 2031 2920 3c20 302e 3031  arge + 1) < 0.01
+0000f590: 3a0d 0a20 2020 2020 2020 2063 6873 7472  :..        chstr
+0000f5a0: 203d 2027 2d27 0d0a 2020 2020 656c 6966   = '-'..    elif
+0000f5b0: 2063 6861 7267 6520 3e20 303a 0d0a 2020   charge > 0:..  
+0000f5c0: 2020 2020 2020 6368 7374 7220 3d20 2725        chstr = '%
+0000f5d0: 302e 3367 2b27 2025 2063 6861 7267 650d  0.3g+' % charge.
+0000f5e0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+0000f5f0: 2020 2020 6368 7374 7220 3d20 2725 302e      chstr = '%0.
+0000f600: 3367 2d27 2025 2061 6273 2863 6861 7267  3g-' % abs(charg
+0000f610: 6529 0d0a 0d0a 2020 2020 6966 206c 6174  e)....    if lat
+0000f620: 6578 3a0d 0a20 2020 2020 2020 2063 6873  ex:..        chs
+0000f630: 7472 203d 2027 245e 7b25 737d 2427 2025  tr = '$^{%s}$' %
+0000f640: 2063 6873 7472 0d0a 0d0a 2020 2020 6966   chstr....    if
+0000f650: 206e 702e 6162 7328 6f63 6375 7061 6e63   np.abs(occupanc
+0000f660: 7920 2d20 3129 203c 2030 2e30 313a 0d0a  y - 1) < 0.01:..
+0000f670: 2020 2020 2020 2020 6f75 7473 7472 203d          outstr =
+0000f680: 2027 2573 2573 2720 2520 2873 796d 626f   '%s%s' % (symbo
+0000f690: 6c2c 2063 6873 7472 290d 0a20 2020 2065  l, chstr)..    e
+0000f6a0: 6c73 653a 0d0a 2020 2020 2020 2020 6f75  lse:..        ou
+0000f6b0: 7473 7472 203d 2027 2530 2e33 675b 2573  tstr = '%0.3g[%s
+0000f6c0: 2573 5d27 2025 2028 6f63 6375 7061 6e63  %s]' % (occupanc
+0000f6d0: 792c 2073 796d 626f 6c2c 2063 6873 7472  y, symbol, chstr
+0000f6e0: 290d 0a20 2020 2072 6574 7572 6e20 6f75  )..    return ou
+0000f6f0: 7473 7472 0d0a 0d0a 0d0a 6465 6620 7370  tstr......def sp
+0000f700: 6c69 745f 636f 6d70 6f75 6e64 2863 6f6d  lit_compound(com
+0000f710: 706f 756e 645f 6e61 6d65 293a 0d0a 2020  pound_name):..  
+0000f720: 2020 2222 220d 0a20 2020 2043 6f6e 7665    """..    Conve
+0000f730: 7274 2061 206d 6f6c 6563 756c 6172 206f  rt a molecular o
+0000f740: 7220 636f 6d70 6f75 6e64 206e 616d 6520  r compound name 
+0000f750: 696e 746f 2061 206c 6973 7420 6f66 2065  into a list of e
+0000f760: 6c65 6d65 6e74 7320 616e 6420 6e75 6d62  lements and numb
+0000f770: 6572 732e 0d0a 2020 2020 4173 7375 6d65  ers...    Assume
+0000f780: 7320 616c 6c20 656c 656d 656e 7420 6d75  s all element mu
+0000f790: 6c74 6970 6c69 6361 7469 6f6e 7320 6172  ltiplications ar
+0000f7a0: 6520 746f 2074 6865 204c 4546 5420 6f66  e to the LEFT of
+0000f7b0: 2074 6865 2065 6c65 6d65 6e74 206e 616d   the element nam
+0000f7c0: 652e 0d0a 2020 2020 5661 6c75 6573 2069  e...    Values i
+0000f7d0: 6e20 6272 6163 6b65 7473 2061 7265 206d  n brackets are m
+0000f7e0: 756c 7469 706c 6965 6420 6f75 742e 0d0a  ultiplied out...
+0000f7f0: 2020 2020 452e 672e 0d0a 2020 2020 2020      E.g...      
+0000f800: 2020 7370 6c69 745f 636f 6d70 6f75 6e64    split_compound
+0000f810: 2827 4d6e 302e 3328 4665 332e 3628 436f  ('Mn0.3(Fe3.6(Co
+0000f820: 312e 3229 3229 3428 4d6f 302e 3750 7234  1.2)2)4(Mo0.7Pr4
+0000f830: 3429 3327 290d 0a20 2020 2020 2020 203e  4)3')..        >
+0000f840: 3e20 5b27 4d6e 302e 3327 2c20 2746 6531  > ['Mn0.3', 'Fe1
+0000f850: 342e 3427 2c20 2743 6f39 2e36 272c 2027  4.4', 'Co9.6', '
+0000f860: 4d6f 322e 3127 2c20 2750 7231 3332 275d  Mo2.1', 'Pr132']
+0000f870: 0d0a 2020 2020 3a70 6172 616d 2063 6f6d  ..    :param com
+0000f880: 706f 756e 645f 6e61 6d65 3a20 7374 720d  pound_name: str.
+0000f890: 0a20 2020 203a 7265 7475 726e 3a20 6c69  .    :return: li
+0000f8a0: 7374 206f 6620 7374 720d 0a20 2020 2022  st of str..    "
+0000f8b0: 2222 0d0a 2020 2020 7265 6765 785f 656c  ""..    regex_el
+0000f8c0: 656d 656e 745f 6e75 6d20 3d20 7265 2e63  ement_num = re.c
+0000f8d0: 6f6d 7069 6c65 2827 7c27 2e6a 6f69 6e28  ompile('|'.join(
+0000f8e0: 5b27 2573 5b5c 645c 2e5d 2a27 2025 2065  ['%s[\d\.]*' % e
+0000f8f0: 6c20 666f 7220 656c 2069 6e20 454c 454d  l for el in ELEM
+0000f900: 454e 545f 4c49 5354 5d29 290d 0a20 2020  ENT_LIST]))..   
+0000f910: 2023 204d 756c 7469 706c 7920 6f75 7420   # Multiply out 
+0000f920: 6272 6163 6b65 7473 0d0a 2020 2020 636f  brackets..    co
+0000f930: 6d70 6f75 6e64 5f6e 616d 6520 3d20 6667  mpound_name = fg
+0000f940: 2e72 6570 6c61 6365 5f62 7261 636b 6574  .replace_bracket
+0000f950: 5f6d 756c 7469 706c 6528 636f 6d70 6f75  _multiple(compou
+0000f960: 6e64 5f6e 616d 6529 0d0a 2020 2020 7265  nd_name)..    re
+0000f970: 7475 726e 2072 6567 6578 5f65 6c65 6d65  turn regex_eleme
+0000f980: 6e74 5f6e 756d 2e66 696e 6461 6c6c 2863  nt_num.findall(c
+0000f990: 6f6d 706f 756e 645f 6e61 6d65 290d 0a0d  ompound_name)...
+0000f9a0: 0a0d 0a64 6566 206f 7262 6974 616c 5f63  ...def orbital_c
+0000f9b0: 6f6e 6669 6775 7261 7469 6f6e 2865 6c65  onfiguration(ele
+0000f9c0: 6d65 6e74 2c20 6368 6172 6765 3d4e 6f6e  ment, charge=Non
+0000f9d0: 6529 3a0d 0a20 2020 2022 2222 0d0a 2020  e):..    """..  
+0000f9e0: 2020 5265 7475 726e 7320 7468 6520 6f72    Returns the or
+0000f9f0: 6269 7461 6c20 636f 6e66 6967 7572 6174  bital configurat
+0000fa00: 696f 6e20 6f66 2061 6e20 656c 656d 656e  ion of an elemen
+0000fa10: 7420 6173 2061 206c 6973 7420 6f66 2073  t as a list of s
+0000fa20: 7472 696e 6773 0d0a 2020 2020 3a70 6172  trings..    :par
+0000fa30: 616d 2065 6c65 6d65 6e74 3a20 7374 722c  am element: str,
+0000fa40: 2065 6c65 6d65 6e74 206e 616d 652c 2065   element name, e
+0000fa50: 2e67 2e20 2746 6527 206f 7220 2746 6533  .g. 'Fe' or 'Fe3
+0000fa60: 2b27 206f 7220 2730 2e38 4665 322b 270d  +' or '0.8Fe2+'.
+0000fa70: 0a20 2020 203a 7061 7261 6d20 6368 6172  .    :param char
+0000fa80: 6765 3a20 696e 742c 2065 6c65 6d65 6e74  ge: int, element
+0000fa90: 2063 6861 7267 6520 286f 7665 7277 7269   charge (overwri
+0000faa0: 7465 7320 6368 6172 6765 2067 6976 656e  tes charge given
+0000fab0: 2069 6e20 656c 656d 656e 7429 0d0a 2020   in element)..  
+0000fac0: 2020 3a72 6574 7572 6e3a 205b 2731 7332    :return: ['1s2
+0000fad0: 272c 2027 3273 3227 2c20 2732 7036 272c  ', '2s2', '2p6',
+0000fae0: 202e 2e2e 5d0d 0a20 2020 2022 2222 0d0a   ...]..    """..
+0000faf0: 2020 2020 7379 6d62 6f6c 2c20 6f63 6375      symbol, occu
+0000fb00: 7061 6e63 792c 2063 6861 7267 655f 7374  pancy, charge_st
+0000fb10: 7220 3d20 7370 6c69 745f 656c 656d 656e  r = split_elemen
+0000fb20: 745f 7379 6d62 6f6c 2865 6c65 6d65 6e74  t_symbol(element
+0000fb30: 290d 0a20 2020 207a 203d 2065 6c65 6d65  )..    z = eleme
+0000fb40: 6e74 5f7a 2873 796d 626f 6c29 0d0a 2020  nt_z(symbol)..  
+0000fb50: 2020 6966 2063 6861 7267 6520 6973 204e    if charge is N
+0000fb60: 6f6e 653a 0d0a 2020 2020 2020 2020 6368  one:..        ch
+0000fb70: 6172 6765 203d 2063 6861 7267 655f 7374  arge = charge_st
+0000fb80: 720d 0a20 2020 206e 6577 7a20 3d20 7a20  r..    newz = z 
+0000fb90: 2d20 696e 7428 6368 6172 6765 2920 2023  - int(charge)  #
+0000fba0: 2066 6c6f 6f72 0d0a 2020 2020 6966 206e   floor..    if n
+0000fbb0: 6577 7a20 3c20 313a 206e 6577 7a20 3d20  ewz < 1: newz = 
+0000fbc0: 310d 0a20 2020 2069 6620 6e65 777a 203e  1..    if newz >
+0000fbd0: 2031 3138 3a20 6e65 777a 203d 2031 3138   118: newz = 118
+0000fbe0: 0d0a 2020 2020 656c 656d 656e 7420 3d20  ..    element = 
+0000fbf0: 656c 656d 656e 745f 7379 6d62 6f6c 286e  element_symbol(n
+0000fc00: 6577 7a29 0d0a 2020 2020 636f 6e66 6967  ewz)..    config
+0000fc10: 203d 2061 746f 6d5f 7072 6f70 6572 7469   = atom_properti
+0000fc20: 6573 2865 6c65 6d65 6e74 2c20 2743 6f6e  es(element, 'Con
+0000fc30: 6669 6727 290d 0a20 2020 2072 6574 7572  fig')..    retur
+0000fc40: 6e20 636f 6e66 6967 5b30 5d2e 7370 6c69  n config[0].spli
+0000fc50: 7428 272e 2729 0d0a 0d0a 0d0a 6465 6620  t('.')......def 
+0000fc60: 6465 6661 756c 745f 6174 6f6d 5f63 6861  default_atom_cha
+0000fc70: 7267 6528 656c 656d 656e 7429 3a0d 0a20  rge(element):.. 
+0000fc80: 2020 2022 2222 0d0a 2020 2020 5265 7475     """..    Retu
+0000fc90: 726e 7320 7468 6520 6465 6661 756c 7420  rns the default 
+0000fca0: 6368 6172 6765 2076 616c 7565 2066 6f72  charge value for
+0000fcb0: 2074 6865 2065 6c65 6d65 6e74 0d0a 2020   the element..  
+0000fcc0: 2020 3a70 6172 616d 2065 6c65 6d65 6e74    :param element
+0000fcd0: 3a20 7374 723a 2027 4665 270d 0a20 2020  : str: 'Fe'..   
+0000fce0: 203a 7265 7475 726e 3a20 696e 7420 6f72   :return: int or
+0000fcf0: 206e 616e 0d0a 2020 2020 2222 220d 0a0d   nan..    """...
+0000fd00: 0a20 2020 2065 6c65 6d65 6e74 203d 206e  .    element = n
+0000fd10: 702e 6173 6172 7261 7928 656c 656d 656e  p.asarray(elemen
+0000fd20: 7429 2e72 6573 6861 7065 282d 3129 0d0a  t).reshape(-1)..
+0000fd30: 2020 2020 6368 6172 6765 203d 206e 702e      charge = np.
+0000fd40: 7a65 726f 7328 6c65 6e28 656c 656d 656e  zeros(len(elemen
+0000fd50: 7429 290d 0a20 2020 2066 6f72 206e 2069  t))..    for n i
+0000fd60: 6e20 7261 6e67 6528 6c65 6e28 656c 656d  n range(len(elem
+0000fd70: 656e 7429 293a 0d0a 2020 2020 2020 2020  ent)):..        
+0000fd80: 7379 6d62 6f6c 2c20 6f63 6375 7061 6e63  symbol, occupanc
+0000fd90: 792c 2065 6c65 6368 6172 6765 203d 2073  y, elecharge = s
+0000fda0: 706c 6974 5f65 6c65 6d65 6e74 5f73 796d  plit_element_sym
+0000fdb0: 626f 6c28 656c 656d 656e 745b 6e5d 290d  bol(element[n]).
+0000fdc0: 0a20 2020 2020 2020 2067 726f 7570 203d  .        group =
+0000fdd0: 2061 746f 6d5f 7072 6f70 6572 7469 6573   atom_properties
+0000fde0: 2873 796d 626f 6c2c 2027 4772 6f75 7027  (symbol, 'Group'
+0000fdf0: 295b 305d 0d0a 2020 2020 2020 2020 6966  )[0]..        if
+0000fe00: 2065 6c65 6368 6172 6765 2021 3d20 303a   elecharge != 0:
+0000fe10: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
+0000fe20: 6172 6765 5b6e 5d20 3d20 656c 6563 6861  arge[n] = elecha
+0000fe30: 7267 650d 0a20 2020 2020 2020 2065 6c69  rge..        eli
+0000fe40: 6620 6772 6f75 7020 3d3d 2031 3a0d 0a20  f group == 1:.. 
+0000fe50: 2020 2020 2020 2020 2020 2063 6861 7267             charg
+0000fe60: 655b 6e5d 203d 2031 202a 206f 6363 7570  e[n] = 1 * occup
+0000fe70: 616e 6379 0d0a 2020 2020 2020 2020 656c  ancy..        el
+0000fe80: 6966 2067 726f 7570 203d 3d20 323a 0d0a  if group == 2:..
+0000fe90: 2020 2020 2020 2020 2020 2020 6368 6172              char
+0000fea0: 6765 5b6e 5d20 3d20 3220 2a20 6f63 6375  ge[n] = 2 * occu
+0000feb0: 7061 6e63 790d 0a20 2020 2020 2020 2065  pancy..        e
+0000fec0: 6c69 6620 6772 6f75 7020 3d3d 2031 363a  lif group == 16:
+0000fed0: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
+0000fee0: 6172 6765 5b6e 5d20 3d20 2d32 202a 206f  arge[n] = -2 * o
+0000fef0: 6363 7570 616e 6379 0d0a 2020 2020 2020  ccupancy..      
+0000ff00: 2020 656c 6966 2067 726f 7570 203d 3d20    elif group == 
+0000ff10: 3137 3a0d 0a20 2020 2020 2020 2020 2020  17:..           
+0000ff20: 2063 6861 7267 655b 6e5d 203d 202d 3120   charge[n] = -1 
+0000ff30: 2a20 6f63 6375 7061 6e63 790d 0a20 2020  * occupancy..   
+0000ff40: 2020 2020 2065 6c69 6620 6772 6f75 7020       elif group 
+0000ff50: 3d3d 2031 383a 0d0a 2020 2020 2020 2020  == 18:..        
+0000ff60: 2020 2020 6368 6172 6765 5b6e 5d20 3d20      charge[n] = 
+0000ff70: 300d 0a20 2020 2020 2020 2065 6c73 653a  0..        else:
+0000ff80: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
+0000ff90: 6172 6765 5b6e 5d20 3d20 6e70 2e6e 616e  arge[n] = np.nan
+0000ffa0: 0d0a 2020 2020 6966 206c 656e 2863 6861  ..    if len(cha
+0000ffb0: 7267 6529 203d 3d20 313a 0d0a 2020 2020  rge) == 1:..    
+0000ffc0: 2020 2020 7265 7475 726e 2063 6861 7267      return charg
+0000ffd0: 655b 305d 0d0a 2020 2020 7265 7475 726e  e[0]..    return
+0000ffe0: 2063 6861 7267 650d 0a0d 0a0d 0a64 6566   charge......def
+0000fff0: 2062 616c 616e 6365 5f61 746f 6d5f 6368   balance_atom_ch
+00010000: 6172 6765 286c 6973 745f 6f66 5f65 6c65  arge(list_of_ele
+00010010: 6d65 6e74 732c 206f 6363 7570 616e 6379  ments, occupancy
+00010020: 3d4e 6f6e 6529 3a0d 0a20 2020 2022 2222  =None):..    """
+00010030: 0d0a 2020 2020 4465 7465 726d 696e 6520  ..    Determine 
+00010040: 7468 6520 6465 6661 756c 7420 6368 6172  the default char
+00010050: 6765 7320 616e 6420 6173 7369 676e 2072  ges and assign r
+00010060: 656d 6169 6e69 6e67 2063 6861 7267 6520  emaining charge 
+00010070: 746f 0d0a 2020 2020 756e 7370 6563 6966  to..    unspecif
+00010080: 6965 6420 656c 656d 656e 7473 0d0a 2020  ied elements..  
+00010090: 2020 3a70 6172 616d 206c 6973 745f 6f66    :param list_of
+000100a0: 5f65 6c65 6d65 6e74 733a 0d0a 2020 2020  _elements:..    
+000100b0: 3a72 6574 7572 6e3a 205b 6c69 7374 206f  :return: [list o
+000100c0: 6620 6368 6172 6765 735d 0d0a 2020 2020  f charges]..    
+000100d0: 2222 220d 0a0d 0a20 2020 2069 6620 6f63  """....    if oc
+000100e0: 6375 7061 6e63 7920 6973 204e 6f6e 653a  cupancy is None:
+000100f0: 0d0a 2020 2020 2020 2020 6f63 6375 7061  ..        occupa
+00010100: 6e63 7920 3d20 6e70 2e6f 6e65 7328 6c65  ncy = np.ones(le
+00010110: 6e28 6c69 7374 5f6f 665f 656c 656d 656e  n(list_of_elemen
+00010120: 7473 2929 0d0a 2020 2020 656c 7365 3a0d  ts))..    else:.
+00010130: 0a20 2020 2020 2020 206f 6363 7570 616e  .        occupan
+00010140: 6379 203d 206e 702e 6173 6172 7261 7928  cy = np.asarray(
+00010150: 6f63 6375 7061 6e63 7929 0d0a 0d0a 2020  occupancy)....  
+00010160: 2020 6368 6172 6765 203d 206e 702e 7a65    charge = np.ze
+00010170: 726f 7328 6c65 6e28 6c69 7374 5f6f 665f  ros(len(list_of_
+00010180: 656c 656d 656e 7473 2929 0d0a 2020 2020  elements))..    
+00010190: 666f 7220 6e20 696e 2072 616e 6765 286c  for n in range(l
+000101a0: 656e 286c 6973 745f 6f66 5f65 6c65 6d65  en(list_of_eleme
+000101b0: 6e74 7329 293a 0d0a 2020 2020 2020 2020  nts)):..        
+000101c0: 5f2c 206f 6363 2c20 5f20 3d20 7370 6c69  _, occ, _ = spli
+000101d0: 745f 656c 656d 656e 745f 7379 6d62 6f6c  t_element_symbol
+000101e0: 286c 6973 745f 6f66 5f65 6c65 6d65 6e74  (list_of_element
+000101f0: 735b 6e5d 290d 0a20 2020 2020 2020 2063  s[n])..        c
+00010200: 6861 7267 655b 6e5d 203d 206f 6363 7570  harge[n] = occup
+00010210: 616e 6379 5b6e 5d20 2a20 6465 6661 756c  ancy[n] * defaul
+00010220: 745f 6174 6f6d 5f63 6861 7267 6528 6c69  t_atom_charge(li
+00010230: 7374 5f6f 665f 656c 656d 656e 7473 5b6e  st_of_elements[n
+00010240: 5d29 0d0a 2020 2020 2020 2020 6f63 6375  ])..        occu
+00010250: 7061 6e63 795b 6e5d 203d 206f 6363 7570  pancy[n] = occup
+00010260: 616e 6379 5b6e 5d20 2a20 6f63 630d 0a0d  ancy[n] * occ...
+00010270: 0a20 2020 2072 656d 6169 6e69 6e67 5f63  .    remaining_c
+00010280: 6861 7267 6520 3d20 2d6e 702e 6e61 6e73  harge = -np.nans
+00010290: 756d 2863 6861 7267 6529 0d0a 2020 2020  um(charge)..    
+000102a0: 756e 6368 6172 6765 6420 3d20 6e70 2e73  uncharged = np.s
+000102b0: 756d 286f 6363 7570 616e 6379 5b6e 702e  um(occupancy[np.
+000102c0: 6973 6e61 6e28 6368 6172 6765 295d 290d  isnan(charge)]).
+000102d0: 0a20 2020 2066 6f72 206e 2069 6e20 7261  .    for n in ra
+000102e0: 6e67 6528 6c65 6e28 6c69 7374 5f6f 665f  nge(len(list_of_
+000102f0: 656c 656d 656e 7473 2929 3a0d 0a20 2020  elements)):..   
+00010300: 2020 2020 2069 6620 6e70 2e69 736e 616e       if np.isnan
+00010310: 2863 6861 7267 655b 6e5d 293a 0d0a 2020  (charge[n]):..  
+00010320: 2020 2020 2020 2020 2020 6368 6172 6765            charge
+00010330: 5b6e 5d20 3d20 6f63 6375 7061 6e63 795b  [n] = occupancy[
+00010340: 6e5d 202a 2072 656d 6169 6e69 6e67 5f63  n] * remaining_c
+00010350: 6861 7267 6520 2f20 756e 6368 6172 6765  harge / uncharge
+00010360: 640d 0a20 2020 2072 6574 7572 6e20 6368  d..    return ch
+00010370: 6172 6765 0d0a 0d0a 0d0a 6465 6620 6172  arge......def ar
+00010380: 7261 6e67 655f 6174 6f6d 5f6f 7264 6572  range_atom_order
+00010390: 286c 6973 745f 6f66 5f65 6c65 6d65 6e74  (list_of_element
+000103a0: 7329 3a0d 0a20 2020 2022 2222 0d0a 2020  s):..    """..  
+000103b0: 2020 4172 7261 6e67 6520 6120 6c69 7374    Arrange a list
+000103c0: 206f 6620 656c 656d 656e 7473 2069 6e20   of elements in 
+000103d0: 7468 6520 636f 7272 6563 7420 6368 656d  the correct chem
+000103e0: 6963 616c 206f 7264 6572 0d0a 2020 2020  ical order..    
+000103f0: 2020 5b27 4c69 272c 2743 6f27 2c27 4f27    ['Li','Co','O'
+00010400: 5d20 3d20 6172 7261 6e67 655f 6174 6f6d  ] = arrange_atom
+00010410: 5f6f 7264 6572 285b 2743 6f27 2c20 274f  _order(['Co', 'O
+00010420: 272c 2027 4c69 275d 290d 0a20 2020 203a  ', 'Li'])..    :
+00010430: 7061 7261 6d20 6c69 7374 5f6f 665f 656c  param list_of_el
+00010440: 656d 656e 7473 3a20 5b6c 6973 7420 6f66  ements: [list of
+00010450: 2073 7472 5d0d 0a20 2020 203a 7265 7475   str]..    :retu
+00010460: 726e 3a20 5b6c 6973 7420 6f66 2073 7472  rn: [list of str
+00010470: 5d0d 0a20 2020 2022 2222 0d0a 0d0a 2020  ]..    """....  
+00010480: 2020 6c69 7374 5f6f 665f 656c 656d 656e    list_of_elemen
+00010490: 7473 203d 206e 702e 6173 6172 7261 7928  ts = np.asarray(
+000104a0: 6c69 7374 5f6f 665f 656c 656d 656e 7473  list_of_elements
+000104b0: 290d 0a20 2020 2067 726f 7570 203d 2061  )..    group = a
+000104c0: 746f 6d5f 7072 6f70 6572 7469 6573 286c  tom_properties(l
+000104d0: 6973 745f 6f66 5f65 6c65 6d65 6e74 732c  ist_of_elements,
+000104e0: 2027 4772 6f75 7027 290d 0a20 2020 2069   'Group')..    i
+000104f0: 6478 203d 206e 702e 6172 6773 6f72 7428  dx = np.argsort(
+00010500: 6772 6f75 7029 0d0a 2020 2020 7265 7475  group)..    retu
+00010510: 726e 206c 6973 7428 6c69 7374 5f6f 665f  rn list(list_of_
+00010520: 656c 656d 656e 7473 5b69 6478 5d29 0d0a  elements[idx])..
+00010530: 0d0a 0d0a 6465 6620 636f 756e 745f 6174  ....def count_at
+00010540: 6f6d 7328 6c69 7374 5f6f 665f 656c 656d  oms(list_of_elem
+00010550: 656e 7473 2c20 6f63 6375 7061 6e63 793d  ents, occupancy=
+00010560: 4e6f 6e65 2c20 6469 7669 6465 6279 3d31  None, divideby=1
+00010570: 2c20 6c61 7465 783d 4661 6c73 6529 3a0d  , latex=False):.
+00010580: 0a20 2020 2022 2222 0d0a 2020 2020 436f  .    """..    Co
+00010590: 756e 7420 6174 6f6d 7320 696e 2061 206c  unt atoms in a l
+000105a0: 6973 7420 6f66 2065 6c65 6d65 6e74 732c  ist of elements,
+000105b0: 2072 6574 7572 6e69 6e67 2063 6f6e 6465   returning conde
+000105c0: 6e63 6564 206c 6973 7420 6f66 2065 6c65  nced list of ele
+000105d0: 6d65 6e74 730d 0a20 2020 203a 7061 7261  ments..    :para
+000105e0: 6d20 6c69 7374 5f6f 665f 656c 656d 656e  m list_of_elemen
+000105f0: 7473 3a20 6c69 7374 206f 6620 656c 656d  ts: list of elem
+00010600: 656e 7420 7379 6d62 6f6c 730d 0a20 2020  ent symbols..   
+00010610: 203a 7061 7261 6d20 6f63 6375 7061 6e63   :param occupanc
+00010620: 793a 206c 6973 7420 6f66 206f 6363 7570  y: list of occup
+00010630: 616e 6369 6573 206f 6620 6561 6368 2065  ancies of each e
+00010640: 6c65 6d65 6e74 2028 6465 6661 756c 743d  lement (default=
+00010650: 4e6f 6e65 290d 0a20 2020 203a 7061 7261  None)..    :para
+00010660: 6d20 6469 7669 6465 6279 3a20 6469 7669  m divideby: divi
+00010670: 6465 2065 6163 6820 636f 756e 7420 6279  de each count by
+00010680: 2074 6869 7320 2864 6566 6175 6c74 3d31   this (default=1
+00010690: 290d 0a20 2020 203a 7061 7261 6d20 6c61  )..    :param la
+000106a0: 7465 783a 2046 616c 7365 2a2f 5472 7565  tex: False*/True
+000106b0: 0d0a 2020 2020 3a72 6574 7572 6e3a 205b  ..    :return: [
+000106c0: 6c69 7374 206f 6620 7374 725d 0d0a 2020  list of str]..  
+000106d0: 2020 2222 220d 0a0d 0a20 2020 2069 6620    """....    if 
+000106e0: 6f63 6375 7061 6e63 7920 6973 204e 6f6e  occupancy is Non
+000106f0: 653a 0d0a 2020 2020 2020 2020 6f63 6375  e:..        occu
+00010700: 7061 6e63 7920 3d20 6e70 2e6f 6e65 7328  pancy = np.ones(
+00010710: 6c65 6e28 6c69 7374 5f6f 665f 656c 656d  len(list_of_elem
+00010720: 656e 7473 2929 0d0a 0d0a 2020 2020 2320  ents))....    # 
+00010730: 436f 756e 7420 656c 656d 656e 7473 0d0a  Count elements..
+00010740: 2020 2020 6174 7320 3d20 6e70 2e75 6e69      ats = np.uni
+00010750: 7175 6528 6c69 7374 5f6f 665f 656c 656d  que(list_of_elem
+00010760: 656e 7473 290d 0a20 2020 2061 7473 203d  ents)..    ats =
+00010770: 2061 7272 616e 6765 5f61 746f 6d5f 6f72   arrange_atom_or
+00010780: 6465 7228 6174 7329 2020 2320 6172 7261  der(ats)  # arra
+00010790: 6e67 6520 7468 6973 2062 7920 616c 6361  nge this by alca
+000107a0: 6c69 2f54 4d2f 4f0d 0a20 2020 206f 7574  li/TM/O..    out
+000107b0: 7374 7220 3d20 5b5d 0d0a 2020 2020 666f  str = []..    fo
+000107c0: 7220 6120 696e 2061 7473 3a0d 0a20 2020  r a in ats:..   
+000107d0: 2020 2020 2061 746e 6f20 3d20 7375 6d28       atno = sum(
+000107e0: 5b6f 6363 7570 616e 6379 5b6e 5d20 666f  [occupancy[n] fo
+000107f0: 7220 6e2c 2078 2069 6e20 656e 756d 6572  r n, x in enumer
+00010800: 6174 6528 6c69 7374 5f6f 665f 656c 656d  ate(list_of_elem
+00010810: 656e 7473 2920 6966 2078 203d 3d20 615d  ents) if x == a]
+00010820: 2920 2f20 666c 6f61 7428 6469 7669 6465  ) / float(divide
+00010830: 6279 290d 0a20 2020 2020 2020 2069 6620  by)..        if 
+00010840: 6e70 2e61 6273 2861 746e 6f20 2d20 3129  np.abs(atno - 1)
+00010850: 203c 2030 2e30 313a 0d0a 2020 2020 2020   < 0.01:..      
+00010860: 2020 2020 2020 6174 7374 7220 3d20 2727        atstr = ''
+00010870: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00010880: 0a20 2020 2020 2020 2020 2020 2061 7473  .            ats
+00010890: 7472 203d 2027 2530 2e32 6727 2025 2061  tr = '%0.2g' % a
+000108a0: 746e 6f0d 0a20 2020 2020 2020 2020 2020  tno..           
+000108b0: 2069 6620 6c61 7465 783a 0d0a 2020 2020   if latex:..    
+000108c0: 2020 2020 2020 2020 2020 2020 6174 7374              atst
+000108d0: 7220 3d20 2724 5f7b 2573 7d24 2720 2520  r = '$_{%s}$' % 
+000108e0: 6174 7374 720d 0a0d 0a20 2020 2020 2020  atstr....       
+000108f0: 206f 7574 7374 7220 2b3d 205b 2725 7325   outstr += ['%s%
+00010900: 7327 2025 2028 612c 2061 7473 7472 295d  s' % (a, atstr)]
+00010910: 0d0a 2020 2020 7265 7475 726e 206f 7574  ..    return out
+00010920: 7374 720d 0a0d 0a0d 0a64 6566 2063 6f75  str......def cou
+00010930: 6e74 5f63 6861 7267 6573 286c 6973 745f  nt_charges(list_
+00010940: 6f66 5f65 6c65 6d65 6e74 732c 206f 6363  of_elements, occ
+00010950: 7570 616e 6379 3d4e 6f6e 652c 2064 6976  upancy=None, div
+00010960: 6964 6562 793d 312c 206c 6174 6578 3d46  ideby=1, latex=F
+00010970: 616c 7365 293a 0d0a 2020 2020 2222 220d  alse):..    """.
+00010980: 0a20 2020 2043 6f75 6e74 2061 746f 6d73  .    Count atoms
+00010990: 2069 6e20 6120 6c69 7374 206f 6620 656c   in a list of el
+000109a0: 656d 656e 7473 2c20 7265 7475 726e 696e  ements, returnin
+000109b0: 6720 636f 6e64 656e 6365 6420 6c69 7374  g condenced list
+000109c0: 206f 6620 656c 656d 656e 7473 2077 6974   of elements wit
+000109d0: 6820 6368 6172 6765 730d 0a20 2020 203a  h charges..    :
+000109e0: 7061 7261 6d20 6c69 7374 5f6f 665f 656c  param list_of_el
+000109f0: 656d 656e 7473 3a20 6c69 7374 206f 6620  ements: list of 
+00010a00: 656c 656d 656e 7420 7379 6d62 6f6c 730d  element symbols.
+00010a10: 0a20 2020 203a 7061 7261 6d20 6f63 6375  .    :param occu
+00010a20: 7061 6e63 793a 206c 6973 7420 6f66 206f  pancy: list of o
+00010a30: 6363 7570 616e 6369 6573 206f 6620 6561  ccupancies of ea
+00010a40: 6368 2065 6c65 6d65 6e74 2028 6465 6661  ch element (defa
+00010a50: 756c 743d 4e6f 6e65 290d 0a20 2020 203a  ult=None)..    :
+00010a60: 7061 7261 6d20 6469 7669 6465 6279 3a20  param divideby: 
+00010a70: 6469 7669 6465 2065 6163 6820 636f 756e  divide each coun
+00010a80: 7420 6279 2074 6869 7320 2864 6566 6175  t by this (defau
+00010a90: 6c74 3d31 290d 0a20 2020 203a 7061 7261  lt=1)..    :para
+00010aa0: 6d20 6c61 7465 783a 2046 616c 7365 2a2f  m latex: False*/
+00010ab0: 5472 7565 0d0a 2020 2020 3a72 6574 7572  True..    :retur
+00010ac0: 6e3a 205b 6c69 7374 206f 6620 7374 725d  n: [list of str]
+00010ad0: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
+00010ae0: 2069 6620 6f63 6375 7061 6e63 7920 6973   if occupancy is
+00010af0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00010b00: 6f63 6375 7061 6e63 7920 3d20 6e70 2e6f  occupancy = np.o
+00010b10: 6e65 7328 6c65 6e28 6c69 7374 5f6f 665f  nes(len(list_of_
+00010b20: 656c 656d 656e 7473 2929 0d0a 0d0a 2020  elements))....  
+00010b30: 2020 2320 4465 7465 726d 696e 6520 656c    # Determine el
+00010b40: 656d 656e 7420 6368 6172 6765 730d 0a20  ement charges.. 
+00010b50: 2020 2063 6861 7267 6520 3d20 6261 6c61     charge = bala
+00010b60: 6e63 655f 6174 6f6d 5f63 6861 7267 6528  nce_atom_charge(
+00010b70: 6c69 7374 5f6f 665f 656c 656d 656e 7473  list_of_elements
+00010b80: 2c20 6f63 6375 7061 6e63 7929 0d0a 0d0a  , occupancy)....
+00010b90: 2020 2020 2320 436f 756e 7420 656c 656d      # Count elem
+00010ba0: 656e 7473 0d0a 2020 2020 6174 7320 3d20  ents..    ats = 
+00010bb0: 6e70 2e75 6e69 7175 6528 6c69 7374 5f6f  np.unique(list_o
+00010bc0: 665f 656c 656d 656e 7473 290d 0a20 2020  f_elements)..   
+00010bd0: 2061 7473 203d 2061 7272 616e 6765 5f61   ats = arrange_a
+00010be0: 746f 6d5f 6f72 6465 7228 6174 7329 2020  tom_order(ats)  
+00010bf0: 2320 6172 7261 6e67 6520 7468 6973 2062  # arrange this b
+00010c00: 7920 616c 6361 6c69 2f54 4d2f 4f0d 0a20  y alcali/TM/O.. 
+00010c10: 2020 2061 746e 6f20 3d20 7b7d 0d0a 2020     atno = {}..  
+00010c20: 2020 6368 6e6f 203d 207b 7d0d 0a20 2020    chno = {}..   
+00010c30: 2066 6f72 2061 2069 6e20 6174 733a 0d0a   for a in ats:..
+00010c40: 2020 2020 2020 2020 6174 6e6f 5b61 5d20          atno[a] 
+00010c50: 3d20 7375 6d28 5b6f 6363 7570 616e 6379  = sum([occupancy
+00010c60: 5b6e 5d20 666f 7220 6e2c 2078 2069 6e20  [n] for n, x in 
+00010c70: 656e 756d 6572 6174 6528 6c69 7374 5f6f  enumerate(list_o
+00010c80: 665f 656c 656d 656e 7473 2920 6966 2078  f_elements) if x
+00010c90: 203d 3d20 615d 2920 2f20 666c 6f61 7428   == a]) / float(
+00010ca0: 6469 7669 6465 6279 290d 0a20 2020 2020  divideby)..     
+00010cb0: 2020 2063 686e 6f5b 615d 203d 2073 756d     chno[a] = sum
+00010cc0: 285b 6368 6172 6765 5b6e 5d20 666f 7220  ([charge[n] for 
+00010cd0: 6e2c 2078 2069 6e20 656e 756d 6572 6174  n, x in enumerat
+00010ce0: 6528 6c69 7374 5f6f 665f 656c 656d 656e  e(list_of_elemen
+00010cf0: 7473 2920 6966 2078 203d 3d20 615d 2920  ts) if x == a]) 
+00010d00: 2f20 2861 746e 6f5b 615d 202a 2066 6c6f  / (atno[a] * flo
+00010d10: 6174 2864 6976 6964 6562 7929 290d 0a0d  at(divideby))...
+00010d20: 0a20 2020 206f 7574 7374 7220 3d20 5b5d  .    outstr = []
+00010d30: 0d0a 2020 2020 666f 7220 6120 696e 2061  ..    for a in a
+00010d40: 7473 3a0d 0a20 2020 2020 2020 206f 7574  ts:..        out
+00010d50: 7374 7220 2b3d 205b 656c 656d 656e 745f  str += [element_
+00010d60: 6368 6172 6765 5f73 7472 696e 6728 612c  charge_string(a,
+00010d70: 2061 746e 6f5b 615d 2c20 6368 6e6f 5b61   atno[a], chno[a
+00010d80: 5d2c 206c 6174 6578 295d 0d0a 2020 2020  ], latex)]..    
+00010d90: 7265 7475 726e 206f 7574 7374 720d 0a0d  return outstr...
+00010da0: 0a0d 0a64 6566 206d 6f6c 6563 756c 6172  ...def molecular
+00010db0: 5f77 6569 6768 7428 636f 6d70 6f75 6e64  _weight(compound
+00010dc0: 5f6e 616d 6529 3a0d 0a20 2020 2022 2222  _name):..    """
+00010dd0: 0d0a 2020 2020 4361 6c63 756c 6174 6520  ..    Calculate 
+00010de0: 7468 6520 6d6f 6c65 6375 6c61 7220 7765  the molecular we
+00010df0: 6967 6874 206f 6620 6769 7665 6e20 636f  ight of given co
+00010e00: 6d70 6f75 6e64 0d0a 2020 2020 3a70 6172  mpound..    :par
+00010e10: 616d 2063 6f6d 706f 756e 645f 6e61 6d65  am compound_name
+00010e20: 3a20 7374 7220 656c 656d 656e 7473 0d0a  : str elements..
+00010e30: 2020 2020 3a72 6574 7572 6e3a 2066 6c6f      :return: flo
+00010e40: 6174 2077 6569 6768 7420 696e 2067 0d0a  at weight in g..
+00010e50: 2020 2020 2222 220d 0a20 2020 2065 6c5f      """..    el_
+00010e60: 6c69 7374 203d 2073 706c 6974 5f63 6f6d  list = split_com
+00010e70: 706f 756e 6428 636f 6d70 6f75 6e64 5f6e  pound(compound_n
+00010e80: 616d 6529 0d0a 2020 2020 7765 6967 6874  ame)..    weight
+00010e90: 203d 2030 0d0a 2020 2020 666f 7220 656c   = 0..    for el
+00010ea0: 2069 6e20 656c 5f6c 6973 743a 0d0a 2020   in el_list:..  
+00010eb0: 2020 2020 2020 6e61 6d65 2c20 6f63 632c        name, occ,
+00010ec0: 2063 6861 7267 6520 3d20 7370 6c69 745f   charge = split_
+00010ed0: 656c 656d 656e 745f 7379 6d62 6f6c 2865  element_symbol(e
+00010ee0: 6c29 0d0a 2020 2020 2020 2020 7765 6967  l)..        weig
+00010ef0: 6874 202b 3d20 6f63 6320 2a20 6174 6f6d  ht += occ * atom
+00010f00: 5f70 726f 7065 7274 6965 7328 6e61 6d65  _properties(name
+00010f10: 2c20 2757 6569 6768 7427 295b 305d 0d0a  , 'Weight')[0]..
+00010f20: 2020 2020 7265 7475 726e 2077 6569 6768      return weigh
+00010f30: 740d 0a0d 0a0d 0a64 6566 2078 7261 795f  t......def xray_
+00010f40: 6174 7465 6e75 6174 696f 6e5f 6c65 6e67  attenuation_leng
+00010f50: 7468 2865 6c65 6d65 6e74 732c 2065 6e65  th(elements, ene
+00010f60: 7267 795f 6b65 762c 2061 746f 6d5f 7065  rgy_kev, atom_pe
+00010f70: 725f 766f 6c75 6d65 2c20 6772 617a 696e  r_volume, grazin
+00010f80: 675f 616e 676c 653d 3930 293a 0d0a 2020  g_angle=90):..  
+00010f90: 2020 2222 220d 0a20 2020 2043 616c 6375    """..    Calcu
+00010fa0: 616c 7465 2074 6865 2061 7474 656e 7561  alte the attenua
+00010fb0: 7469 6f6e 206c 656e 6774 6820 696e 206d  tion length in m
+00010fc0: 6963 726f 6e73 0d0a 2020 2020 5468 6520  icrons..    The 
+00010fd0: 6465 7074 6820 696e 746f 2074 6865 206d  depth into the m
+00010fe0: 6174 6572 6961 6c20 6d65 6173 7572 6564  aterial measured
+00010ff0: 2061 6c6f 6e67 2074 6865 2073 7572 6661   along the surfa
+00011000: 6365 206e 6f72 6d61 6c20 7768 6572 6520  ce normal where 
+00011010: 7468 6520 696e 7465 6e73 6974 7920 6f66  the intensity of
+00011020: 0d0a 2020 2020 782d 7261 7973 2066 616c  ..    x-rays fal
+00011030: 6c73 2074 6f20 312f 6520 6f66 2069 7473  ls to 1/e of its
+00011040: 2076 616c 7565 2061 7420 7468 6520 7375   value at the su
+00011050: 7266 6163 652e 0d0a 2020 2020 2020 4120  rface...      A 
+00011060: 3d20 7369 6e28 7468 2920 2f20 6e20 2a20  = sin(th) / n * 
+00011070: 6d75 0d0a 2020 2020 3a70 6172 616d 2065  mu..    :param e
+00011080: 6c65 6d65 6e74 733a 2073 7472 206f 7220  lements: str or 
+00011090: 6c69 7374 206f 6620 7374 722c 2069 6620  list of str, if 
+000110a0: 6c69 7374 202d 2061 6273 6f72 7074 696f  list - absorptio
+000110b0: 6e20 7769 6c6c 2062 6520 7375 6d6d 6564  n will be summed
+000110c0: 206f 7665 7220 656c 656d 656e 7473 0d0a   over elements..
+000110d0: 2020 2020 3a70 6172 616d 2065 6e65 7267      :param energ
+000110e0: 795f 6b65 763a 2066 6c6f 6174 2061 7272  y_kev: float arr
+000110f0: 6179 0d0a 2020 2020 3a70 6172 616d 2061  ay..    :param a
+00011100: 746f 6d5f 7065 725f 766f 6c75 6d65 3a20  tom_per_volume: 
+00011110: 666c 6f61 7420 6174 6f6d 7320 7065 7220  float atoms per 
+00011120: 415e 330d 0a20 2020 203a 7061 7261 6d20  A^3..    :param 
+00011130: 6772 617a 696e 675f 616e 676c 653a 2069  grazing_angle: i
+00011140: 6e63 6964 656e 6365 2061 6e67 6c65 2072  ncidence angle r
+00011150: 656c 6174 6976 6520 746f 2074 6865 2073  elative to the s
+00011160: 7572 6661 6365 2c20 696e 2064 6567 7265  urface, in degre
+00011170: 6573 0d0a 2020 2020 3a72 6574 7572 6e3a  es..    :return:
+00011180: 2066 6c6f 6174 206f 7220 6172 7261 7920   float or array 
+00011190: 696e 206d 6963 726f 6e73 0d0a 2020 2020  in microns..    
+000111a0: 2222 220d 0a20 2020 206d 7520 3d20 7068  """..    mu = ph
+000111b0: 6f74 6f61 6273 6f72 7074 696f 6e5f 6372  otoabsorption_cr
+000111c0: 6f73 7373 6563 7469 6f6e 2865 6c65 6d65  osssection(eleme
+000111d0: 6e74 732c 2065 6e65 7267 795f 6b65 7629  nts, energy_kev)
+000111e0: 0d0a 2020 2020 7375 7266 6163 655f 6e6f  ..    surface_no
+000111f0: 726d 616c 203d 206e 702e 7369 6e28 206e  rmal = np.sin( n
+00011200: 702e 6465 6732 7261 6428 6772 617a 696e  p.deg2rad(grazin
+00011210: 675f 616e 676c 6529 290d 0a20 2020 2072  g_angle))..    r
+00011220: 6574 7572 6e20 7375 7266 6163 655f 6e6f  eturn surface_no
+00011230: 726d 616c 202a 2031 6536 202f 2028 3165  rmal * 1e6 / (1e
+00011240: 3330 202a 2061 746f 6d5f 7065 725f 766f  30 * atom_per_vo
+00011250: 6c75 6d65 202a 206d 7529 0d0a 0d0a 0d0a  lume * mu)......
+00011260: 6465 6620 7872 6179 5f74 7261 6e73 6d69  def xray_transmi
+00011270: 7373 696f 6e28 656c 656d 656e 7473 2c20  ssion(elements, 
+00011280: 656e 6572 6779 5f6b 6576 2c20 6174 6f6d  energy_kev, atom
+00011290: 5f70 6572 5f76 6f6c 756d 652c 2064 6973  _per_volume, dis
+000112a0: 7461 6e63 655f 756d 293a 0d0a 2020 2020  tance_um):..    
+000112b0: 2222 220d 0a20 2020 2043 616c 6375 6c61  """..    Calcula
+000112c0: 7465 2074 6865 2074 7261 6e73 696d 7373  te the transimss
+000112d0: 696f 6e20 6f66 2078 2d72 6179 7320 7468  ion of x-rays th
+000112e0: 726f 7567 6820 6120 7468 6963 6b20 736c  rough a thick sl
+000112f0: 6162 0d0a 2020 2020 2020 542f 5430 203d  ab..      T/T0 =
+00011300: 2065 7870 282d 6e2a 6d75 2a64 290d 0a20   exp(-n*mu*d).. 
+00011310: 2020 203a 7061 7261 6d20 656c 656d 656e     :param elemen
+00011320: 7473 3a20 7374 7220 6f72 206c 6973 7420  ts: str or list 
+00011330: 6f66 2073 7472 2c20 6966 206c 6973 7420  of str, if list 
+00011340: 2d20 6162 736f 7270 7469 6f6e 2077 696c  - absorption wil
+00011350: 6c20 6265 2073 756d 6d65 6420 6f76 6572  l be summed over
+00011360: 2065 6c65 6d65 6e74 730d 0a20 2020 203a   elements..    :
+00011370: 7061 7261 6d20 656e 6572 6779 5f6b 6576  param energy_kev
+00011380: 3a20 666c 6f61 7420 6172 7261 790d 0a20  : float array.. 
+00011390: 2020 203a 7061 7261 6d20 6174 6f6d 5f70     :param atom_p
+000113a0: 6572 5f76 6f6c 756d 653a 2066 6c6f 6174  er_volume: float
+000113b0: 2061 746f 6d73 2070 6572 2041 5e33 0d0a   atoms per A^3..
+000113c0: 2020 2020 3a70 6172 616d 2064 6973 7461      :param dista
+000113d0: 6e63 655f 756d 3a20 666c 6f61 7420 6469  nce_um: float di
+000113e0: 7374 616e 6365 2069 6e20 6d69 6372 6f6e  stance in micron
+000113f0: 730d 0a20 2020 203a 7265 7475 726e 3a20  s..    :return: 
+00011400: 666c 6f61 7420 6f72 2061 7272 6179 0d0a  float or array..
+00011410: 2020 2020 2222 220d 0a20 2020 206d 7520      """..    mu 
+00011420: 3d20 7068 6f74 6f61 6273 6f72 7074 696f  = photoabsorptio
+00011430: 6e5f 6372 6f73 7373 6563 7469 6f6e 2865  n_crosssection(e
+00011440: 6c65 6d65 6e74 732c 2065 6e65 7267 795f  lements, energy_
+00011450: 6b65 7629 2020 2320 666c 6f61 742c 206f  kev)  # float, o
+00011460: 7220 5b65 6e65 5d0d 0a20 2020 2072 6574  r [ene]..    ret
+00011470: 7572 6e20 6e70 2e65 7870 282d 6174 6f6d  urn np.exp(-atom
+00011480: 5f70 6572 5f76 6f6c 756d 6520 2a20 3165  _per_volume * 1e
+00011490: 3330 202a 206d 7520 2a20 6469 7374 616e  30 * mu * distan
+000114a0: 6365 5f75 6d20 2a20 3165 2d36 290d 0a0d  ce_um * 1e-6)...
+000114b0: 0a0d 0a64 6566 2078 7261 795f 7265 6672  ...def xray_refr
+000114c0: 6163 7469 7665 5f69 6e64 6578 2865 6c65  active_index(ele
+000114d0: 6d65 6e74 732c 2065 6e65 7267 795f 6b65  ments, energy_ke
+000114e0: 762c 2061 746f 6d5f 7065 725f 766f 6c75  v, atom_per_volu
+000114f0: 6d65 293a 0d0a 2020 2020 2222 220d 0a20  me):..    """.. 
+00011500: 2020 2043 616c 6375 6c61 7465 2074 6865     Calculate the
+00011510: 2063 6f6d 706c 6578 2069 6e64 6578 206f   complex index o
+00011520: 6620 7265 6672 6163 7469 6f6e 206f 6620  f refraction of 
+00011530: 6120 6d61 7465 7269 616c 0d0a 2020 2020  a material..    
+00011540: 2020 6e20 3d20 3120 2d20 2831 2f32 7069    n = 1 - (1/2pi
+00011550: 294e 2a72 302a 6c61 6d62 6461 5e32 2a28  )N*r0*lambda^2*(
+00011560: 6631 2b69 6632 2920 3d20 3120 2d20 4465  f1+if2) = 1 - De
+00011570: 6c74 6120 2d20 6942 6574 610d 0a20 2020  lta - iBeta..   
+00011580: 203a 7061 7261 6d20 656c 656d 656e 7473   :param elements
+00011590: 3a20 7374 7220 6f72 206c 6973 7420 6f66  : str or list of
+000115a0: 2073 7472 2c20 6966 206c 6973 7420 6174   str, if list at
+000115b0: 6f6d 6963 2073 6361 7474 6572 696e 6720  omic scattering 
+000115c0: 6661 6374 6f72 7320 7769 6c6c 2062 6520  factors will be 
+000115d0: 7375 6d6d 6564 206f 7665 7220 656c 656d  summed over elem
+000115e0: 656e 7473 0d0a 2020 2020 3a70 6172 616d  ents..    :param
+000115f0: 2065 6e65 7267 795f 6b65 763a 2066 6c6f   energy_kev: flo
+00011600: 6174 2061 7272 6179 0d0a 2020 2020 3a70  at array..    :p
+00011610: 6172 616d 2061 746f 6d5f 7065 725f 766f  aram atom_per_vo
+00011620: 6c75 6d65 3a20 666c 6f61 7420 6174 6f6d  lume: float atom
+00011630: 7320 7065 7220 415e 330d 0a20 2020 203a  s per A^3..    :
+00011640: 7265 7475 726e 3a20 636f 6d70 6c65 7820  return: complex 
+00011650: 666c 6f61 7420 6f72 2061 7272 6179 0d0a  float or array..
+00011660: 2020 2020 2222 220d 0a20 2020 2066 312c      """..    f1,
+00011670: 2066 3220 3d20 6174 6f6d 6963 5f73 6361   f2 = atomic_sca
+00011680: 7474 6572 696e 675f 6661 6374 6f72 2865  ttering_factor(e
+00011690: 6c65 6d65 6e74 732c 2065 6e65 7267 795f  lements, energy_
+000116a0: 6b65 7629 0d0a 2020 2020 6674 203d 2066  kev)..    ft = f
+000116b0: 3120 2b20 316a 202a 2066 320d 0a20 2020  1 + 1j * f2..   
+000116c0: 2066 7420 3d20 6674 2e72 6573 6861 7065   ft = ft.reshape
+000116d0: 286e 702e 7369 7a65 2865 6c65 6d65 6e74  (np.size(element
+000116e0: 7329 2c20 6e70 2e73 697a 6528 656e 6572  s), np.size(ener
+000116f0: 6779 5f6b 6576 2929 2e73 756d 2861 7869  gy_kev)).sum(axi
+00011700: 733d 3029 2020 2320 7375 6d20 6f76 6572  s=0)  # sum over
+00011710: 2065 6c65 6d65 6e74 730d 0a20 2020 2061   elements..    a
+00011720: 746f 6d5f 7065 725f 766f 6c75 6d65 203d  tom_per_volume =
+00011730: 2061 746f 6d5f 7065 725f 766f 6c75 6d65   atom_per_volume
+00011740: 202a 2031 6533 3020 2023 2061 746f 6d20   * 1e30  # atom 
+00011750: 7065 7220 6d5e 330d 0a20 2020 2077 6176  per m^3..    wav
+00011760: 656c 656e 6774 6820 3d20 656e 6572 6779  elength = energy
+00011770: 3277 6176 6528 656e 6572 6779 5f6b 6576  2wave(energy_kev
+00011780: 2920 2a20 3165 2d31 3020 2023 206d 0d0a  ) * 1e-10  # m..
+00011790: 2020 2020 7265 7475 726e 2031 202d 2028      return 1 - (
+000117a0: 6674 202a 2066 672e 7230 202a 2061 746f  ft * fg.r0 * ato
+000117b0: 6d5f 7065 725f 766f 6c75 6d65 202a 2077  m_per_volume * w
+000117c0: 6176 656c 656e 6774 682a 2a32 202f 2028  avelength**2 / (
+000117d0: 3220 2a20 6667 2e70 6929 290d 0a0d 0a0d  2 * fg.pi)).....
+000117e0: 0a64 6566 2078 7261 795f 7265 666c 6563  .def xray_reflec
+000117f0: 7469 7669 7479 2865 6c65 6d65 6e74 732c  tivity(elements,
+00011800: 2065 6e65 7267 795f 6b65 762c 2061 746f   energy_kev, ato
+00011810: 6d5f 7065 725f 766f 6c75 6d65 2c20 6772  m_per_volume, gr
+00011820: 617a 696e 675f 616e 676c 6529 3a0d 0a20  azing_angle):.. 
+00011830: 2020 2022 2222 0d0a 2020 2020 4361 6c63     """..    Calc
+00011840: 756c 6174 6520 7468 6520 7370 6563 756c  ulate the specul
+00011850: 6172 2072 6566 6c65 6374 6976 6974 7920  ar reflectivity 
+00011860: 6f66 2061 206d 6174 6572 6961 6c0d 0a20  of a material.. 
+00011870: 2020 2046 726f 6d3a 2068 7474 7073 3a2f     From: https:/
+00011880: 2f78 6462 2e6c 626c 2e67 6f76 2f53 6563  /xdb.lbl.gov/Sec
+00011890: 7469 6f6e 342f 5365 635f 342d 322e 6874  tion4/Sec_4-2.ht
+000118a0: 6d6c 0d0a 2020 2020 3a70 6172 616d 2065  ml..    :param e
+000118b0: 6c65 6d65 6e74 733a 2073 7472 206f 7220  lements: str or 
+000118c0: 6c69 7374 206f 6620 7374 722c 2069 6620  list of str, if 
+000118d0: 6c69 7374 202d 2061 6273 6f72 7074 696f  list - absorptio
+000118e0: 6e20 7769 6c6c 2062 6520 7375 6d6d 6564  n will be summed
+000118f0: 206f 7665 7220 656c 656d 656e 7473 0d0a   over elements..
+00011900: 2020 2020 3a70 6172 616d 2065 6e65 7267      :param energ
+00011910: 795f 6b65 763a 2066 6c6f 6174 2061 7272  y_kev: float arr
+00011920: 6179 0d0a 2020 2020 3a70 6172 616d 2061  ay..    :param a
+00011930: 746f 6d5f 7065 725f 766f 6c75 6d65 3a20  tom_per_volume: 
+00011940: 666c 6f61 7420 6174 6f6d 7320 7065 7220  float atoms per 
+00011950: 415e 330d 0a20 2020 203a 7061 7261 6d20  A^3..    :param 
+00011960: 6772 617a 696e 675f 616e 676c 653a 2069  grazing_angle: i
+00011970: 6e63 6964 656e 6365 2061 6e67 6c65 2072  ncidence angle r
+00011980: 656c 6174 6976 6520 746f 2074 6865 2073  elative to the s
+00011990: 7572 6661 6365 2c20 696e 2064 6567 7265  urface, in degre
+000119a0: 6573 0d0a 2020 2020 3a72 6574 7572 6e3a  es..    :return:
+000119b0: 2066 6c6f 6174 206f 7220 6172 7261 790d   float or array.
+000119c0: 0a20 2020 2022 2222 0d0a 2020 2020 7761  .    """..    wa
+000119d0: 7665 6c65 6e67 7468 203d 2065 6e65 7267  velength = energ
+000119e0: 7932 7761 7665 2865 6e65 7267 795f 6b65  y2wave(energy_ke
+000119f0: 7629 0d0a 2020 2020 7265 6669 6e64 6578  v)..    refindex
+00011a00: 203d 2078 7261 795f 7265 6672 6163 7469   = xray_refracti
+00011a10: 7665 5f69 6e64 6578 2865 6c65 6d65 6e74  ve_index(element
+00011a20: 732c 2065 6e65 7267 795f 6b65 762c 2061  s, energy_kev, a
+00011a30: 746f 6d5f 7065 725f 766f 6c75 6d65 290d  tom_per_volume).
+00011a40: 0a20 2020 2070 696c 616d 6264 6120 3d20  .    pilambda = 
+00011a50: 3220 2a20 6667 2e70 6920 2f20 7761 7665  2 * fg.pi / wave
+00011a60: 6c65 6e67 7468 0d0a 2020 2020 616e 676c  length..    angl
+00011a70: 655f 7261 6420 3d20 6e70 2e64 6567 3272  e_rad = np.deg2r
+00011a80: 6164 2867 7261 7a69 6e67 5f61 6e67 6c65  ad(grazing_angle
+00011a90: 290d 0a20 2020 206b 6920 3d20 7069 6c61  )..    ki = pila
+00011aa0: 6d62 6461 202a 206e 702e 7369 6e28 616e  mbda * np.sin(an
+00011ab0: 676c 655f 7261 6429 0d0a 2020 2020 6b74  gle_rad)..    kt
+00011ac0: 203d 2070 696c 616d 6264 6120 2a20 6e70   = pilambda * np
+00011ad0: 2e73 7172 7428 7265 6669 6e64 6578 2a2a  .sqrt(refindex**
+00011ae0: 3220 2d20 6e70 2e63 6f73 2861 6e67 6c65  2 - np.cos(angle
+00011af0: 5f72 6164 292a 2a32 290d 0a20 2020 2072  _rad)**2)..    r
+00011b00: 203d 2028 6b69 202d 206b 7429 2f28 6b69   = (ki - kt)/(ki
+00011b10: 202b 206b 7429 0d0a 2020 2020 7265 7475   + kt)..    retu
+00011b20: 726e 206e 702e 7265 616c 286e 702e 6d75  rn np.real(np.mu
+00011b30: 6c74 6970 6c79 2872 2c20 6e70 2e63 6f6e  ltiply(r, np.con
+00011b40: 6a28 7229 2929 0d0a 0d0a 0d0a 6465 6620  j(r)))......def 
+00011b50: 7872 6179 5f68 6172 6d6f 6e69 635f 7265  xray_harmonic_re
+00011b60: 6a65 6374 696f 6e28 656c 656d 656e 7473  jection(elements
+00011b70: 2c20 656e 6572 6779 5f6b 6576 2c20 6174  , energy_kev, at
+00011b80: 6f6d 5f70 6572 5f76 6f6c 756d 652c 2067  om_per_volume, g
+00011b90: 7261 7a69 6e67 5f61 6e67 6c65 2c20 6861  razing_angle, ha
+00011ba0: 726d 6f6e 6963 3d32 293a 0d0a 2020 2020  rmonic=2):..    
+00011bb0: 2222 220d 0a20 2020 2043 616c 6375 6c61  """..    Calcula
+00011bc0: 7465 2074 6865 2073 7065 6375 6c61 7220  te the specular 
+00011bd0: 7265 666c 6563 7469 7669 7479 206f 6620  reflectivity of 
+00011be0: 6120 6d61 7465 7269 616c 0d0a 2020 2020  a material..    
+00011bf0: 4672 6f6d 3a20 6874 7470 733a 2f2f 7864  From: https://xd
+00011c00: 622e 6c62 6c2e 676f 762f 5365 6374 696f  b.lbl.gov/Sectio
+00011c10: 6e34 2f53 6563 5f34 2d32 2e68 746d 6c0d  n4/Sec_4-2.html.
+00011c20: 0a20 2020 203a 7061 7261 6d20 656c 656d  .    :param elem
+00011c30: 656e 7473 3a20 7374 7220 6f72 206c 6973  ents: str or lis
+00011c40: 7420 6f66 2073 7472 2c20 6966 206c 6973  t of str, if lis
+00011c50: 7420 2d20 6162 736f 7270 7469 6f6e 2077  t - absorption w
+00011c60: 696c 6c20 6265 2073 756d 6d65 6420 6f76  ill be summed ov
+00011c70: 6572 2065 6c65 6d65 6e74 730d 0a20 2020  er elements..   
+00011c80: 203a 7061 7261 6d20 656e 6572 6779 5f6b   :param energy_k
+00011c90: 6576 3a20 666c 6f61 7420 6172 7261 790d  ev: float array.
+00011ca0: 0a20 2020 203a 7061 7261 6d20 6174 6f6d  .    :param atom
+00011cb0: 5f70 6572 5f76 6f6c 756d 653a 2066 6c6f  _per_volume: flo
+00011cc0: 6174 2061 746f 6d73 2070 6572 2041 5e33  at atoms per A^3
+00011cd0: 0d0a 2020 2020 3a70 6172 616d 2067 7261  ..    :param gra
+00011ce0: 7a69 6e67 5f61 6e67 6c65 3a20 696e 6369  zing_angle: inci
+00011cf0: 6465 6e63 6520 616e 676c 6520 7265 6c61  dence angle rela
+00011d00: 7469 7665 2074 6f20 7468 6520 7375 7266  tive to the surf
+00011d10: 6163 652c 2069 6e20 6465 6772 6565 730d  ace, in degrees.
+00011d20: 0a20 2020 203a 7061 7261 6d20 6861 726d  .    :param harm
+00011d30: 6f6e 6963 3a20 696e 7420 6861 726d 6f6e  onic: int harmon
+00011d40: 6963 206d 756c 7469 706c 650d 0a20 2020  ic multiple..   
+00011d50: 203a 7265 7475 726e 3a20 666c 6f61 7420   :return: float 
+00011d60: 6f72 2061 7272 6179 0d0a 2020 2020 2222  or array..    ""
+00011d70: 220d 0a20 2020 2070 7269 6d61 7279 5f72  "..    primary_r
+00011d80: 203d 2078 7261 795f 7265 666c 6563 7469   = xray_reflecti
+00011d90: 7669 7479 2865 6c65 6d65 6e74 732c 2065  vity(elements, e
+00011da0: 6e65 7267 795f 6b65 762c 2061 746f 6d5f  nergy_kev, atom_
+00011db0: 7065 725f 766f 6c75 6d65 2c20 6772 617a  per_volume, graz
+00011dc0: 696e 675f 616e 676c 6529 0d0a 2020 2020  ing_angle)..    
+00011dd0: 6861 726d 6f6e 6963 5f72 203d 2078 7261  harmonic_r = xra
+00011de0: 795f 7265 666c 6563 7469 7669 7479 2865  y_reflectivity(e
+00011df0: 6c65 6d65 6e74 732c 206e 702e 6d75 6c74  lements, np.mult
+00011e00: 6970 6c79 2865 6e65 7267 795f 6b65 762c  iply(energy_kev,
+00011e10: 2068 6172 6d6f 6e69 6329 2c20 6174 6f6d   harmonic), atom
+00011e20: 5f70 6572 5f76 6f6c 756d 652c 2067 7261  _per_volume, gra
+00011e30: 7a69 6e67 5f61 6e67 6c65 290d 0a20 2020  zing_angle)..   
+00011e40: 2072 6574 7572 6e20 6e70 2e64 6976 6964   return np.divid
+00011e50: 6528 6861 726d 6f6e 6963 5f72 2c20 7072  e(harmonic_r, pr
+00011e60: 696d 6172 795f 7229 0d0a 0d0a 0d0a 6465  imary_r)......de
+00011e70: 6620 6d6f 6c65 6375 6c61 725f 6174 7465  f molecular_atte
+00011e80: 6e75 6174 696f 6e5f 6c65 6e67 7468 2863  nuation_length(c
+00011e90: 6865 6d69 6361 6c5f 666f 726d 756c 612c  hemical_formula,
+00011ea0: 2065 6e65 7267 795f 6b65 762c 2064 656e   energy_kev, den
+00011eb0: 7369 7479 2c20 6772 617a 696e 675f 616e  sity, grazing_an
+00011ec0: 676c 653d 3930 293a 0d0a 2020 2020 2222  gle=90):..    ""
+00011ed0: 220d 0a20 2020 2043 616c 6375 616c 7465  "..    Calcualte
+00011ee0: 2058 2d52 6179 2041 7474 656e 7561 7469   X-Ray Attenuati
+00011ef0: 6f6e 204c 656e 6774 680d 0a20 2020 2045  on Length..    E
+00011f00: 7175 6976 616c 656e 7420 746f 3a20 6874  quivalent to: ht
+00011f10: 7470 733a 2f2f 6865 6e6b 652e 6c62 6c2e  tps://henke.lbl.
+00011f20: 676f 762f 6f70 7469 6361 6c5f 636f 6e73  gov/optical_cons
+00011f30: 7461 6e74 732f 6174 7465 6e32 2e68 746d  tants/atten2.htm
+00011f40: 6c0d 0a20 2020 2042 6173 6564 206f 6e20  l..    Based on 
+00011f50: 666f 726d 756c 6173 2066 726f 6d3a 2048  formulas from: H
+00011f60: 656e 6b65 2c20 4775 6c6c 696b 736f 6e2c  enke, Gullikson,
+00011f70: 2061 6e64 2044 6176 6973 2c20 4174 6f6d   and Davis, Atom
+00011f80: 6963 2044 6174 6120 616e 6420 4e75 636c  ic Data and Nucl
+00011f90: 6561 7220 4461 7461 2054 6162 6c65 7320  ear Data Tables 
+00011fa0: 3534 206e 6f2e 322c 2031 3831 2d33 3432  54 no.2, 181-342
+00011fb0: 2028 4a75 6c79 2031 3939 3329 0d0a 2020   (July 1993)..  
+00011fc0: 2020 3a70 6172 616d 2063 6865 6d69 6361    :param chemica
+00011fd0: 6c5f 666f 726d 756c 613a 2073 7472 206d  l_formula: str m
+00011fe0: 6f6c 6563 756c 6172 2066 6f72 6d75 6c61  olecular formula
+00011ff0: 0d0a 2020 2020 3a70 6172 616d 2065 6e65  ..    :param ene
+00012000: 7267 795f 6b65 763a 2066 6c6f 6174 206f  rgy_kev: float o
+00012010: 7220 6172 7261 792c 2078 2d72 6179 2065  r array, x-ray e
+00012020: 6e65 7267 7920 696e 206b 6556 0d0a 2020  nergy in keV..  
+00012030: 2020 3a70 6172 616d 2064 656e 7369 7479    :param density
+00012040: 3a20 666c 6f61 7420 6465 6e73 6974 7920  : float density 
+00012050: 696e 2067 2f63 6d5e 330d 0a20 2020 203a  in g/cm^3..    :
+00012060: 7061 7261 6d20 6772 617a 696e 675f 616e  param grazing_an
+00012070: 676c 653a 2069 6e63 6964 656e 6365 2061  gle: incidence a
+00012080: 6e67 6c65 2072 656c 6174 6976 6520 746f  ngle relative to
+00012090: 2074 6865 2073 7572 6661 6365 2c20 696e   the surface, in
+000120a0: 2064 6567 7265 6573 0d0a 2020 2020 3a72   degrees..    :r
+000120b0: 6574 7572 6e3a 2066 6c6f 6174 206f 7220  eturn: float or 
+000120c0: 6172 7261 792c 2069 6e20 6d69 6372 6f6e  array, in micron
+000120d0: 730d 0a20 2020 2022 2222 0d0a 2020 2020  s..    """..    
+000120e0: 656c 656d 656e 7473 203d 2073 706c 6974  elements = split
+000120f0: 5f63 6f6d 706f 756e 6428 6368 656d 6963  _compound(chemic
+00012100: 616c 5f66 6f72 6d75 6c61 290d 0a20 2020  al_formula)..   
+00012110: 2077 6569 6768 7420 3d20 6d6f 6c65 6375   weight = molecu
+00012120: 6c61 725f 7765 6967 6874 2863 6865 6d69  lar_weight(chemi
+00012130: 6361 6c5f 666f 726d 756c 6129 0d0a 2020  cal_formula)..  
+00012140: 2020 6174 6f6d 5f70 6572 5f76 6f6c 756d    atom_per_volum
+00012150: 6520 3d20 3165 2d32 3420 2a20 6465 6e73  e = 1e-24 * dens
+00012160: 6974 7920 2a20 6667 2e4e 6120 2f20 7765  ity * fg.Na / we
+00012170: 6967 6874 2020 2320 6174 6f6d 7320 7065  ight  # atoms pe
+00012180: 7220 415e 330d 0a20 2020 2072 6574 7572  r A^3..    retur
+00012190: 6e20 7872 6179 5f61 7474 656e 7561 7469  n xray_attenuati
+000121a0: 6f6e 5f6c 656e 6774 6828 656c 656d 656e  on_length(elemen
+000121b0: 7473 2c20 656e 6572 6779 5f6b 6576 2c20  ts, energy_kev, 
+000121c0: 6174 6f6d 5f70 6572 5f76 6f6c 756d 652c  atom_per_volume,
+000121d0: 2067 7261 7a69 6e67 5f61 6e67 6c65 290d   grazing_angle).
+000121e0: 0a0d 0a0d 0a64 6566 206d 6f6c 6563 756c  .....def molecul
+000121f0: 6172 5f72 6566 7261 6374 6976 655f 696e  ar_refractive_in
+00012200: 6465 7828 6368 656d 6963 616c 5f66 6f72  dex(chemical_for
+00012210: 6d75 6c61 2c20 656e 6572 6779 5f6b 6576  mula, energy_kev
+00012220: 2c20 6465 6e73 6974 7929 3a0d 0a20 2020  , density):..   
+00012230: 2022 2222 0d0a 2020 2020 4361 6c63 756c   """..    Calcul
+00012240: 6174 6520 436f 6d70 6c65 7820 496e 6465  ate Complex Inde
+00012250: 7820 6f66 2052 6566 7261 6374 696f 6e0d  x of Refraction.
+00012260: 0a20 2020 2020 2020 206e 203d 2031 202d  .        n = 1 -
+00012270: 2028 312f 3270 6929 4e2a 7230 2a6c 616d   (1/2pi)N*r0*lam
+00012280: 6264 615e 322a 2866 312b 6966 3229 203d  bda^2*(f1+if2) =
+00012290: 2031 202d 2044 656c 7461 202d 2069 4265   1 - Delta - iBe
+000122a0: 7461 0d0a 2020 2020 4571 7569 7661 6c65  ta..    Equivale
+000122b0: 6e74 2074 6f3a 2068 7474 7073 3a2f 2f68  nt to: https://h
+000122c0: 656e 6b65 2e6c 626c 2e67 6f76 2f6f 7074  enke.lbl.gov/opt
+000122d0: 6963 616c 5f63 6f6e 7374 616e 7473 2f67  ical_constants/g
+000122e0: 6574 6462 322e 6874 6d6c 0d0a 2020 2020  etdb2.html..    
+000122f0: 4261 7365 6420 6f6e 2066 6f72 6d75 6c61  Based on formula
+00012300: 7320 6672 6f6d 3a20 4865 6e6b 652c 2047  s from: Henke, G
+00012310: 756c 6c69 6b73 6f6e 2c20 616e 6420 4461  ullikson, and Da
+00012320: 7669 732c 2041 746f 6d69 6320 4461 7461  vis, Atomic Data
+00012330: 2061 6e64 204e 7563 6c65 6172 2044 6174   and Nuclear Dat
+00012340: 6120 5461 626c 6573 2035 3420 6e6f 2e32  a Tables 54 no.2
+00012350: 2c20 3138 312d 3334 3220 284a 756c 7920  , 181-342 (July 
+00012360: 3139 3933 290d 0a20 2020 203a 7061 7261  1993)..    :para
+00012370: 6d20 6368 656d 6963 616c 5f66 6f72 6d75  m chemical_formu
+00012380: 6c61 3a20 7374 7220 6d6f 6c65 6375 6c61  la: str molecula
+00012390: 7220 666f 726d 756c 610d 0a20 2020 203a  r formula..    :
+000123a0: 7061 7261 6d20 656e 6572 6779 5f6b 6576  param energy_kev
+000123b0: 3a20 666c 6f61 7420 6f72 2061 7272 6179  : float or array
+000123c0: 2c20 782d 7261 7920 656e 6572 6779 2069  , x-ray energy i
+000123d0: 6e20 6b65 560d 0a20 2020 203a 7061 7261  n keV..    :para
+000123e0: 6d20 6465 6e73 6974 793a 2066 6c6f 6174  m density: float
+000123f0: 2064 656e 7369 7479 2069 6e20 672f 636d   density in g/cm
+00012400: 5e33 0d0a 2020 2020 3a72 6574 7572 6e3a  ^3..    :return:
+00012410: 206e 2863 6f6d 706c 6578 292c 2044 656c   n(complex), Del
+00012420: 7461 2c20 4265 7461 0d0a 2020 2020 2222  ta, Beta..    ""
+00012430: 220d 0a20 2020 2065 6c65 6d65 6e74 7320  "..    elements 
+00012440: 3d20 7370 6c69 745f 636f 6d70 6f75 6e64  = split_compound
+00012450: 2863 6865 6d69 6361 6c5f 666f 726d 756c  (chemical_formul
+00012460: 6129 0d0a 2020 2020 7765 6967 6874 203d  a)..    weight =
+00012470: 206d 6f6c 6563 756c 6172 5f77 6569 6768   molecular_weigh
+00012480: 7428 6368 656d 6963 616c 5f66 6f72 6d75  t(chemical_formu
+00012490: 6c61 290d 0a20 2020 2061 746f 6d5f 7065  la)..    atom_pe
+000124a0: 725f 766f 6c75 6d65 203d 2031 652d 3234  r_volume = 1e-24
+000124b0: 202a 2064 656e 7369 7479 202a 2066 672e   * density * fg.
+000124c0: 4e61 202f 2077 6569 6768 7420 2023 2061  Na / weight  # a
+000124d0: 746f 6d73 2070 6572 2041 5e33 0d0a 2020  toms per A^3..  
+000124e0: 2020 6e20 3d20 7872 6179 5f72 6566 7261    n = xray_refra
+000124f0: 6374 6976 655f 696e 6465 7828 656c 656d  ctive_index(elem
+00012500: 656e 7473 2c20 656e 6572 6779 5f6b 6576  ents, energy_kev
+00012510: 2c20 6174 6f6d 5f70 6572 5f76 6f6c 756d  , atom_per_volum
+00012520: 6529 0d0a 2020 2020 6465 6c74 6120 3d20  e)..    delta = 
+00012530: 3120 2d20 6e70 2e72 6561 6c28 6e29 0d0a  1 - np.real(n)..
+00012540: 2020 2020 6265 7461 203d 202d 6e70 2e69      beta = -np.i
+00012550: 6d61 6728 6e29 0d0a 2020 2020 7265 7475  mag(n)..    retu
+00012560: 726e 206e 2c20 6465 6c74 612c 2062 6574  rn n, delta, bet
+00012570: 610d 0a0d 0a0d 0a64 6566 206d 6f6c 6563  a......def molec
+00012580: 756c 6172 5f72 6566 6c65 6374 6976 6974  ular_reflectivit
+00012590: 7928 6368 656d 6963 616c 5f66 6f72 6d75  y(chemical_formu
+000125a0: 6c61 2c20 656e 6572 6779 5f6b 6576 2c20  la, energy_kev, 
+000125b0: 6465 6e73 6974 792c 2067 7261 7a69 6e67  density, grazing
+000125c0: 5f61 6e67 6c65 293a 0d0a 2020 2020 2222  _angle):..    ""
+000125d0: 220d 0a20 2020 2043 616c 6375 6c61 7465  "..    Calculate
+000125e0: 2074 6865 2073 7065 6375 6c61 7220 7265   the specular re
+000125f0: 666c 6563 7469 7669 7479 206f 6620 6120  flectivity of a 
+00012600: 6d61 7465 7269 616c 0d0a 2020 2020 4672  material..    Fr
+00012610: 6f6d 3a20 6874 7470 733a 2f2f 7864 622e  om: https://xdb.
+00012620: 6c62 6c2e 676f 762f 5365 6374 696f 6e34  lbl.gov/Section4
+00012630: 2f53 6563 5f34 2d32 2e68 746d 6c0d 0a20  /Sec_4-2.html.. 
+00012640: 2020 203a 7061 7261 6d20 6368 656d 6963     :param chemic
+00012650: 616c 5f66 6f72 6d75 6c61 3a20 7374 7220  al_formula: str 
+00012660: 6d6f 6c65 6375 6c61 7220 666f 726d 756c  molecular formul
+00012670: 610d 0a20 2020 203a 7061 7261 6d20 656e  a..    :param en
+00012680: 6572 6779 5f6b 6576 3a20 666c 6f61 7420  ergy_kev: float 
+00012690: 6f72 2061 7272 6179 2c20 782d 7261 7920  or array, x-ray 
+000126a0: 656e 6572 6779 2069 6e20 6b65 560d 0a20  energy in keV.. 
+000126b0: 2020 203a 7061 7261 6d20 6465 6e73 6974     :param densit
+000126c0: 793a 2066 6c6f 6174 2c20 6465 6e73 6974  y: float, densit
+000126d0: 7920 696e 2067 2f63 6d5e 330d 0a20 2020  y in g/cm^3..   
+000126e0: 203a 7061 7261 6d20 6772 617a 696e 675f   :param grazing_
+000126f0: 616e 676c 653a 2066 6c6f 6174 2c20 696e  angle: float, in
+00012700: 6369 6465 6e63 6520 616e 676c 6520 7265  cidence angle re
+00012710: 6c61 7469 7665 2074 6f20 7468 6520 7375  lative to the su
+00012720: 7266 6163 652c 2069 6e20 6465 6772 6565  rface, in degree
+00012730: 730d 0a20 2020 203a 7265 7475 726e 3a20  s..    :return: 
+00012740: 666c 6f61 7420 6f72 2061 7272 6179 0d0a  float or array..
+00012750: 2020 2020 2222 220d 0a20 2020 2065 6c65      """..    ele
+00012760: 6d65 6e74 7320 3d20 7370 6c69 745f 636f  ments = split_co
+00012770: 6d70 6f75 6e64 2863 6865 6d69 6361 6c5f  mpound(chemical_
+00012780: 666f 726d 756c 6129 0d0a 2020 2020 7765  formula)..    we
+00012790: 6967 6874 203d 206d 6f6c 6563 756c 6172  ight = molecular
+000127a0: 5f77 6569 6768 7428 6368 656d 6963 616c  _weight(chemical
+000127b0: 5f66 6f72 6d75 6c61 290d 0a20 2020 2061  _formula)..    a
+000127c0: 746f 6d5f 7065 725f 766f 6c75 6d65 203d  tom_per_volume =
+000127d0: 2031 652d 3234 202a 2064 656e 7369 7479   1e-24 * density
+000127e0: 202a 2066 672e 4e61 202f 2077 6569 6768   * fg.Na / weigh
+000127f0: 7420 2023 2061 746f 6d73 2070 6572 2041  t  # atoms per A
+00012800: 5e33 0d0a 2020 2020 7265 7475 726e 2078  ^3..    return x
+00012810: 7261 795f 7265 666c 6563 7469 7669 7479  ray_reflectivity
+00012820: 2865 6c65 6d65 6e74 732c 2065 6e65 7267  (elements, energ
+00012830: 795f 6b65 762c 2061 746f 6d5f 7065 725f  y_kev, atom_per_
+00012840: 766f 6c75 6d65 2c20 6772 617a 696e 675f  volume, grazing_
+00012850: 616e 676c 6529 0d0a 0d0a 0d0a 6465 6620  angle)......def 
+00012860: 6669 6c74 6572 5f74 7261 6e73 6d69 7373  filter_transmiss
+00012870: 696f 6e28 6368 656d 6963 616c 5f66 6f72  ion(chemical_for
+00012880: 6d75 6c61 2c20 656e 6572 6779 5f6b 6576  mula, energy_kev
+00012890: 2c20 6465 6e73 6974 792c 2074 6869 636b  , density, thick
+000128a0: 6e65 7373 5f75 6d3d 3130 3029 3a0d 0a20  ness_um=100):.. 
+000128b0: 2020 2022 2222 0d0a 2020 2020 4361 6c63     """..    Calc
+000128c0: 756c 6174 6520 7472 616e 736d 6973 7369  ulate transmissi
+000128d0: 6f6e 206f 6620 782d 7261 7920 7468 726f  on of x-ray thro
+000128e0: 7567 6820 6120 736c 6162 206f 6620 6d61  ugh a slab of ma
+000128f0: 7465 7269 616c 0d0a 2020 2020 4571 7569  terial..    Equi
+00012900: 7661 6c65 6e74 2074 6f20 6874 7470 733a  valent to https:
+00012910: 2f2f 6865 6e6b 652e 6c62 6c2e 676f 762f  //henke.lbl.gov/
+00012920: 6f70 7469 6361 6c5f 636f 6e73 7461 6e74  optical_constant
+00012930: 732f 6669 6c74 6572 322e 6874 6d6c 0d0a  s/filter2.html..
+00012940: 2020 2020 4261 7365 6420 6f6e 2066 6f72      Based on for
+00012950: 6d75 6c61 7320 6672 6f6d 3a20 4865 6e6b  mulas from: Henk
+00012960: 652c 2047 756c 6c69 6b73 6f6e 2c20 616e  e, Gullikson, an
+00012970: 6420 4461 7669 732c 2041 746f 6d69 6320  d Davis, Atomic 
+00012980: 4461 7461 2061 6e64 204e 7563 6c65 6172  Data and Nuclear
+00012990: 2044 6174 6120 5461 626c 6573 2035 3420   Data Tables 54 
+000129a0: 6e6f 2e32 2c20 3138 312d 3334 3220 284a  no.2, 181-342 (J
+000129b0: 756c 7920 3139 3933 290d 0a20 2020 203a  uly 1993)..    :
+000129c0: 7061 7261 6d20 6368 656d 6963 616c 5f66  param chemical_f
+000129d0: 6f72 6d75 6c61 3a20 7374 7220 6d6f 6c65  ormula: str mole
+000129e0: 6375 6c61 7220 666f 726d 756c 610d 0a20  cular formula.. 
+000129f0: 2020 203a 7061 7261 6d20 656e 6572 6779     :param energy
+00012a00: 5f6b 6576 3a20 666c 6f61 7420 6f72 2061  _kev: float or a
+00012a10: 7272 6179 2c20 782d 7261 7920 656e 6572  rray, x-ray ener
+00012a20: 6779 2069 6e20 6b65 560d 0a20 2020 203a  gy in keV..    :
+00012a30: 7061 7261 6d20 6465 6e73 6974 793a 2066  param density: f
+00012a40: 6c6f 6174 2064 656e 7369 7479 2069 6e20  loat density in 
+00012a50: 672f 636d 5e33 0d0a 2020 2020 3a70 6172  g/cm^3..    :par
+00012a60: 616d 2074 6869 636b 6e65 7373 5f75 6d3a  am thickness_um:
+00012a70: 2073 6c61 6220 7468 6963 6b6e 6573 7320   slab thickness 
+00012a80: 696e 206d 6963 726f 6e73 0d0a 2020 2020  in microns..    
+00012a90: 3a72 6574 7572 6e3a 2066 6c6f 6174 206f  :return: float o
+00012aa0: 7220 6172 7261 790d 0a20 2020 2022 2222  r array..    """
+00012ab0: 0d0a 2020 2020 656c 656d 656e 7473 203d  ..    elements =
+00012ac0: 2073 706c 6974 5f63 6f6d 706f 756e 6428   split_compound(
+00012ad0: 6368 656d 6963 616c 5f66 6f72 6d75 6c61  chemical_formula
+00012ae0: 290d 0a20 2020 2077 6569 6768 7420 3d20  )..    weight = 
+00012af0: 6d6f 6c65 6375 6c61 725f 7765 6967 6874  molecular_weight
+00012b00: 2863 6865 6d69 6361 6c5f 666f 726d 756c  (chemical_formul
+00012b10: 6129 0d0a 2020 2020 6174 6f6d 5f70 6572  a)..    atom_per
+00012b20: 5f76 6f6c 756d 6520 3d20 3165 2d32 3420  _volume = 1e-24 
+00012b30: 2a20 6465 6e73 6974 7920 2a20 6667 2e4e  * density * fg.N
+00012b40: 6120 2f20 7765 6967 6874 2020 2320 6174  a / weight  # at
+00012b50: 6f6d 7320 7065 7220 415e 330d 0a20 2020  oms per A^3..   
+00012b60: 2072 6574 7572 6e20 7872 6179 5f74 7261   return xray_tra
+00012b70: 6e73 6d69 7373 696f 6e28 656c 656d 656e  nsmission(elemen
+00012b80: 7473 2c20 656e 6572 6779 5f6b 6576 2c20  ts, energy_kev, 
+00012b90: 6174 6f6d 5f70 6572 5f76 6f6c 756d 652c  atom_per_volume,
+00012ba0: 2074 6869 636b 6e65 7373 5f75 6d29 0d0a   thickness_um)..
+00012bb0: 0d0a 0d0a 272d 2d2d 2d2d 2d2d 2d2d 2d2d  ....'-----------
+00012bc0: 2d2d 2d2d 2d2d 2d2d 4c61 7474 6963 6520  --------Lattice 
+00012bd0: 5472 616e 7366 6f72 6d61 7469 6f6e 732d  Transformations-
+00012be0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00012bf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 0d0a  -------------'..
+00012c00: 0d0a 0d0a 6465 6620 5263 5370 2855 5629  ....def RcSp(UV)
+00012c10: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+00012c20: 4765 6e65 7261 7465 2072 6563 6970 726f  Generate recipro
+00012c30: 6361 6c20 6365 6c6c 2066 726f 6d20 7265  cal cell from re
+00012c40: 616c 2073 7061 6365 2075 6e69 7420 7665  al space unit ve
+00012c50: 636f 7273 0d0a 2020 2020 5573 6167 653a  cors..    Usage:
+00012c60: 0d0a 2020 2020 5556 7320 3d20 5263 5370  ..    UVs = RcSp
+00012c70: 2855 5629 0d0a 2020 2020 2020 5556 203d  (UV)..      UV =
+00012c80: 205b 5b33 7833 5d5d 206d 6174 7269 7820   [[3x3]] matrix 
+00012c90: 6f66 2076 6563 746f 7273 205b 612c 622c  of vectors [a,b,
+00012ca0: 635d 0d0a 2020 2020 2222 220d 0a0d 0a20  c]..    """.... 
+00012cb0: 2020 2023 2062 3120 3d20 322a 6e70 2e70     # b1 = 2*np.p
+00012cc0: 692a 6e70 2e63 726f 7373 2855 565b 315d  i*np.cross(UV[1]
+00012cd0: 2c55 565b 325d 292f 6e70 2e64 6f74 2855  ,UV[2])/np.dot(U
+00012ce0: 565b 305d 2c6e 702e 6372 6f73 7328 5556  V[0],np.cross(UV
+00012cf0: 5b31 5d2c 5556 5b32 5d29 290d 0a20 2020  [1],UV[2]))..   
+00012d00: 2023 2062 3220 3d20 322a 6e70 2e70 692a   # b2 = 2*np.pi*
+00012d10: 6e70 2e63 726f 7373 2855 565b 325d 2c55  np.cross(UV[2],U
+00012d20: 565b 305d 292f 6e70 2e64 6f74 2855 565b  V[0])/np.dot(UV[
+00012d30: 305d 2c6e 702e 6372 6f73 7328 5556 5b31  0],np.cross(UV[1
+00012d40: 5d2c 5556 5b32 5d29 290d 0a20 2020 2023  ],UV[2]))..    #
+00012d50: 2062 3320 3d20 322a 6e70 2e70 692a 6e70   b3 = 2*np.pi*np
+00012d60: 2e63 726f 7373 2855 565b 305d 2c55 565b  .cross(UV[0],UV[
+00012d70: 315d 292f 6e70 2e64 6f74 2855 565b 305d  1])/np.dot(UV[0]
+00012d80: 2c6e 702e 6372 6f73 7328 5556 5b31 5d2c  ,np.cross(UV[1],
+00012d90: 5556 5b32 5d29 290d 0a20 2020 2023 2055  UV[2]))..    # U
+00012da0: 5673 203d 206e 702e 6172 7261 7928 5b62  Vs = np.array([b
+00012db0: 312c 6232 2c62 335d 290d 0a0d 0a20 2020  1,b2,b3])....   
+00012dc0: 2055 5673 203d 2032 202a 206e 702e 7069   UVs = 2 * np.pi
+00012dd0: 202a 206e 702e 6c69 6e61 6c67 2e69 6e76   * np.linalg.inv
+00012de0: 2855 5629 2e54 0d0a 2020 2020 7265 7475  (UV).T..    retu
+00012df0: 726e 2055 5673 0d0a 0d0a 0d0a 6465 6620  rn UVs......def 
+00012e00: 696e 6478 2851 2c20 5556 293a 0d0a 2020  indx(Q, UV):..  
+00012e10: 2020 2222 220d 0a20 2020 2049 6e64 6578    """..    Index
+00012e20: 2051 2878 2c79 2c7a 2920 6f6e 206f 6e20   Q(x,y,z) on on 
+00012e30: 6c61 7474 6963 6520 5b68 2c6b 2c6c 5d20  lattice [h,k,l] 
+00012e40: 7769 7468 2075 6e69 7420 7665 6374 6f72  with unit vector
+00012e50: 7320 5556 0d0a 2020 2020 5573 6167 653a  s UV..    Usage:
+00012e60: 0d0a 2020 2020 2020 484b 4c20 3d20 696e  ..      HKL = in
+00012e70: 6478 2851 2c55 5629 0d0a 2020 2020 2020  dx(Q,UV)..      
+00012e80: 5120 3d20 5b5b 6e78 335d 5d20 6172 7261  Q = [[nx3]] arra
+00012e90: 7920 6f66 2076 6563 746f 7273 0d0a 2020  y of vectors..  
+00012ea0: 2020 2020 5556 203d 205b 5b33 7833 5d5d      UV = [[3x3]]
+00012eb0: 206d 6174 7269 7820 6f66 2076 6563 746f   matrix of vecto
+00012ec0: 7273 205b 612c 622c 635d 0d0a 2020 2020  rs [a,b,c]..    
+00012ed0: 2222 220d 0a20 2020 2048 4b4c 203d 206e  """..    HKL = n
+00012ee0: 702e 646f 7428 512c 206e 702e 6c69 6e61  p.dot(Q, np.lina
+00012ef0: 6c67 2e69 6e76 2855 5629 290d 0a20 2020  lg.inv(UV))..   
+00012f00: 2072 6574 7572 6e20 484b 4c0d 0a0d 0a0d   return HKL.....
+00012f10: 0a64 6566 2077 6176 6576 6563 746f 725f  .def wavevector_
+00012f20: 6469 6666 6572 656e 6365 2851 2c20 6b69  difference(Q, ki
+00012f30: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+00012f40: 2052 6574 7572 6e73 2074 6865 2064 6966   Returns the dif
+00012f50: 6665 7265 6e63 6520 6265 7477 6565 6e20  ference between 
+00012f60: 7265 6369 7072 6f63 616c 206c 6174 7469  reciprocal latti
+00012f70: 6365 2063 6f6f 7264 696e 6174 6573 2061  ce coordinates a
+00012f80: 6e64 2069 6e63 6964 656e 7420 7761 7665  nd incident wave
+00012f90: 7665 6374 6f72 2c20 696e 2041 2d31 0d0a  vector, in A-1..
+00012fa0: 2020 2020 5768 656e 2074 6865 2064 6966      When the dif
+00012fb0: 6665 7265 6e63 6520 6973 207a 6572 6f2c  ference is zero,
+00012fc0: 2074 6865 2063 6f6e 6469 7469 6f6e 2066   the condition f
+00012fd0: 6f72 2064 6966 6672 6163 7469 6f6e 2069  or diffraction i
+00012fe0: 7320 6d65 742e 0d0a 2020 2020 2020 4c61  s met...      La
+00012ff0: 7565 2063 6f6e 6469 7469 6f6e 3a20 5120  ue condition: Q 
+00013000: 3d20 6861 2a20 2b20 6b62 2a20 2b20 6c63  = ha* + kb* + lc
+00013010: 2a20 3d3d 206b 6620 2d20 6b69 0d0a 2020  * == kf - ki..  
+00013020: 2020 2020 456c 6173 7469 6320 7363 6174      Elastic scat
+00013030: 7465 7269 6e67 3a20 2020 2020 2020 2020  tering:         
+00013040: 2020 207c 6b66 7c20 3d20 7c6b 697c 0d0a     |kf| = |ki|..
+00013050: 2020 2020 2020 5468 6572 6566 6f72 653a        Therefore:
+00013060: 2020 2020 2020 2020 2020 7c51 202b 206b            |Q + k
+00013070: 697c 202d 207c 6b69 7c20 3d20 300d 0a20  i| - |ki| = 0.. 
+00013080: 2020 2020 2045 7870 616e 6469 6e67 2026       Expanding &
+00013090: 2073 696d 706c 6966 696e 673a 2051 2e51   simplifing: Q.Q
+000130a0: 202b 2032 512e 6b69 203d 2030 0d0a 2020   + 2Q.ki = 0..  
+000130b0: 2020 3a70 6172 616d 2051 3a20 5b5b 6e78    :param Q: [[nx
+000130c0: 335d 5d20 6172 7261 7920 6f66 2072 6563  3]] array of rec
+000130d0: 6970 726f 6361 6c20 6c61 7474 6963 6520  iprocal lattice 
+000130e0: 636f 6f72 6469 6e61 7465 732c 2069 6e20  coordinates, in 
+000130f0: 412d 310d 0a20 2020 203a 7061 7261 6d20  A-1..    :param 
+00013100: 6b69 3a20 5b78 2c79 2c7a 5d20 696e 6369  ki: [x,y,z] inci
+00013110: 6465 6e74 2077 6176 6576 6563 746f 722c  dent wavevector,
+00013120: 2069 6e20 412d 310d 0a20 2020 203a 7265   in A-1..    :re
+00013130: 7475 726e 3a20 5b6e 7831 5d20 6172 7261  turn: [nx1] arra
+00013140: 7920 6f66 2064 6966 6665 7265 6e63 652c  y of difference,
+00013150: 2069 6e20 412d 310d 0a20 2020 2022 2222   in A-1..    """
+00013160: 0d0a 2020 2020 5120 3d20 6e70 2e72 6573  ..    Q = np.res
+00013170: 6861 7065 2851 2c20 5b2d 312c 2033 5d29  hape(Q, [-1, 3])
+00013180: 0d0a 2020 2020 7265 7475 726e 206e 702e  ..    return np.
+00013190: 6172 7261 7928 5b6e 702e 646f 7428 712c  array([np.dot(q,
+000131a0: 2071 2920 2b20 3220 2a20 6e70 2e64 6f74   q) + 2 * np.dot
+000131b0: 2871 2c20 6b69 2920 666f 7220 7120 696e  (q, ki) for q in
+000131c0: 2051 5d29 0d0a 0d0a 0d0a 6465 6620 6c61   Q])......def la
+000131d0: 7470 6172 766f 6c75 6d65 2861 2c20 623d  tparvolume(a, b=
+000131e0: 4e6f 6e65 2c20 633d 4e6f 6e65 2c20 616c  None, c=None, al
+000131f0: 7068 613d 3930 2e2c 2062 6574 613d 3930  pha=90., beta=90
+00013200: 2e2c 2067 616d 6d61 3d39 302e 293a 0d0a  ., gamma=90.):..
+00013210: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
+00013220: 6375 616c 7465 2074 6865 2075 6e69 7420  cualte the unit 
+00013230: 6365 6c6c 2076 6f6c 756d 6520 696e 2041  cell volume in A
+00013240: 5e33 0d0a 2020 2020 3a70 6172 616d 2061  ^3..    :param a
+00013250: 2c20 622c 2063 3a20 666c 6f61 7420 6c61  , b, c: float la
+00013260: 7474 6963 6520 7061 7261 6d65 7465 7273  ttice parameters
+00013270: 0d0a 2020 2020 3a70 6172 616d 2061 6c70  ..    :param alp
+00013280: 6861 2c20 6265 7461 2c20 6761 6d6d 613a  ha, beta, gamma:
+00013290: 2066 6c6f 6174 206c 6174 7469 6365 2061   float lattice a
+000132a0: 6e67 6c65 730d 0a20 2020 203a 7265 7475  ngles..    :retu
+000132b0: 726e 3a20 666c 6f61 7420 766f 6c75 6d65  rn: float volume
+000132c0: 2069 6e20 416e 6773 7472 6f6d 5e33 0d0a   in Angstrom^3..
+000132d0: 2020 2020 2222 220d 0a20 2020 2069 6620      """..    if 
+000132e0: 6220 6973 204e 6f6e 653a 0d0a 2020 2020  b is None:..    
+000132f0: 2020 2020 6220 3d20 610d 0a20 2020 2069      b = a..    i
+00013300: 6620 6320 6973 204e 6f6e 653a 0d0a 2020  f c is None:..  
+00013310: 2020 2020 2020 6320 3d20 610d 0a20 2020        c = a..   
+00013320: 2063 6120 3d20 6e70 2e63 6f73 286e 702e   ca = np.cos(np.
+00013330: 6465 6732 7261 6428 616c 7068 6129 290d  deg2rad(alpha)).
+00013340: 0a20 2020 2063 6220 3d20 6e70 2e63 6f73  .    cb = np.cos
+00013350: 286e 702e 6465 6732 7261 6428 6265 7461  (np.deg2rad(beta
+00013360: 2929 0d0a 2020 2020 6367 203d 206e 702e  ))..    cg = np.
+00013370: 636f 7328 6e70 2e64 6567 3272 6164 2867  cos(np.deg2rad(g
+00013380: 616d 6d61 2929 0d0a 2020 2020 7265 7475  amma))..    retu
+00013390: 726e 206e 702e 7371 7274 2861 2a2a 3220  rn np.sqrt(a**2 
+000133a0: 2a20 622a 2a32 202a 2063 2a2a 3220 2a20  * b**2 * c**2 * 
+000133b0: 2831 202b 2032 202a 2063 6120 2a20 6362  (1 + 2 * ca * cb
+000133c0: 202a 2063 6720 2d20 6361 2a2a 3220 2d20   * cg - ca**2 - 
+000133d0: 6362 2a2a 3220 2d20 6367 2a2a 3229 290d  cb**2 - cg**2)).
+000133e0: 0a0d 0a0d 0a64 6566 206c 6174 7061 725f  .....def latpar_
+000133f0: 7265 6369 7072 6f63 616c 2855 5629 3a0d  reciprocal(UV):.
+00013400: 0a20 2020 2022 2222 0d0a 2020 2020 5265  .    """..    Re
+00013410: 7475 726e 2074 6865 2072 6563 6970 726f  turn the recipro
+00013420: 6361 6c20 6c61 7474 6963 6520 7061 7261  cal lattice para
+00013430: 6d65 7465 7273 2069 6e20 696e 7665 7273  meters in invers
+00013440: 652d 616e 6773 7472 6f6d 7320 616e 6420  e-angstroms and 
+00013450: 6465 6772 6565 730d 0a20 2020 203a 7061  degrees..    :pa
+00013460: 7261 6d20 5556 3a20 5b33 2a33 5d20 756e  ram UV: [3*3] un
+00013470: 6974 2076 6563 746f 7220 5b61 2c62 2c63  it vector [a,b,c
+00013480: 5d0d 0a20 2020 203a 7265 7475 726e 3a20  ]..    :return: 
+00013490: 612a 2c20 622a 2c20 632a 2c20 616c 7068  a*, b*, c*, alph
+000134a0: 612a 2c20 6265 7461 2a2c 2067 616d 6d61  a*, beta*, gamma
+000134b0: 2a0d 0a20 2020 2022 2222 0d0a 2020 2020  *..    """..    
+000134c0: 5556 7320 3d20 5263 5370 2855 5629 202f  UVs = RcSp(UV) /
+000134d0: 2028 3220 2a20 6e70 2e70 6929 0d0a 2020   (2 * np.pi)..  
+000134e0: 2020 6231 2c20 6232 2c20 6233 203d 2066    b1, b2, b3 = f
+000134f0: 672e 6d61 6728 5556 7329 0d0a 2020 2020  g.mag(UVs)..    
+00013500: 6265 7461 3320 3d20 6667 2e61 6e67 2855  beta3 = fg.ang(U
+00013510: 5673 5b30 2c20 3a5d 2c20 5556 735b 312c  Vs[0, :], UVs[1,
+00013520: 203a 5d2c 2027 6465 6727 290d 0a20 2020   :], 'deg')..   
+00013530: 2062 6574 6132 203d 2066 672e 616e 6728   beta2 = fg.ang(
+00013540: 5556 735b 302c 203a 5d2c 2055 5673 5b32  UVs[0, :], UVs[2
+00013550: 2c20 3a5d 2c20 2764 6567 2729 0d0a 2020  , :], 'deg')..  
+00013560: 2020 6265 7461 3120 3d20 6667 2e61 6e67    beta1 = fg.ang
+00013570: 2855 5673 5b31 2c20 3a5d 2c20 5556 735b  (UVs[1, :], UVs[
+00013580: 322c 203a 5d2c 2027 6465 6727 290d 0a20  2, :], 'deg').. 
+00013590: 2020 2072 6574 7572 6e20 6231 2c20 6232     return b1, b2
+000135a0: 2c20 6233 2c20 6265 7461 312c 2062 6574  , b3, beta1, bet
+000135b0: 6132 2c20 6265 7461 330d 0a0d 0a0d 0a64  a2, beta3......d
+000135c0: 6566 2042 6d61 7472 6978 2855 5629 3a0d  ef Bmatrix(UV):.
+000135d0: 0a20 2020 2022 2222 0d0a 2020 2020 4361  .    """..    Ca
+000135e0: 6c63 756c 6174 6520 7468 6520 4275 7369  lculate the Busi
+000135f0: 6e67 2061 6e64 204c 6576 7920 4220 6d61  ng and Levy B ma
+00013600: 7472 6978 2066 726f 6d20 6120 7265 616c  trix from a real
+00013610: 2073 7061 6365 2055 560d 0a20 2020 2022   space UV..    "
+00013620: 6368 6f6f 7365 2074 6865 2078 2d61 7869  choose the x-axi
+00013630: 7320 7061 7261 6c6c 656c 2074 6f20 612a  s parallel to a*
+00013640: 2c20 7468 6520 792d 6178 6973 2069 6e20  , the y-axis in 
+00013650: 7468 6520 706c 616e 6520 6f66 2061 2a20  the plane of a* 
+00013660: 616e 6420 622a 2c20 616e 6420 7468 6520  and b*, and the 
+00013670: 7a2d 6178 6973 2070 6572 7065 6e64 6963  z-axis perpendic
+00013680: 756c 6172 2074 6f20 7468 6174 2070 6c61  ular to that pla
+00013690: 6e65 220d 0a20 2020 2046 726f 6d3a 2057  ne"..    From: W
+000136a0: 2e20 522e 2042 7573 696e 6720 616e 6420  . R. Busing and 
+000136b0: 482e 2041 2e20 4c65 7679 2c20 4163 7461  H. A. Levy, Acta
+000136c0: 2043 7279 7374 2e20 2831 3936 3729 2e20   Cryst. (1967). 
+000136d0: 3232 2c20 3435 372d 3436 340d 0a20 2020  22, 457-464..   
+000136e0: 2022 416e 676c 6520 6361 6c63 756c 6174   "Angle calculat
+000136f0: 696f 6e73 2066 6f72 2033 2d20 616e 6420  ions for 3- and 
+00013700: 342d 6369 7263 6c65 2058 2d72 6179 2061  4-circle X-ray a
+00013710: 6e64 206e 6575 7472 6f6e 2064 6966 6672  nd neutron diffr
+00013720: 6163 746f 6d65 7465 7273 220d 0a20 2020  actometers"..   
+00013730: 2053 6565 2061 6c73 6f3a 2068 7474 7073   See also: https
+00013740: 3a2f 2f64 6f63 732e 6d61 6e74 6964 7072  ://docs.mantidpr
+00013750: 6f6a 6563 742e 6f72 672f 6e69 6768 746c  oject.org/nightl
+00013760: 792f 636f 6e63 6570 7473 2f4c 6174 7469  y/concepts/Latti
+00013770: 6365 2e68 746d 6c0d 0a20 2020 2022 2222  ce.html..    """
+00013780: 0d0a 0d0a 2020 2020 2222 220d 0a20 2020  ....    """..   
+00013790: 2061 312c 2061 322c 2061 3320 3d20 6667   a1, a2, a3 = fg
+000137a0: 2e6d 6167 2855 5629 0d0a 2020 2020 616c  .mag(UV)..    al
+000137b0: 7068 6133 203d 2066 672e 616e 6728 5556  pha3 = fg.ang(UV
+000137c0: 5b30 2c20 3a5d 2c20 5556 5b31 2c20 3a5d  [0, :], UV[1, :]
+000137d0: 290d 0a20 2020 2061 6c70 6861 3220 3d20  )..    alpha2 = 
+000137e0: 6667 2e61 6e67 2855 565b 302c 203a 5d2c  fg.ang(UV[0, :],
+000137f0: 2055 565b 322c 203a 5d29 0d0a 2020 2020   UV[2, :])..    
+00013800: 616c 7068 6131 203d 2066 672e 616e 6728  alpha1 = fg.ang(
+00013810: 5556 5b31 2c20 3a5d 2c20 5556 5b32 2c20  UV[1, :], UV[2, 
+00013820: 3a5d 290d 0a20 2020 2055 5673 203d 2052  :])..    UVs = R
+00013830: 6353 7028 5556 2920 2f20 2832 202a 206e  cSp(UV) / (2 * n
+00013840: 702e 7069 290d 0a20 2020 2062 312c 2062  p.pi)..    b1, b
+00013850: 322c 2062 3320 3d20 6667 2e6d 6167 2855  2, b3 = fg.mag(U
+00013860: 5673 290d 0a20 2020 2062 6574 6133 203d  Vs)..    beta3 =
+00013870: 2066 672e 616e 6728 5556 735b 302c 203a   fg.ang(UVs[0, :
+00013880: 5d2c 2055 5673 5b31 2c20 3a5d 290d 0a20  ], UVs[1, :]).. 
+00013890: 2020 2062 6574 6132 203d 2066 672e 616e     beta2 = fg.an
+000138a0: 6728 5556 735b 302c 203a 5d2c 2055 5673  g(UVs[0, :], UVs
+000138b0: 5b32 2c20 3a5d 290d 0a20 2020 2062 6574  [2, :])..    bet
+000138c0: 6131 203d 2066 672e 616e 6728 5556 735b  a1 = fg.ang(UVs[
+000138d0: 312c 203a 5d2c 2055 5673 5b32 2c20 3a5d  1, :], UVs[2, :]
+000138e0: 290d 0a0d 0a20 2020 2042 203d 206e 702e  )....    B = np.
+000138f0: 6172 7261 7928 5b5b 6231 2c20 6232 202a  array([[b1, b2 *
+00013900: 206e 702e 636f 7328 6265 7461 3329 2c20   np.cos(beta3), 
+00013910: 6233 202a 206e 702e 636f 7328 6265 7461  b3 * np.cos(beta
+00013920: 3229 5d2c 0d0a 2020 2020 2020 2020 2020  2)],..          
+00013930: 2020 2020 2020 2020 5b30 2c20 6232 202a          [0, b2 *
+00013940: 206e 702e 7369 6e28 6265 7461 3329 2c20   np.sin(beta3), 
+00013950: 2d62 3320 2a20 6e70 2e73 696e 2862 6574  -b3 * np.sin(bet
+00013960: 6132 2920 2a20 6e70 2e63 6f73 2861 6c70  a2) * np.cos(alp
+00013970: 6861 3129 5d2c 0d0a 2020 2020 2020 2020  ha1)],..        
+00013980: 2020 2020 2020 2020 2020 5b30 2c20 302c            [0, 0,
+00013990: 2031 202f 2061 335d 5d29 0d0a 2020 2020   1 / a3]])..    
+000139a0: 7265 7475 726e 2032 202a 206e 702e 7069  return 2 * np.pi
+000139b0: 202a 2042 2020 2320 6571 7569 7661 6c65   * B  # equivale
+000139c0: 6e74 2074 6f20 7472 616e 7370 6f73 6528  nt to transpose(
+000139d0: 5556 7329 0d0a 2020 2020 2222 220d 0a20  UVs)..    """.. 
+000139e0: 2020 2072 6574 7572 6e20 5263 5370 2855     return RcSp(U
+000139f0: 5629 2e54 0d0a 0d0a 0d0a 6465 6620 6c61  V).T......def la
+00013a00: 7470 6172 426d 6174 7269 7828 612c 2062  tparBmatrix(a, b
+00013a10: 3d4e 6f6e 652c 2063 3d4e 6f6e 652c 2061  =None, c=None, a
+00013a20: 6c70 6861 3d39 302e 2c20 6265 7461 3d39  lpha=90., beta=9
+00013a30: 302e 2c20 6761 6d6d 613d 3930 2e29 3a0d  0., gamma=90.):.
+00013a40: 0a20 2020 2022 2222 0d0a 2020 2020 4361  .    """..    Ca
+00013a50: 6c63 756c 6174 6520 7468 6520 4275 7369  lculate the Busi
+00013a60: 6e67 2061 6e64 204c 6576 7920 4220 6d61  ng and Levy B ma
+00013a70: 7472 6978 2066 726f 6d20 6120 7265 616c  trix from a real
+00013a80: 2073 7061 6365 2055 560d 0a20 2020 2022   space UV..    "
+00013a90: 6368 6f6f 7365 2020 7468 6520 7820 2061  choose  the x  a
+00013aa0: 7869 7320 7061 7261 6c6c 656c 2020 746f  xis parallel  to
+00013ab0: 2061 2c20 7468 6520 2079 2020 6178 6973   a, the  y  axis
+00013ac0: 2020 696e 2020 7468 6520 2070 6c61 6e65    in  the  plane
+00013ad0: 2020 6f66 2020 6120 2061 6e64 2020 622c    of  a  and  b,
+00013ae0: 2020 616e 6420 2074 6865 2020 7a20 2061    and  the  z  a
+00013af0: 7869 730d 0a20 2020 2070 6572 7065 6e64  xis..    perpend
+00013b00: 6963 756c 6172 2020 746f 2020 7468 6174  icular  to  that
+00013b10: 2020 706c 616e 6522 0d0a 2020 2020 4672    plane"..    Fr
+00013b20: 6f6d 3a20 572e 2052 2e20 4275 7369 6e67  om: W. R. Busing
+00013b30: 2061 6e64 2048 2e20 412e 204c 6576 792c   and H. A. Levy,
+00013b40: 2041 6374 6120 4372 7973 742e 2028 3139   Acta Cryst. (19
+00013b50: 3637 292e 2032 322c 2034 3537 2d34 3634  67). 22, 457-464
+00013b60: 0d0a 2020 2020 2241 6e67 6c65 2063 616c  ..    "Angle cal
+00013b70: 6375 6c61 7469 6f6e 7320 666f 7220 332d  culations for 3-
+00013b80: 2061 6e64 2034 2d63 6972 636c 6520 582d   and 4-circle X-
+00013b90: 7261 7920 616e 6420 6e65 7574 726f 6e20  ray and neutron 
+00013ba0: 6469 6666 7261 6374 6f6d 6574 6572 7322  diffractometers"
+00013bb0: 0d0a 2020 2020 5365 6520 616c 736f 3a20  ..    See also: 
+00013bc0: 6874 7470 733a 2f2f 646f 6373 2e6d 616e  https://docs.man
+00013bd0: 7469 6470 726f 6a65 6374 2e6f 7267 2f6e  tidproject.org/n
+00013be0: 6967 6874 6c79 2f63 6f6e 6365 7074 732f  ightly/concepts/
+00013bf0: 4c61 7474 6963 652e 6874 6d6c 0d0a 2020  Lattice.html..  
+00013c00: 2020 3a70 6172 616d 2061 2c20 622c 2063    :param a, b, c
+00013c10: 3a20 666c 6f61 7420 6c61 7474 6963 6520  : float lattice 
+00013c20: 7061 7261 6d65 7465 7273 0d0a 2020 2020  parameters..    
+00013c30: 3a70 6172 616d 2061 6c70 6861 2c20 6265  :param alpha, be
+00013c40: 7461 2c20 6761 6d6d 613a 2066 6c6f 6174  ta, gamma: float
+00013c50: 206c 6174 7469 6365 2061 6e67 6c65 730d   lattice angles.
+00013c60: 0a20 2020 203a 7265 7475 726e 3a20 5b33  .    :return: [3
+00013c70: 2a33 5d20 6172 7261 790d 0a20 2020 2022  *3] array..    "
+00013c80: 2222 0d0a 2020 2020 6966 2062 2069 7320  ""..    if b is 
+00013c90: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2062  None:..        b
+00013ca0: 203d 2061 0d0a 2020 2020 6966 2063 2069   = a..    if c i
+00013cb0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00013cc0: 2063 203d 2061 0d0a 2020 2020 7576 203d   c = a..    uv =
+00013cd0: 206c 6174 7061 7232 7576 5f72 6f74 2861   latpar2uv_rot(a
+00013ce0: 2c62 2c20 632c 2061 6c70 6861 2c20 6265  ,b, c, alpha, be
+00013cf0: 7461 2c20 6761 6d6d 6129 0d0a 2020 2020  ta, gamma)..    
+00013d00: 7265 7475 726e 2042 6d61 7472 6978 2875  return Bmatrix(u
+00013d10: 7629 0d0a 0d0a 0d0a 6465 6620 756d 6174  v)......def umat
+00013d20: 7269 7828 615f 6178 6973 3d4e 6f6e 652c  rix(a_axis=None,
+00013d30: 2062 5f61 7869 733d 4e6f 6e65 2c20 635f   b_axis=None, c_
+00013d40: 6178 6973 3d4e 6f6e 6529 3a0d 0a20 2020  axis=None):..   
+00013d50: 2022 2222 0d0a 2020 2020 4465 6669 6e65   """..    Define
+00013d60: 2061 6e20 6f72 6965 6e74 6174 696f 6e20   an orientation 
+00013d70: 6d61 7472 6978 2069 6e20 7468 6520 6469  matrix in the di
+00013d80: 6666 7261 6374 6f6d 6574 6572 2066 7261  ffractometer fra
+00013d90: 6d65 0d0a 2020 2020 4469 6666 7261 6374  me..    Diffract
+00013da0: 6f6d 6574 6572 2066 7261 6d65 2061 6363  ometer frame acc
+00013db0: 6f72 6469 6e67 2074 6f20 4669 672e 2031  ording to Fig. 1
+00013dc0: 2c20 482e 2059 6f75 2c20 4a2e 2041 7070  , H. You, J. App
+00013dd0: 6c2e 2043 7279 7374 2033 3220 2831 3939  l. Cryst 32 (199
+00013de0: 3929 2c20 3631 342d 3632 330d 0a20 2020  9), 614-623..   
+00013df0: 2020 207a 2d61 7869 7320 3a20 6178 6973     z-axis : axis
+00013e00: 2070 6172 616c 6c65 6c20 746f 2074 6865   parallel to the
+00013e10: 2070 6869 2072 6f74 6174 696f 6e20 6178   phi rotation ax
+00013e20: 6973 2077 6865 6e20 616c 6c20 616e 676c  is when all angl
+00013e30: 6573 2030 2028 746f 7761 7264 7320 7761  es 0 (towards wa
+00013e40: 6c6c 2028 2b78 2920 696e 206c 6162 2066  ll (+x) in lab f
+00013e50: 7261 6d65 290d 0a20 2020 2020 2078 2d61  rame)..      x-a
+00013e60: 7869 7320 3a20 7665 6374 6f72 206e 6f72  xis : vector nor
+00013e70: 6d61 6c20 746f 2070 6869 2061 7869 7320  mal to phi axis 
+00013e80: 7768 6572 6520 7068 693d 3020 2874 6f77  where phi=0 (tow
+00013e90: 6172 6420 6365 696c 696e 6720 282b 7929  ard ceiling (+y)
+00013ea0: 2069 6e20 6c61 6220 6672 616d 6529 0d0a   in lab frame)..
+00013eb0: 2020 2020 2020 792d 6178 6973 203a 2076        y-axis : v
+00013ec0: 6563 746f 7220 6e6f 726d 616c 2074 6f20  ector normal to 
+00013ed0: 782c 7a20 6178 6573 2028 7061 7261 6c6c  x,z axes (parall
+00013ee0: 656c 2074 6f20 6265 616d 2028 2b7a 2920  el to beam (+z) 
+00013ef0: 696e 206c 6162 2066 7261 6d65 290d 0a20  in lab frame).. 
+00013f00: 2020 203a 7061 7261 6d20 615f 6178 6973     :param a_axis
+00013f10: 3a20 6469 7265 6374 696f 6e20 6f66 2061  : direction of a
+00013f20: 2069 6e20 7468 6520 6469 6666 7261 6374   in the diffract
+00013f30: 6f6d 6574 6572 2066 7261 6d65 0d0a 2020  ometer frame..  
+00013f40: 2020 3a70 6172 616d 2062 5f61 7869 733a    :param b_axis:
+00013f50: 2064 6972 6563 7469 6f6e 206f 6620 6220   direction of b 
+00013f60: 696e 2074 6865 2064 6966 6672 6163 746f  in the diffracto
+00013f70: 6d65 7465 7220 6672 616d 650d 0a20 2020  meter frame..   
+00013f80: 203a 7061 7261 6d20 635f 6178 6973 3a20   :param c_axis: 
+00013f90: 6469 7265 6374 696f 6e20 6f66 2063 2069  direction of c i
+00013fa0: 6e20 7468 6520 6469 6666 7261 6374 6f6d  n the diffractom
+00013fb0: 6574 6572 2066 7261 6d65 0d0a 2020 2020  eter frame..    
+00013fc0: 3a72 6574 7572 6e3a 205b 332a 335d 2061  :return: [3*3] a
+00013fd0: 7272 6179 0d0a 2020 2020 2222 220d 0a20  rray..    """.. 
+00013fe0: 2020 2061 5f61 7869 7320 3d20 6667 2e6e     a_axis = fg.n
+00013ff0: 6f72 6d28 6e70 2e63 726f 7373 2862 5f61  orm(np.cross(b_a
+00014000: 7869 732c 2063 5f61 7869 7329 2920 6966  xis, c_axis)) if
+00014010: 2061 5f61 7869 7320 6973 204e 6f6e 6520   a_axis is None 
+00014020: 656c 7365 2066 672e 6e6f 726d 2861 5f61  else fg.norm(a_a
+00014030: 7869 7329 0d0a 2020 2020 625f 6178 6973  xis)..    b_axis
+00014040: 203d 2066 672e 6e6f 726d 286e 702e 6372   = fg.norm(np.cr
+00014050: 6f73 7328 635f 6178 6973 2c20 615f 6178  oss(c_axis, a_ax
+00014060: 6973 2929 2069 6620 625f 6178 6973 2069  is)) if b_axis i
+00014070: 7320 4e6f 6e65 2065 6c73 6520 6667 2e6e  s None else fg.n
+00014080: 6f72 6d28 625f 6178 6973 290d 0a20 2020  orm(b_axis)..   
+00014090: 2063 5f61 7869 7320 3d20 6667 2e6e 6f72   c_axis = fg.nor
+000140a0: 6d28 6e70 2e63 726f 7373 2861 5f61 7869  m(np.cross(a_axi
+000140b0: 732c 2062 5f61 7869 7329 2920 6966 2063  s, b_axis)) if c
+000140c0: 5f61 7869 7320 6973 204e 6f6e 6520 656c  _axis is None el
+000140d0: 7365 2066 672e 6e6f 726d 2863 5f61 7869  se fg.norm(c_axi
+000140e0: 7329 0d0a 2020 2020 2372 6574 7572 6e20  s)..    #return 
+000140f0: 6e70 2e61 7272 6179 285b 615f 6178 6973  np.array([a_axis
+00014100: 2c20 625f 6178 6973 2c20 635f 6178 6973  , b_axis, c_axis
+00014110: 5d2c 2064 7479 7065 3d66 6c6f 6174 290d  ], dtype=float).
+00014120: 0a20 2020 2069 6620 6e70 2e61 6273 286e  .    if np.abs(n
+00014130: 702e 646f 7428 635f 6178 6973 2c20 615f  p.dot(c_axis, a_
+00014140: 6178 6973 2929 203e 2030 2e39 393a 0d0a  axis)) > 0.99:..
+00014150: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00014160: 6365 7074 696f 6e28 2741 7865 7320 6d75  ception('Axes mu
+00014170: 7374 206e 6f74 2062 6520 7061 7261 6c6c  st not be parall
+00014180: 656c 2729 0d0a 2020 2020 7265 7475 726e  el')..    return
+00014190: 2066 672e 6e6f 726d 616c 5f62 6173 6973   fg.normal_basis
+000141a0: 2863 5f61 7869 732c 2061 5f61 7869 7329  (c_axis, a_axis)
+000141b0: 0d0a 0d0a 0d0a 6465 6620 7562 6d61 7472  ......def ubmatr
+000141c0: 6978 2875 762c 2075 293a 0d0a 2020 2020  ix(uv, u):..    
+000141d0: 2222 220d 0a20 2020 2052 6574 7572 6e20  """..    Return 
+000141e0: 5542 206d 6174 7269 780d 0a20 2020 203a  UB matrix..    :
+000141f0: 7061 7261 6d20 7576 3a20 5b33 2a33 5d20  param uv: [3*3] 
+00014200: 756e 6974 2076 6563 746f 7220 5b61 2c62  unit vector [a,b
+00014210: 2c63 5d0d 0a20 2020 203a 7061 7261 6d20  ,c]..    :param 
+00014220: 753a 205b 332a 335d 206f 7269 656e 7461  u: [3*3] orienta
+00014230: 7469 6f6e 206d 6174 7269 7820 696e 2074  tion matrix in t
+00014240: 6865 2064 6966 6672 6163 746f 6d65 7465  he diffractomete
+00014250: 7220 6672 616d 650d 0a20 2020 203a 7265  r frame..    :re
+00014260: 7475 726e 3a20 5b33 2a33 5d20 6172 7261  turn: [3*3] arra
+00014270: 790d 0a20 2020 2022 2222 0d0a 2020 2020  y..    """..    
+00014280: 6220 3d20 426d 6174 7269 7828 7576 290d  b = Bmatrix(uv).
+00014290: 0a20 2020 2072 6574 7572 6e20 6e70 2e64  .    return np.d
+000142a0: 6f74 2875 2c20 6229 0d0a 0d0a 0d0a 6465  ot(u, b)......de
+000142b0: 6620 726f 746d 6174 7269 787a 2870 6869  f rotmatrixz(phi
+000142c0: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+000142d0: 2047 656e 6572 6174 6520 6469 6666 7261   Generate diffra
+000142e0: 6374 6f6d 6574 6572 2072 6f74 6174 696f  ctometer rotatio
+000142f0: 6e20 6d61 7472 6978 2061 626f 7574 207a  n matrix about z
+00014300: 2d61 7869 7320 2872 6967 6874 2068 616e  -axis (right han
+00014310: 6465 6429 0d0a 2020 2020 4571 7569 7661  ded)..    Equiva
+00014320: 6c65 6e74 2074 6f20 5941 5720 696e 2074  lent to YAW in t
+00014330: 6865 2054 6169 742d 4272 7961 6e20 636f  he Tait-Bryan co
+00014340: 6e76 656e 7469 6f6e 0d0a 2020 2020 4571  nvention..    Eq
+00014350: 7569 7661 6c65 6e74 2074 6f20 2d70 6869  uivalent to -phi
+00014360: 2c20 2d65 7461 2c20 2d64 656c 7461 2069  , -eta, -delta i
+00014370: 6e20 596f 7520 6574 2061 6c2e 2064 6966  n You et al. dif
+00014380: 6672 6163 746f 6d65 7465 7220 636f 6e76  fractometer conv
+00014390: 656e 7469 6f6e 2028 6c65 6674 2068 616e  ention (left han
+000143a0: 6465 6429 0d0a 2020 2020 2020 2020 7220  ded)..        r 
+000143b0: 3d20 726f 746d 6174 7269 785f 7a28 7068  = rotmatrix_z(ph
+000143c0: 6929 0d0a 2020 2020 2020 2020 7665 6327  i)..        vec'
+000143d0: 203d 206e 702e 646f 7428 722c 2076 6563   = np.dot(r, vec
+000143e0: 290d 0a20 2020 2076 6563 206d 7573 7420  )..    vec must 
+000143f0: 6265 2031 4420 6f72 2063 6f6c 756d 6e20  be 1D or column 
+00014400: 7665 6374 6f72 2028 332a 6e29 0d0a 2020  vector (3*n)..  
+00014410: 2020 3a70 6172 616d 2070 6869 3a20 666c    :param phi: fl
+00014420: 6f61 7420 616e 676c 6520 696e 2064 6567  oat angle in deg
+00014430: 7265 6573 0d0a 2020 2020 3a72 6574 7572  rees..    :retur
+00014440: 6e3a 205b 332a 335d 2061 7272 6179 0d0a  n: [3*3] array..
+00014450: 2020 2020 2222 220d 0a20 2020 2070 6869      """..    phi
+00014460: 203d 206e 702e 6465 6732 7261 6428 7068   = np.deg2rad(ph
+00014470: 6929 0d0a 2020 2020 6320 3d20 6e70 2e63  i)..    c = np.c
+00014480: 6f73 2870 6869 290d 0a20 2020 2073 203d  os(phi)..    s =
+00014490: 206e 702e 7369 6e28 7068 6929 0d0a 2020   np.sin(phi)..  
+000144a0: 2020 7265 7475 726e 206e 702e 6172 7261    return np.arra
+000144b0: 7928 5b5b 632c 202d 732c 2030 5d2c 205b  y([[c, -s, 0], [
+000144c0: 732c 2063 2c20 305d 2c20 5b30 2c20 302c  s, c, 0], [0, 0,
+000144d0: 2031 5d5d 2920 2023 2077 696b 6920 2d20   1]])  # wiki - 
+000144e0: 7269 6768 7420 6861 6e64 6564 0d0a 0d0a  right handed....
+000144f0: 0d0a 6465 6620 726f 746d 6174 7269 7879  ..def rotmatrixy
+00014500: 2863 6869 293a 0d0a 2020 2020 2222 220d  (chi):..    """.
+00014510: 0a20 2020 2047 656e 6572 6174 6520 6469  .    Generate di
+00014520: 6666 7261 6374 6f6d 6574 6572 2072 6f74  ffractometer rot
+00014530: 6174 696f 6e20 6d61 7472 6978 2063 6869  ation matrix chi
+00014540: 2061 626f 7574 2079 2d61 7869 7320 2872   about y-axis (r
+00014550: 6967 6874 2068 616e 6465 6429 0d0a 2020  ight handed)..  
+00014560: 2020 4571 7569 7661 6c65 6e74 2074 6f20    Equivalent to 
+00014570: 5049 5443 4820 696e 2074 6865 2054 6169  PITCH in the Tai
+00014580: 74e2 8093 4272 7961 6e20 636f 6e76 656e  t...Bryan conven
+00014590: 7469 6f6e 0d0a 2020 2020 4571 7569 7661  tion..    Equiva
+000145a0: 6c65 6e74 2074 6f20 2d63 6869 2069 6e20  lent to -chi in 
+000145b0: 596f 7520 6574 2061 6c2e 2064 6966 6672  You et al. diffr
+000145c0: 6163 746f 6d65 7465 7220 636f 6e76 656e  actometer conven
+000145d0: 7469 6f6e 2028 6c65 6674 2068 616e 6465  tion (left hande
+000145e0: 6429 0d0a 2020 2020 2020 2020 7220 3d20  d)..        r = 
+000145f0: 726f 746d 6174 7269 785f 7928 6368 6929  rotmatrix_y(chi)
+00014600: 0d0a 2020 2020 2020 2020 7665 6327 203d  ..        vec' =
+00014610: 206e 702e 646f 7428 722c 2076 6563 290d   np.dot(r, vec).
+00014620: 0a20 2020 2076 6563 206d 7573 7420 6265  .    vec must be
+00014630: 2031 4420 6f72 2063 6f6c 756d 6e20 7665   1D or column ve
+00014640: 6374 6f72 2028 332a 6e29 0d0a 2020 2020  ctor (3*n)..    
+00014650: 3a70 6172 616d 2063 6869 3a20 666c 6f61  :param chi: floa
+00014660: 7420 616e 676c 6520 696e 2064 6567 7265  t angle in degre
+00014670: 6573 0d0a 2020 2020 3a72 6574 7572 6e3a  es..    :return:
+00014680: 205b 332a 335d 2061 7272 6179 0d0a 2020   [3*3] array..  
+00014690: 2020 2222 220d 0a20 2020 2063 6869 203d    """..    chi =
+000146a0: 206e 702e 6465 6732 7261 6428 6368 6929   np.deg2rad(chi)
+000146b0: 0d0a 2020 2020 6320 3d20 6e70 2e63 6f73  ..    c = np.cos
+000146c0: 2863 6869 290d 0a20 2020 2073 203d 206e  (chi)..    s = n
+000146d0: 702e 7369 6e28 6368 6929 0d0a 2020 2020  p.sin(chi)..    
+000146e0: 7265 7475 726e 206e 702e 6172 7261 7928  return np.array(
+000146f0: 5b5b 632c 2030 2c20 735d 2c20 5b30 2c20  [[c, 0, s], [0, 
+00014700: 312c 2030 5d2c 205b 2d73 2c20 302c 2063  1, 0], [-s, 0, c
+00014710: 5d5d 290d 0a0d 0a0d 0a64 6566 2072 6f74  ]])......def rot
+00014720: 6d61 7472 6978 7828 6d75 293a 0d0a 2020  matrixx(mu):..  
+00014730: 2020 2222 220d 0a20 2020 2047 656e 6572    """..    Gener
+00014740: 6174 6520 6469 6666 7261 6374 6f6d 6574  ate diffractomet
+00014750: 6572 2072 6f74 6174 696f 6e20 6d61 7472  er rotation matr
+00014760: 6978 206d 7520 6162 6f75 7420 782d 6178  ix mu about x-ax
+00014770: 6973 2028 7269 6768 7420 6861 6e64 6564  is (right handed
+00014780: 290d 0a20 2020 2045 7175 6976 616c 656e  )..    Equivalen
+00014790: 7420 746f 2052 4f4c 4c20 696e 2074 6865  t to ROLL in the
+000147a0: 2054 6169 74e2 8093 4272 7961 6e20 636f   Tait...Bryan co
+000147b0: 6e76 656e 7469 6f6e 0d0a 2020 2020 4571  nvention..    Eq
+000147c0: 7569 7661 6c65 6e74 2074 6f20 6d75 2069  uivalent to mu i
+000147d0: 6e20 596f 7520 6574 2061 6c2e 2064 6966  n You et al. dif
+000147e0: 6672 6163 746f 6d65 7465 7220 636f 6e76  fractometer conv
+000147f0: 656e 7469 6f6e 2028 7269 6768 7420 6861  ention (right ha
+00014800: 6e64 6564 290d 0a20 2020 2020 2020 2072  nded)..        r
+00014810: 203d 2072 6f74 6d61 7472 6978 5f78 286d   = rotmatrix_x(m
+00014820: 7529 0d0a 2020 2020 2020 2020 7665 6327  u)..        vec'
+00014830: 203d 206e 702e 646f 7428 722c 2076 6563   = np.dot(r, vec
+00014840: 290d 0a20 2020 2076 6563 206d 7573 7420  )..    vec must 
+00014850: 6265 2031 4420 6f72 2063 6f6c 756d 6e20  be 1D or column 
+00014860: 7665 6374 6f72 2028 332a 6e29 0d0a 2020  vector (3*n)..  
+00014870: 2020 3a70 6172 616d 206d 753a 2066 6c6f    :param mu: flo
+00014880: 6174 2061 6e67 6c65 2069 6e20 6465 6772  at angle in degr
+00014890: 6565 730d 0a20 2020 203a 7265 7475 726e  ees..    :return
+000148a0: 3a20 5b33 2a33 5d20 6172 7261 790d 0a20  : [3*3] array.. 
+000148b0: 2020 2022 2222 0d0a 2020 2020 6d75 203d     """..    mu =
+000148c0: 206e 702e 6465 6732 7261 6428 6d75 290d   np.deg2rad(mu).
+000148d0: 0a20 2020 2063 203d 206e 702e 636f 7328  .    c = np.cos(
+000148e0: 6d75 290d 0a20 2020 2073 203d 206e 702e  mu)..    s = np.
+000148f0: 7369 6e28 6d75 290d 0a20 2020 2072 6574  sin(mu)..    ret
+00014900: 7572 6e20 6e70 2e61 7272 6179 285b 5b31  urn np.array([[1
+00014910: 2c20 302c 2030 5d2c 205b 302c 2063 2c20  , 0, 0], [0, c, 
+00014920: 2d73 5d2c 205b 302c 2073 2c20 635d 5d29  -s], [0, s, c]])
+00014930: 0d0a 0d0a 0d0a 6465 6620 6469 6666 7261  ......def diffra
+00014940: 6374 6f6d 6574 6572 5f72 6f74 6174 696f  ctometer_rotatio
+00014950: 6e28 7068 693d 302c 2063 6869 3d30 2c20  n(phi=0, chi=0, 
+00014960: 6574 613d 302c 206d 753d 3029 3a0d 0a20  eta=0, mu=0):.. 
+00014970: 2020 2022 2222 0d0a 2020 2020 4765 6e65     """..    Gene
+00014980: 7261 7465 2074 6865 2036 2d61 7869 7320  rate the 6-axis 
+00014990: 6469 6666 7261 636f 6d65 7465 7220 726f  diffracometer ro
+000149a0: 7461 7469 6f6e 206d 6174 7269 780d 0a20  tation matrix.. 
+000149b0: 2020 2020 2052 203d 204d 202a 2045 202a       R = M * E *
+000149c0: 2058 202a 2050 0d0a 2020 2020 416c 736f   X * P..    Also
+000149d0: 2063 616c 6c65 6420 5a20 696e 2048 2e20   called Z in H. 
+000149e0: 596f 752c 204a 2e20 4170 706c 2e20 4372  You, J. Appl. Cr
+000149f0: 7973 7420 3332 2028 3139 3939 292c 2036  yst 32 (1999), 6
+00014a00: 3134 2d36 3233 0d0a 2020 2020 5468 6520  14-623..    The 
+00014a10: 6469 6666 7261 6374 6f6d 6574 6572 2063  diffractometer c
+00014a20: 6f6f 7264 696e 6174 6520 7379 7374 656d  oordinate system
+00014a30: 2068 6173 2074 6865 2063 6f6e 7665 6e74   has the convent
+00014a40: 696f 6e20 2861 6c6c 2061 6e67 6c65 7320  ion (all angles 
+00014a50: 7a65 726f 293a 0d0a 2020 2020 2020 2020  zero):..        
+00014a60: 782d 6178 6973 2070 6f69 6e74 7320 7665  x-axis points ve
+00014a70: 7274 6963 616c 6c79 2c20 7065 7270 656e  rtically, perpen
+00014a80: 6469 6375 6c61 7220 746f 2062 6561 6d20  dicular to beam 
+00014a90: 286d 7520 6973 2061 626f 7574 2078 290d  (mu is about x).
+00014aa0: 0a20 2020 2020 2020 2079 2d61 7869 7320  .        y-axis 
+00014ab0: 706f 696e 7473 2061 6c6f 6e67 2074 6865  points along the
+00014ac0: 2064 6972 6563 7469 6f6e 206f 6620 7468   direction of th
+00014ad0: 6520 6265 616d 0d0a 2020 2020 2020 2020  e beam..        
+00014ae0: 7a2d 6178 6973 2070 6f69 6e74 7320 616c  z-axis points al
+00014af0: 6f6e 6720 7468 6520 7068 6920 6178 6973  ong the phi axis
+00014b00: 2c20 7065 7270 656e 6469 6375 6c61 7220  , perpendicular 
+00014b10: 746f 2078 2061 6e64 2079 0d0a 2020 2020  to x and y..    
+00014b20: 5468 6520 7665 7274 6963 616c 2073 6361  The vertical sca
+00014b30: 7474 6572 696e 6720 706c 616e 6520 6973  ttering plane is
+00014b40: 2069 6e20 7468 6520 792d 7820 6178 6973   in the y-x axis
+00014b50: 0d0a 2020 2020 5468 6520 686f 7269 7a6f  ..    The horizo
+00014b60: 6e74 616c 2073 6361 7474 6572 696e 6720  ntal scattering 
+00014b70: 706c 616e 6520 6973 2069 6e20 7468 6520  plane is in the 
+00014b80: 792d 7a20 6178 6973 0d0a 2020 2020 2020  y-z axis..      
+00014b90: 2076 6563 2720 3d20 6e70 2e64 6f74 2864   vec' = np.dot(d
+00014ba0: 6966 6672 6163 746f 6d65 7465 725f 726f  iffractometer_ro
+00014bb0: 7461 7469 6f6e 2870 6869 2c20 6368 692c  tation(phi, chi,
+00014bc0: 2065 7461 2c20 6d75 292c 2076 6563 290d   eta, mu), vec).
+00014bd0: 0a20 2020 2020 2020 7665 6320 6d75 7374  .       vec must
+00014be0: 2062 6520 3144 206f 7220 636f 6c75 6d6e   be 1D or column
+00014bf0: 2076 6563 746f 7220 2833 2a6e 290d 0a20   vector (3*n).. 
+00014c00: 2020 203a 7061 7261 6d20 7068 693a 2066     :param phi: f
+00014c10: 6c6f 6174 2061 6e67 6c65 2069 6e20 6465  loat angle in de
+00014c20: 6772 6565 732c 206c 6566 7420 6861 6e64  grees, left hand
+00014c30: 6564 2072 6f61 7469 6f6e 2061 626f 7574  ed roation about
+00014c40: 207a 2727 270d 0a20 2020 203a 7061 7261   z'''..    :para
+00014c50: 6d20 6368 693a 2066 6c6f 6174 2061 6e67  m chi: float ang
+00014c60: 6c65 2069 6e20 6465 6772 6565 732c 2072  le in degrees, r
+00014c70: 6967 6874 2068 616e 6465 6420 726f 7461  ight handed rota
+00014c80: 7469 6f6e 2061 626f 7574 2079 2727 0d0a  tion about y''..
+00014c90: 2020 2020 3a70 6172 616d 2065 7461 3a20      :param eta: 
+00014ca0: 666c 6f61 7420 616e 676c 6520 696e 2064  float angle in d
+00014cb0: 6567 7265 6573 2c20 6c65 6674 2068 616e  egrees, left han
+00014cc0: 6465 6420 726f 7461 7469 6f6e 2061 626f  ded rotation abo
+00014cd0: 7574 207a 270d 0a20 2020 203a 7061 7261  ut z'..    :para
+00014ce0: 6d20 6d75 3a20 666c 6f61 7420 616e 676c  m mu: float angl
+00014cf0: 6520 696e 2064 6567 7265 6573 2c20 7269  e in degrees, ri
+00014d00: 6768 7420 6861 6e64 6564 2072 6f74 6174  ght handed rotat
+00014d10: 696f 6e20 6162 6f75 7420 780d 0a20 2020  ion about x..   
+00014d20: 203a 7265 7475 726e 3a20 205b 332a 335d   :return:  [3*3]
+00014d30: 2061 7272 6179 0d0a 2020 2020 2222 220d   array..    """.
+00014d40: 0a20 2020 2050 203d 2072 6f74 6d61 7472  .    P = rotmatr
+00014d50: 6978 7a28 2d70 6869 2920 2023 206c 6566  ixz(-phi)  # lef
+00014d60: 7420 6861 6e64 6564 0d0a 2020 2020 5820  t handed..    X 
+00014d70: 3d20 726f 746d 6174 7269 7879 2863 6869  = rotmatrixy(chi
+00014d80: 290d 0a20 2020 2045 203d 2072 6f74 6d61  )..    E = rotma
+00014d90: 7472 6978 7a28 2d65 7461 2920 2023 206c  trixz(-eta)  # l
+00014da0: 6566 7420 6861 6e64 6564 0d0a 2020 2020  eft handed..    
+00014db0: 4d20 3d20 726f 746d 6174 7269 7878 286d  M = rotmatrixx(m
+00014dc0: 7529 0d0a 2020 2020 7265 7475 726e 206e  u)..    return n
+00014dd0: 702e 646f 7428 4d2c 206e 702e 646f 7428  p.dot(M, np.dot(
+00014de0: 452c 206e 702e 646f 7428 582c 2050 2929  E, np.dot(X, P))
+00014df0: 290d 0a0d 0a0d 0a64 6566 2064 6966 6632  )......def diff2
+00014e00: 6c61 6228 7665 632c 206c 6162 3d4e 6f6e  lab(vec, lab=Non
+00014e10: 6529 3a0d 0a20 2020 2022 2222 0d0a 2020  e):..    """..  
+00014e20: 2020 436f 6e76 6572 7420 6265 7477 6565    Convert betwee
+00014e30: 6e20 6469 6666 7261 6374 6f6d 6574 6572  n diffractometer
+00014e40: 2066 7261 6d65 2061 6e64 206c 6162 2066   frame and lab f
+00014e50: 7261 6d65 0d0a 2020 2020 4c61 6220 6672  rame..    Lab fr
+00014e60: 616d 6520 6163 636f 7264 696e 6720 746f  ame according to
+00014e70: 2044 6961 6d6f 6e64 2049 3136 2062 6561   Diamond I16 bea
+00014e80: 6d6c 696e 650d 0a20 2020 2044 6966 6672  mline..    Diffr
+00014e90: 6163 746f 6d65 7465 7220 6672 616d 6520  actometer frame 
+00014ea0: 6163 636f 7264 696e 6720 746f 2046 6967  according to Fig
+00014eb0: 2e20 312c 2048 2e20 596f 752c 204a 2e20  . 1, H. You, J. 
+00014ec0: 4170 706c 2e20 4372 7973 7420 3332 2028  Appl. Cryst 32 (
+00014ed0: 3139 3939 292c 2036 3134 2d36 3233 0d0a  1999), 614-623..
+00014ee0: 2020 2020 2020 7a2d 6178 6973 203a 2061        z-axis : a
+00014ef0: 7869 7320 7061 7261 6c6c 656c 2074 6f20  xis parallel to 
+00014f00: 7468 6520 7068 6920 726f 7461 7469 6f6e  the phi rotation
+00014f10: 2061 7869 7320 7768 656e 2061 6c6c 2061   axis when all a
+00014f20: 6e67 6c65 7320 3020 2874 6f77 6172 6473  ngles 0 (towards
+00014f30: 2077 616c 6c20 282b 7829 2069 6e20 6c61   wall (+x) in la
+00014f40: 6220 6672 616d 6529 0d0a 2020 2020 2020  b frame)..      
+00014f50: 782d 6178 6973 203a 2076 6563 746f 7220  x-axis : vector 
+00014f60: 6e6f 726d 616c 2074 6f20 7068 6920 6178  normal to phi ax
+00014f70: 6973 2077 6865 7265 2070 6869 3d30 2028  is where phi=0 (
+00014f80: 746f 7761 7264 2063 6569 6c69 6e67 2028  toward ceiling (
+00014f90: 2b79 2920 696e 206c 6162 2066 7261 6d65  +y) in lab frame
+00014fa0: 290d 0a20 2020 2020 2079 2d61 7869 7320  )..      y-axis 
+00014fb0: 3a20 7665 6374 6f72 206e 6f72 6d61 6c20  : vector normal 
+00014fc0: 746f 2078 2c7a 2061 7865 7320 2870 6172  to x,z axes (par
+00014fd0: 616c 6c65 6c20 746f 2062 6561 6d20 282b  allel to beam (+
+00014fe0: 7a29 2069 6e20 6c61 6220 6672 616d 6529  z) in lab frame)
+00014ff0: 0d0a 2020 2020 3a70 6172 616d 2076 6563  ..    :param vec
+00015000: 3a20 5b33 2a6e 5d20 6172 7261 7920 6f66  : [3*n] array of
+00015010: 2076 6563 746f 7273 0d0a 2020 2020 3a70   vectors..    :p
+00015020: 6172 616d 206c 6162 3a20 5b33 2a33 5d20  aram lab: [3*3] 
+00015030: 7472 616e 7366 6f72 6d61 7469 6f6e 206d  transformation m
+00015040: 6174 7269 782c 204e 6f6e 653d 2828 302c  atrix, None=((0,
+00015050: 312c 3029 2c28 302c 302c 3129 2c28 312c  1,0),(0,0,1),(1,
+00015060: 302c 3029 290d 0a20 2020 203a 7265 7475  0,0))..    :retu
+00015070: 726e 3a20 5b33 2a6e 5d20 6172 7261 7920  rn: [3*n] array 
+00015080: 6f66 2076 6563 746f 7273 0d0a 2020 2020  of vectors..    
+00015090: 2222 220d 0a20 2020 2069 6620 6c61 6220  """..    if lab 
+000150a0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+000150b0: 2020 6c61 6220 3d20 6e70 2e61 7272 6179    lab = np.array
+000150c0: 285b 5b30 2c20 302c 2031 5d2c 205b 312c  ([[0, 0, 1], [1,
+000150d0: 2030 2c20 305d 2c20 5b30 2c20 312c 2030   0, 0], [0, 1, 0
+000150e0: 5d5d 2920 2023 2028 785f 6c61 6220 7c7c  ]])  # (x_lab ||
+000150f0: 207a 5f64 6966 662c 2079 5f6c 6162 207c   z_diff, y_lab |
+00015100: 7c20 785f 6469 6666 2c20 7a5f 6c61 6220  | x_diff, z_lab 
+00015110: 7c7c 2079 5f64 6966 6629 0d0a 2020 2020  || y_diff)..    
+00015120: 7265 7475 726e 206e 702e 646f 7428 6c61  return np.dot(la
+00015130: 622c 206e 702e 7472 616e 7370 6f73 6528  b, np.transpose(
+00015140: 7665 6329 292e 540d 0a0d 0a0d 0a64 6566  vec)).T......def
+00015150: 206c 6162 7665 6374 6f72 2876 6563 2c20   labvector(vec, 
+00015160: 553d 4e6f 6e65 2c20 523d 4e6f 6e65 2c20  U=None, R=None, 
+00015170: 4c41 423d 4e6f 6e65 293a 0d0a 2020 2020  LAB=None):..    
+00015180: 2222 220d 0a20 2020 2054 7261 6e73 666f  """..    Transfo
+00015190: 726d 2061 6e79 2076 6563 746f 7220 7468  rm any vector th
+000151a0: 726f 7567 6820 7468 6520 6f72 6965 6e74  rough the orient
+000151b0: 6174 696f 6e2c 2072 6f74 6174 696f 6e20  ation, rotation 
+000151c0: 616e 6420 6c61 6220 7472 616e 7366 6f72  and lab transfor
+000151d0: 6d61 7469 6f6e 730d 0a20 2020 203a 7061  mations..    :pa
+000151e0: 7261 6d20 7665 633a 205b 6e2a 335d 2061  ram vec: [n*3] a
+000151f0: 7272 6179 206f 6620 7665 6374 6f72 7320  rray of vectors 
+00015200: 696e 2074 6865 2064 6966 6672 6163 746f  in the diffracto
+00015210: 6d65 7465 7220 6672 616d 650d 0a20 2020  meter frame..   
+00015220: 203a 7061 7261 6d20 553a 205b 332a 335d   :param U: [3*3]
+00015230: 206f 7269 7465 6e61 7469 6f6e 206d 6174   oritenation mat
+00015240: 7269 7820 2873 6565 2075 6d61 7472 6978  rix (see umatrix
+00015250: 290d 0a20 2020 203a 7061 7261 6d20 523a  )..    :param R:
+00015260: 205b 3378 335d 2072 6f74 6174 696f 6e20   [3x3] rotation 
+00015270: 6d61 7472 6978 2028 7365 6520 6469 6666  matrix (see diff
+00015280: 7261 6374 6f6d 6574 6572 5f72 6f74 6174  ractometer_rotat
+00015290: 696f 6e29 0d0a 2020 2020 3a70 6172 616d  ion)..    :param
+000152a0: 204c 4142 3a20 5b33 7833 5d20 7472 616e   LAB: [3x3] tran
+000152b0: 7366 6f72 6d61 7469 6f6e 206d 6174 7269  sformation matri
+000152c0: 7820 6265 7477 6565 6e20 6469 6666 7261  x between diffra
+000152d0: 6374 6f6d 6574 6572 2066 7261 6d65 2061  ctometer frame a
+000152e0: 6e64 206c 6162 2066 7261 6d65 0d0a 2020  nd lab frame..  
+000152f0: 2020 3a72 6574 7572 6e3a 205b 6e2a 335d    :return: [n*3]
+00015300: 2061 7272 6179 206f 6620 5120 7665 6374   array of Q vect
+00015310: 6f72 7320 696e 2074 6865 206c 6162 2063  ors in the lab c
+00015320: 6f6f 7264 696e 6174 6520 7379 7374 656d  oordinate system
+00015330: 0d0a 2020 2020 2222 220d 0a20 2020 2069  ..    """..    i
+00015340: 6620 5520 6973 204e 6f6e 653a 0d0a 2020  f U is None:..  
+00015350: 2020 2020 2020 5520 3d20 6e70 2e65 7965        U = np.eye
+00015360: 2833 290d 0a20 2020 2069 6620 5220 6973  (3)..    if R is
+00015370: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00015380: 5220 3d20 6e70 2e65 7965 2833 290d 0a20  R = np.eye(3).. 
+00015390: 2020 2069 6620 4c41 4220 6973 204e 6f6e     if LAB is Non
+000153a0: 653a 0d0a 2020 2020 2020 2020 4c41 4220  e:..        LAB 
+000153b0: 3d20 6e70 2e61 7272 6179 285b 5b30 2c20  = np.array([[0, 
+000153c0: 302c 2031 5d2c 205b 312c 2030 2c20 305d  0, 1], [1, 0, 0]
+000153d0: 2c20 5b30 2c20 312c 2030 5d5d 2920 2023  , [0, 1, 0]])  #
+000153e0: 2028 785f 6c61 6220 7c7c 207a 5f64 6966   (x_lab || z_dif
+000153f0: 662c 2079 5f6c 6162 207c 7c20 785f 6469  f, y_lab || x_di
+00015400: 6666 2c20 7a5f 6c61 6220 7c7c 2079 5f64  ff, z_lab || y_d
+00015410: 6966 6629 0d0a 2020 2020 7265 7475 726e  iff)..    return
+00015420: 206e 702e 646f 7428 4c41 422c 206e 702e   np.dot(LAB, np.
+00015430: 646f 7428 522c 206e 702e 646f 7428 552c  dot(R, np.dot(U,
+00015440: 206e 702e 7472 616e 7370 6f73 6528 7665   np.transpose(ve
+00015450: 6329 2929 292e 540d 0a0d 0a0d 0a64 6566  c)))).T......def
+00015460: 206c 6162 7761 7665 7665 6374 6f72 2868   labwavevector(h
+00015470: 6b6c 2c20 5556 2c20 553d 4e6f 6e65 2c20  kl, UV, U=None, 
+00015480: 523d 4e6f 6e65 2c20 4c41 423d 4e6f 6e65  R=None, LAB=None
+00015490: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+000154a0: 2043 616c 6375 6c61 7465 2074 6865 206c   Calculate the l
+000154b0: 6162 2077 6176 6576 6563 746f 7220 7573  ab wavevector us
+000154c0: 696e 6720 7468 6520 756e 6974 2d76 6563  ing the unit-vec
+000154d0: 746f 722c 206f 7269 7465 6e61 7469 6f6e  tor, oritenation
+000154e0: 206d 6174 7269 7820 616e 6420 726f 7461   matrix and rota
+000154f0: 7469 6f6e 206d 6174 7269 780d 0a20 2020  tion matrix..   
+00015500: 2052 6574 7572 6e73 2076 6563 746f 7273   Returns vectors
+00015510: 2069 6e20 7468 6520 6c61 6220 636f 6f72   in the lab coor
+00015520: 6469 6e61 7465 2073 7973 7465 6d2c 2062  dinate system, b
+00015530: 7920 6465 6661 756c 7420 6465 6669 6e65  y default define
+00015540: 6420 6c69 6b65 2044 6961 6d6f 6e64 204c  d like Diamond L
+00015550: 6967 6874 2053 6f75 7263 653a 0d0a 2020  ight Source:..  
+00015560: 2020 2020 782d 6178 6973 203a 2061 7761      x-axis : awa
+00015570: 7920 6672 6f6d 2073 796e 6368 726f 7472  y from synchrotr
+00015580: 6f6e 2072 696e 672c 2074 6f77 6172 6473  on ring, towards
+00015590: 2077 616c 6c0d 0a20 2020 2020 2079 2d61   wall..      y-a
+000155a0: 7869 7320 3a20 746f 7761 7264 7320 6365  xis : towards ce
+000155b0: 696c 696e 670d 0a20 2020 2020 207a 2d61  iling..      z-a
+000155c0: 7869 7320 3a20 616c 6f6e 6720 6265 616d  xis : along beam
+000155d0: 2064 6972 6563 7469 6f6e 0d0a 2020 2020   direction..    
+000155e0: 3a70 6172 616d 2068 6b6c 3a20 5b33 786e  :param hkl: [3xn
+000155f0: 5d20 6172 7261 7920 6f66 2028 682c 206b  ] array of (h, k
+00015600: 2c20 6c29 2072 6563 6970 726f 6361 6c20  , l) reciprocal 
+00015610: 6c61 7474 6963 6520 7665 6374 6f72 730d  lattice vectors.
+00015620: 0a20 2020 203a 7061 7261 6d20 5556 3a20  .    :param UV: 
+00015630: 5b33 2a33 5d20 556e 6974 2d76 6563 746f  [3*3] Unit-vecto
+00015640: 7220 6d61 7472 6978 2028 7365 6520 6c61  r matrix (see la
+00015650: 7470 6172 3275 625f 726f 7429 0d0a 2020  tpar2ub_rot)..  
+00015660: 2020 3a70 6172 616d 2055 3a20 5b33 2a33    :param U: [3*3
+00015670: 5d20 6f72 6974 656e 6174 696f 6e20 6d61  ] oritenation ma
+00015680: 7472 6978 2028 7365 6520 756d 6174 7269  trix (see umatri
+00015690: 7829 0d0a 2020 2020 3a70 6172 616d 2052  x)..    :param R
+000156a0: 3a20 5b33 7833 5d20 726f 7461 7469 6f6e  : [3x3] rotation
+000156b0: 206d 6174 7269 7820 2873 6565 2064 6966   matrix (see dif
+000156c0: 6672 6163 746f 6d65 7465 725f 726f 7461  fractometer_rota
+000156d0: 7469 6f6e 290d 0a20 2020 203a 7061 7261  tion)..    :para
+000156e0: 6d20 4c41 423a 205b 3378 335d 2074 7261  m LAB: [3x3] tra
+000156f0: 6e73 666f 726d 6174 696f 6e20 6d61 7472  nsformation matr
+00015700: 6978 2062 6574 7765 656e 2064 6966 6672  ix between diffr
+00015710: 6163 746f 6d65 7465 7220 6672 616d 6520  actometer frame 
+00015720: 616e 6420 6c61 6220 6672 616d 650d 0a20  and lab frame.. 
+00015730: 2020 203a 7265 7475 726e 3a20 5b33 786e     :return: [3xn
+00015740: 5d20 6172 7261 7920 6f66 2051 2076 6563  ] array of Q vec
+00015750: 746f 7273 2069 6e20 7468 6520 6c61 6220  tors in the lab 
+00015760: 636f 6f72 6469 6e61 7465 2073 7973 7465  coordinate syste
+00015770: 6d0d 0a20 2020 2022 2222 0d0a 2020 2020  m..    """..    
+00015780: 6966 2055 2069 7320 4e6f 6e65 3a0d 0a20  if U is None:.. 
+00015790: 2020 2020 2020 2055 203d 206e 702e 6579         U = np.ey
+000157a0: 6528 3329 0d0a 2020 2020 6966 2052 2069  e(3)..    if R i
+000157b0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+000157c0: 2052 203d 206e 702e 6579 6528 3329 0d0a   R = np.eye(3)..
+000157d0: 2020 2020 6966 204c 4142 2069 7320 4e6f      if LAB is No
+000157e0: 6e65 3a0d 0a20 2020 2020 2020 204c 4142  ne:..        LAB
+000157f0: 203d 206e 702e 6172 7261 7928 5b5b 302c   = np.array([[0,
+00015800: 2030 2c20 315d 2c20 5b31 2c20 302c 2030   0, 1], [1, 0, 0
+00015810: 5d2c 205b 302c 2031 2c20 305d 5d29 2020  ], [0, 1, 0]])  
+00015820: 2320 2878 5f6c 6162 207c 7c20 7a5f 6469  # (x_lab || z_di
+00015830: 6666 2c20 795f 6c61 6220 7c7c 2078 5f64  ff, y_lab || x_d
+00015840: 6966 662c 207a 5f6c 6162 207c 7c20 795f  iff, z_lab || y_
+00015850: 6469 6666 290d 0a20 2020 2042 203d 2042  diff)..    B = B
+00015860: 6d61 7472 6978 2855 5629 0d0a 2020 2020  matrix(UV)..    
+00015870: 7265 7475 726e 206e 702e 646f 7428 4c41  return np.dot(LA
+00015880: 422c 206e 702e 646f 7428 522c 206e 702e  B, np.dot(R, np.
+00015890: 646f 7428 552c 206e 702e 646f 7428 422c  dot(U, np.dot(B,
+000158a0: 206e 702e 7472 616e 7370 6f73 6528 686b   np.transpose(hk
+000158b0: 6c29 2929 2929 2e54 0d0a 0d0a 0d0a 6465  l))))).T......de
+000158c0: 6620 6469 6666 3663 6972 636c 6571 2864  f diff6circleq(d
+000158d0: 656c 7461 2c20 6761 6d6d 612c 2065 6e65  elta, gamma, ene
+000158e0: 7267 795f 6b65 763d 4e6f 6e65 2c20 7761  rgy_kev=None, wa
+000158f0: 7665 6c65 6e67 7468 3d31 2e30 2c20 6c61  velength=1.0, la
+00015900: 623d 4e6f 6e65 293a 0d0a 2020 2020 2222  b=None):..    ""
+00015910: 220d 0a20 2020 2043 616c 6375 616c 7465  "..    Calcualte
+00015920: 2077 6176 6576 6563 746f 7220 696e 2064   wavevector in d
+00015930: 6966 6672 6163 746f 6d65 7465 7220 6178  iffractometer ax
+00015940: 6973 2075 7369 6e67 2064 6574 6563 746f  is using detecto
+00015950: 7220 616e 676c 6573 0d0a 2020 2020 3a70  r angles..    :p
+00015960: 6172 616d 2064 656c 7461 3a20 666c 6f61  aram delta: floa
+00015970: 7420 616e 676c 6520 696e 2064 6567 7265  t angle in degre
+00015980: 6573 2069 6e20 7665 7274 6963 616c 2064  es in vertical d
+00015990: 6972 6563 7469 6f6e 2028 6162 6f75 7420  irection (about 
+000159a0: 6469 6666 2d7a 290d 0a20 2020 203a 7061  diff-z)..    :pa
+000159b0: 7261 6d20 6761 6d6d 613a 2066 6c6f 6174  ram gamma: float
+000159c0: 2061 6e67 6c65 2069 6e20 6465 6772 6565   angle in degree
+000159d0: 7320 696e 2068 6f72 697a 6f6e 7461 6c20  s in horizontal 
+000159e0: 6469 7265 6374 696f 6e20 2861 626f 7574  direction (about
+000159f0: 2064 6966 662d 7829 0d0a 2020 2020 3a70   diff-x)..    :p
+00015a00: 6172 616d 2065 6e65 7267 795f 6b65 763a  aram energy_kev:
+00015a10: 2066 6c6f 6174 2065 6e65 7267 7920 696e   float energy in
+00015a20: 204b 6556 0d0a 2020 2020 3a70 6172 616d   KeV..    :param
+00015a30: 2077 6176 656c 656e 6774 683a 2066 6c6f   wavelength: flo
+00015a40: 6174 2077 6176 656c 656e 6774 6820 696e  at wavelength in
+00015a50: 2041 0d0a 2020 2020 3a70 6172 616d 206c   A..    :param l
+00015a60: 6162 3a20 5b33 2a33 5d20 6c61 6220 7472  ab: [3*3] lab tr
+00015a70: 616e 7366 6f72 6d61 7469 6f6e 206d 6174  ansformation mat
+00015a80: 7269 780d 0a20 2020 203a 7265 7475 726e  rix..    :return
+00015a90: 3a20 5b31 2a33 5d0d 0a20 2020 2022 2222  : [1*3]..    """
+00015aa0: 0d0a 2020 2020 6966 2065 6e65 7267 795f  ..    if energy_
+00015ab0: 6b65 7620 6973 206e 6f74 204e 6f6e 653a  kev is not None:
+00015ac0: 0d0a 2020 2020 2020 2020 7761 7665 6c65  ..        wavele
+00015ad0: 6e67 7468 203d 2065 6e65 7267 7932 7761  ngth = energy2wa
+00015ae0: 7665 2865 6e65 7267 795f 6b65 7629 0d0a  ve(energy_kev)..
+00015af0: 0d0a 2020 2020 6b20 3d20 3220 2a20 6e70  ..    k = 2 * np
+00015b00: 2e70 6920 2f20 7761 7665 6c65 6e67 7468  .pi / wavelength
+00015b10: 0d0a 2020 2020 6465 6c74 6120 3d20 6e70  ..    delta = np
+00015b20: 2e64 6567 3272 6164 2864 656c 7461 290d  .deg2rad(delta).
+00015b30: 0a20 2020 2067 616d 6d61 203d 206e 702e  .    gamma = np.
+00015b40: 6465 6732 7261 6428 6761 6d6d 6129 0d0a  deg2rad(gamma)..
+00015b50: 2020 2020 7364 203d 206e 702e 7369 6e28      sd = np.sin(
+00015b60: 6465 6c74 6129 0d0a 2020 2020 6364 203d  delta)..    cd =
+00015b70: 206e 702e 636f 7328 6465 6c74 6129 0d0a   np.cos(delta)..
+00015b80: 2020 2020 7367 203d 206e 702e 7369 6e28      sg = np.sin(
+00015b90: 6761 6d6d 6129 0d0a 2020 2020 6367 203d  gamma)..    cg =
+00015ba0: 206e 702e 636f 7328 6761 6d6d 6129 0d0a   np.cos(gamma)..
+00015bb0: 2020 2020 7265 7475 726e 2064 6966 6632      return diff2
+00015bc0: 6c61 6228 6b20 2a20 6e70 2e61 7272 6179  lab(k * np.array
+00015bd0: 285b 7364 2c20 6364 202a 2063 6720 2d20  ([sd, cd * cg - 
+00015be0: 312c 2063 6420 2a20 7367 5d29 2c20 6c61  1, cd * sg]), la
+00015bf0: 6229 0d0a 0d0a 0d0a 6465 6620 6469 6666  b)......def diff
+00015c00: 3663 6972 636c 656b 2864 656c 7461 2c20  6circlek(delta, 
+00015c10: 6761 6d6d 612c 2065 6e65 7267 795f 6b65  gamma, energy_ke
+00015c20: 763d 4e6f 6e65 2c20 7761 7665 6c65 6e67  v=None, waveleng
+00015c30: 7468 3d31 2e30 2c20 6c61 623d 4e6f 6e65  th=1.0, lab=None
+00015c40: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+00015c50: 2043 616c 6375 616c 7465 2069 6e63 6964   Calcualte incid
+00015c60: 656e 7420 616e 6420 6669 6e61 6c20 7761  ent and final wa
+00015c70: 7665 7665 6374 6f72 7320 696e 2064 6966  vevectors in dif
+00015c80: 6672 6163 746f 6d65 7465 7220 6178 6973  fractometer axis
+00015c90: 2075 7369 6e67 2064 6574 6563 746f 7220   using detector 
+00015ca0: 616e 676c 6573 0d0a 2020 2020 3a70 6172  angles..    :par
+00015cb0: 616d 2064 656c 7461 3a20 666c 6f61 7420  am delta: float 
+00015cc0: 616e 676c 6520 696e 2064 6567 7265 6573  angle in degrees
+00015cd0: 2069 6e20 7665 7274 6963 616c 2064 6972   in vertical dir
+00015ce0: 6563 7469 6f6e 2028 6162 6f75 7420 6469  ection (about di
+00015cf0: 6666 2d7a 290d 0a20 2020 203a 7061 7261  ff-z)..    :para
+00015d00: 6d20 6761 6d6d 613a 2066 6c6f 6174 2061  m gamma: float a
+00015d10: 6e67 6c65 2069 6e20 6465 6772 6565 7320  ngle in degrees 
+00015d20: 696e 2068 6f72 697a 6f6e 7461 6c20 6469  in horizontal di
+00015d30: 7265 6374 696f 6e20 2861 626f 7574 2064  rection (about d
+00015d40: 6966 662d 7829 0d0a 2020 2020 3a70 6172  iff-x)..    :par
+00015d50: 616d 2065 6e65 7267 795f 6b65 763a 2066  am energy_kev: f
+00015d60: 6c6f 6174 2065 6e65 7267 7920 696e 204b  loat energy in K
+00015d70: 6556 0d0a 2020 2020 3a70 6172 616d 2077  eV..    :param w
+00015d80: 6176 656c 656e 6774 683a 2066 6c6f 6174  avelength: float
+00015d90: 2077 6176 656c 656e 6774 6820 696e 2041   wavelength in A
+00015da0: 0d0a 2020 2020 3a70 6172 616d 206c 6162  ..    :param lab
+00015db0: 3a20 5b33 2a33 5d20 6c61 6220 7472 616e  : [3*3] lab tran
+00015dc0: 7366 6f72 6d61 7469 6f6e 206d 6174 7269  sformation matri
+00015dd0: 780d 0a20 2020 203a 7265 7475 726e 3a20  x..    :return: 
+00015de0: 5b31 2a33 5d2c 205b 312a 335d 203a 206b  [1*3], [1*3] : k
+00015df0: 692c 206b 660d 0a20 2020 2022 2222 0d0a  i, kf..    """..
+00015e00: 2020 2020 6966 2065 6e65 7267 795f 6b65      if energy_ke
+00015e10: 7620 6973 206e 6f74 204e 6f6e 653a 0d0a  v is not None:..
+00015e20: 2020 2020 2020 2020 7761 7665 6c65 6e67          waveleng
+00015e30: 7468 203d 2065 6e65 7267 7932 7761 7665  th = energy2wave
+00015e40: 2865 6e65 7267 795f 6b65 7629 0d0a 0d0a  (energy_kev)....
+00015e50: 2020 2020 6b20 3d20 3220 2a20 6e70 2e70      k = 2 * np.p
+00015e60: 6920 2f20 7761 7665 6c65 6e67 7468 0d0a  i / wavelength..
+00015e70: 2020 2020 2320 7120 3d20 6b66 202d 206b      # q = kf - k
+00015e80: 690d 0a20 2020 2071 203d 2064 6966 6636  i..    q = diff6
+00015e90: 6369 7263 6c65 7128 6465 6c74 612c 2067  circleq(delta, g
+00015ea0: 616d 6d61 2c20 656e 6572 6779 5f6b 6576  amma, energy_kev
+00015eb0: 2c20 7761 7665 6c65 6e67 7468 2c20 6c61  , wavelength, la
+00015ec0: 6229 0d0a 2020 2020 6b69 203d 206b 202a  b)..    ki = k *
+00015ed0: 2064 6966 6632 6c61 6228 5b30 2c20 312c   diff2lab([0, 1,
+00015ee0: 2030 5d2c 206c 6162 290d 0a20 2020 206b   0], lab)..    k
+00015ef0: 6620 3d20 7120 2b20 6b69 0d0a 2020 2020  f = q + ki..    
+00015f00: 7265 7475 726e 206b 692c 206b 660d 0a0d  return ki, kf...
+00015f10: 0a0d 0a64 6566 2064 6966 6636 6369 7263  ...def diff6circ
+00015f20: 6c65 3268 6b6c 2875 622c 2070 6869 3d30  le2hkl(ub, phi=0
+00015f30: 2c20 6368 693d 302c 2065 7461 3d30 2c20  , chi=0, eta=0, 
+00015f40: 6d75 3d30 2c20 6465 6c74 613d 302c 2067  mu=0, delta=0, g
+00015f50: 616d 6d61 3d30 2c20 656e 6572 6779 5f6b  amma=0, energy_k
+00015f60: 6576 3d4e 6f6e 652c 2077 6176 656c 656e  ev=None, wavelen
+00015f70: 6774 683d 312e 302c 206c 6162 3d4e 6f6e  gth=1.0, lab=Non
+00015f80: 6529 3a0d 0a20 2020 2022 2222 0d0a 2020  e):..    """..  
+00015f90: 2020 5265 7475 726e 205b 682c 6b2c 6c5d    Return [h,k,l]
+00015fa0: 2070 6f73 6974 696f 6e20 6f66 2064 6966   position of dif
+00015fb0: 6672 6163 746f 6d65 7465 7220 6178 6573  fractometer axes
+00015fc0: 2077 6974 6820 6769 7665 6e20 5542 2061   with given UB a
+00015fd0: 6e64 2065 6e65 7267 790d 0a20 2020 203a  nd energy..    :
+00015fe0: 7061 7261 6d20 7562 3a20 5b33 2a33 5d20  param ub: [3*3] 
+00015ff0: 6172 7261 7920 5542 206f 7269 656e 7461  array UB orienta
+00016000: 7469 6f6e 206d 6174 7269 7820 666f 6c6c  tion matrix foll
+00016010: 6f77 696e 6720 4275 7369 6e67 2026 204c  owing Busing & L
+00016020: 6576 790d 0a20 2020 203a 7061 7261 6d20  evy..    :param 
+00016030: 7068 693a 2066 6c6f 6174 2073 616d 706c  phi: float sampl
+00016040: 6520 616e 676c 6520 696e 2064 6567 7265  e angle in degre
+00016050: 6573 0d0a 2020 2020 3a70 6172 616d 2063  es..    :param c
+00016060: 6869 3a20 666c 6f61 7420 7361 6d70 6c65  hi: float sample
+00016070: 2061 6e67 6c65 2069 6e20 6465 6772 6565   angle in degree
+00016080: 730d 0a20 2020 203a 7061 7261 6d20 6574  s..    :param et
+00016090: 613a 2066 6c6f 6174 2073 616d 706c 6520  a: float sample 
+000160a0: 616e 676c 6520 696e 2064 6567 7265 6573  angle in degrees
+000160b0: 0d0a 2020 2020 3a70 6172 616d 206d 753a  ..    :param mu:
+000160c0: 2066 6c6f 6174 2073 616d 706c 6520 616e   float sample an
+000160d0: 676c 6520 696e 2064 6567 7265 6573 0d0a  gle in degrees..
+000160e0: 2020 2020 3a70 6172 616d 2064 656c 7461      :param delta
+000160f0: 3a20 666c 6f61 7420 6465 7465 6374 6f72  : float detector
+00016100: 2061 6e67 6c65 2069 6e20 6465 6772 6565   angle in degree
+00016110: 730d 0a20 2020 203a 7061 7261 6d20 6761  s..    :param ga
+00016120: 6d6d 613a 2066 6c6f 6174 2064 6574 6563  mma: float detec
+00016130: 746f 7220 616e 676c 6520 696e 2064 6567  tor angle in deg
+00016140: 7265 6573 0d0a 2020 2020 3a70 6172 616d  rees..    :param
+00016150: 2065 6e65 7267 795f 6b65 763a 2066 6c6f   energy_kev: flo
+00016160: 6174 2065 6e65 7267 7920 696e 204b 6556  at energy in KeV
+00016170: 0d0a 2020 2020 3a70 6172 616d 2077 6176  ..    :param wav
+00016180: 656c 656e 6774 683a 2066 6c6f 6174 2077  elength: float w
+00016190: 6176 656c 656e 6774 6820 696e 2041 0d0a  avelength in A..
+000161a0: 2020 2020 3a70 6172 616d 206c 6162 3a20      :param lab: 
+000161b0: 5b33 2a33 5d20 6c61 6220 7472 616e 7366  [3*3] lab transf
+000161c0: 6f72 6d61 7469 6f6e 206d 6174 7269 780d  ormation matrix.
+000161d0: 0a20 2020 203a 7265 7475 726e 3a20 5b68  .    :return: [h
+000161e0: 2c6b 2c6c 5d0d 0a20 2020 2022 2222 0d0a  ,k,l]..    """..
+000161f0: 2020 2020 7120 3d20 6469 6666 3663 6972      q = diff6cir
+00016200: 636c 6571 2864 656c 7461 2c20 6761 6d6d  cleq(delta, gamm
+00016210: 612c 2065 6e65 7267 795f 6b65 762c 2077  a, energy_kev, w
+00016220: 6176 656c 656e 6774 682c 206c 6162 2920  avelength, lab) 
+00016230: 2023 2059 6f75 2051 6c20 2831 3229 0d0a   # You Ql (12)..
+00016240: 2020 2020 7a20 3d20 6469 6666 7261 6374      z = diffract
+00016250: 6f6d 6574 6572 5f72 6f74 6174 696f 6e28  ometer_rotation(
+00016260: 7068 692c 2063 6869 2c20 6574 612c 206d  phi, chi, eta, m
+00016270: 7529 2020 2320 596f 7520 5a20 2831 3329  u)  # You Z (13)
+00016280: 0d0a 0d0a 2020 2020 696e 765f 7562 203d  ....    inv_ub =
+00016290: 206e 702e 6c69 6e61 6c67 2e69 6e76 2875   np.linalg.inv(u
+000162a0: 6229 0d0a 2020 2020 696e 765f 7a20 3d20  b)..    inv_z = 
+000162b0: 6e70 2e6c 696e 616c 672e 696e 7628 7a29  np.linalg.inv(z)
+000162c0: 0d0a 0d0a 2020 2020 6870 6869 203d 206e  ....    hphi = n
+000162d0: 702e 646f 7428 696e 765f 7a2c 2071 290d  p.dot(inv_z, q).
+000162e0: 0a20 2020 2072 6574 7572 6e20 6e70 2e64  .    return np.d
+000162f0: 6f74 2869 6e76 5f75 622c 2068 7068 6929  ot(inv_ub, hphi)
+00016300: 2e54 0d0a 0d0a 0d0a 6465 6620 6d61 7848  .T......def maxH
+00016310: 4b4c 2851 6d61 782c 2055 5629 3a0d 0a20  KL(Qmax, UV):.. 
+00016320: 2020 2022 2222 0d0a 2020 2020 5265 7475     """..    Retu
+00016330: 726e 7320 7468 6520 6d61 7869 6d75 6d20  rns the maximum 
+00016340: 696e 6465 7865 7320 666f 7220 6769 7665  indexes for give
+00016350: 6e20 6d61 7820 7261 6469 7573 0d0a 2020  n max radius..  
+00016360: 2020 652e 672e 0d0a 2020 2020 2020 2020    e.g...        
+00016370: 5556 7374 6172 203d 2052 6353 7028 5b5b  UVstar = RcSp([[
+00016380: 332c 302c 305d 2c5b 302c 332c 305d 2c5b  3,0,0],[0,3,0],[
+00016390: 302c 302c 3130 5d5d 2920 2320 415e 2d31  0,0,10]]) # A^-1
+000163a0: 0d0a 2020 2020 2020 2020 516d 6178 203d  ..        Qmax =
+000163b0: 2034 2e35 2023 2041 5e2d 310d 0a20 2020   4.5 # A^-1..   
+000163c0: 2020 2020 206d 6178 5f68 6b6c 203d 206d       max_hkl = m
+000163d0: 6178 484b 4c28 516d 6178 2c55 5673 7461  axHKL(Qmax,UVsta
+000163e0: 7229 0d0a 2020 2020 2020 2020 6d61 785f  r)..        max_
+000163f0: 686b 6c20 3d0d 0a20 2020 2020 2020 203e  hkl =..        >
+00016400: 3e3e 205b 332c 332c 385d 0d0a 2020 2020  >> [3,3,8]..    
+00016410: 2222 220d 0a0d 0a20 2020 2051 706f 7320  """....    Qpos 
+00016420: 3d20 5b5b 516d 6178 2c20 516d 6178 2c20  = [[Qmax, Qmax, 
+00016430: 516d 6178 5d2c 0d0a 2020 2020 2020 2020  Qmax],..        
+00016440: 2020 2020 5b2d 516d 6178 2c20 516d 6178      [-Qmax, Qmax
+00016450: 2c20 516d 6178 5d2c 0d0a 2020 2020 2020  , Qmax],..      
+00016460: 2020 2020 2020 5b51 6d61 782c 202d 516d        [Qmax, -Qm
+00016470: 6178 2c20 516d 6178 5d2c 0d0a 2020 2020  ax, Qmax],..    
+00016480: 2020 2020 2020 2020 5b2d 516d 6178 2c20          [-Qmax, 
+00016490: 2d51 6d61 782c 2051 6d61 785d 2c0d 0a20  -Qmax, Qmax],.. 
+000164a0: 2020 2020 2020 2020 2020 205b 516d 6178             [Qmax
+000164b0: 2c20 516d 6178 2c20 2d51 6d61 785d 2c0d  , Qmax, -Qmax],.
+000164c0: 0a20 2020 2020 2020 2020 2020 205b 2d51  .            [-Q
+000164d0: 6d61 782c 2051 6d61 782c 202d 516d 6178  max, Qmax, -Qmax
+000164e0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+000164f0: 5b51 6d61 782c 202d 516d 6178 2c20 2d51  [Qmax, -Qmax, -Q
+00016500: 6d61 785d 2c0d 0a20 2020 2020 2020 2020  max],..         
+00016510: 2020 205b 2d51 6d61 782c 202d 516d 6178     [-Qmax, -Qmax
+00016520: 2c20 2d51 6d61 785d 5d0d 0a20 2020 2068  , -Qmax]]..    h
+00016530: 6b6c 203d 2069 6e64 7828 5170 6f73 2c20  kl = indx(Qpos, 
+00016540: 5556 290d 0a20 2020 2072 6574 7572 6e20  UV)..    return 
+00016550: 6e70 2e63 6569 6c28 6e70 2e61 6273 2868  np.ceil(np.abs(h
+00016560: 6b6c 292e 6d61 7828 6178 6973 3d30 2929  kl).max(axis=0))
+00016570: 2e61 7374 7970 6528 696e 7429 0d0a 0d0a  .astype(int)....
+00016580: 0d0a 6465 6620 6765 6e48 4b4c 2848 2c20  ..def genHKL(H, 
+00016590: 4b3d 4e6f 6e65 2c20 4c3d 4e6f 6e65 293a  K=None, L=None):
+000165a0: 0d0a 2020 2020 2222 220d 0a20 2020 2047  ..    """..    G
+000165b0: 656e 6572 6174 6520 484b 4c20 6172 7261  enerate HKL arra
+000165c0: 7920 7769 7468 2061 6c6c 2063 6f6d 6269  y with all combi
+000165d0: 6e61 7469 6f6e 7320 7769 7468 696e 2072  nations within r
+000165e0: 616e 6765 2073 7065 6369 6669 6564 0d0a  ange specified..
+000165f0: 2020 2020 5573 6167 653a 0d0a 2020 2020      Usage:..    
+00016600: 2020 484b 4c20 3d20 6765 6e48 4b4c 286d    HKL = genHKL(m
+00016610: 6178 290d 0a20 2020 2020 2020 696e 7420  ax)..       int 
+00016620: 6d61 7820 3d20 6765 6e65 7261 7465 7320  max = generates 
+00016630: 6561 6368 2068 2c6b 2c6c 2066 726f 6d20  each h,k,l from 
+00016640: 2d6d 6178 2074 6f20 6d61 780d 0a20 2020  -max to max..   
+00016650: 2020 2048 4b4c 203d 2067 656e 484b 4c28     HKL = genHKL(
+00016660: 5b6d 696e 2c6d 6178 5d29 0d0a 2020 2020  [min,max])..    
+00016670: 2020 2069 6e74 206d 696e 2c20 696e 7420     int min, int 
+00016680: 6d61 7820 3d20 6765 6e65 7261 7465 7320  max = generates 
+00016690: 682c 6c2c 6c20 6672 6f6d 206d 696e 2074  h,l,l from min t
+000166a0: 6f20 6d61 780d 0a20 2020 2020 2048 4b4c  o max..      HKL
+000166b0: 203d 2067 656e 484b 4c28 5b68 6d69 6e2c   = genHKL([hmin,
+000166c0: 686d 6178 5d2c 5b6b 6d69 6e2c 6b6d 6178  hmax],[kmin,kmax
+000166d0: 5d2c 5b6c 6d69 6e2c 6c6d 6178 5d29 0d0a  ],[lmin,lmax])..
+000166e0: 2020 2020 2020 2068 6d69 6e2c 686d 6178         hmin,hmax
+000166f0: 203d 206d 696e 2061 6e64 206d 6178 2076   = min and max v
+00016700: 616c 7565 7320 666f 7220 682c 206b 2061  alues for h, k a
+00016710: 6e64 206c 2072 6573 7065 6374 6976 6c65  nd l respectivle
+00016720: 790d 0a0d 0a20 2020 2020 2061 7272 6179  y....      array
+00016730: 2048 4b4c 203d 205b 5b6e 7833 5d5d 2061   HKL = [[nx3]] a
+00016740: 7272 6179 206f 6620 5b68 2c6b 2c6c 5d20  rray of [h,k,l] 
+00016750: 7665 6374 6f72 730d 0a0d 0a20 2020 2045  vectors....    E
+00016760: 2e47 2e0d 0a20 2020 2020 2048 4b4c 203d  .G...      HKL =
+00016770: 2067 656e 484b 4c28 2d33 290d 0a20 2020   genHKL(-3)..   
+00016780: 2045 2e47 2e0d 0a20 2020 2020 2048 4b4c   E.G...      HKL
+00016790: 203d 2067 656e 484b 4c28 5b2d 312c 315d   = genHKL([-1,1]
+000167a0: 290d 0a20 2020 2045 2e47 2e0d 0a20 2020  )..    E.G...   
+000167b0: 2020 2048 4b4c 203d 2067 656e 484b 4c28     HKL = genHKL(
+000167c0: 5b2d 322c 325d 2c5b 302c 335d 2c5b 312c  [-2,2],[0,3],[1,
+000167d0: 315d 290d 0a20 2020 2022 2222 0d0a 0d0a  1])..    """....
+000167e0: 2020 2020 6966 204b 2069 7320 4e6f 6e65      if K is None
+000167f0: 3a20 4b20 3d20 480d 0a20 2020 2069 6620  : K = H..    if 
+00016800: 4c20 6973 204e 6f6e 653a 204c 203d 2048  L is None: L = H
+00016810: 0d0a 0d0a 2020 2020 4820 3d20 6e70 2e61  ....    H = np.a
+00016820: 7361 7272 6179 2848 290d 0a20 2020 204b  sarray(H)..    K
+00016830: 203d 206e 702e 6173 6172 7261 7928 4b29   = np.asarray(K)
+00016840: 0d0a 2020 2020 4c20 3d20 6e70 2e61 7361  ..    L = np.asa
+00016850: 7272 6179 284c 290d 0a0d 0a20 2020 2069  rray(L)....    i
+00016860: 6620 482e 7369 7a65 203d 3d20 313a 0d0a  f H.size == 1:..
+00016870: 2020 2020 2020 2020 4820 3d20 6e70 2e61          H = np.a
+00016880: 7272 6179 285b 482c 202d 485d 290d 0a20  rray([H, -H]).. 
+00016890: 2020 2069 6620 4b2e 7369 7a65 203d 3d20     if K.size == 
+000168a0: 313a 0d0a 2020 2020 2020 2020 4b20 3d20  1:..        K = 
+000168b0: 6e70 2e61 7272 6179 285b 4b2c 202d 4b5d  np.array([K, -K]
+000168c0: 290d 0a20 2020 2069 6620 4c2e 7369 7a65  )..    if L.size
+000168d0: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
+000168e0: 4c20 3d20 6e70 2e61 7272 6179 285b 4c2c  L = np.array([L,
+000168f0: 202d 4c5d 290d 0a0d 0a20 2020 2069 6620   -L])....    if 
+00016900: 485b 305d 203e 2048 5b31 5d3a 0d0a 2020  H[0] > H[1]:..  
+00016910: 2020 2020 2020 4873 7465 7020 3d20 2d31        Hstep = -1
+00016920: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+00016930: 2020 2020 2048 7374 6570 203d 2031 0d0a       Hstep = 1..
+00016940: 2020 2020 6966 204b 5b30 5d20 3e20 4b5b      if K[0] > K[
+00016950: 315d 3a0d 0a20 2020 2020 2020 204b 7374  1]:..        Kst
+00016960: 6570 203d 202d 310d 0a20 2020 2065 6c73  ep = -1..    els
+00016970: 653a 0d0a 2020 2020 2020 2020 4b73 7465  e:..        Kste
+00016980: 7020 3d20 312e 300d 0a20 2020 2069 6620  p = 1.0..    if 
+00016990: 4c5b 305d 203e 204c 5b31 5d3a 0d0a 2020  L[0] > L[1]:..  
+000169a0: 2020 2020 2020 4c73 7465 7020 3d20 2d31        Lstep = -1
+000169b0: 2e30 0d0a 2020 2020 656c 7365 3a0d 0a20  .0..    else:.. 
+000169c0: 2020 2020 2020 204c 7374 6570 203d 2031         Lstep = 1
+000169d0: 2e30 0d0a 0d0a 2020 2020 4872 616e 6765  .0....    Hrange
+000169e0: 203d 206e 702e 6172 616e 6765 2848 5b30   = np.arange(H[0
+000169f0: 5d2c 2048 5b31 5d20 2b20 4873 7465 702c  ], H[1] + Hstep,
+00016a00: 2048 7374 6570 290d 0a20 2020 204b 7261   Hstep)..    Kra
+00016a10: 6e67 6520 3d20 6e70 2e61 7261 6e67 6528  nge = np.arange(
+00016a20: 4b5b 305d 2c20 4b5b 315d 202b 204b 7374  K[0], K[1] + Kst
+00016a30: 6570 2c20 4b73 7465 7029 0d0a 2020 2020  ep, Kstep)..    
+00016a40: 4c72 616e 6765 203d 206e 702e 6172 616e  Lrange = np.aran
+00016a50: 6765 284c 5b30 5d2c 204c 5b31 5d20 2b20  ge(L[0], L[1] + 
+00016a60: 4c73 7465 702c 2048 7374 6570 290d 0a20  Lstep, Hstep).. 
+00016a70: 2020 204b 4b2c 2048 482c 204c 4c20 3d20     KK, HH, LL = 
+00016a80: 6e70 2e6d 6573 6867 7269 6428 4b72 616e  np.meshgrid(Kran
+00016a90: 6765 2c20 4872 616e 6765 2c20 4c72 616e  ge, Hrange, Lran
+00016aa0: 6765 290d 0a0d 0a20 2020 2072 6574 7572  ge)....    retur
+00016ab0: 6e20 6e70 2e61 7361 7272 6179 285b 4848  n np.asarray([HH
+00016ac0: 2e72 6176 656c 2829 2c20 4b4b 2e72 6176  .ravel(), KK.rav
+00016ad0: 656c 2829 2c20 4c4c 2e72 6176 656c 2829  el(), LL.ravel()
+00016ae0: 5d2c 2064 7479 7065 3d69 6e74 292e 540d  ], dtype=int).T.
+00016af0: 0a0d 0a0d 0a64 6566 2066 6974 696e 6365  .....def fitince
+00016b00: 6c6c 2875 7677 293a 0d0a 2020 2020 2222  ll(uvw):..    ""
+00016b10: 220d 0a20 2020 2053 6574 2061 6c6c 2066  "..    Set all f
+00016b20: 7261 6374 696f 6e61 6c20 636f 6f64 696e  ractional coodin
+00016b30: 6174 6573 2062 6574 7765 656e 2030 2061  ates between 0 a
+00016b40: 6e64 2031 0d0a 2020 2020 5573 6167 653a  nd 1..    Usage:
+00016b50: 0d0a 2020 2020 2020 7576 7720 3d20 6669  ..      uvw = fi
+00016b60: 7469 6e63 656c 6c28 7576 7729 0d0a 2020  tincell(uvw)..  
+00016b70: 2020 2020 7576 7720 3d20 5b5b 6e78 335d      uvw = [[nx3]
+00016b80: 5d20 6172 7261 7920 6f66 2066 7261 6374  ] array of fract
+00016b90: 696f 6e61 6c20 7665 6374 6f72 7320 5b75  ional vectors [u
+00016ba0: 2c76 2c77 5d0d 0a20 2020 2022 2222 0d0a  ,v,w]..    """..
+00016bb0: 2020 2020 7768 696c 6520 6e70 2e61 6e79      while np.any
+00016bc0: 2875 7677 203e 2030 2e39 3929 206f 7220  (uvw > 0.99) or 
+00016bd0: 6e70 2e61 6e79 2875 7677 203c 202d 302e  np.any(uvw < -0.
+00016be0: 3031 293a 0d0a 2020 2020 2020 2020 7576  01):..        uv
+00016bf0: 775b 7576 7720 3e20 302e 3939 5d20 3d20  w[uvw > 0.99] = 
+00016c00: 7576 775b 7576 7720 3e20 302e 3939 5d20  uvw[uvw > 0.99] 
+00016c10: 2d20 312e 0d0a 2020 2020 2020 2020 7576  - 1...        uv
+00016c20: 775b 7576 7720 3c20 2d30 2e30 315d 203d  w[uvw < -0.01] =
+00016c30: 2075 7677 5b75 7677 203c 202d 302e 3031   uvw[uvw < -0.01
+00016c40: 5d20 2b20 312e 0d0a 2020 2020 7265 7475  ] + 1...    retu
+00016c50: 726e 2075 7677 0d0a 0d0a 0d0a 272d 2d2d  rn uvw......'---
+00016c60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00016c70: 2d2d 2d2d 2d2d 2d2d 5379 6d6d 6574 7279  --------Symmetry
+00016c80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00016c90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00016ca0: 2d2d 2d2d 2d27 0d0a 0d0a 0d0a 6465 6620  -----'......def 
+00016cb0: 6765 6e5f 7379 6d5f 706f 7328 7379 6d5f  gen_sym_pos(sym_
+00016cc0: 6f70 732c 2078 2c20 792c 207a 293a 0d0a  ops, x, y, z):..
+00016cd0: 2020 2020 2222 220d 0a20 2020 2047 656e      """..    Gen
+00016ce0: 6572 6174 6520 706f 7369 7469 6f6e 7320  erate positions 
+00016cf0: 6672 6f6d 2073 796d 6d65 7472 7920 6f70  from symmetry op
+00016d00: 6572 6174 696f 6e73 0d0a 2020 2020 5573  erations..    Us
+00016d10: 6167 653a 0d0a 2020 2020 2020 7576 7720  age:..      uvw 
+00016d20: 3d20 6765 6e5f 7379 6d5f 706f 7328 7379  = gen_sym_pos(sy
+00016d30: 6d5f 6f70 732c 782c 792c 7a29 0d0a 2020  m_ops,x,y,z)..  
+00016d40: 2020 2020 7379 6d5f 6f70 7320 3d20 5b6e      sym_ops = [n
+00016d50: 2a27 782c 792c 7a27 5d20 6172 7261 7920  *'x,y,z'] array 
+00016d60: 6f66 2073 7472 696e 6720 7379 6d6d 6574  of string symmet
+00016d70: 7279 206f 7065 7261 7469 6f6e 730d 0a20  ry operations.. 
+00016d80: 2020 2020 2078 2c79 2c7a 203d 2066 7261       x,y,z = fra
+00016d90: 6374 696f 6e61 6c20 636f 6f72 6469 6e61  ctional coordina
+00016da0: 7465 7320 6f66 2061 746f 6d69 6320 706f  tes of atomic po
+00016db0: 7369 6974 6f6e 2074 6f20 6265 206d 6f64  siiton to be mod
+00016dc0: 6966 6965 6420 6279 2073 796d 6d65 7472  ified by symmetr
+00016dd0: 790d 0a20 2020 2020 2075 7677 203d 205b  y..      uvw = [
+00016de0: 5b6e 7833 5d5d 2061 7272 6179 206f 6620  [nx3]] array of 
+00016df0: 7379 6d6d 6574 7279 2064 6566 696e 6564  symmetry defined
+00016e00: 2066 6163 7469 6f6e 616c 2063 6f6f 7264   factional coord
+00016e10: 696e 6174 6573 205b 752c 762c 775d 0d0a  inates [u,v,w]..
+00016e20: 0d0a 2020 2020 452e 472e 0d0a 2020 2020  ..    E.G...    
+00016e30: 2020 7576 7720 3d20 6765 6e5f 7379 6d5f    uvw = gen_sym_
+00016e40: 706f 7328 5b27 782c 792c 7a27 2c27 792c  pos(['x,y,z','y,
+00016e50: 2d78 2c7a 2b31 2f32 275d 2c30 2e31 2c30  -x,z+1/2'],0.1,0
+00016e60: 2e32 2c30 2e33 290d 0a20 2020 2020 2075  .2,0.3)..      u
+00016e70: 7677 203e 3e20 5b5b 302e 312c 302e 322c  vw >> [[0.1,0.2,
+00016e80: 302e 335d 202c 205b 302e 322c 2d30 2e31  0.3] , [0.2,-0.1
+00016e90: 2c30 2e38 5d5d 0d0a 2020 2020 2222 220d  ,0.8]]..    """.
+00016ea0: 0a20 2020 2075 7677 203d 206e 702e 7a65  .    uvw = np.ze
+00016eb0: 726f 7328 5b6c 656e 2873 796d 5f6f 7073  ros([len(sym_ops
+00016ec0: 292c 2033 5d29 0d0a 2020 2020 666f 7220  ), 3])..    for 
+00016ed0: 6e20 696e 2072 616e 6765 286c 656e 2873  n in range(len(s
+00016ee0: 796d 5f6f 7073 2929 3a0d 0a20 2020 2020  ym_ops)):..     
+00016ef0: 2020 2073 796d 203d 2073 796d 5f6f 7073     sym = sym_ops
+00016f00: 5b6e 5d0d 0a20 2020 2020 2020 2073 796d  [n]..        sym
+00016f10: 203d 2073 796d 2e6c 6f77 6572 2829 0d0a   = sym.lower()..
+00016f20: 2020 2020 2020 2020 2320 4576 616c 7561          # Evalua
+00016f30: 7465 2073 7472 696e 6720 7379 6d6d 6574  te string symmet
+00016f40: 7279 206f 7065 7261 7469 6f6e 2069 6e20  ry operation in 
+00016f50: 7465 726d 7320 6f66 2078 2c79 2c7a 0d0a  terms of x,y,z..
+00016f60: 2020 2020 2020 2020 7379 6d20 3d20 7379          sym = sy
+00016f70: 6d2e 7265 706c 6163 6528 272f 272c 2027  m.replace('/', '
+00016f80: 2e2f 2729 0d0a 2020 2020 2020 2020 7379  ./')..        sy
+00016f90: 6d20 3d20 7379 6d2e 7374 7269 7028 275c  m = sym.strip('\
+00016fa0: 225c 2727 290d 0a20 2020 2020 2020 2073  "\'')..        s
+00016fb0: 796d 203d 2073 796d 2e72 6570 6c61 6365  ym = sym.replace
+00016fc0: 2827 6d78 272c 2027 7827 292e 7265 706c  ('mx', 'x').repl
+00016fd0: 6163 6528 276d 7927 2c20 2779 2729 2e72  ace('my', 'y').r
+00016fe0: 6570 6c61 6365 2827 6d7a 272c 2027 7a27  eplace('mz', 'z'
+00016ff0: 290d 0a20 2020 2020 2020 2073 796d 203d  )..        sym =
+00017000: 2073 796d 2e72 6570 6c61 6365 2827 3278   sym.replace('2x
+00017010: 272c 2027 322a 7827 2920 2023 2032 7820  ', '2*x')  # 2x 
+00017020: 6170 7065 6172 7320 696e 2073 6f6d 6520  appears in some 
+00017030: 6865 7861 676f 6e61 6c20 7370 6163 6567  hexagonal spaceg
+00017040: 726f 7570 730d 0a20 2020 2020 2020 206f  roups..        o
+00017050: 7574 203d 2065 7661 6c28 7379 6d2c 207b  ut = eval(sym, {
+00017060: 2778 273a 2078 2c20 2779 273a 2079 2c20  'x': x, 'y': y, 
+00017070: 277a 273a 207a 7d29 0d0a 2020 2020 2020  'z': z})..      
+00017080: 2020 7576 775b 6e5d 203d 206e 702e 6172    uvw[n] = np.ar
+00017090: 7261 7928 6f75 745b 303a 335d 2920 2b20  ray(out[0:3]) + 
+000170a0: 302e 3020 2023 2061 6464 207a 6572 6f20  0.0  # add zero 
+000170b0: 746f 2072 656d 6f76 6520 2d30 2e30 2076  to remove -0.0 v
+000170c0: 616c 7565 730d 0a20 2020 2072 6574 7572  alues..    retur
+000170d0: 6e20 7576 770d 0a0d 0a0d 0a64 6566 2067  n uvw......def g
+000170e0: 656e 5f73 796d 6365 6e5f 706f 7328 7379  en_symcen_pos(sy
+000170f0: 6d5f 6f70 732c 2063 656e 5f6f 7073 2c20  m_ops, cen_ops, 
+00017100: 782c 2079 2c20 7a29 3a0d 0a20 2020 2022  x, y, z):..    "
+00017110: 2222 0d0a 2020 2020 4765 6e65 7261 7465  ""..    Generate
+00017120: 2070 6f73 6974 696f 6e73 2066 726f 6d20   positions from 
+00017130: 7379 6d6d 6574 7279 2061 6e64 2063 656e  symmetry and cen
+00017140: 7472 696e 6720 6f70 6572 6174 696f 6e73  tring operations
+00017150: 0d0a 2020 2020 5573 6167 653a 0d0a 2020  ..    Usage:..  
+00017160: 2020 2020 7576 7720 3d20 6765 6e5f 7379      uvw = gen_sy
+00017170: 6d63 656e 5f70 6f73 2873 796d 5f6f 7073  mcen_pos(sym_ops
+00017180: 2c63 656e 5f6f 7073 2c78 2c79 2c7a 290d  ,cen_ops,x,y,z).
+00017190: 0a20 2020 2020 2073 796d 5f6f 7073 203d  .      sym_ops =
+000171a0: 205b 6e2a 2778 2c79 2c7a 275d 2061 7272   [n*'x,y,z'] arr
+000171b0: 6179 206f 6620 7374 7269 6e67 2073 796d  ay of string sym
+000171c0: 6d65 7472 7920 6f70 6572 6174 696f 6e73  metry operations
+000171d0: 0d0a 2020 2020 2020 6365 6e5f 6f70 7320  ..      cen_ops 
+000171e0: 3d20 5b6d 2a27 782c 792c 7a27 5d20 6172  = [m*'x,y,z'] ar
+000171f0: 7261 7920 6f66 2073 7472 696e 6720 6365  ray of string ce
+00017200: 6e74 7269 6e67 206f 7065 7261 7469 6f6e  ntring operation
+00017210: 730d 0a20 2020 2020 2078 2c79 2c7a 203d  s..      x,y,z =
+00017220: 2066 7261 6374 696f 6e61 6c20 636f 6f72   fractional coor
+00017230: 6469 6e61 7465 7320 6f66 2061 746f 6d69  dinates of atomi
+00017240: 6320 706f 7369 6974 6f6e 2074 6f20 6265  c posiiton to be
+00017250: 206d 6f64 6966 6965 6420 6279 2073 796d   modified by sym
+00017260: 6d65 7472 790d 0a20 2020 2020 2075 7677  metry..      uvw
+00017270: 203d 205b 5b6e 7833 5d5d 2061 7272 6179   = [[nx3]] array
+00017280: 206f 6620 7379 6d6d 6574 7279 2064 6566   of symmetry def
+00017290: 696e 6564 2066 6163 7469 6f6e 616c 2063  ined factional c
+000172a0: 6f6f 7264 696e 6174 6573 205b 752c 762c  oordinates [u,v,
+000172b0: 775d 0d0a 0d0a 2020 2020 452e 472e 0d0a  w]....    E.G...
+000172c0: 2020 2020 2020 7576 7720 3d20 6765 6e5f        uvw = gen_
+000172d0: 7379 6d63 656e 5f70 6f73 285b 2778 2c79  symcen_pos(['x,y
+000172e0: 2c7a 272c 2779 2c2d 782c 7a2b 312f 3227  ,z','y,-x,z+1/2'
+000172f0: 5d2c 5b27 782c 792c 7a27 2c27 782b 312f  ],['x,y,z','x+1/
+00017300: 332c 792b 312f 332c 7a27 5d2c 302e 312c  3,y+1/3,z'],0.1,
+00017310: 302e 322c 302e 3329 0d0a 2020 2020 2020  0.2,0.3)..      
+00017320: 7576 7720 3e3e 205b 5b30 2e31 2c30 2e32  uvw >> [[0.1,0.2
+00017330: 2c30 2e33 5d20 2c20 5b30 2e34 3333 2c30  ,0.3] , [0.433,0
+00017340: 2e35 3333 2c30 2e33 5d20 2c20 5b30 2e32  .533,0.3] , [0.2
+00017350: 2c2d 302e 312c 302e 385d 202c 205b 302e  ,-0.1,0.8] , [0.
+00017360: 3533 332c 2d30 2e32 3333 2c30 2e38 5d5d  533,-0.233,0.8]]
+00017370: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
+00017380: 204e 7379 6d4f 7073 203d 206c 656e 2873   NsymOps = len(s
+00017390: 796d 5f6f 7073 290d 0a20 2020 204e 6365  ym_ops)..    Nce
+000173a0: 6e4f 7073 203d 206c 656e 2863 656e 5f6f  nOps = len(cen_o
+000173b0: 7073 290d 0a20 2020 204e 6f70 7320 3d20  ps)..    Nops = 
+000173c0: 4e73 796d 4f70 7320 2a20 4e63 656e 4f70  NsymOps * NcenOp
+000173d0: 730d 0a0d 0a20 2020 2075 7677 203d 2067  s....    uvw = g
+000173e0: 656e 5f73 796d 5f70 6f73 2873 796d 5f6f  en_sym_pos(sym_o
+000173f0: 7073 2c20 782c 2079 2c20 7a29 0d0a 0d0a  ps, x, y, z)....
+00017400: 2020 2020 7379 6d70 6f73 203d 206e 702e      sympos = np.
+00017410: 7a65 726f 7328 5b4e 6f70 732c 2033 5d29  zeros([Nops, 3])
+00017420: 0d0a 2020 2020 666f 7220 6d20 696e 2072  ..    for m in r
+00017430: 616e 6765 284e 7379 6d4f 7073 293a 0d0a  ange(NsymOps):..
+00017440: 2020 2020 2020 2020 6378 2c20 6379 2c20          cx, cy, 
+00017450: 637a 203d 2075 7677 5b6d 5d0d 0a20 2020  cz = uvw[m]..   
+00017460: 2020 2020 204e 692c 204e 6a20 3d20 6d20       Ni, Nj = m 
+00017470: 2a20 4e63 656e 4f70 732c 2028 6d20 2b20  * NcenOps, (m + 
+00017480: 3129 202a 204e 6365 6e4f 7073 0d0a 2020  1) * NcenOps..  
+00017490: 2020 2020 2020 6365 6e5f 7576 7720 3d20        cen_uvw = 
+000174a0: 6765 6e5f 7379 6d5f 706f 7328 6365 6e5f  gen_sym_pos(cen_
+000174b0: 6f70 732c 2063 782c 2063 792c 2063 7a29  ops, cx, cy, cz)
+000174c0: 0d0a 2020 2020 2020 2020 7379 6d70 6f73  ..        sympos
+000174d0: 5b4e 693a 4e6a 2c20 3a5d 203d 2063 656e  [Ni:Nj, :] = cen
+000174e0: 5f75 7677 0d0a 2020 2020 7265 7475 726e  _uvw..    return
+000174f0: 2073 796d 706f 730d 0a0d 0a0d 0a64 6566   sympos......def
+00017500: 2067 656e 5f73 796d 5f75 6e69 7175 6528   gen_sym_unique(
+00017510: 7379 6d5f 6f70 732c 2078 2c20 792c 207a  sym_ops, x, y, z
+00017520: 2c20 6365 6e5f 6f70 733d 4e6f 6e65 293a  , cen_ops=None):
+00017530: 0d0a 2020 2020 2222 220d 0a20 2020 2047  ..    """..    G
+00017540: 656e 6572 6174 6520 706f 7369 7469 6f6e  enerate position
+00017550: 7320 6672 6f6d 2073 796d 6d65 7472 7920  s from symmetry 
+00017560: 6f70 6572 6174 696f 6e73 2077 6974 6820  operations with 
+00017570: 6964 656e 7469 616c 2070 6f73 6974 696f  idential positio
+00017580: 6e73 2072 656d 6f76 6564 0d0a 2020 2020  ns removed..    
+00017590: 5573 6167 653a 0d0a 2020 2020 2020 7576  Usage:..      uv
+000175a0: 7720 3d20 6765 6e5f 7379 6d5f 756e 6971  w = gen_sym_uniq
+000175b0: 7565 2873 796d 5f6f 7073 2c78 2c79 2c7a  ue(sym_ops,x,y,z
+000175c0: 290d 0a20 2020 2045 2e47 2e0d 0a20 2020  )..    E.G...   
+000175d0: 2020 2075 7677 203d 2067 656e 5f73 796d     uvw = gen_sym
+000175e0: 5f75 6e69 7175 6528 5b27 782c 792c 7a27  _unique(['x,y,z'
+000175f0: 2c27 792c 2d78 2c7a 2b31 2f32 272c 2778  ,'y,-x,z+1/2','x
+00017600: 2c79 2c7a 275d 2c30 2e31 2c30 2e32 2c30  ,y,z'],0.1,0.2,0
+00017610: 2e33 290d 0a20 2020 2020 2075 7677 203e  .3)..      uvw >
+00017620: 3e20 5b5b 302e 312c 302e 322c 302e 335d  > [[0.1,0.2,0.3]
+00017630: 202c 205b 302e 322c 2d30 2e31 2c30 2e38   , [0.2,-0.1,0.8
+00017640: 5d5d 0d0a 2020 2020 3a70 6172 616d 2073  ]]..    :param s
+00017650: 796d 5f6f 7073 3a20 6c69 7374 206f 6620  ym_ops: list of 
+00017660: 7374 7220 2d20 7379 6d6d 6574 7279 206f  str - symmetry o
+00017670: 7065 7261 7469 6f6e 730d 0a20 2020 203a  perations..    :
+00017680: 7061 7261 6d20 783a 2066 6c6f 6174 0d0a  param x: float..
+00017690: 2020 2020 3a70 6172 616d 2079 3a20 666c      :param y: fl
+000176a0: 6f61 740d 0a20 2020 203a 7061 7261 6d20  oat..    :param 
+000176b0: 7a3a 2066 6c6f 6174 0d0a 2020 2020 3a70  z: float..    :p
+000176c0: 6172 616d 2063 656e 5f6f 7073 3a20 4f70  aram cen_ops: Op
+000176d0: 7469 6f6e 616c 202d 206c 6973 7420 6f66  tional - list of
+000176e0: 2073 7472 2066 6f72 2063 656e 7472 696e   str for centrin
+000176f0: 6720 6f70 6572 6174 696f 6e73 0d0a 2020  g operations..  
+00017700: 2020 3a72 6574 7572 6e3a 2061 7272 6179    :return: array
+00017710: 206f 6620 706f 7369 7469 6f6e 730d 0a20   of positions.. 
+00017720: 2020 2022 2222 0d0a 2020 2020 6966 2063     """..    if c
+00017730: 656e 5f6f 7073 3a0d 0a20 2020 2020 2020  en_ops:..       
+00017740: 2073 796d 5f78 797a 203d 2067 656e 5f73   sym_xyz = gen_s
+00017750: 796d 6365 6e5f 706f 7328 7379 6d5f 6f70  ymcen_pos(sym_op
+00017760: 732c 2063 656e 5f6f 7073 2c20 782c 2079  s, cen_ops, x, y
+00017770: 2c20 7a29 0d0a 2020 2020 656c 7365 3a0d  , z)..    else:.
+00017780: 0a20 2020 2020 2020 2073 796d 5f78 797a  .        sym_xyz
+00017790: 203d 2067 656e 5f73 796d 5f70 6f73 2873   = gen_sym_pos(s
+000177a0: 796d 5f6f 7073 2c20 782c 2079 2c20 7a29  ym_ops, x, y, z)
+000177b0: 0d0a 2020 2020 7379 6d5f 7879 7a20 3d20  ..    sym_xyz = 
+000177c0: 6669 7469 6e63 656c 6c28 7379 6d5f 7879  fitincell(sym_xy
+000177d0: 7a29 0d0a 2020 2020 2320 5265 6d6f 7665  z)..    # Remove
+000177e0: 2069 6465 6e74 6963 616c 2070 6f73 6974   identical posit
+000177f0: 696f 6e73 0d0a 2020 2020 756e 6971 7565  ions..    unique
+00017800: 5f78 797a 2c20 756e 6971 7565 6964 782c  _xyz, uniqueidx,
+00017810: 206d 6174 6368 6964 7820 3d20 6667 2e75   matchidx = fg.u
+00017820: 6e69 7175 655f 7665 6374 6f72 2873 796d  nique_vector(sym
+00017830: 5f78 797a 2c20 746f 6c3d 302e 3031 290d  _xyz, tol=0.01).
+00017840: 0a20 2020 2072 6574 7572 6e20 756e 6971  .    return uniq
+00017850: 7565 5f78 797a 0d0a 0d0a 0d0a 6465 6620  ue_xyz......def 
+00017860: 6765 6e5f 7379 6d63 656e 5f6f 7073 2873  gen_symcen_ops(s
+00017870: 796d 5f6f 7073 2c20 6365 6e5f 6f70 7329  ym_ops, cen_ops)
+00017880: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+00017890: 4275 696c 6420 636f 6d70 6c65 7465 206c  Build complete l
+000178a0: 6973 7420 6f66 2073 796d 6d65 7472 7920  ist of symmetry 
+000178b0: 6f70 6572 6174 696f 6e73 2066 726f 6d20  operations from 
+000178c0: 7379 6d6d 6574 7279 2061 6e64 2063 656e  symmetry and cen
+000178d0: 7472 696e 6720 7665 6374 6f72 730d 0a20  tring vectors.. 
+000178e0: 2020 2055 7361 6765 3a0d 0a20 2020 2020     Usage:..     
+000178f0: 206f 7073 203d 2067 656e 5f73 796d 6365   ops = gen_symce
+00017900: 6e5f 6f70 7328 7379 6d5f 6f70 732c 6365  n_ops(sym_ops,ce
+00017910: 6e5f 6f70 7329 0d0a 2020 2020 2020 7379  n_ops)..      sy
+00017920: 6d5f 6f70 7320 3d20 5b6e 2a27 782c 792c  m_ops = [n*'x,y,
+00017930: 7a27 5d20 6172 7261 7920 6f66 2073 7472  z'] array of str
+00017940: 696e 6720 7379 6d6d 6574 7279 206f 7065  ing symmetry ope
+00017950: 7261 7469 6f6e 730d 0a20 2020 2020 2063  rations..      c
+00017960: 656e 5f6f 7073 203d 205b 6d2a 2778 2c79  en_ops = [m*'x,y
+00017970: 2c7a 275d 2061 7272 6179 206f 6620 7374  ,z'] array of st
+00017980: 7269 6e67 2063 656e 7472 696e 6720 6f70  ring centring op
+00017990: 6572 6174 696f 6e73 0d0a 2020 2020 2020  erations..      
+000179a0: 6f70 7320 3d20 5b6e 2a6d 2a27 782c 792c  ops = [n*m*'x,y,
+000179b0: 7a27 5d20 6172 7261 7920 6f66 2073 7472  z'] array of str
+000179c0: 696e 6720 7379 6d6d 6574 7279 206f 7065  ing symmetry ope
+000179d0: 7261 7469 6f6e 730d 0a0d 0a20 2020 2045  rations....    E
+000179e0: 2e47 2e0d 0a20 2020 2020 206f 7073 203d  .G...      ops =
+000179f0: 2067 656e 5f73 796d 6365 6e5f 706f 7328   gen_symcen_pos(
+00017a00: 5b27 782c 792c 7a27 2c27 792c 2d78 2c7a  ['x,y,z','y,-x,z
+00017a10: 2b31 2f32 275d 2c5b 2778 2c79 2c7a 272c  +1/2'],['x,y,z',
+00017a20: 2778 2b31 2f33 2c79 2b31 2f33 2c7a 275d  'x+1/3,y+1/3,z']
+00017a30: 290d 0a20 2020 2020 203e 3e20 6f70 7320  )..      >> ops 
+00017a40: 3d20 5b27 782c 792c 7a27 2c27 782b 312f  = ['x,y,z','x+1/
+00017a50: 332c 792b 312f 332c 7a27 2c27 792c 2d78  3,y+1/3,z','y,-x
+00017a60: 2c7a 2b31 2f32 272c 2779 2b31 2f33 2c2d  ,z+1/2','y+1/3,-
+00017a70: 782b 312f 332c 7a2b 312f 3227 5d0d 0a20  x+1/3,z+1/2'].. 
+00017a80: 2020 2022 2222 0d0a 0d0a 2020 2020 6f70     """....    op
+00017a90: 7320 3d20 5b5d 0d0a 2020 2020 666f 7220  s = []..    for 
+00017aa0: 7379 6d20 696e 2073 796d 5f6f 7073 3a0d  sym in sym_ops:.
+00017ab0: 0a20 2020 2020 2020 2073 796d 203d 2073  .        sym = s
+00017ac0: 796d 2e6c 6f77 6572 2829 0d0a 2020 2020  ym.lower()..    
+00017ad0: 2020 2020 7379 6d20 3d20 7379 6d2e 7374      sym = sym.st
+00017ae0: 7269 7028 275c 225c 2727 290d 0a20 2020  rip('\"\'')..   
+00017af0: 2020 2020 2073 5f6f 7020 3d20 7379 6d2e       s_op = sym.
+00017b00: 7370 6c69 7428 272c 2729 0d0a 2020 2020  split(',')..    
+00017b10: 2020 2020 7820 3d20 735f 6f70 5b30 5d2e      x = s_op[0].
+00017b20: 7374 7269 7028 290d 0a20 2020 2020 2020  strip()..       
+00017b30: 2079 203d 2073 5f6f 705b 315d 2e73 7472   y = s_op[1].str
+00017b40: 6970 2829 0d0a 2020 2020 2020 2020 7a20  ip()..        z 
+00017b50: 3d20 735f 6f70 5b32 5d2e 7374 7269 7028  = s_op[2].strip(
+00017b60: 290d 0a20 2020 2020 2020 2069 6620 6c65  )..        if le
+00017b70: 6e28 735f 6f70 2920 3e20 333a 0d0a 2020  n(s_op) > 3:..  
+00017b80: 2020 2020 2020 2020 2020 7420 3d20 696e            t = in
+00017b90: 7428 735f 6f70 5b33 5d29 0d0a 2020 2020  t(s_op[3])..    
+00017ba0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00017bb0: 2020 2020 2020 2074 203d 2031 0d0a 2020         t = 1..  
+00017bc0: 2020 2020 2020 666f 7220 6365 6e20 696e        for cen in
+00017bd0: 2063 656e 5f6f 7073 3a0d 0a20 2020 2020   cen_ops:..     
+00017be0: 2020 2020 2020 2063 656e 203d 2063 656e         cen = cen
+00017bf0: 2e6c 6f77 6572 2829 0d0a 2020 2020 2020  .lower()..      
+00017c00: 2020 2020 2020 6365 6e20 3d20 6365 6e2e        cen = cen.
+00017c10: 7374 7269 7028 275c 225c 2727 290d 0a20  strip('\"\'').. 
+00017c20: 2020 2020 2020 2020 2020 206f 7020 3d20             op = 
+00017c30: 6365 6e2e 7265 706c 6163 6528 2778 272c  cen.replace('x',
+00017c40: 2027 6127 292e 7265 706c 6163 6528 2779   'a').replace('y
+00017c50: 272c 2027 6227 292e 7265 706c 6163 6528  ', 'b').replace(
+00017c60: 277a 272c 2027 6327 2920 2023 2061 766f  'z', 'c')  # avo
+00017c70: 6964 2072 6570 6c61 6369 6e67 2078 2f79  id replacing x/y
+00017c80: 2074 7769 6365 0d0a 2020 2020 2020 2020   twice..        
+00017c90: 2020 2020 6f70 203d 206f 702e 7265 706c      op = op.repl
+00017ca0: 6163 6528 2761 272c 2078 292e 7265 706c  ace('a', x).repl
+00017cb0: 6163 6528 2762 272c 2079 292e 7265 706c  ace('b', y).repl
+00017cc0: 6163 6528 2763 272c 207a 290d 0a20 2020  ace('c', z)..   
+00017cd0: 2020 2020 2020 2020 206f 7020 3d20 6f70           op = op
+00017ce0: 2e72 6570 6c61 6365 2827 2d2d 272c 2027  .replace('--', '
+00017cf0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00017d00: 6966 206f 702e 636f 756e 7428 272c 2729  if op.count(',')
+00017d10: 203e 2032 3a0d 0a20 2020 2020 2020 2020   > 2:..         
+00017d20: 2020 2020 2020 206f 7020 3d20 6f70 2e73         op = op.s
+00017d30: 706c 6974 2827 2c27 290d 0a20 2020 2020  plit(',')..     
+00017d40: 2020 2020 2020 2020 2020 206f 705b 335d             op[3]
+00017d50: 203d 2027 252b 6427 2025 2028 696e 7428   = '%+d' % (int(
+00017d60: 6f70 5b33 5d29 202a 2074 290d 0a20 2020  op[3]) * t)..   
+00017d70: 2020 2020 2020 2020 2020 2020 206f 7020               op 
+00017d80: 3d20 272c 272e 6a6f 696e 286f 7029 0d0a  = ','.join(op)..
+00017d90: 2020 2020 2020 2020 2020 2020 6f70 7320              ops 
+00017da0: 2b3d 205b 6f70 5d0d 0a20 2020 2072 6574  += [op]..    ret
+00017db0: 7572 6e20 6f70 730d 0a0d 0a0d 0a64 6566  urn ops......def
+00017dc0: 2067 656e 5f73 796d 5f72 6566 2873 796d   gen_sym_ref(sym
+00017dd0: 5f6f 7073 2c20 686b 6c29 3a0d 0a20 2020  _ops, hkl):..   
+00017de0: 2022 2222 0d0a 2020 2020 2047 656e 6572   """..     Gener
+00017df0: 6174 6520 7379 6d6d 6574 7269 6320 7265  ate symmetric re
+00017e00: 666c 6563 7469 6f6e 7320 6769 7665 6e20  flections given 
+00017e10: 7379 6d6d 6574 7279 206f 7065 7261 7469  symmetry operati
+00017e20: 6f6e 730d 0a20 2020 2020 2020 2020 7379  ons..         sy
+00017e30: 6d68 6b6c 203d 2067 656e 5f73 796d 5f72  mhkl = gen_sym_r
+00017e40: 6566 2873 796d 5f6f 7073 2c68 2c6b 2c6c  ef(sym_ops,h,k,l
+00017e50: 290d 0a20 2020 2022 2222 0d0a 0d0a 2020  )..    """....  
+00017e60: 2020 686b 6c20 3d20 6e70 2e61 7361 7272    hkl = np.asarr
+00017e70: 6179 2868 6b6c 2c20 6474 7970 653d 666c  ay(hkl, dtype=fl
+00017e80: 6f61 7429 0d0a 0d0a 2020 2020 2320 4765  oat)....    # Ge
+00017e90: 7420 7472 616e 7366 6f72 6d61 7469 6f6e  t transformation
+00017ea0: 206d 6174 7269 6365 730d 0a20 2020 2073   matrices..    s
+00017eb0: 796d 5f6d 6174 203d 2067 656e 5f73 796d  ym_mat = gen_sym
+00017ec0: 5f6d 6174 2873 796d 5f6f 7073 290d 0a20  _mat(sym_ops).. 
+00017ed0: 2020 206e 6f70 7320 3d20 6c65 6e28 7379     nops = len(sy
+00017ee0: 6d5f 6f70 7329 0d0a 0d0a 2020 2020 7379  m_ops)....    sy
+00017ef0: 6d68 6b6c 203d 206e 702e 7a65 726f 7328  mhkl = np.zeros(
+00017f00: 5b6e 6f70 732c 2033 5d29 0d0a 2020 2020  [nops, 3])..    
+00017f10: 666f 7220 6e2c 2073 796d 2069 6e20 656e  for n, sym in en
+00017f20: 756d 6572 6174 6528 7379 6d5f 6d61 7429  umerate(sym_mat)
+00017f30: 3a0d 0a20 2020 2020 2020 2023 206d 756c  :..        # mul
+00017f40: 7469 706c 7920 6f6e 6c79 2062 7920 7468  tiply only by th
+00017f50: 6520 726f 7461 7469 6f6e 616c 2070 6172  e rotational par
+00017f60: 740d 0a20 2020 2020 2020 2073 796d 686b  t..        symhk
+00017f70: 6c5b 6e2c 203a 5d20 3d20 6e70 2e64 6f74  l[n, :] = np.dot
+00017f80: 2868 6b6c 2c20 7379 6d5b 3a33 2c20 3a33  (hkl, sym[:3, :3
+00017f90: 5d29 0d0a 0d0a 2020 2020 7265 7475 726e  ])....    return
+00017fa0: 2073 796d 686b 6c0d 0a0d 0a0d 0a64 6566   symhkl......def
+00017fb0: 2073 756d 5f73 796d 5f72 6566 2873 796d   sum_sym_ref(sym
+00017fc0: 686b 6c29 3a0d 0a20 2020 2022 2222 0d0a  hkl):..    """..
+00017fd0: 2020 2020 5265 6d6f 7665 2065 7175 6976      Remove equiv
+00017fe0: 616c 656e 7420 686b 6c20 706f 7369 7469  alent hkl positi
+00017ff0: 6f6e 7320 616e 6420 7265 7475 726e 2074  ons and return t
+00018000: 6865 206e 756d 6265 7220 6f66 2074 696d  he number of tim
+00018010: 6573 2065 6163 6820 6973 2067 656e 6572  es each is gener
+00018020: 6174 6564 2e0d 0a20 2020 2022 2222 0d0a  ated...    """..
+00018030: 2020 2020 2320 5265 6d6f 7665 2064 7570      # Remove dup
+00018040: 6c69 6361 7465 2070 6f73 6974 696f 6e73  licate positions
+00018050: 0d0a 2020 2020 756e 6971 7565 686b 6c2c  ..    uniquehkl,
+00018060: 2075 6e69 7175 6569 6478 2c20 6d61 7463   uniqueidx, matc
+00018070: 6869 6478 203d 2066 672e 756e 6971 7565  hidx = fg.unique
+00018080: 5f76 6563 746f 7228 7379 6d68 6b6c 5b3a  _vector(symhkl[:
+00018090: 2c20 3a33 5d2c 2030 2e30 3129 0d0a 0d0a  , :3], 0.01)....
+000180a0: 2020 2020 2320 5375 6d20 696e 7465 6e73      # Sum intens
+000180b0: 6974 7920 6174 2064 7570 6c69 6361 7465  ity at duplicate
+000180c0: 2070 6f73 6974 696f 6e73 0d0a 2020 2020   positions..    
+000180d0: 7375 6d69 6e74 203d 206e 702e 7a65 726f  sumint = np.zero
+000180e0: 7328 6c65 6e28 756e 6971 7565 686b 6c29  s(len(uniquehkl)
+000180f0: 290d 0a20 2020 2066 6f72 206e 2069 6e20  )..    for n in 
+00018100: 7261 6e67 6528 6c65 6e28 756e 6971 7565  range(len(unique
+00018110: 686b 6c29 293a 0d0a 2020 2020 2020 2020  hkl)):..        
+00018120: 7375 6d69 6e74 5b6e 5d20 3d20 6d61 7463  sumint[n] = matc
+00018130: 6869 6478 2e63 6f75 6e74 286e 290d 0a0d  hidx.count(n)...
+00018140: 0a20 2020 2072 6574 7572 6e20 756e 6971  .    return uniq
+00018150: 7565 686b 6c2c 2073 756d 696e 740d 0a0d  uehkl, sumint...
+00018160: 0a0d 0a64 6566 2067 656e 5f73 796d 5f6d  ...def gen_sym_m
+00018170: 6174 2873 796d 5f6f 7073 293a 0d0a 2020  at(sym_ops):..  
+00018180: 2020 2222 220d 0a20 2020 2020 4765 6e65    """..     Gene
+00018190: 7261 7465 2074 7261 6e73 666f 726d 6174  rate transformat
+000181a0: 696f 6e20 6d61 7472 6978 2066 726f 6d20  ion matrix from 
+000181b0: 7379 6d6d 6574 7279 206f 7065 7261 7469  symmetry operati
+000181c0: 6f6e 0d0a 2020 2020 2043 7572 7265 6e74  on..     Current
+000181d0: 6c79 2076 6572 7920 7567 6c79 2062 7574  ly very ugly but
+000181e0: 2069 7420 7365 656d 7320 746f 2077 6f72   it seems to wor
+000181f0: 6b0d 0a20 2020 2020 5465 7374 6564 2069  k..     Tested i
+00018200: 6e20 5465 7374 2f74 6573 745f 6765 6e5f  n Test/test_gen_
+00018210: 7379 6d5f 6d61 7420 2d20 666f 756e 6420  sym_mat - found 
+00018220: 746f 2062 6520 6661 7374 2061 6e64 2072  to be fast and r
+00018230: 656c 6961 626c 652e 0d0a 2020 2020 2073  eliable...     s
+00018240: 796d 5f6d 6174 203d 2067 656e 5f73 796d  ym_mat = gen_sym
+00018250: 5f6d 6174 285b 2778 2c79 2c7a 272c 2779  _mat(['x,y,z','y
+00018260: 2c2d 782c 7a2b 312f 3227 5d29 0d0a 2020  ,-x,z+1/2'])..  
+00018270: 2020 2073 796d 5f6d 6174 5b30 5d20 3d20     sym_mat[0] = 
+00018280: 5b5b 2031 2e2c 2020 302e 2c20 2030 2e2c  [[ 1.,  0.,  0.,
+00018290: 2020 302e 5d2c 0d0a 2020 2020 2020 2020    0.],..        
+000182a0: 2020 2020 2020 2020 2020 205b 2030 2e2c             [ 0.,
+000182b0: 2020 312e 2c20 2030 2e2c 2020 302e 5d2c    1.,  0.,  0.],
+000182c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000182d0: 2020 2020 205b 2030 2e2c 2020 302e 2c20       [ 0.,  0., 
+000182e0: 2031 2e2c 2020 302e 5d2c 0d0a 2020 2020   1.,  0.],..    
+000182f0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00018300: 2030 2e2c 2020 302e 2c20 2030 2e2c 2020   0.,  0.,  0.,  
+00018310: 312e 5d5d 290d 0a20 2020 2020 7379 6d5f  1.]])..     sym_
+00018320: 6d61 745b 315d 203d 205b 5b20 302e 202c  mat[1] = [[ 0. ,
+00018330: 2020 312e 202c 2020 302e 202c 2020 302e    1. ,  0. ,  0.
+00018340: 205d 2c0d 0a20 2020 2020 2020 2020 2020   ],..           
+00018350: 2020 2020 2020 2020 5b2d 312e 202c 2020          [-1. ,  
+00018360: 302e 202c 2020 302e 202c 2020 302e 205d  0. ,  0. ,  0. ]
+00018370: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00018380: 2020 2020 2020 5b20 302e 202c 2020 302e        [ 0. ,  0.
+00018390: 202c 2020 312e 202c 2020 302e 355d 2c0d   ,  1. ,  0.5],.
+000183a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000183b0: 2020 2020 5b20 302e 2c20 2020 302e 2c20      [ 0.,   0., 
+000183c0: 2020 302e 2c20 2020 312e 5d5d 0d0a 2020    0.,   1.]]..  
+000183d0: 2020 2222 220d 0a0d 0a20 2020 2073 796d    """....    sym
+000183e0: 5f6f 7073 203d 206e 702e 6173 6172 7261  _ops = np.asarra
+000183f0: 7928 7379 6d5f 6f70 732c 2064 7479 7065  y(sym_ops, dtype
+00018400: 3d73 7472 292e 7265 7368 6170 6528 2d31  =str).reshape(-1
+00018410: 290d 0a0d 0a20 2020 2073 796d 5f6d 6174  )....    sym_mat
+00018420: 203d 205b 5d0d 0a20 2020 2066 6f72 2073   = []..    for s
+00018430: 796d 2069 6e20 7379 6d5f 6f70 733a 0d0a  ym in sym_ops:..
+00018440: 2020 2020 2020 2020 7379 6d20 3d20 7379          sym = sy
+00018450: 6d2e 6c6f 7765 7228 290d 0a20 2020 2020  m.lower()..     
+00018460: 2020 2073 796d 203d 2073 796d 2e73 7472     sym = sym.str
+00018470: 6970 2827 5c22 5c27 2729 0d0a 2020 2020  ip('\"\'')..    
+00018480: 2020 2020 7379 6d20 3d20 7379 6d2e 7265      sym = sym.re
+00018490: 706c 6163 6528 272f 272c 2027 2e2f 2729  place('/', './')
+000184a0: 2020 2320 666c 6f61 7420 6469 7669 7369    # float divisi
+000184b0: 6f6e 0d0a 2020 2020 2020 2020 6f70 7320  on..        ops 
+000184c0: 3d20 7379 6d2e 7370 6c69 7428 272c 2729  = sym.split(',')
+000184d0: 0d0a 2020 2020 2020 2020 6d61 7420 3d20  ..        mat = 
+000184e0: 6e70 2e7a 6572 6f73 2828 342c 2034 2929  np.zeros((4, 4))
+000184f0: 0d0a 2020 2020 2020 2020 6d61 745b 332c  ..        mat[3,
+00018500: 2033 5d20 3d20 310d 0a0d 0a20 2020 2020   3] = 1....     
+00018510: 2020 2066 6f72 206e 2069 6e20 7261 6e67     for n in rang
+00018520: 6528 3329 3a0d 0a20 2020 2020 2020 2020  e(3):..         
+00018530: 2020 206f 7020 3d20 6f70 735b 6e5d 0d0a     op = ops[n]..
+00018540: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00018550: 7827 2069 6e20 6f70 3a20 6d61 745b 6e2c  x' in op: mat[n,
+00018560: 2030 5d20 3d20 310d 0a20 2020 2020 2020   0] = 1..       
+00018570: 2020 2020 2069 6620 272d 7827 2069 6e20       if '-x' in 
+00018580: 6f70 3a20 6d61 745b 6e2c 2030 5d20 3d20  op: mat[n, 0] = 
+00018590: 2d31 0d0a 2020 2020 2020 2020 2020 2020  -1..            
+000185a0: 6966 2027 7927 2069 6e20 6f70 3a20 6d61  if 'y' in op: ma
+000185b0: 745b 6e2c 2031 5d20 3d20 310d 0a20 2020  t[n, 1] = 1..   
+000185c0: 2020 2020 2020 2020 2069 6620 272d 7927           if '-y'
+000185d0: 2069 6e20 6f70 3a20 6d61 745b 6e2c 2031   in op: mat[n, 1
+000185e0: 5d20 3d20 2d31 0d0a 2020 2020 2020 2020  ] = -1..        
+000185f0: 2020 2020 6966 2027 7a27 2069 6e20 6f70      if 'z' in op
+00018600: 3a20 6d61 745b 6e2c 2032 5d20 3d20 310d  : mat[n, 2] = 1.
+00018610: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00018620: 272d 7a27 2069 6e20 6f70 3a20 6d61 745b  '-z' in op: mat[
+00018630: 6e2c 2032 5d20 3d20 2d31 0d0a 0d0a 2020  n, 2] = -1....  
+00018640: 2020 2020 2020 2020 2020 2320 7265 6d6f            # remo
+00018650: 7665 2074 6865 7365 2070 6172 7473 0d0a  ve these parts..
+00018660: 2020 2020 2020 2020 2020 2020 6f70 203d              op =
+00018670: 206f 702e 7265 706c 6163 6528 272d 7827   op.replace('-x'
+00018680: 2c20 2727 292e 7265 706c 6163 6528 2778  , '').replace('x
+00018690: 272c 2027 2729 0d0a 2020 2020 2020 2020  ', '')..        
+000186a0: 2020 2020 6f70 203d 206f 702e 7265 706c      op = op.repl
+000186b0: 6163 6528 272d 7927 2c20 2727 292e 7265  ace('-y', '').re
+000186c0: 706c 6163 6528 2779 272c 2027 2729 0d0a  place('y', '')..
+000186d0: 2020 2020 2020 2020 2020 2020 6f70 203d              op =
+000186e0: 206f 702e 7265 706c 6163 6528 272d 7a27   op.replace('-z'
+000186f0: 2c20 2727 292e 7265 706c 6163 6528 277a  , '').replace('z
+00018700: 272c 2027 2729 0d0a 2020 2020 2020 2020  ', '')..        
+00018710: 2020 2020 6f70 203d 206f 702e 7265 706c      op = op.repl
+00018720: 6163 6528 272b 272c 2027 2729 0d0a 0d0a  ace('+', '')....
+00018730: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00018740: 656e 286f 702e 7374 7269 7028 2929 203e  en(op.strip()) >
+00018750: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00018760: 2020 2020 206d 6174 5b6e 2c20 335d 203d       mat[n, 3] =
+00018770: 2065 7661 6c28 6f70 290d 0a20 2020 2020   eval(op)..     
+00018780: 2020 2073 796d 5f6d 6174 202b 3d20 5b6d     sym_mat += [m
+00018790: 6174 5d0d 0a20 2020 2072 6574 7572 6e20  at]..    return 
+000187a0: 7379 6d5f 6d61 740d 0a0d 0a0d 0a64 6566  sym_mat......def
+000187b0: 2073 796d 5f6d 6174 3273 7472 2873 796d   sym_mat2str(sym
+000187c0: 5f6d 6174 2c20 7469 6d65 3d4e 6f6e 6529  _mat, time=None)
+000187d0: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+000187e0: 4765 6e65 7261 7465 2073 796d 6d65 7472  Generate symmetr
+000187f0: 7920 6f70 6572 6174 696f 6e20 7374 7269  y operation stri
+00018800: 6e67 2066 726f 6d20 6d61 7472 6978 0d0a  ng from matrix..
+00018810: 2020 2020 3a70 6172 616d 2073 796d 5f6d      :param sym_m
+00018820: 6174 3a20 6172 7261 7920 5b33 7833 5d20  at: array [3x3] 
+00018830: 6f72 205b 3478 345d 0d0a 2020 2020 3a70  or [4x4]..    :p
+00018840: 6172 616d 2074 696d 653a 202b 2f2d 3120  aram time: +/-1 
+00018850: 6f72 204e 6f6e 650d 0a20 2020 203a 7265  or None..    :re
+00018860: 7475 726e 3a20 7374 7220 2778 2c79 2c7a  turn: str 'x,y,z
+00018870: 282c 3129 270d 0a20 2020 2022 2222 0d0a  (,1)'..    """..
+00018880: 2020 2020 7379 6d5f 6d61 7420 3d20 6e70      sym_mat = np
+00018890: 2e61 7361 7272 6179 2873 796d 5f6d 6174  .asarray(sym_mat
+000188a0: 290d 0a0d 0a20 2020 2072 6f74 203d 2073  )....    rot = s
+000188b0: 796d 5f6d 6174 5b3a 332c 203a 335d 0d0a  ym_mat[:3, :3]..
+000188c0: 2020 2020 6966 2073 796d 5f6d 6174 2e73      if sym_mat.s
+000188d0: 6861 7065 5b31 5d20 3d3d 2034 3a0d 0a20  hape[1] == 4:.. 
+000188e0: 2020 2020 2020 2074 7261 6e73 203d 2073         trans = s
+000188f0: 796d 5f6d 6174 5b3a 2c20 335d 0d0a 2020  ym_mat[:, 3]..  
+00018900: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00018910: 2074 7261 6e73 203d 206e 702e 7a65 726f   trans = np.zero
+00018920: 7328 3329 0d0a 0d0a 2020 2020 6465 6e6f  s(3)....    deno
+00018930: 6d69 6e61 746f 7273 203d 2072 616e 6765  minators = range
+00018940: 2832 2c20 3829 0d0a 2020 2020 6f75 7420  (2, 8)..    out 
+00018950: 3d20 5b5d 0d0a 2020 2020 666f 7220 6e20  = []..    for n 
+00018960: 696e 2072 616e 6765 2833 293a 0d0a 2020  in range(3):..  
+00018970: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
+00018980: 726f 7461 7469 6f6e 616c 2070 6172 740d  rotational part.
+00018990: 0a20 2020 2020 2020 2078 797a 203d 2027  .        xyz = '
+000189a0: 2531 2e33 6778 2b25 312e 3367 792b 2531  %1.3gx+%1.3gy+%1
+000189b0: 2e33 677a 2720 2520 2872 6f74 5b6e 5d5b  .3gz' % (rot[n][
+000189c0: 305d 2c20 726f 745b 6e5d 5b31 5d2c 2072  0], rot[n][1], r
+000189d0: 6f74 5b6e 5d5b 325d 290d 0a20 2020 2020  ot[n][2])..     
+000189e0: 2020 2078 797a 203d 2072 652e 7375 6228     xyz = re.sub(
+000189f0: 275b 2b2d 5d3f 305b 7879 7a5d 272c 2027  '[+-]?0[xyz]', '
+00018a00: 272c 2078 797a 292e 7265 706c 6163 6528  ', xyz).replace(
+00018a10: 2731 272c 2027 2729 2e72 6570 6c61 6365  '1', '').replace
+00018a20: 2827 2b2d 272c 2027 2d27 292e 7374 7269  ('+-', '-').stri
+00018a30: 7028 272b 2729 0d0a 0d0a 2020 2020 2020  p('+')....      
+00018a40: 2020 2320 436f 6e76 6572 7420 7472 616e    # Convert tran
+00018a50: 736c 6174 696f 6e61 6c20 7061 7274 0d0a  slational part..
+00018a60: 2020 2020 2020 2020 6966 2061 6273 2874          if abs(t
+00018a70: 7261 6e73 5b6e 5d29 203c 2030 2e30 313a  rans[n]) < 0.01:
+00018a80: 0d0a 2020 2020 2020 2020 2020 2020 6164  ..            ad
+00018a90: 6420 3d20 2727 0d0a 2020 2020 2020 2020  d = ''..        
+00018aa0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00018ab0: 2020 2063 686b 203d 205b 2864 202a 2074     chk = [(d * t
+00018ac0: 7261 6e73 5b6e 5d29 2025 2031 203c 2030  rans[n]) % 1 < 0
+00018ad0: 2e30 3120 666f 7220 6420 696e 2064 656e  .01 for d in den
+00018ae0: 6f6d 696e 6174 6f72 735d 0d0a 2020 2020  ominators]..    
+00018af0: 2020 2020 2020 2020 6966 2061 6e79 2863          if any(c
+00018b00: 686b 293a 0d0a 2020 2020 2020 2020 2020  hk):..          
+00018b10: 2020 2020 2020 6465 6e6f 6d20 3d20 6465        denom = de
+00018b20: 6e6f 6d69 6e61 746f 7273 5b63 686b 2e69  nominators[chk.i
+00018b30: 6e64 6578 2854 7275 6529 5d0d 0a20 2020  ndex(True)]..   
+00018b40: 2020 2020 2020 2020 2020 2020 2061 6464               add
+00018b50: 203d 2027 2b25 312e 3066 2f25 312e 3066   = '+%1.0f/%1.0f
+00018b60: 2720 2520 2864 656e 6f6d 202a 2074 7261  ' % (denom * tra
+00018b70: 6e73 5b6e 5d2c 2064 656e 6f6d 290d 0a20  ns[n], denom).. 
+00018b80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00018b90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018ba0: 2020 6164 6420 3d20 272b 2531 2e34 6727    add = '+%1.4g'
+00018bb0: 2025 2074 7261 6e73 5b6e 5d0d 0a20 2020   % trans[n]..   
+00018bc0: 2020 2020 2020 2020 2061 6464 203d 2061           add = a
+00018bd0: 6464 2e72 6570 6c61 6365 2827 2b2d 272c  dd.replace('+-',
+00018be0: 2027 2b27 290d 0a20 2020 2020 2020 2023   '+')..        #
+00018bf0: 2070 7269 6e74 286e 2c20 726f 745b 6e5d   print(n, rot[n]
+00018c00: 2c20 7472 616e 735b 6e5d 2c20 7879 7a2c  , trans[n], xyz,
+00018c10: 2061 6464 290d 0a20 2020 2020 2020 206f   add)..        o
+00018c20: 7574 202b 3d20 5b78 797a 202b 2061 6464  ut += [xyz + add
+00018c30: 5d0d 0a20 2020 2069 6620 7469 6d65 2069  ]..    if time i
+00018c40: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00018c50: 2020 2020 206f 7574 202b 3d20 5b27 252b       out += ['%+
+00018c60: 312e 3367 2720 2520 7469 6d65 5d0d 0a20  1.3g' % time].. 
+00018c70: 2020 2072 6574 7572 6e20 272c 272e 6a6f     return ','.jo
+00018c80: 696e 286f 7574 290d 0a0d 0a0d 0a64 6566  in(out)......def
+00018c90: 2073 796d 5f6f 705f 7265 636f 676e 6973   sym_op_recognis
+00018ca0: 6572 2873 796d 5f6f 7073 293a 0d0a 2020  er(sym_ops):..  
+00018cb0: 2020 2222 220d 0a20 2020 2045 7661 6c75    """..    Evalu
+00018cc0: 6174 6573 2073 796d 6d65 7472 7920 6f70  ates symmetry op
+00018cd0: 6572 6174 696f 6e73 2061 6e64 2072 6574  erations and ret
+00018ce0: 7572 6e73 2073 7472 206e 616d 6520 6f66  urns str name of
+00018cf0: 206f 7065 7261 7469 6f6e 0d0a 0d0a 2020   operation....  
+00018d00: 2020 446f 6573 6e27 7420 776f 726b 2079    Doesn't work y
+00018d10: 6574 202d 2077 6f72 6b73 206f 6e20 7369  et - works on si
+00018d20: 6d70 6c65 2073 7973 7465 6d73 2062 7574  mple systems but
+00018d30: 206e 6f74 2074 7269 676f 6e61 6c20 6f72   not trigonal or
+00018d40: 2068 6578 6167 6f6e 616c 206f 7065 7261   hexagonal opera
+00018d50: 7469 6f6e 7320 2d20 666f 7220 6578 616d  tions - for exam
+00018d60: 706c 6520 7367 3136 370d 0a20 2020 2022  ple sg167..    "
+00018d70: 2222 0d0a 2020 2020 7072 696e 7428 2744  ""..    print('D
+00018d80: 6f65 736e 7420 776f 726b 2079 6574 2121  oesnt work yet!!
+00018d90: 2127 290d 0a20 2020 2073 796d 5f6f 7073  !')..    sym_ops
+00018da0: 203d 206e 702e 6173 6172 7261 7928 7379   = np.asarray(sy
+00018db0: 6d5f 6f70 732c 2064 7479 7065 3d73 7472  m_ops, dtype=str
+00018dc0: 292e 7265 7368 6170 6528 2d31 290d 0a20  ).reshape(-1).. 
+00018dd0: 2020 2073 796d 5f6d 6174 7320 3d20 6765     sym_mats = ge
+00018de0: 6e5f 7379 6d5f 6d61 7428 7379 6d5f 6f70  n_sym_mat(sym_op
+00018df0: 7329 0d0a 2020 2020 4445 4255 4720 3d20  s)..    DEBUG = 
+00018e00: 5472 7565 0d0a 2020 2020 6f75 7420 3d20  True..    out = 
+00018e10: 5b5d 0d0a 2020 2020 666f 7220 6f70 2c20  []..    for op, 
+00018e20: 6d20 696e 207a 6970 2873 796d 5f6f 7073  m in zip(sym_ops
+00018e30: 2c20 7379 6d5f 6d61 7473 293a 0d0a 2020  , sym_mats):..  
+00018e40: 2020 2020 2020 6e73 203d 206f 702e 636f        ns = op.co
+00018e50: 756e 7428 272d 2729 2020 2320 303d 7472  unt('-')  # 0=tr
+00018e60: 616e 736c 6174 696f 6e2c 2031 3d6d 6972  anslation, 1=mir
+00018e70: 726f 722c 2032 3d72 6f74 6174 696f 6e2c  ror, 2=rotation,
+00018e80: 2033 3d69 6e76 6572 7369 6f6e 0d0a 2020   3=inversion..  
+00018e90: 2020 2020 2020 7061 7269 7479 203d 206e        parity = n
+00018ea0: 702e 6c69 6e61 6c67 2e64 6574 286d 5b3a  p.linalg.det(m[:
+00018eb0: 332c 203a 335d 2920 2023 2064 6574 6572  3, :3])  # deter
+00018ec0: 6d69 6e61 6e74 206f 6620 6f70 6572 6174  minant of operat
+00018ed0: 696f 6e20 2d20 2b2f 2d31 0d0a 2020 2020  ion - +/-1..    
+00018ee0: 2020 2020 7472 616e 736c 6174 696f 6e20      translation 
+00018ef0: 3d20 6e70 2e73 756d 286e 702e 6162 7328  = np.sum(np.abs(
+00018f00: 6d5b 3a33 2c20 335d 2929 0d0a 2020 2020  m[:3, 3]))..    
+00018f10: 2020 2020 6d73 756d 203d 206e 702e 7375      msum = np.su
+00018f20: 6d28 6d5b 3a33 2c20 3a33 5d29 0d0a 2020  m(m[:3, :3])..  
+00018f30: 2020 2020 2020 6173 756d 203d 206e 702e        asum = np.
+00018f40: 7375 6d28 6e70 2e61 6273 286d 5b3a 332c  sum(np.abs(m[:3,
+00018f50: 203a 335d 2929 0d0a 2020 2020 2020 2020   :3]))..        
+00018f60: 6966 2044 4542 5547 3a0d 0a20 2020 2020  if DEBUG:..     
+00018f70: 2020 2020 2020 2073 203d 2022 7b32 3073         s = "{20s
+00018f80: 7d3a 206e 733d 7b7d 2c20 7061 7269 7479  }: ns={}, parity
+00018f90: 3d7b 7d2c 2074 7261 6e73 6c61 7469 6f6e  ={}, translation
+00018fa0: 3d7b 7d2c 2073 756d 3d7b 7d2c 2061 6273  ={}, sum={}, abs
+00018fb0: 7375 6d3d 7b7d 220d 0a20 2020 2020 2020  sum={}"..       
+00018fc0: 2020 2020 2070 7269 6e74 2873 2e66 6f72       print(s.for
+00018fd0: 6d61 7428 6f73 2c20 6e73 2c20 7061 7269  mat(os, ns, pari
+00018fe0: 7479 2c20 7472 616e 736c 6174 696f 6e2c  ty, translation,
+00018ff0: 206d 7375 6d2c 2061 7375 6d29 290d 0a20   msum, asum)).. 
+00019000: 2020 2020 2020 2069 6620 6e73 203d 3d20         if ns == 
+00019010: 303a 2020 2320 7472 616e 736c 6174 696f  0:  # translatio
+00019020: 6e0d 0a20 2020 2020 2020 2020 2020 2069  n..            i
+00019030: 6620 7472 616e 736c 6174 696f 6e20 3c20  f translation < 
+00019040: 302e 3031 3a0d 0a20 2020 2020 2020 2020  0.01:..         
+00019050: 2020 2020 2020 206f 7574 202b 3d20 5b27         out += ['
+00019060: 3127 5d0d 0a20 2020 2020 2020 2020 2020  1']..           
+00019070: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00019080: 2020 2020 2020 2020 6f75 7420 2b3d 205b          out += [
+00019090: 2774 2825 2e32 672c 252e 3267 2c25 2e32  't(%.2g,%.2g,%.2
+000190a0: 6729 2720 2520 286d 5b33 2c20 305d 2c20  g)' % (m[3, 0], 
+000190b0: 6d5b 332c 2031 5d2c 206d 5b33 2c20 325d  m[3, 1], m[3, 2]
+000190c0: 295d 0d0a 2020 2020 2020 2020 656c 6966  )]..        elif
+000190d0: 206e 7320 3d3d 2033 3a20 2023 2069 6e76   ns == 3:  # inv
+000190e0: 6572 7369 6f6e 0d0a 2020 2020 2020 2020  ersion..        
+000190f0: 2020 2020 6f75 7420 2b3d 205b 272d 3127      out += ['-1'
+00019100: 5d0d 0a20 2020 2020 2020 2065 6c69 6620  ]..        elif 
+00019110: 7061 7269 7479 203e 2030 3a20 2023 2072  parity > 0:  # r
+00019120: 6f74 6174 696f 6e0d 0a20 2020 2020 2020  otation..       
+00019130: 2020 2020 2069 6620 7472 616e 736c 6174       if translat
+00019140: 696f 6e20 3c20 302e 3031 3a0d 0a20 2020  ion < 0.01:..   
+00019150: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00019160: 202b 3d20 5b27 526f 7461 7469 6f6e 275d   += ['Rotation']
+00019170: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00019180: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00019190: 2020 2020 206f 7574 202b 3d20 5b27 5363       out += ['Sc
+000191a0: 7265 7727 5d0d 0a20 2020 2020 2020 2065  rew']..        e
+000191b0: 6c69 6620 7061 7269 7479 203c 2031 3a20  lif parity < 1: 
+000191c0: 2023 206d 6972 726f 720d 0a20 2020 2020   # mirror..     
+000191d0: 2020 2020 2020 2069 6620 7472 616e 736c         if transl
+000191e0: 6174 696f 6e20 3c20 302e 3031 3a0d 0a20  ation < 0.01:.. 
+000191f0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00019200: 7574 202b 3d20 5b27 4d69 7272 6f72 275d  ut += ['Mirror']
+00019210: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00019220: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00019230: 2020 2020 206f 7574 202b 3d20 5b27 476c       out += ['Gl
+00019240: 6964 6527 5d0d 0a20 2020 2020 2020 2065  ide']..        e
+00019250: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00019260: 2020 6f75 7420 2b3d 205b 2755 6e6b 6e6f    out += ['Unkno
+00019270: 776e 275d 0d0a 2020 2020 7265 7475 726e  wn']..    return
+00019280: 206f 7574 0d0a 0d0a 0d0a 6465 6620 7379   out......def sy
+00019290: 6d5f 6f70 5f64 6574 2873 796d 5f6f 7073  m_op_det(sym_ops
+000192a0: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+000192b0: 2052 6574 7572 6e20 7468 6520 6465 7465   Return the dete
+000192c0: 726d 696e 616e 7420 6f66 2061 2073 796d  rminant of a sym
+000192d0: 6d65 7472 7920 6f70 6572 6174 696f 6e0d  metry operation.
+000192e0: 0a20 2020 203a 7061 7261 6d20 7379 6d5f  .    :param sym_
+000192f0: 6f70 733a 2073 7472 2065 2e67 2e20 2778  ops: str e.g. 'x
+00019300: 2c2d 792c 7a2b 312f 3227 206f 7220 2779  ,-y,z+1/2' or 'y
+00019310: 2c20 782b 792c 202d 7a2c 202d 3127 206f  , x+y, -z, -1' o
+00019320: 7220 6c69 7374 206f 6620 7374 7220 5b27  r list of str ['
+00019330: 782c 792c 7a27 2c2e 2e2e 5d0d 0a20 2020  x,y,z',...]..   
+00019340: 203a 7265 7475 726e 3a20 666c 6f61 7420   :return: float 
+00019350: 7c64 6574 7c20 6f72 206c 6973 7420 6f66  |det| or list of
+00019360: 2066 6c6f 6174 730d 0a20 2020 2022 2222   floats..    """
+00019370: 0d0a 2020 2020 6d61 7420 3d20 6765 6e5f  ..    mat = gen_
+00019380: 7379 6d5f 6d61 7428 7379 6d5f 6f70 7329  sym_mat(sym_ops)
+00019390: 0d0a 2020 2020 6966 206c 656e 286d 6174  ..    if len(mat
+000193a0: 2920 3d3d 2031 3a0d 0a20 2020 2020 2020  ) == 1:..       
+000193b0: 2072 6574 7572 6e20 6e70 2e6c 696e 616c   return np.linal
+000193c0: 672e 6465 7428 6d61 745b 305d 5b3a 332c  g.det(mat[0][:3,
+000193d0: 203a 335d 290d 0a20 2020 2072 6574 7572   :3])..    retur
+000193e0: 6e20 5b6e 702e 6c69 6e61 6c67 2e64 6574  n [np.linalg.det
+000193f0: 286d 5b3a 332c 203a 335d 2920 666f 7220  (m[:3, :3]) for 
+00019400: 6d20 696e 206d 6174 5d0d 0a0d 0a0d 0a64  m in mat]......d
+00019410: 6566 2067 656e 5f73 796d 5f61 7869 616c  ef gen_sym_axial
+00019420: 5f76 6563 746f 7228 7379 6d5f 6f70 732c  _vector(sym_ops,
+00019430: 2078 2c20 792c 207a 293a 0d0a 2020 2020   x, y, z):..    
+00019440: 2222 220d 0a20 2020 2020 5472 616e 7366  """..     Transf
+00019450: 6f72 6d20 6178 6961 6c20 7665 6374 6f72  orm axial vector
+00019460: 2062 7920 7379 6d6d 6574 7279 206f 7065   by symmetry ope
+00019470: 7261 7469 6f6e 730d 0a20 2020 2055 7361  rations..    Usa
+00019480: 6765 3a0d 0a20 2020 2020 2075 7677 203d  ge:..      uvw =
+00019490: 2067 656e 5f73 796d 6365 6e5f 706f 7328   gen_symcen_pos(
+000194a0: 7379 6d5f 6f70 732c 6365 6e5f 6f70 732c  sym_ops,cen_ops,
+000194b0: 782c 792c 7a29 0d0a 2020 2020 2020 7379  x,y,z)..      sy
+000194c0: 6d5f 6f70 7320 3d20 5b6e 2a27 782c 792c  m_ops = [n*'x,y,
+000194d0: 7a27 5d20 6172 7261 7920 6f66 2073 7472  z'] array of str
+000194e0: 696e 6720 7379 6d6d 6574 7279 206f 7065  ing symmetry ope
+000194f0: 7261 7469 6f6e 730d 0a20 2020 2020 2063  rations..      c
+00019500: 656e 5f6f 7073 203d 205b 6d2a 2778 2c79  en_ops = [m*'x,y
+00019510: 2c7a 275d 2061 7272 6179 206f 6620 7374  ,z'] array of st
+00019520: 7269 6e67 2063 656e 7472 696e 6720 6f70  ring centring op
+00019530: 6572 6174 696f 6e73 0d0a 2020 2020 2020  erations..      
+00019540: 782c 792c 7a20 3d20 6672 6163 7469 6f6e  x,y,z = fraction
+00019550: 616c 2063 6f6f 7264 696e 6174 6573 206f  al coordinates o
+00019560: 6620 6174 6f6d 6963 2070 6f73 6969 746f  f atomic posiito
+00019570: 6e20 746f 2062 6520 6d6f 6469 6669 6564  n to be modified
+00019580: 2062 7920 7379 6d6d 6574 7279 0d0a 2020   by symmetry..  
+00019590: 2020 2020 7576 7720 3d20 5b5b 6e78 335d      uvw = [[nx3]
+000195a0: 5d20 6172 7261 7920 6f66 2073 796d 6d65  ] array of symme
+000195b0: 7472 7920 6465 6669 6e65 6420 6661 6374  try defined fact
+000195c0: 696f 6e61 6c20 636f 6f72 6469 6e61 7465  ional coordinate
+000195d0: 7320 5b75 2c76 2c77 5d0d 0a0d 0a20 2020  s [u,v,w]....   
+000195e0: 2045 2e47 2e0d 0a20 2020 2020 2075 7677   E.G...      uvw
+000195f0: 203d 2067 656e 5f73 796d 6365 6e5f 706f   = gen_symcen_po
+00019600: 7328 5b27 782c 792c 7a27 2c27 792c 2d78  s(['x,y,z','y,-x
+00019610: 2c7a 2b31 2f32 275d 2c5b 2778 2c79 2c7a  ,z+1/2'],['x,y,z
+00019620: 272c 2778 2b31 2f33 2c79 2b31 2f33 2c7a  ','x+1/3,y+1/3,z
+00019630: 275d 2c30 2e31 2c30 2e32 2c30 2e33 290d  '],0.1,0.2,0.3).
+00019640: 0a20 2020 2020 2075 7677 203e 3e20 5b5b  .      uvw >> [[
+00019650: 302e 312c 302e 322c 302e 335d 202c 205b  0.1,0.2,0.3] , [
+00019660: 302e 3433 332c 302e 3533 332c 302e 335d  0.433,0.533,0.3]
+00019670: 202c 205b 302e 322c 2d30 2e31 2c30 2e38   , [0.2,-0.1,0.8
+00019680: 5d20 2c20 5b30 2e35 3333 2c2d 302e 3233  ] , [0.533,-0.23
+00019690: 332c 302e 385d 5d0d 0a20 2020 203a 7061  3,0.8]]..    :pa
+000196a0: 7261 6d20 7379 6d5f 6f70 733a 0d0a 2020  ram sym_ops:..  
+000196b0: 2020 3a70 6172 616d 2078 3a0d 0a20 2020    :param x:..   
+000196c0: 203a 7061 7261 6d20 793a 0d0a 2020 2020   :param y:..    
+000196d0: 3a70 6172 616d 207a 3a0d 0a20 2020 203a  :param z:..    :
+000196e0: 7265 7475 726e 3a0d 0a20 2020 2022 2222  return:..    """
+000196f0: 0d0a 2020 2020 6d61 7420 3d20 6765 6e5f  ..    mat = gen_
+00019700: 7379 6d5f 6d61 7428 7379 6d5f 6f70 7329  sym_mat(sym_ops)
+00019710: 0d0a 2020 2020 7265 7475 726e 205b 6e70  ..    return [np
+00019720: 2e6c 696e 616c 672e 6465 7428 6d5b 3a33  .linalg.det(m[:3
+00019730: 2c20 3a33 5d29 202a 206e 702e 646f 7428  , :3]) * np.dot(
+00019740: 6d5b 3a33 2c20 3a33 5d2c 2028 782c 2079  m[:3, :3], (x, y
+00019750: 2c20 7a29 2920 666f 7220 6d20 696e 206d  , z)) for m in m
+00019760: 6174 5d0d 0a0d 0a0d 0a64 6566 2069 6e76  at]......def inv
+00019770: 6572 745f 7379 6d28 7379 6d5f 6f70 293a  ert_sym(sym_op):
+00019780: 0d0a 2020 2020 2222 220d 0a20 2020 2049  ..    """..    I
+00019790: 6e76 6572 7420 7468 6520 7369 676e 206f  nvert the sign o
+000197a0: 6620 7468 6520 6769 7665 6e20 7379 6d6d  f the given symm
+000197b0: 6574 7279 206f 7065 7261 7469 6f6e 0d0a  etry operation..
+000197c0: 2020 2020 5573 6167 653a 0d0a 2020 2020      Usage:..    
+000197d0: 2020 6e65 775f 6f70 203d 2069 6e76 6572    new_op = inver
+000197e0: 745f 7379 6d28 7379 6d5f 6f70 290d 0a20  t_sym(sym_op).. 
+000197f0: 2020 2020 2073 796d 5f6f 7020 3d20 7374       sym_op = st
+00019800: 7220 7379 6d6d 6574 7279 206f 7065 7261  r symmetry opera
+00019810: 7469 6f6e 2065 2e67 2e20 2778 2c79 2c7a  tion e.g. 'x,y,z
+00019820: 270d 0a20 2020 2020 206e 6577 5f6f 7020  '..      new_op 
+00019830: 3d20 696e 7665 7274 6564 2073 796d 6d65  = inverted symme
+00019840: 7472 790d 0a20 2020 2045 2e47 2e0d 0a20  try..    E.G... 
+00019850: 2020 2020 206e 6577 5f6f 7020 3d20 696e       new_op = in
+00019860: 7665 7274 5f73 796d 2827 782c 792c 7a27  vert_sym('x,y,z'
+00019870: 290d 0a20 2020 2020 203e 3e20 6e65 775f  )..      >> new_
+00019880: 6f70 203d 2027 2d78 2c2d 792c 2d7a 270d  op = '-x,-y,-z'.
+00019890: 0a20 2020 2022 2222 0d0a 2020 2020 7379  .    """..    sy
+000198a0: 6d5f 6f70 203d 2073 796d 5f6f 702e 6c6f  m_op = sym_op.lo
+000198b0: 7765 7228 290d 0a20 2020 206e 6577 5f6f  wer()..    new_o
+000198c0: 7020 3d20 7379 6d5f 6f70 2e72 6570 6c61  p = sym_op.repla
+000198d0: 6365 2827 7827 2c20 272d 7827 292e 7265  ce('x', '-x').re
+000198e0: 706c 6163 6528 2779 272c 2027 2d79 2729  place('y', '-y')
+000198f0: 2e72 6570 6c61 6365 2827 7a27 2c20 272d  .replace('z', '-
+00019900: 7a27 292e 7265 706c 6163 6528 272d 2d27  z').replace('--'
+00019910: 2c20 272b 2729 2e72 6570 6c61 6365 2827  , '+').replace('
+00019920: 2b2d 272c 2027 2d27 290d 0a20 2020 2072  +-', '-')..    r
+00019930: 6574 7572 6e20 6e65 775f 6f70 0d0a 0d0a  eturn new_op....
+00019940: 0d0a 6465 6620 7379 6d5f 6f70 5f74 696d  ..def sym_op_tim
+00019950: 6528 6f70 6572 6174 696f 6e73 293a 0d0a  e(operations):..
+00019960: 2020 2020 2222 220d 0a20 2020 2052 6574      """..    Ret
+00019970: 7572 6e20 7468 6520 7469 6d65 2073 796d  urn the time sym
+00019980: 6d65 7472 7920 6f66 2061 2073 796d 6d65  metry of a symme
+00019990: 7472 7920 6f70 6572 6174 696f 6e0d 0a20  try operation.. 
+000199a0: 2020 203a 7061 7261 6d20 6f70 6572 6174     :param operat
+000199b0: 696f 6e73 3a20 6c69 7374 2873 7472 2920  ions: list(str) 
+000199c0: 652e 672e 205b 2778 2c2d 792c 7a2b 312f  e.g. ['x,-y,z+1/
+000199d0: 3227 2c20 2779 2c20 782b 792c 202d 7a2c  2', 'y, x+y, -z,
+000199e0: 202d 3127 5d0d 0a20 2020 203a 7265 7475   -1']..    :retu
+000199f0: 726e 3a20 6c69 7374 2c20 2b2f 2d31 0d0a  rn: list, +/-1..
+00019a00: 2020 2020 2222 220d 0a20 2020 206f 7065      """..    ope
+00019a10: 7261 7469 6f6e 7320 3d20 6e70 2e61 7361  rations = np.asa
+00019a20: 7272 6179 286f 7065 7261 7469 6f6e 7329  rray(operations)
+00019a30: 2e72 6573 6861 7065 282d 3129 0d0a 2020  .reshape(-1)..  
+00019a40: 2020 745f 6f70 203d 206e 702e 656d 7074    t_op = np.empt
+00019a50: 7928 6c65 6e28 6f70 6572 6174 696f 6e73  y(len(operations
+00019a60: 2929 0d0a 2020 2020 666f 7220 6e2c 2073  ))..    for n, s
+00019a70: 796d 5f6f 7020 696e 2065 6e75 6d65 7261  ym_op in enumera
+00019a80: 7465 286f 7065 7261 7469 6f6e 7329 3a0d  te(operations):.
+00019a90: 0a20 2020 2020 2020 206f 7073 203d 2073  .        ops = s
+00019aa0: 796d 5f6f 702e 7370 6c69 7428 272c 2729  ym_op.split(',')
+00019ab0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00019ac0: 286f 7073 2920 3c20 343a 0d0a 2020 2020  (ops) < 4:..    
+00019ad0: 2020 2020 2020 2020 745f 6f70 5b6e 5d20          t_op[n] 
+00019ae0: 3d20 310d 0a20 2020 2020 2020 2065 6c73  = 1..        els
+00019af0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00019b00: 745f 6f70 5b6e 5d20 3d20 696e 7428 6f70  t_op[n] = int(op
+00019b10: 735b 335d 290d 0a20 2020 2072 6574 7572  s[3])..    retur
+00019b20: 6e20 6c69 7374 2874 5f6f 7029 0d0a 0d0a  n list(t_op)....
+00019b30: 0d0a 6465 6620 7379 6d5f 6f70 5f6d 7828  ..def sym_op_mx(
+00019b40: 6f70 6572 6174 696f 6e73 293a 0d0a 2020  operations):..  
+00019b50: 2020 2222 220d 0a20 2020 2043 6f6e 7665    """..    Conve
+00019b60: 7274 2065 6163 6820 6f70 6572 6174 696f  rt each operatio
+00019b70: 6e20 6672 6f6d 2078 2c79 2c7a 2074 6f20  n from x,y,z to 
+00019b80: 6d78 2c6d 792c 6d7a 0d0a 2020 2020 3a70  mx,my,mz..    :p
+00019b90: 6172 616d 206f 7065 7261 7469 6f6e 733a  aram operations:
+00019ba0: 205b 2778 2c79 2c7a 272c 5d0d 0a20 2020   ['x,y,z',]..   
+00019bb0: 203a 7265 7475 726e 3a20 5b27 6d78 2c6d   :return: ['mx,m
+00019bc0: 792c 6d7a 272c 5d0d 0a20 2020 2022 2222  y,mz',]..    """
+00019bd0: 0d0a 2020 2020 6f70 6572 6174 696f 6e73  ..    operations
+00019be0: 203d 206c 6973 7428 6e70 2e61 7361 7272   = list(np.asarr
+00019bf0: 6179 286f 7065 7261 7469 6f6e 7329 2e72  ay(operations).r
+00019c00: 6573 6861 7065 282d 3129 290d 0a20 2020  eshape(-1))..   
+00019c10: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
+00019c20: 6c65 6e28 6f70 6572 6174 696f 6e73 2929  len(operations))
+00019c30: 3a0d 0a20 2020 2020 2020 2069 6620 276d  :..        if 'm
+00019c40: 7827 2069 6e20 6f70 6572 6174 696f 6e73  x' in operations
+00019c50: 5b6e 5d3a 2063 6f6e 7469 6e75 650d 0a20  [n]: continue.. 
+00019c60: 2020 2020 2020 206f 7065 7261 7469 6f6e         operation
+00019c70: 735b 6e5d 203d 206f 7065 7261 7469 6f6e  s[n] = operation
+00019c80: 735b 6e5d 2e72 6570 6c61 6365 2827 7827  s[n].replace('x'
+00019c90: 2c20 276d 7827 292e 7265 706c 6163 6528  , 'mx').replace(
+00019ca0: 2779 272c 2027 6d79 2729 2e72 6570 6c61  'y', 'my').repla
+00019cb0: 6365 2827 7a27 2c20 276d 7a27 290d 0a20  ce('z', 'mz').. 
+00019cc0: 2020 2072 6574 7572 6e20 6f70 6572 6174     return operat
+00019cd0: 696f 6e73 0d0a 0d0a 0d0a 6465 6620 7379  ions......def sy
+00019ce0: 6d6d 6574 7279 5f6f 7073 326d 6167 6e65  mmetry_ops2magne
+00019cf0: 7469 6328 6f70 6572 6174 696f 6e73 293a  tic(operations):
+00019d00: 0d0a 2020 2020 2222 220d 0a20 2020 2043  ..    """..    C
+00019d10: 6f6e 7665 7274 206c 6973 7420 6f66 2073  onvert list of s
+00019d20: 7472 696e 6720 7379 6d6d 6574 7279 206f  tring symmetry o
+00019d30: 7065 7261 7469 6f6e 7320 746f 206d 6167  perations to mag
+00019d40: 6e65 7469 6320 7379 6d6d 6574 7279 206f  netic symmetry o
+00019d50: 7065 7261 7469 6f6e 730d 0a20 2020 2053  perations..    S
+00019d60: 6565 2056 6573 7461 5f4d 616e 7561 6c2e  ee Vesta_Manual.
+00019d70: 7064 6620 5365 6374 696f 6e20 392e 312e  pdf Section 9.1.
+00019d80: 3120 2243 7265 6174 696f 6e20 616e 6420  1 "Creation and 
+00019d90: 6564 6974 696e 6720 6f66 2061 2076 6563  editing of a vec
+00019da0: 746f 7222 0d0a 2020 2020 4d61 676e 6574  tor"..    Magnet
+00019db0: 6963 2073 796d 6d65 7472 790d 0a20 2020  ic symmetry..   
+00019dc0: 2020 2020 20c2 b527 203d 2054 504d c2b5       ..' = TPM..
+00019dd0: 0d0a 2020 2020 5420 3d20 5469 6d65 206f  ..    T = Time o
+00019de0: 7065 7261 746f 7273 2078 2c79 2c7a 2c28  perators x,y,z,(
+00019df0: 2b31 290d 0a20 2020 2050 203d 2050 6172  +1)..    P = Par
+00019e00: 6974 7920 6f70 6572 6174 6f72 2028 6465  ity operator (de
+00019e10: 7465 726d 696e 616e 7420 6f66 204d 290d  terminant of M).
+00019e20: 0a20 2020 204d 203d 2053 796d 6d65 7472  .    M = Symmetr
+00019e30: 7920 6f70 6572 6174 6f72 2077 6974 686f  y operator witho
+00019e40: 7574 2074 7261 6e73 6c61 7469 6f6e 730d  ut translations.
+00019e50: 0a0d 0a20 2020 203a 7061 7261 6d20 6f70  ...    :param op
+00019e60: 6572 6174 696f 6e73 3a20 6c69 7374 206f  erations: list o
+00019e70: 6620 7374 7220 5b27 782c 792c 7a27 2c5d  f str ['x,y,z',]
+00019e80: 0d0a 2020 2020 3a72 6574 7572 6e3a 206c  ..    :return: l
+00019e90: 6973 7420 6f66 2073 7472 205b 2778 2c79  ist of str ['x,y
+00019ea0: 2c7a 275d 0d0a 2020 2020 2222 220d 0a20  ,z']..    """.. 
+00019eb0: 2020 206f 7065 7261 7469 6f6e 7320 3d20     operations = 
+00019ec0: 6e70 2e61 7361 7272 6179 286f 7065 7261  np.asarray(opera
+00019ed0: 7469 6f6e 7329 2e72 6573 6861 7065 282d  tions).reshape(-
+00019ee0: 3129 0d0a 2020 2020 2320 436f 6e76 6572  1)..    # Conver
+00019ef0: 7420 6f70 6572 6174 696f 6e73 2074 6f20  t operations to 
+00019f00: 6d61 7472 6963 6573 0d0a 2020 2020 6d61  matrices..    ma
+00019f10: 745f 6f70 7320 3d20 6765 6e5f 7379 6d5f  t_ops = gen_sym_
+00019f20: 6d61 7428 6f70 6572 6174 696f 6e73 290d  mat(operations).
+00019f30: 0a20 2020 2074 696d 5f6f 7073 203d 2073  .    tim_ops = s
+00019f40: 796d 5f6f 705f 7469 6d65 286f 7065 7261  ym_op_time(opera
+00019f50: 7469 6f6e 7329 0d0a 2020 2020 7374 725f  tions)..    str_
+00019f60: 6f70 7320 3d20 5b5d 0d0a 2020 2020 666f  ops = []..    fo
+00019f70: 7220 6e2c 206d 6174 2069 6e20 656e 756d  r n, mat in enum
+00019f80: 6572 6174 6528 6d61 745f 6f70 7329 3a0d  erate(mat_ops):.
+00019f90: 0a20 2020 2020 2020 2023 2047 6574 2074  .        # Get t
+00019fa0: 696d 6520 6f70 6572 6174 696f 6e0d 0a20  ime operation.. 
+00019fb0: 2020 2020 2020 2074 203d 2074 696d 5f6f         t = tim_o
+00019fc0: 7073 5b6e 5d0d 0a0d 0a20 2020 2020 2020  ps[n]....       
+00019fd0: 2023 204f 6e6c 7920 7573 6520 726f 7461   # Only use rota
+00019fe0: 7469 6f6e 616c 2070 6172 740d 0a20 2020  tional part..   
+00019ff0: 2020 2020 206d 203d 206d 6174 5b3a 332c       m = mat[:3,
+0001a000: 203a 335d 0d0a 0d0a 2020 2020 2020 2020   :3]....        
+0001a010: 2320 4765 7420 7061 7269 7479 0d0a 2020  # Get parity..  
+0001a020: 2020 2020 2020 7020 3d20 6e70 2e6c 696e        p = np.lin
+0001a030: 616c 672e 6465 7428 6d29 0d0a 0d0a 2020  alg.det(m)....  
+0001a040: 2020 2020 2020 2320 4765 6e65 7261 7465        # Generate
+0001a050: 2073 7472 696e 670d 0a20 2020 2020 2020   string..       
+0001a060: 206d 6167 5f73 7472 203d 2073 796d 5f6d   mag_str = sym_m
+0001a070: 6174 3273 7472 2874 202a 2070 202a 206d  at2str(t * p * m
+0001a080: 290d 0a20 2020 2020 2020 2023 206d 6167  )..        # mag
+0001a090: 5f73 7472 203d 206d 6167 5f73 7472 2e72  _str = mag_str.r
+0001a0a0: 6570 6c61 6365 2827 7827 2c20 276d 7827  eplace('x', 'mx'
+0001a0b0: 292e 7265 706c 6163 6528 2779 272c 2027  ).replace('y', '
+0001a0c0: 6d79 2729 2e72 6570 6c61 6365 2827 7a27  my').replace('z'
+0001a0d0: 2c20 276d 7a27 290d 0a20 2020 2020 2020  , 'mz')..       
+0001a0e0: 2073 7472 5f6f 7073 202b 3d20 5b6d 6167   str_ops += [mag
+0001a0f0: 5f73 7472 5d0d 0a20 2020 2072 6574 7572  _str]..    retur
+0001a100: 6e20 7374 725f 6f70 730d 0a0d 0a0d 0a64  n str_ops......d
+0001a110: 6566 206f 7274 686f 676f 6e61 6c5f 6178  ef orthogonal_ax
+0001a120: 6573 2878 5f61 7869 733d 2831 2c20 302c  es(x_axis=(1, 0,
+0001a130: 2030 292c 2079 5f61 7869 733d 2830 2c20   0), y_axis=(0, 
+0001a140: 312c 2030 2929 3a0d 0a20 2020 2022 2222  1, 0)):..    """
+0001a150: 0d0a 2020 2020 5265 7475 726e 7320 6f72  ..    Returns or
+0001a160: 7468 6f67 6f6e 616c 2072 6967 6874 2d68  thogonal right-h
+0001a170: 616e 6465 6420 6361 7274 6573 6961 6e20  anded cartesian 
+0001a180: 6178 6573 2062 6173 6564 206f 6e20 7468  axes based on th
+0001a190: 6520 706c 616e 6520 6f66 2074 776f 206e  e plane of two n
+0001a1a0: 6f6e 2d70 6572 7065 6e64 6963 756c 6172  on-perpendicular
+0001a1b0: 2076 6563 746f 7273 0d0a 2020 2020 452e   vectors..    E.
+0001a1c0: 472e 0d0a 2020 2020 2020 2020 782c 792c  G...        x,y,
+0001a1d0: 7a20 3d20 6f72 7468 6f67 6f6e 616c 5f61  z = orthogonal_a
+0001a1e0: 7865 7328 5b31 2c30 2c30 5d2c 5b30 2e35  xes([1,0,0],[0.5
+0001a1f0: 2c30 2e35 2c30 5d29 0d0a 2020 2020 2020  ,0.5,0])..      
+0001a200: 2020 3e3e 2078 203d 2061 7272 6179 285b    >> x = array([
+0001a210: 312c 302c 305d 290d 0a20 2020 2020 2020  1,0,0])..       
+0001a220: 203e 3e20 7920 3d20 6172 7261 7928 5b30   >> y = array([0
+0001a230: 2c31 2c30 5d29 0d0a 2020 2020 2020 2020  ,1,0])..        
+0001a240: 3e3e 207a 203d 2061 7272 6179 285b 302c  >> z = array([0,
+0001a250: 302c 315d 290d 0a20 2020 2045 2e47 2e0d  0,1])..    E.G..
+0001a260: 0a20 2020 2020 2020 2078 2c79 2c7a 203d  .        x,y,z =
+0001a270: 206f 7274 686f 676f 6e61 6c5f 6178 6573   orthogonal_axes
+0001a280: 285b 302c 312c 305d 2c5b 302c 302c 315d  ([0,1,0],[0,0,1]
+0001a290: 290d 0a20 2020 2020 2020 203e 3e20 7820  )..        >> x 
+0001a2a0: 3d20 6172 7261 7928 5b30 2c31 2c30 5d29  = array([0,1,0])
+0001a2b0: 0d0a 2020 2020 2020 2020 3e3e 2079 203d  ..        >> y =
+0001a2c0: 2061 7272 6179 285b 302c 302c 315d 290d   array([0,0,1]).
+0001a2d0: 0a20 2020 2020 2020 203e 3e20 7a20 3d20  .        >> z = 
+0001a2e0: 6172 7261 7928 5b31 2c30 2c30 5d29 0d0a  array([1,0,0])..
+0001a2f0: 2020 2020 2222 220d 0a0d 0a20 2020 2078      """....    x
+0001a300: 5f63 6172 7420 3d20 6667 2e6e 6f72 6d28  _cart = fg.norm(
+0001a310: 785f 6178 6973 290d 0a20 2020 2079 5f63  x_axis)..    y_c
+0001a320: 6172 7420 3d20 6667 2e6e 6f72 6d28 795f  art = fg.norm(y_
+0001a330: 6178 6973 290d 0a20 2020 207a 5f63 6172  axis)..    z_car
+0001a340: 7420 3d20 6667 2e6e 6f72 6d28 6e70 2e63  t = fg.norm(np.c
+0001a350: 726f 7373 2878 5f63 6172 742c 2079 5f63  ross(x_cart, y_c
+0001a360: 6172 7429 2920 2023 207a 2069 7320 7065  art))  # z is pe
+0001a370: 7270 2e20 746f 2078 2b79 0d0a 2020 2020  rp. to x+y..    
+0001a380: 795f 6361 7274 203d 206e 702e 6372 6f73  y_cart = np.cros
+0001a390: 7328 785f 6361 7274 2c20 7a5f 6361 7274  s(x_cart, z_cart
+0001a3a0: 2920 2023 206d 616b 6520 7375 7265 2079  )  # make sure y
+0001a3b0: 2069 7320 7065 7270 2e20 746f 2078 0d0a   is perp. to x..
+0001a3c0: 2020 2020 7265 7475 726e 2078 5f63 6172      return x_car
+0001a3d0: 742c 2079 5f63 6172 742c 207a 5f63 6172  t, y_cart, z_car
+0001a3e0: 740d 0a0d 0a0d 0a27 2d2d 2d2d 2d2d 2d2d  t......'--------
+0001a3f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001a400: 2d2d 2d2d 436f 6e76 6572 7369 6f6e 732d  ----Conversions-
+0001a410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001a420: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 270d  --------------'.
+0001a430: 0a0d 0a0d 0a64 6566 2067 656e 5f6c 6174  .....def gen_lat
+0001a440: 7469 6365 5f70 6172 616d 6574 6572 7328  tice_parameters(
+0001a450: 6c61 7474 6963 655f 7061 7261 6d65 7465  lattice_paramete
+0001a460: 7273 3d28 292c 202a 6172 6773 2c20 2a2a  rs=(), *args, **
+0001a470: 6b77 6172 6773 293a 0d0a 2020 2020 2222  kwargs):..    ""
+0001a480: 220d 0a20 2020 2047 656e 6572 6174 6520  "..    Generate 
+0001a490: 6c69 7374 206f 6620 6c61 7474 6963 6520  list of lattice 
+0001a4a0: 7061 7261 6d65 7465 7273 3a0d 0a20 2020  parameters:..   
+0001a4b0: 2020 612c 622c 632c 616c 7068 612c 6265    a,b,c,alpha,be
+0001a4c0: 7461 2c67 616d 6d61 203d 2067 656e 5f6c  ta,gamma = gen_l
+0001a4d0: 6174 7469 6365 5f70 6172 616d 6574 6572  attice_parameter
+0001a4e0: 7328 6172 6773 290d 0a20 2020 2061 7267  s(args)..    arg
+0001a4f0: 733a 0d0a 2020 2020 2020 3120 2d3e 2061  s:..      1 -> a
+0001a500: 3d62 3d63 3d31 2c61 6c70 6861 3d62 6574  =b=c=1,alpha=bet
+0001a510: 613d 6761 6d6d 613d 3930 0d0a 2020 2020  a=gamma=90..    
+0001a520: 2020 5b31 2c32 2c33 5d20 2d3e 2061 3d31    [1,2,3] -> a=1
+0001a530: 2c62 3d32 2c63 3d33 2c61 6c70 6861 3d62  ,b=2,c=3,alpha=b
+0001a540: 6574 613d 6761 6d6d 613d 3930 0d0a 2020  eta=gamma=90..  
+0001a550: 2020 2020 5b31 2c32 2c33 2c31 3230 5d20      [1,2,3,120] 
+0001a560: 2d3e 2061 3d31 2c62 3d32 2c63 3d33 2c61  -> a=1,b=2,c=3,a
+0001a570: 6c70 6861 3d62 6574 613d 3930 2c67 616d  lpha=beta=90,gam
+0001a580: 6d61 3d31 3230 0d0a 2020 2020 2020 5b31  ma=120..      [1
+0001a590: 2c32 2c33 2c31 302c 3230 2c33 305d 202d  ,2,3,10,20,30] -
+0001a5a0: 3e20 613d 312c 623d 322c 633d 332c 616c  > a=1,b=2,c=3,al
+0001a5b0: 7068 613d 3130 2c62 6574 613d 3230 2c67  pha=10,beta=20,g
+0001a5c0: 616d 6d61 3d33 300d 0a20 2020 2020 2031  amma=30..      1
+0001a5d0: 2c32 2c33 2c31 302c 3230 2c33 3020 2d3e  ,2,3,10,20,30 ->
+0001a5e0: 2061 3d31 2c62 3d32 2c63 3d33 2c61 6c70   a=1,b=2,c=3,alp
+0001a5f0: 6861 3d31 302c 6265 7461 3d32 302c 6761  ha=10,beta=20,ga
+0001a600: 6d6d 613d 3330 0d0a 2020 2020 2020 613d  mma=30..      a=
+0001a610: 312c 623d 322c 633d 332c 616c 7068 613d  1,b=2,c=3,alpha=
+0001a620: 3130 2c62 6574 613d 3230 2c67 616d 6d61  10,beta=20,gamma
+0001a630: 3d33 3020 2d3e 2061 3d31 2c62 3d32 2c63  =30 -> a=1,b=2,c
+0001a640: 3d33 2c61 6c70 6861 3d31 302c 6265 7461  =3,alpha=10,beta
+0001a650: 3d32 302c 6761 6d6d 613d 3330 0d0a 2020  =20,gamma=30..  
+0001a660: 2020 3a70 6172 616d 206c 6174 7469 6365    :param lattice
+0001a670: 5f70 6172 616d 6574 6572 733a 2066 6c6f  _parameters: flo
+0001a680: 6174 206f 7220 6c69 7374 0d0a 2020 2020  at or list..    
+0001a690: 3a70 6172 616d 2061 7267 733a 2066 6c6f  :param args: flo
+0001a6a0: 6174 730d 0a20 2020 203a 7061 7261 6d20  ats..    :param 
+0001a6b0: 6b77 6172 6773 3a20 6c61 7474 6963 6520  kwargs: lattice 
+0001a6c0: 7061 7261 6d65 7465 7273 0d0a 2020 2020  parameters..    
+0001a6d0: 3a72 6574 7572 6e3a 2061 2c62 2c63 2c61  :return: a,b,c,a
+0001a6e0: 6c70 6861 2c62 6574 612c 6761 6d6d 610d  lpha,beta,gamma.
+0001a6f0: 0a20 2020 2022 2222 0d0a 0d0a 2020 2020  .    """....    
+0001a700: 6c61 7474 6963 655f 7061 7261 6d65 7465  lattice_paramete
+0001a710: 7273 203d 206e 702e 6172 7261 7928 6c61  rs = np.array(la
+0001a720: 7474 6963 655f 7061 7261 6d65 7465 7273  ttice_parameters
+0001a730: 2c20 6474 7970 653d 666c 6f61 7429 2e72  , dtype=float).r
+0001a740: 6573 6861 7065 282d 3129 0d0a 2020 2020  eshape(-1)..    
+0001a750: 6c61 7474 6963 655f 7061 7261 6d65 7465  lattice_paramete
+0001a760: 7273 203d 206e 702e 6170 7065 6e64 286c  rs = np.append(l
+0001a770: 6174 7469 6365 5f70 6172 616d 6574 6572  attice_parameter
+0001a780: 732c 2061 7267 7329 0d0a 2020 2020 6966  s, args)..    if
+0001a790: 206c 656e 286c 6174 7469 6365 5f70 6172   len(lattice_par
+0001a7a0: 616d 6574 6572 7329 206e 6f74 2069 6e20  ameters) not in 
+0001a7b0: 5b30 2c20 312c 2033 2c20 342c 2036 5d3a  [0, 1, 3, 4, 6]:
+0001a7c0: 0d0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
+0001a7d0: 4578 6365 7074 696f 6e28 2749 6e63 6f72  Exception('Incor
+0001a7e0: 7265 6374 206e 756d 6265 7220 6f66 206c  rect number of l
+0001a7f0: 6174 7469 6365 2070 6172 616d 6574 6572  attice parameter
+0001a800: 7327 290d 0a20 2020 2061 203d 2062 203d  s')..    a = b =
+0001a810: 2063 203d 2031 2e30 0d0a 2020 2020 616c   c = 1.0..    al
+0001a820: 7068 6120 3d20 6265 7461 203d 2067 616d  pha = beta = gam
+0001a830: 6d61 203d 2039 302e 300d 0a0d 0a20 2020  ma = 90.0....   
+0001a840: 2069 6620 6c65 6e28 6c61 7474 6963 655f   if len(lattice_
+0001a850: 7061 7261 6d65 7465 7273 2920 3e20 303a  parameters) > 0:
+0001a860: 0d0a 2020 2020 2020 2020 6120 3d20 6c61  ..        a = la
+0001a870: 7474 6963 655f 7061 7261 6d65 7465 7273  ttice_parameters
+0001a880: 5b30 5d0d 0a20 2020 2020 2020 2062 203d  [0]..        b =
+0001a890: 2031 2e30 202a 2061 0d0a 2020 2020 2020   1.0 * a..      
+0001a8a0: 2020 6320 3d20 312e 3020 2a20 610d 0a0d    c = 1.0 * a...
+0001a8b0: 0a20 2020 2069 6620 6c65 6e28 6c61 7474  .    if len(latt
+0001a8c0: 6963 655f 7061 7261 6d65 7465 7273 2920  ice_parameters) 
+0001a8d0: 3e20 313a 0d0a 2020 2020 2020 2020 6220  > 1:..        b 
+0001a8e0: 3d20 6c61 7474 6963 655f 7061 7261 6d65  = lattice_parame
+0001a8f0: 7465 7273 5b31 5d0d 0a20 2020 2020 2020  ters[1]..       
+0001a900: 2063 203d 206c 6174 7469 6365 5f70 6172   c = lattice_par
+0001a910: 616d 6574 6572 735b 325d 0d0a 0d0a 2020  ameters[2]....  
+0001a920: 2020 6966 206c 656e 286c 6174 7469 6365    if len(lattice
+0001a930: 5f70 6172 616d 6574 6572 7329 203d 3d20  _parameters) == 
+0001a940: 343a 0d0a 2020 2020 2020 2020 6761 6d6d  4:..        gamm
+0001a950: 6120 3d20 6c61 7474 6963 655f 7061 7261  a = lattice_para
+0001a960: 6d65 7465 7273 5b33 5d0d 0a0d 0a20 2020  meters[3]....   
+0001a970: 2069 6620 6c65 6e28 6c61 7474 6963 655f   if len(lattice_
+0001a980: 7061 7261 6d65 7465 7273 2920 3d3d 2036  parameters) == 6
+0001a990: 3a0d 0a20 2020 2020 2020 2061 6c70 6861  :..        alpha
+0001a9a0: 203d 206c 6174 7469 6365 5f70 6172 616d   = lattice_param
+0001a9b0: 6574 6572 735b 335d 0d0a 2020 2020 2020  eters[3]..      
+0001a9c0: 2020 6265 7461 203d 206c 6174 7469 6365    beta = lattice
+0001a9d0: 5f70 6172 616d 6574 6572 735b 345d 0d0a  _parameters[4]..
+0001a9e0: 2020 2020 2020 2020 6761 6d6d 6120 3d20          gamma = 
+0001a9f0: 6c61 7474 6963 655f 7061 7261 6d65 7465  lattice_paramete
+0001aa00: 7273 5b35 5d0d 0a0d 0a20 2020 2069 6620  rs[5]....    if 
+0001aa10: 2761 2720 696e 206b 7761 7267 733a 0d0a  'a' in kwargs:..
+0001aa20: 2020 2020 2020 2020 6120 3d20 666c 6f61          a = floa
+0001aa30: 7428 6b77 6172 6773 2e67 6574 2827 6127  t(kwargs.get('a'
+0001aa40: 2929 0d0a 2020 2020 6966 2027 6227 2069  ))..    if 'b' i
+0001aa50: 6e20 6b77 6172 6773 3a0d 0a20 2020 2020  n kwargs:..     
+0001aa60: 2020 2062 203d 2066 6c6f 6174 286b 7761     b = float(kwa
+0001aa70: 7267 732e 6765 7428 2762 2729 290d 0a20  rgs.get('b')).. 
+0001aa80: 2020 2069 6620 2763 2720 696e 206b 7761     if 'c' in kwa
+0001aa90: 7267 733a 0d0a 2020 2020 2020 2020 6320  rgs:..        c 
+0001aaa0: 3d20 666c 6f61 7428 6b77 6172 6773 2e67  = float(kwargs.g
+0001aab0: 6574 2827 6327 2929 0d0a 2020 2020 6966  et('c'))..    if
+0001aac0: 2027 616c 7068 6127 2069 6e20 6b77 6172   'alpha' in kwar
+0001aad0: 6773 3a0d 0a20 2020 2020 2020 2061 6c70  gs:..        alp
+0001aae0: 6861 203d 2066 6c6f 6174 286b 7761 7267  ha = float(kwarg
+0001aaf0: 732e 6765 7428 2761 6c70 6861 2729 290d  s.get('alpha')).
+0001ab00: 0a20 2020 2069 6620 2762 6574 6127 2069  .    if 'beta' i
+0001ab10: 6e20 6b77 6172 6773 3a0d 0a20 2020 2020  n kwargs:..     
+0001ab20: 2020 2062 6574 6120 3d20 666c 6f61 7428     beta = float(
+0001ab30: 6b77 6172 6773 2e67 6574 2827 6265 7461  kwargs.get('beta
+0001ab40: 2729 290d 0a20 2020 2069 6620 2767 616d  '))..    if 'gam
+0001ab50: 6d61 2720 696e 206b 7761 7267 733a 0d0a  ma' in kwargs:..
+0001ab60: 2020 2020 2020 2020 6761 6d6d 6120 3d20          gamma = 
+0001ab70: 666c 6f61 7428 6b77 6172 6773 2e67 6574  float(kwargs.get
+0001ab80: 2827 6761 6d6d 6127 2929 0d0a 2020 2020  ('gamma'))..    
+0001ab90: 7265 7475 726e 2061 2c20 622c 2063 2c20  return a, b, c, 
+0001aba0: 616c 7068 612c 2062 6574 612c 2067 616d  alpha, beta, gam
+0001abb0: 6d61 0d0a 0d0a 0d0a 6465 6620 6c61 7470  ma......def latp
+0001abc0: 6172 3275 7628 6c61 7474 6963 655f 7061  ar2uv(lattice_pa
+0001abd0: 7261 6d65 7465 7273 3d28 292c 202a 6172  rameters=(), *ar
+0001abe0: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
+0001abf0: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
+0001ac00: 7665 7274 2061 2c62 2c63 2c61 6c70 6861  vert a,b,c,alpha
+0001ac10: 2c62 6574 612c 6761 6d6d 6120 746f 2055  ,beta,gamma to U
+0001ac20: 563d 5b41 2c42 2c43 5d0d 0a20 2020 2020  V=[A,B,C]..     
+0001ac30: 5556 203d 206c 6174 7061 7232 7576 2861  UV = latpar2uv(a
+0001ac40: 2c62 2c63 2c61 6c70 6861 3d39 302e 2c62  ,b,c,alpha=90.,b
+0001ac50: 6574 613d 3930 2e2c 6761 6d6d 613d 3132  eta=90.,gamma=12
+0001ac60: 302e 290d 0a20 2020 2020 5665 6374 6f72  0.)..     Vector
+0001ac70: 2063 2069 7320 6465 6669 6e65 6420 616c   c is defined al
+0001ac80: 6f6e 6720 5b30 2c30 2c31 5d0d 0a20 2020  ong [0,0,1]..   
+0001ac90: 2020 5665 6374 6f72 2061 2061 6e64 2062    Vector a and b
+0001aca0: 2061 7265 2064 6566 696e 6564 2062 7920   are defined by 
+0001acb0: 7468 6520 616e 676c 6573 0d0a 2020 2020  the angles..    
+0001acc0: 2222 220d 0a20 2020 2061 2c20 622c 2063  """..    a, b, c
+0001acd0: 2c20 616c 7068 612c 2062 6574 612c 2067  , alpha, beta, g
+0001ace0: 616d 6d61 203d 2067 656e 5f6c 6174 7469  amma = gen_latti
+0001acf0: 6365 5f70 6172 616d 6574 6572 7328 6c61  ce_parameters(la
+0001ad00: 7474 6963 655f 7061 7261 6d65 7465 7273  ttice_parameters
+0001ad10: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+0001ad20: 7329 0d0a 0d0a 2020 2020 2320 4672 6f6d  s)....    # From
+0001ad30: 2068 7474 703a 2f2f 7079 6d61 7467 656e   http://pymatgen
+0001ad40: 2e6f 7267 2f5f 6d6f 6475 6c65 732f 7079  .org/_modules/py
+0001ad50: 6d61 7467 656e 2f63 6f72 652f 6c61 7474  matgen/core/latt
+0001ad60: 6963 652e 6874 6d6c 0d0a 2020 2020 616c  ice.html..    al
+0001ad70: 7068 615f 7220 3d20 6e70 2e72 6164 6961  pha_r = np.radia
+0001ad80: 6e73 2861 6c70 6861 290d 0a20 2020 2062  ns(alpha)..    b
+0001ad90: 6574 615f 7220 3d20 6e70 2e72 6164 6961  eta_r = np.radia
+0001ada0: 6e73 2862 6574 6129 0d0a 2020 2020 6761  ns(beta)..    ga
+0001adb0: 6d6d 615f 7220 3d20 6e70 2e72 6164 6961  mma_r = np.radia
+0001adc0: 6e73 2867 616d 6d61 290d 0a20 2020 2076  ns(gamma)..    v
+0001add0: 616c 203d 2028 6e70 2e63 6f73 2861 6c70  al = (np.cos(alp
+0001ade0: 6861 5f72 2920 2a20 6e70 2e63 6f73 2862  ha_r) * np.cos(b
+0001adf0: 6574 615f 7229 202d 206e 702e 636f 7328  eta_r) - np.cos(
+0001ae00: 6761 6d6d 615f 7229 2920 5c0d 0a20 2020  gamma_r)) \..   
+0001ae10: 2020 2020 2020 202f 2028 6e70 2e73 696e         / (np.sin
+0001ae20: 2861 6c70 6861 5f72 2920 2a20 6e70 2e73  (alpha_r) * np.s
+0001ae30: 696e 2862 6574 615f 7229 290d 0a20 2020  in(beta_r))..   
+0001ae40: 2023 2053 6f6d 6574 696d 6573 2072 6f75   # Sometimes rou
+0001ae50: 6e64 696e 6720 6572 726f 7273 2072 6573  nding errors res
+0001ae60: 756c 7420 696e 2076 616c 7565 7320 736c  ult in values sl
+0001ae70: 6967 6874 6c79 203e 2031 2e0d 0a20 2020  ightly > 1...   
+0001ae80: 2076 616c 203d 2061 6273 2876 616c 290d   val = abs(val).
+0001ae90: 0a20 2020 2067 616d 6d61 5f73 7461 7220  .    gamma_star 
+0001aea0: 3d20 6e70 2e61 7263 636f 7328 7661 6c29  = np.arccos(val)
+0001aeb0: 0d0a 2020 2020 6161 203d 205b 6120 2a20  ..    aa = [a * 
+0001aec0: 6e70 2e73 696e 2862 6574 615f 7229 2c20  np.sin(beta_r), 
+0001aed0: 302e 302c 2061 202a 206e 702e 636f 7328  0.0, a * np.cos(
+0001aee0: 6265 7461 5f72 295d 0d0a 2020 2020 6262  beta_r)]..    bb
+0001aef0: 203d 205b 2d62 202a 206e 702e 7369 6e28   = [-b * np.sin(
+0001af00: 616c 7068 615f 7229 202a 206e 702e 636f  alpha_r) * np.co
+0001af10: 7328 6761 6d6d 615f 7374 6172 292c 0d0a  s(gamma_star),..
+0001af20: 2020 2020 2020 2020 2020 6220 2a20 6e70            b * np
+0001af30: 2e73 696e 2861 6c70 6861 5f72 2920 2a20  .sin(alpha_r) * 
+0001af40: 6e70 2e73 696e 2867 616d 6d61 5f73 7461  np.sin(gamma_sta
+0001af50: 7229 2c0d 0a20 2020 2020 2020 2020 2062  r),..          b
+0001af60: 202a 206e 702e 636f 7328 616c 7068 615f   * np.cos(alpha_
+0001af70: 7229 5d0d 0a20 2020 2063 6320 3d20 5b30  r)]..    cc = [0
+0001af80: 2e30 2c20 302e 302c 2063 5d0d 0a0d 0a20  .0, 0.0, c].... 
+0001af90: 2020 2072 6574 7572 6e20 6e70 2e72 6f75     return np.rou
+0001afa0: 6e64 286e 702e 6172 7261 7928 5b61 612c  nd(np.array([aa,
+0001afb0: 2062 622c 2063 635d 292c 2038 290d 0a0d   bb, cc]), 8)...
+0001afc0: 0a0d 0a64 6566 206c 6174 7061 7232 7576  ...def latpar2uv
+0001afd0: 5f72 6f74 286c 6174 7469 6365 5f70 6172  _rot(lattice_par
+0001afe0: 616d 6574 6572 733d 2829 2c20 2a61 7267  ameters=(), *arg
+0001aff0: 732c 202a 2a6b 7761 7267 7329 3a0d 0a20  s, **kwargs):.. 
+0001b000: 2020 2022 2222 0d0a 2020 2020 436f 6e76     """..    Conv
+0001b010: 6572 7420 612c 622c 632c 616c 7068 612c  ert a,b,c,alpha,
+0001b020: 6265 7461 2c67 616d 6d61 2074 6f20 5556  beta,gamma to UV
+0001b030: 3d5b 412c 422c 435d 0d0a 2020 2020 2055  =[A,B,C]..     U
+0001b040: 5620 3d20 6c61 7470 6172 3275 765f 726f  V = latpar2uv_ro
+0001b050: 7428 612c 622c 632c 616c 7068 613d 3930  t(a,b,c,alpha=90
+0001b060: 2e2c 6265 7461 3d39 302e 2c67 616d 6d61  .,beta=90.,gamma
+0001b070: 3d31 3230 2e29 0d0a 2020 2020 2056 6563  =120.)..     Vec
+0001b080: 746f 7220 6220 6973 2064 6566 696e 6564  tor b is defined
+0001b090: 2061 6c6f 6e67 205b 302c 312c 305d 0d0a   along [0,1,0]..
+0001b0a0: 2020 2020 2056 6563 746f 7220 6120 616e       Vector a an
+0001b0b0: 6420 6320 6172 6520 6465 6669 6e65 6420  d c are defined 
+0001b0c0: 6279 2074 6865 2061 6e67 6c65 730d 0a20  by the angles.. 
+0001b0d0: 2020 2022 2222 0d0a 2020 2020 612c 2062     """..    a, b
+0001b0e0: 2c20 632c 2061 6c70 6861 2c20 6265 7461  , c, alpha, beta
+0001b0f0: 2c20 6761 6d6d 6120 3d20 6765 6e5f 6c61  , gamma = gen_la
+0001b100: 7474 6963 655f 7061 7261 6d65 7465 7273  ttice_parameters
+0001b110: 286c 6174 7469 6365 5f70 6172 616d 6574  (lattice_paramet
+0001b120: 6572 732c 202a 6172 6773 2c20 2a2a 6b77  ers, *args, **kw
+0001b130: 6172 6773 290d 0a0d 0a20 2020 2023 2046  args)....    # F
+0001b140: 726f 6d20 6874 7470 3a2f 2f70 796d 6174  rom http://pymat
+0001b150: 6765 6e2e 6f72 672f 5f6d 6f64 756c 6573  gen.org/_modules
+0001b160: 2f70 796d 6174 6765 6e2f 636f 7265 2f6c  /pymatgen/core/l
+0001b170: 6174 7469 6365 2e68 746d 6c0d 0a20 2020  attice.html..   
+0001b180: 2061 6c70 6861 5f72 203d 206e 702e 7261   alpha_r = np.ra
+0001b190: 6469 616e 7328 616c 7068 6129 0d0a 2020  dians(alpha)..  
+0001b1a0: 2020 6265 7461 5f72 203d 206e 702e 7261    beta_r = np.ra
+0001b1b0: 6469 616e 7328 6761 6d6d 6129 0d0a 2020  dians(gamma)..  
+0001b1c0: 2020 6761 6d6d 615f 7220 3d20 6e70 2e72    gamma_r = np.r
+0001b1d0: 6164 6961 6e73 2862 6574 6129 0d0a 2020  adians(beta)..  
+0001b1e0: 2020 7661 6c20 3d20 286e 702e 636f 7328    val = (np.cos(
+0001b1f0: 616c 7068 615f 7229 202a 206e 702e 636f  alpha_r) * np.co
+0001b200: 7328 6265 7461 5f72 2920 2d20 6e70 2e63  s(beta_r) - np.c
+0001b210: 6f73 2867 616d 6d61 5f72 2929 205c 0d0a  os(gamma_r)) \..
+0001b220: 2020 2020 2020 2020 2020 2f20 286e 702e            / (np.
+0001b230: 7369 6e28 616c 7068 615f 7229 202a 206e  sin(alpha_r) * n
+0001b240: 702e 7369 6e28 6265 7461 5f72 2929 0d0a  p.sin(beta_r))..
+0001b250: 2020 2020 2320 536f 6d65 7469 6d65 7320      # Sometimes 
+0001b260: 726f 756e 6469 6e67 2065 7272 6f72 7320  rounding errors 
+0001b270: 7265 7375 6c74 2069 6e20 7661 6c75 6573  result in values
+0001b280: 2073 6c69 6768 746c 7920 3e20 312e 0d0a   slightly > 1...
+0001b290: 2020 2020 7661 6c20 3d20 6162 7328 7661      val = abs(va
+0001b2a0: 6c29 0d0a 2020 2020 6761 6d6d 615f 7374  l)..    gamma_st
+0001b2b0: 6172 203d 206e 702e 6172 6363 6f73 2876  ar = np.arccos(v
+0001b2c0: 616c 290d 0a20 2020 2061 6120 3d20 5b61  al)..    aa = [a
+0001b2d0: 202a 206e 702e 7369 6e28 6265 7461 5f72   * np.sin(beta_r
+0001b2e0: 292c 2061 202a 206e 702e 636f 7328 6265  ), a * np.cos(be
+0001b2f0: 7461 5f72 292c 2030 2e30 5d0d 0a20 2020  ta_r), 0.0]..   
+0001b300: 2062 6220 3d20 5b30 2e30 2c20 622c 2030   bb = [0.0, b, 0
+0001b310: 2e30 5d0d 0a20 2020 2063 6320 3d20 5b2d  .0]..    cc = [-
+0001b320: 6320 2a20 6e70 2e73 696e 2861 6c70 6861  c * np.sin(alpha
+0001b330: 5f72 2920 2a20 6e70 2e63 6f73 2867 616d  _r) * np.cos(gam
+0001b340: 6d61 5f73 7461 7229 2c0d 0a20 2020 2020  ma_star),..     
+0001b350: 2020 2020 2063 202a 206e 702e 636f 7328       c * np.cos(
+0001b360: 616c 7068 615f 7229 2c0d 0a20 2020 2020  alpha_r),..     
+0001b370: 2020 2020 2063 202a 206e 702e 7369 6e28       c * np.sin(
+0001b380: 616c 7068 615f 7229 202a 206e 702e 7369  alpha_r) * np.si
+0001b390: 6e28 6761 6d6d 615f 7374 6172 295d 0d0a  n(gamma_star)]..
+0001b3a0: 0d0a 2020 2020 7265 7475 726e 206e 702e  ..    return np.
+0001b3b0: 726f 756e 6428 6e70 2e61 7272 6179 285b  round(np.array([
+0001b3c0: 6161 2c20 6262 2c20 6363 5d29 2c20 3829  aa, bb, cc]), 8)
+0001b3d0: 0d0a 0d0a 0d0a 6465 6620 5556 326c 6174  ......def UV2lat
+0001b3e0: 7061 7228 5556 293a 0d0a 2020 2020 2222  par(UV):..    ""
+0001b3f0: 220d 0a20 2020 2043 6f6e 7665 7274 2055  "..    Convert U
+0001b400: 563d 5b61 2c62 2c63 5d20 746f 2061 2c62  V=[a,b,c] to a,b
+0001b410: 2c63 2c61 6c70 6861 2c62 6574 612c 6761  ,c,alpha,beta,ga
+0001b420: 6d6d 610d 0a20 2020 2020 612c 622c 632c  mma..     a,b,c,
+0001b430: 616c 7068 612c 6265 7461 2c67 616d 6d61  alpha,beta,gamma
+0001b440: 203d 2055 5632 6c61 7470 6172 2855 5629   = UV2latpar(UV)
+0001b450: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
+0001b460: 2061 203d 206e 702e 7371 7274 286e 702e   a = np.sqrt(np.
+0001b470: 7375 6d28 5556 5b30 5d20 2a2a 2032 2929  sum(UV[0] ** 2))
+0001b480: 0d0a 2020 2020 6220 3d20 6e70 2e73 7172  ..    b = np.sqr
+0001b490: 7428 6e70 2e73 756d 2855 565b 315d 202a  t(np.sum(UV[1] *
+0001b4a0: 2a20 3229 290d 0a20 2020 2063 203d 206e  * 2))..    c = n
+0001b4b0: 702e 7371 7274 286e 702e 7375 6d28 5556  p.sqrt(np.sum(UV
+0001b4c0: 5b32 5d20 2a2a 2032 2929 0d0a 2020 2020  [2] ** 2))..    
+0001b4d0: 616c 7068 6120 3d20 6e70 2e61 7263 7461  alpha = np.arcta
+0001b4e0: 6e32 286e 702e 6c69 6e61 6c67 2e6e 6f72  n2(np.linalg.nor
+0001b4f0: 6d28 6e70 2e63 726f 7373 2855 565b 315d  m(np.cross(UV[1]
+0001b500: 2c20 5556 5b32 5d29 292c 206e 702e 646f  , UV[2])), np.do
+0001b510: 7428 5556 5b31 5d2c 2055 565b 325d 2929  t(UV[1], UV[2]))
+0001b520: 202a 2031 3830 202f 206e 702e 7069 0d0a   * 180 / np.pi..
+0001b530: 2020 2020 6265 7461 203d 206e 702e 6172      beta = np.ar
+0001b540: 6374 616e 3228 6e70 2e6c 696e 616c 672e  ctan2(np.linalg.
+0001b550: 6e6f 726d 286e 702e 6372 6f73 7328 5556  norm(np.cross(UV
+0001b560: 5b30 5d2c 2055 565b 325d 2929 2c20 6e70  [0], UV[2])), np
+0001b570: 2e64 6f74 2855 565b 305d 2c20 5556 5b32  .dot(UV[0], UV[2
+0001b580: 5d29 2920 2a20 3138 3020 2f20 6e70 2e70  ])) * 180 / np.p
+0001b590: 690d 0a20 2020 2067 616d 6d61 203d 206e  i..    gamma = n
+0001b5a0: 702e 6172 6374 616e 3228 6e70 2e6c 696e  p.arctan2(np.lin
+0001b5b0: 616c 672e 6e6f 726d 286e 702e 6372 6f73  alg.norm(np.cros
+0001b5c0: 7328 5556 5b30 5d2c 2055 565b 315d 2929  s(UV[0], UV[1]))
+0001b5d0: 2c20 6e70 2e64 6f74 2855 565b 305d 2c20  , np.dot(UV[0], 
+0001b5e0: 5556 5b31 5d29 2920 2a20 3138 3020 2f20  UV[1])) * 180 / 
+0001b5f0: 6e70 2e70 690d 0a20 2020 2072 6574 7572  np.pi..    retur
+0001b600: 6e20 612c 2062 2c20 632c 2061 6c70 6861  n a, b, c, alpha
+0001b610: 2c20 6265 7461 2c20 6761 6d6d 610d 0a0d  , beta, gamma...
+0001b620: 0a0d 0a64 6566 2068 6b6c 3251 2868 6b6c  ...def hkl2Q(hkl
+0001b630: 2c20 5556 7374 6172 293a 0d0a 2020 2020  , UVstar):..    
+0001b640: 2222 220d 0a20 2020 2043 6f6e 7665 7274  """..    Convert
+0001b650: 2072 6566 6c65 6374 696f 6e20 696e 6469   reflection indi
+0001b660: 6365 7320 2868 6b6c 2920 746f 206f 7274  ces (hkl) to ort
+0001b670: 686f 676f 6e61 6c20 6261 7369 7320 696e  hogonal basis in
+0001b680: 2041 2d31 0d0a 2020 2020 3a70 6172 616d   A-1..    :param
+0001b690: 2068 6b6c 3a20 5b6e 7833 5d20 6172 7261   hkl: [nx3] arra
+0001b6a0: 7920 6f66 2072 6566 6c65 6374 696f 6e73  y of reflections
+0001b6b0: 0d0a 2020 2020 3a70 6172 616d 2055 563a  ..    :param UV:
+0001b6c0: 205b 3378 335d 2061 7272 6179 206f 6620   [3x3] array of 
+0001b6d0: 756e 6974 2063 656c 6c20 7665 6374 6f72  unit cell vector
+0001b6e0: 7320 5b5b 6131 2c61 322c 6133 5d2c 5b62  s [[a1,a2,a3],[b
+0001b6f0: 312c 6232 2c62 335d 2c5b 6331 2c63 322c  1,b2,b3],[c1,c2,
+0001b700: 6333 5d5d 0d0a 2020 2020 3a72 6574 7572  c3]]..    :retur
+0001b710: 6e3a 205b 6e78 335d 2061 7272 6179 206f  n: [nx3] array o
+0001b720: 6620 7761 7665 7665 6374 6f72 7320 696e  f wavevectors in
+0001b730: 2061 6e20 6f72 7468 6f67 6f6e 616c 2062   an orthogonal b
+0001b740: 6173 6973 2c20 696e 2041 2d31 0d0a 2020  asis, in A-1..  
+0001b750: 2020 2222 220d 0a20 2020 2072 6574 7572    """..    retur
+0001b760: 6e20 6e70 2e64 6f74 2868 6b6c 2c20 5556  n np.dot(hkl, UV
+0001b770: 7374 6172 290d 0a0d 0a0d 0a64 6566 2051  star)......def Q
+0001b780: 3268 6b6c 2871 7665 632c 2055 5673 7461  2hkl(qvec, UVsta
+0001b790: 7229 3a0d 0a20 2020 2022 2222 0d0a 2020  r):..    """..  
+0001b7a0: 2020 496e 6465 7820 7665 6374 6f72 7320    Index vectors 
+0001b7b0: 696e 2061 6e20 6f72 7468 6f6e 616c 2062  in an orthonal b
+0001b7c0: 6173 6973 2077 6974 6820 6120 7265 6369  asis with a reci
+0001b7d0: 7072 6f63 616c 2062 6173 6973 0d0a 2020  procal basis..  
+0001b7e0: 2020 3a70 6172 616d 2071 7665 633a 205b    :param qvec: [
+0001b7f0: 6e78 335d 2061 7272 6179 206f 6620 636f  nx3] array of co
+0001b800: 6f72 6469 6e61 7465 7320 696e 2061 6e20  ordinates in an 
+0001b810: 6f72 7468 6f67 6f6e 616c 2062 6173 6973  orthogonal basis
+0001b820: 2069 6e20 412d 310d 0a20 2020 203a 7061   in A-1..    :pa
+0001b830: 7261 6d20 5556 3a20 5b33 7833 5d20 6172  ram UV: [3x3] ar
+0001b840: 7261 7920 6f66 2075 6e69 7420 6365 6c6c  ray of unit cell
+0001b850: 2076 6563 746f 7273 205b 5b61 312c 6132   vectors [[a1,a2
+0001b860: 2c61 335d 2c5b 6231 2c62 322c 6233 5d2c  ,a3],[b1,b2,b3],
+0001b870: 5b63 312c 6332 2c63 335d 5d0d 0a20 2020  [c1,c2,c3]]..   
+0001b880: 203a 7265 7475 726e 3a20 5b6e 7833 5d20   :return: [nx3] 
+0001b890: 6172 7261 7920 6f66 2076 6563 746f 7273  array of vectors
+0001b8a0: 2069 6e20 7265 6369 7072 6f63 616c 206c   in reciprocal l
+0001b8b0: 6174 7469 6365 2075 6e69 7473 0d0a 2020  attice units..  
+0001b8c0: 2020 2222 220d 0a20 2020 2072 6574 7572    """..    retur
+0001b8d0: 6e20 6667 2e69 6e64 6578 5f63 6f6f 7264  n fg.index_coord
+0001b8e0: 696e 6174 6573 2871 7665 632c 2055 5673  inates(qvec, UVs
+0001b8f0: 7461 7229 0d0a 0d0a 0d0a 6465 6620 686b  tar)......def hk
+0001b900: 6c32 516d 6167 2868 6b6c 2c20 5556 7374  l2Qmag(hkl, UVst
+0001b910: 6172 293a 0d0a 2020 2020 2222 220d 0a20  ar):..    """.. 
+0001b920: 2020 2043 616c 6375 616c 7465 206d 6167     Calcualte mag
+0001b930: 6e69 7475 6465 206f 6620 5120 6672 6f6d  nitude of Q from
+0001b940: 2068 6b6c 2072 6566 6c65 6374 696f 6e0d   hkl reflection.
+0001b950: 0a20 2020 203a 7061 7261 6d20 686b 6c3a  .    :param hkl:
+0001b960: 205b 6e78 335d 2061 7272 6179 206f 6620   [nx3] array of 
+0001b970: 7265 666c 6563 7469 6f6e 730d 0a20 2020  reflections..   
+0001b980: 203a 7061 7261 6d20 5556 3a20 5b33 7833   :param UV: [3x3
+0001b990: 5d20 6172 7261 7920 6f66 2075 6e69 7420  ] array of unit 
+0001b9a0: 6365 6c6c 2076 6563 746f 7273 0d0a 2020  cell vectors..  
+0001b9b0: 2020 3a72 6574 7572 6e3a 205b 6e78 315d    :return: [nx1]
+0001b9c0: 2061 7272 6179 206f 6620 7761 7665 7665   array of waveve
+0001b9d0: 6374 6f72 206d 6167 6e69 7475 6465 732c  ctor magnitudes,
+0001b9e0: 2069 6e20 412d 310d 0a20 2020 2022 2222   in A-1..    """
+0001b9f0: 0d0a 2020 2020 5120 3d20 6e70 2e64 6f74  ..    Q = np.dot
+0001ba00: 2868 6b6c 2c20 5556 7374 6172 290d 0a20  (hkl, UVstar).. 
+0001ba10: 2020 2072 6574 7572 6e20 6667 2e6d 6167     return fg.mag
+0001ba20: 2851 290d 0a0d 0a0d 0a64 6566 2068 6b6c  (Q)......def hkl
+0001ba30: 3274 776f 7468 6574 6128 686b 6c2c 2055  2twotheta(hkl, U
+0001ba40: 5673 7461 722c 2065 6e65 7267 795f 6b65  Vstar, energy_ke
+0001ba50: 763d 3137 2e37 3934 2c20 7761 7665 6c65  v=17.794, wavele
+0001ba60: 6e67 7468 5f61 3d4e 6f6e 6529 3a0d 0a20  ngth_a=None):.. 
+0001ba70: 2020 2022 2222 0d0a 2020 2020 4361 6c63     """..    Calc
+0001ba80: 7561 6c74 6520 642d 7370 6163 696e 6720  ualte d-spacing 
+0001ba90: 6672 6f6d 2068 6b6c 2072 6566 6c65 6374  from hkl reflect
+0001baa0: 696f 6e0d 0a20 2020 203a 7061 7261 6d20  ion..    :param 
+0001bab0: 686b 6c3a 205b 6e78 335d 2061 7272 6179  hkl: [nx3] array
+0001bac0: 206f 6620 7265 666c 6563 7469 6f6e 730d   of reflections.
+0001bad0: 0a20 2020 203a 7061 7261 6d20 5556 3a20  .    :param UV: 
+0001bae0: 5b33 7833 5d20 6172 7261 7920 6f66 2075  [3x3] array of u
+0001baf0: 6e69 7420 6365 6c6c 2076 6563 746f 7273  nit cell vectors
+0001bb00: 0d0a 2020 2020 3a70 6172 616d 2065 6e65  ..    :param ene
+0001bb10: 7267 795f 6b65 763a 2066 6c6f 6174 2065  rgy_kev: float e
+0001bb20: 6e65 7267 7920 696e 206b 6556 0d0a 2020  nergy in keV..  
+0001bb30: 2020 3a70 6172 616d 2077 6176 656c 656e    :param wavelen
+0001bb40: 6774 685f 613a 2066 6c6f 6174 2077 6176  gth_a: float wav
+0001bb50: 656c 656e 6774 6820 696e 2041 6e67 7374  elength in Angst
+0001bb60: 726f 6d73 0d0a 2020 2020 3a72 6574 7572  roms..    :retur
+0001bb70: 6e3a 205b 6e78 315d 2061 7272 6179 206f  n: [nx1] array o
+0001bb80: 6620 642d 7370 6163 696e 6720 696e 2041  f d-spacing in A
+0001bb90: 0d0a 2020 2020 2222 220d 0a20 2020 2071  ..    """..    q
+0001bba0: 203d 206e 702e 646f 7428 686b 6c2c 2055   = np.dot(hkl, U
+0001bbb0: 5673 7461 7229 0d0a 2020 2020 715f 6d61  Vstar)..    q_ma
+0001bbc0: 6720 3d20 6667 2e6d 6167 2871 290d 0a20  g = fg.mag(q).. 
+0001bbd0: 2020 2072 6574 7572 6e20 6361 6c32 7468     return cal2th
+0001bbe0: 6574 6128 715f 6d61 672c 2065 6e65 7267  eta(q_mag, energ
+0001bbf0: 795f 6b65 762c 2077 6176 656c 656e 6774  y_kev, wavelengt
+0001bc00: 685f 6129 0d0a 0d0a 0d0a 6465 6620 686b  h_a)......def hk
+0001bc10: 6c32 6473 7061 6365 2868 6b6c 2c20 5556  l2dspace(hkl, UV
+0001bc20: 7374 6172 293a 0d0a 2020 2020 2222 220d  star):..    """.
+0001bc30: 0a20 2020 2043 616c 6375 616c 7465 2064  .    Calcualte d
+0001bc40: 2d73 7061 6369 6e67 2066 726f 6d20 686b  -spacing from hk
+0001bc50: 6c20 7265 666c 6563 7469 6f6e 0d0a 2020  l reflection..  
+0001bc60: 2020 3a70 6172 616d 2068 6b6c 3a20 5b6e    :param hkl: [n
+0001bc70: 7833 5d20 6172 7261 7920 6f66 2072 6566  x3] array of ref
+0001bc80: 6c65 6374 696f 6e73 0d0a 2020 2020 3a70  lections..    :p
+0001bc90: 6172 616d 2055 563a 205b 3378 335d 2061  aram UV: [3x3] a
+0001bca0: 7272 6179 206f 6620 7265 6369 7072 6f63  rray of reciproc
+0001bcb0: 616c 2075 6e69 7420 6365 6c6c 2076 6563  al unit cell vec
+0001bcc0: 746f 7273 0d0a 2020 2020 3a72 6574 7572  tors..    :retur
+0001bcd0: 6e3a 205b 6e78 315d 2061 7272 6179 206f  n: [nx1] array o
+0001bce0: 6620 642d 7370 6163 696e 6720 696e 2041  f d-spacing in A
+0001bcf0: 0d0a 2020 2020 2222 220d 0a20 2020 2051  ..    """..    Q
+0001bd00: 203d 206e 702e 646f 7428 686b 6c2c 2055   = np.dot(hkl, U
+0001bd10: 5673 7461 7229 0d0a 2020 2020 516d 6167  Vstar)..    Qmag
+0001bd20: 203d 2066 672e 6d61 6728 5129 0d0a 2020   = fg.mag(Q)..  
+0001bd30: 2020 7265 7475 726e 2071 3264 7370 6163    return q2dspac
+0001bd40: 6528 516d 6167 290d 0a0d 0a0d 0a64 6566  e(Qmag)......def
+0001bd50: 206c 6174 7469 6365 5f68 6b6c 3264 7370   lattice_hkl2dsp
+0001bd60: 6163 6528 686b 6c2c 206c 6174 7469 6365  ace(hkl, lattice
+0001bd70: 5f70 6172 616d 6574 6572 733d 2829 2c20  _parameters=(), 
+0001bd80: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+0001bd90: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+0001bda0: 4361 6c63 7561 6c74 6520 6473 7061 6365  Calcualte dspace
+0001bdb0: 2066 726f 6d20 6c61 7474 6963 6520 7061   from lattice pa
+0001bdc0: 7261 6d65 7465 7273 0d0a 2020 2020 3a70  rameters..    :p
+0001bdd0: 6172 616d 2068 6b6c 3a20 5b6e 7833 5d20  aram hkl: [nx3] 
+0001bde0: 6172 7261 7920 6f66 2072 6566 6c65 6374  array of reflect
+0001bdf0: 696f 6e73 0d0a 2020 2020 3a70 6172 616d  ions..    :param
+0001be00: 206c 6174 7469 6365 5f70 6172 616d 6574   lattice_paramet
+0001be10: 6572 733a 2061 2c62 2c63 2c61 6c70 6861  ers: a,b,c,alpha
+0001be20: 2c62 6574 612c 6761 6d6d 610d 0a20 2020  ,beta,gamma..   
+0001be30: 203a 7265 7475 726e 3a20 666c 6f61 742c   :return: float,
+0001be40: 2064 2d73 7061 6369 6e67 2069 6e20 410d   d-spacing in A.
+0001be50: 0a20 2020 2022 2222 0d0a 2020 2020 7576  .    """..    uv
+0001be60: 203d 206c 6174 7061 7232 7576 286c 6174   = latpar2uv(lat
+0001be70: 7469 6365 5f70 6172 616d 6574 6572 732c  tice_parameters,
+0001be80: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+0001be90: 290d 0a20 2020 2075 7673 203d 2052 6353  )..    uvs = RcS
+0001bea0: 7028 7576 290d 0a20 2020 2072 6574 7572  p(uv)..    retur
+0001beb0: 6e20 686b 6c32 6473 7061 6365 2868 6b6c  n hkl2dspace(hkl
+0001bec0: 2c20 7576 7329 0d0a 0d0a 0d0a 6465 6620  , uvs)......def 
+0001bed0: 6c61 7474 6963 655f 686b 6c32 7477 6f74  lattice_hkl2twot
+0001bee0: 6865 7461 2868 6b6c 2c20 656e 6572 6779  heta(hkl, energy
+0001bef0: 5f6b 6576 3d31 372e 3739 342c 206c 6174  _kev=17.794, lat
+0001bf00: 7469 6365 5f70 6172 616d 6574 6572 733d  tice_parameters=
+0001bf10: 2829 2c20 2a61 7267 732c 202a 2a6b 7761  (), *args, **kwa
+0001bf20: 7267 7329 3a0d 0a20 2020 2022 2222 0d0a  rgs):..    """..
+0001bf30: 2020 2020 4361 6c63 7561 6c74 6520 6473      Calcualte ds
+0001bf40: 7061 6365 2066 726f 6d20 6c61 7474 6963  pace from lattic
+0001bf50: 6520 7061 7261 6d65 7465 7273 0d0a 2020  e parameters..  
+0001bf60: 2020 3a70 6172 616d 2068 6b6c 3a20 5b6e    :param hkl: [n
+0001bf70: 7833 5d20 6172 7261 7920 6f66 2072 6566  x3] array of ref
+0001bf80: 6c65 6374 696f 6e73 0d0a 2020 2020 3a70  lections..    :p
+0001bf90: 6172 616d 2065 6e65 7267 795f 6b65 763a  aram energy_kev:
+0001bfa0: 2066 6c6f 6174 2c20 7261 6469 6174 696f   float, radiatio
+0001bfb0: 6e20 656e 6572 6779 2069 6e20 6b65 560d  n energy in keV.
+0001bfc0: 0a20 2020 203a 7061 7261 6d20 6c61 7474  .    :param latt
+0001bfd0: 6963 655f 7061 7261 6d65 7465 7273 3a20  ice_parameters: 
+0001bfe0: 612c 622c 632c 616c 7068 612c 6265 7461  a,b,c,alpha,beta
+0001bff0: 2c67 616d 6d61 0d0a 2020 2020 3a72 6574  ,gamma..    :ret
+0001c000: 7572 6e3a 2066 6c6f 6174 2c20 642d 7370  urn: float, d-sp
+0001c010: 6163 696e 6720 696e 2041 0d0a 2020 2020  acing in A..    
+0001c020: 2222 220d 0a20 2020 2075 7620 3d20 6c61  """..    uv = la
+0001c030: 7470 6172 3275 7628 6c61 7474 6963 655f  tpar2uv(lattice_
+0001c040: 7061 7261 6d65 7465 7273 2c20 2a61 7267  parameters, *arg
+0001c050: 732c 202a 2a6b 7761 7267 7329 0d0a 2020  s, **kwargs)..  
+0001c060: 2020 7576 7320 3d20 5263 5370 2875 7629    uvs = RcSp(uv)
+0001c070: 0d0a 2020 2020 7265 7475 726e 2068 6b6c  ..    return hkl
+0001c080: 3274 776f 7468 6574 6128 686b 6c2c 2075  2twotheta(hkl, u
+0001c090: 7673 2c20 656e 6572 6779 5f6b 6576 290d  vs, energy_kev).
+0001c0a0: 0a0d 0a0d 0a64 6566 2063 616c 716d 6167  .....def calqmag
+0001c0b0: 2874 776f 7468 6574 612c 2065 6e65 7267  (twotheta, energ
+0001c0c0: 795f 6b65 763d 3137 2e37 3934 2c20 7761  y_kev=17.794, wa
+0001c0d0: 7665 6c65 6e67 7468 5f61 3d4e 6f6e 6529  velength_a=None)
+0001c0e0: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+0001c0f0: 4361 6c63 756c 6174 6520 7c51 7c20 6174  Calculate |Q| at
+0001c100: 2061 2070 6172 7469 6375 6c61 7220 322d   a particular 2-
+0001c110: 7468 6574 6120 2864 6567 2920 666f 7220  theta (deg) for 
+0001c120: 656e 6572 6779 2069 6e20 6b65 560d 0a20  energy in keV.. 
+0001c130: 2020 2020 6d61 6751 203d 2063 616c 716d      magQ = calqm
+0001c140: 6167 2874 776f 7468 6574 612c 2065 6e65  ag(twotheta, ene
+0001c150: 7267 795f 6b65 763d 3137 2e37 3934 290d  rgy_kev=17.794).
+0001c160: 0a20 2020 2022 2222 0d0a 2020 2020 6966  .    """..    if
+0001c170: 2077 6176 656c 656e 6774 685f 6120 6973   wavelength_a is
+0001c180: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0001c190: 7761 7665 6c65 6e67 7468 5f61 203d 2065  wavelength_a = e
+0001c1a0: 6e65 7267 7932 7761 7665 2865 6e65 7267  nergy2wave(energ
+0001c1b0: 795f 6b65 7629 2020 2320 7761 7665 6c65  y_kev)  # wavele
+0001c1c0: 6e67 7468 2066 6f72 6d20 7068 6f74 6f6e  ngth form photon
+0001c1d0: 2065 6e65 7267 790d 0a20 2020 2023 2065   energy..    # e
+0001c1e0: 6e65 7267 7920 3d20 656e 6572 6779 5f6b  nergy = energy_k
+0001c1f0: 6576 202a 2031 3030 302e 3020 2023 2065  ev * 1000.0  # e
+0001c200: 6e65 7267 7920 696e 2065 560d 0a20 2020  nergy in eV..   
+0001c210: 2074 6865 7461 203d 2074 776f 7468 6574   theta = twothet
+0001c220: 6120 2a20 6e70 2e70 6920 2f20 3336 3020  a * np.pi / 360 
+0001c230: 2023 2074 6865 7461 2069 6e20 7261 6469   # theta in radi
+0001c240: 616e 730d 0a20 2020 2023 2043 616c 6375  ans..    # Calcu
+0001c250: 6c61 7465 207c 517c 0d0a 2020 2020 2320  late |Q|..    # 
+0001c260: 6d61 6771 203d 2034 7069 2073 696e 2874  magq = 4pi sin(t
+0001c270: 6865 7461 2920 2f20 6c61 6d62 6461 0d0a  heta) / lambda..
+0001c280: 2020 2020 2320 6d61 6771 203d 206e 702e      # magq = np.
+0001c290: 7369 6e28 7468 6574 6129 202a 2065 6e65  sin(theta) * ene
+0001c2a0: 7267 7920 2a20 6667 2e65 202a 2034 202a  rgy * fg.e * 4 *
+0001c2b0: 206e 702e 7069 202f 2028 6667 2e68 202a   np.pi / (fg.h *
+0001c2c0: 2066 672e 6320 2a20 3165 3130 290d 0a20   fg.c * 1e10).. 
+0001c2d0: 2020 206d 6167 7120 3d20 6e70 2e73 696e     magq = np.sin
+0001c2e0: 2874 6865 7461 2920 2a20 3420 2a20 6e70  (theta) * 4 * np
+0001c2f0: 2e70 6920 2f20 7761 7665 6c65 6e67 7468  .pi / wavelength
+0001c300: 5f61 0d0a 2020 2020 7265 7475 726e 206d  _a..    return m
+0001c310: 6167 710d 0a0d 0a0d 0a64 6566 2063 616c  agq......def cal
+0001c320: 3274 6865 7461 2871 6d61 672c 2065 6e65  2theta(qmag, ene
+0001c330: 7267 795f 6b65 763d 3137 2e37 3934 2c20  rgy_kev=17.794, 
+0001c340: 7761 7665 6c65 6e67 7468 5f61 3d4e 6f6e  wavelength_a=Non
+0001c350: 6529 3a0d 0a20 2020 2022 2222 0d0a 2020  e):..    """..  
+0001c360: 2020 4361 6c63 756c 6174 6520 7468 6574    Calculate thet
+0001c370: 6120 6174 2070 6172 7469 6375 6c61 7220  a at particular 
+0001c380: 656e 6572 6779 2069 6e20 6b65 5620 6672  energy in keV fr
+0001c390: 6f6d 207c 517c 0d0a 2020 2020 2074 776f  om |Q|..     two
+0001c3a0: 7468 6574 6120 3d20 6361 6c32 7468 6574  theta = cal2thet
+0001c3b0: 6128 516d 6167 2c65 6e65 7267 795f 6b65  a(Qmag,energy_ke
+0001c3c0: 763d 3137 2e37 3934 290d 0a20 2020 2022  v=17.794)..    "
+0001c3d0: 2222 0d0a 2020 2020 6966 2077 6176 656c  ""..    if wavel
+0001c3e0: 656e 6774 685f 6120 6973 204e 6f6e 653a  ength_a is None:
+0001c3f0: 0d0a 2020 2020 2020 2020 7761 7665 6c65  ..        wavele
+0001c400: 6e67 7468 5f61 203d 2065 6e65 7267 7932  ngth_a = energy2
+0001c410: 7761 7665 2865 6e65 7267 795f 6b65 7629  wave(energy_kev)
+0001c420: 2020 2320 7761 7665 6c65 6e67 7468 2066    # wavelength f
+0001c430: 6f72 6d20 7068 6f74 6f6e 2065 6e65 7267  orm photon energ
+0001c440: 790d 0a20 2020 2023 2065 6e65 7267 7920  y..    # energy 
+0001c450: 3d20 656e 6572 6779 5f6b 6576 202a 2031  = energy_kev * 1
+0001c460: 3030 302e 3020 2023 2065 6e65 7267 7920  000.0  # energy 
+0001c470: 696e 2065 560d 0a20 2020 2023 2043 616c  in eV..    # Cal
+0001c480: 6375 6c61 7465 2032 7468 6574 6120 616e  culate 2theta an
+0001c490: 676c 6573 2066 6f72 2078 2d72 6179 730d  gles for x-rays.
+0001c4a0: 0a20 2020 2023 206c 616d 6264 6120 3d20  .    # lambda = 
+0001c4b0: 3264 2073 696e 2874 6865 7461 2920 3d20  2d sin(theta) = 
+0001c4c0: 3470 6920 7369 6e28 7468 6574 6129 202f  4pi sin(theta) /
+0001c4d0: 2071 6d61 670d 0a20 2020 2023 2074 6865   qmag..    # the
+0001c4e0: 7461 203d 2061 7263 7369 6e28 716d 6167  ta = arcsin(qmag
+0001c4f0: 202a 206c 616d 6264 6120 2f20 3470 6929   * lambda / 4pi)
+0001c500: 0d0a 2020 2020 2320 7477 6f74 6865 7461  ..    # twotheta
+0001c510: 203d 2032 202a 206e 702e 6172 6373 696e   = 2 * np.arcsin
+0001c520: 2871 6d61 6720 2a20 3165 3130 202a 2066  (qmag * 1e10 * f
+0001c530: 672e 6820 2a20 6667 2e63 202f 2028 656e  g.h * fg.c / (en
+0001c540: 6572 6779 202a 2066 672e 6520 2a20 3420  ergy * fg.e * 4 
+0001c550: 2a20 6e70 2e70 6929 290d 0a20 2020 2074  * np.pi))..    t
+0001c560: 776f 7468 6574 6120 3d20 3220 2a20 6e70  wotheta = 2 * np
+0001c570: 2e61 7263 7369 6e28 716d 6167 202a 2077  .arcsin(qmag * w
+0001c580: 6176 656c 656e 6774 685f 6120 2f20 2834  avelength_a / (4
+0001c590: 202a 206e 702e 7069 2929 0d0a 2020 2020   * np.pi))..    
+0001c5a0: 2320 7265 7475 726e 2078 3254 2069 6e20  # return x2T in 
+0001c5b0: 6465 6772 6565 730d 0a20 2020 2074 776f  degrees..    two
+0001c5c0: 7468 6574 6120 3d20 7477 6f74 6865 7461  theta = twotheta
+0001c5d0: 202a 2031 3830 202f 206e 702e 7069 0d0a   * 180 / np.pi..
+0001c5e0: 2020 2020 7265 7475 726e 2074 776f 7468      return twoth
+0001c5f0: 6574 610d 0a0d 0a0d 0a64 6566 2063 616c  eta......def cal
+0001c600: 6473 7061 6365 2874 776f 7468 6574 612c  dspace(twotheta,
+0001c610: 2065 6e65 7267 795f 6b65 763d 3137 2e37   energy_kev=17.7
+0001c620: 3934 2c20 7761 7665 6c65 6e67 7468 5f61  94, wavelength_a
+0001c630: 3d4e 6f6e 6529 3a0d 0a20 2020 2022 2222  =None):..    """
+0001c640: 0d0a 2020 2020 4361 6c63 756c 6174 6520  ..    Calculate 
+0001c650: 642d 7370 6163 696e 6720 6672 6f6d 2074  d-spacing from t
+0001c660: 776f 2d74 6865 7461 0d0a 2020 2020 2064  wo-theta..     d
+0001c670: 7370 6163 6520 3d20 6361 6c64 7370 6163  space = caldspac
+0001c680: 6528 7474 682c 2065 6e65 7267 795f 6b65  e(tth, energy_ke
+0001c690: 7629 0d0a 2020 2020 2222 220d 0a20 2020  v)..    """..   
+0001c6a0: 2071 6d61 6720 3d20 6361 6c71 6d61 6728   qmag = calqmag(
+0001c6b0: 7477 6f74 6865 7461 2c20 656e 6572 6779  twotheta, energy
+0001c6c0: 5f6b 6576 2c20 7761 7665 6c65 6e67 7468  _kev, wavelength
+0001c6d0: 5f61 290d 0a20 2020 2064 7370 6163 6520  _a)..    dspace 
+0001c6e0: 3d20 7132 6473 7061 6365 2871 6d61 6729  = q2dspace(qmag)
+0001c6f0: 0d0a 2020 2020 7265 7475 726e 2064 7370  ..    return dsp
+0001c700: 6163 650d 0a0d 0a0d 0a64 6566 2063 616c  ace......def cal
+0001c710: 6c61 7474 6963 6528 7477 6f74 6865 7461  lattice(twotheta
+0001c720: 2c20 656e 6572 6779 5f6b 6576 3d31 372e  , energy_kev=17.
+0001c730: 3739 342c 2068 6b6c 3d28 312c 2030 2c20  794, hkl=(1, 0, 
+0001c740: 3029 293a 0d0a 2020 2020 2222 220d 0a20  0)):..    """.. 
+0001c750: 2020 2043 616c 6375 6c61 7465 2063 7562     Calculate cub
+0001c760: 6963 206c 6174 7469 6365 2070 6172 616d  ic lattice param
+0001c770: 6574 6572 2c20 6120 6672 6f6d 2072 6566  eter, a from ref
+0001c780: 6c65 6374 696f 6e20 7477 6f2d 7468 6574  lection two-thet
+0001c790: 610d 0a20 2020 203a 7061 7261 6d20 7477  a..    :param tw
+0001c7a0: 6f74 6865 7461 3a20 4272 6167 6720 616e  otheta: Bragg an
+0001c7b0: 676c 652c 2064 6567 0d0a 2020 2020 3a70  gle, deg..    :p
+0001c7c0: 6172 616d 2065 6e65 7267 795f 6b65 763a  aram energy_kev:
+0001c7d0: 2065 6e65 7267 7920 696e 206b 6556 0d0a   energy in keV..
+0001c7e0: 2020 2020 3a70 6172 616d 2068 6b6c 3a20      :param hkl: 
+0001c7f0: 7265 666c 6563 7469 6f6e 2028 6375 6269  reflection (cubi
+0001c800: 6320 6f6e 6c79 0d0a 2020 2020 3a72 6574  c only..    :ret
+0001c810: 7572 6e3a 2066 6c6f 6174 2c20 6c61 7474  urn: float, latt
+0001c820: 6963 6520 636f 6e74 616e 740d 0a20 2020  ice contant..   
+0001c830: 2022 2222 0d0a 2020 2020 716d 6167 203d   """..    qmag =
+0001c840: 2063 616c 716d 6167 2874 776f 7468 6574   calqmag(twothet
+0001c850: 612c 2065 6e65 7267 795f 6b65 7629 0d0a  a, energy_kev)..
+0001c860: 2020 2020 6473 7061 6365 203d 2071 3264      dspace = q2d
+0001c870: 7370 6163 6528 716d 6167 290d 0a20 2020  space(qmag)..   
+0001c880: 2072 6574 7572 6e20 6473 7061 6365 202a   return dspace *
+0001c890: 206e 702e 7371 7274 286e 702e 7375 6d28   np.sqrt(np.sum(
+0001c8a0: 6e70 2e73 7175 6172 6528 686b 6c29 2929  np.square(hkl)))
+0001c8b0: 0d0a 0d0a 0d0a 6465 6620 7132 6473 7061  ......def q2dspa
+0001c8c0: 6365 2871 6d61 6729 3a0d 0a20 2020 2022  ce(qmag):..    "
+0001c8d0: 2222 0d0a 2020 2020 4361 6c63 756c 6174  ""..    Calculat
+0001c8e0: 6520 642d 7370 6163 696e 6720 6672 6f6d  e d-spacing from
+0001c8f0: 207c 517c 0d0a 2020 2020 2020 2020 2064   |Q|..         d
+0001c900: 7370 6163 6520 3d20 7132 6473 7061 6365  space = q2dspace
+0001c910: 2851 6d61 6729 0d0a 2020 2020 2222 220d  (Qmag)..    """.
+0001c920: 0a20 2020 2072 6574 7572 6e20 3220 2a20  .    return 2 * 
+0001c930: 6e70 2e70 6920 2f20 716d 6167 0d0a 0d0a  np.pi / qmag....
+0001c940: 0d0a 6465 6620 6473 7061 6365 3271 2864  ..def dspace2q(d
+0001c950: 7370 6163 6529 3a0d 0a20 2020 2022 2222  space):..    """
+0001c960: 0d0a 2020 2020 4361 6c63 756c 6174 6520  ..    Calculate 
+0001c970: 642d 7370 6163 696e 6720 6672 6f6d 207c  d-spacing from |
+0001c980: 517c 0d0a 2020 2020 2020 2020 2051 6d61  Q|..         Qma
+0001c990: 6720 3d20 7132 6473 7061 6365 2864 7370  g = q2dspace(dsp
+0001c9a0: 6163 6529 0d0a 2020 2020 2222 220d 0a20  ace)..    """.. 
+0001c9b0: 2020 2072 6574 7572 6e20 3220 2a20 6e70     return 2 * np
+0001c9c0: 2e70 6920 2f20 6473 7061 6365 0d0a 0d0a  .pi / dspace....
+0001c9d0: 0d0a 6465 6620 7132 756e 6974 7328 716d  ..def q2units(qm
+0001c9e0: 6167 2c20 756e 6974 733d 2774 7468 272c  ag, units='tth',
+0001c9f0: 2065 6e65 7267 795f 6b65 763d 4e6f 6e65   energy_kev=None
+0001ca00: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+0001ca10: 2043 6f6e 7665 7274 207c 517c 2069 6e20   Convert |Q| in 
+0001ca20: 415e 2d31 2074 6f20 6368 6f69 6365 206f  A^-1 to choice o
+0001ca30: 6620 756e 6974 730d 0a20 2020 203a 7061  f units..    :pa
+0001ca40: 7261 6d20 716d 6167 3a20 666c 6f61 7420  ram qmag: float 
+0001ca50: 6f72 2061 7272 6179 2069 6e20 696e 7665  or array in inve
+0001ca60: 7273 652d 416e 6773 7472 6f6d 0d0a 2020  rse-Angstrom..  
+0001ca70: 2020 3a70 6172 616d 2075 6e69 7473 3a20    :param units: 
+0001ca80: 7374 723a 2027 7474 6827 2c20 2764 7370  str: 'tth', 'dsp
+0001ca90: 6163 6527 2c20 2771 2720 2872 6169 7365  ace', 'q' (raise
+0001caa0: 7320 5661 6c75 6545 7272 6f72 2069 6620  s ValueError if 
+0001cab0: 7772 6f6e 6729 0d0a 2020 2020 3a70 6172  wrong)..    :par
+0001cac0: 616d 2065 6e65 7267 795f 6b65 763a 2066  am energy_kev: f
+0001cad0: 6c6f 6174 0d0a 2020 2020 3a72 6574 7572  loat..    :retur
+0001cae0: 6e3a 2066 6c6f 6174 206f 7220 6172 7261  n: float or arra
+0001caf0: 790d 0a20 2020 2022 2222 0d0a 2020 2020  y..    """..    
+0001cb00: 756e 6974 7320 3d20 756e 6974 732e 6c6f  units = units.lo
+0001cb10: 7765 7228 292e 7265 706c 6163 6528 2720  wer().replace(' 
+0001cb20: 272c 2027 2729 2e72 6570 6c61 6365 2827  ', '').replace('
+0001cb30: 2d27 2c20 2727 290d 0a20 2020 2069 6620  -', '')..    if 
+0001cb40: 2771 2720 696e 2075 6e69 7473 3a0d 0a20  'q' in units:.. 
+0001cb50: 2020 2020 2020 2072 6574 7572 6e20 716d         return qm
+0001cb60: 6167 0d0a 2020 2020 6966 2075 6e69 7473  ag..    if units
+0001cb70: 2069 6e20 5b27 6427 2c20 2764 7370 6163   in ['d', 'dspac
+0001cb80: 6527 2c20 2764 7370 6163 696e 6727 2c20  e', 'dspacing', 
+0001cb90: 2761 6e67 7374 726f 6d27 2c20 2741 275d  'angstrom', 'A']
+0001cba0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+0001cbb0: 6e20 7132 6473 7061 6365 2871 6d61 6729  n q2dspace(qmag)
+0001cbc0: 0d0a 2020 2020 6966 2075 6e69 7473 2069  ..    if units i
+0001cbd0: 6e20 5b27 7474 6827 2c20 2761 6e67 6c65  n ['tth', 'angle
+0001cbe0: 272c 2027 7477 6f74 6865 7461 272c 2027  ', 'twotheta', '
+0001cbf0: 7468 6574 6127 2c20 2764 6567 272c 2027  theta', 'deg', '
+0001cc00: 6465 6772 6565 7327 5d3a 0d0a 2020 2020  degrees']:..    
+0001cc10: 2020 2020 7265 7475 726e 2063 616c 3274      return cal2t
+0001cc20: 6865 7461 2871 6d61 672c 2065 6e65 7267  heta(qmag, energ
+0001cc30: 795f 6b65 7629 0d0a 2020 2020 7261 6973  y_kev)..    rais
+0001cc40: 6520 5661 6c75 6545 7272 6f72 2827 2573  e ValueError('%s
+0001cc50: 2069 7320 6e6f 7420 6120 7661 6c69 6420   is not a valid 
+0001cc60: 756e 6974 2720 2520 756e 6974 7329 0d0a  unit' % units)..
+0001cc70: 0d0a 0d0a 6465 6620 7265 736f 6c75 7469  ....def resoluti
+0001cc80: 6f6e 3265 6e65 7267 7928 7265 732c 2074  on2energy(res, t
+0001cc90: 776f 7468 6574 613d 3138 302e 293a 0d0a  wotheta=180.):..
+0001cca0: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
+0001ccb0: 6375 616c 7465 2074 6865 2065 6e65 7267  cualte the energ
+0001ccc0: 7920 7265 7175 6972 6564 2074 6f20 6163  y required to ac
+0001ccd0: 6869 6576 6520 6120 7370 6563 6966 6963  hieve a specific
+0001cce0: 2072 6573 6f6c 7574 696f 6e20 6174 2061   resolution at a
+0001ccf0: 2067 6976 656e 2074 776f 2d74 6865 7461   given two-theta
+0001cd00: 0d0a 2020 2020 3a70 6172 616d 2072 6573  ..    :param res
+0001cd10: 3a20 6d65 6173 7572 656d 656e 7420 7265  : measurement re
+0001cd20: 736f 6c75 7469 6f6e 2069 6e20 4120 283d  solution in A (=
+0001cd30: 3d64 2d73 7061 6369 6e67 290d 0a20 2020  =d-spacing)..   
+0001cd40: 203a 7061 7261 6d20 7477 6f74 6865 7461   :param twotheta
+0001cd50: 3a20 4272 6167 6720 616e 676c 6520 696e  : Bragg angle in
+0001cd60: 2044 6567 7265 6573 0d0a 2020 2020 3a72   Degrees..    :r
+0001cd70: 6574 7572 6e3a 2066 6c6f 6174 0d0a 2020  eturn: float..  
+0001cd80: 2020 2222 220d 0a20 2020 2074 6865 7461    """..    theta
+0001cd90: 203d 2074 776f 7468 6574 6120 2a20 6e70   = twotheta * np
+0001cda0: 2e70 6920 2f20 3336 3020 2023 2074 6865  .pi / 360  # the
+0001cdb0: 7461 2069 6e20 7261 6469 616e 730d 0a20  ta in radians.. 
+0001cdc0: 2020 2072 6574 7572 6e20 2866 672e 6820     return (fg.h 
+0001cdd0: 2a20 6667 2e63 202a 2031 6531 3029 202f  * fg.c * 1e10) /
+0001cde0: 2028 7265 7320 2a20 6e70 2e73 696e 2874   (res * np.sin(t
+0001cdf0: 6865 7461 2920 2a20 6667 2e65 202a 2032  heta) * fg.e * 2
+0001ce00: 202a 2031 3030 302e 290d 0a0d 0a0d 0a64   * 1000.)......d
+0001ce10: 6566 2077 6176 6532 656e 6572 6779 2877  ef wave2energy(w
+0001ce20: 6176 656c 656e 6774 6829 3a0d 0a20 2020  avelength):..   
+0001ce30: 2022 2222 0d0a 2020 2020 436f 6e76 6572   """..    Conver
+0001ce40: 7473 2077 6176 656c 656e 6774 6820 696e  ts wavelength in
+0001ce50: 2041 2074 6f20 656e 6572 6779 2069 6e20   A to energy in 
+0001ce60: 6b65 560d 0a20 2020 2020 456e 6572 6779  keV..     Energy
+0001ce70: 203d 2077 6176 6532 656e 6572 6779 2877   = wave2energy(w
+0001ce80: 6176 656c 656e 6774 6829 0d0a 2020 2020  avelength)..    
+0001ce90: 2222 220d 0a0d 0a20 2020 2023 2053 493a  """....    # SI:
+0001cea0: 2045 203d 2068 632f 6c61 6d62 6461 0d0a   E = hc/lambda..
+0001ceb0: 2020 2020 6c61 6d20 3d20 7761 7665 6c65      lam = wavele
+0001cec0: 6e67 7468 202a 2066 672e 410d 0a20 2020  ngth * fg.A..   
+0001ced0: 2045 203d 2066 672e 6820 2a20 6667 2e63   E = fg.h * fg.c
+0001cee0: 202f 206c 616d 0d0a 0d0a 2020 2020 2320   / lam....    # 
+0001cef0: 456c 6563 7472 6f6e 2056 6f6c 7473 3a0d  Electron Volts:.
+0001cf00: 0a20 2020 2045 6e65 7267 7920 3d20 4520  .    Energy = E 
+0001cf10: 2f20 6667 2e65 0d0a 2020 2020 7265 7475  / fg.e..    retu
+0001cf20: 726e 2045 6e65 7267 7920 2f20 3130 3030  rn Energy / 1000
+0001cf30: 2e30 0d0a 0d0a 0d0a 6465 6620 656e 6572  .0......def ener
+0001cf40: 6779 3277 6176 6528 656e 6572 6779 5f6b  gy2wave(energy_k
+0001cf50: 6576 293a 0d0a 2020 2020 2222 220d 0a20  ev):..    """.. 
+0001cf60: 2020 2043 6f6e 7665 7274 7320 656e 6572     Converts ener
+0001cf70: 6779 2069 6e20 6b65 5620 746f 2077 6176  gy in keV to wav
+0001cf80: 656c 656e 6774 6820 696e 2041 0d0a 2020  elength in A..  
+0001cf90: 2020 2077 6176 656c 656e 6774 6820 3d20     wavelength = 
+0001cfa0: 656e 6572 6779 3277 6176 6528 656e 6572  energy2wave(ener
+0001cfb0: 6779 290d 0a20 2020 2022 2222 0d0a 0d0a  gy)..    """....
+0001cfc0: 2020 2020 2320 456c 6563 7472 6f6e 2056      # Electron V
+0001cfd0: 6f6c 7473 3a0d 0a20 2020 2045 203d 2031  olts:..    E = 1
+0001cfe0: 3030 3020 2a20 656e 6572 6779 5f6b 6576  000 * energy_kev
+0001cff0: 202a 2066 672e 650d 0a0d 0a20 2020 2023   * fg.e....    #
+0001d000: 2053 493a 2045 203d 2068 632f 6c61 6d62   SI: E = hc/lamb
+0001d010: 6461 0d0a 2020 2020 6c61 6d20 3d20 6667  da..    lam = fg
+0001d020: 2e68 202a 2066 672e 6320 2f20 450d 0a20  .h * fg.c / E.. 
+0001d030: 2020 2077 6176 656c 656e 6774 6820 3d20     wavelength = 
+0001d040: 6c61 6d20 2f20 6667 2e41 0d0a 2020 2020  lam / fg.A..    
+0001d050: 7265 7475 726e 2077 6176 656c 656e 6774  return wavelengt
+0001d060: 680d 0a0d 0a0d 0a64 6566 2077 6176 6576  h......def wavev
+0001d070: 6563 746f 7228 656e 6572 6779 5f6b 6576  ector(energy_kev
+0001d080: 3d4e 6f6e 652c 2077 6176 656c 656e 6774  =None, wavelengt
+0001d090: 683d 4e6f 6e65 293a 0d0a 2020 2020 2222  h=None):..    ""
+0001d0a0: 2252 6574 7572 6e20 7761 7665 7665 6374  "Return wavevect
+0001d0b0: 6f72 203d 2032 7069 2f6c 616d 6264 6122  or = 2pi/lambda"
+0001d0c0: 2222 0d0a 2020 2020 6966 2077 6176 656c  ""..    if wavel
+0001d0d0: 656e 6774 6820 6973 204e 6f6e 653a 0d0a  ength is None:..
+0001d0e0: 2020 2020 2020 2020 7761 7665 6c65 6e67          waveleng
+0001d0f0: 7468 203d 2065 6e65 7267 7932 7761 7665  th = energy2wave
+0001d100: 2865 6e65 7267 795f 6b65 7629 0d0a 2020  (energy_kev)..  
+0001d110: 2020 7265 7475 726e 2032 202a 206e 702e    return 2 * np.
+0001d120: 7069 202f 2077 6176 656c 656e 6774 680d  pi / wavelength.
+0001d130: 0a0d 0a0d 0a64 6566 206e 6575 7472 6f6e  .....def neutron
+0001d140: 5f77 6176 656c 656e 6774 6828 656e 6572  _wavelength(ener
+0001d150: 6779 5f6d 6576 293a 0d0a 2020 2020 2222  gy_mev):..    ""
+0001d160: 220d 0a20 2020 2043 616c 6375 616c 7465  "..    Calcualte
+0001d170: 2074 6865 206e 6575 7472 6f6e 2077 6176   the neutron wav
+0001d180: 656c 656e 6774 6820 696e 2041 6e67 7374  elength in Angst
+0001d190: 726f 6d73 2075 7369 6e67 2044 6542 726f  roms using DeBro
+0001d1a0: 676c 6965 2773 2066 6f72 6d75 6c61 0d0a  glie's formula..
+0001d1b0: 2020 2020 2020 6c61 6d62 6461 205b 415d        lambda [A]
+0001d1c0: 207e 2073 7172 7428 2038 312e 3832 202f   ~ sqrt( 81.82 /
+0001d1d0: 2045 205b 6d65 565d 2029 0d0a 2020 2020   E [meV] )..    
+0001d1e0: 3a70 6172 616d 2065 6e65 7267 795f 6d65  :param energy_me
+0001d1f0: 763a 206e 6575 7472 6f6e 2065 6e65 7267  v: neutron energ
+0001d200: 7920 696e 206d 6556 0d0a 2020 2020 3a72  y in meV..    :r
+0001d210: 6574 7572 6e3a 2077 6176 656c 656e 6774  eturn: wavelengt
+0001d220: 6820 696e 2041 6e73 7472 6f6d 730d 0a20  h in Anstroms.. 
+0001d230: 2020 2022 2222 0d0a 2020 2020 7265 7475     """..    retu
+0001d240: 726e 2066 672e 6820 2f20 6e70 2e73 7172  rn fg.h / np.sqr
+0001d250: 7428 3220 2a20 6667 2e6d 6e20 2a20 656e  t(2 * fg.mn * en
+0001d260: 6572 6779 5f6d 6576 202a 2066 672e 6520  ergy_mev * fg.e 
+0001d270: 2f20 3130 3030 2920 2f20 6667 2e41 0d0a  / 1000) / fg.A..
+0001d280: 0d0a 0d0a 6465 6620 6e65 7574 726f 6e5f  ....def neutron_
+0001d290: 656e 6572 6779 2877 6176 656c 656e 6774  energy(wavelengt
+0001d2a0: 685f 6129 3a0d 0a20 2020 2022 2222 0d0a  h_a):..    """..
+0001d2b0: 2020 2020 4361 6c63 7561 6c74 6520 7468      Calcualte th
+0001d2c0: 6520 6e65 7574 726f 6e20 656e 6572 6779  e neutron energy
+0001d2d0: 2069 6e20 6d69 6c6c 692d 656c 6563 7472   in milli-electr
+0001d2e0: 6f6e 766f 6c74 7320 7573 696e 6720 4465  onvolts using De
+0001d2f0: 4272 6f67 6c69 6527 7320 666f 726d 756c  Broglie's formul
+0001d300: 610d 0a20 2020 2020 2045 205b 6d65 565d  a..      E [meV]
+0001d310: 207e 2038 312e 3832 202f 206c 616d 6264   ~ 81.82 / lambd
+0001d320: 615e 3220 5b41 5d0d 0a20 2020 203a 7061  a^2 [A]..    :pa
+0001d330: 7261 6d20 7761 7665 6c65 6e67 7468 5f61  ram wavelength_a
+0001d340: 3a20 6e65 7574 726f 6e20 7761 7665 6c65  : neutron wavele
+0001d350: 6e67 7468 2069 6e20 416e 6773 7472 6f6d  ngth in Angstrom
+0001d360: 730d 0a20 2020 203a 7265 7475 726e 3a20  s..    :return: 
+0001d370: 656e 6572 6779 2069 6e20 6d65 560d 0a20  energy in meV.. 
+0001d380: 2020 2022 2222 0d0a 2020 2020 7265 7475     """..    retu
+0001d390: 726e 2066 672e 682a 2a32 202f 2028 3220  rn fg.h**2 / (2 
+0001d3a0: 2a20 6667 2e6d 6e20 2a20 2877 6176 656c  * fg.mn * (wavel
+0001d3b0: 656e 6774 685f 612a 6667 2e41 292a 2a32  ength_a*fg.A)**2
+0001d3c0: 202a 2066 672e 6520 2f20 3130 3030 290d   * fg.e / 1000).
+0001d3d0: 0a0d 0a0d 0a64 6566 2065 6c65 6374 726f  .....def electro
+0001d3e0: 6e5f 7761 7665 6c65 6e67 7468 2865 6e65  n_wavelength(ene
+0001d3f0: 7267 795f 6576 293a 0d0a 2020 2020 2222  rgy_ev):..    ""
+0001d400: 220d 0a20 2020 2043 616c 6375 616c 7465  "..    Calcualte
+0001d410: 2074 6865 2065 6c65 6374 726f 6e20 7761   the electron wa
+0001d420: 7665 6c65 6e67 7468 2069 6e20 416e 6773  velength in Angs
+0001d430: 7472 6f6d 7320 7573 696e 6720 4465 4272  troms using DeBr
+0001d440: 6f67 6c69 6527 7320 666f 726d 756c 610d  oglie's formula.
+0001d450: 0a20 2020 2020 206c 616d 6264 6120 5b6e  .      lambda [n
+0001d460: 6d5d 207e 2073 7172 7428 2031 2e35 202f  m] ~ sqrt( 1.5 /
+0001d470: 2045 205b 6556 5d20 290d 0a20 2020 203a   E [eV] )..    :
+0001d480: 7061 7261 6d20 656e 6572 6779 5f65 763a  param energy_ev:
+0001d490: 2065 6c65 6374 726f 6e20 656e 6572 6779   electron energy
+0001d4a0: 2069 6e20 6556 0d0a 2020 2020 3a72 6574   in eV..    :ret
+0001d4b0: 7572 6e3a 2077 6176 656c 656e 6774 6820  urn: wavelength 
+0001d4c0: 696e 2041 6e73 7472 6f6d 730d 0a20 2020  in Anstroms..   
+0001d4d0: 2022 2222 0d0a 2020 2020 7265 7475 726e   """..    return
+0001d4e0: 2066 672e 6820 2f20 6e70 2e73 7172 7428   fg.h / np.sqrt(
+0001d4f0: 3220 2a20 6667 2e6d 6520 2a20 656e 6572  2 * fg.me * ener
+0001d500: 6779 5f65 7620 2a20 6667 2e65 2920 2f20  gy_ev * fg.e) / 
+0001d510: 6667 2e41 0d0a 0d0a 0d0a 6465 6620 656c  fg.A......def el
+0001d520: 6563 7472 6f6e 5f65 6e65 7267 7928 7761  ectron_energy(wa
+0001d530: 7665 6c65 6e67 7468 5f61 293a 0d0a 2020  velength_a):..  
+0001d540: 2020 2222 220d 0a20 2020 2043 616c 6375    """..    Calcu
+0001d550: 616c 7465 2074 6865 2065 6c65 6374 726f  alte the electro
+0001d560: 6e20 656e 6572 6779 2069 6e20 656c 6563  n energy in elec
+0001d570: 7472 6f6e 766f 6c74 7320 7573 696e 6720  tronvolts using 
+0001d580: 4465 4272 6f67 6c69 6527 7320 666f 726d  DeBroglie's form
+0001d590: 756c 610d 0a20 2020 2020 2045 205b 6556  ula..      E [eV
+0001d5a0: 5d20 7e20 312e 3520 2f20 6c61 6d62 6461  ] ~ 1.5 / lambda
+0001d5b0: 5e32 205b 6e6d 5d0d 0a20 2020 203a 7061  ^2 [nm]..    :pa
+0001d5c0: 7261 6d20 7761 7665 6c65 6e67 7468 5f61  ram wavelength_a
+0001d5d0: 3a20 656c 6563 7472 6f6e 2077 6176 656c  : electron wavel
+0001d5e0: 656e 6774 6820 696e 2041 6e67 7374 726f  ength in Angstro
+0001d5f0: 6d73 0d0a 2020 2020 3a72 6574 7572 6e3a  ms..    :return:
+0001d600: 2065 6e65 7267 7920 696e 2065 560d 0a20   energy in eV.. 
+0001d610: 2020 2022 2222 0d0a 2020 2020 7265 7475     """..    retu
+0001d620: 726e 2066 672e 682a 2a32 202f 2028 3220  rn fg.h**2 / (2 
+0001d630: 2a20 6667 2e6d 6520 2a20 2877 6176 656c  * fg.me * (wavel
+0001d640: 656e 6774 685f 6120 2a20 6667 2e41 292a  ength_a * fg.A)*
+0001d650: 2a32 202a 2066 672e 6529 0d0a 0d0a 0d0a  *2 * fg.e)......
+0001d660: 6465 6620 6465 6272 6f67 6c69 655f 7761  def debroglie_wa
+0001d670: 7665 6c65 6e67 7468 2865 6e65 7267 795f  velength(energy_
+0001d680: 6b65 762c 206d 6173 735f 6b67 293a 0d0a  kev, mass_kg):..
+0001d690: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
+0001d6a0: 6375 616c 7465 2074 6865 2077 6176 656c  cualte the wavel
+0001d6b0: 656e 6774 6820 696e 2041 6e67 7374 726f  ength in Angstro
+0001d6c0: 6d73 2075 7369 6e67 2044 6542 726f 676c  ms using DeBrogl
+0001d6d0: 6965 2773 2066 6f72 6d75 6c61 0d0a 2020  ie's formula..  
+0001d6e0: 2020 2020 6c61 6d62 6461 205b 415d 203d      lambda [A] =
+0001d6f0: 2068 2020 2f20 7371 7274 2820 3220 2a20   h  / sqrt( 2 * 
+0001d700: 6d61 7373 205b 6b67 5d20 2a20 4520 5b6b  mass [kg] * E [k
+0001d710: 6556 5d20 2a20 3165 3320 2a20 6520 290d  eV] * 1e3 * e ).
+0001d720: 0a20 2020 203a 7061 7261 6d20 656e 6572  .    :param ener
+0001d730: 6779 5f6b 6576 3a20 656e 6572 6779 2069  gy_kev: energy i
+0001d740: 6e20 6b65 560d 0a20 2020 203a 7061 7261  n keV..    :para
+0001d750: 6d20 6d61 7373 5f6b 673a 206d 6173 7320  m mass_kg: mass 
+0001d760: 696e 206b 670d 0a20 2020 203a 7265 7475  in kg..    :retu
+0001d770: 726e 3a20 7761 7665 6c65 6e67 7468 2069  rn: wavelength i
+0001d780: 6e20 416e 7374 726f 6d73 0d0a 2020 2020  n Anstroms..    
+0001d790: 2222 220d 0a20 2020 2072 6574 7572 6e20  """..    return 
+0001d7a0: 6667 2e68 202f 2028 6e70 2e73 7172 7428  fg.h / (np.sqrt(
+0001d7b0: 3220 2a20 6d61 7373 5f6b 6720 2a20 656e  2 * mass_kg * en
+0001d7c0: 6572 6779 5f6b 6576 202a 2031 3030 3020  ergy_kev * 1000 
+0001d7d0: 2a20 6667 2e65 2920 2a20 6667 2e41 290d  * fg.e) * fg.A).
+0001d7e0: 0a0d 0a0d 0a64 6566 2064 6562 726f 676c  .....def debrogl
+0001d7f0: 6965 5f65 6e65 7267 7928 7761 7665 6c65  ie_energy(wavele
+0001d800: 6e67 7468 5f61 2c20 6d61 7373 5f6b 6729  ngth_a, mass_kg)
+0001d810: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+0001d820: 4361 6c63 7561 6c74 6520 7468 6520 656e  Calcualte the en
+0001d830: 6572 6779 2069 6e20 656c 6563 7472 6f6e  ergy in electron
+0001d840: 766f 6c74 7320 7573 696e 6720 4465 4272  volts using DeBr
+0001d850: 6f67 6c69 6527 7320 666f 726d 756c 610d  oglie's formula.
+0001d860: 0a20 2020 2020 2045 205b 6b65 565d 203d  .      E [keV] =
+0001d870: 2068 5e32 202f 2028 3220 2a20 6520 2a20   h^2 / (2 * e * 
+0001d880: 6d61 7373 205b 6b67 5d20 2a20 415e 3220  mass [kg] * A^2 
+0001d890: 2a20 6c61 6d62 6461 5e32 205b 415d 202a  * lambda^2 [A] *
+0001d8a0: 2031 6533 290d 0a20 2020 203a 7061 7261   1e3)..    :para
+0001d8b0: 6d20 7761 7665 6c65 6e67 7468 5f61 3a20  m wavelength_a: 
+0001d8c0: 7761 7665 6c65 6e67 7468 2069 6e20 416e  wavelength in An
+0001d8d0: 6773 7472 6f6d 730d 0a20 2020 203a 7061  gstroms..    :pa
+0001d8e0: 7261 6d20 6d61 7373 5f6b 673a 206d 6173  ram mass_kg: mas
+0001d8f0: 7320 696e 206b 670d 0a20 2020 203a 7265  s in kg..    :re
+0001d900: 7475 726e 3a20 656e 6572 6779 2069 6e20  turn: energy in 
+0001d910: 6b65 560d 0a20 2020 2022 2222 0d0a 2020  keV..    """..  
+0001d920: 2020 7265 7475 726e 2066 672e 6820 2a2a    return fg.h **
+0001d930: 2032 202f 2028 3220 2a20 6d61 7373 5f6b   2 / (2 * mass_k
+0001d940: 6720 2a20 2877 6176 656c 656e 6774 685f  g * (wavelength_
+0001d950: 6120 2a20 6667 2e41 2920 2a2a 2032 202a  a * fg.A) ** 2 *
+0001d960: 2066 672e 6520 2a20 3165 3329 0d0a 0d0a   fg.e * 1e3)....
+0001d970: 0d0a 6465 6620 7363 6865 7272 6572 5f73  ..def scherrer_s
+0001d980: 697a 6528 6677 686d 2c20 7477 6f74 6865  ize(fwhm, twothe
+0001d990: 7461 2c20 7761 7665 6c65 6e67 7468 5f61  ta, wavelength_a
+0001d9a0: 3d4e 6f6e 652c 2065 6e65 7267 795f 6b65  =None, energy_ke
+0001d9b0: 763d 4e6f 6e65 2c20 7368 6170 655f 6661  v=None, shape_fa
+0001d9c0: 6374 6f72 3d30 2e39 293a 0d0a 2020 2020  ctor=0.9):..    
+0001d9d0: 2222 220d 0a20 2020 2055 7365 2074 6865  """..    Use the
+0001d9e0: 2053 6368 6572 7265 7220 6571 7561 7469   Scherrer equati
+0001d9f0: 6f6e 2074 6f20 6361 6c63 756c 6174 6520  on to calculate 
+0001da00: 7468 6520 7369 7a65 206f 6620 6120 6372  the size of a cr
+0001da10: 7973 7461 6c6c 6974 6520 6672 6f6d 2061  ystallite from a
+0001da20: 2070 6561 6b20 7769 6474 680d 0a20 2020   peak width..   
+0001da30: 2020 204c 203d 204b 202a 206c 616d 6264     L = K * lambd
+0001da40: 6120 2f20 6677 686d 202a 2063 6f73 2874  a / fwhm * cos(t
+0001da50: 6865 7461 290d 0a20 2020 2053 6565 3a20  heta)..    See: 
+0001da60: 6874 7470 733a 2f2f 656e 2e77 696b 6970  https://en.wikip
+0001da70: 6564 6961 2e6f 7267 2f77 696b 692f 5363  edia.org/wiki/Sc
+0001da80: 6865 7272 6572 5f65 7175 6174 696f 6e0d  herrer_equation.
+0001da90: 0a20 2020 203a 7061 7261 6d20 6677 686d  .    :param fwhm
+0001daa0: 3a20 6675 6c6c 2d77 6964 7468 2d68 616c  : full-width-hal
+0001dab0: 662d 6d61 7869 6d75 6d20 6f66 2061 2070  f-maximum of a p
+0001dac0: 6561 6b2c 2069 6e20 6465 6772 6565 730d  eak, in degrees.
+0001dad0: 0a20 2020 203a 7061 7261 6d20 7477 6f74  .    :param twot
+0001dae0: 6865 7461 3a20 322a 4272 6167 6720 616e  heta: 2*Bragg an
+0001daf0: 676c 652c 2069 6e20 6465 6772 6565 730d  gle, in degrees.
+0001db00: 0a20 2020 203a 7061 7261 6d20 7761 7665  .    :param wave
+0001db10: 6c65 6e67 7468 5f61 3a20 696e 6369 6465  length_a: incide
+0001db20: 6e74 2062 6561 6d20 7761 7665 6c65 6e67  nt beam waveleng
+0001db30: 7468 2c20 696e 2041 6e67 7374 726f 6d73  th, in Angstroms
+0001db40: 0d0a 2020 2020 3a70 6172 616d 2065 6e65  ..    :param ene
+0001db50: 7267 795f 6b65 763a 206f 722c 2069 6e63  rgy_kev: or, inc
+0001db60: 6964 656e 7420 6265 616d 2065 6e65 7267  ident beam energ
+0001db70: 792c 2069 6e20 6b65 560d 0a20 2020 203a  y, in keV..    :
+0001db80: 7061 7261 6d20 7368 6170 655f 6661 6374  param shape_fact
+0001db90: 6f72 3a20 6469 6d65 6e73 696f 6e6c 6573  or: dimensionles
+0001dba0: 7320 7368 6170 6520 6661 6374 6f72 2c20  s shape factor, 
+0001dbb0: 6465 7065 6e64 656e 7420 6f6e 2073 6861  dependent on sha
+0001dbc0: 7065 206f 6620 6372 7973 7461 6c6c 6974  pe of crystallit
+0001dbd0: 650d 0a20 2020 203a 7265 7475 726e 3a20  e..    :return: 
+0001dbe0: 666c 6f61 742c 2063 7279 7374 616c 6c69  float, crystalli
+0001dbf0: 7465 2064 6f6d 6169 6e20 7369 7a65 2069  te domain size i
+0001dc00: 6e20 416e 6773 7472 6f6d 730d 0a20 2020  n Angstroms..   
+0001dc10: 2022 2222 0d0a 2020 2020 6966 2077 6176   """..    if wav
+0001dc20: 656c 656e 6774 685f 6120 6973 204e 6f6e  elength_a is Non
+0001dc30: 653a 0d0a 2020 2020 2020 2020 7761 7665  e:..        wave
+0001dc40: 6c65 6e67 7468 5f61 203d 2065 6e65 7267  length_a = energ
+0001dc50: 7932 7761 7665 2865 6e65 7267 795f 6b65  y2wave(energy_ke
+0001dc60: 7629 0d0a 2020 2020 6465 6c74 615f 7468  v)..    delta_th
+0001dc70: 6574 6120 3d20 6e70 2e64 6567 3272 6164  eta = np.deg2rad
+0001dc80: 2866 7768 6d29 0d0a 2020 2020 636f 7374  (fwhm)..    cost
+0001dc90: 6865 7461 203d 206e 702e 636f 7328 6e70  heta = np.cos(np
+0001dca0: 2e64 6567 3272 6164 2874 776f 7468 6574  .deg2rad(twothet
+0001dcb0: 6120 2f20 322e 2929 0d0a 2020 2020 7265  a / 2.))..    re
+0001dcc0: 7475 726e 2073 6861 7065 5f66 6163 746f  turn shape_facto
+0001dcd0: 7220 2a20 7761 7665 6c65 6e67 7468 5f61  r * wavelength_a
+0001dce0: 202f 2028 6465 6c74 615f 7468 6574 6120   / (delta_theta 
+0001dcf0: 2a20 636f 7374 6865 7461 290d 0a0d 0a0d  * costheta).....
+0001dd00: 0a64 6566 2073 6368 6572 7265 725f 6677  .def scherrer_fw
+0001dd10: 686d 2873 697a 652c 2074 776f 7468 6574  hm(size, twothet
+0001dd20: 612c 2077 6176 656c 656e 6774 685f 613d  a, wavelength_a=
+0001dd30: 4e6f 6e65 2c20 656e 6572 6779 5f6b 6576  None, energy_kev
+0001dd40: 3d4e 6f6e 652c 2073 6861 7065 5f66 6163  =None, shape_fac
+0001dd50: 746f 723d 302e 3929 3a0d 0a20 2020 2022  tor=0.9):..    "
+0001dd60: 2222 0d0a 2020 2020 5573 6520 7468 6520  ""..    Use the 
+0001dd70: 5363 6865 7272 6572 2065 7175 6174 696f  Scherrer equatio
+0001dd80: 6e20 746f 2063 616c 6375 6c61 7465 2074  n to calculate t
+0001dd90: 6865 2073 697a 6520 6f66 2061 2063 7279  he size of a cry
+0001dda0: 7374 616c 6c69 7465 2066 726f 6d20 6120  stallite from a 
+0001ddb0: 7065 616b 2077 6964 7468 0d0a 2020 2020  peak width..    
+0001ddc0: 2020 4c20 3d20 4b20 2a20 6c61 6d62 6461    L = K * lambda
+0001ddd0: 202f 2066 7768 6d20 2a20 636f 7328 7468   / fwhm * cos(th
+0001dde0: 6574 6129 0d0a 2020 2020 5365 653a 2068  eta)..    See: h
+0001ddf0: 7474 7073 3a2f 2f65 6e2e 7769 6b69 7065  ttps://en.wikipe
+0001de00: 6469 612e 6f72 672f 7769 6b69 2f53 6368  dia.org/wiki/Sch
+0001de10: 6572 7265 725f 6571 7561 7469 6f6e 0d0a  errer_equation..
+0001de20: 2020 2020 3a70 6172 616d 2073 697a 653a      :param size:
+0001de30: 2063 7279 7374 616c 6c69 7465 2064 6f6d   crystallite dom
+0001de40: 6169 6e20 7369 7a65 2069 6e20 416e 6773  ain size in Angs
+0001de50: 7472 6f6d 730d 0a20 2020 203a 7061 7261  troms..    :para
+0001de60: 6d20 7477 6f74 6865 7461 3a20 322a 4272  m twotheta: 2*Br
+0001de70: 6167 6720 616e 676c 652c 2069 6e20 6465  agg angle, in de
+0001de80: 6772 6565 730d 0a20 2020 203a 7061 7261  grees..    :para
+0001de90: 6d20 7761 7665 6c65 6e67 7468 5f61 3a20  m wavelength_a: 
+0001dea0: 696e 6369 6465 6e74 2062 6561 6d20 7761  incident beam wa
+0001deb0: 7665 6c65 6e67 7468 2c20 696e 2041 6e67  velength, in Ang
+0001dec0: 7374 726f 6d73 0d0a 2020 2020 3a70 6172  stroms..    :par
+0001ded0: 616d 2065 6e65 7267 795f 6b65 763a 206f  am energy_kev: o
+0001dee0: 722c 2069 6e63 6964 656e 7420 6265 616d  r, incident beam
+0001def0: 2065 6e65 7267 792c 2069 6e20 6b65 560d   energy, in keV.
+0001df00: 0a20 2020 203a 7061 7261 6d20 7368 6170  .    :param shap
+0001df10: 655f 6661 6374 6f72 3a20 6469 6d65 6e73  e_factor: dimens
+0001df20: 696f 6e6c 6573 7320 7368 6170 6520 6661  ionless shape fa
+0001df30: 6374 6f72 2c20 6465 7065 6e64 656e 7420  ctor, dependent 
+0001df40: 6f6e 2073 6861 7065 206f 6620 6372 7973  on shape of crys
+0001df50: 7461 6c6c 6974 650d 0a20 2020 203a 7265  tallite..    :re
+0001df60: 7475 726e 3a20 666c 6f61 742c 2070 6561  turn: float, pea
+0001df70: 6b20 6675 6c6c 2d77 6964 7468 2d61 742d  k full-width-at-
+0001df80: 6861 6c66 2d6d 6178 2069 6e20 6465 6772  half-max in degr
+0001df90: 6565 730d 0a20 2020 2022 2222 0d0a 2020  ees..    """..  
+0001dfa0: 2020 6966 2077 6176 656c 656e 6774 685f    if wavelength_
+0001dfb0: 6120 6973 204e 6f6e 653a 0d0a 2020 2020  a is None:..    
+0001dfc0: 2020 2020 7761 7665 6c65 6e67 7468 5f61      wavelength_a
+0001dfd0: 203d 2065 6e65 7267 7932 7761 7665 2865   = energy2wave(e
+0001dfe0: 6e65 7267 795f 6b65 7629 0d0a 2020 2020  nergy_kev)..    
+0001dff0: 636f 7374 6865 7461 203d 206e 702e 636f  costheta = np.co
+0001e000: 7328 6e70 2e64 6567 3272 6164 2874 776f  s(np.deg2rad(two
+0001e010: 7468 6574 6120 2f20 322e 2929 0d0a 2020  theta / 2.))..  
+0001e020: 2020 7265 7475 726e 206e 702e 7261 6432    return np.rad2
+0001e030: 6465 6728 7368 6170 655f 6661 6374 6f72  deg(shape_factor
+0001e040: 202a 2077 6176 656c 656e 6774 685f 6120   * wavelength_a 
+0001e050: 2f20 2873 697a 6520 2a20 636f 7374 6865  / (size * costhe
+0001e060: 7461 2929 0d0a 0d0a 0d0a 6465 6620 6269  ta))......def bi
+0001e070: 736f 3275 6973 6f28 6269 736f 293a 0d0a  so2uiso(biso):..
+0001e080: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
+0001e090: 7665 7274 2042 2069 736f 7472 6f70 6963  vert B isotropic
+0001e0a0: 2074 6865 726d 616c 2070 6172 616d 6574   thermal paramet
+0001e0b0: 6572 7320 746f 2055 2069 736f 7472 6f70  ers to U isotrop
+0001e0c0: 6963 2074 6865 726d 616c 2070 6172 616d  ic thermal param
+0001e0d0: 6574 6572 730d 0a20 2020 203a 7061 7261  eters..    :para
+0001e0e0: 6d20 6269 736f 3a20 4269 736f 2076 616c  m biso: Biso val
+0001e0f0: 7565 206f 7220 6172 7261 790d 0a20 2020  ue or array..   
+0001e100: 203a 7265 7475 726e 3a20 5569 736f 2076   :return: Uiso v
+0001e110: 616c 7565 206f 7220 6172 7261 790d 0a20  alue or array.. 
+0001e120: 2020 2022 2222 0d0a 2020 2020 6269 736f     """..    biso
+0001e130: 203d 206e 702e 6173 6172 7261 7928 6269   = np.asarray(bi
+0001e140: 736f 2c20 6474 7970 653d 666c 6f61 7429  so, dtype=float)
+0001e150: 0d0a 2020 2020 7265 7475 726e 2062 6973  ..    return bis
+0001e160: 6f20 2f20 2838 202a 206e 702e 7069 202a  o / (8 * np.pi *
+0001e170: 2a20 3229 0d0a 0d0a 0d0a 6465 6620 7569  * 2)......def ui
+0001e180: 736f 3262 6973 6f28 7569 736f 293a 0d0a  so2biso(uiso):..
+0001e190: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
+0001e1a0: 7665 7274 2055 2069 736f 7472 6f70 6963  vert U isotropic
+0001e1b0: 2074 6865 726d 616c 2070 6172 616d 6574   thermal paramet
+0001e1c0: 6572 7320 746f 2042 2069 736f 7472 6f70  ers to B isotrop
+0001e1d0: 6963 2074 6865 726d 616c 2070 6172 616d  ic thermal param
+0001e1e0: 6574 6572 730d 0a20 2020 203a 7061 7261  eters..    :para
+0001e1f0: 6d20 7569 736f 3a20 5569 736f 2076 616c  m uiso: Uiso val
+0001e200: 7565 206f 7220 6172 7261 790d 0a20 2020  ue or array..   
+0001e210: 203a 7265 7475 726e 3a20 4269 736f 2076   :return: Biso v
+0001e220: 616c 7565 206f 7220 6172 7261 790d 0a20  alue or array.. 
+0001e230: 2020 2022 2222 0d0a 2020 2020 7569 736f     """..    uiso
+0001e240: 203d 206e 702e 6173 6172 7261 7928 7569   = np.asarray(ui
+0001e250: 736f 2c20 6474 7970 653d 666c 6f61 7429  so, dtype=float)
+0001e260: 0d0a 2020 2020 7265 7475 726e 2075 6973  ..    return uis
+0001e270: 6f20 2a20 2838 202a 206e 702e 7069 202a  o * (8 * np.pi *
+0001e280: 2a20 3229 0d0a 0d0a 0d0a 6465 6620 6575  * 2)......def eu
+0001e290: 6c65 725f 756e 6974 5f76 6563 746f 7228  ler_unit_vector(
+0001e2a0: 7576 772c 2075 7629 3a0d 0a20 2020 2022  uvw, uv):..    "
+0001e2b0: 2222 0d0a 2020 2020 436f 6e76 6572 7420  ""..    Convert 
+0001e2c0: 7665 6374 6f72 2069 6e20 6120 7370 6563  vector in a spec
+0001e2d0: 6966 6963 2062 6173 6973 2074 6f20 6120  ific basis to a 
+0001e2e0: 6361 7274 6573 6961 6e20 6261 7369 7320  cartesian basis 
+0001e2f0: 616e 6420 6e6f 726d 616c 6973 6520 746f  and normalise to
+0001e300: 2061 2075 6e69 7420 7665 6374 6f72 0d0a   a unit vector..
+0001e310: 2020 2020 3a70 6172 616d 2075 7677 3a20      :param uvw: 
+0001e320: 5b6e 7833 5d20 6172 7261 7920 6173 205b  [nx3] array as [
+0001e330: 5b75 2c76 2c77 5d5d 0d0a 2020 2020 3a70  [u,v,w]]..    :p
+0001e340: 6172 616d 2075 763a 205b 3378 335d 2c20  aram uv: [3x3], 
+0001e350: 6261 7369 7320 7665 6374 6f72 7320 5b61  basis vectors [a
+0001e360: 2c62 2c63 5d0d 0a20 2020 203a 7265 7475  ,b,c]..    :retu
+0001e370: 726e 3a20 5b6e 7833 5d20 6172 7261 7920  rn: [nx3] array 
+0001e380: 7879 7a2f 7c78 797a 7c2c 2077 6865 7265  xyz/|xyz|, where
+0001e390: 2078 2c79 2c7a 203d 2075 2a61 2b76 2a62   x,y,z = u*a+v*b
+0001e3a0: 2b77 2a63 0d0a 2020 2020 2222 220d 0a20  +w*c..    """.. 
+0001e3b0: 2020 2078 797a 203d 206e 702e 646f 7428     xyz = np.dot(
+0001e3c0: 7576 772c 2075 7629 0d0a 2020 2020 7265  uvw, uv)..    re
+0001e3d0: 7475 726e 2066 672e 6e6f 726d 2878 797a  turn fg.norm(xyz
+0001e3e0: 290d 0a0d 0a0d 0a64 6566 2065 756c 6572  )......def euler
+0001e3f0: 5f6d 6f6d 656e 7428 6d78 6d79 6d7a 2c20  _moment(mxmymz, 
+0001e400: 7576 293a 0d0a 2020 2020 2222 220d 0a20  uv):..    """.. 
+0001e410: 2020 2043 6f6e 7665 7274 206d 6f6d 656e     Convert momen
+0001e420: 7420 6d78 6d79 6d7a 2063 6f6f 7264 696e  t mxmymz coordin
+0001e430: 6174 6573 2066 726f 6d20 6369 6620 696e  ates from cif in
+0001e440: 746f 2065 756c 6572 6961 6e20 6261 7369  to eulerian basi
+0001e450: 730d 0a20 2020 203a 7061 7261 6d20 6d78  s..    :param mx
+0001e460: 6d79 6d7a 3a20 5b6e 7833 5d20 6172 7261  mymz: [nx3] arra
+0001e470: 792c 2075 6e69 7473 206f 6620 426f 6872  y, units of Bohr
+0001e480: 206d 6167 6e65 746f 6e2c 2064 6972 6563   magneton, direc
+0001e490: 7465 6420 616c 6f6e 6720 612c 622c 630d  ted along a,b,c.
+0001e4a0: 0a20 2020 203a 7061 7261 6d20 7576 3a20  .    :param uv: 
+0001e4b0: 5b33 7833 5d20 6172 7261 792c 2062 6173  [3x3] array, bas
+0001e4c0: 6973 2076 6563 746f 7273 205b 612c 622c  is vectors [a,b,
+0001e4d0: 635d 0d0a 2020 2020 3a72 6574 7572 6e3a  c]..    :return:
+0001e4e0: 206d 6f6d 656e 7473 205b 6e78 335d 2061   moments [nx3] a
+0001e4f0: 7272 6179 2c20 756e 6974 7320 6f66 2042  rray, units of B
+0001e500: 6f68 7220 6d61 676e 6574 6f6e 2c20 6469  ohr magneton, di
+0001e510: 7265 6374 6564 2061 6c6f 6e67 2078 2c79  rected along x,y
+0001e520: 2c7a 0d0a 2020 2020 2222 220d 0a20 2020  ,z..    """..   
+0001e530: 2023 2043 616c 6375 6c61 7465 206d 6f6d   # Calculate mom
+0001e540: 656e 740d 0a20 2020 206d 6f6d 656e 746d  ent..    momentm
+0001e550: 6167 203d 2066 672e 6d61 6728 6d78 6d79  ag = fg.mag(mxmy
+0001e560: 6d7a 292e 7265 7368 6170 6528 5b2d 312c  mz).reshape([-1,
+0001e570: 2031 5d29 0d0a 2020 2020 6d6f 6d65 6e74   1])..    moment
+0001e580: 7879 7a20 3d20 6e70 2e64 6f74 286d 786d  xyz = np.dot(mxm
+0001e590: 796d 7a2c 2075 7629 0d0a 2020 2020 6d6f  ymz, uv)..    mo
+0001e5a0: 6d65 6e74 203d 206d 6f6d 656e 746d 6167  ment = momentmag
+0001e5b0: 202a 2066 672e 6e6f 726d 286d 6f6d 656e   * fg.norm(momen
+0001e5c0: 7478 797a 2920 2023 2062 726f 6164 6361  txyz)  # broadca
+0001e5d0: 7374 206e 2a31 2078 206e 2a33 203d 206e  st n*1 x n*3 = n
+0001e5e0: 2a33 0d0a 2020 2020 6d6f 6d65 6e74 5b6e  *3..    moment[n
+0001e5f0: 702e 6973 6e61 6e28 6d6f 6d65 6e74 295d  p.isnan(moment)]
+0001e600: 203d 2030 2e0d 0a20 2020 2072 6574 7572   = 0...    retur
+0001e610: 6e20 6d6f 6d65 6e74 0d0a 0d0a 0d0a 6465  n moment......de
+0001e620: 6620 6469 6666 7261 6374 6f6d 6574 6572  f diffractometer
+0001e630: 5f51 2865 7461 2c20 6465 6c74 612c 2065  _Q(eta, delta, e
+0001e640: 6e65 7267 795f 6b65 763d 382e 3029 3a0d  nergy_kev=8.0):.
+0001e650: 0a20 2020 2022 2222 0d0a 2020 2020 4361  .    """..    Ca
+0001e660: 6c63 756c 6174 6520 7761 7665 7665 6374  lculate wavevect
+0001e670: 6f72 2074 7261 6e73 6665 722c 2051 2066  or transfer, Q f
+0001e680: 6f72 2064 6966 6672 6163 746f 6d65 7465  or diffractomete
+0001e690: 7220 7769 7468 696e 2074 6865 2073 6361  r within the sca
+0001e6a0: 7474 6572 696e 6720 706c 616e 652e 0d0a  ttering plane...
+0001e6b0: 2020 2020 2020 2051 782c 5179 203d 2064         Qx,Qy = d
+0001e6c0: 6966 6672 6163 746f 6d65 7465 725f 5128  iffractometer_Q(
+0001e6d0: 6574 612c 6465 6c74 612c 656e 6572 6779  eta,delta,energy
+0001e6e0: 5f6b 6576 290d 0a20 2020 2020 2020 6574  _kev)..       et
+0001e6f0: 6120 3d20 616e 676c 6520 2864 6567 2920  a = angle (deg) 
+0001e700: 6f66 2073 616d 706c 650d 0a20 2020 2020  of sample..     
+0001e710: 2020 6465 6c74 6120 3d20 616e 676c 6520    delta = angle 
+0001e720: 2864 6567 2920 6f66 2064 6574 6563 746f  (deg) of detecto
+0001e730: 720d 0a20 2020 2020 2020 656e 6572 6779  r..       energy
+0001e740: 5f6b 6576 203d 2065 6e65 7267 7920 696e  _kev = energy in
+0001e750: 206b 6556 0d0a 0d0a 2020 2020 2020 2043   keV....       C
+0001e760: 6f6f 7264 696e 6174 6520 7379 7374 656d  oordinate system
+0001e770: 2028 7269 6768 7420 6861 6e64 6564 293a   (right handed):
+0001e780: 0d0a 2020 2020 2020 2020 7820 2d20 6469  ..        x - di
+0001e790: 7265 6374 696f 6e20 616c 6f6e 6720 6265  rection along be
+0001e7a0: 616d 2c20 2b76 6520 6973 2066 726f 6d20  am, +ve is from 
+0001e7b0: 736f 7572 6365 2074 6f20 7361 6d70 6c65  source to sample
+0001e7c0: 0d0a 2020 2020 2020 2020 7920 2d20 6469  ..        y - di
+0001e7d0: 7265 6374 696f 6e20 7665 7274 6963 6c65  rection verticle
+0001e7e0: 0d0a 2020 2020 2020 2020 7a20 2d20 6469  ..        z - di
+0001e7f0: 7265 6374 696f 6e20 686f 7269 7a6f 6e74  rection horizont
+0001e800: 616c 0d0a 0d0a 2020 2020 2020 204e 6f74  al....       Not
+0001e810: 653a 2043 7572 7265 6e74 6c79 206f 6e6c  e: Currently onl
+0001e820: 7920 696e 2074 6865 2076 6572 7469 636c  y in the verticl
+0001e830: 6520 6765 6f6d 6574 7279 210d 0a20 2020  e geometry!..   
+0001e840: 2022 2222 0d0a 0d0a 2020 2020 6465 6c74   """....    delt
+0001e850: 6120 3d20 6e70 2e72 6164 6961 6e73 2864  a = np.radians(d
+0001e860: 656c 7461 290d 0a20 2020 2065 7461 203d  elta)..    eta =
+0001e870: 206e 702e 7261 6469 616e 7328 6574 6129   np.radians(eta)
+0001e880: 0d0a 2020 2020 4b20 3d20 3145 2d31 3020  ..    K = 1E-10 
+0001e890: 2a20 3130 3030 202a 2032 202a 206e 702e  * 1000 * 2 * np.
+0001e8a0: 7069 202a 2028 656e 6572 6779 5f6b 6576  pi * (energy_kev
+0001e8b0: 202a 2066 672e 6529 202f 2028 6667 2e68   * fg.e) / (fg.h
+0001e8c0: 202a 2066 672e 6329 2020 2320 4b20 7665   * fg.c)  # K ve
+0001e8d0: 6374 6f72 206d 6167 6e69 7475 6465 0d0a  ctor magnitude..
+0001e8e0: 0d0a 2020 2020 5178 203d 204b 202a 2028  ..    Qx = K * (
+0001e8f0: 6e70 2e63 6f73 2865 7461 2920 2d20 6e70  np.cos(eta) - np
+0001e900: 2e63 6f73 2864 656c 7461 202d 2065 7461  .cos(delta - eta
+0001e910: 2929 0d0a 2020 2020 5179 203d 204b 202a  ))..    Qy = K *
+0001e920: 2028 6e70 2e73 696e 2864 656c 7461 202d   (np.sin(delta -
+0001e930: 2065 7461 2920 2b20 6e70 2e73 696e 2865   eta) + np.sin(e
+0001e940: 7461 2929 0d0a 2020 2020 7265 7475 726e  ta))..    return
+0001e950: 2051 782c 2051 790d 0a0d 0a0d 0a64 6566   Qx, Qy......def
+0001e960: 2068 6b6c 3273 7472 2868 6b6c 293a 0d0a   hkl2str(hkl):..
+0001e970: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
+0001e980: 7665 7274 2068 6b6c 2074 6f20 7374 7269  vert hkl to stri
+0001e990: 6e67 2028 682c 6b2c 6c29 0d0a 2020 2020  ng (h,k,l)..    
+0001e9a0: 3a70 6172 616d 2068 6b6c 3a0d 0a20 2020  :param hkl:..   
+0001e9b0: 203a 7265 7475 726e 3a20 7374 7220 2728   :return: str '(
+0001e9c0: 682c 6b2c 6c29 270d 0a20 2020 2022 2222  h,k,l)'..    """
+0001e9d0: 0d0a 0d0a 2020 2020 6f75 7420 3d20 2728  ....    out = '(
+0001e9e0: 2531 2e33 672c 2531 2e33 672c 2531 2e33  %1.3g,%1.3g,%1.3
+0001e9f0: 6729 270d 0a20 2020 2068 6b6c 203d 206e  g)'..    hkl = n
+0001ea00: 702e 6173 6172 7261 7928 686b 6c2c 2064  p.asarray(hkl, d
+0001ea10: 7479 7065 3d66 6c6f 6174 292e 7265 7368  type=float).resh
+0001ea20: 6170 6528 5b2d 312c 2033 5d29 0d0a 2020  ape([-1, 3])..  
+0001ea30: 2020 686b 6c20 3d20 6e70 2e61 726f 756e    hkl = np.aroun
+0001ea40: 6428 686b 6c2c 2035 290d 0a20 2020 2072  d(hkl, 5)..    r
+0001ea50: 6574 7572 6e20 275c 6e27 2e6a 6f69 6e28  eturn '\n'.join(
+0001ea60: 5b6f 7574 2025 2028 785b 305d 2c20 785b  [out % (x[0], x[
+0001ea70: 315d 2c20 785b 325d 2920 666f 7220 7820  1], x[2]) for x 
+0001ea80: 696e 2068 6b6c 5d29 0d0a 0d0a 0d0a 6465  in hkl])......de
+0001ea90: 6620 6375 7432 706f 7764 6572 2871 782c  f cut2powder(qx,
+0001eaa0: 2071 792c 2071 7a2c 2063 7574 293a 0d0a   qy, qz, cut):..
+0001eab0: 2020 2020 2222 220d 0a20 2020 2043 6f6e      """..    Con
+0001eac0: 7665 7274 2032 4420 7265 6369 7072 6f63  vert 2D reciproc
+0001ead0: 616c 2073 7061 6365 2063 7574 2074 6f20  al space cut to 
+0001eae0: 706f 7764 6572 2070 6174 7465 726e 0d0a  powder pattern..
+0001eaf0: 2020 2020 3a70 6172 616d 2071 783a 205b      :param qx: [
+0001eb00: 6e2c 6d5d 2061 7272 6179 206f 6620 5120  n,m] array of Q 
+0001eb10: 636f 6f72 6469 6e61 7465 7320 696e 2078  coordinates in x
+0001eb20: 0d0a 2020 2020 3a70 6172 616d 2071 793a  ..    :param qy:
+0001eb30: 205b 6e2c 6d5d 2061 7272 6179 206f 6620   [n,m] array of 
+0001eb40: 5120 636f 6f72 6469 6e61 7465 7320 696e  Q coordinates in
+0001eb50: 2079 0d0a 2020 2020 3a70 6172 616d 2071   y..    :param q
+0001eb60: 7a3a 205b 6e2c 6d5d 2061 7272 6179 206f  z: [n,m] array o
+0001eb70: 7220 666c 6f61 7420 6f66 2051 2063 6f6f  r float of Q coo
+0001eb80: 7264 696e 6174 6573 2069 6e20 7a0d 0a20  rdinates in z.. 
+0001eb90: 2020 203a 7061 7261 6d20 6375 743a 205b     :param cut: [
+0001eba0: 6e2c 6d5d 2061 7272 6179 206f 6620 696e  n,m] array of in
+0001ebb0: 7465 6e73 6974 6965 730d 0a20 2020 203a  tensities..    :
+0001ebc0: 7265 7475 726e 3a20 716d 5b6f 5d2c 2070  return: qm[o], p
+0001ebd0: 6f77 5b6f 5d0d 0a20 2020 2022 2222 0d0a  ow[o]..    """..
+0001ebe0: 2020 2020 7171 203d 206e 702e 7371 7274      qq = np.sqrt
+0001ebf0: 2871 7820 2a2a 2032 202b 2071 7920 2a2a  (qx ** 2 + qy **
+0001ec00: 2032 202b 2071 7a20 2a2a 2032 290d 0a20   2 + qz ** 2).. 
+0001ec10: 2020 2072 6574 7572 6e20 6667 2e67 7269     return fg.gri
+0001ec20: 645f 696e 7465 6e73 6974 7928 7171 2e72  d_intensity(qq.r
+0001ec30: 6176 656c 2829 2c20 6375 742e 7261 7665  avel(), cut.rave
+0001ec40: 6c28 2929 0d0a 0d0a 0d0a 272d 2d2d 2d2d  l())......'-----
+0001ec50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001ec60: 2d2d 2d2d 2d4d 6973 6320 4372 7973 7461  -----Misc Crysta
+0001ec70: 6c20 5072 6f67 7261 6d73 2d2d 2d2d 2d2d  l Programs------
+0001ec80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001ec90: 2d2d 270d 0a0d 0a0d 0a64 6566 2073 7472  --'......def str
+0001eca0: 3265 6c65 6d65 6e74 2873 7472 696e 6729  2element(string)
+0001ecb0: 3a0d 0a20 2020 2022 2222 4669 6e64 7320  :..    """Finds 
+0001ecc0: 656c 656d 656e 7420 6e61 6d65 2069 6e20  element name in 
+0001ecd0: 7374 7269 6e67 2222 220d 0a20 2020 2072  string"""..    r
+0001ece0: 6573 756c 7420 3d20 656c 656d 656e 745f  esult = element_
+0001ecf0: 7265 6765 782e 6669 6e64 616c 6c28 7374  regex.findall(st
+0001ed00: 7269 6e67 290d 0a20 2020 2069 6620 6c65  ring)..    if le
+0001ed10: 6e28 7265 7375 6c74 2920 3d3d 2030 3a0d  n(result) == 0:.
+0001ed20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001ed30: 4661 6c73 650d 0a20 2020 2072 6574 7572  False..    retur
+0001ed40: 6e20 7265 7375 6c74 5b30 5d2e 6361 7069  n result[0].capi
+0001ed50: 7461 6c69 7a65 2829 0d0a 0d0a 0d0a 6465  talize()......de
+0001ed60: 6620 6465 6279 6577 616c 6c65 7228 7569  f debyewaller(ui
+0001ed70: 736f 2c20 516d 6167 3d30 293a 0d0a 2020  so, Qmag=0):..  
+0001ed80: 2020 2222 220d 0a20 2020 2043 616c 6375    """..    Calcu
+0001ed90: 6c61 7465 2074 6865 2064 6562 7965 2077  late the debye w
+0001eda0: 616c 6c65 7220 6661 6374 6f72 2066 6f72  aller factor for
+0001edb0: 2061 2070 6172 7469 6375 6c61 7220 510d   a particular Q.
+0001edc0: 0a20 2020 2020 5420 3d20 6465 6279 6577  .     T = debyew
+0001edd0: 616c 6c65 7228 7569 736f 2c51 6d61 673d  aller(uiso,Qmag=
+0001ede0: 5b30 5d29 0d0a 0d0a 2020 2020 2020 2020  [0])....        
+0001edf0: 5420 3d20 6578 7028 202d 322a 7069 5e32  T = exp( -2*pi^2
+0001ee00: 2a55 6973 6f2f 645e 3220 290d 0a20 2020  *Uiso/d^2 )..   
+0001ee10: 2020 2020 2054 203d 2065 7870 2820 2d55       T = exp( -U
+0001ee20: 6973 6f2f 3220 2a20 515e 3220 290d 0a20  iso/2 * Q^2 ).. 
+0001ee30: 2020 2022 2222 0d0a 0d0a 2020 2020 7569     """....    ui
+0001ee40: 736f 203d 206e 702e 6173 6172 7261 7928  so = np.asarray(
+0001ee50: 7569 736f 2c20 6474 7970 653d 666c 6f61  uiso, dtype=floa
+0001ee60: 7429 2e72 6573 6861 7065 2831 2c20 2d31  t).reshape(1, -1
+0001ee70: 290d 0a20 2020 2051 6d61 6720 3d20 6e70  )..    Qmag = np
+0001ee80: 2e61 7361 7272 6179 2851 6d61 672c 2064  .asarray(Qmag, d
+0001ee90: 7479 7065 3d66 6c6f 6174 292e 7265 7368  type=float).resh
+0001eea0: 6170 6528 2d31 2c20 3129 0d0a 0d0a 2020  ape(-1, 1)....  
+0001eeb0: 2020 2320 5461 6c6c 203d 206e 702e 6578    # Tall = np.ex
+0001eec0: 7028 2d30 2e35 202a 206e 702e 646f 7428  p(-0.5 * np.dot(
+0001eed0: 516d 6167 2c20 7569 736f 2929 2020 2320  Qmag, uiso))  # 
+0001eee0: 4e6f 7420 7375 7265 2077 6865 7265 2074  Not sure where t
+0001eef0: 6869 7320 636f 6d65 7320 6672 6f6d 2e2e  his comes from..
+0001ef00: 2e20 4a6f 6e27 7320 6e6f 7465 733f 0d0a  . Jon's notes?..
+0001ef10: 2020 2020 5461 6c6c 203d 206e 702e 6578      Tall = np.ex
+0001ef20: 7028 2d30 2e35 202a 206e 702e 646f 7428  p(-0.5 * np.dot(
+0001ef30: 516d 6167 202a 2a20 322c 2075 6973 6f29  Qmag ** 2, uiso)
+0001ef40: 290d 0a20 2020 2072 6574 7572 6e20 5461  )..    return Ta
+0001ef50: 6c6c 0d0a 0d0a 0d0a 6465 6620 706f 7764  ll......def powd
+0001ef60: 6572 5f61 7665 7261 6765 2874 7468 2c20  er_average(tth, 
+0001ef70: 656e 6572 6779 5f6b 6576 293a 0d0a 2020  energy_kev):..  
+0001ef80: 2020 2222 220d 0a20 2020 2052 6574 7572    """..    Retur
+0001ef90: 6e20 7468 6520 706f 7764 6572 2061 7665  n the powder ave
+0001efa0: 7261 6765 2063 6f72 7265 6374 696f 6e20  rage correction 
+0001efb0: 666f 7220 696e 7465 6e73 6974 6965 7320  for intensities 
+0001efc0: 6174 2061 2067 6976 656e 2074 776f 2d74  at a given two-t
+0001efd0: 6865 7461 0d0a 2020 2020 2020 2020 4970  heta..        Ip
+0001efe0: 203d 2049 302a 5041 2c20 2020 2050 4120   = I0*PA,    PA 
+0001eff0: 3d20 312f 7c51 7c5e 320d 0a20 2020 203a  = 1/|Q|^2..    :
+0001f000: 7061 7261 6d20 7474 683a 2074 776f 2d74  param tth: two-t
+0001f010: 6865 7461 2069 6e20 6465 670d 0a20 2020  heta in deg..   
+0001f020: 203a 7061 7261 6d20 656e 6572 6779 5f6b   :param energy_k
+0001f030: 6576 3a20 656e 6572 6779 2069 6e20 6b65  ev: energy in ke
+0001f040: 560d 0a20 2020 203a 7265 7475 726e 3a20  V..    :return: 
+0001f050: 5041 0d0a 2020 2020 2222 220d 0a20 2020  PA..    """..   
+0001f060: 2071 203d 2063 616c 716d 6167 2874 7468   q = calqmag(tth
+0001f070: 2c20 656e 6572 6779 5f6b 6576 290d 0a20  , energy_kev).. 
+0001f080: 2020 2072 6574 7572 6e20 3120 2f20 7120     return 1 / q 
+0001f090: 2a2a 2032 0d0a 0d0a 0d0a 6465 6620 6772  ** 2......def gr
+0001f0a0: 6f75 705f 696e 7465 6e73 6974 6965 7328  oup_intensities(
+0001f0b0: 715f 7661 6c75 6573 2c20 696e 7465 6e73  q_values, intens
+0001f0c0: 6974 792c 206d 696e 5f6f 7665 726c 6170  ity, min_overlap
+0001f0d0: 3d30 2e30 3129 3a0d 0a20 2020 2022 2222  =0.01):..    """
+0001f0e0: 0d0a 2020 2020 4772 6f75 7020 7265 666c  ..    Group refl
+0001f0f0: 6563 7469 6f6e 7320 7769 7468 696e 2074  ections within t
+0001f100: 6865 206f 7665 726c 6170 2c20 7265 7475  he overlap, retu
+0001f110: 726e 696e 6720 7468 6520 696e 6465 7820  rning the index 
+0001f120: 6d61 7820 696e 7465 6e73 6974 7920 6f66  max intensity of
+0001f130: 2065 6163 6820 6772 6f75 700d 0a20 2020   each group..   
+0001f140: 203a 7061 7261 6d20 715f 7661 6c75 6573   :param q_values
+0001f150: 3a20 5b31 2a6e 5d20 6172 7261 7920 6f66  : [1*n] array of
+0001f160: 2066 6c6f 6174 732c 2070 6f73 6974 696f   floats, positio
+0001f170: 6e20 7061 7261 6d65 7465 7220 6f66 2065  n parameter of e
+0001f180: 6163 6820 7265 666c 6563 7469 6f6e 0d0a  ach reflection..
+0001f190: 2020 2020 3a70 6172 616d 2069 6e74 656e      :param inten
+0001f1a0: 7369 7479 3a20 5b31 2a6e 5d20 6172 7261  sity: [1*n] arra
+0001f1b0: 7920 6f66 2066 6c6f 6174 732c 2069 6e74  y of floats, int
+0001f1c0: 656e 7369 7479 2070 6172 616d 6574 6572  ensity parameter
+0001f1d0: 206f 6620 6561 6368 2072 6566 6c65 6374   of each reflect
+0001f1e0: 696f 6e0d 0a20 2020 203a 7061 7261 6d20  ion..    :param 
+0001f1f0: 6d69 6e5f 6f76 6572 6c61 703a 2066 6c6f  min_overlap: flo
+0001f200: 6174 2c20 686f 7720 636c 6f73 6520 7468  at, how close th
+0001f210: 6520 7265 666c 6563 7469 6f6e 7320 6172  e reflections ar
+0001f220: 6520 746f 2062 6520 6772 6f75 7065 640d  e to be grouped.
+0001f230: 0a20 2020 203a 7265 7475 726e 3a20 6772  .    :return: gr
+0001f240: 6f75 705f 6964 783a 205b 312a 6d5d 2061  oup_idx: [1*m] a
+0001f250: 7272 6179 206f 6620 696e 7420 696e 6465  rray of int inde
+0001f260: 780d 0a20 2020 2022 2222 0d0a 0d0a 2020  x..    """....  
+0001f270: 2020 6772 6f75 7073 2c20 6172 7261 795f    groups, array_
+0001f280: 696e 6465 782c 2067 726f 7570 5f69 6e64  index, group_ind
+0001f290: 6578 2c20 636f 756e 7473 203d 2066 672e  ex, counts = fg.
+0001f2a0: 6772 6f75 7028 715f 7661 6c75 6573 2c20  group(q_values, 
+0001f2b0: 6d69 6e5f 6f76 6572 6c61 7029 0d0a 0d0a  min_overlap)....
+0001f2c0: 2020 2020 2320 6c6f 6f70 206f 7665 7220      # loop over 
+0001f2d0: 6772 6f75 7073 2061 6e64 2073 656c 6563  groups and selec
+0001f2e0: 7420 7265 666c 6563 7469 6f6e 2077 6974  t reflection wit
+0001f2f0: 6820 6c61 7267 6573 7420 696e 7465 6e73  h largest intens
+0001f300: 6974 790d 0a20 2020 2072 6566 5f6e 203d  ity..    ref_n =
+0001f310: 206e 702e 7a65 726f 7328 6c65 6e28 6772   np.zeros(len(gr
+0001f320: 6f75 7073 292c 2064 7479 7065 3d69 6e74  oups), dtype=int
+0001f330: 290d 0a20 2020 2066 6f72 206e 2069 6e20  )..    for n in 
+0001f340: 7261 6e67 6528 6c65 6e28 6772 6f75 7073  range(len(groups
+0001f350: 2929 3a0d 0a20 2020 2020 2020 2061 7267  )):..        arg
+0001f360: 7320 3d20 6e70 2e77 6865 7265 2861 7272  s = np.where(arr
+0001f370: 6179 5f69 6e64 6578 203d 3d20 6e29 5b30  ay_index == n)[0
+0001f380: 5d0d 0a20 2020 2020 2020 2023 2066 696e  ]..        # fin
+0001f390: 6420 6d61 7820 696e 7465 6e73 6974 790d  d max intensity.
+0001f3a0: 0a20 2020 2020 2020 2072 6566 5f6e 5b6e  .        ref_n[n
+0001f3b0: 5d20 3d20 6172 6773 5b6e 702e 6172 676d  ] = args[np.argm
+0001f3c0: 6178 2869 6e74 656e 7369 7479 5b61 7267  ax(intensity[arg
+0001f3d0: 735d 295d 0d0a 2020 2020 7265 7475 726e  s])]..    return
+0001f3e0: 2072 6566 5f6e 0d0a 0d0a 0d0a 6465 6620   ref_n......def 
+0001f3f0: 6361 6c63 5f76 6f6c 2855 5629 3a0d 0a20  calc_vol(UV):.. 
+0001f400: 2020 2022 4361 6c63 756c 6174 6520 766f     "Calculate vo
+0001f410: 6c75 6d65 2069 6e20 416e 6773 7472 6f6d  lume in Angstrom
+0001f420: 5e33 2066 726f 6d20 756e 6974 2076 6563  ^3 from unit vec
+0001f430: 746f 7273 220d 0a20 2020 2061 2c20 622c  tors"..    a, b,
+0001f440: 2063 203d 2055 560d 0a20 2020 2072 6574   c = UV..    ret
+0001f450: 7572 6e20 6e70 2e64 6f74 2861 2c20 6e70  urn np.dot(a, np
+0001f460: 2e63 726f 7373 2862 2c20 6329 290d 0a0d  .cross(b, c))...
+0001f470: 0a0d 0a64 6566 2063 6966 3274 6162 6c65  ...def cif2table
+0001f480: 2863 6966 293a 0d0a 2020 2020 2222 220d  (cif):..    """.
+0001f490: 0a20 2020 2047 656e 6572 6174 6520 4c61  .    Generate La
+0001f4a0: 7465 7820 7461 626c 6520 6f66 2061 746f  tex table of ato
+0001f4b0: 6d69 6320 706f 7369 7469 6f6e 7320 6672  mic positions fr
+0001f4c0: 6f6d 2063 6966 2064 6963 7469 6f6e 6172  om cif dictionar
+0001f4d0: 790d 0a20 2020 203a 7061 7261 6d20 6369  y..    :param ci
+0001f4e0: 663a 2063 6966 2064 6963 7420 6672 6f6d  f: cif dict from
+0001f4f0: 2072 6561 6463 6966 0d0a 2020 2020 3a72   readcif..    :r
+0001f500: 6574 7572 6e3a 2073 7472 0d0a 2020 2020  eturn: str..    
+0001f510: 2222 220d 0a0d 0a20 2020 206b 6579 7320  """....    keys 
+0001f520: 3d20 6369 662e 6b65 7973 2829 0d0a 0d0a  = cif.keys()....
+0001f530: 2020 2020 2320 4765 6e65 7261 7465 2075      # Generate u
+0001f540: 6e69 7420 7665 6374 6f72 730d 0a20 2020  nit vectors..   
+0001f550: 2061 203d 2063 6966 5b27 5f63 656c 6c5f   a = cif['_cell_
+0001f560: 6c65 6e67 7468 5f61 275d 0d0a 2020 2020  length_a']..    
+0001f570: 6220 3d20 6369 665b 275f 6365 6c6c 5f6c  b = cif['_cell_l
+0001f580: 656e 6774 685f 6227 5d0d 0a20 2020 2063  ength_b']..    c
+0001f590: 203d 2063 6966 5b27 5f63 656c 6c5f 6c65   = cif['_cell_le
+0001f5a0: 6e67 7468 5f63 275d 0d0a 2020 2020 616c  ngth_c']..    al
+0001f5b0: 7068 6120 3d20 6369 665b 275f 6365 6c6c  pha = cif['_cell
+0001f5c0: 5f61 6e67 6c65 5f61 6c70 6861 275d 0d0a  _angle_alpha']..
+0001f5d0: 2020 2020 6265 7461 203d 2063 6966 5b27      beta = cif['
+0001f5e0: 5f63 656c 6c5f 616e 676c 655f 6265 7461  _cell_angle_beta
+0001f5f0: 275d 0d0a 2020 2020 6761 6d6d 6120 3d20  ']..    gamma = 
+0001f600: 6369 665b 275f 6365 6c6c 5f61 6e67 6c65  cif['_cell_angle
+0001f610: 5f67 616d 6d61 275d 0d0a 2020 2020 6c70  _gamma']..    lp
+0001f620: 203d 2072 2761 3d25 735c 4141 2c20 623d   = r'a=%s\AA, b=
+0001f630: 2573 5c41 412c 2063 3d25 735c 4141 2c20  %s\AA, c=%s\AA, 
+0001f640: 245c 616c 7068 6124 3d25 732c 2024 5c62  $\alpha$=%s, $\b
+0001f650: 6574 6124 3d25 732c 2024 5c67 616d 6d61  eta$=%s, $\gamma
+0001f660: 243d 2573 2720 2520 2861 2c20 622c 2063  $=%s' % (a, b, c
+0001f670: 2c20 616c 7068 612c 2062 6574 612c 2067  , alpha, beta, g
+0001f680: 616d 6d61 290d 0a0d 0a20 2020 2023 2047  amma)....    # G
+0001f690: 6574 2061 746f 6d20 6e61 6d65 7320 2620  et atom names & 
+0001f6a0: 6c61 6265 6c73 0d0a 2020 2020 6c61 6265  labels..    labe
+0001f6b0: 6c20 3d20 6369 665b 275f 6174 6f6d 5f73  l = cif['_atom_s
+0001f6c0: 6974 655f 6c61 6265 6c27 5d0d 0a0d 0a20  ite_label'].... 
+0001f6d0: 2020 2023 2054 6865 726d 616c 2070 6172     # Thermal par
+0001f6e0: 616d 6574 6572 730d 0a20 2020 2069 6620  ameters..    if 
+0001f6f0: 275f 6174 6f6d 5f73 6974 655f 555f 6973  '_atom_site_U_is
+0001f700: 6f5f 6f72 5f65 7175 6976 2720 696e 206b  o_or_equiv' in k
+0001f710: 6579 733a 0d0a 2020 2020 2020 2020 755f  eys:..        u_
+0001f720: 6f72 5f62 203d 2027 5524 5f7b 6973 6f7d  or_b = 'U$_{iso}
+0001f730: 2427 0d0a 2020 2020 2020 2020 7569 736f  $'..        uiso
+0001f740: 203d 2063 6966 5b27 5f61 746f 6d5f 7369   = cif['_atom_si
+0001f750: 7465 5f55 5f69 736f 5f6f 725f 6571 7569  te_U_iso_or_equi
+0001f760: 7627 5d0d 0a20 2020 2065 6c69 6620 275f  v']..    elif '_
+0001f770: 6174 6f6d 5f73 6974 655f 425f 6973 6f5f  atom_site_B_iso_
+0001f780: 6f72 5f65 7175 6976 2720 696e 206b 6579  or_equiv' in key
+0001f790: 733a 0d0a 2020 2020 2020 2020 755f 6f72  s:..        u_or
+0001f7a0: 5f62 203d 2027 4224 5f7b 6973 6f7d 2427  _b = 'B$_{iso}$'
+0001f7b0: 0d0a 2020 2020 2020 2020 7569 736f 203d  ..        uiso =
+0001f7c0: 2063 6966 5b27 5f61 746f 6d5f 7369 7465   cif['_atom_site
+0001f7d0: 5f42 5f69 736f 5f6f 725f 6571 7569 7627  _B_iso_or_equiv'
+0001f7e0: 5d0d 0a20 2020 2065 6c73 653a 0d0a 2020  ]..    else:..  
+0001f7f0: 2020 2020 2020 755f 6f72 5f62 203d 2027        u_or_b = '
+0001f800: 5524 5f7b 6973 6f7d 2427 0d0a 2020 2020  U$_{iso}$'..    
+0001f810: 2020 2020 7569 736f 203d 205b 2730 2e30      uiso = ['0.0
+0001f820: 3030 275d 202a 206c 656e 286c 6162 656c  00'] * len(label
+0001f830: 290d 0a20 2020 2023 204f 6363 7570 616e  )..    # Occupan
+0001f840: 6379 0d0a 2020 2020 6966 2027 5f61 746f  cy..    if '_ato
+0001f850: 6d5f 7369 7465 5f6f 6363 7570 616e 6379  m_site_occupancy
+0001f860: 2720 696e 206b 6579 733a 0d0a 2020 2020  ' in keys:..    
+0001f870: 2020 2020 6f63 6320 3d20 6369 665b 275f      occ = cif['_
+0001f880: 6174 6f6d 5f73 6974 655f 6f63 6375 7061  atom_site_occupa
+0001f890: 6e63 7927 5d0d 0a20 2020 2065 6c73 653a  ncy']..    else:
+0001f8a0: 0d0a 2020 2020 2020 2020 6f63 6320 3d20  ..        occ = 
+0001f8b0: 5b27 312e 3027 5d20 2a20 6c65 6e28 6c61  ['1.0'] * len(la
+0001f8c0: 6265 6c29 0d0a 2020 2020 2320 4d75 6c74  bel)..    # Mult
+0001f8d0: 6970 6c69 6369 7479 0d0a 2020 2020 6966  iplicity..    if
+0001f8e0: 2027 5f61 746f 6d5f 7369 7465 5f73 6974   '_atom_site_sit
+0001f8f0: 655f 7379 6d6d 6574 7279 5f6d 756c 7469  e_symmetry_multi
+0001f900: 706c 6963 6974 7927 2069 6e20 6b65 7973  plicity' in keys
+0001f910: 3a0d 0a20 2020 2020 2020 206d 756c 7420  :..        mult 
+0001f920: 3d20 5b73 202b 2027 6127 2066 6f72 2073  = [s + 'a' for s
+0001f930: 2069 6e20 6369 665b 275f 6174 6f6d 5f73   in cif['_atom_s
+0001f940: 6974 655f 7369 7465 5f73 796d 6d65 7472  ite_site_symmetr
+0001f950: 795f 6d75 6c74 6970 6c69 6369 7479 275d  y_multiplicity']
+0001f960: 5d0d 0a20 2020 2065 6c73 653a 0d0a 2020  ]..    else:..  
+0001f970: 2020 2020 2020 6d75 6c74 203d 205b 2731        mult = ['1
+0001f980: 6127 5d20 2a20 6c65 6e28 6c61 6265 6c29  a'] * len(label)
+0001f990: 0d0a 0d0a 2020 2020 2320 4765 7420 636f  ....    # Get co
+0001f9a0: 6f72 6469 6e61 7465 730d 0a20 2020 2075  ordinates..    u
+0001f9b0: 203d 2063 6966 5b27 5f61 746f 6d5f 7369   = cif['_atom_si
+0001f9c0: 7465 5f66 7261 6374 5f78 275d 0d0a 2020  te_fract_x']..  
+0001f9d0: 2020 7620 3d20 6369 665b 275f 6174 6f6d    v = cif['_atom
+0001f9e0: 5f73 6974 655f 6672 6163 745f 7927 5d0d  _site_fract_y'].
+0001f9f0: 0a20 2020 2077 203d 2063 6966 5b27 5f61  .    w = cif['_a
+0001fa00: 746f 6d5f 7369 7465 5f66 7261 6374 5f7a  tom_site_fract_z
+0001fa10: 275d 0d0a 0d0a 2020 2020 2320 4765 7420  ']....    # Get 
+0001fa20: 7370 6163 6520 6772 6f75 700d 0a20 2020  space group..   
+0001fa30: 2069 6620 275f 7379 6d6d 6574 7279 5f73   if '_symmetry_s
+0001fa40: 7061 6365 5f67 726f 7570 5f6e 616d 655f  pace_group_name_
+0001fa50: 482d 4d27 2069 6e20 6b65 7973 3a0d 0a20  H-M' in keys:.. 
+0001fa60: 2020 2020 2020 2073 7061 6365 6772 6f75         spacegrou
+0001fa70: 7020 3d20 6369 665b 275f 7379 6d6d 6574  p = cif['_symmet
+0001fa80: 7279 5f73 7061 6365 5f67 726f 7570 5f6e  ry_space_group_n
+0001fa90: 616d 655f 482d 4d27 5d0d 0a20 2020 2065  ame_H-M']..    e
+0001faa0: 6c69 6620 275f 7370 6163 655f 6772 6f75  lif '_space_grou
+0001fab0: 705f 6e61 6d65 5f48 2d4d 5f61 6c74 2720  p_name_H-M_alt' 
+0001fac0: 696e 206b 6579 733a 0d0a 2020 2020 2020  in keys:..      
+0001fad0: 2020 7370 6163 6567 726f 7570 203d 2063    spacegroup = c
+0001fae0: 6966 5b27 5f73 7061 6365 5f67 726f 7570  if['_space_group
+0001faf0: 5f6e 616d 655f 482d 4d5f 616c 7427 5d0d  _name_H-M_alt'].
+0001fb00: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+0001fb10: 2020 2020 7370 6163 6567 726f 7570 203d      spacegroup =
+0001fb20: 2027 270d 0a20 2020 2069 6620 275f 7379   ''..    if '_sy
+0001fb30: 6d6d 6574 7279 5f49 6e74 5f54 6162 6c65  mmetry_Int_Table
+0001fb40: 735f 6e75 6d62 6572 2720 696e 206b 6579  s_number' in key
+0001fb50: 733a 0d0a 2020 2020 2020 2020 7367 6e20  s:..        sgn 
+0001fb60: 3d20 666c 6f61 7428 6369 665b 275f 7379  = float(cif['_sy
+0001fb70: 6d6d 6574 7279 5f49 6e74 5f54 6162 6c65  mmetry_Int_Table
+0001fb80: 735f 6e75 6d62 6572 275d 290d 0a20 2020  s_number'])..   
+0001fb90: 2065 6c69 6620 275f 7370 6163 655f 6772   elif '_space_gr
+0001fba0: 6f75 705f 4954 5f6e 756d 6265 7227 2069  oup_IT_number' i
+0001fbb0: 6e20 6b65 7973 3a0d 0a20 2020 2020 2020  n keys:..       
+0001fbc0: 2073 676e 203d 2066 6c6f 6174 2863 6966   sgn = float(cif
+0001fbd0: 5b27 5f73 7061 6365 5f67 726f 7570 5f49  ['_space_group_I
+0001fbe0: 545f 6e75 6d62 6572 275d 290d 0a20 2020  T_number'])..   
+0001fbf0: 2065 6c69 6620 7370 6163 6567 726f 7570   elif spacegroup
+0001fc00: 203d 3d20 2750 3127 3a0d 0a20 2020 2020   == 'P1':..     
+0001fc10: 2020 2073 676e 203d 2031 0d0a 2020 2020     sgn = 1..    
+0001fc20: 656c 7365 3a0d 0a20 2020 2020 2020 2073  else:..        s
+0001fc30: 676e 203d 2030 0d0a 0d0a 2020 2020 2320  gn = 0....    # 
+0001fc40: 4164 6974 696f 6e61 6c20 6465 7461 696c  Aditional detail
+0001fc50: 733a 0d0a 2020 2020 6966 2027 4669 6c65  s:..    if 'File
+0001fc60: 5469 746c 6527 2069 6e20 6b65 7973 3a0d  Title' in keys:.
+0001fc70: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
+0001fc80: 6369 665b 2746 696c 6554 6974 6c65 275d  cif['FileTitle']
+0001fc90: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+0001fca0: 2020 2020 206e 616d 6520 3d20 2773 616d       name = 'sam
+0001fcb0: 706c 6527 0d0a 0d0a 2020 2020 6578 7472  ple'....    extr
+0001fcc0: 6120 3d20 5b5d 0d0a 2020 2020 6966 2027  a = []..    if '
+0001fcd0: 5f63 656c 6c5f 6d65 6173 7572 656d 656e  _cell_measuremen
+0001fce0: 745f 7465 6d70 6572 6174 7572 6527 2069  t_temperature' i
+0001fcf0: 6e20 6b65 7973 3a0d 0a20 2020 2020 2020  n keys:..       
+0001fd00: 2065 7874 7261 202b 3d20 5b27 5420 3d20   extra += ['T = 
+0001fd10: 2573 2720 2520 6369 665b 275f 6365 6c6c  %s' % cif['_cell
+0001fd20: 5f6d 6561 7375 7265 6d65 6e74 5f74 656d  _measurement_tem
+0001fd30: 7065 7261 7475 7265 275d 5d0d 0a20 2020  perature']]..   
+0001fd40: 2069 6620 275f 6469 6666 726e 5f72 6566   if '_diffrn_ref
+0001fd50: 6c6e 735f 6e75 6d62 6572 2720 696e 206b  lns_number' in k
+0001fd60: 6579 733a 0d0a 2020 2020 2020 2020 6578  eys:..        ex
+0001fd70: 7472 6120 2b3d 205b 2725 7320 7265 666c  tra += ['%s refl
+0001fd80: 6563 7469 6f6e 7327 2025 2063 6966 5b27  ections' % cif['
+0001fd90: 5f64 6966 6672 6e5f 7265 666c 6e73 5f6e  _diffrn_reflns_n
+0001fda0: 756d 6265 7227 5d5d 0d0a 2020 2020 6966  umber']]..    if
+0001fdb0: 2027 5f72 6566 696e 655f 6c73 5f77 525f   '_refine_ls_wR_
+0001fdc0: 6661 6374 6f72 5f72 6566 2720 696e 206b  factor_ref' in k
+0001fdd0: 6579 733a 0d0a 2020 2020 2020 2020 6578  eys:..        ex
+0001fde0: 7472 6120 2b3d 205b 2752 245f 7724 203d  tra += ['R$_w$ =
+0001fdf0: 2025 342e 3266 5c5c 2525 2720 2520 2866   %4.2f\\%%' % (f
+0001fe00: 6c6f 6174 2863 6966 5b27 5f72 6566 696e  loat(cif['_refin
+0001fe10: 655f 6c73 5f77 525f 6661 6374 6f72 5f72  e_ls_wR_factor_r
+0001fe20: 6566 275d 2920 2a20 3130 3029 5d0d 0a20  ef']) * 100)].. 
+0001fe30: 2020 2065 7874 7261 203d 2027 2c20 272e     extra = ', '.
+0001fe40: 6a6f 696e 2865 7874 7261 290d 0a0d 0a20  join(extra).... 
+0001fe50: 2020 2023 2043 7265 6174 6520 7461 626c     # Create tabl
+0001fe60: 6520 7374 720d 0a20 2020 206f 7574 203d  e str..    out =
+0001fe70: 2027 2525 2025 735c 6e27 2025 2063 6966   '%% %s\n' % cif
+0001fe80: 5b27 4669 6c65 6e61 6d65 275d 0d0a 2020  ['Filename']..  
+0001fe90: 2020 6f75 7420 2b3d 2027 5c5c 6265 6769    out += '\\begi
+0001fea0: 6e7b 7461 626c 657d 5b68 7470 5d5c 6e27  n{table}[htp]\n'
+0001feb0: 0d0a 2020 2020 6f75 7420 2b3d 2027 2020  ..    out += '  
+0001fec0: 2020 5c5c 6365 6e74 6572 696e 675c 6e27    \\centering\n'
+0001fed0: 0d0a 2020 2020 6f75 7420 2b3d 2027 2020  ..    out += '  
+0001fee0: 2020 2020 205c 5c62 6567 696e 7b74 6162       \\begin{tab
+0001fef0: 756c 6172 7d7b 637c 637c 6363 6363 637d  ular}{c|c|ccccc}
+0001ff00: 5c6e 270d 0a20 2020 206f 7574 202b 3d20  \n'..    out += 
+0001ff10: 2720 2020 2020 2020 2020 2020 2020 2620  '             & 
+0001ff20: 5369 7465 2026 2078 2026 2079 2026 207a  Site & x & y & z
+0001ff30: 2026 204f 6363 2e20 2620 2573 205c 5c5c   & Occ. & %s \\\
+0001ff40: 5c20 5c68 6c69 6e65 5c6e 2720 2520 755f  \ \hline\n' % u_
+0001ff50: 6f72 5f62 0d0a 2020 2020 666d 7420 3d20  or_b..    fmt = 
+0001ff60: 2720 2020 2020 2020 2025 3473 2026 2025  '        %4s & %
+0001ff70: 3573 2026 2025 7320 2620 2573 2026 2025  5s & %s & %s & %
+0001ff80: 7320 2620 2573 2026 2025 7320 5c5c 5c5c  s & %s & %s \\\\
+0001ff90: 5c6e 270d 0a20 2020 2066 6f72 206e 2069  \n'..    for n i
+0001ffa0: 6e20 7261 6e67 6528 6c65 6e28 6c61 6265  n range(len(labe
+0001ffb0: 6c29 293a 0d0a 2020 2020 2020 2020 6f75  l)):..        ou
+0001ffc0: 7420 2b3d 2066 6d74 2025 2028 6c61 6265  t += fmt % (labe
+0001ffd0: 6c5b 6e5d 2c20 6d75 6c74 5b6e 5d2c 2075  l[n], mult[n], u
+0001ffe0: 5b6e 5d2c 2076 5b6e 5d2c 2077 5b6e 5d2c  [n], v[n], w[n],
+0001fff0: 206f 6363 5b6e 5d2c 2075 6973 6f5b 6e5d   occ[n], uiso[n]
+00020000: 290d 0a20 2020 206f 7574 202b 3d20 2720  )..    out += ' 
+00020010: 2020 2020 2020 205c 5c65 6e64 7b74 6162         \\end{tab
+00020020: 756c 6172 7d5c 6e27 0d0a 2020 2020 6f75  ular}\n'..    ou
+00020030: 7420 2b3d 2027 2020 2020 5c5c 6361 7074  t += '    \\capt
+00020040: 696f 6e7b 2573 2077 6974 6820 2573 2e20  ion{%s with %s. 
+00020050: 2573 7d5c 6e27 2025 2028 6e61 6d65 2c20  %s}\n' % (name, 
+00020060: 6c70 2c20 6578 7472 6129 0d0a 2020 2020  lp, extra)..    
+00020070: 6f75 7420 2b3d 2027 2020 2020 5c5c 6c61  out += '    \\la
+00020080: 6265 6c7b 7461 623a 7d5c 6e27 0d0a 2020  bel{tab:}\n'..  
+00020090: 2020 6f75 7420 2b3d 2027 5c5c 656e 647b    out += '\\end{
+000200a0: 7461 626c 657d 5c6e 270d 0a20 2020 2072  table}\n'..    r
+000200b0: 6574 7572 6e20 6f75 740d 0a0d 0a0d 0a64  eturn out......d
+000200c0: 6566 2064 6574 6563 746f 725f 726f 7461  ef detector_rota
+000200d0: 7465 2864 6574 6563 746f 725f 706f 7369  te(detector_posi
+000200e0: 7469 6f6e 5f6d 6d3d 2830 2c20 3130 3030  tion_mm=(0, 1000
+000200f0: 2e2c 2030 292c 2064 656c 7461 3d30 2e2c  ., 0), delta=0.,
+00020100: 2067 616d 6d61 3d30 2e2c 206c 6162 6d61   gamma=0., labma
+00020110: 7472 6978 3d6e 702e 6579 6528 3329 293a  trix=np.eye(3)):
+00020120: 0d0a 2020 2020 2222 220d 0a20 2020 2052  ..    """..    R
+00020130: 6574 7572 6e20 6120 706f 7369 7469 6f6e  eturn a position
+00020140: 2061 7272 6179 2066 6f72 2061 2076 6563   array for a vec
+00020150: 746f 7220 726f 7461 7465 6420 6279 2064  tor rotated by d
+00020160: 656c 7461 2061 6e64 2067 616d 6d61 2c20  elta and gamma, 
+00020170: 6c69 6b65 2061 2064 6574 6563 746f 7220  like a detector 
+00020180: 616c 6f6e 6720 5b30 2c31 2c30 5d0d 0a20  along [0,1,0].. 
+00020190: 2020 203a 7061 7261 6d20 6465 7465 6374     :param detect
+000201a0: 6f72 5f70 6f73 6974 696f 6e5f 6d6d 3a20  or_position_mm: 
+000201b0: 6465 7465 6374 6f72 2070 6f73 6974 696f  detector positio
+000201c0: 6e20 6672 6f6d 2073 616d 706c 6520 696e  n from sample in
+000201d0: 206d 6d0d 0a20 2020 203a 7061 7261 6d20   mm..    :param 
+000201e0: 6465 6c74 613a 2076 6572 7469 6361 6c20  delta: vertical 
+000201f0: 726f 7461 7469 6f6e 2061 626f 7574 207a  rotation about z
+00020200: 2d61 7869 7320 696e 2044 6567 0d0a 2020  -axis in Deg..  
+00020210: 2020 3a70 6172 616d 2067 616d 6d61 3a20    :param gamma: 
+00020220: 686f 7269 7a6f 6e74 616c 2072 6f74 6174  horizontal rotat
+00020230: 696f 6e20 6162 6f75 7420 782d 6178 6973  ion about x-axis
+00020240: 2069 6e20 4465 670d 0a20 2020 203a 7061   in Deg..    :pa
+00020250: 7261 6d20 6c61 626d 6174 7269 783a 205b  ram labmatrix: [
+00020260: 332a 335d 206f 7269 656e 7461 7469 6f6e  3*3] orientation
+00020270: 206d 6174 7269 7820 746f 2063 6f6e 7665   matrix to conve
+00020280: 7274 2074 6f20 616c 7465 726e 6174 6976  rt to alternativ
+00020290: 6520 6261 7369 730d 0a20 2020 203a 7265  e basis..    :re
+000202a0: 7475 726e 3a20 6172 7261 790d 0a20 2020  turn: array..   
+000202b0: 2022 2222 0d0a 2020 2020 6465 745f 706f   """..    det_po
+000202c0: 7369 7469 6f6e 203d 206e 702e 6172 7261  sition = np.arra
+000202d0: 7928 6465 7465 6374 6f72 5f70 6f73 6974  y(detector_posit
+000202e0: 696f 6e5f 6d6d 290d 0a20 2020 2044 203d  ion_mm)..    D =
+000202f0: 2072 6f74 6d61 7472 6978 7a28 2d64 656c   rotmatrixz(-del
+00020300: 7461 2920 2023 206c 6566 7420 6861 6e64  ta)  # left hand
+00020310: 6564 0d0a 2020 2020 4720 3d20 726f 746d  ed..    G = rotm
+00020320: 6174 7269 7878 2867 616d 6d61 290d 0a20  atrixx(gamma).. 
+00020330: 2020 2052 203d 206e 702e 646f 7428 472c     R = np.dot(G,
+00020340: 2044 290d 0a20 2020 2072 6574 7572 6e20   D)..    return 
+00020350: 6c61 6276 6563 746f 7228 6465 745f 706f  labvector(det_po
+00020360: 7369 7469 6f6e 2c20 523d 522c 204c 4142  sition, R=R, LAB
+00020370: 3d6c 6162 6d61 7472 6978 290d 0a0d 0a0d  =labmatrix).....
+00020380: 0a64 6566 2072 6566 6c65 6374 696f 6e73  .def reflections
+00020390: 5f6f 6e5f 6465 7465 6374 6f72 2871 7871  _on_detector(qxq
+000203a0: 7971 7a2c 2065 6e65 7267 795f 6b65 762c  yqz, energy_kev,
+000203b0: 2064 6574 5f64 6973 7461 6e63 653d 312e   det_distance=1.
+000203c0: 2c20 6465 745f 6e6f 726d 616c 3d28 302c  , det_normal=(0,
+000203d0: 202d 312e 2c20 3029 2c0d 0a20 2020 2020   -1., 0),..     
+000203e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203f0: 2020 2020 2020 2064 656c 7461 3d30 2e2c         delta=0.,
+00020400: 2067 616d 6d61 3d30 2e2c 2064 6574 5f77   gamma=0., det_w
+00020410: 6964 7468 3d31 2e2c 2064 6574 5f68 6569  idth=1., det_hei
+00020420: 6768 743d 312e 2c20 6c61 626d 6174 7269  ght=1., labmatri
+00020430: 783d 6e70 2e65 7965 2833 2929 3a0d 0a20  x=np.eye(3)):.. 
+00020440: 2020 2022 2222 0d0a 2020 2020 5265 7475     """..    Retu
+00020450: 726e 2072 656c 6174 6976 6520 706f 7369  rn relative posi
+00020460: 7469 6f6e 206f 6620 7265 666c 6563 7469  tion of reflecti
+00020470: 6f6e 206f 6e20 6465 7465 6374 6f72 0d0a  on on detector..
+00020480: 2020 2020 3a70 6172 616d 2071 7871 7971      :param qxqyq
+00020490: 7a3a 205b 6e78 335d 2061 7272 6179 206f  z: [nx3] array o
+000204a0: 6620 7265 666c 6563 7469 6f6e 2063 6f6f  f reflection coo
+000204b0: 7264 696e 6174 6573 2069 6e20 512d 7370  rdinates in Q-sp
+000204c0: 6163 6520 5b71 782c 2071 792c 2071 7a5d  ace [qx, qy, qz]
+000204d0: 0d0a 2020 2020 3a70 6172 616d 2065 6e65  ..    :param ene
+000204e0: 7267 795f 6b65 763a 2066 6c6f 6174 2c20  rgy_kev: float, 
+000204f0: 496e 6369 6465 6e74 2062 6561 6d20 656e  Incident beam en
+00020500: 6572 6779 2069 6e20 6b65 560d 0a20 2020  ergy in keV..   
+00020510: 203a 7061 7261 6d20 6465 745f 6469 7374   :param det_dist
+00020520: 616e 6365 3a20 666c 6f61 742c 2044 6574  ance: float, Det
+00020530: 6563 746f 7220 6469 7374 616e 6365 2069  ector distance i
+00020540: 6e20 6d65 7465 7273 0d0a 2020 2020 3a70  n meters..    :p
+00020550: 6172 616d 2064 6574 5f6e 6f72 6d61 6c3a  aram det_normal:
+00020560: 2028 6478 2c64 792c 647a 2920 6469 7265   (dx,dy,dz) dire
+00020570: 6374 696f 6e20 6f66 2064 6574 6563 746f  ction of detecto
+00020580: 7220 6e6f 726d 616c 0d0a 2020 2020 3a70  r normal..    :p
+00020590: 6172 616d 2064 656c 7461 3a20 666c 6f61  aram delta: floa
+000205a0: 742c 2061 6e67 6c65 2069 6e20 6465 6772  t, angle in degr
+000205b0: 6565 7320 696e 2076 6572 7469 6361 6c20  ees in vertical 
+000205c0: 6469 7265 6374 696f 6e20 2861 626f 7574  direction (about
+000205d0: 2064 6966 662d 7a29 0d0a 2020 2020 3a70   diff-z)..    :p
+000205e0: 6172 616d 2067 616d 6d61 3a20 666c 6f61  aram gamma: floa
+000205f0: 7420 616e 676c 6520 696e 2064 6567 7265  t angle in degre
+00020600: 6573 2069 6e20 686f 7269 7a6f 6e74 616c  es in horizontal
+00020610: 2064 6972 6563 7469 6f6e 2028 6162 6f75   direction (abou
+00020620: 7420 6469 6666 2d78 290d 0a20 2020 203a  t diff-x)..    :
+00020630: 7061 7261 6d20 6465 745f 7769 6474 683a  param det_width:
+00020640: 2066 6c6f 6174 2c20 6465 7465 6374 6f72   float, detector
+00020650: 2077 6964 7468 2061 6c6f 6e67 2078 2d61   width along x-a
+00020660: 7869 7320 696e 206d 6574 6572 730d 0a20  xis in meters.. 
+00020670: 2020 203a 7061 7261 6d20 6465 745f 6865     :param det_he
+00020680: 6967 6874 3a20 666c 6f61 742c 2064 6574  ight: float, det
+00020690: 6563 746f 7220 6865 6967 6874 2061 6c6f  ector height alo
+000206a0: 6e67 207a 2d61 7869 7320 696e 206d 6574  ng z-axis in met
+000206b0: 6572 730d 0a20 2020 203a 7061 7261 6d20  ers..    :param 
+000206c0: 6c61 626d 6174 7269 783a 205b 3378 335d  labmatrix: [3x3]
+000206d0: 206f 7269 656e 7461 7469 6f6e 2061 7272   orientation arr
+000206e0: 6179 2074 6f20 636f 6e76 6572 7420 746f  ay to convert to
+000206f0: 2064 6966 6665 7265 6e63 6520 6261 7369   difference basi
+00020700: 730d 0a20 2020 203a 7265 7475 726e 2075  s..    :return u
+00020710: 7677 3a20 5b6e 7833 5d20 6172 7261 7920  vw: [nx3] array 
+00020720: 6f66 2070 6f73 6974 696f 6e73 2072 656c  of positions rel
+00020730: 6174 6976 6520 746f 2074 6865 2063 656e  ative to the cen
+00020740: 7472 6520 6f66 2074 6865 2064 6574 6563  tre of the detec
+00020750: 746f 722c 206f 7220 4e61 4e20 6966 206e  tor, or NaN if n
+00020760: 6f74 2069 6e63 6964 656e 740d 0a20 2020  ot incident..   
+00020770: 203a 7265 7475 726e 2077 6176 6576 6563   :return wavevec
+00020780: 746f 725f 6469 6666 6572 656e 6365 3a20  tor_difference: 
+00020790: 5b6e 5d20 6172 7261 7920 6f66 2077 6176  [n] array of wav
+000207a0: 6576 6563 746f 7220 6469 6666 6572 656e  evector differen
+000207b0: 6365 2069 6e20 412d 310d 0a20 2020 2022  ce in A-1..    "
+000207c0: 2222 0d0a 0d0a 2020 2020 2320 4c61 7474  ""....    # Latt
+000207d0: 6963 650d 0a20 2020 2071 203d 206e 702e  ice..    q = np.
+000207e0: 7265 7368 6170 6528 7178 7179 717a 2c20  reshape(qxqyqz, 
+000207f0: 5b2d 312c 2033 5d29 0d0a 2020 2020 6b20  [-1, 3])..    k 
+00020800: 3d20 7761 7665 7665 6374 6f72 2865 6e65  = wavevector(ene
+00020810: 7267 795f 6b65 7629 0d0a 2020 2020 6b69  rgy_kev)..    ki
+00020820: 203d 206b 202a 206c 6162 7665 6374 6f72   = k * labvector
+00020830: 285b 302c 2031 2c20 305d 2c20 4c41 423d  ([0, 1, 0], LAB=
+00020840: 6c61 626d 6174 7269 7829 0d0a 2020 2020  labmatrix)..    
+00020850: 6b66 203d 2071 202b 206b 690d 0a20 2020  kf = q + ki..   
+00020860: 206b 665f 6469 7265 6374 696f 6e73 203d   kf_directions =
+00020870: 2066 672e 6e6f 726d 286b 6629 0d0a 2020   fg.norm(kf)..  
+00020880: 2020 7776 5f64 6966 6665 7265 6e63 6520    wv_difference 
+00020890: 3d20 7761 7665 7665 6374 6f72 5f64 6966  = wavevector_dif
+000208a0: 6665 7265 6e63 6528 712c 206b 6929 2020  ference(q, ki)  
+000208b0: 2320 6469 6666 6572 656e 6365 2069 6e20  # difference in 
+000208c0: 412d 310d 0a0d 0a20 2020 2023 2044 6574  A-1....    # Det
+000208d0: 6563 746f 7220 6261 7369 730d 0a20 2020  ector basis..   
+000208e0: 2064 6574 5f70 6f73 6974 696f 6e20 3d20   det_position = 
+000208f0: 6465 745f 6469 7374 616e 6365 202a 206e  det_distance * n
+00020900: 702e 6172 7261 7928 5b30 2c20 312e 2c20  p.array([0, 1., 
+00020910: 305d 290d 0a20 2020 2064 6574 5f6e 6f72  0])..    det_nor
+00020920: 6d61 6c20 3d20 6667 2e6e 6f72 6d28 6465  mal = fg.norm(de
+00020930: 745f 6e6f 726d 616c 290d 0a20 2020 2064  t_normal)..    d
+00020940: 6574 5f78 5f61 7869 7320 3d20 6465 745f  et_x_axis = det_
+00020950: 7769 6474 6820 2a20 6667 2e6e 6f72 6d28  width * fg.norm(
+00020960: 6e70 2e63 726f 7373 2864 6574 5f6e 6f72  np.cross(det_nor
+00020970: 6d61 6c2c 2028 302c 2030 2c20 312e 2929  mal, (0, 0, 1.))
+00020980: 290d 0a20 2020 2064 6574 5f7a 5f61 7869  )..    det_z_axi
+00020990: 7320 3d20 6465 745f 6865 6967 6874 202a  s = det_height *
+000209a0: 2066 672e 6e6f 726d 286e 702e 6372 6f73   fg.norm(np.cros
+000209b0: 7328 6465 745f 785f 6178 6973 2c20 6465  s(det_x_axis, de
+000209c0: 745f 6e6f 726d 616c 2929 0d0a 0d0a 2020  t_normal))....  
+000209d0: 2020 2320 4465 7465 6374 6f72 2072 6f74    # Detector rot
+000209e0: 6174 696f 6e0d 0a20 2020 2044 203d 2072  ation..    D = r
+000209f0: 6f74 6d61 7472 6978 7a28 2d64 656c 7461  otmatrixz(-delta
+00020a00: 2920 2023 206c 6566 7420 6861 6e64 6564  )  # left handed
+00020a10: 0d0a 2020 2020 4720 3d20 726f 746d 6174  ..    G = rotmat
+00020a20: 7269 7878 2867 616d 6d61 290d 0a20 2020  rixx(gamma)..   
+00020a30: 2052 203d 206e 702e 646f 7428 472c 2044   R = np.dot(G, D
+00020a40: 290d 0a20 2020 2064 6574 5f70 6f73 6974  )..    det_posit
+00020a50: 696f 6e20 3d20 6c61 6276 6563 746f 7228  ion = labvector(
+00020a60: 6465 745f 706f 7369 7469 6f6e 2c20 523d  det_position, R=
+00020a70: 522c 204c 4142 3d6c 6162 6d61 7472 6978  R, LAB=labmatrix
+00020a80: 290d 0a20 2020 2064 6574 5f6e 6f72 6d61  )..    det_norma
+00020a90: 6c20 3d20 6c61 6276 6563 746f 7228 6465  l = labvector(de
+00020aa0: 745f 6e6f 726d 616c 2c20 523d 522c 204c  t_normal, R=R, L
+00020ab0: 4142 3d6c 6162 6d61 7472 6978 290d 0a20  AB=labmatrix).. 
+00020ac0: 2020 2064 6574 5f78 5f61 7869 7320 3d20     det_x_axis = 
+00020ad0: 6c61 6276 6563 746f 7228 6465 745f 785f  labvector(det_x_
+00020ae0: 6178 6973 2c20 523d 522c 204c 4142 3d6c  axis, R=R, LAB=l
+00020af0: 6162 6d61 7472 6978 290d 0a20 2020 2064  abmatrix)..    d
+00020b00: 6574 5f7a 5f61 7869 7320 3d20 6c61 6276  et_z_axis = labv
+00020b10: 6563 746f 7228 6465 745f 7a5f 6178 6973  ector(det_z_axis
+00020b20: 2c20 523d 522c 204c 4142 3d6c 6162 6d61  , R=R, LAB=labma
+00020b30: 7472 6978 290d 0a0d 0a20 2020 2023 2044  trix)....    # D
+00020b40: 6574 6563 746f 7220 636f 726e 6572 730d  etector corners.
+00020b50: 0a20 2020 2064 6574 5f63 6f72 6e65 7273  .    det_corners
+00020b60: 203d 206e 702e 6172 7261 7928 5b0d 0a20   = np.array([.. 
+00020b70: 2020 2020 2020 2064 6574 5f70 6f73 6974         det_posit
+00020b80: 696f 6e20 2b20 6465 745f 785f 6178 6973  ion + det_x_axis
+00020b90: 202f 2032 202b 2064 6574 5f7a 5f61 7869   / 2 + det_z_axi
+00020ba0: 7320 2f20 322c 0d0a 2020 2020 2020 2020  s / 2,..        
+00020bb0: 6465 745f 706f 7369 7469 6f6e 202b 2064  det_position + d
+00020bc0: 6574 5f78 5f61 7869 7320 2f20 3220 2d20  et_x_axis / 2 - 
+00020bd0: 6465 745f 7a5f 6178 6973 202f 2032 2c0d  det_z_axis / 2,.
+00020be0: 0a20 2020 2020 2020 2064 6574 5f70 6f73  .        det_pos
+00020bf0: 6974 696f 6e20 2d20 6465 745f 785f 6178  ition - det_x_ax
+00020c00: 6973 202f 2032 202d 2064 6574 5f7a 5f61  is / 2 - det_z_a
+00020c10: 7869 7320 2f20 322c 0d0a 2020 2020 2020  xis / 2,..      
+00020c20: 2020 6465 745f 706f 7369 7469 6f6e 202d    det_position -
+00020c30: 2064 6574 5f78 5f61 7869 7320 2f20 3220   det_x_axis / 2 
+00020c40: 2b20 6465 745f 7a5f 6178 6973 202f 2032  + det_z_axis / 2
+00020c50: 2c0d 0a20 2020 205d 290d 0a0d 0a20 2020  ,..    ])....   
+00020c60: 2023 2052 6566 6c65 6374 696f 6e20 6469   # Reflection di
+00020c70: 7265 6374 696f 6e20 6e65 6172 2064 6574  rection near det
+00020c80: 6563 746f 720d 0a20 2020 2063 6f72 6e65  ector..    corne
+00020c90: 725f 616e 676c 6520 3d20 6d61 7828 6162  r_angle = max(ab
+00020ca0: 7328 6667 2e76 6563 746f 7273 5f61 6e67  s(fg.vectors_ang
+00020cb0: 6c65 5f64 6567 7265 6573 2864 6574 5f70  le_degrees(det_p
+00020cc0: 6f73 6974 696f 6e2c 2064 6574 5f63 6f72  osition, det_cor
+00020cd0: 6e65 7273 2929 290d 0a20 2020 2072 6566  ners)))..    ref
+00020ce0: 5f61 6e67 6c65 7320 3d20 6162 7328 6667  _angles = abs(fg
+00020cf0: 2e76 6563 746f 7273 5f61 6e67 6c65 5f64  .vectors_angle_d
+00020d00: 6567 7265 6573 2864 6574 5f70 6f73 6974  egrees(det_posit
+00020d10: 696f 6e2c 206b 665f 6469 7265 6374 696f  ion, kf_directio
+00020d20: 6e73 2929 0d0a 2020 2020 6368 6563 6b20  ns))..    check 
+00020d30: 3d20 7265 665f 616e 676c 6573 203c 2063  = ref_angles < c
+00020d40: 6f72 6e65 725f 616e 676c 650d 0a0d 0a20  orner_angle.... 
+00020d50: 2020 2023 2052 6566 6c65 6374 696f 6e20     # Reflection 
+00020d60: 6469 7265 6374 696f 6e20 696e 6369 6465  direction incide
+00020d70: 6e74 206f 6e20 6465 7465 6374 6f72 0d0a  nt on detector..
+00020d80: 2020 2020 696e 6369 6465 6e74 5f78 797a      incident_xyz
+00020d90: 203d 206e 702e 6e61 6e20 2a20 6e70 2e7a   = np.nan * np.z
+00020da0: 6572 6f73 285b 6c65 6e28 6b66 5f64 6972  eros([len(kf_dir
+00020db0: 6563 7469 6f6e 7329 2c20 335d 290d 0a20  ections), 3]).. 
+00020dc0: 2020 2066 6f72 206e 2069 6e20 6e70 2e66     for n in np.f
+00020dd0: 6c61 746e 6f6e 7a65 726f 2863 6865 636b  latnonzero(check
+00020de0: 293a 0d0a 2020 2020 2020 2020 696e 6369  ):..        inci
+00020df0: 6465 6e74 5f78 797a 5b6e 5d20 3d20 6667  dent_xyz[n] = fg
+00020e00: 2e70 6c61 6e65 5f69 6e74 6572 7365 6374  .plane_intersect
+00020e10: 696f 6e28 2830 2c20 302c 2030 292c 206b  ion((0, 0, 0), k
+00020e20: 665f 6469 7265 6374 696f 6e73 5b6e 5d2c  f_directions[n],
+00020e30: 2064 6574 5f70 6f73 6974 696f 6e2c 2064   det_position, d
+00020e40: 6574 5f6e 6f72 6d61 6c29 0d0a 0d0a 2020  et_normal)....  
+00020e50: 2020 2320 5265 6c61 7469 7665 2070 6f73    # Relative pos
+00020e60: 6974 696f 6e20 6f6e 2064 6574 6563 746f  ition on detecto
+00020e70: 720d 0a20 2020 2069 6e63 6964 656e 745f  r..    incident_
+00020e80: 7576 7720 3d20 6667 2e69 6e64 6578 5f63  uvw = fg.index_c
+00020e90: 6f6f 7264 696e 6174 6573 2869 6e63 6964  oordinates(incid
+00020ea0: 656e 745f 7879 7a20 2d20 6465 745f 706f  ent_xyz - det_po
+00020eb0: 7369 7469 6f6e 2c20 5b64 6574 5f78 5f61  sition, [det_x_a
+00020ec0: 7869 732c 2064 6574 5f7a 5f61 7869 732c  xis, det_z_axis,
+00020ed0: 2064 6574 5f6e 6f72 6d61 6c5d 290d 0a20   det_normal]).. 
+00020ee0: 2020 2069 6e63 6964 656e 745f 7576 775b     incident_uvw[
+00020ef0: 6e70 2e61 6e79 2861 6273 2869 6e63 6964  np.any(abs(incid
+00020f00: 656e 745f 7576 7729 203e 2030 2e35 2c20  ent_uvw) > 0.5, 
+00020f10: 6178 6973 3d31 295d 203d 205b 6e70 2e6e  axis=1)] = [np.n
+00020f20: 616e 2c20 6e70 2e6e 616e 2c20 6e70 2e6e  an, np.nan, np.n
+00020f30: 616e 5d0d 0a20 2020 2072 6574 7572 6e20  an]..    return 
+00020f40: 696e 6369 6465 6e74 5f75 7677 2c20 7776  incident_uvw, wv
+00020f50: 5f64 6966 6665 7265 6e63 650d 0a0d 0a0d  _difference.....
+00020f60: 0a64 6566 2070 6561 6b73 5f6f 6e5f 706c  .def peaks_on_pl
+00020f70: 616e 6528 7065 616b 5f78 2c20 7065 616b  ane(peak_x, peak
+00020f80: 5f79 2c20 7065 616b 5f68 6569 6768 742c  _y, peak_height,
+00020f90: 2070 6561 6b5f 7769 6474 682c 206d 6178   peak_width, max
+00020fa0: 5f78 2c20 6d61 785f 792c 2070 6978 656c  _x, max_y, pixel
+00020fb0: 735f 7769 6474 683d 3130 3031 2c20 6261  s_width=1001, ba
+00020fc0: 636b 6772 6f75 6e64 3d30 293a 0d0a 2020  ckground=0):..  
+00020fd0: 2020 2222 220d 0a20 2020 2043 7265 6174    """..    Creat
+00020fe0: 6573 2061 2072 6563 7461 6e67 756c 6172  es a rectangular
+00020ff0: 2067 7269 6420 616e 6420 6164 6473 2047   grid and adds G
+00021000: 6175 7373 6961 6e20 7065 616b 7320 7769  aussian peaks wi
+00021010: 7468 2068 6569 6768 7420 2269 6e74 656e  th height "inten
+00021020: 7369 7479 220d 0a20 2020 203a 7061 7261  sity"..    :para
+00021030: 6d20 7065 616b 5f78 3a20 5b6e 7831 5d20  m peak_x: [nx1] 
+00021040: 6172 7261 7920 6f66 2078 2063 6f6f 7264  array of x coord
+00021050: 696e 6174 6573 0d0a 2020 2020 3a70 6172  inates..    :par
+00021060: 616d 2070 6561 6b5f 793a 205b 6e78 315d  am peak_y: [nx1]
+00021070: 2061 7272 6179 206f 6620 7920 636f 6f72   array of y coor
+00021080: 6469 6e61 7465 730d 0a20 2020 203a 7061  dinates..    :pa
+00021090: 7261 6d20 7065 616b 5f68 6569 6768 743a  ram peak_height:
+000210a0: 205b 6e78 315d 2061 7272 6179 206f 6620   [nx1] array of 
+000210b0: 7065 616b 2068 6569 6768 7473 0d0a 2020  peak heights..  
+000210c0: 2020 3a70 6172 616d 2070 6561 6b5f 7769    :param peak_wi
+000210d0: 6474 683a 205b 6e78 315d 206f 7220 666c  dth: [nx1] or fl
+000210e0: 6f61 742c 2067 6175 7373 6961 6e20 7769  oat, gaussian wi
+000210f0: 6474 680d 0a20 2020 203a 7061 7261 6d20  dth..    :param 
+00021100: 6d61 785f 783a 2067 7269 6420 7769 6c6c  max_x: grid will
+00021110: 2062 6520 6372 6561 7465 6420 6672 6f6d   be created from
+00021120: 202d 6d61 785f 7820 3a20 2b6d 6178 5f78   -max_x : +max_x
+00021130: 2068 6f72 697a 6f6e 7461 6c6c 790d 0a20   horizontally.. 
+00021140: 2020 203a 7061 7261 6d20 6d61 785f 793a     :param max_y:
+00021150: 2067 7269 6420 7769 6c6c 2062 6520 6372   grid will be cr
+00021160: 6561 7465 6420 6672 6f6d 202d 6d61 785f  eated from -max_
+00021170: 7920 3a20 2b6d 6178 5f79 2076 6572 7469  y : +max_y verti
+00021180: 6361 6c6c 790d 0a20 2020 203a 7061 7261  cally..    :para
+00021190: 6d20 7069 7865 6c73 5f77 6964 7468 3a20  m pixels_width: 
+000211a0: 6772 6964 2077 696c 6c20 636f 6e74 6169  grid will contai
+000211b0: 6e20 7069 7865 6c73 2068 6f72 697a 6f6e  n pixels horizon
+000211c0: 7461 6c6c 7920 616e 6420 7468 6520 6e75  tally and the nu
+000211d0: 6d62 6572 2076 6572 7469 6361 6c6c 7920  mber vertically 
+000211e0: 7769 6c6c 2062 6520 7363 616c 6564 0d0a  will be scaled..
+000211f0: 2020 2020 3a70 6172 616d 2062 6163 6b67      :param backg
+00021200: 726f 756e 643a 2069 6620 3e30 2c20 6164  round: if >0, ad
+00021210: 6420 6120 6e6f 726d 616c 7920 6469 7374  d a normaly dist
+00021220: 7269 6275 7465 6420 6261 636b 6772 6f75  ributed backgrou
+00021230: 6e64 2077 6974 6820 6176 6572 6167 6520  nd with average 
+00021240: 6c65 7665 6c20 3d20 6261 636b 6772 6f75  level = backgrou
+00021250: 6e64 0d0a 2020 2020 3a72 6574 7572 6e3a  nd..    :return:
+00021260: 2078 2c20 792c 2070 6c61 6e65 0d0a 2020   x, y, plane..  
+00021270: 2020 2222 220d 0a20 2020 2023 2063 7265    """..    # cre
+00021280: 6174 6520 706c 6f74 7469 6e67 206d 6573  ate plotting mes
+00021290: 680d 0a20 2020 2070 6978 656c 735f 6865  h..    pixels_he
+000212a0: 6967 6874 203d 2069 6e74 2870 6978 656c  ight = int(pixel
+000212b0: 735f 7769 6474 6820 2a20 6d61 785f 7920  s_width * max_y 
+000212c0: 2f20 6d61 785f 7829 0d0a 2020 2020 6d65  / max_x)..    me
+000212d0: 7368 203d 206e 702e 7a65 726f 7328 5b70  sh = np.zeros([p
+000212e0: 6978 656c 735f 6865 6967 6874 2c20 7069  ixels_height, pi
+000212f0: 7865 6c73 5f77 6964 7468 5d29 0d0a 2020  xels_width])..  
+00021300: 2020 6d65 7368 5f78 203d 206e 702e 6c69    mesh_x = np.li
+00021310: 6e73 7061 6365 282d 6d61 785f 782c 206d  nspace(-max_x, m
+00021320: 6178 5f78 2c20 7069 7865 6c73 5f77 6964  ax_x, pixels_wid
+00021330: 7468 290d 0a20 2020 206d 6573 685f 7920  th)..    mesh_y 
+00021340: 3d20 6e70 2e6c 696e 7370 6163 6528 2d6d  = np.linspace(-m
+00021350: 6178 5f79 2c20 6d61 785f 792c 2070 6978  ax_y, max_y, pix
+00021360: 656c 735f 6865 6967 6874 290d 0a20 2020  els_height)..   
+00021370: 2078 782c 2079 7920 3d20 6e70 2e6d 6573   xx, yy = np.mes
+00021380: 6867 7269 6428 6d65 7368 5f78 2c20 6d65  hgrid(mesh_x, me
+00021390: 7368 5f79 290d 0a20 2020 2023 2063 6173  sh_y)..    # cas
+000213a0: 7420 666c 6f61 7420 7065 616b 5f77 6964  t float peak_wid
+000213b0: 7468 2074 6f20 6172 7261 790d 0a20 2020  th to array..   
+000213c0: 2070 6561 6b5f 7769 6474 6820 3d20 6e70   peak_width = np
+000213d0: 2e61 7361 7272 6179 2870 6561 6b5f 7769  .asarray(peak_wi
+000213e0: 6474 6829 202a 206e 702e 6f6e 6573 5f6c  dth) * np.ones_l
+000213f0: 696b 6528 7065 616b 5f68 6569 6768 7429  ike(peak_height)
+00021400: 0d0a 0d0a 2020 2020 666f 7220 6e20 696e  ....    for n in
+00021410: 2072 616e 6765 286c 656e 2870 6561 6b5f   range(len(peak_
+00021420: 6865 6967 6874 2929 3a0d 0a20 2020 2020  height)):..     
+00021430: 2020 2023 2041 6464 2065 6163 6820 7265     # Add each re
+00021440: 666c 6563 7469 6f6e 2061 7320 6120 6761  flection as a ga
+00021450: 7573 7369 616e 0d0a 2020 2020 2020 2020  ussian..        
+00021460: 6d65 7368 202b 3d20 7065 616b 5f68 6569  mesh += peak_hei
+00021470: 6768 745b 6e5d 202a 206e 702e 6578 7028  ght[n] * np.exp(
+00021480: 2d6e 702e 6c6f 6728 3229 202a 2028 2828  -np.log(2) * (((
+00021490: 7878 202d 2070 6561 6b5f 785b 6e5d 2920  xx - peak_x[n]) 
+000214a0: 2a2a 2032 202b 2028 7979 202d 2070 6561  ** 2 + (yy - pea
+000214b0: 6b5f 795b 6e5d 2920 2a2a 2032 2920 2f20  k_y[n]) ** 2) / 
+000214c0: 2870 6561 6b5f 7769 6474 685b 6e5d 202f  (peak_width[n] /
+000214d0: 2032 2920 2a2a 2032 2929 0d0a 0d0a 2020   2) ** 2))....  
+000214e0: 2020 2320 4164 6420 6261 636b 6772 6f75    # Add backgrou
+000214f0: 6e64 2028 6966 206e 6f74 204e 6f6e 6520  nd (if not None 
+00021500: 6f72 2030 290d 0a20 2020 2069 6620 6261  or 0)..    if ba
+00021510: 636b 6772 6f75 6e64 3a0d 0a20 2020 2020  ckground:..     
+00021520: 2020 2062 6b67 203d 206e 702e 7261 6e64     bkg = np.rand
+00021530: 6f6d 2e6e 6f72 6d61 6c28 6261 636b 6772  om.normal(backgr
+00021540: 6f75 6e64 2c20 6e70 2e73 7172 7428 6261  ound, np.sqrt(ba
+00021550: 636b 6772 6f75 6e64 292c 206d 6573 682e  ckground), mesh.
+00021560: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+00021570: 6d65 7368 203d 206d 6573 6820 2b20 626b  mesh = mesh + bk
+00021580: 670d 0a0d 0a20 2020 2072 6574 7572 6e20  g....    return 
+00021590: 7878 2c20 7979 2c20 6d65 7368 0d0a 0d0a  xx, yy, mesh....
+000215a0: 0d0a 6465 6620 7363 616c 655f 696e 7465  ..def scale_inte
+000215b0: 6e73 6974 7928 696e 7465 6e73 6974 792c  nsity(intensity,
+000215c0: 2077 6176 6576 6563 746f 725f 6469 6666   wavevector_diff
+000215d0: 2c20 7265 736f 6c75 7469 6f6e 3d30 2e35  , resolution=0.5
+000215e0: 293a 0d0a 2020 2020 2222 220d 0a20 2020  ):..    """..   
+000215f0: 2053 6361 6c65 2069 6e74 656e 7369 7479   Scale intensity
+00021600: 2064 6570 656e 6469 6e67 206f 6e20 7761   depending on wa
+00021610: 7665 7665 6374 6f72 2064 6966 6665 7265  vevector differe
+00021620: 6e63 6520 616e 6420 7265 736f 6c75 7469  nce and resoluti
+00021630: 6f6e 0d0a 2020 2020 3a70 6172 616d 2069  on..    :param i
+00021640: 6e74 656e 7369 7479 3a20 696e 7465 6e73  ntensity: intens
+00021650: 6974 7920 7661 6c75 650d 0a20 2020 203a  ity value..    :
+00021660: 7061 7261 6d20 7761 7665 7665 6374 6f72  param wavevector
+00021670: 5f64 6966 663a 2064 6973 7461 6e63 6520  _diff: distance 
+00021680: 6672 6f6d 2063 656e 7472 6520 696e 2069  from centre in i
+00021690: 6e76 6572 7365 2061 6e67 7374 726f 6d73  nverse angstroms
+000216a0: 0d0a 2020 2020 3a70 6172 616d 2072 6573  ..    :param res
+000216b0: 6f6c 7574 696f 6e3a 2072 6573 6f6c 7574  olution: resolut
+000216c0: 696f 6e20 696e 2069 6e76 6572 7365 2061  ion in inverse a
+000216d0: 6e67 7374 726f 6d73 0d0a 2020 2020 3a72  ngstroms..    :r
+000216e0: 6574 7572 6e3a 0d0a 2020 2020 2222 220d  eturn:..    """.
+000216f0: 0a20 2020 2072 6574 7572 6e20 696e 7465  .    return inte
+00021700: 6e73 6974 7920 2a20 6e70 2e65 7870 282d  nsity * np.exp(-
+00021710: 6e70 2e6c 6f67 2832 2920 2a20 2877 6176  np.log(2) * (wav
+00021720: 6576 6563 746f 725f 6469 6666 202f 2028  evector_diff / (
+00021730: 302e 3520 2a20 7265 736f 6c75 7469 6f6e  0.5 * resolution
+00021740: 2929 202a 2a20 3229 0d0a 0d0a            )) ** 2)....
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/functions_general.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/functions_general.py`

 * *Files 1% similar despite different names*

```diff
@@ -31,27 +31,28 @@
 @author: DGPorter
 """
 
 import sys, os, re
 import numpy as np
 import inspect
 
-__version__ = '2.2.0'
-__date__ = '11/March/2022'
+__version__ = '2.2.1'
+__date__ = '01/June/2023'
 
 # File directory
 directory = os.path.abspath(os.path.dirname(__file__))
 
 # Constants
 pi = np.pi  # mmmm tasty Pi
 e = 1.6021733E-19  # C  electron charge
 h = 6.62606868E-34  # Js  Plank consant
 c = 299792458  # m/s   Speed of light
 u0 = 4 * pi * 1e-7  # H m-1 Magnetic permeability of free space
 me = 9.109e-31  # kg Electron rest mass
+mn = 1.6749e-27 # kg Neutron rest mass
 Na = 6.022e23  # Avagadro's No
 A = 1e-10  # m Angstrom
 r0 = 2.8179403227e-15  # m classical electron radius = e^2/(4pi*e0*me*c^2)
 Cu = 8.048  # Cu-Ka emission energy, keV
 Mo = 17.4808  # Mo-Ka emission energy, keV
 # Mo = 17.4447 # Mo emission energy, keV
 
@@ -153,14 +154,33 @@
     sinang = quadmag(np.cross(a, b))
     angle = np.arctan2(sinang, cosang)
     if deg:
         return np.rad2deg(angle)
     return angle
 
 
+def vectors_angle_degrees(a, b):
+    """
+    Returns the angle, in degrees between vectors a and b.
+    Gives the absolute angle, negatives are not given for sectors.
+        angle = acos(a.b / |a|.|b|)
+    :param a: [nx3] array of vectors [x,y,z]
+    :param b: [mx3] array of vectors [x,y,z]
+    :return: float angle in degrees is n==m==1
+    :return: [max(n, m)] array of angles in degrees if n or m == 1
+    :return: [n, m] array of angles in degrees if n and m > 1
+    """
+    a = np.asarray(a, dtype=float).reshape([-1, 3])
+    b = np.asarray(b, dtype=float).reshape([-1, 3])
+
+    cosang = np.squeeze(np.dot(a, b.T))
+    sinang = np.squeeze([quadmag(np.cross(a, bb)) for bb in b]).T  # more efficient with larger len(a) and len(b)
+    return np.rad2deg(np.arctan2(sinang, cosang))
+
+
 def cart2sph(xyz, deg=False):
     """
     Convert coordinates in cartesian to coordinates in spherical
     https://en.wikipedia.org/wiki/Spherical_coordinate_system
     ISO convention used.
         theta = angle from Z-axis to X-axis
           phi = angle from X-axis to component in XY plane
@@ -866,14 +886,22 @@
             x += 2
         else:
             out += ['{}{}{}{}{}'.format(stt[x], sep, stp[x], sep, stt[x + 1])]
             x += 2
     return ','.join(out)
 
 
+def str2array(string):
+    """Convert string to array"""
+    string = string.replace(',', ' ')  # remove commas
+    string = string.replace('(', '').replace(')', '')  # remove brackets
+    string = string.replace('[', '').replace(']', '')  # remove brackets
+    return np.fromstring(string, sep=' ')
+
+
 def numbers2string(scannos, sep=':'):
     """
     Convert a list of numbers to a simple string
     E.G.
     numbers2string([50001,50002,50003]) = '5000[1:3]'
     numbers2string([51020,51030,51040]) = '510[20:10:40]'
     """
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/functions_plotting.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/functions_plotting.py`

 * *Files 1% similar despite different names*

```diff
@@ -910,14 +910,34 @@
     transmission = fc.molecular_attenuation_length(chemical_formula, energy_range, density, grazing_angle)
     ttl = '%s Density=%5.3f, Angle=%3.3g deg' % (chemical_formula, density, grazing_angle)
 
     newplot(energy_range, transmission)
     labels(ttl, 'Energy [keV]', 'Atten Length [μm]')
 
 
+def plot_xray_reflectivity(chemical_formula, density=8.9, energy_range=None, grazing_angle=2):
+    """
+    Plot the specular reflectivity of a material
+    From: https://xdb.lbl.gov/Section4/Sec_4-2.html
+    :param chemical_formula: str molecular formula
+    :param density: float, density in g/cm^3
+    :param energy_range: float or array, x-ray energy in keV
+    :param grazing_angle: float, incidence angle relative to the surface, in degrees
+    :return: float or array
+    """
+    if energy_range is None:
+        energy_range = np.arange(0.03, 20, 0.01)
+
+    reflectivity = fc.molecular_reflectivity(chemical_formula, energy_range, density, grazing_angle)
+    ttl = '%s Density=%5.3f, Angle=%3.3g deg' % (chemical_formula, density, grazing_angle)
+
+    newplot(energy_range, reflectivity)
+    labels(ttl, 'Energy [keV]', 'Atten Length [μm]')
+
+
 def plot_xray_refractive_index(chemical_formula, density=8.9, energy_range=None):
     """
     Plot the Complex Index of Refraction of a compound
         n = 1 - (1/2pi)N*r0*lambda^2*(f1+if2) = 1 - Delta - iBeta
     Equivalent to: https://henke.lbl.gov/optical_constants/getdb2.html
     Based on formulas from: Henke, Gullikson, and Davis, Atomic Data and Nuclear Data Tables 54 no.2, 181-342 (July 1993)
     :param chemical_formula: str molecular formula
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/functions_scattering.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/functions_scattering.py`

 * *Files 1% similar despite different names*

```diff
@@ -63,15 +63,16 @@
 SCATTERING_TYPES = {
     'xray': ['xray', 'x', 'x-ray', 'thomson', 'charge'],
     'xray fast': ['xray fast', 'xfast'],
     'neutron': ['neutron', 'n', 'nuclear'],
     'xray magnetic': ['xray magnetic', 'magnetic xray', 'spin xray', 'xray spin'],
     'neutron magnetic': ['neutron magnetic', 'magnetic neutron', 'magnetic'],
     'xray resonant': ['xray resonant', 'resonant', 'resonant xray', 'rxs'],
-    'xray dispersion': ['dispersion', 'xray dispersion']
+    'xray dispersion': ['dispersion', 'xray dispersion'],
+    'electron': ['electron', 'ele', 'e'],
 }
 
 
 def _debug(message):
     if DEBUG_MODE:
         print(message)
 
@@ -808,14 +809,16 @@
         return sf_atom
     if scattering_type in SCATTERING_TYPES['xray fast']:
         return sf_atom
     if scattering_type in SCATTERING_TYPES['xray dispersion']:
         return sf_xray_dispersion
     if scattering_type in SCATTERING_TYPES['neutron']:
         return sf_atom
+    if scattering_type in SCATTERING_TYPES['electron']:
+        return sf_atom
     if scattering_type in SCATTERING_TYPES['xray magnetic']:
         return sf_magnetic_xray
     if scattering_type in SCATTERING_TYPES['neutron magnetic']:
         return sf_magnetic_neutron
     if scattering_type in SCATTERING_TYPES['xray resonant']:
         return sf_magnetic_xray_resonant
     raise(Exception('Scattering name %s not recognised' % scattering_type))
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/multiple_scattering.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/multiple_scattering.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tensor_scattering.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tensor_scattering.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/__init__.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/__init__.py`

 * *Files 18% similar despite different names*

```diff
@@ -6,29 +6,31 @@
   Requires:
       numpy, matplotlib, tkinter
 
 By Dan Porter, PhD
 Diamond
 2019
 
-Version 2.3.0
-Last updated: 26/01/21
+Version 3.0.0
+Last updated: 25/06/23
 
 Version History:
 10/11/17 0.1    Program created
 23/02/19 1.0    Finished the basic program and gave it colours
 09/03/19 1.1    Added properties, superstructure, other improvements
 13/07/19 1.2    Added FDMNES windows
 13/12/19 2.0    Changed to internal tkgui package
 19/04/20 2.1    Added multi-crystal, write-cif buttons, changed layout of scattering gui
 27/04/20 2.2    Added SelectionBox to basic_widgets and spacegroup entry to SymmetryGui
 15/10/20 2.2.1  Slight correction to SymmetryGui - no longer adds 'm' to labels
 21/01/21 2.2.2  Added 'xray dispersion' scattering option
 26/01/21 2.3.0  Refactored properites into new file, added x-ray interactions GUI
+16/05/23 2.4.0  Added periodic_table.py and added menu items to CrystalGUI. Changed default fonts and colours
+25/06/23 3.0.0  Added new GUI elements including new Scattering UI, diffractomter simulator, unit converter
 
 @author: DGPorter
 """
 
 from .crystal import CrystalGui
 
-__version__ = '2.3.0'
-__date__ = '26/01/20'
+__version__ = '3.0.0'
+__date__ = '25/06/23'
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/basic_widgets.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/periodic_table.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,249 +1,301 @@
 """
-Basic widgets and gui parameters
-"""
-
-import sys
+TKinter GUI to select element from Periodic table of elementsDans Element Properties.txt
 
-if sys.version_info[0] < 3:
-    import Tkinter as tk
-else:
-    import tkinter as tk
-
-# Fonts
-TF = ["Times", 12]
-BF = ["Times", 14]
-SF = ["Times New Roman", 14]
-LF = ["Times", 14]
-MF = ["Courier", 8]  # fixed distance format
-HF = ['Courier',12]
-TTF = ("Helvetica", 10, "bold italic")
-# Colours - background
-bkg = 'snow'
-ety = 'white'
-btn = 'azure' #'light slate blue'
-opt = 'azure' #'light slate blue'
-btn2 = 'gold'
-TTBG = 'light grey'
-# Colours - active
-btn_active = 'grey'
-opt_active = 'grey'
-# Colours - Fonts
-txtcol = 'black'
-btn_txt = 'black'
-ety_txt = 'black'
-opt_txt = 'black'
-TTFG = 'red'
+Inspired by:
+https://codereview.stackexchange.com/questions/272438/python-tkinter-periodic-table-of-chemical-elements
+Thanks to: Thingamabobs and Reinderien
 
+Last updated: 10 May 2023
 
-class StringViewer:
-    """
-    Simple GUI that displays strings
-        StringViewer(string, title, width)
-    """
+By Dan Porter PhD
+Diamond Light Source Ltd
+2023
+"""
 
-    def __init__(self, string, title='', width=40):
-        """Initialise"""
-        # Create Tk inter instance
-        self.root = tk.Tk()
-        self.root.wm_title(title)
-        # self.root.minsize(width=640, height=480)
-        self.root.maxsize(width=self.root.winfo_screenwidth(), height=self.root.winfo_screenheight())
-        self.root.tk_setPalette(
-            background=bkg,
-            foreground=txtcol,
-            activeBackground=opt_active,
-            activeForeground=txtcol)
-
-        # Textbox height
-        height = string.count('\n')
-        if height > 40: height = 40
-
-        frame = tk.Frame(self.root)
-        frame.pack(side=tk.TOP, fill=tk.BOTH, expand=tk.YES)
-
-        # --- label ---
-        # labframe = tk.Frame(frame,relief='groove')
-        # labframe.pack(side=tk.TOP, fill=tk.X)
-        # var = tk.Label(labframe, text=label_text,font=SF,justify='left')
-        # var.pack(side=tk.LEFT)
-
-        # --- Button ---
-        frm1 = tk.Frame(frame)
-        frm1.pack(side=tk.BOTTOM, fill=tk.X)
-        var = tk.Button(frm1, text='Close', font=BF, command=self.fun_close, bg=btn, activebackground=btn_active)
-        var.pack(fill=tk.X)
-
-        # --- Text box ---
-        frame_box = tk.Frame(frame)
-        frame_box.pack(side=tk.TOP, fill=tk.BOTH, expand=tk.YES)
+# Internal functions
+from .. import functions_crystallography as fc
+from .basic_widgets import tk, StringViewer
+
+ALKALI_METALS = [1, 3, 11, 19, 37, 55, 87]
+ALKALI_EARTH_METALS = [4, 12, 20, 38, 56, 88]
+OTHER_METALS = [13, 31, 32, 49, 50, 51, 81, 82, 83, 84, 113, 114, 115, 116]
+NON_METALS = [5, 6, 7, 8, 9, 14, 15, 16, 17, 33, 34, 35, 52, 53, 85, 117]
+NOBEL_GASES = [2, 10, 18, 36, 54, 86, 118]
+LIQUID = [35, 80]
+GAS = [1, 2, 7, 8, 9, 10, 17, 18, 36, 54, 86]
+SYNTHETIC = [43, 61]  # + > 92
+
+# Colours taken from https://xdb.lbl.gov/Section1/Periodic_Table/X-ray_Elements.html
+COLORS = {
+    'alkali metals': '#cccccc',
+    'alkali earth metals': '#a2cb69',
+    'transition metals': '#fdfe6c',
+    'other metals': '#f19bcc',
+    'nonmetals': '#80cbcc',
+    'noble gases': '#f6cc9b',
+    'solid': 'black',
+    'liquid': 'blue',
+    'gas': 'red',
+    'synthetic': 'grey',
+}
+
+
+def gen_colours(atomic_number):
+    """Return background, forground colour"""
+    background = COLORS['transition metals']
+    foreground = COLORS['solid']
+    if atomic_number in ALKALI_METALS:
+        background = COLORS['alkali metals']
+    elif atomic_number in ALKALI_EARTH_METALS:
+        background = COLORS['alkali earth metals']
+    elif atomic_number in OTHER_METALS:
+        background = COLORS['other metals']
+    elif atomic_number in NON_METALS:
+        background = COLORS['nonmetals']
+    elif atomic_number in NOBEL_GASES:
+        background = COLORS['noble gases']
+    if atomic_number in LIQUID:
+        foreground = COLORS['liquid']
+    elif atomic_number in GAS:
+        foreground = COLORS['gas']
+    elif atomic_number in SYNTHETIC or atomic_number > 92:
+        foreground = COLORS['synthetic']
+    return background, foreground
+
+
+def gen_position(atomic_number, group, period):
+    """Returns row and column"""
+    row = period
+    column = group
+    if atomic_number in [57, 89]:
+        column = 3
+    elif 57 < atomic_number < 72:
+        # Lanthanides
+        row += 2
+        column = atomic_number - 54
+    elif 89 < atomic_number < 104:
+        # Actinides
+        row += 2
+        column = atomic_number - 86
+    return row, column
+
+
+def load_elements():
+    """Return list of [Element]"""
+    element_list = []
+    with open(fc.ATOMFILE) as f:
+        # skip header
+        line = f.readline()
+        while line.startswith('#'):
+            line = f.readline()
+        # column headers
+        headers = line.split()
+        for line in f.readlines():
+            values = line.split()
+            data = {name: value for name, value in zip(headers, values)}
+            element_list += [Element(data)]
+    return element_list
+
+
+class Element:
+    def __init__(self, element_dict):
+        self.data = element_dict
+        self.atomic_number = int(element_dict['Z'])
+        self.symbol = element_dict['Element']
+        self.name = element_dict['Name']
+        self.group, self.period = int(element_dict['Group']), int(element_dict['Period'])
+        self.weight = '%.2f' % float(element_dict['Weight'])
+        self.row, self.column = gen_position(self.atomic_number, self.group, self.period)
+        self.background, self.foreground = gen_colours(self.atomic_number)
+
+    def gen_info(self):
+        return '\n'.join(['%8s: %s' % (name, val) for name, val in self.data.items()])
+
+    def __repr__(self):
+        s = "Element('%s', '%s', '%s', '%s', '%s', '%s')"
+        return s % (self.atomic_number, self.symbol, self.name, self.group, self.period, self.weight)
+
+    def __str__(self):
+        s = '%3s %2s %16s group=%2s, period=%2s, (%2s, %2s)'
+        return s % (self.atomic_number, self.symbol, self.name, self.group, self.period, self.row, self.column)
+
+
+class ElementInfo:
+    """Element info widget"""
+    EDGE_FONT = ['Palatino', 10]
+    TEXT_FONT = ['Courier', 10]
+
+    def __init__(self, frame):
+        self.frame = frame
+
+        self.vars = {
+            'element_name': tk.StringVar(self.frame, '-'),
+            'K': tk.StringVar(self.frame, ''),
+            'L2': tk.StringVar(self.frame, ''),
+            'L3': tk.StringVar(self.frame, ''),
+            'M4': tk.StringVar(self.frame, ''),
+            'M5': tk.StringVar(self.frame, ''),
+        }
+
+        # --- Create element Aborption edge frame ---
+        edge_frame = tk.Frame(self.frame)
+        edge_frame.pack(side=tk.LEFT, expand=tk.YES, fill=tk.BOTH, padx=2)
+
+        params = {
+            'font': self.EDGE_FONT,
+            'relief': tk.GROOVE,
+            'borderwidth': 2,
+            'anchor': tk.E,
+        }
+
+        var = tk.Label(edge_frame, textvariable=self.vars['element_name'], width=20, **params)
+        var.pack(side=tk.TOP, expand=tk.YES, fill=tk.X)
+
+        def edge(edge_name, edge_var):
+            frm = tk.Frame(edge_frame)
+            frm.pack(side=tk.TOP, expand=tk.YES, fill=tk.X)
+            var = tk.Label(frm, text=edge_name, width=6, **params)
+            var.pack(side=tk.LEFT)
+            var = tk.Label(frm, textvariable=edge_var, **params)
+            var.pack(side=tk.LEFT, expand=tk.YES, fill=tk.X)
+
+        edge('K', self.vars['K'])
+        edge('L2', self.vars['L2'])
+        edge('L3', self.vars['L3'])
+        edge('M4', self.vars['M4'])
+        edge('M5', self.vars['M5'])
+
+        # --- Create element infobox ---
+        info_frame = tk.LabelFrame(frame, text='Element', relief=tk.RIDGE)
+        info_frame.pack(side=tk.LEFT, expand=tk.YES, fill=tk.BOTH)
 
         # Scrollbars
-        scanx = tk.Scrollbar(frame_box, orient=tk.HORIZONTAL)
+        scanx = tk.Scrollbar(info_frame, orient=tk.HORIZONTAL)
         scanx.pack(side=tk.BOTTOM, fill=tk.X)
 
-        scany = tk.Scrollbar(frame_box)
+        scany = tk.Scrollbar(info_frame)
         scany.pack(side=tk.RIGHT, fill=tk.Y)
 
         # Editable string box
-        self.text = tk.Text(frame_box, width=width, height=height, font=HF, wrap=tk.NONE, background=ety)
-        self.text.pack(side=tk.TOP, fill=tk.BOTH, expand=tk.YES)
-        self.text.insert(tk.END, string)
-
-        self.text.config(xscrollcommand=scanx.set, yscrollcommand=scany.set)
-        scanx.config(command=self.text.xview)
-        scany.config(command=self.text.yview)
+        self.element_text = tk.Text(info_frame, font=self.TEXT_FONT, width=60, height=8,
+                                    wrap=tk.NONE, background='white')
+        self.element_text.pack(side=tk.TOP, fill=tk.BOTH, expand=tk.YES)
+        self.element_text.insert(tk.END, '')
+
+        self.element_text.config(xscrollcommand=scanx.set, yscrollcommand=scany.set)
+        scanx.config(command=self.element_text.xview)
+        scany.config(command=self.element_text.yview)
+
+    def set_info(self, element: Element) -> None:
+        self.vars['element_name'].set('%3s %2s %s' % (element.atomic_number, element.symbol, element.name))
+        self.vars['K'].set('%s keV' % element.data['K'])
+        self.vars['L2'].set('%s keV' % element.data['L2'])
+        self.vars['L3'].set('%s keV' % element.data['L3'])
+        self.vars['M4'].set('%s keV' % element.data['M4'])
+        self.vars['M5'].set('%s keV' % element.data['M5'])
+        self.element_text.delete('1.0', tk.END)
+        self.element_text.insert('1.0', element.gen_info())
+
+
+class ElementButton:
+    BORDER = 3
+    FONT_NAME = 'Palatino'
+    FONT_SIZE = 10
+
+    def __init__(self, parent: tk.Widget, placed_element: Element, info_widget: ElementInfo) -> None:
+        self.element = placed_element
+        self.info_widget = info_widget
+        self.frame = frame = tk.Frame(
+            parent, relief=tk.RAISED,
+            name='frame_%s' % self.element.symbol,
+            background=self.element.background,
+            border=self.BORDER,
+        )
+        self.frame.grid_columnconfigure(1, weight=2)
+        self.frame.grid(row=self.element.row, column=self.element.column, sticky=tk.EW)
+
+        self.populate()
+
+        frame.bind('<ButtonPress-1>', self.press)
+        frame.bind('<ButtonRelease-1>', self.release)
+        for child in frame.winfo_children():
+            child.bindtags((frame,))
+
+    def populate(self) -> None:
+        prefix = 'label_%s_' % self.element.symbol
+
+        tk.Label(
+            self.frame, name=prefix + 'number',
+            text=self.element.atomic_number, background=self.element.background,
+            font=[self.FONT_NAME, self.FONT_SIZE],
+        ).grid(row=0, column=0, sticky=tk.NW)
+
+        tk.Label(
+            self.frame, name=prefix + 'mass',
+            text=self.element.weight, background=self.element.background,
+            font=[self.FONT_NAME, self.FONT_SIZE],
+        ).grid(row=0, column=2, sticky=tk.NE)
+
+        tk.Label(
+            self.frame, name=prefix + 'symbol',
+            text=self.element.symbol, background=self.element.background,
+            font=[self.FONT_NAME, self.FONT_SIZE, 'bold'],
+            foreground=self.element.foreground,
+        ).grid(row=1, column=0, sticky=tk.EW, columnspan=3)
+
+        tk.Label(
+            self.frame, name=prefix + 'name',
+            text=self.element.name, background=self.element.background,
+            font=[self.FONT_NAME, self.FONT_SIZE],
+        ).grid(row=2, column=0, sticky=tk.EW, columnspan=3)
+
+    def press(self, event: tk.Event) -> None:
+        self.frame.configure(relief='sunken')
+
+    def release(self, event: tk.Event) -> None:
+        self.frame.configure(relief='raised')
+        # print(self.element)
+        #self.info_widget.set('%s' % self.element)
+        self.info_widget.set_info(self.element)
 
-    def fun_close(self):
-        """close window"""
-        self.root.destroy()
 
-
-"------------------------------------------------------------------------"
-"----------------------------Selection Box-------------------------------"
-"------------------------------------------------------------------------"
-
-
-class SelectionBox:
+class PeriodTableGui:
     """
-    Displays all data fields and returns a selection
-    Making a selection returns a list of field strings
-
-    out = SelectionBox(['field1','field2','field3'], current_selection=['field2'], title='', multiselect=False).show()
-    # Make selection and press "Select" > box disappears
-    out = ['list','of','strings']
+    TKinter GUI showing periodic table
     """
-    "------------------------------------------------------------------------"
-    "--------------------------GUI Initilisation-----------------------------"
-    "------------------------------------------------------------------------"
-
-    def __init__(self, parent, data_fields, current_selection=(), title='Make a selection', multiselect=True):
-        self.data_fields = data_fields
-        self.initial_selection = current_selection
 
+    def __init__(self):
         # Create Tk inter instance
-        self.root = tk.Toplevel(parent)
-        self.root.wm_title(title)
-        self.root.minsize(width=100, height=300)
-        self.root.maxsize(width=1200, height=1200)
-        self.root.tk_setPalette(
-            background=bkg,
-            foreground=txtcol,
-            activeBackground=opt_active,
-            activeForeground=txtcol)
-        self.output = []
-
-        # Frame
-        frame = tk.Frame(self.root)
-        frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=tk.YES, anchor=tk.N)
-
-        "---------------------------ListBox---------------------------"
-        # Eval box with scroll bar
-        frm = tk.Frame(frame)
-        frm.pack(side=tk.TOP, fill=tk.BOTH, expand=tk.YES)
-
-        sclx = tk.Scrollbar(frm, orient=tk.HORIZONTAL)
-        sclx.pack(side=tk.BOTTOM, fill=tk.BOTH)
-
-        scly = tk.Scrollbar(frm)
-        scly.pack(side=tk.RIGHT, fill=tk.BOTH)
-
-        self.lst_data = tk.Listbox(frm, font=MF, selectmode=tk.SINGLE, width=60, height=20, bg=ety,
-                                   xscrollcommand=sclx.set, yscrollcommand=scly.set)
-        self.lst_data.configure(exportselection=True)
-        if multiselect:
-            self.lst_data.configure(selectmode=tk.EXTENDED)
-        self.lst_data.bind('<<ListboxSelect>>', self.fun_listboxselect)
-        self.lst_data.bind('<Double-Button-1>', self.fun_exitbutton)
-
-        # Populate list box
-        for k in self.data_fields:
-            # if k[0] == '_': continue # Omit _OrderedDict__root/map
-            strval = '{}'.format(k)
-            self.lst_data.insert(tk.END, strval)
-
-        self.lst_data.pack(side=tk.LEFT, fill=tk.BOTH, expand=tk.YES)
-        for select in current_selection:
-            if select in data_fields:
-                idx = data_fields.index(select)
-                self.lst_data.select_set(idx)
-
-        sclx.config(command=self.lst_data.xview)
-        scly.config(command=self.lst_data.yview)
-
-        # self.txt_data.config(xscrollcommand=scl_datax.set,yscrollcommand=scl_datay.set)
-
-        "----------------------------Search Field-----------------------------"
-        frm = tk.LabelFrame(frame, text='Search', relief=tk.RIDGE)
-        frm.pack(fill=tk.X, expand=tk.YES, padx=2, pady=2)
-
-        self.searchbox = tk.StringVar(self.root, '')
-        var = tk.Entry(frm, textvariable=self.searchbox, font=TF, bg=ety, fg=ety_txt)
-        var.bind('<Key>', self.fun_search)
-        var.pack(fill=tk.X, expand=tk.YES, padx=2, pady=2)
-
-        "----------------------------Exit Button------------------------------"
-        frm_btn = tk.Frame(frame)
-        frm_btn.pack(fill=tk.X, expand=tk.YES)
-
-        self.numberoffields = tk.StringVar(self.root, '%3d Selected Fields' % len(self.initial_selection))
-        var = tk.Label(frm_btn, textvariable=self.numberoffields, width=20)
-        var.pack(side=tk.LEFT)
-        btn_exit = tk.Button(frm_btn, text='Select', font=BF, command=self.fun_exitbutton, bg=btn,
-                             activebackground=btn_active)
-        btn_exit.pack(side=tk.RIGHT)
-
-        "-------------------------Start Mainloop------------------------------"
-        self.root.protocol("WM_DELETE_WINDOW", self.f_exit)
-        # self.root.mainloop()
-
-    "------------------------------------------------------------------------"
-    "--------------------------General Functions-----------------------------"
-    "------------------------------------------------------------------------"
-
-    def show(self):
-        """Run the selection box, wait for response"""
-
-        # self.root.deiconify()  # show window
-        self.root.wait_window()  # wait for window
-        return self.output
-
-    def fun_search(self, event=None):
-        """Search the selection for string"""
-        search_str = self.searchbox.get()
-        search_str = search_str + event.char
-        search_str = search_str.strip().lower()
-        if not search_str: return
-
-        # Clear current selection
-        self.lst_data.select_clear(0, tk.END)
-        view_idx = None
-        # Search for whole words first
-        for n, item in enumerate(self.data_fields):
-            if re.search(r'\b%s\b' % search_str, item.lower()):  # whole word search
-                self.lst_data.select_set(n)
-                view_idx = n
-        # if nothing found, search anywhere
-        if view_idx is None:
-            for n, item in enumerate(self.data_fields):
-                if search_str in item.lower():
-                    self.lst_data.select_set(n)
-                    view_idx = n
-        if view_idx is not None:
-            self.lst_data.see(view_idx)
-        self.fun_listboxselect()
-
-    def fun_listboxselect(self, event=None):
-        """Update label on listbox selection"""
-        self.numberoffields.set('%3d Selected Fields' % len(self.lst_data.curselection()))
-
-    def fun_exitbutton(self, event=None):
-        """Closes the current data window and generates output"""
-        selection = self.lst_data.curselection()
-        self.output = [self.data_fields[n] for n in selection]
-        self.root.destroy()
-
-    def f_exit(self, event=None):
-        """Closes the current data window"""
-        self.output = self.initial_selection
-        self.root.destroy()
+        self.root = tk.Tk()
+        self.root.wm_title('Periodic Table')
+        # self.root.minsize(width=640, height=480)
+        self.root.maxsize(width=self.root.winfo_screenwidth(), height=self.root.winfo_screenheight())
+        # self.root.tk_setPalette(
+        #     background=bkg,
+        #     foreground=txtcol,
+        #     activeBackground=opt_active,
+        #     activeForeground=txtcol)
+        self.root.title('Periodic Table of the Elements')
+
+        frame = tk.Frame(self.root, name='grid_container')
+        frame.pack_configure(fill=tk.BOTH)
+
+        # --- Create element Aborption edge frame ---
+        edge_frame = tk.Frame(frame)
+        edge_frame.grid(row=1, column=3, sticky=tk.EW, columnspan=9, rowspan=3)
+
+        element_info = ElementInfo(edge_frame)
+
+        # --- Add elements ---
+        elements = load_elements()
+        for element in elements:
+            ElementButton(frame, element, element_info)
+
+        columns = {elm.column for elm in elements}
+        for x in columns:
+            frame.grid_columnconfigure(index=x, weight=1)
+
+        self.root.mainloop()
+
+
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/crystal.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/crystal.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 """
 Main crystal gui windows
 """
 
 import sys, os
-import matplotlib.pyplot as plt # Plotting
+import matplotlib.pyplot as plt  # Plotting
 import numpy as np
 
 
 if sys.version_info[0] < 3:
     import Tkinter as tk
     import tkFileDialog as filedialog
     import tkMessageBox as messagebox
@@ -17,15 +17,15 @@
     from tkinter import messagebox
 
 # Internal functions
 from ..classes_crystal import Crystal
 from ..classes_structures import Structures
 from ..classes_fdmnes import fdmnes_checker
 from .. import functions_crystallography as fc
-from .basic_widgets import StringViewer, SelectionBox
+from .basic_widgets import StringViewer, SelectionBox, popup_help, popup_about, topmenu, menu_github, menu_docs
 from .basic_widgets import (TF, BF, SF, HF, TTF,
                             bkg, ety, btn, opt, btn_active, opt_active, txtcol,
                             ety_txt)
 from .properties import PropertiesGui
 from .scattering import ScatteringGui
 from .multi_crystal import MultiCrystalGui
 from .multiple_scattering import MultipleScatteringGui
@@ -40,27 +40,65 @@
     def __init__(self, xtl=None):
         """"Initialise Main GUI"""
         if xtl is None:
             self.xtl = Crystal()
         else:
             self.xtl = xtl
 
+        # start matplotlib interactive mode
+        plt.ion()
+
         # Create Tk inter instance
         self.root = tk.Tk()
         self.root.wm_title('Crystal  by D G Porter [dan.porter@diamond.ac.uk]')
         # self.root.minsize(width=640, height=480)
         self.root.maxsize(width=self.root.winfo_screenwidth(), height=self.root.winfo_screenheight())
         self.root.tk_setPalette(
             background=bkg,
             foreground=txtcol,
             activeBackground=opt_active,
             activeForeground=txtcol)
 
         self.structure_list = Structures()
 
+        # ---Menu---
+        menu = {
+            'File': {
+                'New Window': self.menu_new,
+                'Exit': self.on_closing,
+            },
+            'Crystal Info': {
+                'Crystal': self.menu_info_crystal,
+                'Symmetric Atom Sites': self.menu_info_atoms,
+                'Symmetry': self.menu_info_symmetry,
+                'All Atom Sites': self.menu_info_structure,
+                'Properties': self.menu_info_properties,
+                'Show CIF': self.menu_info_cif,
+                'Latex table': self.menu_latex,
+            },
+            'Databases': {
+                'Element Info': self.menu_info_elements,
+                'Periodic Table': self.menu_info_table,
+                'X-Ray Interactions': self.menu_xray_interactions,
+                'Spacegroup Viewer': self.menu_spacegroups,
+                'Unit Converter': self.menu_converter,
+            },
+            'Help': {
+                'Help': popup_help,
+                # 'Dark mode': self.menu_darkmode,
+                'Examples': self.menu_examples,
+                'Activate FDMNES option': self.menu_start_fdmnes,
+                'Analyse FDMNES data': self.menu_analyse_fdmnes,
+                'Documentation': menu_docs,
+                'GitHub Page': menu_github,
+                'About': popup_about,
+            }
+        }
+        topmenu(self.root, menu)
+
         # Create Widget elements from top down
         frame = tk.Frame(self.root)
         frame.pack(side=tk.LEFT, anchor=tk.N)
 
         # Filename (variable)
         f_file = tk.Frame(frame)
         f_file.pack(side=tk.TOP, expand=tk.YES, fill=tk.X)
@@ -136,14 +174,17 @@
         f_but.pack(side=tk.TOP)
         var = tk.Button(f_but, text='Simulate\nStructure Factors', bg=btn, activebackground=btn_active, font=BF,
                         command=self.fun_simulate)
         var.pack(side=tk.LEFT)
         var = tk.Button(f_but, text='Multiple\nScattering', bg=btn, activebackground=btn_active, font=BF,
                         command=self.fun_multiple_scattering)
         var.pack(side=tk.LEFT)
+        var = tk.Button(f_but, text='Diffractometer\nSimulator', bg=btn, activebackground=btn_active, font=BF,
+                        command=self.fun_diffractometer)
+        var.pack(side=tk.LEFT)
         # Remove Tensor-Scattering 26/05/20
         #var = tk.Button(f_but, text='Tensor\nScattering', bg=btn, activebackground=btn_active, font=BF,
         #                command=self.fun_tensor_scattering)
         #var.pack(side=tk.LEFT)
         if fdmnes_checker():
             var = tk.Button(f_but, text='Run\nFDMNES', bg=btn, activebackground=btn_active, font=BF,
                             command=self.fun_fdmnes)
@@ -153,16 +194,172 @@
         # In interactive mode, this freezes the terminal
         # To stop this, need a way of checking if interactive or not ('-i' in sys.argv)
         # However sys in this file is not the same as sys in the operating script
         self.root.protocol("WM_DELETE_WINDOW", self.on_closing)
         self.root.mainloop()
 
     ###################################################################################
+    ################################# MENU ############################################
+    ###################################################################################
+    def menu_new(self):
+        """Create a new instance"""
+        CrystalGui()
+
+    def menu_info_crystal(self):
+        """Crystal info"""
+        string = '%s\n%s' % (self.xtl.filename, self.xtl.info())
+        StringViewer(string, self.xtl.name, width=60)
+
+    def menu_info_atoms(self):
+        """Atoms info"""
+        string = '%s\n%s' % (self.xtl.name, self.xtl.Atoms.info())
+        StringViewer(string, self.xtl.name, width=60)
+
+    def menu_info_structure(self):
+        """P1 Structure info"""
+        string = '%s\n%s' % (self.xtl.name, self.xtl.Structure.info())
+        StringViewer(string, self.xtl.name, width=60)
+
+    def menu_info_symmetry(self):
+        """Symmetry info"""
+        string = '%s\n%s' % (self.xtl.name, self.xtl.Symmetry.info())
+        StringViewer(string, self.xtl.name, width=60)
+
+    def menu_info_properties(self):
+        """Properties info"""
+        string = '%s\n%s' % (self.xtl.name, self.xtl.Properties.info())
+        StringViewer(string, self.xtl.name, width=60)
+
+    def menu_info_cif(self):
+        """Print cif"""
+        if self.xtl.filename:
+            with open(self.xtl.filename) as cif:
+                string = cif.read()
+            StringViewer(string, self.xtl.filename, width=120)
+        else:
+            messagebox.showinfo(
+                title='Dans_Diffraction',
+                message='No associated CIF',
+                parent=self.root
+            )
+
+    def menu_info_elements(self):
+        """View atom properties"""
+        ele_list = ['%3s: %s' % (sym, nm) for sym, nm in fc.atom_properties(None, ['Element', 'Name'])]
+        choose = SelectionBox(self.root, ele_list, multiselect=True, title='Select elements').show()
+        if choose:
+            ch_ele = [ele[:3].strip() for ele in choose]
+            string = fc.print_atom_properties(ch_ele)
+            StringViewer(string, 'Element Properties: %s' % ' '.join(ch_ele), width=60)
+
+    def menu_converter(self):
+        """Open unit converter"""
+        from .converter import UnitConverter
+        UnitConverter()
+
+    def menu_info_table(self):
+        """Open periodic table"""
+        from .periodic_table import PeriodTableGui
+        PeriodTableGui()
+
+    def menu_xray_interactions(self):
+        """Open x-ray interactions gui"""
+        from .properties import XrayInteractionsGui
+        XrayInteractionsGui(self.xtl)
+
+    def menu_spacegroups(self):
+        """Open Spacegroup viewer gui"""
+        from .spacegroups import SpaceGroupGui
+        SpaceGroupGui(self.xtl.Symmetry)
+
+    def menu_examples(self):
+        """List example files, open in system viewer"""
+        import subprocess, platform, ast
+
+        example_dir = os.path.join(os.path.split(__file__)[0], '../../Examples')
+        if not os.path.isdir(example_dir):
+            messagebox.showwarning(
+                title='Dans_Diffraction',
+                message='Examples Directory does not exist',
+                parent=self.root
+            )
+        examples = [nm for nm in os.listdir(example_dir) if nm.endswith('.py') and nm.startswith('example_')]
+
+        file_exp = []
+        for example_file in examples:
+            filename = os.path.join(example_dir, example_file)
+            with open(filename) as f:
+                file_string = f.read()
+            module = ast.parse(file_string)
+            docstring = ast.get_docstring(module)
+            docstring = docstring.replace('Dans_Diffraction Examples\n', '')
+            docstring = ' '.join(docstring.splitlines())
+            name = example_file[8:-3]
+            file_exp += ['%40s:  %s' % (name, docstring)]
+
+        choose = SelectionBox(self.root, file_exp, multiselect=False, title='Select example file').show()
+        if choose:
+            filename = os.path.join(example_dir, 'example_' + choose[0].split(':')[0].strip() + '.py')
+
+            try:
+                if platform.system() == 'Darwin':  # macOS
+                    subprocess.call(('open', filename))
+                elif platform.system() == 'Windows':  # Windows
+                    os.startfile(filename)
+                else:  # linux variants
+                    subprocess.call(('xdg-open', filename))
+            except OSError:
+                messagebox.showinfo(
+                    title='Dans_Diffraction',
+                    message=filename,
+                    parent=self.root
+                )
+
+    def menu_latex(self):
+        """Display latex commands"""
+        formula = self.xtl.Properties.molname(latex=True)
+        s = 'Name: %s\nChemical formula: %s\n\n' % (self.xtl.name, formula)
+        try:
+            s += self.xtl.Properties.latex_table()
+            StringViewer(s, self.xtl.name, width=60)
+        except KeyError:
+            messagebox.showwarning(
+                parent=self.root,
+                title='CIF Table',
+                message='No .cif file associated with this crystal'
+            )
+
+    def menu_start_fdmnes(self):
+        """Search for FDMNES, restart GUI"""
+        from Dans_Diffraction import activate_fdmnes, fdmnes_checker, start_gui
+        activate_fdmnes()
+        if fdmnes_checker():
+            self.on_closing()
+            start_gui(self.xtl)
+        else:
+            messagebox.showinfo('FDMNES Checker', 'FDMNES could not be found')
+
+    def menu_analyse_fdmnes(self):
+        """Open FDMNS analysis GUI"""
+        from .fdmnes import AnaFDMNESgui
+        AnaFDMNESgui()
+
+    def menu_darkmode(self):
+        """Change colour scheme"""
+        # doesn't currently work - doesn't change colours
+        from .basic_widgets import dark_mode
+        dark_mode()
+        self.on_closing()
+        CrystalGui(self.xtl)
+
+
+    ###################################################################################
     ############################## FUNCTIONS ##########################################
     ###################################################################################
+
     def fun_set(self):
         self.file.set(self.short_file())
         self.name.set(self.xtl.name)
 
     def fun_get(self):
         self.xtl.name = self.name.get()
 
@@ -240,16 +437,18 @@
         self.fun_set()
         if np.any(self.xtl.Structure.mxmymz()):
             AtomsGui(self.xtl, False, True)
         else:
             AtomsGui(self.xtl, False, False)
 
     def fun_symmetry(self):
+        from .spacegroups import SpaceGroupGui
         self.fun_set()
-        SymmetryGui(self.xtl)
+        SpaceGroupGui(self.xtl.Symmetry, self.xtl)
+        # SymmetryGui(self.xtl)
 
     def fun_info(self):
         """Display Crystal info"""
         string = '%s\n%s' % (self.xtl.filename, self.xtl.info())
         StringViewer(string, self.xtl.name, width=60)
 
     def fun_plotxtl(self):
@@ -272,14 +471,20 @@
         rt.root.focus_force()
 
     def fun_multiple_scattering(self):
         self.fun_set()
         rt = MultipleScatteringGui(self.xtl)
         rt.root.focus_force()
 
+    def fun_diffractometer(self):
+        from .diffractometer import DiffractometerGui
+        self.fun_set()
+        rt = DiffractometerGui(self.xtl)
+        rt.root.focus_force()
+
     def fun_tensor_scattering(self):
         self.fun_set()
         rt = TensorScatteringGui(self.xtl)
         rt.root.focus_force()
 
     def fun_properties(self):
         self.fun_set()
@@ -403,20 +608,20 @@
             self.Atoms = xtl.Atoms
             ttl = xtl.name + ' Symmetric Atomic Sites'
         else:
             self.Atoms = xtl.Structure
             ttl = xtl.name + ' General Atomic Sites'
 
         if magnetic_moments:
-            label_text = '    n   Atom   Label       u              v            w             Occ         Uiso      mx             my           mz             '
-            default_width = 55
+            label_text = '    n   Atom   Label               Site      u              v             w              Occ         Uiso       mx             my           mz             '
+            default_width = 65
             mag_button = 'Hide Magnetic Moments'
         else:
-            label_text = '    n   Atom   Label       u              v            w             Occ         Uiso'
-            default_width = 55
+            label_text = '    n   Atom   Label               Site      u              v             w              Occ         Uiso'
+            default_width = 65
             mag_button = 'Show Magnetic Moments'
 
         # Create Tk inter instance
         self.root = tk.Tk()
         self.root.wm_title(ttl)
         # self.root.minsize(width=640, height=480)
         self.root.maxsize(width=self.root.winfo_screenwidth(), height=self.root.winfo_screenheight())
@@ -460,28 +665,30 @@
         self.fun_set()
 
         self.text.config(xscrollcommand=scanx.set, yscrollcommand=scany.set)
         scanx.config(command=self.text.xview)
         scany.config(command=self.text.yview)
 
     def fun_set(self):
-        "Get positions from crystal object, fill text boxes"
+        """Get positions from crystal object, fill text boxes"""
+        # Get Wyckoff labels
+        wyckoff = self.xtl.Symmetry.wyckoff_labels(self.Atoms.uvw())
         # Build string
         str = ''
         if self.magnetic_moments:
-            fmt = '%3.0f %4s %5s %7.4f %7.4f %7.4f   %4.2f %6.4f   %7.4f %7.4f %7.4f\n'
+            fmt = '%3.0f %4s %5s %10s  %7.4f %7.4f %7.4f   %4.2f %6.4f   %7.4f %7.4f %7.4f\n'
             for n in range(0, len(self.Atoms.u)):
-                str += fmt % (n, self.Atoms.type[n], self.Atoms.label[n],
+                str += fmt % (n, self.Atoms.type[n], self.Atoms.label[n], wyckoff[n],
                               self.Atoms.u[n], self.Atoms.v[n], self.Atoms.w[n],
                               self.Atoms.occupancy[n], self.Atoms.uiso[n],
                               self.Atoms.mx[n], self.Atoms.my[n], self.Atoms.mz[n])
         else:
-            fmt = '%3.0f %4s %5s %7.4f %7.4f %7.4f   %4.2f %6.4f\n'
+            fmt = '%3.0f %4s %5s %10s  %7.4f %7.4f %7.4f   %4.2f %6.4f\n'
             for n in range(0, len(self.Atoms.u)):
-                str += fmt % (n, self.Atoms.type[n], self.Atoms.label[n],
+                str += fmt % (n, self.Atoms.type[n], self.Atoms.label[n], wyckoff[n],
                               self.Atoms.u[n], self.Atoms.v[n], self.Atoms.w[n],
                               self.Atoms.occupancy[n], self.Atoms.uiso[n])
 
         # Insert string in text box
         self.text.insert(tk.END, str)
 
     def fun_magnets(self):
@@ -491,57 +698,57 @@
         self.root.destroy()
 
         AtomsGui(self.xtl, self.symmetric_only, not self.magnetic_moments)
 
     def fun_update(self):
         "Update atomic properties, close window"
         # Get string from text box
-        str = self.text.get('1.0', tk.END)
+        s = self.text.get('1.0', tk.END)
 
         # Analyse string
         """
         values = np.genfromtxt(str)
         n = values[:,0]
         type = values[:,1]
         label = values[:,2]
         u = values[:,3]
         v = values[:,4]
         w = values[:,5]
         occ = values[:,6]
         uiso = values[:,7]
         """
-        lines = str.splitlines()
+        lines = s.splitlines()
         n = []
-        type = []
+        scattering_type = []
         label = []
         u = []
         v = []
         w = []
         occ = []
         uiso = []
         mx = []
         my = []
         mz = []
         for ln in lines:
             items = ln.split()
             if len(items) < 8: continue
             n += [int(items[0])]
-            type += [items[1]]
+            scattering_type += [items[1]]
             label += [items[2]]
-            u += [float(items[3])]
-            v += [float(items[4])]
-            w += [float(items[5])]
-            occ += [float(items[6])]
-            uiso += [float(items[7])]
+            u += [float(items[5])]
+            v += [float(items[6])]
+            w += [float(items[7])]
+            occ += [float(items[8])]
+            uiso += [float(items[9])]
             if self.magnetic_moments:
-                mx += [float(items[8])]
-                my += [float(items[9])]
-                mz += [float(items[10])]
+                mx += [float(items[10])]
+                my += [float(items[11])]
+                mz += [float(items[12])]
 
-        self.Atoms.type = type
+        self.Atoms.type = scattering_type
         self.Atoms.label = label
         self.Atoms.u = np.array(u)
         self.Atoms.v = np.array(v)
         self.Atoms.w = np.array(w)
         self.Atoms.occupancy = np.array(occ)
         self.Atoms.uiso = np.array(uiso)
         if self.magnetic_moments:
@@ -707,14 +914,15 @@
             if len(mag.strip()) == 0: mag = fc.symmetry_ops2magnetic([sym.strip()])[0]
             sym_ops += [sym.strip()]
             mag_ops += [mag.strip()]
 
         self.Symmetry.symmetry_operations = sym_ops
         self.Symmetry.symmetry_operations_magnetic = mag_ops
         self.Symmetry.generate_matrices()
+        self.xtl.generate_structure()
 
     def fun_move(self, *args):
         """Move within text frame"""
         self.scany.set(*args)
         self.text_1.yview('moveto', args[0])
         self.text_2.yview('moveto', args[0])
         self.text_3.yview('moveto', args[0])
@@ -752,26 +960,26 @@
             magstr += '%25s\n' % (mag)
 
         # Insert string in text box
         self.text_2.insert(tk.END, symstr)
         self.text_3.insert(tk.END, magstr)
 
         # Update spacegroup name + number
-        self.spacegroup.set(self.Symmetry.spacegroup)
+        self.spacegroup.set(self.Symmetry.spacegroup_symbol)
         self.spacegroup_number.set(self.Symmetry.spacegroup_number)
 
     def fun_spacegroup(self, event=None):
         """Load spacegroup symmetry"""
-        sgn = int(self.spacegroup_number.get())
+        sgn = int(float(self.spacegroup_number.get()))
         self.Symmetry.load_spacegroup(sgn)
         self.fun_set()
 
     def fun_ch_spacegroup(self):
         """Button Select Spacegroup"""
-        current = int(self.spacegroup_number.get())
+        current = int(float(self.spacegroup_number.get()))
         sg_list = fc.spacegroup_list().split('\n')
         current_selection = [sg_list[current-1]]
         selection = SelectionBox(self.root, sg_list, current_selection, 'Select SpaceGroup', False).show()
         if len(selection) > 0:
             new_sg = int(selection[0].split()[0])
             self.Symmetry.load_spacegroup(new_sg)
             self.fun_set()
@@ -784,15 +992,15 @@
         if len(selection) > 0:
             new_sg = int(selection[0].split()[3])
             self.Symmetry.load_spacegroup(new_sg)
             self.fun_set()
 
     def fun_ch_maggroup(self):
         """Button Select Magnetic Spacegroup"""
-        current = int(self.spacegroup_number.get())
+        current = int(float(self.spacegroup_number.get()))
         msg_list = fc.spacegroup_magnetic_list(current).split('\n')
         selection = SelectionBox(self.root, msg_list, [], 'Select Magnetic SpaceGroup', False).show()
         if len(selection) > 0:
             new_sg = selection[0].split()[3]
             self.Symmetry.load_magnetic_spacegroup(new_sg)
             self.fun_set()
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/fdmnes.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/fdmnes.py`

 * *Files 0% similar despite different names*

```diff
@@ -330,14 +330,15 @@
             activeBackground=opt_active,
             activeForeground=txtcol)
         default_width = 60
         default_height = 30
 
         if output_path is None or not os.path.isfile(os.path.join(output_path, output_name + '.txt')):
             self.fun_loadpath()
+            return
 
         self.fdm = FdmnesAnalysis(output_path, output_name)
 
         frame = tk.Frame(self.root)
         frame.pack(side=tk.LEFT, anchor=tk.N, fill=tk.BOTH, expand=tk.YES)
 
         # ---Line 1---
@@ -473,14 +474,16 @@
         filename = filedialog.askopenfilename(initialdir=ini_dir, title=title, filetypes=filetypes)
         if filename:
             filepath, filename = os.path.split(filename)
             filename = filename.replace('_', '.')
             calc_name = filename.split('.')[0]
             self.root.destroy()
             AnaFDMNESgui(filepath, calc_name)
+        else:
+            self.root.destroy()
 
     def fun_xanes(self, event=None):
         """Button XANES"""
         self.fdm.xanes.plot()
         plt.show()
 
     def fun_dos(self, event=None):
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/multi_crystal.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/multi_crystal.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/multiple_scattering.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/multiple_scattering.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/properties.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/properties.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,24 +1,18 @@
 """
 Properties GUI
 """
 
-import sys, os
-
 import matplotlib.pyplot as plt
 import numpy as np
-if sys.version_info[0] < 3:
-    import Tkinter as tk
-else:
-    import tkinter as tk
 
 from .. import functions_general as fg
 from .. import functions_crystallography as fc
 from .. import functions_plotting as fp
-from .basic_widgets import StringViewer
+from .basic_widgets import tk, StringViewer, SelectionBox, messagebox
 from .basic_widgets import (TF, BF, SF, LF, HF,
                             bkg, ety, btn, opt, btn2,
                             btn_active, opt_active, txtcol,
                             btn_txt, ety_txt, opt_txt)
 
 
 class PropertiesGui:
@@ -42,20 +36,18 @@
 
         frame = tk.Frame(self.root)
         frame.pack(side=tk.LEFT, anchor=tk.N)
 
         # Crystal Atoms
         atoms = np.unique(xtl.Atoms.type)
         atoms = fc.arrange_atom_order(atoms)
-        elements = fc.atom_properties(None, 'Element')
 
         # Variables
         self.zfraction = tk.DoubleVar(frame, 1)
         self.atoms = tk.StringVar(frame, ' '.join(atoms))
-        self.atomopt = tk.StringVar(frame, 'Elements:')
         self.energy_kev = tk.DoubleVar(frame, 8.0)
         self.wavelength = tk.DoubleVar(frame, 1.5498)
         self.edge = tk.StringVar(frame, 'Edge')
         self.twotheta = tk.DoubleVar(frame, 90.0)
         self.qmag = tk.DoubleVar(frame, 5.733)
         self.dspace = tk.DoubleVar(frame, 1.096)
 
@@ -144,19 +136,16 @@
 
         var = tk.Label(line, text='Elements', font=LF)
         var.pack(side=tk.LEFT)
 
         var = tk.Entry(line, textvariable=self.atoms, font=TF, width=16, bg=ety, fg=ety_txt)
         var.pack(side=tk.LEFT)
 
-        var = tk.OptionMenu(line, self.atomopt, *elements, command=self.fun_element)
-        var.config(font=SF, width=10, bg=opt, activebackground=opt_active)
-        var["menu"].config(bg=opt, bd=0, activebackground=opt_active)
+        var = tk.Button(line, text='Elements', font=BF, command=self.fun_element, bg=btn, activebackground=btn_active)
         var.pack(side=tk.LEFT)
-
         var = tk.Button(line, text='Mass Fraction', font=BF, command=self.fun_frac, bg=btn, activebackground=btn_active)
         var.pack(side=tk.LEFT)
         var = tk.Label(line, text=' Z:', font=TF)
         var.pack(side=tk.LEFT)
         var = tk.Entry(line, textvariable=self.zfraction, font=TF, width=2, bg=ety, fg=ety_txt)
         var.pack(side=tk.LEFT)
 
@@ -172,14 +161,18 @@
                         activebackground=btn_active)
         var.pack(side=tk.LEFT)
 
         var = tk.Button(line, text='X-Ray\nAttenuation', font=BF, command=self.fun_xratten, bg=btn,
                         activebackground=btn_active)
         var.pack(side=tk.LEFT)
 
+        var = tk.Button(line, text='Bond\nDistances', font=BF, command=self.fun_neighbours, bg=btn,
+                        activebackground=btn_active)
+        var.pack(side=tk.LEFT)
+
         # ---Line 5---
         line = tk.Frame(frame)
         line.pack(side=tk.TOP, pady=5)
 
         var = tk.Button(line, text='X-Ray\nScattering Factor', font=BF, command=self.fun_xsf, bg=btn,
                         activebackground=btn_active)
         var.pack(side=tk.LEFT)
@@ -244,17 +237,27 @@
         energy = self.energy_kev.get()
         qmag = fc.q2dspace(dspace)
         tth = fc.cal2theta(qmag, energy)
         self.qmag.set(round(qmag, 4))
         self.twotheta.set(round(tth, 4))
 
     def fun_element(self, event=None):
-        """Dropdown menu"""
-        atom = self.atomopt.get()
-        self.atoms.set(atom)
+        """Element button"""
+        ele_list = ['%3s: %s' % (sym, nm) for sym, nm in fc.atom_properties(None, ['Element', 'Name'])]
+        ele = self.atoms.get().split()
+        cur_ele = ['%3s: %s' % (sym, nm) for sym, nm in fc.atom_properties(ele, ['Element', 'Name'])]
+        choose = SelectionBox(
+            parent=self.root,
+            data_fields=ele_list,
+            current_selection=cur_ele,
+            multiselect=True,
+            title='Select elements'
+        ).show()
+        ch_ele = [ele[:3].strip() for ele in choose]
+        self.atoms.set(' '.join(ch_ele))
 
     def fun_prop(self):
         """Properties button"""
         elements = self.atoms.get()
         elements = elements.replace(',', ' ')
         elelist = elements.split()
         out = fc.print_atom_properties(elelist)
@@ -274,14 +277,17 @@
         """Properties button"""
         elements = self.atoms.get()
         elements = elements.replace(',', ' ')
         elelist = elements.split()
         fp.plot_xray_attenuation(elelist)
         plt.show()
 
+    def fun_neighbours(self):
+        NeighborsGui(self.xtl)
+
     def fun_xsf(self):
         """Properties button"""
         elements = self.atoms.get()
         elements = elements.replace(',', ' ')
         elelist = elements.split()
         for el in elelist:
             fp.plot_xray_scattering_factor(el)
@@ -322,15 +328,15 @@
 
         frame = tk.Frame(self.root)
         frame.pack(side=tk.LEFT, anchor=tk.N)
 
         # Crystal info
         name = xtl.name
         formula = xtl.Properties.molname()
-        density = xtl.Properties.density()
+        density = round(xtl.Properties.density(), 3)
 
         # Variables
         self.chem_formula = tk.StringVar(frame, formula)
         self.chem_select = tk.StringVar(frame, 'Select Formula')
         self.density = tk.DoubleVar(frame, density)
         self.scan_type = tk.StringVar(frame, 'Photon Energy (keV)')
         self.scan_min = tk.DoubleVar(frame, 0.03)
@@ -410,25 +416,29 @@
 
         # Grazing angle
         line = tk.Frame(frame)
         line.pack(side=tk.TOP, expand=tk.TRUE, fill=tk.X, pady=5)
 
         var = tk.Label(line, text='Grazing angle:', width=20, font=TF, anchor=tk.E)
         var.pack(side=tk.LEFT)
+        var = tk.Button(line, text='?', font=TF, command=self.button_help_angle, bg=btn, activebackground=btn_active)
+        var.pack(side=tk.LEFT, padx=1)
         var = tk.Entry(line, textvariable=self.grazing_angle, font=TF, width=20, bg=ety, fg=ety_txt)
         var.pack(side=tk.LEFT)
         var = tk.Label(line, text=' Deg', font=TF)
         var.pack(side=tk.LEFT)
 
         # slab thickness
         line = tk.Frame(frame)
         line.pack(side=tk.TOP, expand=tk.TRUE, fill=tk.X, pady=5)
 
         var = tk.Label(line, text='Thickness:', width=20, font=TF, anchor=tk.E)
         var.pack(side=tk.LEFT)
+        var = tk.Button(line, text='?', font=TF, command=self.button_help_thickness, bg=btn, activebackground=btn_active)
+        var.pack(side=tk.LEFT, padx=1)
         var = tk.Entry(line, textvariable=self.slab_thickness, font=TF, width=20, bg=ety, fg=ety_txt)
         var.pack(side=tk.LEFT)
         var = tk.Label(line, text=' μm', font=TF)
         var.pack(side=tk.LEFT)
 
         # Buttons
         line = tk.Frame(frame)
@@ -438,14 +448,18 @@
                         activebackground=btn_active)
         var.pack(side=tk.LEFT)
 
         var = tk.Button(line, text='Thick Slab\nTransmission', font=BF, command=self.button_transmission, bg=btn,
                         activebackground=btn_active)
         var.pack(side=tk.LEFT)
 
+        var = tk.Button(line, text='Reflectivity', font=BF, command=self.button_reflectivity, bg=btn,
+                        activebackground=btn_active)
+        var.pack(side=tk.LEFT, fill=tk.Y)
+
         var = tk.Button(line, text='Index of\nRefraction', font=BF, command=self.button_refraction, bg=btn,
                         activebackground=btn_active)
         var.pack(side=tk.LEFT)
 
     def get_scan(self):
         scan_type = self.scan_type.get()
         scan_min = self.scan_min.get()
@@ -511,14 +525,29 @@
             scan_step = fc.wave2energy(scan_step) / 10.
 
         self.scan_min.set(scan_min)
         self.scan_max.set(scan_max)
         self.scan_step.set(scan_step)
         self.scan_units.set(self.scan_types[scan_type])
 
+    def button_help_angle(self):
+        messagebox.showinfo(
+            parent=self.root,
+            title='X-Ray Interactions',
+            message='Grazing angle: angle from surface to incident beam, in degrees\n' +
+            'Typical values:\n\tTransmission: 90 Deg\n\tReflectivity: 0.2 Deg',
+        )
+
+    def button_help_thickness(self):
+        messagebox.showinfo(
+            parent=self.root,
+            title='X-Ray Interactions',
+            message='Thickness: distance beam travels through material in Transmission, in microns.',
+        )
+
     def button_atten(self):
         formula = self.chem_formula.get()
         density = self.density.get()
         angle = self.grazing_angle.get()
         energy_range = self.get_scan()
         fp.plot_xray_attenuation_length(formula, density, energy_range, angle)
         plt.show()
@@ -527,14 +556,191 @@
         formula = self.chem_formula.get()
         density = self.density.get()
         thickness = self.slab_thickness.get()
         energy_range = self.get_scan()
         fp.plot_xray_transmission(formula, density, energy_range, thickness)
         plt.show()
 
+    def button_reflectivity(self):
+        formula = self.chem_formula.get()
+        density = self.density.get()
+        angle = self.grazing_angle.get()
+        energy_range = self.get_scan()
+        fp.plot_xray_reflectivity(formula, density, energy_range, angle)
+        plt.show()
+
     def button_refraction(self):
         formula = self.chem_formula.get()
         density = self.density.get()
         energy_range = self.get_scan()
         fp.plot_xray_refractive_index(formula, density, energy_range)
         plt.show()
 
+
+class NeighborsGui:
+    """
+    Calculate bond distances
+    """
+
+    def __init__(self, xtl):
+        """Initialise"""
+        self.xtl = xtl
+        # Create Tk inter instance
+        self.root = tk.Tk()
+        self.root.wm_title('Bond Distances')
+        # self.root.minsize(width=640, height=480)
+        self.root.maxsize(width=self.root.winfo_screenwidth(), height=self.root.winfo_screenheight())
+        self.root.tk_setPalette(
+            background=bkg,
+            foreground=txtcol,
+            activeBackground=opt_active,
+            activeForeground=txtcol)
+
+        frame = tk.Frame(self.root)
+        frame.pack(side=tk.LEFT, anchor=tk.N)
+
+        # Variables
+        self.atom_list = [self._atom_str(atom) for atom in self.xtl.Structure]
+        self.structure_index = tk.IntVar(frame, 0)
+        self.atom_str = tk.StringVar(frame, self.atom_list[0])
+        self.radius = tk.DoubleVar(frame, 2.5)
+        self.exchange_type = tk.StringVar(frame, 'O')
+        self.bond_angle = tk.DoubleVar(frame, 90)
+        self.search_in_cell = tk.BooleanVar(frame, True)
+        self.group_neighbors = tk.BooleanVar(frame, True)
+
+        # Atom index
+        line = tk.Frame(frame)
+        line.pack(side=tk.TOP, expand=tk.TRUE, fill=tk.X, pady=5)
+        var = tk.Label(line, text='Atom Index:', width=20, font=TF, anchor=tk.E)
+        var.pack(side=tk.LEFT)
+        var = tk.Entry(line, textvariable=self.structure_index, font=TF, width=3, bg=ety, fg=ety_txt)
+        var.pack(side=tk.LEFT)
+        var.bind('<Return>', self.atom_update)
+        var.bind('<KP_Enter>', self.atom_update)
+        var = tk.Label(line, textvariable=self.atom_str, font=TF, width=30, bg=ety, fg=ety_txt)
+        var.pack(side=tk.LEFT)
+        var = tk.Button(line, text='Select', font=TF, command=self.button_select_atom,
+                        bg=btn, activebackground=btn_active)
+        var.pack(side=tk.LEFT, padx=1)
+
+        # Radius
+        line = tk.Frame(frame)
+        line.pack(side=tk.TOP, expand=tk.TRUE, fill=tk.X, pady=5)
+        var = tk.Label(line, text='Radius:', width=20, font=TF, anchor=tk.E)
+        var.pack(side=tk.LEFT)
+        var = tk.Entry(line, textvariable=self.radius, font=TF, width=3, bg=ety, fg=ety_txt)
+        var.pack(side=tk.LEFT)
+        var = tk.Button(line, text='?', font=TF, command=self.button_radius,
+                        bg=btn, activebackground=btn_active)
+        var.pack(side=tk.LEFT, padx=1)
+
+        # Exchange type
+        line = tk.Frame(frame)
+        line.pack(side=tk.TOP, expand=tk.TRUE, fill=tk.X, pady=5)
+        var = tk.Label(line, text='Exchange type:', width=20, font=TF, anchor=tk.E)
+        var.pack(side=tk.LEFT)
+        var = tk.Entry(line, textvariable=self.exchange_type, font=TF, width=3, bg=ety, fg=ety_txt)
+        var.pack(side=tk.LEFT)
+
+        # bond angle
+        line = tk.Frame(frame)
+        line.pack(side=tk.TOP, expand=tk.TRUE, fill=tk.X, pady=5)
+        var = tk.Label(line, text='Bond Angle:', width=20, font=TF, anchor=tk.E)
+        var.pack(side=tk.LEFT)
+        var = tk.Entry(line, textvariable=self.bond_angle, font=TF, width=3, bg=ety, fg=ety_txt)
+        var.pack(side=tk.LEFT)
+        var = tk.Label(line, text=' Deg', font=TF)
+        var.pack(side=tk.LEFT)
+
+        # Options
+        line = tk.Frame(frame)
+        line.pack(side=tk.TOP, expand=tk.TRUE, fill=tk.X, pady=5)
+        var = tk.Checkbutton(line, text='Search in cell', variable=self.search_in_cell, font=SF)
+        var.pack(side=tk.LEFT, padx=6)
+        var = tk.Checkbutton(line, text='Group Neighbors', variable=self.group_neighbors, font=SF)
+        var.pack(side=tk.LEFT, padx=6)
+
+        # Buttons
+        line = tk.Frame(frame)
+        line.pack(side=tk.TOP, expand=tk.TRUE, pady=5)
+        var = tk.Button(line, text='All Bond\nDistances', font=BF, command=self.button_allbonds, bg=btn,
+                        activebackground=btn_active)
+        var.pack(side=tk.LEFT)
+        var = tk.Button(line, text='Atomic\nNeighbours', font=BF, command=self.button_neighbours, bg=btn,
+                        activebackground=btn_active)
+        var.pack(side=tk.LEFT)
+        var = tk.Button(line, text='Exchange\nPaths', font=BF, command=self.button_exchange, bg=btn,
+                        activebackground=btn_active)
+        var.pack(side=tk.LEFT)
+        var = tk.Button(line, text='Plot Exchange\nPaths', font=BF, command=self.button_plot_exchange, bg=btn,
+                        activebackground=btn_active)
+        var.pack(side=tk.LEFT)
+
+    def _atom_str(self, atom):
+        s = '%4s [%2s] (%5.2f,%5.2f,%5.2f)'
+        return s % (atom.label, atom.type, atom.u, atom.v, atom.w)
+
+    def atom_update(self, event=True):
+        idx = self.structure_index.get()
+        self.atom_str.set(self.atom_list[idx])
+
+    def button_select_atom(self):
+        choose = SelectionBox(self.root, self.atom_list, multiselect=False, title='Select atom site').show()
+        if choose:
+            idx = self.atom_list.index(choose[0])
+            self.structure_index.set(idx)
+            self.atom_str.set(choose[0])
+
+    def button_radius(self):
+        messagebox.showinfo(
+            parent=self.root,
+            title='Radius',
+            message='Nearest neighbors: search radius about central atom [2.5A]\n' +
+            'Exchange paths: typical value [7.0A]'
+        )
+
+    def button_allbonds(self):
+        out = ''
+        # get atom sites
+        for atom_str in self.atom_list:
+            idx = self.atom_list.index(atom_str)
+            bond_str = self.xtl.Properties.atomic_neighbours(
+                structure_index=idx,
+                radius=self.radius.get(),
+                return_str=True
+            )
+            out += '%3d %s\n%s\n\n' % (idx, atom_str, bond_str)
+        StringViewer(out, title='%s All Bonds' % self.xtl.name, width=60)
+
+    def button_neighbours(self):
+        out = self.xtl.Properties.atomic_neighbours(
+            structure_index=self.structure_index.get(),
+            radius=self.radius.get(),
+            disp=True,
+            return_str=True
+        )
+        StringViewer(out, title='%s %s' % (self.xtl.name, self.atom_str.get()), width=60)
+
+    def button_exchange(self):
+        exchange_paths, exchange_distances, outstr = self.xtl.Properties.exchange_paths(
+            cen_idx=self.structure_index.get(),
+            nearest_neighbor_distance=self.radius.get(),
+            exchange_type=self.exchange_type.get(),
+            bond_angle=self.bond_angle.get(),
+            search_in_cell=self.search_in_cell.get(),
+            group_neighbors=self.group_neighbors.get(),
+            disp=True,
+            return_str=True
+        )
+        StringViewer(outstr, title='%s %s' % (self.xtl.name, self.atom_str.get()), width=100)
+
+    def button_plot_exchange(self):
+        self.xtl.Plot.plot_exchange_paths(
+            cen_idx=self.structure_index.get(),
+            nearest_neighbor_distance=self.radius.get(),
+            exchange_type=self.exchange_type.get(),
+            bond_angle=self.bond_angle.get(),
+            search_in_cell=self.search_in_cell.get(),
+            group_neighbors=self.group_neighbors.get()
+        )
+
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction/tkgui/tensor_scattering.py` & `Dans_Diffraction-3.0.0/Dans_Diffraction/tkgui/tensor_scattering.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction.egg-info/PKG-INFO` & `Dans_Diffraction-3.0.0/README.md`

 * *Files 17% similar despite different names*

```diff
@@ -1,295 +1,313 @@
-Metadata-Version: 2.1
-Name: Dans-Diffraction
-Version: 2.2.3
-Summary: Generate diffracted intensities from crystals
-Home-page: https://github.com/DanPorter/Dans_Diffraction
-Author: Dan Porter
-Author-email: d.g.porter@outlook.com
-License: UNKNOWN
-Description: # Dans_Diffaction
-        Reads crystallographic cif files and simulates diffraction, among other things.
-        
-        **Version 2.2**
-        
-        [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.3859501.svg)](https://doi.org/10.5281/zenodo.3859501)
-        
-        By Dan Porter, Diamond Light Source
-        2022
-        
-        #### TL;DR:
-        ```text
-        $ ipython -i -m Dans_Diffraction
-        ```
-        
-        ```python
-        import Dans_Diffraction as dif
-        xtl = dif.Crystal('some_file.cif')
-        xtl.info() # print Crystal structure parameters
-        
-        # Print reflection list:
-        print(xtl.Scatter.print_all_reflections(energy_kev=5)) 
-        
-        # Plot Powder pattern:
-        xtl.Plot.simulate_powder(energy_kev=8)
-        plt.show()
-        
-        # Start graphical user interface:
-        xtl.start_gui()
-        ```
-        
-        Full code documentation available [here](https://danporter.github.io/Dans_Diffraction/).
-        
-        For comments, queries or bugs - email [dan.porter@diamond.ac.uk](mailto:dan.porter@diamond.ac.uk)
-        
-        **Citation:** If you use this code (great!), please cite the published DOI: [10.5281/zenodo.3859501](https://doi.org/10.5281/zenodo.3859501)
-        
-        # Installation
-        **Requirements:** 
-        Python 3+ with packages: *Numpy*, *Matplotlib*, *Tkinter*.
-        BuiltIn packages used: *sys*, *os*, *re*, *glob*, *warnings*, *json*, *itertools*
-        
-        Stable version from PyPI:
-        ```text
-        $ pip install Dans-Diffraction
-        ```
-        
-        Download latest version from GitHub:
-        ```text
-        $ git clone https://github.com/DanPorter/Dans_Diffraction.git
-        ```
-        Or install latest version direct from GitHub:
-        ```text
-        $ pip install git+https://github.com/DanPorter/Dans_Diffraction.git
-        ```
-        
-        
-        # Operation
-        Dans_Diffraction is best run within an interactive python environment:
-        ```text
-        $ ipython -i -m Dans_Diffraction
-        ```
-        
-        Dans_Diffraction can also be run in scripts as an import, example scripts are provided in the [Examples](https://github.com/DanPorter/Dans_Diffraction/blob/master/Examples) folder.
-        ### Read CIF file
-        ```python
-        import Dans_Diffraction as dif
-        xtl = dif.Crystal('some_file.cif')
-        xtl.info() # print Crystal structure parameters
-        help(xtl)  # all functions (nearly!) are documented
-        ```
-        
-        ### Alter atomic positions
-        ```python
-        xtl.Cell.latt([2.85,2.85,10.8,90,90,120]) #  set lattice parameters
-        xtl.Atoms.info() # Print Symmetric positions
-        xtl.Structure.info() # Print All positions in P1 symmetry (same structure and functions as xtl.Atoms)
-        # Symmetric positions
-        xtl.Atoms.changeatom(idx=0, u=0, v=0, w=0, type='Co', label='Co1')
-        xtl.Atoms.addatom(idx=0, u=0, v=0, w=0, type='Co', label='Co1')
-        # After adding or changing an atom in the Atoms class, re-generate the full structure using symmetry arguments:
-        xtl.generate_lattice()
-        # Full atomic structure in P1 symmetry
-        xtl.Structure.changeatom(idx=0, u=0, v=0, w=0, type='Co', label='Co1')
-        xtl.Structure.addatom(idx=0, u=0, v=0, w=0, type='Co', label='Co1')
-        # Plot crystal Structure
-        xtl.Plot.plot_crystal() # 3D plot
-        xtl.Plot.plot_layers() # 2D plot for layered materials
-        ```
-        ![3D Plot](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/3Dstructrue_Ca3CoMnO6.png?raw=true)
-        
-        
-        ### Alter crystal symmetry
-        ```python
-        xtl.Symmetry.info() # print symmetry arguments
-        xtl.Symmetry.addsym('x,y,z+1/2') # adds single symmetry operation
-        xtl.Symmetry.changesym(0, 'x,y,z+1/4')
-        xtl.Symmetry.load_spacegroup(194) # replaces current symmetry operations
-        # After adding or changing symmetry operations, regengerate the symmetry matrices
-        xtl.Symmetry.generate_matrices()
-        ```
-        
-        ### Save structure as CIF
-        Lattice parameters, crystal structure and symmetry operations will be saved to the CIF.
-        If magnetic moments are defined, magnetic symmetry operations and moments will also be saved
-        and format changed to "*.mcif".
-        ```python
-        xtl.write_cif('edited file.cif')
-        ```
-        
-        ### Calculate Structure Factors
-        X-ray or neutron structure factors/ intensities are calculated based on the full unit cell structure, including atomic 
-        form-factors (x-rays) or coherent scattering lengths (neutrons).
-        ```python
-        # Choose scattering options (see help(xtl.Scatter.setup_scatter))
-        xtl.Scatter.setup_scatter(type='x-ray', energy_keV=8.0)
-        # Allowed radiation types:
-        #    'xray','neutron','xray magnetic','neutron magnetic','xray resonant'
-        xtl.Scatter.print_all_refelctions() # Returns formated string of all allowed reflections
-        inten = xtl.Scatter.intensity([h,k,l]) # Returns intensity
-        twotheta, iten, reflections = xtl.Scatter.powder(units='twotheta')
-        # Plot Experimental Intensities
-        xtl.Plot.simulate_powder() # Powder pattern
-        xtl.Plot.simulate_hk0() # Reciprocal space plane
-        ```
-        ![Powder Pattern](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/powder_diamond.png?raw=true)
-        ![HK0 Simulation](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/supercell_diffraction.png?raw=true)
-        
-        
-        ### Magnetic Structrues
-        *Magnetic structures and scattering are currently in development and shouldn't be treated as accurate!*
-        
-        Simple magnetic structures can be loaded from magnetic cif (*.mcif) files. Magnetic moments are stored for each atomic 
-        position as a vector. The crystal object has a seperate set of magnetic symmetry operations. Symmetry operations from the 
-        tables of magnetic spacegroups can also be loaded. Only simple magnetic structures are allowed. There must be the same
-        number of magnetic symmetry operations as crystal symmetry operations and atomic positions can only have single moments
-        assigned.
-        ```python
-        xtl = dif.Crystal('some_file.mcif')
-        xtl.Atoms.mxmymz() # return magnetic moment vectors on each ion
-        xtl.Symmetry.symmetry_operations_magnetic # magnetic symmetry operations (list of strings)
-        xtl.Symmetry.print_magnetic_spacegroups() # return str of available magnetic spacegroups, given crystal's spacegroup
-        xtl.Symmetry.load_magnetic_spacegroup(mag_spg_number) # loads mag. operations given mag. spacegroup number
-        ```
-        Magnetic scattering is also available for neutrons and x-rays (both resonant and non-resonant), using the appropriate magnetic form-factors.
-        ```python
-        Imag = xtl.Scatter.magnetic_neutron(HKL=[0,0,3])
-        Ires = xtl.Scatter.xray_resonant_magnetic(HKL=[0,0,3], energy_kev=2.838, azim_zero=[1, 0, 0], psi=0, polarisation='s-p', F0=0, F1=1, F2=0)
-        ```
-        
-        ### Superstructures
-        Superstructures can be built using the Superstructure class, requring only a matrix to define the new phase:
-        ```python
-        su = xtl.generate_superstructure([[2,0,0],[0,2,0],[0,0,1]])
-        ```
-        
-        Superstucture classes behave like Crystal classes, but have an additional 'Parent' property that references the original 
-        crystal structure and additional behaviours partiular to superstructures. Superstructures loose their parent crystal and
-        magnetic symmetry, always being defined in P1 symmetry. So su.Atoms == su.Structure.
-        
-        ```python
-        print(su.parent.info())  # Parent structure
-        su.P # superstructure matrix 
-        su.superhkl2parent([h, k, l])  # index superstructure hkl with parent cell
-        su.parenthkl2super([h, k, l])  # index parent hkl with supercell
-        ```
-        
-        ### Multi-phase
-        Scattering from different crystal structures can be compared using the MultiCrystal class:
-        ```python
-        xtls = xtl1 + xtl2
-        xtls.simulate_powder()
-        ```
-        
-        
-        ### Properties
-        The Crystal class contains a lot of atomic properties that can be exposed in the Properties class:
-        ```python
-        xtl.Properties.info()
-        ```
-        
-        Calculated properties include:
-         - Molecular weight
-         - Density
-         - Diamagnetic suscpetibility 
-         - x-ray absorption coefficient, attenuation length, transmission and refractive index
-         - Molecular charge balance
-         - Molecular mass fraction
-         - Atomic orbitals
-         - Magnetic exchange paths (in progress...)
-        
-        Properties are calulated using the atomic structure along with atomic data stored in the folder [Dans_Diffraction/data](data).
-        
-        
-        ### Multiple Scattering
-        Simulations of multiple scattering at different azimuths for a particular energy can be simulated. Based on [code by Dr Gareth Nisbet](https://journals.iucr.org/a/issues/2015/01/00/td5022/).
-         [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.12866.svg)](https://doi.org/10.5281/zenodo.12866).
-        
-        ```python
-        azimuth, intensity = xtl.Scatter.ms_azimuth([h,k,l], energy_kev=8)
-        ```
-        
-        ![Multiple Scattering](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/ms_azimuth_silicon.png?raw=true)
-        
-        
-        ### Graphical Front End
-        ![All GUI elements](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/GUI_all.png?raw=true)
-        
-        Start a new GUI, then select a cif file:
-        ```text
-        $ ipython -i -m Dans_Diffraction gui
-        ```
-        Or start the GUI from within the interactive console:
-        ```python
-        dif.start_gui()
-        ```
-        Using an already generated crystal:
-        ```python
-        xtl.start_gui()
-        ```
-        
-        ### FDMNES functionality
-        FDMNES is a powerful tool for simulating resonant x-ray diffraction, created by [Y. Joly and O. Bunau.](http://neel.cnrs.fr/spip.php?rubrique1007&lang=en)
-        
-        The Dans_Diffraction FDMNES class allows for the automatic creation of input files and simple analysis of results.
-        The following command should be used to activate these features (only needs to be issued once). 
-        ```python
-        dif.activate_fdmnes()
-        ```
-        Once activated, the FDMNES classes become available.
-        ```python
-        fdm = dif.Fdmnes(xtl) # Create input files and run FDMNES
-        fdma = dif.FdmnesAnalysis(output_path, output_name) # Load output files and plot results
-        ```
-        See class documentation for more information.
-        
-        
-        Once activated, FDMNES GUI elements become available from the main window, emulating functionality of the classes.
-        
-        ![FDMNES Run](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/GUI_08.png?raw=true)
-        ![FDMNES Analyse](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/GUI_09.png?raw=true)
-        
-        
-        -----------------------------------------------------------------------------
-           Copyright 2022 Diamond Light Source Ltd.
-        
-           Licensed under the Apache License, Version 2.0 (the "License");
-           you may not use this file except in compliance with the License.
-           You may obtain a copy of the License at
-        
-               http://www.apache.org/licenses/LICENSE-2.0
-        
-           Unless required by applicable law or agreed to in writing, software
-           distributed under the License is distributed on an "AS IS" BASIS,
-           WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-           See the License for the specific language governing permissions and
-           limitations under the License.
-        
-        Files in this package covered by this licence:
-        * classes_crystal.py
-        * classes_scattering.py
-        * classes_plotting.py
-        * classes_properties.py
-        * classes_multicrystal.py
-        * classes_orientation.py
-        * classes_orbitals.py
-        * functions_general.py
-        * functions_plotting.py
-        * functions_scattering.py
-        * functions_crystallography.py
-        * tkgui/*.py
-        
-        Other files are either covered by their own licence or not licenced for other use.
-        
-         Dr Daniel G Porter, [dan.porter@diamond.ac.uk](mailto:dan.porter@diamond.ac.uk)
-         
-         [www.diamond.ac.uk](www.diamond.ac.uk)
-         
-         Diamond Light Source, Chilton, Didcot, Oxon, OX11 0DE, U.K.
-Keywords: crystal,cif,diffraction,crystallography,science,x-ray,neutron,resonant,magnetic,magnetism,multiple scattering,fdmnes,super structure,spacegroup,space group
-Platform: UNKNOWN
-Classifier: Programming Language :: Python :: 3.7
-Classifier: Intended Audience :: Science/Research
-Classifier: Topic :: Scientific/Engineering :: Physics
-Classifier: License :: OSI Approved :: Apache Software License
-Classifier: Development Status :: 3 - Alpha
-Description-Content-Type: text/markdown
+# Dans_Diffaction
+Reads crystallographic cif files, calculates crystal properties and simulates diffraction.
+
+**Version 3.0**
+
+[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.7725644.svg)](https://doi.org/10.5281/zenodo.7725644)
+[![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/DanPorter/Dans_Diffraction/6be78ef800167276d61d3e73da3b74a8367dbbe7?urlpath=lab%2Ftree%2FDans_Diffraction.ipynb) 
+[![](https://img.shields.io/github/forks/DanPorter/Dans_Diffraction?label=GitHub%20Repo&style=social)](https://github.com/DanPorter/Dans_Diffraction)
+
+
+By Dan Porter, Diamond Light Source
+2023
+
+#### TL;DR:
+```text
+$ ipython -i -m Dans_Diffraction
+OR
+$ ipython -m Dans_Diffraction gui
+```
+
+```python
+"""Python Sctipt"""
+import Dans_Diffraction as dif
+xtl = dif.Crystal('some_file.cif')
+print(xtl) # print Crystal structure parameters
+
+# Print reflection list:
+print(xtl.Scatter.print_all_reflections(energy_kev=5)) 
+
+# Plot Powder pattern:
+xtl.Plot.simulate_powder(energy_kev=8)
+plt.show()
+
+# Start graphical user interface:
+xtl.start_gui()
+```
+
+Full code documentation available [here](https://danporter.github.io/Dans_Diffraction/).
+
+Try it out on [mybinder!](https://mybinder.org/v2/gh/DanPorter/Dans_Diffraction/6be78ef800167276d61d3e73da3b74a8367dbbe7?urlpath=lab%2Ftree%2FDans_Diffraction.ipynb)
+
+For comments, queries or bugs - email [dan.porter@diamond.ac.uk](mailto:dan.porter@diamond.ac.uk)
+
+**Citation:** If you use this code (great!), please cite the published DOI: [10.5281/zenodo.3859501](https://doi.org/10.5281/zenodo.3859501)
+
+# Installation
+**Requirements:** 
+Python 3+ with packages: *Numpy*, *Matplotlib*, *Tkinter*.
+BuiltIn packages used: *sys*, *os*, *re*, *glob*, *warnings*, *json*, *itertools*
+
+Install stable version from PyPI:
+```text
+$ python -m pip install Dans-Diffraction
+```
+
+Or, install the latest version direct from GitHub:
+```text
+$ python -m pip install git+https://github.com/DanPorter/Dans_Diffraction.git
+```
+
+Or, Download the latest version from GitHub (with examples!):
+```text
+$ git clone https://github.com/DanPorter/Dans_Diffraction.git
+```
+
+
+
+# Operation
+Dans_Diffraction is best run within an interactive python environment:
+```text
+$ ipython -i -m Dans_Diffraction
+```
+
+Dans_Diffraction can also be run in scripts as an import, example scripts are provided in the [Examples](https://github.com/DanPorter/Dans_Diffraction/blob/master/Examples) folder.
+### Read CIF file
+```python
+import Dans_Diffraction as dif
+xtl = dif.Crystal('some_file.cif')
+xtl.info() # print Crystal structure parameters
+help(xtl)  # all functions (nearly!) are documented
+```
+
+### Alter atomic positions
+```python
+xtl.Cell.latt([2.85,2.85,10.8,90,90,120]) #  set lattice parameters
+xtl.Atoms.info() # Print Symmetric positions
+xtl.Structure.info() # Print All positions in P1 symmetry (same structure and functions as xtl.Atoms)
+# Symmetric positions
+xtl.Atoms.changeatom(idx=0, u=0, v=0, w=0, type='Co', label='Co1')
+xtl.Atoms.addatom(idx=0, u=0, v=0, w=0, type='Co', label='Co1')
+# After adding or changing an atom in the Atoms class, re-generate the full structure using symmetry arguments:
+xtl.generate_lattice()
+# Full atomic structure in P1 symmetry
+xtl.Structure.changeatom(idx=0, u=0, v=0, w=0, type='Co', label='Co1')
+xtl.Structure.addatom(idx=0, u=0, v=0, w=0, type='Co', label='Co1')
+# Plot crystal Structure
+xtl.Plot.plot_crystal() # 3D plot
+xtl.Plot.plot_layers() # 2D plot for layered materials
+```
+![3D Plot](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/3Dstructrue_Ca3CoMnO6.png?raw=true)
+
+
+### Alter crystal symmetry
+```python
+xtl.Symmetry.info() # print symmetry arguments
+xtl.Symmetry.addsym('x,y,z+1/2') # adds single symmetry operation
+xtl.Symmetry.changesym(0, 'x,y,z+1/4')
+xtl.Symmetry.load_spacegroup(194) # replaces current symmetry operations
+# After adding or changing symmetry operations, regengerate the symmetry matrices
+xtl.Symmetry.generate_matrices()
+```
+
+### Save structure as CIF
+Lattice parameters, crystal structure and symmetry operations will be saved to the CIF.
+If magnetic moments are defined, magnetic symmetry operations and moments will also be saved
+and format changed to "*.mcif".
+```python
+xtl.write_cif('edited file.cif')
+```
+
+### Calculate Structure Factors
+X-ray or neutron structure factors/ intensities are calculated based on the full unit cell structure, including atomic 
+form-factors (x-rays) or coherent scattering lengths (neutrons).
+```python
+# Choose scattering options (see help(xtl.Scatter.setup_scatter))
+xtl.Scatter.setup_scatter(type='x-ray', energy_keV=8.0)
+# Allowed radiation types:
+#    'xray','neutron','xray magnetic','neutron magnetic','xray resonant'
+xtl.Scatter.print_all_refelctions() # Returns formated string of all allowed reflections
+inten = xtl.Scatter.intensity([h,k,l]) # Returns intensity
+twotheta, iten, reflections = xtl.Scatter.powder(units='twotheta')
+# Plot Experimental Intensities
+xtl.Plot.simulate_powder() # Powder pattern
+xtl.Plot.simulate_hk0() # Reciprocal space plane
+```
+![Powder Pattern](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/powder_diamond.png?raw=true)
+![HK0 Simulation](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/supercell_diffraction.png?raw=true)
+
+
+### Magnetic Structrues
+*Magnetic structures and scattering are currently in development and shouldn't be treated as accurate!*
+
+Simple magnetic structures can be loaded from magnetic cif (*.mcif) files. Magnetic moments are stored for each atomic 
+position as a vector. The crystal object has a seperate set of magnetic symmetry operations. Symmetry operations from the 
+tables of magnetic spacegroups can also be loaded. Only simple magnetic structures are allowed. There must be the same
+number of magnetic symmetry operations as crystal symmetry operations and atomic positions can only have single moments
+assigned.
+```python
+xtl = dif.Crystal('some_file.mcif')
+xtl.Atoms.mxmymz() # return magnetic moment vectors on each ion
+xtl.Symmetry.symmetry_operations_magnetic # magnetic symmetry operations (list of strings)
+xtl.Symmetry.print_magnetic_spacegroups() # return str of available magnetic spacegroups, given crystal's spacegroup
+xtl.Symmetry.load_magnetic_spacegroup(mag_spg_number) # loads mag. operations given mag. spacegroup number
+```
+Magnetic scattering is also available for neutrons and x-rays (both resonant and non-resonant), using the appropriate magnetic form-factors.
+```python
+Imag = xtl.Scatter.magnetic_neutron(HKL=[0,0,3])
+Ires = xtl.Scatter.xray_resonant_magnetic(HKL=[0,0,3], energy_kev=2.838, azim_zero=[1, 0, 0], psi=0, polarisation='s-p', F0=0, F1=1, F2=0)
+```
+
+### Superstructures
+Superstructures can be built using the Superstructure class, requring only a matrix to define the new phase:
+```python
+su = xtl.generate_superstructure([[2,0,0],[0,2,0],[0,0,1]])
+```
+
+Superstucture classes behave like Crystal classes, but have an additional 'Parent' property that references the original 
+crystal structure and additional behaviours partiular to superstructures. Superstructures loose their parent crystal and
+magnetic symmetry, always being defined in P1 symmetry. So su.Atoms == su.Structure.
+
+```python
+print(su.parent.info())  # Parent structure
+su.P # superstructure matrix 
+su.superhkl2parent([h, k, l])  # index superstructure hkl with parent cell
+su.parenthkl2super([h, k, l])  # index parent hkl with supercell
+```
+
+### Multi-phase
+Scattering from different crystal structures can be compared using the MultiCrystal class:
+```python
+xtls = xtl1 + xtl2
+xtls.simulate_powder()
+```
+
+
+### Properties
+The Crystal class contains a lot of atomic properties that can be exposed in the Properties class:
+```python
+xtl.Properties.info()
+```
+
+Calculated properties include:
+ - Molecular weight
+ - Density
+ - Diamagnetic suscpetibility 
+ - x-ray absorption coefficient, attenuation length, transmission and refractive index
+ - Molecular charge balance
+ - Molecular mass fraction
+ - Atomic orbitals
+ - Magnetic exchange paths (in progress...)
+
+Properties are calulated using the atomic structure along with atomic data stored in the folder [Dans_Diffraction/data](data).
+
+
+### Multiple Scattering
+Simulations of multiple scattering at different azimuths for a particular energy can be simulated. Based on [code by Dr Gareth Nisbet](https://journals.iucr.org/a/issues/2015/01/00/td5022/).
+ [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.12866.svg)](https://doi.org/10.5281/zenodo.12866).
+
+```python
+azimuth, intensity = xtl.Scatter.ms_azimuth([h,k,l], energy_kev=8)
+```
+
+![Multiple Scattering](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/ms_azimuth_silicon.png?raw=true)
+
+
+### Graphical Front End
+![All GUI elements](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/GUI_all.png?raw=true)
+
+Start a new GUI, then select a cif file:
+```text
+$ ipython -i -m Dans_Diffraction gui
+```
+Or start the GUI from within the interactive console:
+```python
+dif.start_gui()
+```
+Using an already generated crystal:
+```python
+xtl.start_gui()
+```
+
+### Diffractometer Simulator
+![Diffractometer](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/diffractometer.png?raw=true)
+
+New in version 3.0.0. Simulate a generic detector situated around the crystal sample, with the ability to 
+control detector location shape and size and lattice orientation.
+
+
+### FDMNES functionality
+FDMNES is a powerful tool for simulating resonant x-ray diffraction, created by [Y. Joly and O. Bunau.](http://neel.cnrs.fr/spip.php?rubrique1007&lang=en)
+
+The Dans_Diffraction FDMNES class allows for the automatic creation of input files and simple analysis of results.
+The following command should be used to activate these features (only needs to be issued once). 
+```python
+dif.activate_fdmnes()
+```
+Once activated, the FDMNES classes become available.
+```python
+fdm = dif.Fdmnes(xtl) # Create input files and run FDMNES
+fdma = dif.FdmnesAnalysis(output_path, output_name) # Load output files and plot results
+```
+See class documentation for more information.
+
+
+Once activated, FDMNES GUI elements become available from the main window, emulating functionality of the classes.
+
+![FDMNES Run](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/GUI_08.png?raw=true)
+![FDMNES Analyse](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/GUI_09.png?raw=true)
+
+
+# Acknoledgements
+| Date       | Thanks to...                                                                            |
+|------------|-----------------------------------------------------------------------------------------|
+| 2018       | Thanks to Hepesu for help with Python3 support and ideas about breaking up calculations |
+| Dec 2019   | Thanks to Gareth Nisbet for allowing me to inlude his multiple scattering siumulation   |
+| April 2020 | Thanks to ChunHai Wang for helpful suggestions in readcif!                              |
+| May 2020   | Thanks to AndreEbel for helpful suggestions on citations                                |
+| Dec 2020   | Thanks to Chris Drozdowski for suggestions about reflection families                    |
+| Jan 2021   | Thanks to aslarsen for suggestions about outputting the structure factor                |
+| April 2021 | Thanks to Trygve Ræder for suggestions about x-ray scattering factors                   |
+| Feb 2022   | Thanks to Mirko for pointing out the error in two-theta values in Scatter.powder        |
+| March 2022 | Thanks to yevgenyr for suggesting new peak profiles in Scatter.powder                   |
+| Jan 2023  | Thanks to Anuradha Vibhakar for pointing out the error in f0 + if'-if'' |
+| Jan 2023   | Thanks to Andreas Rosnes for testing the installation in jupyterlab                     |
+| May 2023   | Thanks to Carmelo Prestipino for adding electron scattering factors                     |
+| June 2023  | Thanks to Sergio I. Rincon for pointing out the rounding error in Scatter.powder        |
+
+
+Copyright
+-----------------------------------------------------------------------------
+   Copyright 2023 Diamond Light Source Ltd.
+
+   Licensed under the Apache License, Version 2.0 (the "License");
+   you may not use this file except in compliance with the License.
+   You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+
+Files in this package covered by this licence:
+* classes_crystal.py
+* classes_scattering.py
+* classes_plotting.py
+* classes_properties.py
+* classes_multicrystal.py
+* classes_orientation.py
+* classes_orbitals.py
+* functions_general.py
+* functions_plotting.py
+* functions_scattering.py
+* functions_crystallography.py
+* tkgui/*.py
+
+Other files are either covered by their own licence or not licenced for other use.
+
+| Dr Daniel G Porter | [dan.porter@diamond.ac.uk](mailto:dan.porter@diamond.ac.uk) |
+| ---- | ---- |
+| [www.diamond.ac.uk](www.diamond.ac.uk) | Diamond Light Source, Chilton, Didcot, Oxon, OX11 0DE, U.K. |
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `Dans_Diffraction-2.2.3/Dans_Diffraction.egg-info/SOURCES.txt` & `Dans_Diffraction-3.0.0/Dans_Diffraction.egg-info/SOURCES.txt`

 * *Files 4% similar despite different names*

```diff
@@ -36,14 +36,15 @@
 Dans_Diffraction/Structures/Graphite.cif
 Dans_Diffraction/Structures/HCP.cif
 Dans_Diffraction/Structures/Iron.cif
 Dans_Diffraction/Structures/KCl.cif
 Dans_Diffraction/Structures/LaMnO3.mcif
 Dans_Diffraction/Structures/LiCoO2.cif
 Dans_Diffraction/Structures/Na0.8CoO2_P63mmc.cif
+Dans_Diffraction/Structures/NaCoO2_stripe_supercell.cif
 Dans_Diffraction/Structures/Niobium.cif
 Dans_Diffraction/Structures/Ruby.cif
 Dans_Diffraction/Structures/Ruthenium.cif
 Dans_Diffraction/Structures/Sapphire.cif
 Dans_Diffraction/Structures/Silicon.cif
 Dans_Diffraction/Structures/Silver.cif
 Dans_Diffraction/Structures/Sr3LiRuO6.cif
@@ -57,22 +58,27 @@
 Dans_Diffraction/data/SpaceGroups.json
 Dans_Diffraction/data/SpaceGroupsMagnetic.json
 Dans_Diffraction/data/XRayEdges.dat
 Dans_Diffraction/data/XRayMassAtten_muenp.dat
 Dans_Diffraction/data/XRayMassAtten_mup.dat
 Dans_Diffraction/data/atomic_scattering_factors.npy
 Dans_Diffraction/data/f0_WaasKirf.dat
+Dans_Diffraction/data/peng.dat
 Dans_Diffraction/tkgui/__init__.py
 Dans_Diffraction/tkgui/basic_widgets.py
+Dans_Diffraction/tkgui/converter.py
 Dans_Diffraction/tkgui/crystal.py
+Dans_Diffraction/tkgui/diffractometer.py
 Dans_Diffraction/tkgui/fdmnes.py
 Dans_Diffraction/tkgui/multi_crystal.py
 Dans_Diffraction/tkgui/multiple_scattering.py
+Dans_Diffraction/tkgui/periodic_table.py
 Dans_Diffraction/tkgui/properties.py
 Dans_Diffraction/tkgui/scattering.py
+Dans_Diffraction/tkgui/spacegroups.py
 Dans_Diffraction/tkgui/tensor_scattering.py
 test/test_LS_magnetic_components.py
 test/test_WaasKirf_xray_factors.py
 test/test_atom_properties.py
 test/test_attenuation.py
 test/test_attenuation_length.py
 test/test_bmatrix.py
```

### Comparing `Dans_Diffraction-2.2.3/PKG-INFO` & `Dans_Diffraction-3.0.0/PKG-INFO`

 * *Files 22% similar despite different names*

```diff
@@ -1,72 +1,82 @@
 Metadata-Version: 2.1
 Name: Dans_Diffraction
-Version: 2.2.3
+Version: 3.0.0
 Summary: Generate diffracted intensities from crystals
 Home-page: https://github.com/DanPorter/Dans_Diffraction
 Author: Dan Porter
 Author-email: d.g.porter@outlook.com
 License: UNKNOWN
 Description: # Dans_Diffaction
-        Reads crystallographic cif files and simulates diffraction, among other things.
+        Reads crystallographic cif files, calculates crystal properties and simulates diffraction.
         
-        **Version 2.2**
+        **Version 3.0**
+        
+        [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.7725644.svg)](https://doi.org/10.5281/zenodo.7725644)
+        [![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/DanPorter/Dans_Diffraction/6be78ef800167276d61d3e73da3b74a8367dbbe7?urlpath=lab%2Ftree%2FDans_Diffraction.ipynb) 
+        [![](https://img.shields.io/github/forks/DanPorter/Dans_Diffraction?label=GitHub%20Repo&style=social)](https://github.com/DanPorter/Dans_Diffraction)
         
-        [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.3859501.svg)](https://doi.org/10.5281/zenodo.3859501)
         
         By Dan Porter, Diamond Light Source
-        2022
+        2023
         
         #### TL;DR:
         ```text
         $ ipython -i -m Dans_Diffraction
+        OR
+        $ ipython -m Dans_Diffraction gui
         ```
         
         ```python
+        """Python Sctipt"""
         import Dans_Diffraction as dif
         xtl = dif.Crystal('some_file.cif')
-        xtl.info() # print Crystal structure parameters
+        print(xtl) # print Crystal structure parameters
         
         # Print reflection list:
         print(xtl.Scatter.print_all_reflections(energy_kev=5)) 
         
         # Plot Powder pattern:
         xtl.Plot.simulate_powder(energy_kev=8)
         plt.show()
         
         # Start graphical user interface:
         xtl.start_gui()
         ```
         
         Full code documentation available [here](https://danporter.github.io/Dans_Diffraction/).
         
+        Try it out on [mybinder!](https://mybinder.org/v2/gh/DanPorter/Dans_Diffraction/6be78ef800167276d61d3e73da3b74a8367dbbe7?urlpath=lab%2Ftree%2FDans_Diffraction.ipynb)
+        
         For comments, queries or bugs - email [dan.porter@diamond.ac.uk](mailto:dan.porter@diamond.ac.uk)
         
         **Citation:** If you use this code (great!), please cite the published DOI: [10.5281/zenodo.3859501](https://doi.org/10.5281/zenodo.3859501)
         
         # Installation
         **Requirements:** 
         Python 3+ with packages: *Numpy*, *Matplotlib*, *Tkinter*.
         BuiltIn packages used: *sys*, *os*, *re*, *glob*, *warnings*, *json*, *itertools*
         
-        Stable version from PyPI:
+        Install stable version from PyPI:
         ```text
-        $ pip install Dans-Diffraction
+        $ python -m pip install Dans-Diffraction
         ```
         
-        Download latest version from GitHub:
+        Or, install the latest version direct from GitHub:
         ```text
-        $ git clone https://github.com/DanPorter/Dans_Diffraction.git
+        $ python -m pip install git+https://github.com/DanPorter/Dans_Diffraction.git
         ```
-        Or install latest version direct from GitHub:
+        
+        Or, Download the latest version from GitHub (with examples!):
         ```text
-        $ pip install git+https://github.com/DanPorter/Dans_Diffraction.git
+        $ git clone https://github.com/DanPorter/Dans_Diffraction.git
         ```
         
         
+        
         # Operation
         Dans_Diffraction is best run within an interactive python environment:
         ```text
         $ ipython -i -m Dans_Diffraction
         ```
         
         Dans_Diffraction can also be run in scripts as an import, example scripts are provided in the [Examples](https://github.com/DanPorter/Dans_Diffraction/blob/master/Examples) folder.
@@ -223,14 +233,21 @@
         dif.start_gui()
         ```
         Using an already generated crystal:
         ```python
         xtl.start_gui()
         ```
         
+        ### Diffractometer Simulator
+        ![Diffractometer](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/diffractometer.png?raw=true)
+        
+        New in version 3.0.0. Simulate a generic detector situated around the crystal sample, with the ability to 
+        control detector location shape and size and lattice orientation.
+        
+        
         ### FDMNES functionality
         FDMNES is a powerful tool for simulating resonant x-ray diffraction, created by [Y. Joly and O. Bunau.](http://neel.cnrs.fr/spip.php?rubrique1007&lang=en)
         
         The Dans_Diffraction FDMNES class allows for the automatic creation of input files and simple analysis of results.
         The following command should be used to activate these features (only needs to be issued once). 
         ```python
         dif.activate_fdmnes()
@@ -245,16 +262,35 @@
         
         Once activated, FDMNES GUI elements become available from the main window, emulating functionality of the classes.
         
         ![FDMNES Run](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/GUI_08.png?raw=true)
         ![FDMNES Analyse](https://github.com/DanPorter/Dans_Diffraction/blob/master/Screenshots/GUI_09.png?raw=true)
         
         
+        # Acknoledgements
+        | Date       | Thanks to...                                                                            |
+        |------------|-----------------------------------------------------------------------------------------|
+        | 2018       | Thanks to Hepesu for help with Python3 support and ideas about breaking up calculations |
+        | Dec 2019   | Thanks to Gareth Nisbet for allowing me to inlude his multiple scattering siumulation   |
+        | April 2020 | Thanks to ChunHai Wang for helpful suggestions in readcif!                              |
+        | May 2020   | Thanks to AndreEbel for helpful suggestions on citations                                |
+        | Dec 2020   | Thanks to Chris Drozdowski for suggestions about reflection families                    |
+        | Jan 2021   | Thanks to aslarsen for suggestions about outputting the structure factor                |
+        | April 2021 | Thanks to Trygve RÃ¦der for suggestions about x-ray scattering factors                   |
+        | Feb 2022   | Thanks to Mirko for pointing out the error in two-theta values in Scatter.powder        |
+        | March 2022 | Thanks to yevgenyr for suggesting new peak profiles in Scatter.powder                   |
+        | Jan 2023  | Thanks to Anuradha Vibhakar for pointing out the error in f0 + if'-if'' |
+        | Jan 2023   | Thanks to Andreas Rosnes for testing the installation in jupyterlab                     |
+        | May 2023   | Thanks to Carmelo Prestipino for adding electron scattering factors                     |
+        | June 2023  | Thanks to Sergio I. Rincon for pointing out the rounding error in Scatter.powder        |
+        
+        
+        Copyright
         -----------------------------------------------------------------------------
-           Copyright 2022 Diamond Light Source Ltd.
+           Copyright 2023 Diamond Light Source Ltd.
         
            Licensed under the Apache License, Version 2.0 (the "License");
            you may not use this file except in compliance with the License.
            You may obtain a copy of the License at
         
                http://www.apache.org/licenses/LICENSE-2.0
         
@@ -276,20 +312,19 @@
         * functions_plotting.py
         * functions_scattering.py
         * functions_crystallography.py
         * tkgui/*.py
         
         Other files are either covered by their own licence or not licenced for other use.
         
-         Dr Daniel G Porter, [dan.porter@diamond.ac.uk](mailto:dan.porter@diamond.ac.uk)
-         
-         [www.diamond.ac.uk](www.diamond.ac.uk)
-         
-         Diamond Light Source, Chilton, Didcot, Oxon, OX11 0DE, U.K.
-Keywords: crystal,cif,diffraction,crystallography,science,x-ray,neutron,resonant,magnetic,magnetism,multiple scattering,fdmnes,super structure,spacegroup,space group
+        | Dr Daniel G Porter | [dan.porter@diamond.ac.uk](mailto:dan.porter@diamond.ac.uk) |
+        | ---- | ---- |
+        | [www.diamond.ac.uk](www.diamond.ac.uk) | Diamond Light Source, Chilton, Didcot, Oxon, OX11 0DE, U.K. |
+        
+Keywords: crystal,cif,diffraction,crystallography,science,x-ray,neutron,resonant,magnetic,magnetism,multiple scattering,fdmnes,super structure,spacegroup,space group,diffractometer
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Intended Audience :: Science/Research
 Classifier: Topic :: Scientific/Engineering :: Physics
 Classifier: License :: OSI Approved :: Apache Software License
 Classifier: Development Status :: 3 - Alpha
 Description-Content-Type: text/markdown
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `Dans_Diffraction-2.2.3/setup.py` & `Dans_Diffraction-3.0.0/setup.py`

 * *Files 10% similar despite different names*

```diff
@@ -5,25 +5,25 @@
     with open('README.md') as f:
         return f.read()
 
 
 setup(
     name='Dans_Diffraction',
     packages=['Dans_Diffraction', 'Dans_Diffraction.tkgui'],
-    version='2.2.3',
+    version='3.0.0',
     description='Generate diffracted intensities from crystals',
     long_description_content_type='text/markdown',
     long_description=readme(),
     author='Dan Porter',
     author_email='d.g.porter@outlook.com',
     url='https://github.com/DanPorter/Dans_Diffraction',
     keywords=[
         'crystal', 'cif', 'diffraction', 'crystallography', 'science',
         'x-ray','neutron','resonant', 'magnetic', 'magnetism', 'multiple scattering', 
-        'fdmnes', 'super structure', 'spacegroup', 'space group'
+        'fdmnes', 'super structure', 'spacegroup', 'space group', 'diffractometer'
         ],
     classifiers=[
         'Programming Language :: Python :: 3.7',
         'Intended Audience :: Science/Research',
         'Topic :: Scientific/Engineering :: Physics',
         'License :: OSI Approved :: Apache Software License',
         'Development Status :: 3 - Alpha',
```

### Comparing `Dans_Diffraction-2.2.3/test/test_LS_magnetic_components.py` & `Dans_Diffraction-3.0.0/test/test_LS_magnetic_components.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_WaasKirf_xray_factors.py` & `Dans_Diffraction-3.0.0/test/test_WaasKirf_xray_factors.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_atom_properties.py` & `Dans_Diffraction-3.0.0/test/test_atom_properties.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_attenuation.py` & `Dans_Diffraction-3.0.0/test/test_attenuation.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_attenuation_length.py` & `Dans_Diffraction-3.0.0/test/test_attenuation_length.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_bmatrix.py` & `Dans_Diffraction-3.0.0/test/test_bmatrix.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_cif_files.py` & `Dans_Diffraction-3.0.0/test/test_cif_files.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_coherent_diffraction.py` & `Dans_Diffraction-3.0.0/test/test_coherent_diffraction.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_coherent_diffraction2.py` & `Dans_Diffraction-3.0.0/test/test_coherent_diffraction2.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_compare_intensity.py` & `Dans_Diffraction-3.0.0/test/test_compare_intensity.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_compare_intensity_calculation.py` & `Dans_Diffraction-3.0.0/test/test_compare_intensity_calculation.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_compound_name.py` & `Dans_Diffraction-3.0.0/test/test_compound_name.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_convolve2d.py` & `Dans_Diffraction-3.0.0/test/test_convolve2d.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_electron_density.py` & `Dans_Diffraction-3.0.0/test/test_electron_density.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_exchange_path.py` & `Dans_Diffraction-3.0.0/test/test_exchange_path.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_exchange_path2.py` & `Dans_Diffraction-3.0.0/test/test_exchange_path2.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_functions_scattering.py` & `Dans_Diffraction-3.0.0/test/test_functions_scattering.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_functions_scattering_dispersion.py` & `Dans_Diffraction-3.0.0/test/test_functions_scattering_dispersion.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_functions_scattering_new.py` & `Dans_Diffraction-3.0.0/test/test_functions_scattering_new.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_functions_scattering_pol.py` & `Dans_Diffraction-3.0.0/test/test_functions_scattering_pol.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_functions_scattering_xrm.py` & `Dans_Diffraction-3.0.0/test/test_functions_scattering_xrm.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_gaussian.py` & `Dans_Diffraction-3.0.0/test/test_gaussian.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_gen_sym_mat.py` & `Dans_Diffraction-3.0.0/test/test_gen_sym_mat.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_i16_azimuth.py` & `Dans_Diffraction-3.0.0/test/test_i16_azimuth.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_intensity_grid.py` & `Dans_Diffraction-3.0.0/test/test_intensity_grid.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_isincell.py` & `Dans_Diffraction-3.0.0/test/test_isincell.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_laue_backscatter.py` & `Dans_Diffraction-3.0.0/test/test_laue_backscatter.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_nonresonant.py` & `Dans_Diffraction-3.0.0/test/test_nonresonant.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_nonresonant_plot.py` & `Dans_Diffraction-3.0.0/test/test_nonresonant_plot.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_nonresonant_sergio.py` & `Dans_Diffraction-3.0.0/test/test_nonresonant_sergio.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_parameter_plot.py` & `Dans_Diffraction-3.0.0/test/test_parameter_plot.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_plot_orbitals.py` & `Dans_Diffraction-3.0.0/test/test_plot_orbitals.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_plotintensity.py` & `Dans_Diffraction-3.0.0/test/test_plotintensity.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_plotintensity2.py` & `Dans_Diffraction-3.0.0/test/test_plotintensity2.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_readstfm.py` & `Dans_Diffraction-3.0.0/test/test_readstfm.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_refractive_index.py` & `Dans_Diffraction-3.0.0/test/test_refractive_index.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_scattering.py` & `Dans_Diffraction-3.0.0/test/test_scattering.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_supercell.py` & `Dans_Diffraction-3.0.0/test/test_supercell.py`

 * *Files identical despite different names*

### Comparing `Dans_Diffraction-2.2.3/test/test_symmetry_ops2magnetic.py` & `Dans_Diffraction-3.0.0/test/test_symmetry_ops2magnetic.py`

 * *Files identical despite different names*

